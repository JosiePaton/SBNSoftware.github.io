---
layout: page
title: 'Cosmic ray generation (CORSIKA)'
hero_height: is-medium
# menubar: icaruscode_menu
toc: true
---


Cosmic ray generation (CORSIKA)
================================================================================

Generation of cosmic rays is performed via `CORSIKAGen` module
([presentation to LArSoft here](https://indico.fnal.gov/event/10893/contribution/3/material/slides),
[Doxygen documentation here](http://nusoft.fnal.gov/larsoft/doxsvn/html/classevgen_1_1CORSIKAGen.html)),
which samples from a pregenerated set of cosmic particle showers.

ICARUS standard configuration for that module is `icarus_corsika_cmc` in
`fcl/gen/corsika/corsika_icarus.fcl`;
a configuration `icarus_corsika_p` with only protons as primary cosmic rays is also available.
Job configurations using it include:
`icaruscode/fcl/gen/corsika/prodcorsika_standard_icarus.fcl`.



Settings
------------------------------------

Samples were pregenerated by Matt Bass for use with MicroBooNE and other
surface detector at Fermilab; they follow the Constant Mass Composition
model, including as primary rays protons and helium, nitrogen, iron and
magnesium nuclei.

| parameter                           | value                                                                  | parameter             | updated at  |  notes                                                                                          |
| ----------------------------------- | ---------------------------------------------------------------------- | --------------------- | ----------- | ----------------------------------------------------------------------------------------------- |
| pregenerated sample location        | `/pnfs/larsoft/persistent/physics/cosmics/Fermilab/CORSIKA/standard`   | `ShowerInputFiles`    | `v08_19_01` |   more information in the `README` file in there                                            |
| included primary ray types          | p, He, N, Mg, Fe                                                       | `ShowerInputFiles`    | `v08_19_01` |
| flux normalization                  | 17200 (p), 9200 (He), 6200 (N), 9200 (Mg), 6200 (Fe)                   | `ShowerFluxConstants` | `v08_19_01` | 1/(π m s²)                                                                                      |
| exposure time                       | 3.3 ms                                                                 | `SampleTime`          | `v08_19_01` |
| time offset                         | -1.1 ms                                                                | `TimeOffset`          | `v08_19_01` | on [simulation time scale](Software_parameters_and_settings.html#Timing-overview)       |
| shower area extension               | 10 m                                                                   | `ShowerAreaExtension` | `v08_19_01` | additional on each side of the cryostats                                                        |
| shower position shift               | 10 m (*x* and *z*)                                                     | `RandomXYShift`       | `v08_19_01` |
| shower particle entrance            | +18 m (*y*)                                                            | `ProjectToHeight`     | `v08_19_01` | in LArSoft "world" coordinates                                                                  |
| additional space around cryostats   | 5 m (*x*), 3 m (*y*), 6 m (*z*)                                        | `BufferBox`           | `v08_19_01` |

Relevant information from `/pnfs/larsoft/persistent/physics/cosmics/Fermilab/CORSIKA/standard/README` (unversioned):

| parameter             | value                                                   |                                          |
| --------------------- | ------------------------------------------------------- | ---------------------------------------- |
| minimum energy        | 1.3 (p), 5.2 (He), 18.2 (N), 31.2 (Mg), 72.8 (Fe) GeV   |
| maximum energy        | 100 TeV                                                 |
| particle energy cut   | 50 MeV                                                  |
| flux slope γ          | 2.7                                                     | (Φ ,A, (_E_) ∝ _E_ ^-_γ_^ , _E_ in GeV)  |
| observation level     | 228 m                                                   |

This is the configuration `icarus_corsika_cmc` from `v08_19_01`:

    @table::standard_CORSIKAGen_CMC
    SampleTime:     3.3e-3
    ShowerInputFiles: [ "/pnfs/larsoft/persistent/physics/cosmics/Fermilab/CORSIKA/standard/p_showers_*.db", "/pnfs/larsoft/persistent/physics/cosmics/Fermilab/CORSIKA/standard/He_showers_*.db", "/pnfs/larsoft/persistent/physics/cosmics/Fermilab/CORSIKA/standard/N_showers_*.db", "/pnfs/larsoft/persistent/physics/cosmics/Fermilab/CORSIKA/standard/Mg_showers_*.db", "/pnfs/larsoft/persistent/physics/cosmics/Fermilab/CORSIKA/standard/Fe_showers_*.db" ]
    TimeOffset:     -1.1e-3
    BufferBox:        [ -500.0, 500.0,-300.0,300.0,-600.0,600.0 ]   #in cm
    ProjectToHeight:  1800  #height to which particles are projected in cm

`standard_CORSIKAGen_CMC` is defined in `larsim/EventGenerator/CORSIKA/CORSIKAGen.fcl`;
this is also from `larsim` `v08_06_02` (part of LArSoft `v08_19_01`):

    ShowerFluxConstants:  [ 1.72e4, 9.2e3, 6.2e3, 9.2e3, 6.2e3] #list of flux constants per shower file
    ShowerAreaExtension:  1000                 #amount to extend the shower area beyond the cryo dimensions
    RandomXZShift:        1000                 #amount to randomly shift shower start point in x & z [cm]

_(parameters overwritten by `icarus_corsika_cmc` are here omitted)_



Simulation chain configuration
--------------------------------------------------------------------------------

Cosmic ray events contain a large amount of secondary particles from the
cosmic rays, and their propagation (GEANT4) through the simulated
"world" containing the detector can produce several millions
particles.
To cope with this particular scenario, special configurations are used.
Since most of the particles do not cross the TPC, they are not
observable and can be discarded at the cost of not being able to track
back to the full¹ shower.
The configuration recommended here **does not include the Cosmic Ray
Tagging detector**. A different configuration for the `g4` stage needs
to be validated for that.

| Simulation stage    | Configuration file                  | Comment                                           | Last seen in  |
| ------------------- | ----------------------------------- | ------------------------------------------------- | ------------- |
| generation          | `prodcorsika_standard_icarus.fcl`   | cosmic rays only                                  | `v08_44_00`   |
| detector simulation | `cosmics_g4_icarus_volCryostat.fcl` | saves only particles in cryostats *(recommended)* | `v08_45_00`   |
| readout simulation  | *standard `detsim` configuration*   |                                                     
| reconstruction      | *standard `reco` configurations*    |                                                     

¹ Actually it turns out that out of a primary cosmic ray, only one or
two shower particles make it to the world volume we are simulating.
