<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>CORSIKAGen_module.cc Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_b73b02d482d1c4a3db20c3d9ad52d395.html">srcs</a></li><li class="navelem"><a class="el" href="../../dir_c1de2b5dcb01608846a246cb763d5e03.html">larsim</a></li><li class="navelem"><a class="el" href="../../dir_64cfb79233dad4b4de390a7389ba145b.html">larsim</a></li><li class="navelem"><a class="el" href="../../dir_1fc11aff3195d2e0fc7aa7adbcbf7259.html">EventGenerator</a></li><li class="navelem"><a class="el" href="../../dir_a720a5d26fd6483bab3606df03a7aa58.html">CORSIKA</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">CORSIKAGen_module.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d6/d97/CORSIKAGen__module_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"></span><span class="comment">/// \file  CORSIKAGen_module.cc</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"></span><span class="comment">/// \brief Generator for cosmic-ray secondaries based on pre-generated CORSIKA shower databases.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"></span><span class="comment">///</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"></span><span class="comment">/// \author  Matthew.Bass@physics.ox.ac.uk</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"></span><span class="comment">////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// ROOT includes</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;TDatabasePDG.h&quot;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;TString.h&quot;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;TSystem.h&quot;</span> <span class="comment">//need BaseName and DirName</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// Framework includes</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;art/Framework/Core/EDProducer.h&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;art/Framework/Core/ModuleMacros.h&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;art/Framework/Principal/Event.h&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;fhiclcpp/ParameterSet.h&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;art/Framework/Services/Registry/ServiceHandle.h&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;messagefacility/MessageLogger/MessageLogger.h&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">// art extensions</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;nurandom/RandomUtils/NuRandomService.h&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">// larsoft includes</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;nusimdata/SimulationBase/MCTruth.h&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;nusimdata/SimulationBase/MCParticle.h&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d8b/Geometry_8h.html">larcore/Geometry/Geometry.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/d86/RunData_8h.html">larcoreobj/SummaryData/RunData.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &lt;sqlite3.h&gt;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;CLHEP/Random/RandFlat.h&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;CLHEP/Random/RandPoissonQ.h&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;ifdh.h&quot;</span>  <span class="comment">//to handle flux files</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="keyword">namespace </span>evgen {</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">  /**</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">   * @brief LArSoft interface to CORSIKA event generator.</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">   * @note A presentation on this module by the original author is archived at:</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">   *       https://indico.fnal.gov/event/10893/contribution/3/material/slides</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">   * In CORSIKA jargon, a &quot;shower&quot; is the cascade of particles resulting from</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">   * a primary cosmic ray interaction.</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">   * This module creates a single `simb::MCTruth` object (stored as data product</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">   * into a `std::vector&lt;simb::MCTruth&gt;` with a single entry) containing all</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">   * the particles from cosmic ray showers crossing a _surface_ above the</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">   * detector.</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">   * The generation procedure consists of selecting showers from a database of</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">   * *pregenerated* events, and then to adapt them to the parameters requested</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">   * in the module configuration. Pregenerated showers are &quot;observed&quot; at a</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">   * altitude set in CORSIKA configuration.</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">   * Databases need to be stored as files in SQLite3 format. Multiple file</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">   * sources can be specified (`ShowerInputFiles` configuration parameter).</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">   * From each source, one database file is selected and copied locally via</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">   * IFDH.</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">   * From each source, showers are extracted proportionally to the relative flux</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">   * specified in the configuration (specified in `ShowerFluxConstants`,</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">   * see @ref CORSIKAGen_Normalization &quot;normalization&quot; below).</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">   * The actual number of showers per event and per source is extracted</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">   * according to a Poisson distribution around the predicted average number of</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">   * primary cosmic rays for that source.</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">   * Flux normalization</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">   * -------------------</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">   * @anchor CORSIKAGen_Normalization</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">   * CORSIKA generates showers from each specific cosmic ray type @f$ A @f$</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">   * (e.g. iron, proton, etc.) according to a power law distribution</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">   * @f$ \Phi_{A}(E) \propto E^{-\gamma_{A}} @f$ of the primary</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">   * particle energy @f$ E @f$ [GeV]. When sampling pregenerated events, we</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">   * bypass the normalization imposed by CORSIKA and gain complete</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">   * control on it.</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">   * Within CORSIKAGen, for each source (usually each on a different primary</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">   * cosmic ray type, e.g. iron, proton, etc.), the average number of generated</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">   * showers is</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">   * @f$ n_{A} = \pi S T k_{A} \int E^{-\gamma_{A}} dE @f$ with @f$ S @f$ the</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">   * area of the surface the flux passes across, @f$ T @f$ the exposure time,</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">   * the integral defined over the full energy range of the pregenerated showers</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">   * in the source, and @f$ k_{A} @f$ a factor specified in the configuration</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">   * (`ShowerFluxConstants` parameters).</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">   * This is the flux of primary cosmic rays, not of the observed particles</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">   * from their showers. Note that it depends on an area and a time interval,</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">   * but it is uniform with respect to translations and constant in time.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">   * As explained @ref CORSIKAGen_Coverage &quot;below&quot;, we consider only the</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">   * secondary particles that cross an &quot;observation&quot; surface.</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">   * After cosmic ray primary particles cross the flux surface (@f$ S_{\Phi} @f$</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">   * above), they develop into showers of particles that spread across large</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">   * areas. Limiting ourself to the observation of particles on a small surface</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">   * @f$ S_{o} @f$ has two effects. We lose the part of the showers that misses</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">   * that surface @f$ S_{o} @f$. Also, considering a span of time with</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">   * multiple showers, we miss particles from other hypothetical showers</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">   * whose primaries crossed outside the generation surface @f$ S_{\Phi} @f$</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">   * whose shower development would leak into @f$ S_{o} @f$: we did not simulate</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">   * those showers at all!</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">   * In terms of total flux of observed particles, under the assumption that the</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">   * flux is uniform in space, choosing @f$ S_{\Phi} @f$ the same size as</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">   * @f$ S_{o} @f$ makes the two effects get the same size: just as many</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">   * particles from primaries from @f$ S_{\Phi} @f$ leak out of @f$ S_{o} @f$,</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">   * as many particles from primaries from outside @f$ S_{\Phi} @f$ sneak in</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">   * @f$ S_{o} @f$.</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">   * In that case, counting _all_ the particles from the primaries crossing a</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">   * surface @f$ S_{\Phi} @f$ of area _S_ regardless of where they land</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">   * yields the right amount of cosmic ray secondary particles across an</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">   * observation surface @f$ S_{o} @f$ also of area _S_. Practically,</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">   * the particles landing outside @f$ S_{o} @f$ need to be recovered to</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">   * preserve the correct normalization, which is described in the</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">   * @ref CORSIKAGen_Coverage &quot;next section&quot;.</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">   * Surface coverage, position and timing</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">   * --------------------------------------</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">   * @anchor CORSIKAGen_Coverage</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">   * The surface we detect the particles through (let&#39;s call it @f$ S_{d} @f$)</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">   * is defined by the smallest _rectangle_ including all cryostats in the</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">   * detector, and located at the height of the ceiling of the tallest cryostat.</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">   * This surface can be increased by specifying a positive value for</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">   * `ShowerAreaExtension` configuration parameter, in which case each side of</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">   * the rectangle will be extended by that amount.</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">   * Showers are extracted one by one from the pregenerated samples and treated</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">   * independently.</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">   * Ideally, the detection surface @f$ S_{d} @f$ would be at the same exact</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">   * altitude as the observation surface set in CORSIKA (called @f$ S_{o} @f$</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">   * above). In practice, we go the other way around, with the assumption that</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">   * the shower observed at @f$ S_{d} @f$ would be very close to the one we</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">   * actually generated at @f$ S_{o} @f$, and teleport the generated particles</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">   * on @f$ S_{d} @f$. Since the cryostats may be just meters from the earth</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">   * surface @f$ S_{o} @f$ lies on, this is an acceptable approximation.</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">   * All the particles of one shower are compelled within surface @f$ S_{d} @f$</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">   * as a first step. As explained when describing the</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">   * @anchor CORSIKAGen_Normalization &quot;normalization&quot;, we need to keep all the</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">   * shower particles, one way or the other.</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">   * So, particles of the shower that fell out of @f$ S_{d} @f$ are repackaged</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">   * into other showers and translated back in. This is equivalent to assume the</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">   * primary cosmic rays originating such shower would happen outside</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">   * our generation volume (@f$ S_{\Phi} @f$), and their shower would then spill</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">   * into @f$ S_{d} @f$. Since these repackaged showers are in principle</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">   * independent and uncorrelated, they are assigned a random time different</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">   * than the main shower, leveraging the assumption of constantness of the</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">   * flux.</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">   * As for the azimuth, this module uses an approximation by setting north</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">   * direction to match the _z_ axis of LArSoft geometry (typically assumed</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">   * to be the direction of the beam particle).</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">   * The particles so manipulated are then back-propagated from the observation</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">   * surface to an absolute height defined by `ProjectToHeight` (although for</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">   * particular combination of position and direction, the particles might be</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">   * propagated back to the edge of the world, or even outside it).</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">   * As a final filter, only the particles whose straight projections cross any</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">   * of the cryostats (with some buffer volume around, defined by `BufferBox`)</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">   * are stored, while the other ones are discarded. Note that the actual</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">   * interactions that particles from the generation surface undergo may deviate</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">   * them enough to miss the cryostats anyway, and conversely particles that</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">   * have been filtered out because shooting off the cryostats might have been</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">   * subsequently deviated to actually cross them. This effect is not corrected</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">   * for at this time.</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">   * The time of the showers is uniformly distributed within the configured</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">   * time interval, defined by `SampleTime` starting from `TimeOffset`.</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">   * Configuration parameters</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">   * =========================</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">   * * `ShowerInputFiles` (list of paths; mandatory): a list of file paths to</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">   *     pregenerated CORSIKA shower files. Each entry can be a single file or</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">   *     use wildcards (`*`) to specify a set of files to choose among.</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">   *     Paths and wildcards are processed by IFDH.</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">   * * `ShowerFluxConstants` (list of real numbers; mandatory): for each entry</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">   *     @f$ A @f$ in `ShowerInputFiles`, specify the normalization factor</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">   *     @f$ K_{A} @f$ of their distribution [@f$ m^{-2}s^{-1} @f$]</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">   * * `ProjectToHeight` (real, default: `0`): the generated particles will</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">   *     appear to come from this height [cm]</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">   * * `TimeOffset` (real; default: `0`): start time of the exposure window [s],</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">   *     relative to the</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">   *     @ref DetectorClocksSimulationTime &quot;simulation time start&quot;</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">   * * `SampleTime` (real; mandatory): duration of the simulated exposure to</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">   *     cosmic rays [s]</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">   * * `ShowerAreaExtension` (real; default: `0`):</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">   *     extend the size of the observation surface of shower particles (_S_)</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">   *     by this much [cm]; e.g. 1000 will extend 10 m on each side</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">   * * `RandomXZShift` (real; default: `0`): the original position of each</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">   *     shower is randomly shifted within a square with this length as side</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">   *     [cm]</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">   * * `BufferBox` (list of six lengths, all `0` by default):</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">   *     extension to the volume of each cryostat for the purpose of filtering</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">   *     out the particles which do not cross the detector; each cryostat volume</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">   *     is independently extended by the same amount, specified here as</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">   *     *shifts* to lower _x_, higher _x_, lower _y_, higher _y_, lower _z_</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">   *     and higher _z_, in that order [cm] (note that to extend e.g. the</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">   *     negative _x_ side by 5 meters the parameter value should be -500)</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">   * * `SeedGenerator` (integer): force random number generator for event</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">   *     generation to the specified value</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">   * * `SeedPoisson` (integer): force random number generator for number of</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">   *     showers to the specified value</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">   * * `Seed`: alias for `SeedGenerator`</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">   * Random engines</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">   * ---------------</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">   * Currently two random engines are used:</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">   * * a generator engine (driven by `SeedGenerator`), of general use</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">   * * a &quot;Poisson&quot; engine (driven by `SeedPoisson`), only used to determine the</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">   *     number of showers to be selected on each event</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00220"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html">  220</a></span>&#160;  <span class="keyword">class </span><a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html">CORSIKAGen</a> : <span class="keyword">public</span> art::EDProducer {</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keyword">explicit</span> <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a7550f2d07f059e87e5042ab41e1f6037">CORSIKAGen</a>(fhicl::ParameterSet <span class="keyword">const</span>&amp; pset);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keyword">virtual</span> <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#ad214eff8cdd3ae238718d7722f2477a9">~CORSIKAGen</a>();</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a272d7dac4ee885a5e24d224fa55de7a2">produce</a>(art::Event&amp; <a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a35d21e56f8fd7bd65d41ca8765bf4cd7">beginRun</a>(art::Run&amp; run);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="keyword">private</span>:</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a502d912c07fb0eb3cc0cc14e548b0bd5">openDBs</a>(std::string <span class="keyword">const</span>&amp; module_label);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a35ee0a7cd60fb258892db695e777c87d">populateNShowers</a>();</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a065ab358ca213622b0afd0a2b1432ea5">populateTOffset</a>();</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#aff5df0b647cfc99c3eb832a608cd0d97">GetSample</a>(simb::MCTruth&amp;);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#ae661e984083d87eadfb670e84af1f199">wrapvar</a>( <span class="keyword">const</span> <span class="keywordtype">double</span> var, <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../d6/d69/clusteralgorithms_8fcl.html#ae8c2886a2cc7a0fb0fbf4efdb2d32257">low</a>, <span class="keyword">const</span> <span class="keywordtype">double</span> high);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a406aba8d8b8f97b65b814a3c2fd6f14c">wrapvarBoxNo</a>( <span class="keyword">const</span> <span class="keywordtype">double</span> var, <span class="keyword">const</span> <span class="keywordtype">double</span> low, <span class="keyword">const</span> <span class="keywordtype">double</span> high, <span class="keywordtype">int</span>&amp; boxno);<span class="comment"></span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">     * @brief Propagates a point back to the surface of a box.</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">     * @param xyz coordinates of the point to be propagated (`{ x, y, z }`)</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">     * @param dxyz direction of the point (`{ dx, dy, dz }`)</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">     * @param xlo lower _x_ coordinate of the target box</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">     * @param xhi upper _x_ coordinate of the target box</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">     * @param ylo lower _y_ coordinate of the target box</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">     * @param yhi upper _y_ coordinate of the target box</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">     * @param zlo lower _z_ coordinate of the target box</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">     * @param zhi upper _z_ coordinate of the target box</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">     * @param xyzout _(output, room for at least 3 numbers)_ propagated point</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">     * The point `xyz`, assumed to be inside the box, is propagated at the level</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">     * of _the closest among the sides of the box_. Note that this means the</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">     * propagated point might still be not on the surface of the box, even if it</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">     * would later reach it.</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">     * It is anyway guaranteed that `xyzout` is not inside the target box, and</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">     * that at least one of its three coordinates is on the box surface.</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a5938a088a0092387d0297ce1179b6adf">ProjectToBoxEdge</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  xyz[],</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">double</span>    dxyz[],</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">double</span> xlo,</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">double</span> xhi,</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">double</span> ylo,</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">double</span> yhi,</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">double</span> zlo,</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">double</span> zhi,</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                                        <span class="keywordtype">double</span> xyzout[]);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div>
<div class="line"><a name="l00265"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a2ab67896cd9a9ec62356478bf49a6652">  265</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a2ab67896cd9a9ec62356478bf49a6652">fShowerInputs</a>=0; <span class="comment">///&lt; Number of shower inputs to process from</span></div>
<div class="line"><a name="l00266"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a035465680ca9f9493f0761c911c736e8">  266</a></span>&#160;<span class="comment"></span>    std::vector&lt;double&gt; <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a035465680ca9f9493f0761c911c736e8">fNShowersPerEvent</a>; <span class="comment">///&lt; Number of showers to put in each event of duration fSampleTime; one per showerinput</span></div>
<div class="line"><a name="l00267"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a208c0d2aa50d416e955d68957d75af0c">  267</a></span>&#160;<span class="comment"></span>    std::vector&lt;int&gt; <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a208c0d2aa50d416e955d68957d75af0c">fMaxShowers</a>; <span class="comment">//&lt; Max number of showers to query, one per showerinput</span></div>
<div class="line"><a name="l00268"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a38d6af58184bdb8263ab10c8dbe7fb1f">  268</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a38d6af58184bdb8263ab10c8dbe7fb1f">fShowerBounds</a>[6]={0.,0.,0.,0.,0.,0.}; <span class="comment">///&lt; Boundaries of area over which showers are to be distributed (x(min), x(max), _unused_, y, z(min), z(max) )</span></div>
<div class="line"><a name="l00269"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a0ac146e26e334e17b1a1ae1fbe9697b9">  269</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">double</span> <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a0ac146e26e334e17b1a1ae1fbe9697b9">fToffset_corsika</a>=0.; <span class="comment">///&lt; Timing offset to account for propagation time through atmosphere, populated from db</span></div>
<div class="line"><a name="l00270"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#af3428b928ff73cf07c0fddfb05eb515b">  270</a></span>&#160;<span class="comment"></span>    ifdh_ns::ifdh* <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#af3428b928ff73cf07c0fddfb05eb515b">fIFDH</a>=0; <span class="comment">///&lt; (optional) flux file handling</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="comment">//fcl parameters</span></div>
<div class="line"><a name="l00273"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#aa873c00ee34426f41e10e104aed7e4b9">  273</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#aa873c00ee34426f41e10e104aed7e4b9">fProjectToHeight</a>=0.; <span class="comment">///&lt; Height to which particles will be projected [cm]</span></div>
<div class="line"><a name="l00274"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#aec409369d4ab955084d6c09f4c98156c">  274</a></span>&#160;<span class="comment"></span>    std::vector&lt; std::string &gt; <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#aec409369d4ab955084d6c09f4c98156c">fShowerInputFiles</a>; <span class="comment">///&lt; Set of CORSIKA shower data files to use</span></div>
<div class="line"><a name="l00275"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#af4b6d621bc4ed58e58f628731d1707a9">  275</a></span>&#160;<span class="comment"></span>    std::string <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#af4b6d621bc4ed58e58f628731d1707a9">fShowerCopyType</a>; <span class="comment">// ifdh file selection and copying (default) or direct file path</span></div>
<div class="line"><a name="l00276"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a980b16f939ad5b4898ff7379a72c0e64">  276</a></span>&#160;    std::vector&lt; double &gt; <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a980b16f939ad5b4898ff7379a72c0e64">fShowerFluxConstants</a>; <span class="comment">///&lt; Set of flux constants to be associated with each shower data file</span></div>
<div class="line"><a name="l00277"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#ab8339e82d42b3ef9dbc68666e1bcc4ab">  277</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">double</span> <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#ab8339e82d42b3ef9dbc68666e1bcc4ab">fSampleTime</a>=0.; <span class="comment">///&lt; Duration of sample [s]</span></div>
<div class="line"><a name="l00278"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a6f1faf6cd8deda80a711e5e39bf4efa1">  278</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">double</span> <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a6f1faf6cd8deda80a711e5e39bf4efa1">fToffset</a>=0.; <span class="comment">///&lt; Time offset of sample, defaults to zero (no offset) [s]</span></div>
<div class="line"><a name="l00279"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a86c567dda3844f0ee4c57e6d9e3f44d0">  279</a></span>&#160;<span class="comment"></span>    std::vector&lt;double&gt; <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a86c567dda3844f0ee4c57e6d9e3f44d0">fBuffBox</a>; <span class="comment">///&lt; Buffer box extensions to cryostat in each direction (6 of them: x_lo,x_hi,y_lo,y_hi,z_lo,z_hi) [cm]</span></div>
<div class="line"><a name="l00280"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#ac8092f07c0302e1b1b49dd008e95963f">  280</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">double</span> <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#ac8092f07c0302e1b1b49dd008e95963f">fShowerAreaExtension</a>=0.; <span class="comment">///&lt; Extend distribution of corsika particles in x,z by this much (e.g. 1000 will extend 10 m in -x, +x, -z, and +z) [cm]</span></div>
<div class="line"><a name="l00281"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a0b9e0bcefaaaa2eb17dc761b760e7c61">  281</a></span>&#160;<span class="comment"></span>    sqlite3* <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a0b9e0bcefaaaa2eb17dc761b760e7c61">fdb</a>[5]; <span class="comment">///&lt; Pointers to sqlite3 database object, max of 5</span></div>
<div class="line"><a name="l00282"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#adbeb15bfb3616a7f60b3add3d11ade5a">  282</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">double</span> <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#adbeb15bfb3616a7f60b3add3d11ade5a">fRandomXZShift</a>=0.; <span class="comment">///&lt; Each shower will be shifted by a random amount in xz so that showers won&#39;t repeatedly sample the same space [cm]</span></div>
<div class="line"><a name="l00283"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a831ef865e6049b358f571096a0d123a9">  283</a></span>&#160;<span class="comment"></span>    CLHEP::HepRandomEngine&amp; <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a831ef865e6049b358f571096a0d123a9">fGenEngine</a>;</div>
<div class="line"><a name="l00284"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a14dcafc9edf31a6f2800609973c1a9aa">  284</a></span>&#160;    CLHEP::HepRandomEngine&amp; <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a14dcafc9edf31a6f2800609973c1a9aa">fPoisEngine</a>;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  };</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;}</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="keyword">namespace </span>evgen{</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a7550f2d07f059e87e5042ab41e1f6037">  290</a></span>&#160;  <a class="code" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a7550f2d07f059e87e5042ab41e1f6037">CORSIKAGen::CORSIKAGen</a>(fhicl::ParameterSet <span class="keyword">const</span>&amp; <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    : EDProducer{p},</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      fProjectToHeight(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.get&lt; <span class="keywordtype">double</span> &gt;(<span class="stringliteral">&quot;ProjectToHeight&quot;</span>,0.)),</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      fShowerInputFiles(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.get&lt; std::vector&lt; std::string &gt; &gt;(<span class="stringliteral">&quot;ShowerInputFiles&quot;</span>)),</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      fShowerCopyType(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.get&lt; std::string &gt;(<span class="stringliteral">&quot;ShowerCopyType&quot;</span>, <span class="stringliteral">&quot;IFDH&quot;</span>)),</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      fShowerFluxConstants(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.get&lt; std::vector&lt; double &gt; &gt;(<span class="stringliteral">&quot;ShowerFluxConstants&quot;</span>)),</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      fSampleTime(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.get&lt; <span class="keywordtype">double</span> &gt;(<span class="stringliteral">&quot;SampleTime&quot;</span>,0.)),</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      fToffset(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.get&lt; <span class="keywordtype">double</span> &gt;(<span class="stringliteral">&quot;TimeOffset&quot;</span>,0.)),</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      fBuffBox(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.get&lt; std::vector&lt; double &gt; &gt;(<span class="stringliteral">&quot;BufferBox&quot;</span>,{0.0, 0.0, 0.0, 0.0, 0.0, 0.0})),</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <a class="code" href="../../d4/d4d/namespaceevgen.html#a2f68b5076160aa00d34c23aef76657f4">fShowerAreaExtension</a>(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.get&lt; <span class="keywordtype">double</span> &gt;(<span class="stringliteral">&quot;ShowerAreaExtension&quot;</span>,0.)),</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <a class="code" href="../../d4/d4d/namespaceevgen.html#aa6f139b6f1b23a397fde21d5e637d152">fRandomXZShift</a>(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.get&lt; <span class="keywordtype">double</span> &gt;(<span class="stringliteral">&quot;RandomXZShift&quot;</span>,0.)),</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <a class="code" href="../../d4/d4d/namespaceevgen.html#ab956d20b02d86a5ccdbcffc157df8e33">fGenEngine</a>(art::ServiceHandle&lt;rndm::NuRandomService&gt;{}-&gt;createEngine(*<span class="keyword">this</span>, <span class="stringliteral">&quot;HepJamesRandom&quot;</span>, <span class="stringliteral">&quot;gen&quot;</span>, <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>, { <span class="stringliteral">&quot;Seed&quot;</span>, <span class="stringliteral">&quot;SeedGenerator&quot;</span>})),</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      fPoisEngine(art::ServiceHandle&lt;rndm::NuRandomService&gt;{}-&gt;createEngine(*<span class="keyword">this</span>, <span class="stringliteral">&quot;HepJamesRandom&quot;</span>, <span class="stringliteral">&quot;pois&quot;</span>, <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>, <span class="stringliteral">&quot;SeedPoisson&quot;</span>))</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordflow">if</span>(fShowerInputFiles.size() != fShowerFluxConstants.size() || fShowerInputFiles.size()==0 || fShowerFluxConstants.size()==0)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;ShowerInputFiles and ShowerFluxConstants have different or invalid sizes!&quot;</span>&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00306"></a><span class="lineno"><a class="line" href="../../d4/d4d/namespaceevgen.html#aa7808201cbb1bd223f37e70388d2a0a1">  306</a></span>&#160;    <a class="code" href="../../d4/d4d/namespaceevgen.html#aa7808201cbb1bd223f37e70388d2a0a1">fShowerInputs</a>=fShowerInputFiles.size();</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">if</span>(fSampleTime==0.) <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;SampleTime not set!&quot;</span>;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordflow">if</span>(fProjectToHeight==0.) mf::LogInfo(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;Using 0. for fProjectToHeight!&quot;</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    ;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="comment">// create a default random engine; obtain the random seed from NuRandomService,</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="comment">// unless overridden in configuration with key &quot;Seed&quot;</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    this-&gt;<a class="code" href="../../d4/d4d/namespaceevgen.html#ac23b20855b2cc8c1dab2f3f00a86f6c1">openDBs</a>(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.get&lt;std::string&gt;(<span class="stringliteral">&quot;module_label&quot;</span>));</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    this-&gt;<a class="code" href="../../d4/d4d/namespaceevgen.html#ad88b0838274197c26b1c9be9c2cca4e2">populateNShowers</a>();</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    this-&gt;<a class="code" href="../../d4/d4d/namespaceevgen.html#a7965a5a68381b98773126a945d37bf60">populateTOffset</a>();</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    produces&lt; std::vector&lt;simb::MCTruth&gt; &gt;();</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <a class="code" href="../../d4/d4d/namespaceevgen.html#a31fbf4ad9d853a87fefed5bf11c59aa6">produces&lt; sumdata::RunData, art::InRun &gt;</a>();</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div>
<div class="line"><a name="l00324"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#ad214eff8cdd3ae238718d7722f2477a9">  324</a></span>&#160;  CORSIKAGen::~CORSIKAGen(){</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../d4/d4d/namespaceevgen.html#aa7808201cbb1bd223f37e70388d2a0a1">fShowerInputs</a>; i++){</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      sqlite3_close(fdb[i]);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    }</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="comment">//cleanup temp files</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    fIFDH-&gt;cleanup();</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  }</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div>
<div class="line"><a name="l00332"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a5938a088a0092387d0297ce1179b6adf">  332</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d6/d23/namespacegeo.html#aa4f783454188451d17d280826922c2e9">CORSIKAGen::ProjectToBoxEdge</a>(    <span class="keyword">const</span> <span class="keywordtype">double</span>    xyz[],</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">double</span>    indxyz[],</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">double</span>    xlo,</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">double</span>    xhi,</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">double</span>    ylo,</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">double</span>    yhi,</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">double</span>    zlo,</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">double</span>    zhi,</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                                        <span class="keywordtype">double</span> xyzout[]  ){</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="comment">//we want to project backwards, so take mirror of momentum</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> dxyz[3]={-indxyz[0],-indxyz[1],-indxyz[2]};</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="comment">// Compute the distances to the x/y/z walls</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordtype">double</span> dx = 99.E99;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordtype">double</span> dy = 99.E99;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordtype">double</span> dz = 99.E99;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordflow">if</span>      (dxyz[0] &gt; 0.0) { dx = (xhi-xyz[0])/dxyz[0]; }</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dxyz[0] &lt; 0.0) { dx = (xlo-xyz[0])/dxyz[0]; }</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">if</span>      (dxyz[1] &gt; 0.0) { dy = (yhi-xyz[1])/dxyz[1]; }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dxyz[1] &lt; 0.0) { dy = (ylo-xyz[1])/dxyz[1]; }</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">if</span>      (dxyz[2] &gt; 0.0) { dz = (zhi-xyz[2])/dxyz[2]; }</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dxyz[2] &lt; 0.0) { dz = (zlo-xyz[2])/dxyz[2]; }</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="comment">// Choose the shortest distance</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordtype">double</span> d = 0.0;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordflow">if</span>      (dx &lt; dy &amp;&amp; dx &lt; dz) d = dx;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dy &lt; dz &amp;&amp; dy &lt; dx) d = dy;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dz &lt; dx &amp;&amp; dz &lt; dy) d = dz;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="comment">// Make the step</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; ++i) {</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      xyzout[i] = xyz[i] + dxyz[i]*d;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  }</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div>
<div class="line"><a name="l00371"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a502d912c07fb0eb3cc0cc14e548b0bd5">  371</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d4/d4d/namespaceevgen.html#ac23b20855b2cc8c1dab2f3f00a86f6c1">CORSIKAGen::openDBs</a>(std::string <span class="keyword">const</span>&amp; module_label){</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="comment">//choose files based on fShowerInputFiles, copy them with ifdh, open them</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="comment">// for c2: statement is unused</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="comment">//sqlite3_stmt *statement;</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    CLHEP::RandFlat flat(<a class="code" href="../../d4/d4d/namespaceevgen.html#ab956d20b02d86a5ccdbcffc157df8e33">fGenEngine</a>);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="comment">//setup ifdh object</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">if</span> ( ! fIFDH ) fIFDH = <span class="keyword">new</span> ifdh_ns::ifdh;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* ifdh_debug_env = std::getenv(<span class="stringliteral">&quot;IFDH_DEBUG_LEVEL&quot;</span>);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordflow">if</span> ( ifdh_debug_env ) {</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      mf::LogInfo(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;IFDH_DEBUG_LEVEL: &quot;</span> &lt;&lt; ifdh_debug_env&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      fIFDH-&gt;set_debug(ifdh_debug_env);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    }</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="comment">//get ifdh path for each file in fShowerInputFiles, put into selectedflist</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="comment">//if 1 file returned, use that file</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="comment">//if &gt;1 file returned, randomly select one file</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="comment">//if 0 returned, make exeption for missing files</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    std::vector&lt;std::pair&lt;std::string,long&gt;&gt; selectedflist;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../d4/d4d/namespaceevgen.html#aa7808201cbb1bd223f37e70388d2a0a1">fShowerInputs</a>; i++){</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      <span class="keywordflow">if</span>(fShowerInputFiles[i].find(<span class="stringliteral">&quot;*&quot;</span>)==std::string::npos){</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="comment">//if there are no wildcards, don&#39;t call findMatchingFiles</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        selectedflist.push_back(std::make_pair(fShowerInputFiles[i],0));</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        mf::LogInfo(<span class="stringliteral">&quot;CorsikaGen&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Selected&quot;</span>&lt;&lt;selectedflist.back().first&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;          }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="comment">//use findMatchingFiles</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <span class="comment">//default to IFDH approach when wildcards in path</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        std::vector&lt;std::pair&lt;std::string,long&gt;&gt; flist;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                std::string path(gSystem-&gt;DirName(fShowerInputFiles[i].c_str()));</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                std::string <a class="code" href="../../df/d32/namespaceLVDSpatterns.html#ad2b1658effcfafaf8c9a54a6845befa0">pattern</a>(gSystem-&gt;BaseName(fShowerInputFiles[i].c_str()));</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                flist = fIFDH-&gt;findMatchingFiles(path,pattern);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> selIndex=-1;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                <span class="keywordflow">if</span>(flist.size()==1){ <span class="comment">//0th element is the search path:pattern</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                        selIndex=0;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(flist.size()&gt;1){</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                        selIndex= (<span class="keywordtype">unsigned</span> int) (flat()*(flist.size()-1)+0.5); <span class="comment">//rnd with rounding, dont allow picking the 0th element</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                        <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;No files returned for path:pattern: &quot;</span>&lt;&lt;path&lt;&lt;<span class="stringliteral">&quot;:&quot;</span>&lt;&lt;pattern&lt;&lt;std::endl;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                }</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                selectedflist.push_back(flist[selIndex]);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                mf::LogInfo(<span class="stringliteral">&quot;CorsikaGen&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;For &quot;</span>&lt;&lt;fShowerInputFiles[i]&lt;&lt;<span class="stringliteral">&quot;:&quot;</span>&lt;&lt;pattern</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        &lt;&lt;<span class="stringliteral">&quot;\nFound &quot;</span>&lt;&lt; flist.size() &lt;&lt; <span class="stringliteral">&quot; candidate files&quot;</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        &lt;&lt;<span class="stringliteral">&quot;\nChoosing file number &quot;</span>&lt;&lt; selIndex &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        &lt;&lt;<span class="stringliteral">&quot;\nSelected &quot;</span>&lt;&lt;selectedflist.back().first&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;     }</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    }</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="comment">//do the fetching, store local filepaths in locallist</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    std::vector&lt;std::string&gt; locallist;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;selectedflist.size(); i++){</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      mf::LogInfo(<span class="stringliteral">&quot;CorsikaGen&quot;</span>)</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Fetching: &quot;</span>&lt;&lt;selectedflist[i].first&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;selectedflist[i].second&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <span class="keywordflow">if</span> (fShowerCopyType == <span class="stringliteral">&quot;IFDH&quot;</span>) {</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        std::string fetchedfile(fIFDH-&gt;fetchInput(selectedflist[i].first));</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        MF_LOG_DEBUG(<span class="stringliteral">&quot;CorsikaGen&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Fetched; local path: &quot;</span>&lt;&lt;fetchedfile &lt;&lt; <span class="stringliteral">&quot;; copy type: IFDH&quot;</span>;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        locallist.push_back(fetchedfile);</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      }</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fShowerCopyType == <span class="stringliteral">&quot;DIRECT&quot;</span>) {</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        std::string fetchedfile(selectedflist[i].<a class="code" href="../../d4/d43/namespacechannelDBConverter.html#af481fa22253619167bce75a37e10ec34">first</a>);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        MF_LOG_DEBUG(<span class="stringliteral">&quot;CorsikaGen&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Fetched; local path: &quot;</span>&lt;&lt;fetchedfile &lt;&lt; <span class="stringliteral">&quot;; copy type: DIRECT&quot;</span>;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        locallist.push_back(fetchedfile);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      }</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Error copying shower db: ShowerCopyType must be \&quot;IFDH\&quot; or \&quot;DIRECT\&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    }</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="comment">//open the files in fShowerInputFilesLocalPaths with sqlite3</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;locallist.size(); i++){</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      <span class="comment">//prepare and execute statement to attach db file</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      <span class="keywordtype">int</span> res=sqlite3_open(locallist[i].c_str(),&amp;fdb[i]);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      <span class="keywordflow">if</span> (res!= SQLITE_OK)</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Error opening db: (&quot;</span> &lt;&lt;locallist[i].c_str()&lt;&lt;<span class="stringliteral">&quot;) (&quot;</span>&lt;&lt;res&lt;&lt;<span class="stringliteral">&quot;): &quot;</span> &lt;&lt; sqlite3_errmsg(fdb[i]) &lt;&lt; <span class="stringliteral">&quot;; memory used:&lt;&lt;&quot;</span>&lt;&lt;sqlite3_memory_used()&lt;&lt;<span class="stringliteral">&quot;/&quot;</span>&lt;&lt;sqlite3_memory_highwater(0)&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        mf::LogInfo(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;Attached db &quot;</span>&lt;&lt; locallist[i]&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    }</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  }</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div>
<div class="line"><a name="l00448"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#ae661e984083d87eadfb670e84af1f199">  448</a></span>&#160;  <span class="keywordtype">double</span> CORSIKAGen::wrapvar( <span class="keyword">const</span> <span class="keywordtype">double</span> var, <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../d6/d69/clusteralgorithms_8fcl.html#ae8c2886a2cc7a0fb0fbf4efdb2d32257">low</a>, <span class="keyword">const</span> <span class="keywordtype">double</span> high){</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="comment">//wrap variable so that it&#39;s always between low and high</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">return</span> (var - (high - low) * floor(var/(high-low))) + <a class="code" href="../../d6/d69/clusteralgorithms_8fcl.html#ae8c2886a2cc7a0fb0fbf4efdb2d32257">low</a>;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  }</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div>
<div class="line"><a name="l00453"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a406aba8d8b8f97b65b814a3c2fd6f14c">  453</a></span>&#160;  <span class="keywordtype">double</span> CORSIKAGen::wrapvarBoxNo( <span class="keyword">const</span> <span class="keywordtype">double</span> var, <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../d6/d69/clusteralgorithms_8fcl.html#ae8c2886a2cc7a0fb0fbf4efdb2d32257">low</a>, <span class="keyword">const</span> <span class="keywordtype">double</span> high, <span class="keywordtype">int</span>&amp; boxno){</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="comment">//wrap variable so that it&#39;s always between low and high</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    boxno=int(floor(var/(high-low)));</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keywordflow">return</span> (var - (high - low) * floor(var/(high-low))) + <a class="code" href="../../d6/d69/clusteralgorithms_8fcl.html#ae8c2886a2cc7a0fb0fbf4efdb2d32257">low</a>;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  }</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div>
<div class="line"><a name="l00459"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a065ab358ca213622b0afd0a2b1432ea5">  459</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d4/d4d/namespaceevgen.html#a7965a5a68381b98773126a945d37bf60">CORSIKAGen::populateTOffset</a>(){</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="comment">//populate TOffset_corsika by finding minimum ParticleTime from db file</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    sqlite3_stmt *statement;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keyword">const</span> std::string kStatement(<span class="stringliteral">&quot;select min(t) from particles&quot;</span>);</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="keywordtype">double</span> t=0.;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../d4/d4d/namespaceevgen.html#aa7808201cbb1bd223f37e70388d2a0a1">fShowerInputs</a>; i++){</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="comment">//build and do query to get run min(t) from each db</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <span class="keywordflow">if</span> ( sqlite3_prepare(fdb[i], kStatement.c_str(), -1, &amp;statement, 0 ) == SQLITE_OK ){</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;          <span class="keywordtype">int</span> res=0;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;          res = sqlite3_step(statement);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;          <span class="keywordflow">if</span> ( res == SQLITE_ROW ){</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            t=sqlite3_column_double(statement,0);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            mf::LogInfo(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;For showers input &quot;</span>&lt;&lt; i&lt;&lt;<span class="stringliteral">&quot; found particles.min(t)=&quot;</span>&lt;&lt;t&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            <span class="keywordflow">if</span> (i==0 || t&lt;fToffset_corsika) fToffset_corsika=t;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;          }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;            <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Unexpected sqlite3_step return value: (&quot;</span> &lt;&lt;res&lt;&lt;<span class="stringliteral">&quot;); &quot;</span>&lt;&lt;<span class="stringliteral">&quot;ERROR:&quot;</span>&lt;&lt;sqlite3_errmsg(fdb[i])&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;          }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;          <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Error preparing statement: (&quot;</span> &lt;&lt;kStatement&lt;&lt;<span class="stringliteral">&quot;); &quot;</span>&lt;&lt;<span class="stringliteral">&quot;ERROR:&quot;</span>&lt;&lt;sqlite3_errmsg(fdb[i])&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        }</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    }</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    mf::LogInfo(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;Found corsika timeoffset [ns]: &quot;</span>&lt;&lt; fToffset_corsika&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  }</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div>
<div class="line"><a name="l00486"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a35ee0a7cd60fb258892db695e777c87d">  486</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d4/d4d/namespaceevgen.html#ad88b0838274197c26b1c9be9c2cca4e2">CORSIKAGen::populateNShowers</a>(){</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="comment">//populate vector of the number of showers per event based on:</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      <span class="comment">//AREA the showers are being distributed over</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <span class="comment">//TIME of the event (fSampleTime)</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="comment">//flux constants that determine the overall normalizations (fShowerFluxConstants)</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      <span class="comment">//Energy range over which the sample was generated (ERANGE_*)</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      <span class="comment">//power spectrum over which the sample was generated (ESLOPE)</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="comment">//compute shower area based on the maximal x,z dimensions of cryostat boundaries + fShowerAreaExtension</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    art::ServiceHandle&lt;geo::Geometry const&gt; geom;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = 0; c &lt; geom-&gt;Ncryostats(); ++c){</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      <span class="keywordtype">double</span> <a class="code" href="../../df/d0a/main_8cpp.html#a74a4d91774841c9e52baae57f0bd67d8">bounds</a>[6] = {0.};</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      geom-&gt;CryostatBoundaries(bounds, c);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bnd = 0; bnd&lt;6; bnd++){</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        mf::LogVerbatim(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;Cryo Boundary: &quot;</span>&lt;&lt;bnd&lt;&lt;<span class="stringliteral">&quot;=&quot;</span>&lt;&lt;bounds[bnd]&lt;&lt;<span class="stringliteral">&quot; ( + Buffer=&quot;</span>&lt;&lt;fBuffBox[bnd]&lt;&lt;<span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="keywordflow">if</span>(fabs(bounds[bnd])&gt;fabs(fShowerBounds[bnd])){</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;          fShowerBounds[bnd]=bounds[bnd];</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        }</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    }</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="comment">//add on fShowerAreaExtension without being clever</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    fShowerBounds[0] = fShowerBounds[0] - <a class="code" href="../../d4/d4d/namespaceevgen.html#a2f68b5076160aa00d34c23aef76657f4">fShowerAreaExtension</a>;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    fShowerBounds[1] = fShowerBounds[1] + <a class="code" href="../../d4/d4d/namespaceevgen.html#a2f68b5076160aa00d34c23aef76657f4">fShowerAreaExtension</a>;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    fShowerBounds[4] = fShowerBounds[4] - <a class="code" href="../../d4/d4d/namespaceevgen.html#a2f68b5076160aa00d34c23aef76657f4">fShowerAreaExtension</a>;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    fShowerBounds[5] = fShowerBounds[5] + <a class="code" href="../../d4/d4d/namespaceevgen.html#a2f68b5076160aa00d34c23aef76657f4">fShowerAreaExtension</a>;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordtype">double</span> showersArea=(fShowerBounds[1]/100-fShowerBounds[0]/100)*(fShowerBounds[5]/100-fShowerBounds[4]/100);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    mf::LogInfo(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>)</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      &lt;&lt;  <span class="stringliteral">&quot;Area extended by : &quot;</span>&lt;&lt;fShowerAreaExtension</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      &lt;&lt;<span class="stringliteral">&quot;\nShowers to be distributed betweeen: x=&quot;</span>&lt;&lt;fShowerBounds[0]&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;fShowerBounds[1]</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                             &lt;&lt;<span class="stringliteral">&quot; &amp; z=&quot;</span>&lt;&lt;fShowerBounds[4]&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;fShowerBounds[5]</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      &lt;&lt;<span class="stringliteral">&quot;\nShowers to be distributed with random XZ shift: &quot;</span>&lt;&lt;<a class="code" href="../../d4/d4d/namespaceevgen.html#aa6f139b6f1b23a397fde21d5e637d152">fRandomXZShift</a>&lt;&lt;<span class="stringliteral">&quot; cm&quot;</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      &lt;&lt;<span class="stringliteral">&quot;\nShowers to be distributed over area: &quot;</span>&lt;&lt;showersArea&lt;&lt;<span class="stringliteral">&quot; m^2&quot;</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      &lt;&lt;<span class="stringliteral">&quot;\nShowers to be distributed over time: &quot;</span>&lt;&lt;fSampleTime&lt;&lt;<span class="stringliteral">&quot; s&quot;</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      &lt;&lt;<span class="stringliteral">&quot;\nShowers to be distributed with time offset: &quot;</span>&lt;&lt;fToffset&lt;&lt;<span class="stringliteral">&quot; s&quot;</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      &lt;&lt;<span class="stringliteral">&quot;\nShowers to be distributed at y: &quot;</span>&lt;&lt;fShowerBounds[3]&lt;&lt;<span class="stringliteral">&quot; cm&quot;</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      ;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="comment">//db variables</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    sqlite3_stmt *statement;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keyword">const</span> std::string kStatement(<span class="stringliteral">&quot;select erange_high,erange_low,eslope,nshow from input&quot;</span>);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="keywordtype">double</span> upperLimitOfEnergyRange=0.,lowerLimitOfEnergyRange=0.,energySlope=0.,oneMinusGamma=0.,EiToOneMinusGamma=0.,EfToOneMinusGamma=0.;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../d4/d4d/namespaceevgen.html#aa7808201cbb1bd223f37e70388d2a0a1">fShowerInputs</a>; i++){</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        <span class="comment">//build and do query to get run info from databases</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      <span class="comment">//  double thisrnd=flat();//need a new random number for each query</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <span class="keywordflow">if</span> ( sqlite3_prepare(fdb[i], kStatement.c_str(), -1, &amp;statement, 0 ) == SQLITE_OK ){</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;          <span class="keywordtype">int</span> res=0;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;          res = sqlite3_step(statement);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;          <span class="keywordflow">if</span> ( res == SQLITE_ROW ){</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            upperLimitOfEnergyRange=sqlite3_column_double(statement,0);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            lowerLimitOfEnergyRange=sqlite3_column_double(statement,1);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            energySlope = sqlite3_column_double(statement,2);</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            fMaxShowers.push_back(sqlite3_column_int(statement,3));</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            oneMinusGamma = 1 + energySlope;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            EiToOneMinusGamma = pow(lowerLimitOfEnergyRange, oneMinusGamma);</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            EfToOneMinusGamma = pow(upperLimitOfEnergyRange, oneMinusGamma);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            mf::LogVerbatim(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;For showers input &quot;</span>&lt;&lt; i&lt;&lt;<span class="stringliteral">&quot; found e_hi=&quot;</span>&lt;&lt;upperLimitOfEnergyRange&lt;&lt;<span class="stringliteral">&quot;, e_lo=&quot;</span>&lt;&lt;lowerLimitOfEnergyRange&lt;&lt;<span class="stringliteral">&quot;, slope=&quot;</span>&lt;&lt;energySlope&lt;&lt;<span class="stringliteral">&quot;, k=&quot;</span>&lt;&lt;fShowerFluxConstants[i]&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;          }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Unexpected sqlite3_step return value: (&quot;</span> &lt;&lt;res&lt;&lt;<span class="stringliteral">&quot;); &quot;</span>&lt;&lt;<span class="stringliteral">&quot;ERROR:&quot;</span>&lt;&lt;sqlite3_errmsg(fdb[i])&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;          }</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;          <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Error preparing statement: (&quot;</span> &lt;&lt;kStatement&lt;&lt;<span class="stringliteral">&quot;); &quot;</span>&lt;&lt;<span class="stringliteral">&quot;ERROR:&quot;</span>&lt;&lt;sqlite3_errmsg(fdb[i])&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        }</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <span class="comment">//this is computed, how?</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <span class="keywordtype">double</span> NShowers=( M_PI * showersArea * fShowerFluxConstants[i] * (EfToOneMinusGamma - EiToOneMinusGamma) / oneMinusGamma )*fSampleTime;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      fNShowersPerEvent.push_back(NShowers);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;For showers input &quot;</span>&lt;&lt; i</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                               &lt;&lt;<span class="stringliteral">&quot; the number of showers per event is &quot;</span>&lt;&lt;(int)NShowers&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    }</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  }</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div>
<div class="line"><a name="l00561"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#aff5df0b647cfc99c3eb832a608cd0d97">  561</a></span>&#160;  <span class="keywordtype">void</span> CORSIKAGen::GetSample(simb::MCTruth&amp; mctruth){</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="comment">//for each input, randomly pull fNShowersPerEvent[i] showers from the Particles table</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="comment">//and randomly place them in time (between -fSampleTime/2 and fSampleTime/2)</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="comment">//wrap their positions based on the size of the area under consideration</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="comment">//based on http://nusoft.fnal.gov/larsoft/doxsvn/html/CRYHelper_8cxx_source.html (Sample)</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="comment">//query from sqlite db with select * from particles where shower in (select id from showers ORDER BY substr(id*0.51123124141,length(id)+2) limit 100000) ORDER BY substr(shower*0.51123124141,length(shower)+2);</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="comment">//where 0.51123124141 is a random seed to allow randomly selecting rows and should be randomly generated for each query</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="comment">//the inner order by is to select randomly from the possible shower id&#39;s</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="comment">//the outer order by is to make sure the shower numbers are ordered randomly (without this, the showers always come out ordered by shower number</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="comment">//and 100000 is the number of showers to be selected at random and needs to be less than the number of showers in the showers table</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="comment">//TDatabasePDG is for looking up particle masses</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keyword">static</span> TDatabasePDG* pdgt = TDatabasePDG::Instance();</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="comment">//db variables</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    sqlite3_stmt *statement;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keyword">const</span> TString kStatement(<span class="stringliteral">&quot;select shower,pdg,px,py,pz,x,z,t,e from particles where shower in (select id from showers ORDER BY substr(id*%f,length(id)+2) limit %d) ORDER BY substr(shower*%f,length(shower)+2)&quot;</span>);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    CLHEP::RandFlat flat(<a class="code" href="../../d4/d4d/namespaceevgen.html#ab956d20b02d86a5ccdbcffc157df8e33">fGenEngine</a>);</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    CLHEP::RandPoissonQ randpois(fPoisEngine);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="comment">// get geometry and figure where to project particles to, based on CRYHelper</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    art::ServiceHandle&lt;geo::Geometry const&gt; geom;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keywordtype">double</span> x1, x2;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keywordtype">double</span> y1, y2;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordtype">double</span> z1, z2;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    geom-&gt;WorldBox(&amp;x1, &amp;x2, &amp;y1, &amp;y2, &amp;z1, &amp;z2);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="comment">// make the world box slightly smaller so that the projection to</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="comment">// the edge avoids possible rounding errors later on with Geant4</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keywordtype">double</span> fBoxDelta=1.e-5;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    x1 += fBoxDelta;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    x2 -= fBoxDelta;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    y1 += fBoxDelta;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    y2 = fProjectToHeight;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    z1 += fBoxDelta;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    z2 -= fBoxDelta;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="comment">//populate mctruth</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="keywordtype">int</span> ntotalCtr=0; <span class="comment">//count number of particles added to mctruth</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordtype">int</span> lastShower=0; <span class="comment">//keep track of last shower id so that t can be randomized on every new shower</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordtype">int</span> nShowerCntr=0; <span class="comment">//keep track of how many showers are left to be added to mctruth</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="keywordtype">int</span> nShowerQry=0; <span class="comment">//number of showers to query from db</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#ad36c739018def8e4e44032f4cf395c9d">shower</a>,<a class="code" href="../../d9/dd2/selectors_8fcl.html#a697017f6ca07cbb4f47653babf318012">pdg</a>;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../de/d4f/filemuons_8fcl.html#a5d65ed57c8d202a924f2716ca6c8d209">px</a>,<a class="code" href="../../d2/df3/prod__muon__2GeV__d45__Collection_8fcl.html#ad3fdde52520bceee418a61ecae2a8343">py</a>,<a class="code" href="../../de/d4f/filemuons_8fcl.html#a353996e037fc5b2ea33c626744db2552">pz</a>,<a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a>,<a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#ae40184b0245025a43c56daa3261d5e3c">z</a>,tParticleTime,etot,showerTime=0.,showerTimex=0.,showerTimez=0.,showerXOffset=0.,showerZOffset=0.,t;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../d4/d4d/namespaceevgen.html#aa7808201cbb1bd223f37e70388d2a0a1">fShowerInputs</a>; i++){</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      nShowerCntr=randpois.fire(fNShowersPerEvent[i]);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      mf::LogInfo(<span class="stringliteral">&quot;CORSIKAGEN&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; Shower input &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; with mean &quot;</span> &lt;&lt; fNShowersPerEvent[i] &lt;&lt; <span class="stringliteral">&quot; generating &quot;</span> &lt;&lt; nShowerCntr;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      <span class="keywordflow">while</span>(nShowerCntr&gt;0){</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        <span class="comment">//how many showers should we query?</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="keywordflow">if</span>(nShowerCntr&gt;fMaxShowers[i]){</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;          nShowerQry=fMaxShowers[i]; <span class="comment">//take the group size</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;          nShowerQry=nShowerCntr; <span class="comment">//take the rest that are needed</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        }</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <span class="comment">//build and do query to get nshowers</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <span class="keywordtype">double</span> thisrnd=flat(); <span class="comment">//need a new random number for each query</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        TString kthisStatement=TString::Format(kStatement.Data(),thisrnd,nShowerQry,thisrnd);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        MF_LOG_DEBUG(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;Executing: &quot;</span>&lt;&lt;kthisStatement;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        <span class="keywordflow">if</span> ( sqlite3_prepare(fdb[i], kthisStatement.Data(), -1, &amp;statement, 0 ) == SQLITE_OK ){</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;          <span class="keywordtype">int</span> res=0;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;          <span class="comment">//loop over database rows, pushing particles into mctruth object</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;          <span class="keywordflow">while</span>(1){</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            res = sqlite3_step(statement);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            <span class="keywordflow">if</span> ( res == SQLITE_ROW ){</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;              <span class="comment">/*</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment">               * Memo columns:</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="comment">               * [0] shower</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment">               * [1] particle ID (PDG)</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment">               * [2] momentum: x component [GeV/c]</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment">               * [3] momentum: y component [GeV/c]</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">               * [4] momentum: z component [GeV/c]</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">               * [5] position: x component [cm]</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment">               * [6] position: z component [cm]</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">               * [7] time [ns]</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="comment">               * [8] energy [GeV]</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="comment">               */</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;              shower=sqlite3_column_int(statement,0);</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;              <span class="keywordflow">if</span>(shower!=lastShower){</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                <span class="comment">//each new shower gets its own random time and position offsets</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                showerTime=1e9*(flat()*fSampleTime); <span class="comment">//converting from s to ns</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                showerTimex=1e9*(flat()*fSampleTime); <span class="comment">//converting from s to ns</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                showerTimez=1e9*(flat()*fSampleTime); <span class="comment">//converting from s to ns</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                <span class="comment">//and a random offset in both z and x controlled by the fRandomXZShift parameter</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                showerXOffset=flat()*<a class="code" href="../../d4/d4d/namespaceevgen.html#aa6f139b6f1b23a397fde21d5e637d152">fRandomXZShift</a> - (<a class="code" href="../../d4/d4d/namespaceevgen.html#aa6f139b6f1b23a397fde21d5e637d152">fRandomXZShift</a>/2);</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                showerZOffset=flat()*<a class="code" href="../../d4/d4d/namespaceevgen.html#aa6f139b6f1b23a397fde21d5e637d152">fRandomXZShift</a> - (<a class="code" href="../../d4/d4d/namespaceevgen.html#aa6f139b6f1b23a397fde21d5e637d152">fRandomXZShift</a>/2);</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;              }</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;              pdg=sqlite3_column_int(statement,1);</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;              <span class="comment">//get mass for this particle</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;              <span class="keywordtype">double</span> <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a> = 0.; <span class="comment">// in GeV</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;              TParticlePDG* pdgp = pdgt-&gt;GetParticle(pdg);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;              <span class="keywordflow">if</span> (pdgp) m = pdgp-&gt;Mass();</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;              <span class="comment">//Note: position/momentum in db have north=-x and west=+z, rotate so that +z is north and +x is west</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;              <span class="comment">//get momentum components</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;              px=sqlite3_column_double(statement,4);<span class="comment">//uboone x=Particlez</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;              py=sqlite3_column_double(statement,3);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;              pz=-sqlite3_column_double(statement,2);<span class="comment">//uboone z=-Particlex</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;              etot=sqlite3_column_double(statement,8);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;              <span class="comment">//get/calculate position components</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;              <span class="keywordtype">int</span> boxnoX=0,boxnoZ=0;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;              x=wrapvarBoxNo(sqlite3_column_double(statement,6)+showerXOffset,fShowerBounds[0],fShowerBounds[1],boxnoX);</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;              z=wrapvarBoxNo(-sqlite3_column_double(statement,5)+showerZOffset,fShowerBounds[4],fShowerBounds[5],boxnoZ);</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;              tParticleTime=sqlite3_column_double(statement,7); <span class="comment">//time offset, includes propagation time from top of atmosphere</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;              <span class="comment">//actual particle time is particle surface arrival time</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;              <span class="comment">//+ shower start time</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;              <span class="comment">//+ global offset (fcl parameter, in s)</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;              <span class="comment">//- propagation time through atmosphere</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;              <span class="comment">//+ boxNo{X,Z} time offset to make grid boxes have different shower times</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;              t=tParticleTime+showerTime+(1e9*fToffset)-fToffset_corsika + showerTimex*boxnoX + showerTimez*boxnoZ;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;              <span class="comment">//wrap surface arrival so that it&#39;s in the desired time window</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;              t=wrapvar(t,(1e9*fToffset),1e9*(fToffset+fSampleTime));</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;              simb::MCParticle <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>(ntotalCtr,pdg,<span class="stringliteral">&quot;primary&quot;</span>,-200,m,1);</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;              <span class="comment">//project back to wordvol/fProjectToHeight</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;              <span class="comment">/*</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="comment">               * This back propagation goes from a point on the upper surface of</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment">               * the cryostat back to the edge of the world, except that that</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment">               * world is cut short by `fProjectToHeight` (`y2`) ceiling.</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment">               * The projection will most often lie on that ceiling, but it may</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="comment">               * end up instead on one of the side edges of the world, or even</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment">               * outside it.</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment">               */</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;              <span class="keywordtype">double</span> xyzo[3];</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;              <span class="keywordtype">double</span> x0[3]={<a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a>,fShowerBounds[3],z};</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;              <span class="keywordtype">double</span> dx[3]={<a class="code" href="../../de/d4f/filemuons_8fcl.html#a5d65ed57c8d202a924f2716ca6c8d209">px</a>,<a class="code" href="../../d2/df3/prod__muon__2GeV__d45__Collection_8fcl.html#ad3fdde52520bceee418a61ecae2a8343">py</a>,pz};</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;              this-&gt;<a class="code" href="../../d6/d23/namespacegeo.html#aa4f783454188451d17d280826922c2e9">ProjectToBoxEdge</a>(x0, dx, x1, x2, y1, y2, z1, z2, xyzo);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;              TLorentzVector pos(xyzo[0],xyzo[1],xyzo[2],t);<span class="comment">// time needs to be in ns to match GENIE, etc</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;              TLorentzVector mom(px,py,pz,etot);</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;              p.AddTrajectoryPoint(pos,mom);</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;              mctruth.Add(p);</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;              ntotalCtr++;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;              lastShower=<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#ad36c739018def8e4e44032f4cf395c9d">shower</a>;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            }<span class="keywordflow">else</span> <span class="keywordflow">if</span> ( res == SQLITE_DONE ){</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;            }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;              <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Unexpected sqlite3_step return value: (&quot;</span> &lt;&lt;res&lt;&lt;<span class="stringliteral">&quot;); &quot;</span>&lt;&lt;<span class="stringliteral">&quot;ERROR:&quot;</span>&lt;&lt;sqlite3_errmsg(fdb[i])&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            }</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;          }</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;          <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Error preparing statement: (&quot;</span> &lt;&lt;kthisStatement&lt;&lt;<span class="stringliteral">&quot;); &quot;</span>&lt;&lt;<span class="stringliteral">&quot;ERROR:&quot;</span>&lt;&lt;sqlite3_errmsg(fdb[i])&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        }</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        nShowerCntr=nShowerCntr-nShowerQry;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      }</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    }</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  }</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div>
<div class="line"><a name="l00713"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a35d21e56f8fd7bd65d41ca8765bf4cd7">  713</a></span>&#160;  <span class="keywordtype">void</span> CORSIKAGen::beginRun(art::Run&amp; run)</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  {</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    art::ServiceHandle&lt;geo::Geometry const&gt; geo;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    run.put(std::make_unique&lt;sumdata::RunData&gt;(geo-&gt;DetectorName()));</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  }</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div>
<div class="line"><a name="l00719"></a><span class="lineno"><a class="line" href="../../db/d59/classevgen_1_1CORSIKAGen.html#a272d7dac4ee885a5e24d224fa55de7a2">  719</a></span>&#160;  <span class="keywordtype">void</span> CORSIKAGen::produce(art::Event&amp; <a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>){</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    std::unique_ptr&lt; std::vector&lt;simb::MCTruth&gt; &gt; truthcol(<span class="keyword">new</span> std::vector&lt;simb::MCTruth&gt;);</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    art::ServiceHandle&lt;geo::Geometry const&gt; geom;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    simb::MCTruth truth;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    truth.SetOrigin(<a class="code" href="../../d0/d98/PAC2020_2SBND_2helper_8h.html#a0f8170e4d8765178d662f2d77d6e92ce">simb::kCosmicRay</a>);</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    simb::MCTruth pretruth;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    GetSample(pretruth);</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    mf::LogInfo(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;GetSample number of particles returned: &quot;</span>&lt;&lt;pretruth.NParticles()&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="comment">// loop over particles in the truth object</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; pretruth.NParticles(); ++i){</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      simb::MCParticle particle = pretruth.GetParticle(i);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      <span class="keyword">const</span> TLorentzVector&amp; v4 = particle.Position();</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      <span class="keyword">const</span> TLorentzVector&amp; p4 = particle.Momentum();</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <span class="keywordtype">double</span> x0[3] = {v4.X(),  v4.Y(),  v4.Z() };</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <span class="keywordtype">double</span> dx[3] = {p4.Px(), p4.Py(), p4.Pz()};</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <span class="comment">// now check if the particle goes through any cryostat in the detector</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      <span class="comment">// if so, add it to the truth object.</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = 0; c &lt; geom-&gt;Ncryostats(); ++c){</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../df/d0a/main_8cpp.html#a74a4d91774841c9e52baae57f0bd67d8">bounds</a>[6] = {0.};</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        geom-&gt;CryostatBoundaries(bounds, c);</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="comment">//add a buffer box around the cryostat bounds to increase the acceptance and account for scattering</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <span class="comment">//By default, the buffer box has zero size</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cb=0; cb&lt;6; cb++)</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;           bounds[cb] = bounds[cb]+fBuffBox[cb];</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="comment">//calculate the intersection point with each cryostat surface</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        <span class="keywordtype">bool</span> intersects_cryo = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> bnd=0; bnd!=6; ++bnd) {</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;          <span class="keywordflow">if</span> (bnd&lt;2) {</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;            <span class="keywordtype">double</span> p2[3] = {bounds[bnd],  x0[1] + (dx[1]/dx[0])*(bounds[bnd] - x0[0]), x0[2] + (dx[2]/dx[0])*(bounds[bnd] - x0[0])};</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            <span class="keywordflow">if</span> ( p2[1] &gt;= bounds[2] &amp;&amp; p2[1] &lt;= bounds[3] &amp;&amp;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                 p2[2] &gt;= bounds[4] &amp;&amp; p2[2] &lt;= bounds[5] ) {</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;              intersects_cryo = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            }</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;          }</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bnd&gt;=2 &amp;&amp; bnd&lt;4) {</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            <span class="keywordtype">double</span> p2[3] = {x0[0] + (dx[0]/dx[1])*(bounds[bnd] - x0[1]), bounds[bnd], x0[2] + (dx[2]/dx[1])*(bounds[bnd] - x0[1])};</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            <span class="keywordflow">if</span> ( p2[0] &gt;= bounds[0] &amp;&amp; p2[0] &lt;= bounds[1] &amp;&amp;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                 p2[2] &gt;= bounds[4] &amp;&amp; p2[2] &lt;= bounds[5] ) {</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;              intersects_cryo = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            }</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;          }</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bnd&gt;=4) {</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            <span class="keywordtype">double</span> p2[3] = {x0[0] + (dx[0]/dx[2])*(bounds[bnd] - x0[2]), x0[1] + (dx[1]/dx[2])*(bounds[bnd] - x0[2]), bounds[bnd]};</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;            <span class="keywordflow">if</span> ( p2[0] &gt;= bounds[0] &amp;&amp; p2[0] &lt;= bounds[1] &amp;&amp;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                 p2[1] &gt;= bounds[2] &amp;&amp; p2[1] &lt;= bounds[3] ) {</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;              intersects_cryo = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            }</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;          }</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        }</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        <span class="keywordflow">if</span> (intersects_cryo){</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;          truth.Add(particle);</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;          <span class="keywordflow">break</span>; <span class="comment">//leave loop over cryostats to avoid adding particle multiple times</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        }<span class="comment">// end if particle goes into a cryostat</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      }<span class="comment">// end loop over cryostats in the detector</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    }<span class="comment">// loop on particles</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    mf::LogInfo(<span class="stringliteral">&quot;CORSIKAGen&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;Number of particles from getsample crossing cryostat + bounding box: &quot;</span>&lt;&lt;truth.NParticles()&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    truthcol-&gt;push_back(truth);</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    evt.put(std::move(truthcol));</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  }<span class="comment">// end produce</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;}<span class="comment">// end namespace</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="keyword">namespace </span>evgen{</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  DEFINE_ART_MODULE(CORSIKAGen)</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;}</div>
<div class="ttc" id="namespaceevgen_html_ab956d20b02d86a5ccdbcffc157df8e33"><div class="ttname"><a href="../../d4/d4d/namespaceevgen.html#ab956d20b02d86a5ccdbcffc157df8e33">evgen::fGenEngine</a></div><div class="ttdeci">fGenEngine(art::ServiceHandle&lt; rndm::NuRandomService &gt;{}-&gt;createEngine(*this,&quot;HepJamesRandom&quot;,&quot;gen&quot;, p,{&quot;Seed&quot;,&quot;SeedGenerator&quot;}))</div></div>
<div class="ttc" id="run__opflash__electron_8fcl_html_ae40184b0245025a43c56daa3261d5e3c"><div class="ttname"><a href="../../d0/d84/run__opflash__electron_8fcl.html#ae40184b0245025a43c56daa3261d5e3c">z</a></div><div class="ttdeci">process_name opflash particleana ie ie ie z</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d84/run__opflash__electron_8fcl_source.html#l00092">run_opflash_electron.fcl:92</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_a6f1faf6cd8deda80a711e5e39bf4efa1"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#a6f1faf6cd8deda80a711e5e39bf4efa1">evgen::CORSIKAGen::fToffset</a></div><div class="ttdeci">double fToffset</div><div class="ttdoc">Time offset of sample, defaults to zero (no offset) [s]. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00278">CORSIKAGen_module.cc:278</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_ae661e984083d87eadfb670e84af1f199"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#ae661e984083d87eadfb670e84af1f199">evgen::CORSIKAGen::wrapvar</a></div><div class="ttdeci">double wrapvar(const double var, const double low, const double high)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00448">CORSIKAGen_module.cc:448</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_ab8339e82d42b3ef9dbc68666e1bcc4ab"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#ab8339e82d42b3ef9dbc68666e1bcc4ab">evgen::CORSIKAGen::fSampleTime</a></div><div class="ttdeci">double fSampleTime</div><div class="ttdoc">Duration of sample [s]. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00277">CORSIKAGen_module.cc:277</a></div></div>
<div class="ttc" id="selectors_8fcl_html_a697017f6ca07cbb4f47653babf318012"><div class="ttname"><a href="../../d9/dd2/selectors_8fcl.html#a697017f6ca07cbb4f47653babf318012">pdg</a></div><div class="ttdeci">var pdg</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd2/selectors_8fcl_source.html#l00014">selectors.fcl:14</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_aa873c00ee34426f41e10e104aed7e4b9"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#aa873c00ee34426f41e10e104aed7e4b9">evgen::CORSIKAGen::fProjectToHeight</a></div><div class="ttdeci">double fProjectToHeight</div><div class="ttdoc">Height to which particles will be projected [cm]. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00273">CORSIKAGen_module.cc:273</a></div></div>
<div class="ttc" id="run__opflash__electron_8fcl_html_a6673f03521899f7844189bcfd8ee5941"><div class="ttname"><a href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a></div><div class="ttdeci">process_name opflash particleana ie x</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d84/run__opflash__electron_8fcl_source.html#l00090">run_opflash_electron.fcl:90</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_a35ee0a7cd60fb258892db695e777c87d"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#a35ee0a7cd60fb258892db695e777c87d">evgen::CORSIKAGen::populateNShowers</a></div><div class="ttdeci">void populateNShowers()</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00486">CORSIKAGen_module.cc:486</a></div></div>
<div class="ttc" id="filemuons_8fcl_html_a353996e037fc5b2ea33c626744db2552"><div class="ttname"><a href="../../de/d4f/filemuons_8fcl.html#a353996e037fc5b2ea33c626744db2552">pz</a></div><div class="ttdeci">BEGIN_PROLOG pz</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4f/filemuons_8fcl_source.html#l00010">filemuons.fcl:10</a></div></div>
<div class="ttc" id="namespaceevgen_html_a7965a5a68381b98773126a945d37bf60"><div class="ttname"><a href="../../d4/d4d/namespaceevgen.html#a7965a5a68381b98773126a945d37bf60">evgen::populateTOffset</a></div><div class="ttdeci">this populateTOffset()</div></div>
<div class="ttc" id="namespacechannelDBConverter_html_af481fa22253619167bce75a37e10ec34"><div class="ttname"><a href="../../d4/d43/namespacechannelDBConverter.html#af481fa22253619167bce75a37e10ec34">channelDBConverter.first</a></div><div class="ttdeci">first</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d11/channelDBConverter_8py_source.html#l00146">channelDBConverter.py:146</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_ad214eff8cdd3ae238718d7722f2477a9"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#ad214eff8cdd3ae238718d7722f2477a9">evgen::CORSIKAGen::~CORSIKAGen</a></div><div class="ttdeci">virtual ~CORSIKAGen()</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00324">CORSIKAGen_module.cc:324</a></div></div>
<div class="ttc" id="selectors_8fcl_html_a24c8335057af14a9b508d5ac18999ce5"><div class="ttname"><a href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a></div><div class="ttdeci">pdgs p</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd2/selectors_8fcl_source.html#l00022">selectors.fcl:22</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html">evgen::CORSIKAGen</a></div><div class="ttdoc">LArSoft interface to CORSIKA event generator. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00220">CORSIKAGen_module.cc:220</a></div></div>
<div class="ttc" id="namespaceevgen_html_a31fbf4ad9d853a87fefed5bf11c59aa6"><div class="ttname"><a href="../../d4/d4d/namespaceevgen.html#a31fbf4ad9d853a87fefed5bf11c59aa6">evgen::produces&lt; sumdata::RunData, art::InRun &gt;</a></div><div class="ttdeci">produces&lt; sumdata::RunData, art::InRun &gt;()</div></div>
<div class="ttc" id="namespaceevgen_html_a2f68b5076160aa00d34c23aef76657f4"><div class="ttname"><a href="../../d4/d4d/namespaceevgen.html#a2f68b5076160aa00d34c23aef76657f4">evgen::fShowerAreaExtension</a></div><div class="ttdeci">fShowerAreaExtension(p.get&lt; double &gt;(&quot;ShowerAreaExtension&quot;, 0.))</div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_af3428b928ff73cf07c0fddfb05eb515b"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#af3428b928ff73cf07c0fddfb05eb515b">evgen::CORSIKAGen::fIFDH</a></div><div class="ttdeci">ifdh_ns::ifdh * fIFDH</div><div class="ttdoc">(optional) flux file handling </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00270">CORSIKAGen_module.cc:270</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_aec409369d4ab955084d6c09f4c98156c"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#aec409369d4ab955084d6c09f4c98156c">evgen::CORSIKAGen::fShowerInputFiles</a></div><div class="ttdeci">std::vector&lt; std::string &gt; fShowerInputFiles</div><div class="ttdoc">Set of CORSIKA shower data files to use. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00274">CORSIKAGen_module.cc:274</a></div></div>
<div class="ttc" id="cheaterreco_8fcl_html_ad36c739018def8e4e44032f4cf395c9d"><div class="ttname"><a href="../../d2/d36/cheaterreco_8fcl.html#ad36c739018def8e4e44032f4cf395c9d">shower</a></div><div class="ttdeci">process_name shower</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d36/cheaterreco_8fcl_source.html#l00051">cheaterreco.fcl:51</a></div></div>
<div class="ttc" id="namespacegen__crt__frags_html_a55a56854d78e363691470c7297fde77c"><div class="ttname"><a href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">gen_crt_frags.m</a></div><div class="ttdeci">tuple m</div><div class="ttdoc">now if test mode generate materials, CRT shell, world, gdml header else just generate CRT shell for u...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d8c/gen__crt__frags_8py_source.html#l01347">gen_crt_frags.py:1347</a></div></div>
<div class="ttc" id="clusteralgorithms_8fcl_html_ae8c2886a2cc7a0fb0fbf4efdb2d32257"><div class="ttname"><a href="../../d6/d69/clusteralgorithms_8fcl.html#ae8c2886a2cc7a0fb0fbf4efdb2d32257">low</a></div><div class="ttdeci">standard_dbscan3dalg useful for diagnostics hits not in a line will not be clustered on on only for track like only for track like on on the smaller the less shower like tracks low</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d69/clusteralgorithms_8fcl_source.html#l00253">clusteralgorithms.fcl:253</a></div></div>
<div class="ttc" id="namespaceevgen_html_aa7808201cbb1bd223f37e70388d2a0a1"><div class="ttname"><a href="../../d4/d4d/namespaceevgen.html#aa7808201cbb1bd223f37e70388d2a0a1">evgen::fShowerInputs</a></div><div class="ttdeci">fShowerInputs</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00306">CORSIKAGen_module.cc:306</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_a2ab67896cd9a9ec62356478bf49a6652"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#a2ab67896cd9a9ec62356478bf49a6652">evgen::CORSIKAGen::fShowerInputs</a></div><div class="ttdeci">int fShowerInputs</div><div class="ttdoc">Number of shower inputs to process from. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00265">CORSIKAGen_module.cc:265</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_a0b9e0bcefaaaa2eb17dc761b760e7c61"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#a0b9e0bcefaaaa2eb17dc761b760e7c61">evgen::CORSIKAGen::fdb</a></div><div class="ttdeci">sqlite3 * fdb[5]</div><div class="ttdoc">Pointers to sqlite3 database object, max of 5. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00281">CORSIKAGen_module.cc:281</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_a980b16f939ad5b4898ff7379a72c0e64"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#a980b16f939ad5b4898ff7379a72c0e64">evgen::CORSIKAGen::fShowerFluxConstants</a></div><div class="ttdeci">std::vector&lt; double &gt; fShowerFluxConstants</div><div class="ttdoc">Set of flux constants to be associated with each shower data file. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00276">CORSIKAGen_module.cc:276</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_a5938a088a0092387d0297ce1179b6adf"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#a5938a088a0092387d0297ce1179b6adf">evgen::CORSIKAGen::ProjectToBoxEdge</a></div><div class="ttdeci">void ProjectToBoxEdge(const double xyz[], const double dxyz[], const double xlo, const double xhi, const double ylo, const double yhi, const double zlo, const double zhi, double xyzout[])</div><div class="ttdoc">Propagates a point back to the surface of a box. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00332">CORSIKAGen_module.cc:332</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_a14dcafc9edf31a6f2800609973c1a9aa"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#a14dcafc9edf31a6f2800609973c1a9aa">evgen::CORSIKAGen::fPoisEngine</a></div><div class="ttdeci">CLHEP::HepRandomEngine &amp; fPoisEngine</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00284">CORSIKAGen_module.cc:284</a></div></div>
<div class="ttc" id="PAC2020_2SBND_2helper_8h_html_a0f8170e4d8765178d662f2d77d6e92ce"><div class="ttname"><a href="../../d0/d98/PAC2020_2SBND_2helper_8h.html#a0f8170e4d8765178d662f2d77d6e92ce">kCosmicRay</a></div><div class="ttdeci">const Cut kCosmicRay</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d98/PAC2020_2SBND_2helper_8h_source.html#l00054">PAC2020/SBND/helper.h:54</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_a406aba8d8b8f97b65b814a3c2fd6f14c"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#a406aba8d8b8f97b65b814a3c2fd6f14c">evgen::CORSIKAGen::wrapvarBoxNo</a></div><div class="ttdeci">double wrapvarBoxNo(const double var, const double low, const double high, int &amp;boxno)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00453">CORSIKAGen_module.cc:453</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_a065ab358ca213622b0afd0a2b1432ea5"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#a065ab358ca213622b0afd0a2b1432ea5">evgen::CORSIKAGen::populateTOffset</a></div><div class="ttdeci">void populateTOffset()</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00459">CORSIKAGen_module.cc:459</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_a208c0d2aa50d416e955d68957d75af0c"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#a208c0d2aa50d416e955d68957d75af0c">evgen::CORSIKAGen::fMaxShowers</a></div><div class="ttdeci">std::vector&lt; int &gt; fMaxShowers</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00267">CORSIKAGen_module.cc:267</a></div></div>
<div class="ttc" id="namespaceLVDSpatterns_html_ad2b1658effcfafaf8c9a54a6845befa0"><div class="ttname"><a href="../../df/d32/namespaceLVDSpatterns.html#ad2b1658effcfafaf8c9a54a6845befa0">LVDSpatterns.pattern</a></div><div class="ttdeci">tuple pattern</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d3e/LVDSpatterns_8py_source.html#l00112">LVDSpatterns.py:112</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_a0ac146e26e334e17b1a1ae1fbe9697b9"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#a0ac146e26e334e17b1a1ae1fbe9697b9">evgen::CORSIKAGen::fToffset_corsika</a></div><div class="ttdeci">double fToffset_corsika</div><div class="ttdoc">Timing offset to account for propagation time through atmosphere, populated from db. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00269">CORSIKAGen_module.cc:269</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_af4b6d621bc4ed58e58f628731d1707a9"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#af4b6d621bc4ed58e58f628731d1707a9">evgen::CORSIKAGen::fShowerCopyType</a></div><div class="ttdeci">std::string fShowerCopyType</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00275">CORSIKAGen_module.cc:275</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_a272d7dac4ee885a5e24d224fa55de7a2"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#a272d7dac4ee885a5e24d224fa55de7a2">evgen::CORSIKAGen::produce</a></div><div class="ttdeci">void produce(art::Event &amp;evt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00719">CORSIKAGen_module.cc:719</a></div></div>
<div class="ttc" id="filemuons_8fcl_html_a5d65ed57c8d202a924f2716ca6c8d209"><div class="ttname"><a href="../../de/d4f/filemuons_8fcl.html#a5d65ed57c8d202a924f2716ca6c8d209">px</a></div><div class="ttdeci">BEGIN_PROLOG px</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4f/filemuons_8fcl_source.html#l00010">filemuons.fcl:10</a></div></div>
<div class="ttc" id="prod__muon__2GeV__d45__Collection_8fcl_html_ad3fdde52520bceee418a61ecae2a8343"><div class="ttname"><a href="../../d2/df3/prod__muon__2GeV__d45__Collection_8fcl.html#ad3fdde52520bceee418a61ecae2a8343">py</a></div><div class="ttdeci">process_name physics producers generator physics producers generator physics producers generator py</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/prod__muon__2GeV__d45__Collection_8fcl_source.html#l00021">prod_muon_2GeV_d45_Collection.fcl:21</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_adbeb15bfb3616a7f60b3add3d11ade5a"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#adbeb15bfb3616a7f60b3add3d11ade5a">evgen::CORSIKAGen::fRandomXZShift</a></div><div class="ttdeci">double fRandomXZShift</div><div class="ttdoc">Each shower will be shifted by a random amount in xz so that showers won&amp;#39;t repeatedly sample the same...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00282">CORSIKAGen_module.cc:282</a></div></div>
<div class="ttc" id="namespaceevgen_html_ad88b0838274197c26b1c9be9c2cca4e2"><div class="ttname"><a href="../../d4/d4d/namespaceevgen.html#ad88b0838274197c26b1c9be9c2cca4e2">evgen::populateNShowers</a></div><div class="ttdeci">this populateNShowers()</div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_a38d6af58184bdb8263ab10c8dbe7fb1f"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#a38d6af58184bdb8263ab10c8dbe7fb1f">evgen::CORSIKAGen::fShowerBounds</a></div><div class="ttdeci">double fShowerBounds[6]</div><div class="ttdoc">Boundaries of area over which showers are to be distributed (x(min), x(max), unused, y, z(min), z(max) ) </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00268">CORSIKAGen_module.cc:268</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_a7550f2d07f059e87e5042ab41e1f6037"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#a7550f2d07f059e87e5042ab41e1f6037">evgen::CORSIKAGen::CORSIKAGen</a></div><div class="ttdeci">CORSIKAGen(fhicl::ParameterSet const &amp;pset)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00290">CORSIKAGen_module.cc:290</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_a35d21e56f8fd7bd65d41ca8765bf4cd7"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#a35d21e56f8fd7bd65d41ca8765bf4cd7">evgen::CORSIKAGen::beginRun</a></div><div class="ttdeci">void beginRun(art::Run &amp;run)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00713">CORSIKAGen_module.cc:713</a></div></div>
<div class="ttc" id="namespacegeo_html_aa4f783454188451d17d280826922c2e9"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#aa4f783454188451d17d280826922c2e9">geo::ProjectToBoxEdge</a></div><div class="ttdeci">void ProjectToBoxEdge(const double xyz[], const double dxyz[], double xlo, double xhi, double ylo, double yhi, double zlo, double zhi, double xyzout[])</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/geo_8h_source.html#l00049">geo.h:49</a></div></div>
<div class="ttc" id="namespacetca_html_a3bc30aeace71ea50324b602afa2155f2"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">tca::evt</a></div><div class="ttdeci">TCEvent evt</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/DataStructs_8cxx_source.html#l00007">DataStructs.cxx:7</a></div></div>
<div class="ttc" id="RunData_8h_html"><div class="ttname"><a href="../../da/d86/RunData_8h.html">RunData.h</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_aff5df0b647cfc99c3eb832a608cd0d97"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#aff5df0b647cfc99c3eb832a608cd0d97">evgen::CORSIKAGen::GetSample</a></div><div class="ttdeci">void GetSample(simb::MCTruth &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00561">CORSIKAGen_module.cc:561</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_a035465680ca9f9493f0761c911c736e8"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#a035465680ca9f9493f0761c911c736e8">evgen::CORSIKAGen::fNShowersPerEvent</a></div><div class="ttdeci">std::vector&lt; double &gt; fNShowersPerEvent</div><div class="ttdoc">Number of showers to put in each event of duration fSampleTime; one per showerinput. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00266">CORSIKAGen_module.cc:266</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_a831ef865e6049b358f571096a0d123a9"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#a831ef865e6049b358f571096a0d123a9">evgen::CORSIKAGen::fGenEngine</a></div><div class="ttdeci">CLHEP::HepRandomEngine &amp; fGenEngine</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00283">CORSIKAGen_module.cc:283</a></div></div>
<div class="ttc" id="namespaceevgen_html_ac23b20855b2cc8c1dab2f3f00a86f6c1"><div class="ttname"><a href="../../d4/d4d/namespaceevgen.html#ac23b20855b2cc8c1dab2f3f00a86f6c1">evgen::openDBs</a></div><div class="ttdeci">if(fSampleTime==0.) throw cet if(fProjectToHeight==0.) mf this openDBs(p.get&lt; std::string &gt;(&quot;module_label&quot;))</div></div>
<div class="ttc" id="namespaceevgen_html_aa6f139b6f1b23a397fde21d5e637d152"><div class="ttname"><a href="../../d4/d4d/namespaceevgen.html#aa6f139b6f1b23a397fde21d5e637d152">evgen::fRandomXZShift</a></div><div class="ttdeci">fRandomXZShift(p.get&lt; double &gt;(&quot;RandomXZShift&quot;, 0.))</div></div>
<div class="ttc" id="main_8cpp_html_a74a4d91774841c9e52baae57f0bd67d8"><div class="ttname"><a href="../../df/d0a/main_8cpp.html#a74a4d91774841c9e52baae57f0bd67d8">bounds</a></div><div class="ttdeci">BoundingBox bounds(int x, int y, int w, int h)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d0a/main_8cpp_source.html#l00037">main.cpp:37</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_a502d912c07fb0eb3cc0cc14e548b0bd5"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#a502d912c07fb0eb3cc0cc14e548b0bd5">evgen::CORSIKAGen::openDBs</a></div><div class="ttdeci">void openDBs(std::string const &amp;module_label)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00371">CORSIKAGen_module.cc:371</a></div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_ac8092f07c0302e1b1b49dd008e95963f"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#ac8092f07c0302e1b1b49dd008e95963f">evgen::CORSIKAGen::fShowerAreaExtension</a></div><div class="ttdeci">double fShowerAreaExtension</div><div class="ttdoc">Extend distribution of corsika particles in x,z by this much (e.g. 1000 will extend 10 m in -x...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00280">CORSIKAGen_module.cc:280</a></div></div>
<div class="ttc" id="Geometry_8h_html"><div class="ttname"><a href="../../d3/d8b/Geometry_8h.html">Geometry.h</a></div><div class="ttdoc">art framework interface to geometry description </div></div>
<div class="ttc" id="classevgen_1_1CORSIKAGen_html_a86c567dda3844f0ee4c57e6d9e3f44d0"><div class="ttname"><a href="../../db/d59/classevgen_1_1CORSIKAGen.html#a86c567dda3844f0ee4c57e6d9e3f44d0">evgen::CORSIKAGen::fBuffBox</a></div><div class="ttdeci">std::vector&lt; double &gt; fBuffBox</div><div class="ttdoc">Buffer box extensions to cryostat in each direction (6 of them: x_lo,x_hi,y_lo,y_hi,z_lo,z_hi) [cm]. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d97/CORSIKAGen__module_8cc_source.html#l00279">CORSIKAGen_module.cc:279</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
