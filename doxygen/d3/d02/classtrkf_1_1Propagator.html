<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>trkf::Propagator Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="../../hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="../../functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d0/da2/namespacetrkf.html">trkf</a></li><li class="navelem"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="../../da/d03/classtrkf_1_1Propagator-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">trkf::Propagator Class Reference<span class="mlabels"><span class="mlabel">abstract</span></span></div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../d2/df9/Propagator_8h_source.html">Propagator.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for trkf::Propagator:</div>
<div class="dyncontent">
 <div class="center">
  <img src="../../d3/d02/classtrkf_1_1Propagator.png" usemap="#trkf::Propagator_map" alt=""/>
  <map id="trkf::Propagator_map" name="trkf::Propagator_map">
<area href="../../d7/d4f/classtrkf_1_1PropAny.html" alt="trkf::PropAny" shape="rect" coords="0,56,122,80"/>
<area href="../../d6/d2a/classtrkf_1_1PropXYZPlane.html" alt="trkf::PropXYZPlane" shape="rect" coords="132,56,254,80"/>
<area href="../../dd/d97/classtrkf_1_1PropYZLine.html" alt="trkf::PropYZLine" shape="rect" coords="264,56,386,80"/>
<area href="../../d1/d34/classtrkf_1_1PropYZPlane.html" alt="trkf::PropYZPlane" shape="rect" coords="396,56,518,80"/>
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:af689f4b8a505b7a64dcd9c7e6c824354"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354">PropDirection</a> { <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">FORWARD</a>, 
<a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354abb50b9e012a19f7643321f6aa64ecb19">BACKWARD</a>, 
<a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185">UNKNOWN</a>
 }</td></tr>
<tr class="memdesc:af689f4b8a505b7a64dcd9c7e6c824354"><td class="mdescLeft">&#160;</td><td class="mdescRight">Propagation direction enum.  <a href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354">More...</a><br/></td></tr>
<tr class="separator:af689f4b8a505b7a64dcd9c7e6c824354"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:afa865cf0e5a4a6902cee0eabb7ddf28d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#afa865cf0e5a4a6902cee0eabb7ddf28d">Propagator</a> (<a class="el" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> const &amp;detProp, double tcut, bool doDedx, const std::shared_ptr&lt; const <a class="el" href="../../d2/d42/classtrkf_1_1Interactor.html">Interactor</a> &gt; &amp;interactor)</td></tr>
<tr class="memdesc:afa865cf0e5a4a6902cee0eabb7ddf28d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="#afa865cf0e5a4a6902cee0eabb7ddf28d">More...</a><br/></td></tr>
<tr class="separator:afa865cf0e5a4a6902cee0eabb7ddf28d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a354e6f68f457dfb7f9d7161237f9cf47"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#a354e6f68f457dfb7f9d7161237f9cf47">~Propagator</a> ()</td></tr>
<tr class="memdesc:a354e6f68f457dfb7f9d7161237f9cf47"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor.  <a href="#a354e6f68f457dfb7f9d7161237f9cf47">More...</a><br/></td></tr>
<tr class="separator:a354e6f68f457dfb7f9d7161237f9cf47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48d6265903c8bfb4cdf700d1dc348b9c"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#a48d6265903c8bfb4cdf700d1dc348b9c">getTcut</a> () const </td></tr>
<tr class="separator:a48d6265903c8bfb4cdf700d1dc348b9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a534f567afe81a5ad6493ea5ec806faf7"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#a534f567afe81a5ad6493ea5ec806faf7">getDoDedx</a> () const </td></tr>
<tr class="separator:a534f567afe81a5ad6493ea5ec806faf7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3569cd7985ec43c9e3978460692770e"><td class="memItemLeft" align="right" valign="top">const std::shared_ptr&lt; const <br class="typebreak"/>
<a class="el" href="../../d2/d42/classtrkf_1_1Interactor.html">Interactor</a> &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#ae3569cd7985ec43c9e3978460692770e">getInteractor</a> () const </td></tr>
<tr class="separator:ae3569cd7985ec43c9e3978460692770e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8cf8d56a9e0b99fc89ec4b9768d25b6"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#ad8cf8d56a9e0b99fc89ec4b9768d25b6">clone</a> () const =0</td></tr>
<tr class="memdesc:ad8cf8d56a9e0b99fc89ec4b9768d25b6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clone method.  <a href="#ad8cf8d56a9e0b99fc89ec4b9768d25b6">More...</a><br/></td></tr>
<tr class="separator:ad8cf8d56a9e0b99fc89ec4b9768d25b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b24c385021f90b82ea381be841bd74f"><td class="memItemLeft" align="right" valign="top">virtual std::optional&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#a2b24c385021f90b82ea381be841bd74f">short_vec_prop</a> (<a class="el" href="../../da/dcf/classtrkf_1_1KTrack.html">KTrack</a> &amp;trk, const std::shared_ptr&lt; const <a class="el" href="../../d5/d75/classtrkf_1_1Surface.html">Surface</a> &gt; &amp;psurf, <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354">PropDirection</a> <a class="el" href="../../d6/d91/make__tar__sbnd_8sh.html#aaf78092b2b7e15dcd60eda6328769a09">dir</a>, bool doDedx, <a class="el" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a> *prop_matrix=0, <a class="el" href="../../d0/da2/namespacetrkf.html#a20fcb423cfba1923040c27599fd3bf83">TrackError</a> *noise_matrix=0) const =0</td></tr>
<tr class="memdesc:a2b24c385021f90b82ea381be841bd74f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Propagate without error (short distance).  <a href="#a2b24c385021f90b82ea381be841bd74f">More...</a><br/></td></tr>
<tr class="separator:a2b24c385021f90b82ea381be841bd74f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a472d29b6704e2c6e3e1b247ffcfd5c37"><td class="memItemLeft" align="right" valign="top">virtual std::optional&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#a472d29b6704e2c6e3e1b247ffcfd5c37">origin_vec_prop</a> (<a class="el" href="../../da/dcf/classtrkf_1_1KTrack.html">KTrack</a> &amp;trk, const std::shared_ptr&lt; const <a class="el" href="../../d5/d75/classtrkf_1_1Surface.html">Surface</a> &gt; &amp;porient, <a class="el" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a> *prop_matrix=0) const =0</td></tr>
<tr class="memdesc:a472d29b6704e2c6e3e1b247ffcfd5c37"><td class="mdescLeft">&#160;</td><td class="mdescRight">Propagate without error to surface whose origin parameters coincide with track position.  <a href="#a472d29b6704e2c6e3e1b247ffcfd5c37">More...</a><br/></td></tr>
<tr class="separator:a472d29b6704e2c6e3e1b247ffcfd5c37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a444a373364319c1bb8fb18560b299940"><td class="memItemLeft" align="right" valign="top">std::optional&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#a444a373364319c1bb8fb18560b299940">vec_prop</a> (<a class="el" href="../../da/dcf/classtrkf_1_1KTrack.html">KTrack</a> &amp;trk, const std::shared_ptr&lt; const <a class="el" href="../../d5/d75/classtrkf_1_1Surface.html">Surface</a> &gt; &amp;psurf, <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354">PropDirection</a> <a class="el" href="../../d6/d91/make__tar__sbnd_8sh.html#aaf78092b2b7e15dcd60eda6328769a09">dir</a>, bool doDedx, <a class="el" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a> *prop_matrix=0, <a class="el" href="../../d0/da2/namespacetrkf.html#a20fcb423cfba1923040c27599fd3bf83">TrackError</a> *noise_matrix=0) const </td></tr>
<tr class="memdesc:a444a373364319c1bb8fb18560b299940"><td class="mdescLeft">&#160;</td><td class="mdescRight">Propagate without error (long distance).  <a href="#a444a373364319c1bb8fb18560b299940">More...</a><br/></td></tr>
<tr class="separator:a444a373364319c1bb8fb18560b299940"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c173b3f11a3c0dc7cb3496126ef86d8"><td class="memItemLeft" align="right" valign="top">std::optional&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#a8c173b3f11a3c0dc7cb3496126ef86d8">lin_prop</a> (<a class="el" href="../../da/dcf/classtrkf_1_1KTrack.html">KTrack</a> &amp;trk, const std::shared_ptr&lt; const <a class="el" href="../../d5/d75/classtrkf_1_1Surface.html">Surface</a> &gt; &amp;psurf, <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354">PropDirection</a> <a class="el" href="../../d6/d91/make__tar__sbnd_8sh.html#aaf78092b2b7e15dcd60eda6328769a09">dir</a>, bool doDedx, <a class="el" href="../../da/dcf/classtrkf_1_1KTrack.html">KTrack</a> *ref=0, <a class="el" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a> *prop_matrix=0, <a class="el" href="../../d0/da2/namespacetrkf.html#a20fcb423cfba1923040c27599fd3bf83">TrackError</a> *noise_matrix=0) const </td></tr>
<tr class="memdesc:a8c173b3f11a3c0dc7cb3496126ef86d8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Linearized propagate without error.  <a href="#a8c173b3f11a3c0dc7cb3496126ef86d8">More...</a><br/></td></tr>
<tr class="separator:a8c173b3f11a3c0dc7cb3496126ef86d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a694d53ff0305f7069a9184c06c8c7f9c"><td class="memItemLeft" align="right" valign="top">std::optional&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#a694d53ff0305f7069a9184c06c8c7f9c">err_prop</a> (<a class="el" href="../../df/db0/classtrkf_1_1KETrack.html">KETrack</a> &amp;tre, const std::shared_ptr&lt; const <a class="el" href="../../d5/d75/classtrkf_1_1Surface.html">Surface</a> &gt; &amp;psurf, <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354">PropDirection</a> <a class="el" href="../../d6/d91/make__tar__sbnd_8sh.html#aaf78092b2b7e15dcd60eda6328769a09">dir</a>, bool doDedx, <a class="el" href="../../da/dcf/classtrkf_1_1KTrack.html">KTrack</a> *ref=0, <a class="el" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a> *prop_matrix=0) const </td></tr>
<tr class="memdesc:a694d53ff0305f7069a9184c06c8c7f9c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Propagate with error, but without noise.  <a href="#a694d53ff0305f7069a9184c06c8c7f9c">More...</a><br/></td></tr>
<tr class="separator:a694d53ff0305f7069a9184c06c8c7f9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56af27956ea9aeab1f463d63b024f718"><td class="memItemLeft" align="right" valign="top">std::optional&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#a56af27956ea9aeab1f463d63b024f718">noise_prop</a> (<a class="el" href="../../df/db0/classtrkf_1_1KETrack.html">KETrack</a> &amp;tre, const std::shared_ptr&lt; const <a class="el" href="../../d5/d75/classtrkf_1_1Surface.html">Surface</a> &gt; &amp;psurf, <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354">PropDirection</a> <a class="el" href="../../d6/d91/make__tar__sbnd_8sh.html#aaf78092b2b7e15dcd60eda6328769a09">dir</a>, bool doDedx, <a class="el" href="../../da/dcf/classtrkf_1_1KTrack.html">KTrack</a> *ref=0) const </td></tr>
<tr class="memdesc:a56af27956ea9aeab1f463d63b024f718"><td class="mdescLeft">&#160;</td><td class="mdescRight">Propagate with error and noise.  <a href="#a56af27956ea9aeab1f463d63b024f718">More...</a><br/></td></tr>
<tr class="separator:a56af27956ea9aeab1f463d63b024f718"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02829d354fd25273d014e3ebda41ae5c"><td class="memItemLeft" align="right" valign="top">std::optional&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#a02829d354fd25273d014e3ebda41ae5c">dedx_prop</a> (double pinv, double mass, double <a class="el" href="../../dd/dea/fix__cmake__genie3_8pl.html#a3691308f2a4c2f6983f2880d32e29c84">s</a>, double *deriv=0) const </td></tr>
<tr class="memdesc:a02829d354fd25273d014e3ebda41ae5c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Method to calculate updated momentum due to dE/dx.  <a href="#a02829d354fd25273d014e3ebda41ae5c">More...</a><br/></td></tr>
<tr class="separator:a02829d354fd25273d014e3ebda41ae5c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a2c9ef992609012f768b089a63ecdb2ad"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <br class="typebreak"/>
const &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#a2c9ef992609012f768b089a63ecdb2ad">fDetProp</a></td></tr>
<tr class="separator:a2c9ef992609012f768b089a63ecdb2ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36f0b019ab2da59ce8066e84f67e6c4c"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#a36f0b019ab2da59ce8066e84f67e6c4c">fTcut</a></td></tr>
<tr class="memdesc:a36f0b019ab2da59ce8066e84f67e6c4c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum delta ray energy for dE/dx.  <a href="#a36f0b019ab2da59ce8066e84f67e6c4c">More...</a><br/></td></tr>
<tr class="separator:a36f0b019ab2da59ce8066e84f67e6c4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a101374f6b56772f619c188a0027968f0"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#a101374f6b56772f619c188a0027968f0">fDoDedx</a></td></tr>
<tr class="memdesc:a101374f6b56772f619c188a0027968f0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Energy loss enable flag.  <a href="#a101374f6b56772f619c188a0027968f0">More...</a><br/></td></tr>
<tr class="separator:a101374f6b56772f619c188a0027968f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af21c69a72fe709a4fc9994ed1c2d02ec"><td class="memItemLeft" align="right" valign="top">std::shared_ptr&lt; const <a class="el" href="../../d2/d42/classtrkf_1_1Interactor.html">Interactor</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#af21c69a72fe709a4fc9994ed1c2d02ec">fInteractor</a></td></tr>
<tr class="memdesc:af21c69a72fe709a4fc9994ed1c2d02ec"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="../../d2/d42/classtrkf_1_1Interactor.html">Interactor</a> (for calculating noise).  <a href="#af21c69a72fe709a4fc9994ed1c2d02ec">More...</a><br/></td></tr>
<tr class="separator:af21c69a72fe709a4fc9994ed1c2d02ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="../../d2/df9/Propagator_8h_source.html#l00091">91</a> of file <a class="el" href="../../d2/df9/Propagator_8h_source.html">Propagator.h</a>.</p>
</div><h2 class="groupheader">Member Enumeration Documentation</h2>
<a class="anchor" id="af689f4b8a505b7a64dcd9c7e6c824354"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354">trkf::Propagator::PropDirection</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Propagation direction enum. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><em><a class="anchor" id="af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed"></a>FORWARD</em>&nbsp;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="af689f4b8a505b7a64dcd9c7e6c824354abb50b9e012a19f7643321f6aa64ecb19"></a>BACKWARD</em>&nbsp;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185"></a>UNKNOWN</em>&nbsp;</td><td class="fielddoc">
</td></tr>
</table>

<p>Definition at line <a class="el" href="../../d2/df9/Propagator_8h_source.html#l00094">94</a> of file <a class="el" href="../../d2/df9/Propagator_8h_source.html">Propagator.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;{ <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">FORWARD</a>, <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354abb50b9e012a19f7643321f6aa64ecb19">BACKWARD</a>, <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185">UNKNOWN</a> };</div>
<div class="ttc" id="classtrkf_1_1Propagator_html_af689f4b8a505b7a64dcd9c7e6c824354abb50b9e012a19f7643321f6aa64ecb19"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354abb50b9e012a19f7643321f6aa64ecb19">trkf::Propagator::BACKWARD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00094">Propagator.h:94</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185">trkf::Propagator::UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00094">Propagator.h:94</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">trkf::Propagator::FORWARD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00094">Propagator.h:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="afa865cf0e5a4a6902cee0eabb7ddf28d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">trkf::Propagator::Propagator </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> const &amp;&#160;</td>
          <td class="paramname"><em>detProp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>tcut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>doDedx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::shared_ptr&lt; const <a class="el" href="../../d2/d42/classtrkf_1_1Interactor.html">Interactor</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>interactor</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor. </p>
<p>Constructor.</p>
<p>Arguments:</p>
<p>tcut - Maximum delta ray energy. doDedx - dE/dx enable flag. </p>

<p>Definition at line <a class="el" href="../../d8/dee/Propagator_8cxx_source.html#l00026">26</a> of file <a class="el" href="../../d8/dee/Propagator_8cxx_source.html">Propagator.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    : <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#a2c9ef992609012f768b089a63ecdb2ad">fDetProp</a>{<a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>}, <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#a36f0b019ab2da59ce8066e84f67e6c4c">fTcut</a>(tcut), <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#a101374f6b56772f619c188a0027968f0">fDoDedx</a>(doDedx), <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af21c69a72fe709a4fc9994ed1c2d02ec">fInteractor</a>(interactor)</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  {}</div>
<div class="ttc" id="classtrkf_1_1Propagator_html_a36f0b019ab2da59ce8066e84f67e6c4c"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#a36f0b019ab2da59ce8066e84f67e6c4c">trkf::Propagator::fTcut</a></div><div class="ttdeci">double fTcut</div><div class="ttdoc">Maximum delta ray energy for dE/dx. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00177">Propagator.h:177</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_a2c9ef992609012f768b089a63ecdb2ad"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#a2c9ef992609012f768b089a63ecdb2ad">trkf::Propagator::fDetProp</a></div><div class="ttdeci">detinfo::DetectorPropertiesData const &amp; fDetProp</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00176">Propagator.h:176</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_af21c69a72fe709a4fc9994ed1c2d02ec"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#af21c69a72fe709a4fc9994ed1c2d02ec">trkf::Propagator::fInteractor</a></div><div class="ttdeci">std::shared_ptr&lt; const Interactor &gt; fInteractor</div><div class="ttdoc">Interactor (for calculating noise). </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00179">Propagator.h:179</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_a101374f6b56772f619c188a0027968f0"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#a101374f6b56772f619c188a0027968f0">trkf::Propagator::fDoDedx</a></div><div class="ttdeci">bool fDoDedx</div><div class="ttdoc">Energy loss enable flag. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00178">Propagator.h:178</a></div></div>
<div class="ttc" id="namespacedetsim_html_a560adbb3abf95a23d45a53ed25d8c0c7"><div class="ttname"><a href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detsim::detProp</a></div><div class="ttdeci">auto const detProp</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/SimWire__module_8cc_source.html#l00157">SimWire_module.cc:157</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a354e6f68f457dfb7f9d7161237f9cf47"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">trkf::Propagator::~Propagator </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span><span class="mlabel">default</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Destructor. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="ad8cf8d56a9e0b99fc89ec4b9768d25b6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a>* trkf::Propagator::clone </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Clone method. </p>

<p>Implemented in <a class="el" href="../../d7/d4f/classtrkf_1_1PropAny.html#a3b91bdc0d7763e53057d8e82ce1487e7">trkf::PropAny</a>, <a class="el" href="../../d6/d2a/classtrkf_1_1PropXYZPlane.html#afc8cd17469e8d516f0c9fc00efe4d6c2">trkf::PropXYZPlane</a>, <a class="el" href="../../d1/d34/classtrkf_1_1PropYZPlane.html#a4cd4e33c7a34641984f547d5c1217318">trkf::PropYZPlane</a>, and <a class="el" href="../../dd/d97/classtrkf_1_1PropYZLine.html#a0e0898e167ea2263f48b80130bfa5890">trkf::PropYZLine</a>.</p>

</div>
</div>
<a class="anchor" id="a02829d354fd25273d014e3ebda41ae5c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::optional&lt; double &gt; trkf::Propagator::dedx_prop </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>pinv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>mass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>deriv</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Method to calculate updated momentum due to dE/dx. </p>
<p>Method to calculate updated momentum due to dE/dx.</p>
<p>Arguments:</p>
<p>pinv - Initial inverse momentum (units c/GeV). mass - Particle mass (GeV/c^2). s - Path distance. deriv - Pointer to store derivative d(pinv2)/d(pinv1) if nonzero.</p>
<p>Returns: Final inverse momentum (pinv2) + success flag.</p>
<p>Failure is returned in case of range out.</p>
<p>Inverse momentum can be signed (q/p). Returned inverse momentum has the same sign as the input.</p>
<p>In this method, we are solving the differential equation in terms of energy.</p>
<p>dE/dx = -f(E)</p>
<p>where f(E) is the stopping power returned by method LArProperties::Eloss.</p>
<p>We expect that this method will be called exclusively for short distance propagation. The differential equation is solved using the midpoint method using a single step, which requires two evaluations of f(E).</p>
<p>dE = -s*f(E1) E2 = E1 - s*f(E1 + 0.5*dE)</p>
<p>The derivative is calculated assuming E2 = E1 + constant, giving</p>
<p>d(pinv2)/d(pinv1) = pinv2^3 E2 / (pinv1^3 E1). </p>

<p>Definition at line <a class="el" href="../../d8/dee/Propagator_8cxx_source.html#l00452">452</a> of file <a class="el" href="../../d8/dee/Propagator_8cxx_source.html">Propagator.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="comment">// For infinite initial momentum, return with success status,</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="comment">// still infinite momentum.</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordflow">if</span> (pinv == 0.) <span class="keywordflow">return</span> std::make_optional(0.);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="comment">// Set the default return value to be uninitialized with value 0.</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    std::optional&lt;double&gt; result{std::nullopt};</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="comment">// Calculate final energy.</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a> = 1. / <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(pinv);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../d1/dbb/test__associatedgroups__full_8fcl.html#a07fbfef6c53a7ed684db7d9f21876cb8">e1</a> = std::hypot(p1, <a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">mass</a>);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keywordtype">double</span> de = -0.001 * <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> * <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#a2c9ef992609012f768b089a63ecdb2ad">fDetProp</a>.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a579732df4f5e4719435325f065be345f">Eloss</a>(p1, <a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">mass</a>, <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#a36f0b019ab2da59ce8066e84f67e6c4c">fTcut</a>);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordtype">double</span> emid = e1 + 0.5 * de;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordflow">if</span> (emid &gt; <a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">mass</a>) {</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      <span class="keywordtype">double</span> pmid = std::sqrt(emid * emid - <a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">mass</a> * <a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">mass</a>);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      <span class="keywordtype">double</span> e2 = e1 - 0.001 * <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> * <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#a2c9ef992609012f768b089a63ecdb2ad">fDetProp</a>.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a579732df4f5e4719435325f065be345f">Eloss</a>(pmid, <a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">mass</a>, <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#a36f0b019ab2da59ce8066e84f67e6c4c">fTcut</a>);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      <span class="keywordflow">if</span> (e2 &gt; <a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">mass</a>) {</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <span class="keywordtype">double</span> p2 = std::sqrt(e2 * e2 - <a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">mass</a> * <a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">mass</a>);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        <span class="keywordtype">double</span> pinv2 = 1. / p2;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="keywordflow">if</span> (pinv &lt; 0.) pinv2 = -pinv2;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <span class="comment">// Calculation was successful, update result.</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        result = std::make_optional(pinv2);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <span class="comment">// Also calculate derivative, if requested.</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="keywordflow">if</span> (deriv != 0) *deriv = pinv2 * pinv2 * pinv2 * e2 / (pinv * pinv * pinv * <a class="code" href="../../d1/dbb/test__associatedgroups__full_8fcl.html#a07fbfef6c53a7ed684db7d9f21876cb8">e1</a>);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      }</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    }</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="comment">// Done.</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  }</div>
<div class="ttc" id="classtrkf_1_1Propagator_html_a36f0b019ab2da59ce8066e84f67e6c4c"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#a36f0b019ab2da59ce8066e84f67e6c4c">trkf::Propagator::fTcut</a></div><div class="ttdeci">double fTcut</div><div class="ttdoc">Maximum delta ray energy for dE/dx. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00177">Propagator.h:177</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_a2c9ef992609012f768b089a63ecdb2ad"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#a2c9ef992609012f768b089a63ecdb2ad">trkf::Propagator::fDetProp</a></div><div class="ttdeci">detinfo::DetectorPropertiesData const &amp; fDetProp</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00176">Propagator.h:176</a></div></div>
<div class="ttc" id="sparse__vector__test_8cc_html_a39f16bf854ba527dee7eba5bbbd93f3f"><div class="ttname"><a href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a></div><div class="ttdeci">T abs(T value)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d59/sparse__vector__test_8cc_source.html#l00030">sparse_vector_test.cc:30</a></div></div>
<div class="ttc" id="classdetinfo_1_1DetectorPropertiesData_html_a579732df4f5e4719435325f065be345f"><div class="ttname"><a href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a579732df4f5e4719435325f065be345f">detinfo::DetectorPropertiesData::Eloss</a></div><div class="ttdeci">double Eloss(double mom, double mass, double tcut) const </div><div class="ttdoc">Restricted mean energy loss (dE/dx) </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d64/DetectorPropertiesData_8cc_source.html#l00087">DetectorPropertiesData.cc:87</a></div></div>
<div class="ttc" id="file__to__url_8sh_html_a096ad3d3698082826189c839d7a6e46f"><div class="ttname"><a href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a></div><div class="ttdeci">then echo File list $list not found else cat $list while read file do echo $file sed s</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dea/file__to__url_8sh_source.html#l00060">file_to_url.sh:60</a></div></div>
<div class="ttc" id="namespacelib_1_1dedx_html_af9508f78ba8143119daa95dbd8220f91"><div class="ttname"><a href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">lib.dedx.mass</a></div><div class="ttdeci">float mass</div><div class="ttdef"><b>Definition:</b> <a href="../../df/df9/dedx_8py_source.html#l00047">dedx.py:47</a></div></div>
<div class="ttc" id="test__associatedgroups__full_8fcl_html_a07fbfef6c53a7ed684db7d9f21876cb8"><div class="ttname"><a href="../../d1/dbb/test__associatedgroups__full_8fcl.html#a07fbfef6c53a7ed684db7d9f21876cb8">e1</a></div><div class="ttdeci">physics pm2 e1</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dbb/test__associatedgroups__full_8fcl_source.html#l00028">test_associatedgroups_full.fcl:28</a></div></div>
<div class="ttc" id="test__associatedgroupswithleft__full_8fcl_html_a4814f2598ed6acdb806473d732f33889"><div class="ttname"><a href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a></div><div class="ttdeci">physics associatedGroupsWithLeft p1</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dab/test__associatedgroupswithleft__full_8fcl_source.html#l00024">test_associatedgroupswithleft_full.fcl:24</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a694d53ff0305f7069a9184c06c8c7f9c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::optional&lt; double &gt; trkf::Propagator::err_prop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/db0/classtrkf_1_1KETrack.html">KETrack</a> &amp;&#160;</td>
          <td class="paramname"><em>tre</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::shared_ptr&lt; const <a class="el" href="../../d5/d75/classtrkf_1_1Surface.html">Surface</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>psurf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354">PropDirection</a>&#160;</td>
          <td class="paramname"><em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>doDedx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../da/dcf/classtrkf_1_1KTrack.html">KTrack</a> *&#160;</td>
          <td class="paramname"><em>ref</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a> *&#160;</td>
          <td class="paramname"><em>prop_matrix</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Propagate with error, but without noise. </p>
<p>Propagate with error, but without noise (i.e. reversibly).</p>
<p>Arguments:</p>
<p>tre - <a class="el" href="../../d4/d66/structTrack.html">Track</a> to propagate. psurf - Destination surface. dir - Propagation direction (FORWARD, BACKWARD, or UNKNOWN). doDedx - dE/dx enable/disable flag. ref - Reference track (for linearized propagation). Can be null. prop_matrix - Return propagation matrix if not null.</p>
<p>Returned value: propagation distance + success flag. </p>

<p>Definition at line <a class="el" href="../../d8/dee/Propagator_8cxx_source.html#l00346">346</a> of file <a class="el" href="../../d8/dee/Propagator_8cxx_source.html">Propagator.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  {</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="comment">// Propagate without error, get propagation matrix.</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <a class="code" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a> prop_temp;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">if</span> (prop_matrix == 0) prop_matrix = &amp;prop_temp;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    std::optional&lt;double&gt; result = <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#a8c173b3f11a3c0dc7cb3496126ef86d8">lin_prop</a>(tre, psurf, <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>, doDedx, ref, prop_matrix, 0);</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="comment">// If propagation succeeded, update track error matrix.</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordflow">if</span> (!!result) {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      <a class="code" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a> temp = prod(tre.getError(), trans(*prop_matrix));</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <a class="code" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a> temp2 = prod(*prop_matrix, temp);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      <a class="code" href="../../d0/da2/namespacetrkf.html#a20fcb423cfba1923040c27599fd3bf83">TrackError</a> newerr = ublas::symmetric_adaptor&lt;TrackMatrix&gt;(temp2);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      tre.setError(newerr);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="comment">// Done.</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  }</div>
<div class="ttc" id="namespacetrkf_html_a20fcb423cfba1923040c27599fd3bf83"><div class="ttname"><a href="../../d0/da2/namespacetrkf.html#a20fcb423cfba1923040c27599fd3bf83">trkf::TrackError</a></div><div class="ttdeci">KSymMatrix&lt; 5 &gt;::type TrackError</div><div class="ttdoc">Track error matrix, dimension 5x5. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d7d/KalmanLinearAlgebra_8h_source.html#l00093">KalmanLinearAlgebra.h:93</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_a8c173b3f11a3c0dc7cb3496126ef86d8"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#a8c173b3f11a3c0dc7cb3496126ef86d8">trkf::Propagator::lin_prop</a></div><div class="ttdeci">std::optional&lt; double &gt; lin_prop(KTrack &amp;trk, const std::shared_ptr&lt; const Surface &gt; &amp;psurf, PropDirection dir, bool doDedx, KTrack *ref=0, TrackMatrix *prop_matrix=0, TrackError *noise_matrix=0) const </div><div class="ttdoc">Linearized propagate without error. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dee/Propagator_8cxx_source.html#l00251">Propagator.cxx:251</a></div></div>
<div class="ttc" id="namespacedropbox_html_a407b5b895ba9265893768748aaa73825"><div class="ttname"><a href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dropbox.dir</a></div><div class="ttdeci">tuple dir</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d81/dropbox_8py_source.html#l00028">dropbox.py:28</a></div></div>
<div class="ttc" id="namespacetrkf_html_a45c422ac0674450193fc9f6549757f4f"><div class="ttname"><a href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">trkf::TrackMatrix</a></div><div class="ttdeci">KMatrix&lt; 5, 5 &gt;::type TrackMatrix</div><div class="ttdoc">General 5x5 matrix. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d7d/KalmanLinearAlgebra_8h_source.html#l00096">KalmanLinearAlgebra.h:96</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a534f567afe81a5ad6493ea5ec806faf7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::Propagator::getDoDedx </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d2/df9/Propagator_8h_source.html#l00113">113</a> of file <a class="el" href="../../d2/df9/Propagator_8h_source.html">Propagator.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#a101374f6b56772f619c188a0027968f0">fDoDedx</a>;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    }</div>
<div class="ttc" id="classtrkf_1_1Propagator_html_a101374f6b56772f619c188a0027968f0"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#a101374f6b56772f619c188a0027968f0">trkf::Propagator::fDoDedx</a></div><div class="ttdeci">bool fDoDedx</div><div class="ttdoc">Energy loss enable flag. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00178">Propagator.h:178</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae3569cd7985ec43c9e3978460692770e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const std::shared_ptr&lt;const <a class="el" href="../../d2/d42/classtrkf_1_1Interactor.html">Interactor</a>&gt;&amp; trkf::Propagator::getInteractor </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d2/df9/Propagator_8h_source.html#l00118">118</a> of file <a class="el" href="../../d2/df9/Propagator_8h_source.html">Propagator.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    {</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af21c69a72fe709a4fc9994ed1c2d02ec">fInteractor</a>;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    }</div>
<div class="ttc" id="classtrkf_1_1Propagator_html_af21c69a72fe709a4fc9994ed1c2d02ec"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#af21c69a72fe709a4fc9994ed1c2d02ec">trkf::Propagator::fInteractor</a></div><div class="ttdeci">std::shared_ptr&lt; const Interactor &gt; fInteractor</div><div class="ttdoc">Interactor (for calculating noise). </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00179">Propagator.h:179</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a48d6265903c8bfb4cdf700d1dc348b9c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double trkf::Propagator::getTcut </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d2/df9/Propagator_8h_source.html#l00108">108</a> of file <a class="el" href="../../d2/df9/Propagator_8h_source.html">Propagator.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#a36f0b019ab2da59ce8066e84f67e6c4c">fTcut</a>;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    }</div>
<div class="ttc" id="classtrkf_1_1Propagator_html_a36f0b019ab2da59ce8066e84f67e6c4c"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#a36f0b019ab2da59ce8066e84f67e6c4c">trkf::Propagator::fTcut</a></div><div class="ttdeci">double fTcut</div><div class="ttdoc">Maximum delta ray energy for dE/dx. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00177">Propagator.h:177</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8c173b3f11a3c0dc7cb3496126ef86d8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::optional&lt; double &gt; trkf::Propagator::lin_prop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../da/dcf/classtrkf_1_1KTrack.html">KTrack</a> &amp;&#160;</td>
          <td class="paramname"><em>trk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::shared_ptr&lt; const <a class="el" href="../../d5/d75/classtrkf_1_1Surface.html">Surface</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>psurf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354">PropDirection</a>&#160;</td>
          <td class="paramname"><em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>doDedx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../da/dcf/classtrkf_1_1KTrack.html">KTrack</a> *&#160;</td>
          <td class="paramname"><em>ref</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a> *&#160;</td>
          <td class="paramname"><em>prop_matrix</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/da2/namespacetrkf.html#a20fcb423cfba1923040c27599fd3bf83">TrackError</a> *&#160;</td>
          <td class="paramname"><em>noise_matrix</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Linearized propagate without error. </p>
<p>Linearized propagate without error.</p>
<p>Arguments:</p>
<p>trk - <a class="el" href="../../d4/d66/structTrack.html">Track</a> to propagate. psurf - Destination surface. dir - Propagation direction (FORWARD, BACKWARD, or UNKNOWN). doDedx - dE/dx enable/disable flag. ref - Reference track (for linearized propagation). Can be null. prop_matrix - Return propagation matrix if not null. noise_matrix - Return noise matrix if not null.</p>
<p>Returned value: Propagation distance &amp; success flag.</p>
<p>If the reference track is null, this method simply calls vec_prop. </p>

<p>Definition at line <a class="el" href="../../d8/dee/Propagator_8cxx_source.html#l00251">251</a> of file <a class="el" href="../../d8/dee/Propagator_8cxx_source.html">Propagator.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  {</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="comment">// Default result.</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    std::optional&lt;double&gt; result;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">if</span> (ref == 0)</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      result = <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#a444a373364319c1bb8fb18560b299940">vec_prop</a>(trk, psurf, <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>, doDedx, prop_matrix, noise_matrix);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      <span class="comment">// A reference track has been provided.</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      <span class="comment">// It is an error (throw exception) if the reference track and</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="comment">// the track to be propagted are not on the same surface.</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <span class="keywordflow">if</span> (!trk.getSurface()-&gt;isEqual(*(ref-&gt;getSurface())))</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;Propagator&quot;</span>)</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Input track and reference track not on same surface.\n&quot;</span>;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="comment">// Remember the starting track and reference track.</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      KTrack trk0(trk);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      KTrack ref0(*ref);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="comment">// Propagate the reference track.  Make sure we calculate the</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="comment">// propagation matrix.</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      <a class="code" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a> prop_temp;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="keywordflow">if</span> (prop_matrix == 0) prop_matrix = &amp;prop_temp;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      <span class="comment">// Do the propgation.  The returned result will be the result of</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <span class="comment">// this propagatrion.</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      result = <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#a444a373364319c1bb8fb18560b299940">vec_prop</a>(*ref, psurf, <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>, doDedx, prop_matrix, noise_matrix);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="keywordflow">if</span> (!!result) {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <span class="comment">// Propagation of reference track succeeded.  Update the track</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="comment">// state vector and surface of the track to be propagated.</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <a class="code" href="../../d0/da2/namespacetrkf.html#a555831e3768c272dc5eb7be07c1bf96b">TrackVector</a> diff = trk.getSurface()-&gt;getDiff(trk.getVector(), ref0.getVector());</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <a class="code" href="../../d0/da2/namespacetrkf.html#a555831e3768c272dc5eb7be07c1bf96b">TrackVector</a> newvec = ref-&gt;getVector() + prod(*prop_matrix, diff);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="comment">// Store updated state vector and surface.</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        trk.setVector(newvec);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        trk.setSurface(psurf);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        trk.setDirection(ref-&gt;getDirection());</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordflow">if</span> (!trk.getSurface()-&gt;isEqual(*(ref-&gt;getSurface())))</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;          <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;Propagator&quot;</span>) &lt;&lt; __func__ &lt;&lt; <span class="stringliteral">&quot;: surface mismatch&quot;</span>;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="comment">// Final validity check.  In case of failure, restore the track</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="comment">// and reference track to their starting values.</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        <span class="keywordflow">if</span> (!trk.isValid()) {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;          result = std::nullopt;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;          trk = trk0;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;          *ref = ref0;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      }</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="comment">// Propagation failed.</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="comment">// Restore the reference track to its starting value, so that we ensure</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="comment">// the reference track and the actual track remain on the same surface.</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        trk = trk0;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        *ref = ref0;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      }</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="comment">// Done.</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  }</div>
<div class="ttc" id="classtrkf_1_1Propagator_html_a444a373364319c1bb8fb18560b299940"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#a444a373364319c1bb8fb18560b299940">trkf::Propagator::vec_prop</a></div><div class="ttdeci">std::optional&lt; double &gt; vec_prop(KTrack &amp;trk, const std::shared_ptr&lt; const Surface &gt; &amp;psurf, PropDirection dir, bool doDedx, TrackMatrix *prop_matrix=0, TrackError *noise_matrix=0) const </div><div class="ttdoc">Propagate without error (long distance). </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dee/Propagator_8cxx_source.html#l00053">Propagator.cxx:53</a></div></div>
<div class="ttc" id="namespacetrkf_html_a555831e3768c272dc5eb7be07c1bf96b"><div class="ttname"><a href="../../d0/da2/namespacetrkf.html#a555831e3768c272dc5eb7be07c1bf96b">trkf::TrackVector</a></div><div class="ttdeci">KVector&lt; 5 &gt;::type TrackVector</div><div class="ttdoc">Track state vector, dimension 5. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d7d/KalmanLinearAlgebra_8h_source.html#l00090">KalmanLinearAlgebra.h:90</a></div></div>
<div class="ttc" id="namespacedropbox_html_a407b5b895ba9265893768748aaa73825"><div class="ttname"><a href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dropbox.dir</a></div><div class="ttdeci">tuple dir</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d81/dropbox_8py_source.html#l00028">dropbox.py:28</a></div></div>
<div class="ttc" id="namespacetrkf_html_a45c422ac0674450193fc9f6549757f4f"><div class="ttname"><a href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">trkf::TrackMatrix</a></div><div class="ttdeci">KMatrix&lt; 5, 5 &gt;::type TrackMatrix</div><div class="ttdoc">General 5x5 matrix. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d7d/KalmanLinearAlgebra_8h_source.html#l00096">KalmanLinearAlgebra.h:96</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a56af27956ea9aeab1f463d63b024f718"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::optional&lt; double &gt; trkf::Propagator::noise_prop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/db0/classtrkf_1_1KETrack.html">KETrack</a> &amp;&#160;</td>
          <td class="paramname"><em>tre</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::shared_ptr&lt; const <a class="el" href="../../d5/d75/classtrkf_1_1Surface.html">Surface</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>psurf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354">PropDirection</a>&#160;</td>
          <td class="paramname"><em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>doDedx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../da/dcf/classtrkf_1_1KTrack.html">KTrack</a> *&#160;</td>
          <td class="paramname"><em>ref</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Propagate with error and noise. </p>
<p>Propagate with error and noise.</p>
<p>Arguments:</p>
<p>tre - <a class="el" href="../../d4/d66/structTrack.html">Track</a> to propagate. psurf - Destination surface. dir - Propagation direction (FORWARD, BACKWARD, or UNKNOWN). doDedx - dE/dx enable/disable flag. ref - Reference track (for linearized propagation). Can be null.</p>
<p>Returned value: propagation distance + success flag. </p>

<p>Definition at line <a class="el" href="../../d8/dee/Propagator_8cxx_source.html#l00386">386</a> of file <a class="el" href="../../d8/dee/Propagator_8cxx_source.html">Propagator.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  {</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="comment">// Propagate without error, get propagation matrix and noise matrix.</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <a class="code" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a> prop_matrix;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <a class="code" href="../../d0/da2/namespacetrkf.html#a20fcb423cfba1923040c27599fd3bf83">TrackError</a> noise_matrix;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    std::optional&lt;double&gt; result =</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#a8c173b3f11a3c0dc7cb3496126ef86d8">lin_prop</a>(tre, psurf, <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>, doDedx, ref, &amp;prop_matrix, &amp;noise_matrix);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="comment">// If propagation succeeded, update track error matrix.</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordflow">if</span> (!!result) {</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      <a class="code" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a> temp = prod(tre.getError(), trans(prop_matrix));</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      <a class="code" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a> temp2 = prod(prop_matrix, temp);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <a class="code" href="../../d0/da2/namespacetrkf.html#a20fcb423cfba1923040c27599fd3bf83">TrackError</a> newerr = ublas::symmetric_adaptor&lt;TrackMatrix&gt;(temp2);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      newerr += noise_matrix;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      tre.setError(newerr);</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    }</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="comment">// Done.</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  }</div>
<div class="ttc" id="namespacetrkf_html_a20fcb423cfba1923040c27599fd3bf83"><div class="ttname"><a href="../../d0/da2/namespacetrkf.html#a20fcb423cfba1923040c27599fd3bf83">trkf::TrackError</a></div><div class="ttdeci">KSymMatrix&lt; 5 &gt;::type TrackError</div><div class="ttdoc">Track error matrix, dimension 5x5. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d7d/KalmanLinearAlgebra_8h_source.html#l00093">KalmanLinearAlgebra.h:93</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_a8c173b3f11a3c0dc7cb3496126ef86d8"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#a8c173b3f11a3c0dc7cb3496126ef86d8">trkf::Propagator::lin_prop</a></div><div class="ttdeci">std::optional&lt; double &gt; lin_prop(KTrack &amp;trk, const std::shared_ptr&lt; const Surface &gt; &amp;psurf, PropDirection dir, bool doDedx, KTrack *ref=0, TrackMatrix *prop_matrix=0, TrackError *noise_matrix=0) const </div><div class="ttdoc">Linearized propagate without error. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dee/Propagator_8cxx_source.html#l00251">Propagator.cxx:251</a></div></div>
<div class="ttc" id="namespacedropbox_html_a407b5b895ba9265893768748aaa73825"><div class="ttname"><a href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dropbox.dir</a></div><div class="ttdeci">tuple dir</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d81/dropbox_8py_source.html#l00028">dropbox.py:28</a></div></div>
<div class="ttc" id="namespacetrkf_html_a45c422ac0674450193fc9f6549757f4f"><div class="ttname"><a href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">trkf::TrackMatrix</a></div><div class="ttdeci">KMatrix&lt; 5, 5 &gt;::type TrackMatrix</div><div class="ttdoc">General 5x5 matrix. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d7d/KalmanLinearAlgebra_8h_source.html#l00096">KalmanLinearAlgebra.h:96</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a472d29b6704e2c6e3e1b247ffcfd5c37"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual std::optional&lt;double&gt; trkf::Propagator::origin_vec_prop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../da/dcf/classtrkf_1_1KTrack.html">KTrack</a> &amp;&#160;</td>
          <td class="paramname"><em>trk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::shared_ptr&lt; const <a class="el" href="../../d5/d75/classtrkf_1_1Surface.html">Surface</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>porient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a> *&#160;</td>
          <td class="paramname"><em>prop_matrix</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Propagate without error to surface whose origin parameters coincide with track position. </p>

<p>Implemented in <a class="el" href="../../d7/d4f/classtrkf_1_1PropAny.html#a32834bcf9e118cf3ed1cb1fcc0b5e4f7">trkf::PropAny</a>, <a class="el" href="../../d6/d2a/classtrkf_1_1PropXYZPlane.html#aed6aa3630fd598a158a35a488a0c5901">trkf::PropXYZPlane</a>, <a class="el" href="../../d1/d34/classtrkf_1_1PropYZPlane.html#a3c0e967a1f23eae785fe2a5ccb457703">trkf::PropYZPlane</a>, and <a class="el" href="../../dd/d97/classtrkf_1_1PropYZLine.html#a5b2fc4db2092a6a55607fc712f4db578">trkf::PropYZLine</a>.</p>

</div>
</div>
<a class="anchor" id="a2b24c385021f90b82ea381be841bd74f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual std::optional&lt;double&gt; trkf::Propagator::short_vec_prop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../da/dcf/classtrkf_1_1KTrack.html">KTrack</a> &amp;&#160;</td>
          <td class="paramname"><em>trk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::shared_ptr&lt; const <a class="el" href="../../d5/d75/classtrkf_1_1Surface.html">Surface</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>psurf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354">PropDirection</a>&#160;</td>
          <td class="paramname"><em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>doDedx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a> *&#160;</td>
          <td class="paramname"><em>prop_matrix</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/da2/namespacetrkf.html#a20fcb423cfba1923040c27599fd3bf83">TrackError</a> *&#160;</td>
          <td class="paramname"><em>noise_matrix</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Propagate without error (short distance). </p>

<p>Implemented in <a class="el" href="../../d7/d4f/classtrkf_1_1PropAny.html#a7459aa7743da46e025fdac4ff6422c0c">trkf::PropAny</a>, <a class="el" href="../../d6/d2a/classtrkf_1_1PropXYZPlane.html#a6146273c23dda9ceb263ddb34add0362">trkf::PropXYZPlane</a>, <a class="el" href="../../d1/d34/classtrkf_1_1PropYZPlane.html#a57d9b7c109eb449ff5dc3c465994a4de">trkf::PropYZPlane</a>, and <a class="el" href="../../dd/d97/classtrkf_1_1PropYZLine.html#a9b04e8f5a4dd1b161bde7adeb503d17e">trkf::PropYZLine</a>.</p>

</div>
</div>
<a class="anchor" id="a444a373364319c1bb8fb18560b299940"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::optional&lt; double &gt; trkf::Propagator::vec_prop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../da/dcf/classtrkf_1_1KTrack.html">KTrack</a> &amp;&#160;</td>
          <td class="paramname"><em>trk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::shared_ptr&lt; const <a class="el" href="../../d5/d75/classtrkf_1_1Surface.html">Surface</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>psurf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354">PropDirection</a>&#160;</td>
          <td class="paramname"><em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>doDedx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a> *&#160;</td>
          <td class="paramname"><em>prop_matrix</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/da2/namespacetrkf.html#a20fcb423cfba1923040c27599fd3bf83">TrackError</a> *&#160;</td>
          <td class="paramname"><em>noise_matrix</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Propagate without error (long distance). </p>
<p>Propagate without error (long distance).</p>
<p>Arguments:</p>
<p>trk - <a class="el" href="../../d4/d66/structTrack.html">Track</a> to propagate. psurf - Destination surface. dir - Propagation direction (FORWARD, BACKWARD, or UNKNOWN). doDedx - dE/dx enable/disable flag. prop_matrix - Return propagation matrix if not null. noise_matrix - Return noise matrix if not null.</p>
<p>Returned value: Propagation distance &amp; success flag.</p>
<p>This method calls virtual method short_vec_prop in steps of some maximum size. </p>

<p>Definition at line <a class="el" href="../../d8/dee/Propagator_8cxx_source.html#l00053">53</a> of file <a class="el" href="../../d8/dee/Propagator_8cxx_source.html">Propagator.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  {</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    std::optional&lt;double&gt; result{std::nullopt};</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">// Get the inverse momentum (assumed to be track parameter four).</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordtype">double</span> pinv = trk.getVector()(4);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="comment">// If dE/dx is not requested, or if inverse momentum is zero, then</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">// it is safe to propagate in one step.  In this case, just pass</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">// the call to short_vec_prop with unlimited distance.</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordtype">bool</span> dedx = <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#a534f567afe81a5ad6493ea5ec806faf7">getDoDedx</a>() &amp;&amp; doDedx;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordflow">if</span> (!dedx || pinv == 0.)</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      result = <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#a2b24c385021f90b82ea381be841bd74f">short_vec_prop</a>(trk, psurf, <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>, dedx, prop_matrix, noise_matrix);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      <span class="comment">// dE/dx is requested.  In this case we limit the maximum</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      <span class="comment">// propagation distance such that the kinetic energy of the</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      <span class="comment">// particle should not change by more thatn 10%.</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <span class="comment">// Initialize propagation matrix to unit matrix (if specified).</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      <span class="keywordtype">int</span> nvec = trk.getVector().size();</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      <span class="keywordflow">if</span> (prop_matrix) *prop_matrix = ublas::identity_matrix&lt;TrackVector::value_type&gt;(nvec);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <span class="comment">// Initialize noise matrix to zero matrix (if specified).</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      <span class="keywordflow">if</span> (noise_matrix) {</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        noise_matrix-&gt;resize(nvec, nvec, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        noise_matrix-&gt;clear();</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      <span class="comment">// Remember the starting track.</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      KTrack trk0(trk);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <span class="comment">// Make pointer variables pointing to local versions of the</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      <span class="comment">// propagation and noise matrices, or null if not specified.</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      <a class="code" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a> local_prop_matrix;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      <a class="code" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a>* plocal_prop_matrix = (prop_matrix == 0 ? 0 : &amp;local_prop_matrix);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      <a class="code" href="../../d0/da2/namespacetrkf.html#a20fcb423cfba1923040c27599fd3bf83">TrackError</a> local_noise_matrix;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      <a class="code" href="../../d0/da2/namespacetrkf.html#a20fcb423cfba1923040c27599fd3bf83">TrackError</a>* plocal_noise_matrix = (noise_matrix == 0 ? 0 : &amp;local_noise_matrix);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      <span class="comment">// Cumulative propagation distance.</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <span class="keywordtype">double</span> <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> = 0.;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      <span class="comment">// Begin stepping loop.</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <span class="comment">// We put a maximum iteration count to prevent infinite loops caused by</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      <span class="comment">// floating point pathologies.  The iteration count is large enough to reach</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      <span class="comment">// any point in the tpc using the minimum step size (for a reasonable tpc).</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      <span class="keywordtype">bool</span> done = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      <span class="keywordtype">int</span> nitmax = 10000; <span class="comment">// Maximum number of iterations.</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      <span class="keywordtype">int</span> nit = 0;        <span class="comment">// Iteration count.</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      <span class="keywordflow">while</span> (!done) {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="comment">// If the iteration count exceeds the maximum, return failure.</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        ++nit;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordflow">if</span> (nit &gt; nitmax) {</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;          trk = trk0;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;          result = std::nullopt;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;          <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        }</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="comment">// Estimate maximum step distance according to the above</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="comment">// stated principle.</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        pinv = trk.getVector()(4);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">mass</a> = trk.Mass();</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> = 1. / <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(pinv);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../d4/dca/updateVersionList_8sh.html#a067a8c1534d6da9b2c501a6cf4ef89bd">e</a> = std::hypot(p, mass);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="keywordtype">double</span> t = p * p / (e + <a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">mass</a>);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="keywordtype">double</span> dedx = 0.001 * <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#a2c9ef992609012f768b089a63ecdb2ad">fDetProp</a>.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a579732df4f5e4719435325f065be345f">Eloss</a>(p, mass, <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#a36f0b019ab2da59ce8066e84f67e6c4c">fTcut</a>);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="keywordtype">double</span> smax = 0.1 * t / dedx;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="keywordflow">if</span> (smax &lt;= 0.)</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;          <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;Propagator&quot;</span>) &lt;&lt; __func__ &lt;&lt; <span class="stringliteral">&quot;: maximum step &quot;</span> &lt;&lt; smax &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="comment">// Always allow a step of at least 0.3 cm (about one wire spacing).</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="keywordflow">if</span> (smax &lt; 0.3) smax = 0.3;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="comment">// First do a test propagation (without dE/dx and errors) to</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="comment">// find the distance to the destination surface.</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        KTrack trktest(trk);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        std::optional&lt;double&gt; <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a> = <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#a2b24c385021f90b82ea381be841bd74f">short_vec_prop</a>(trktest, psurf, <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>, <span class="keyword">false</span>, 0, 0);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="comment">// If the test propagation failed, return failure.</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keywordflow">if</span> (!dist) {</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;          trk = trk0;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="comment">// Generate destionation surface for this step (either final</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="comment">// destination, or some intermediate surface).</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        std::shared_ptr&lt;const Surface&gt; pstep;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(*dist) &lt;= smax) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;          done = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;          pstep = psurf;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;          <span class="comment">// Generate intermediate surface.</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;          <span class="comment">// First get point where track will intersect intermediate surface.</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;          <span class="keywordtype">double</span> xyz0[3]; <span class="comment">// Starting point.</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;          trk.getPosition(xyz0);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;          <span class="keywordtype">double</span> xyz1[3]; <span class="comment">// Destination point.</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;          trktest.getPosition(xyz1);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;          <span class="keywordtype">double</span> frac = smax / <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(*dist);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;          <span class="keywordtype">double</span> xyz[3]; <span class="comment">// Intermediate point.</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;          xyz[0] = xyz0[0] + frac * (xyz1[0] - xyz0[0]);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;          xyz[1] = xyz0[1] + frac * (xyz1[1] - xyz0[1]);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;          xyz[2] = xyz0[2] + frac * (xyz1[2] - xyz0[2]);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;          <span class="comment">// Choose orientation of intermediate surface perpendicular</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;          <span class="comment">// to track.</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;          <span class="keywordtype">double</span> mom[3];</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;          trk.getMomentum(mom);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;          <span class="comment">// Make intermediate surface object.</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;          pstep = std::shared_ptr&lt;const Surface&gt;(</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <span class="keyword">new</span> SurfXYZPlane(xyz[0], xyz[1], xyz[2], mom[0], mom[1], mom[2]));</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        }</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="comment">// Do the actual step propagation.</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        dist = <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#a2b24c385021f90b82ea381be841bd74f">short_vec_prop</a>(trk, pstep, <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>, doDedx, plocal_prop_matrix, plocal_noise_matrix);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="comment">// If the step propagation failed, return failure.</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="keywordflow">if</span> (!dist) {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;          trk = trk0;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        }</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="comment">// Update cumulative propagation distance.</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        s += *<a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="comment">// Update cumulative propagation matrix (left-multiply).</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="keywordflow">if</span> (prop_matrix != 0) {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;          <a class="code" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a> temp = prod(*plocal_prop_matrix, *prop_matrix);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;          *prop_matrix = temp;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="comment">// Update cumulative noise matrix.</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keywordflow">if</span> (noise_matrix != 0) {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;          <a class="code" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a> temp = prod(*noise_matrix, trans(*plocal_prop_matrix));</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;          <a class="code" href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">TrackMatrix</a> temp2 = prod(*plocal_prop_matrix, temp);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;          *noise_matrix = ublas::symmetric_adaptor&lt;TrackMatrix&gt;(temp2);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;          *noise_matrix += *plocal_noise_matrix;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        }</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      }</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <span class="comment">// Set the final result (distance + success).</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      result = std::make_optional(s);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="comment">// Done.</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  }</div>
<div class="ttc" id="namespacetrkf_html_a20fcb423cfba1923040c27599fd3bf83"><div class="ttname"><a href="../../d0/da2/namespacetrkf.html#a20fcb423cfba1923040c27599fd3bf83">trkf::TrackError</a></div><div class="ttdeci">KSymMatrix&lt; 5 &gt;::type TrackError</div><div class="ttdoc">Track error matrix, dimension 5x5. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d7d/KalmanLinearAlgebra_8h_source.html#l00093">KalmanLinearAlgebra.h:93</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_a2b24c385021f90b82ea381be841bd74f"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#a2b24c385021f90b82ea381be841bd74f">trkf::Propagator::short_vec_prop</a></div><div class="ttdeci">virtual std::optional&lt; double &gt; short_vec_prop(KTrack &amp;trk, const std::shared_ptr&lt; const Surface &gt; &amp;psurf, PropDirection dir, bool doDedx, TrackMatrix *prop_matrix=0, TrackError *noise_matrix=0) const =0</div><div class="ttdoc">Propagate without error (short distance). </div></div>
<div class="ttc" id="selectors_8fcl_html_a24c8335057af14a9b508d5ac18999ce5"><div class="ttname"><a href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a></div><div class="ttdeci">pdgs p</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd2/selectors_8fcl_source.html#l00022">selectors.fcl:22</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_a36f0b019ab2da59ce8066e84f67e6c4c"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#a36f0b019ab2da59ce8066e84f67e6c4c">trkf::Propagator::fTcut</a></div><div class="ttdeci">double fTcut</div><div class="ttdoc">Maximum delta ray energy for dE/dx. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00177">Propagator.h:177</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_a2c9ef992609012f768b089a63ecdb2ad"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#a2c9ef992609012f768b089a63ecdb2ad">trkf::Propagator::fDetProp</a></div><div class="ttdeci">detinfo::DetectorPropertiesData const &amp; fDetProp</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00176">Propagator.h:176</a></div></div>
<div class="ttc" id="sparse__vector__test_8cc_html_a39f16bf854ba527dee7eba5bbbd93f3f"><div class="ttname"><a href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a></div><div class="ttdeci">T abs(T value)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d59/sparse__vector__test_8cc_source.html#l00030">sparse_vector_test.cc:30</a></div></div>
<div class="ttc" id="namespacedropbox_html_a407b5b895ba9265893768748aaa73825"><div class="ttname"><a href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dropbox.dir</a></div><div class="ttdeci">tuple dir</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d81/dropbox_8py_source.html#l00028">dropbox.py:28</a></div></div>
<div class="ttc" id="classdetinfo_1_1DetectorPropertiesData_html_a579732df4f5e4719435325f065be345f"><div class="ttname"><a href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a579732df4f5e4719435325f065be345f">detinfo::DetectorPropertiesData::Eloss</a></div><div class="ttdeci">double Eloss(double mom, double mass, double tcut) const </div><div class="ttdoc">Restricted mean energy loss (dE/dx) </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d64/DetectorPropertiesData_8cc_source.html#l00087">DetectorPropertiesData.cc:87</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_a534f567afe81a5ad6493ea5ec806faf7"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#a534f567afe81a5ad6493ea5ec806faf7">trkf::Propagator::getDoDedx</a></div><div class="ttdeci">bool getDoDedx() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00113">Propagator.h:113</a></div></div>
<div class="ttc" id="namespacelarg4_html_a3b23adbb58bc71f7c54806914226f1f8"><div class="ttname"><a href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">larg4::dist</a></div><div class="ttdeci">constexpr double dist(const TReal *x, const TReal *y, const unsigned int dimension)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d8a/OpFastScintillation_8hh_source.html#l00563">OpFastScintillation.hh:563</a></div></div>
<div class="ttc" id="namespacetrkf_html_a45c422ac0674450193fc9f6549757f4f"><div class="ttname"><a href="../../d0/da2/namespacetrkf.html#a45c422ac0674450193fc9f6549757f4f">trkf::TrackMatrix</a></div><div class="ttdeci">KMatrix&lt; 5, 5 &gt;::type TrackMatrix</div><div class="ttdoc">General 5x5 matrix. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d7d/KalmanLinearAlgebra_8h_source.html#l00096">KalmanLinearAlgebra.h:96</a></div></div>
<div class="ttc" id="file__to__url_8sh_html_a096ad3d3698082826189c839d7a6e46f"><div class="ttname"><a href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a></div><div class="ttdeci">then echo File list $list not found else cat $list while read file do echo $file sed s</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dea/file__to__url_8sh_source.html#l00060">file_to_url.sh:60</a></div></div>
<div class="ttc" id="namespacelib_1_1dedx_html_af9508f78ba8143119daa95dbd8220f91"><div class="ttname"><a href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">lib.dedx.mass</a></div><div class="ttdeci">float mass</div><div class="ttdef"><b>Definition:</b> <a href="../../df/df9/dedx_8py_source.html#l00047">dedx.py:47</a></div></div>
<div class="ttc" id="updateVersionList_8sh_html_a067a8c1534d6da9b2c501a6cf4ef89bd"><div class="ttname"><a href="../../d4/dca/updateVersionList_8sh.html#a067a8c1534d6da9b2c501a6cf4ef89bd">e</a></div><div class="ttdeci">do i e</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/updateVersionList_8sh_source.html#l00068">updateVersionList.sh:68</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a2c9ef992609012f768b089a63ecdb2ad"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> const&amp; trkf::Propagator::fDetProp</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d2/df9/Propagator_8h_source.html#l00176">176</a> of file <a class="el" href="../../d2/df9/Propagator_8h_source.html">Propagator.h</a>.</p>

</div>
</div>
<a class="anchor" id="a101374f6b56772f619c188a0027968f0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::Propagator::fDoDedx</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Energy loss enable flag. </p>

<p>Definition at line <a class="el" href="../../d2/df9/Propagator_8h_source.html#l00178">178</a> of file <a class="el" href="../../d2/df9/Propagator_8h_source.html">Propagator.h</a>.</p>

</div>
</div>
<a class="anchor" id="af21c69a72fe709a4fc9994ed1c2d02ec"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt;const <a class="el" href="../../d2/d42/classtrkf_1_1Interactor.html">Interactor</a>&gt; trkf::Propagator::fInteractor</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><a class="el" href="../../d2/d42/classtrkf_1_1Interactor.html">Interactor</a> (for calculating noise). </p>

<p>Definition at line <a class="el" href="../../d2/df9/Propagator_8h_source.html#l00179">179</a> of file <a class="el" href="../../d2/df9/Propagator_8h_source.html">Propagator.h</a>.</p>

</div>
</div>
<a class="anchor" id="a36f0b019ab2da59ce8066e84f67e6c4c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double trkf::Propagator::fTcut</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Maximum delta ray energy for dE/dx. </p>

<p>Definition at line <a class="el" href="../../d2/df9/Propagator_8h_source.html#l00177">177</a> of file <a class="el" href="../../d2/df9/Propagator_8h_source.html">Propagator.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="../../d2/df9/Propagator_8h_source.html">Propagator.h</a></li>
<li><a class="el" href="../../d8/dee/Propagator_8cxx_source.html">Propagator.cxx</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
