<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>ROIFinderDifferential_tool.cc Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_b73b02d482d1c4a3db20c3d9ad52d395.html">srcs</a></li><li class="navelem"><a class="el" href="../../dir_04d670c4adcb884258431ddc1ce2763c.html">icaruscode</a></li><li class="navelem"><a class="el" href="../../dir_94314c0f385d81f04de3b3bdb34c1673.html">icaruscode</a></li><li class="navelem"><a class="el" href="../../dir_4f081efc6e34d5090b09a872dc566d00.html">TPC</a></li><li class="navelem"><a class="el" href="../../dir_6e4f7ceb401322916cfe296fb41d3314.html">SignalProcessing</a></li><li class="navelem"><a class="el" href="../../dir_0a2a886b18f07260b51481e089739ba2.html">RecoWire</a></li><li class="navelem"><a class="el" href="../../dir_a594c6dc3a22820e5bbc394702e4891a.html">DeconTools</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ROIFinderDifferential_tool.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../db/ddf/ROIFinderDifferential__tool_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"></span><span class="comment">/// \file   ROIFinderDifferential.cc</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"></span><span class="comment">/// \author T. Usher</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"></span><span class="comment">////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8e/icaruscode_2icaruscode_2TPC_2SignalProcessing_2RecoWire_2DeconTools_2IROIFinder_8h.html">icaruscode/TPC/SignalProcessing/RecoWire/DeconTools/IROIFinder.h</a>&quot;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;art/Utilities/ToolMacros.h&quot;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;art/Utilities/make_tool.h&quot;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;art_root_io/TFileService.h&quot;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;messagefacility/MessageLogger/MessageLogger.h&quot;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;cetlib_except/exception.h&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/df8/DetectorPropertiesService_8h.html">lardata/DetectorInfoServices/DetectorPropertiesService.h</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d8b/Geometry_8h.html">larcore/Geometry/Geometry.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;icarus_signal_processing/WaveformTools.h&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;TH1F.h&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;TH2F.h&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;TProfile.h&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">namespace </span>icarus_tool</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;{</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html">   26</a></span>&#160;<span class="keyword">class </span><a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html">ROIFinderDifferential</a> : <span class="keyword">public</span> <a class="code" href="../../d2/d32/classicarus__tool_1_1IROIFinder.html">IROIFinder</a></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;{</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keyword">explicit</span> <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a40444ea5bbeac2806886386456deb059">ROIFinderDifferential</a>(<span class="keyword">const</span> fhicl::ParameterSet&amp; pset);</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a71619a774e7741b02739a541bae00a18">~ROIFinderDifferential</a>();</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ae161119d7ae3a2f8202264b64305595e">configure</a>(<span class="keyword">const</span> fhicl::ParameterSet&amp; pset)                        <span class="keyword">override</span>;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#acb847f75db798de48b6a30e4cdb19f0e">initializeHistograms</a>(art::TFileDirectory&amp;)                  <span class="keyword">const override</span>;</div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a555b2df9a9b91b8d94a8f9518a565a85">   35</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a555b2df9a9b91b8d94a8f9518a565a85">plane</a>()<span class="keyword">                                                   const override </span>{<span class="keywordflow">return</span> <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#aa49711b9ae3d4471a42024b86db30df9">fPlane</a>;}</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ab58f2f2bb70b92d911e5f223f7c74d3f">FindROIs</a>(<span class="keyword">const</span> <a class="code" href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#a4b23786331b1347d64f0277c05469d42">Waveform</a>&amp;, <span class="keywordtype">size_t</span>, <span class="keywordtype">size_t</span>, <span class="keywordtype">double</span>, <a class="code" href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#a12a32f6e1338c584273217dbc4fb6378">CandidateROIVec</a>&amp;) <span class="keyword">const override</span>;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="comment">// The actual ROI finding algorithm</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a37563a05a83e3c6e114fd99d0b2ea201">findROICandidates</a>(Waveform::const_iterator startItr,</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                           Waveform::const_iterator stopItr,</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                           <span class="keywordtype">size_t</span>                   channel,</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                           <span class="keywordtype">size_t</span>                   roiStartTick,</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                           <span class="keywordtype">float</span>                    roiThreshold,</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                           <a class="code" href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#a12a32f6e1338c584273217dbc4fb6378">CandidateROIVec</a>&amp;         roiCandidateVec) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">// Average/Smooth the input waveform</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#aad07600897d7a682525617fb49806ae4">averageInputWaveform</a>(<span class="keyword">const</span> <a class="code" href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#a4b23786331b1347d64f0277c05469d42">Waveform</a>&amp;, <a class="code" href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#a4b23786331b1347d64f0277c05469d42">Waveform</a>&amp;) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a8e6dd523fb0c884bed141e917c91e26f">smoothInputWaveform</a>(<span class="keyword">const</span> <a class="code" href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#a4b23786331b1347d64f0277c05469d42">Waveform</a>&amp;, <a class="code" href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#a4b23786331b1347d64f0277c05469d42">Waveform</a>&amp;)  <span class="keyword">const</span>;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="comment">// Member variables from the fhicl file</span></div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#aa49711b9ae3d4471a42024b86db30df9">   52</a></span>&#160;    <span class="keywordtype">size_t</span>                                      <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#aa49711b9ae3d4471a42024b86db30df9">fPlane</a>;</div>
<div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a19308015afe4ee761c2c41d644ad7731">   53</a></span>&#160;    <span class="keywordtype">float</span>                                       <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a19308015afe4ee761c2c41d644ad7731">fNumSigma</a>;                   <span class="comment">///&lt; &quot;# sigma&quot; rms noise for ROI threshold</span></div>
<div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a3945a180f9b56fba712e90f7b2d3f3a6">   54</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">int</span>                                         <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a3945a180f9b56fba712e90f7b2d3f3a6">fNumBinsToAve</a>;               <span class="comment">///&lt; Controls the averaging</span></div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ac09e57c11f2186ba5431184bb4ae51c8">   55</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">int</span>                                         <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ac09e57c11f2186ba5431184bb4ae51c8">fMax2MinDistance</a>;            <span class="comment">///&lt; Maxmimum allow peak to peak distance</span></div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#afaaf217d522af79dbc28abf56b58a6a1">   56</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">size_t</span>                                      <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#afaaf217d522af79dbc28abf56b58a6a1">fMaxTicksGap</a>;                <span class="comment">///&lt; Maximum gap between ROI&#39;s before merging</span></div>
<div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a1bc37ef47bb51050a44db70a6d9e3cc8">   57</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>                              <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a1bc37ef47bb51050a44db70a6d9e3cc8">fPreROIPad</a>;                  <span class="comment">///&lt; ROI padding</span></div>
<div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a5220f9db12e19384743f97336e9af831">   58</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>                              <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a5220f9db12e19384743f97336e9af831">fPostROIPad</a>;                 <span class="comment">///&lt; ROI padding</span></div>
<div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a98daafb4cda67f13be9eed26e00ac7d2">   59</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">float</span>                                       <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a98daafb4cda67f13be9eed26e00ac7d2">fTruncRMSMinFraction</a>;        <span class="comment">///&lt; or at least this fraction of time bins</span></div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ac2e22dec30639fc1def309ca72b1eeb9">   60</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span>                                        <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ac2e22dec30639fc1def309ca72b1eeb9">fOutputHistograms</a>;           <span class="comment">///&lt; Output histograms?</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#afc374071b43722f5a7825b358e273290">   62</a></span>&#160;    std::vector&lt;float&gt;                          <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#afc374071b43722f5a7825b358e273290">fAveWeightVec</a>;</div>
<div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#acc3dc220bc88dcfb0753390332976bc4">   63</a></span>&#160;    <span class="keywordtype">float</span>                                       <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#acc3dc220bc88dcfb0753390332976bc4">fWeightSum</a>;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    </div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a34e37791c42fd0f7bd47f4ee35b62527">   65</a></span>&#160;    art::TFileDirectory*                        <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a34e37791c42fd0f7bd47f4ee35b62527">fHistDirectory</a>;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">// Define some useful global histograms here</span></div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a38959f55ee6c8f231f2c7a1def0c7fa2">   68</a></span>&#160;    TH1F*                                       <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a38959f55ee6c8f231f2c7a1def0c7fa2">fDiffMeanHist</a>;</div>
<div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#af4d247046a1df37c46aaabb2f180fdc2">   69</a></span>&#160;    TH1F*                                       <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#af4d247046a1df37c46aaabb2f180fdc2">fDiffRmsHist</a>;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    </div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ac158d6db5421a5f15363153688f4df46">   71</a></span>&#160;    TH1F*                                       <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ac158d6db5421a5f15363153688f4df46">fMinMaxDPeakHist</a>;</div>
<div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#aa1139427d3639e5196f3491cad2ca58e">   72</a></span>&#160;    TH1F*                                       <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#aa1139427d3639e5196f3491cad2ca58e">fMinMaxDistHist</a>;</div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a0a6023542c4f4647f0fde648173df715">   73</a></span>&#160;    TH1F*                                       <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a0a6023542c4f4647f0fde648173df715">fMinMaxSigmaHist</a>;</div>
<div class="line"><a name="l00074"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ad58032b4e946bfbe6d75c7b8770e9b31">   74</a></span>&#160;    TH2F*                                       <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ad58032b4e946bfbe6d75c7b8770e9b31">fDPeakVDistHist</a>;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a85773172f3e7b1ada2073f1807384fe0">   76</a></span>&#160;    icarus_signal_processing::WaveformTools&lt;float&gt;         <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a85773172f3e7b1ada2073f1807384fe0">fWaveformTool</a>;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">// Services</span></div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#af030d484f8b6068c7a7aa7756089f88d">   79</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html">geo::GeometryCore</a>*                    <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#af030d484f8b6068c7a7aa7756089f88d">fGeometry</a> = lar::providerFrom&lt;geo::Geometry&gt;();</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;};</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">//----------------------------------------------------------------------</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">// Constructor.</span></div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a40444ea5bbeac2806886386456deb059">   84</a></span>&#160;<a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a40444ea5bbeac2806886386456deb059">ROIFinderDifferential::ROIFinderDifferential</a>(<span class="keyword">const</span> fhicl::ParameterSet&amp; pset)</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;{</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ae161119d7ae3a2f8202264b64305595e">configure</a>(pset);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;}</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    </div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a71619a774e7741b02739a541bae00a18">   89</a></span>&#160;<a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a71619a774e7741b02739a541bae00a18">ROIFinderDifferential::~ROIFinderDifferential</a>()</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;{</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;}</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    </div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ae161119d7ae3a2f8202264b64305595e">   93</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ae161119d7ae3a2f8202264b64305595e">ROIFinderDifferential::configure</a>(<span class="keyword">const</span> fhicl::ParameterSet&amp; pset)</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;{</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="comment">// Start by recovering the parameters</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    std::vector&lt;unsigned short&gt; zin;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#aa49711b9ae3d4471a42024b86db30df9">fPlane</a>               = pset.get&lt; <span class="keywordtype">size_t</span> &gt;                     (<span class="stringliteral">&quot;Plane&quot;</span>                     );</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a19308015afe4ee761c2c41d644ad7731">fNumSigma</a>            = pset.get&lt; <span class="keywordtype">float</span> &gt;                      (<span class="stringliteral">&quot;NumSigma&quot;</span>                  );</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a3945a180f9b56fba712e90f7b2d3f3a6">fNumBinsToAve</a>        = pset.get&lt; <span class="keywordtype">int</span> &gt;                        (<span class="stringliteral">&quot;NumBinsToAve&quot;</span>              );</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ac09e57c11f2186ba5431184bb4ae51c8">fMax2MinDistance</a>     = pset.get&lt; <span class="keywordtype">int</span> &gt;                        (<span class="stringliteral">&quot;Max2MinDistance&quot;</span>           );</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#afaaf217d522af79dbc28abf56b58a6a1">fMaxTicksGap</a>         = pset.get&lt; <span class="keywordtype">size_t</span> &gt;                     (<span class="stringliteral">&quot;MaxTicksGap&quot;</span>,            50);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    zin                  = pset.get&lt; std::vector&lt;unsigned short&gt; &gt;(<span class="stringliteral">&quot;ROILeadTrailPadding&quot;</span>       );</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a98daafb4cda67f13be9eed26e00ac7d2">fTruncRMSMinFraction</a> = pset.get&lt; <span class="keywordtype">float</span> &gt;                      (<span class="stringliteral">&quot;TruncRMSMinFraction&quot;</span>,   0.6);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ac2e22dec30639fc1def309ca72b1eeb9">fOutputHistograms</a>    = pset.get&lt; <span class="keywordtype">bool</span>  &gt;                      (<span class="stringliteral">&quot;OutputHistograms&quot;</span>,    <span class="keyword">false</span>);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="comment">// put the ROI pad sizes into more convenient vectors</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a1bc37ef47bb51050a44db70a6d9e3cc8">fPreROIPad</a>  = zin[0];</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a5220f9db12e19384743f97336e9af831">fPostROIPad</a> = zin[1];</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">// The &quot;Max2MinDistance&quot; is input in ticks but needs to be scaled if we are averaging</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">//    if (fNumBinsToAve &gt; 1) fMax2MinDistance = std::round(fMax2MinDistance / fNumBinsToAve) + 1;</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="comment">// If asked, define some histograms</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ac2e22dec30639fc1def309ca72b1eeb9">fOutputHistograms</a>)</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="comment">// Access ART&#39;s TFileService, which will handle creating and writing</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="comment">// histograms and n-tuples for us.</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        art::ServiceHandle&lt;art::TFileService&gt; <a class="code" href="../../dd/d33/NuVertexChargeTree__module_8cc.html#aa8ae0901ab0cec47d6c9bf9c22af764f">tfs</a>;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a34e37791c42fd0f7bd47f4ee35b62527">fHistDirectory</a> = tfs.get();</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="comment">// Make a directory for these histograms</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        art::TFileDirectory <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> = <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a34e37791c42fd0f7bd47f4ee35b62527">fHistDirectory</a>-&gt;mkdir(Form(<span class="stringliteral">&quot;ROIPlane_%1zu&quot;</span>,<a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#aa49711b9ae3d4471a42024b86db30df9">fPlane</a>));</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a38959f55ee6c8f231f2c7a1def0c7fa2">fDiffMeanHist</a>    = dir.make&lt;TH1F&gt;(<span class="stringliteral">&quot;DiffMean&quot;</span>,    <span class="stringliteral">&quot;;Diff Mean;&quot;</span>,    100, -20.,  20.);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#af4d247046a1df37c46aaabb2f180fdc2">fDiffRmsHist</a>     = dir.make&lt;TH1F&gt;(<span class="stringliteral">&quot;DiffRms&quot;</span>,     <span class="stringliteral">&quot;;Diff RMS;&quot;</span>,     100,   0.,   5.);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ac158d6db5421a5f15363153688f4df46">fMinMaxDPeakHist</a> = dir.make&lt;TH1F&gt;(<span class="stringliteral">&quot;MinMaxDPeak&quot;</span>, <span class="stringliteral">&quot;;Delta Peak;&quot;</span>,   200, 0.,  50.);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#aa1139427d3639e5196f3491cad2ca58e">fMinMaxDistHist</a>  = dir.make&lt;TH1F&gt;(<span class="stringliteral">&quot;MinMaxDist&quot;</span>,  <span class="stringliteral">&quot;;Peak Sep;&quot;</span>,      50, 0.,  50.);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a0a6023542c4f4647f0fde648173df715">fMinMaxSigmaHist</a> = dir.make&lt;TH1F&gt;(<span class="stringliteral">&quot;MinMaxSigma&quot;</span>, <span class="stringliteral">&quot;;Peak Sep/rms;&quot;</span>, 200, 0., 200.);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ad58032b4e946bfbe6d75c7b8770e9b31">fDPeakVDistHist</a>  = dir.make&lt;TH2F&gt;(<span class="stringliteral">&quot;DPeakVDist&quot;</span>,  <span class="stringliteral">&quot;;Delta Peak; Peak Sep&quot;</span>, 200, 0, 50., 50, 0., 50.);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    }</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">// precalculate the weight vector to use in the averaging</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#afc374071b43722f5a7825b358e273290">fAveWeightVec</a>.resize(fNumBinsToAve);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordflow">if</span> (fNumBinsToAve &gt; 1)</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idx = 0; idx &lt; fNumBinsToAve/2; idx++)</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            <span class="keywordtype">float</span> weight = idx + 1;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#afc374071b43722f5a7825b358e273290">fAveWeightVec</a>.at(idx)                     = weight;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#afc374071b43722f5a7825b358e273290">fAveWeightVec</a>.at(fNumBinsToAve - idx - 1) = weight;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        }</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="comment">// Watch for case of fNumBinsToAve being odd</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keywordflow">if</span> (fNumBinsToAve % 2 &gt; 0) <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#afc374071b43722f5a7825b358e273290">fAveWeightVec</a>.at(fNumBinsToAve/2) = fNumBinsToAve/2 + 1;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">else</span> <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#afc374071b43722f5a7825b358e273290">fAveWeightVec</a>.at(0) = 1.;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#acc3dc220bc88dcfb0753390332976bc4">fWeightSum</a> = std::accumulate(<a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#afc374071b43722f5a7825b358e273290">fAveWeightVec</a>.begin(),<a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#afc374071b43722f5a7825b358e273290">fAveWeightVec</a>.end(), 0.);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;}</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ab58f2f2bb70b92d911e5f223f7c74d3f">  158</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ab58f2f2bb70b92d911e5f223f7c74d3f">ROIFinderDifferential::FindROIs</a>(<span class="keyword">const</span> <a class="code" href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#a4b23786331b1347d64f0277c05469d42">Waveform</a>&amp; waveform, <span class="keywordtype">size_t</span> channel, <span class="keywordtype">size_t</span> cnt, <span class="keywordtype">double</span> rmsNoise, <a class="code" href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#a12a32f6e1338c584273217dbc4fb6378">CandidateROIVec</a>&amp; roiVec)<span class="keyword"> const</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">// The idea here is to consider the input waveform - if an induction plane then it is already in differential form,</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="comment">// if a collection plane then we form the differential - then smooth and look for peaks. The technique will be to</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="comment">// consider the peak signature as a maximum followed some bins later by a mininum and those whose difference between</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">// max and min is more than the threshold are kept.</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">// First up, determine what kind of wire we have</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    std::vector&lt;geo::WireID&gt; wids    = <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#af030d484f8b6068c7a7aa7756089f88d">fGeometry</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#a0c5d3db5d5490bc3fc8fb3bbdb282f36">ChannelToWire</a>(channel);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a>&amp;      planeID = wids[0].planeID();</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <a class="code" href="../../d6/d23/namespacegeo.html#a59a0688ea6aaa04f0ffa6451f8083ca1">geo::SigType_t</a>           sigType = <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#af030d484f8b6068c7a7aa7756089f88d">fGeometry</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#a748e324d604cec19be4553eaa4a8e208">SignalType</a>(planeID);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="comment">// Local copy of the input waveform</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <a class="code" href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#a4b23786331b1347d64f0277c05469d42">Waveform</a> waveformDeriv(waveform.size());</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">// If we have a collection plane then take the derivative</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordflow">if</span> (sigType == <a class="code" href="../../d6/d23/namespacegeo.html#a3b3c27511a16721236b09f14b66a58bea0cb0a8adf7d7ffd1771088bdff443f63">geo::kCollection</a>) <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a85773172f3e7b1ada2073f1807384fe0">fWaveformTool</a>.firstDerivative(waveform, waveformDeriv);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="comment">// Otherwise a straight copy since the bipolar pulses are, effectively, derivatives</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">else</span> <a class="code" href="../../d6/dd6/RangeForWrapper__test_8cc.html#a2a47a7f29f0ddd7ff5d68f8aff63125c">std::copy</a>(waveform.begin(),waveform.end(),waveformDeriv.begin());</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">// Do the averaging</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <a class="code" href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#a4b23786331b1347d64f0277c05469d42">Waveform</a> aveWaveformDeriv;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">//    averageInputWaveform(waveformDeriv, aveWaveformDeriv);</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a8e6dd523fb0c884bed141e917c91e26f">smoothInputWaveform</a>(waveformDeriv, aveWaveformDeriv);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">//    fWaveformTool-&gt;triangleSmooth(waveform,aveWaveformDeriv);</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    </div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">// Scheme for finding a suitable threshold</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordtype">float</span> truncMean(0.);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordtype">float</span> truncRMS(0.);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordtype">float</span> fullRMS(0.);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordtype">float</span> nSig(2.5);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordtype">int</span>   nTrunc(0);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordtype">int</span>   range(0);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a85773172f3e7b1ada2073f1807384fe0">fWaveformTool</a>.getTruncatedMean(aveWaveformDeriv, truncMean, nTrunc, range);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a85773172f3e7b1ada2073f1807384fe0">fWaveformTool</a>.getTruncatedRMS(aveWaveformDeriv, nSig, fullRMS, truncRMS, nTrunc);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">// Put a floor on the value of the truncated RMS...</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordtype">float</span> truncRMSFloor = <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::max</a>(truncRMS, <span class="keywordtype">float</span>(0.25));</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">// Now find the ROI&#39;s</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a37563a05a83e3c6e114fd99d0b2ea201">findROICandidates</a>(aveWaveformDeriv.begin(),aveWaveformDeriv.end(),channel,0,truncRMSFloor,roiVec);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    TProfile* roiHist(0);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ac2e22dec30639fc1def309ca72b1eeb9">fOutputHistograms</a>)</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a38959f55ee6c8f231f2c7a1def0c7fa2">fDiffMeanHist</a>-&gt;Fill(truncMean, 1.);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#af4d247046a1df37c46aaabb2f180fdc2">fDiffRmsHist</a>-&gt;Fill(truncRMS, 1.);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="comment">// Try to limit to the wire number (since we are already segregated by plane)</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        std::vector&lt;geo::WireID&gt; wids = <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#af030d484f8b6068c7a7aa7756089f88d">fGeometry</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#a0c5d3db5d5490bc3fc8fb3bbdb282f36">ChannelToWire</a>(channel);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="keywordtype">size_t</span>                   wire = wids[0].Wire;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="comment">// Make a directory for these histograms</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        art::TFileDirectory <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> = <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a34e37791c42fd0f7bd47f4ee35b62527">fHistDirectory</a>-&gt;mkdir(Form(<span class="stringliteral">&quot;ROIPlane_%1zu/%03zu/wire_%05zu&quot;</span>,<a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#aa49711b9ae3d4471a42024b86db30df9">fPlane</a>,cnt,wire));</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="comment">// We keep track of four histograms:</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="keywordflow">try</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            TProfile* waveformHist    = dir.make&lt;TProfile&gt;(Form(<span class="stringliteral">&quot;Wfm_%03zu_c%05zu&quot;</span>,cnt,wire), <span class="stringliteral">&quot;Waveform&quot;</span>,   waveform.size(),         0, waveform.size(),         -500., 500.);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            TProfile* derivativeHist  = dir.make&lt;TProfile&gt;(Form(<span class="stringliteral">&quot;Der_%03zu_c%05zu&quot;</span>,cnt,wire), <span class="stringliteral">&quot;Derivative&quot;</span>, waveformDeriv.size(),    0, waveformDeriv.size(),    -500., 500.);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            TProfile* aveDerivHist    = dir.make&lt;TProfile&gt;(Form(<span class="stringliteral">&quot;Ave_%03zu_c%05zu&quot;</span>,cnt,wire), <span class="stringliteral">&quot;AveDeriv&quot;</span>,   aveWaveformDeriv.size(), 0, aveWaveformDeriv.size(), -500., 500.);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            roiHist = dir.make&lt;TProfile&gt;(Form(<span class="stringliteral">&quot;ROI_%03zu_c%05zu&quot;</span>,cnt,wire), <span class="stringliteral">&quot;ROI&quot;</span>, waveform.size(), 0, waveform.size(), -500., 500.);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> binIdx = 0; binIdx &lt; waveform.size(); binIdx++)</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                waveformHist-&gt;Fill(binIdx, waveform.at(binIdx));</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                derivativeHist-&gt;Fill(binIdx, waveformDeriv.at(binIdx));</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            <span class="keywordtype">int</span> binIdx(0);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; val : aveWaveformDeriv) aveDerivHist-&gt;Fill(binIdx++, val);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        } <span class="keywordflow">catch</span>(...)</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Caught exception trying to make new hists, plane,cnt,wire: &quot;</span> &lt;&lt; <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#aa49711b9ae3d4471a42024b86db30df9">fPlane</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; cnt &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; wire &lt;&lt; std::endl;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    }</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">if</span> (roiVec.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordtype">int</span> nMultiplier = 1; <span class="comment">// fNumBinsToAve</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    </div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="comment">// pad the ROIs</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; roi : roiVec)</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    {</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">if</span> (roiHist)</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            roiHist-&gt;Fill(<span class="keywordtype">int</span>(nMultiplier * roi.first),  <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::max</a>(3.*truncRMS,1.));</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            roiHist-&gt;Fill(<span class="keywordtype">int</span>(nMultiplier * roi.second), <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::max</a>(3.*truncRMS,1.));</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        }</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="comment">// low ROI end</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        roi.first  = <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::max</a>(<span class="keywordtype">int</span>(nMultiplier * roi.first - <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a1bc37ef47bb51050a44db70a6d9e3cc8">fPreROIPad</a>),0);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="comment">// high ROI end</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        roi.second = std::min(nMultiplier * roi.second + <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a3945a180f9b56fba712e90f7b2d3f3a6">fNumBinsToAve</a> + <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a5220f9db12e19384743f97336e9af831">fPostROIPad</a>, waveform.size() - 1);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    }</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="comment">// merge overlapping (or touching) ROI&#39;s</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">if</span>(roiVec.size() &gt; 1)</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    {</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="comment">// temporary vector for merged ROIs</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <a class="code" href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#a12a32f6e1338c584273217dbc4fb6378">CandidateROIVec</a> tempRoiVec;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="comment">// Loop through candidate roi&#39;s</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <span class="keywordtype">size_t</span> startRoi = roiVec.front().first;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="keywordtype">size_t</span> stopRoi  = startRoi;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; roi : roiVec)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            <span class="keywordflow">if</span> (roi.first &lt;= stopRoi + <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#afaaf217d522af79dbc28abf56b58a6a1">fMaxTicksGap</a>) stopRoi = roi.second;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                tempRoiVec.push_back(<a class="code" href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#ad229ce67942c5ed0f0cc0e5cfe85423a">CandidateROI</a>(startRoi,stopRoi));</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                startRoi = roi.first;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                stopRoi  = roi.second;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        }</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        </div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="comment">// Make sure to get the last one</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        tempRoiVec.push_back(<a class="code" href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#ad229ce67942c5ed0f0cc0e5cfe85423a">CandidateROI</a>(startRoi,stopRoi));</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        roiVec = tempRoiVec;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    }</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;}</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    </div>
<div class="line"><a name="l00292"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a37563a05a83e3c6e114fd99d0b2ea201">  292</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a37563a05a83e3c6e114fd99d0b2ea201">ROIFinderDifferential::findROICandidates</a>(Waveform::const_iterator startItr,</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                                              Waveform::const_iterator stopItr,</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                                              <span class="keywordtype">size_t</span>                   channel,</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                                              <span class="keywordtype">size_t</span>                   roiStartTick,</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                                              <span class="keywordtype">float</span>                    truncRMS,</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                                              <a class="code" href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#a12a32f6e1338c584273217dbc4fb6378">CandidateROIVec</a>&amp;         roiCandidateVec)<span class="keyword"> const</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="comment">// Require a minimum length</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordtype">size_t</span> roiLength = std::distance(startItr,stopItr);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordflow">if</span> (roiLength &gt; 0)</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="comment">// The idea is to recover the two maxima from the input waveform and center our search for the ROI</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="comment">// around them.</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        std::pair&lt;Waveform::const_iterator,Waveform::const_iterator&gt; minMaxItr = std::minmax_element(startItr,  stopItr);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        Waveform::const_iterator maxItr = minMaxItr.second;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        Waveform::const_iterator minItr = minMaxItr.first;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <span class="comment">// It can be that what has been returned are the lobes of two completely separate pulses which may be separated</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="comment">// by a large number of ticks. So we can&#39;t simply assume they belong together... unless they are &quot;close&quot; with</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <span class="comment">// the minimum after the maximum</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="keywordflow">if</span> (std::distance(maxItr,minItr) &lt; 0 || std::distance(maxItr,minItr) &gt; <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ac09e57c11f2186ba5431184bb4ae51c8">fMax2MinDistance</a>)</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        {</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            <span class="comment">// Given that, we key off the larger of the lobes and do a forward or backward search to find the minimum/maximum</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            <span class="comment">// which we think is associated to the lobe we have chosen.</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            <span class="comment">// First consider that the maximum is larger than the minimum...</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            <span class="keywordflow">if</span> (*maxItr &gt; std::fabs(*minItr))</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                <span class="comment">// Check distance to the minimum we found</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                <span class="keywordflow">if</span> (std::distance(maxItr,stopItr) &gt; 0)</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                    <span class="comment">// The maximum is larger so search forward from here for the true minimum</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                    minItr = maxItr;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                </div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                    <span class="keywordtype">float</span> prevValue = *minItr++;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                    <span class="keywordflow">while</span>(minItr != stopItr)</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                    {</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                        <span class="comment">// Look for the point where it turns back up</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                        <span class="keywordflow">if</span> (prevValue &lt; 0. &amp;&amp; *minItr &gt; prevValue)</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                        {</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                            <span class="comment">// reset to what was the actual minimum value</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                            minItr -= 1;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                        }</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                    </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                        prevValue = *minItr++;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                    }</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                }</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            }</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            {</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                <span class="comment">// Check distance to the max</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                <span class="keywordflow">if</span> (std::distance(startItr,minItr) &gt; 0)</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                {</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                    <span class="comment">// Otherwise, we are starting at the minimum and searching backwards to find the max</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                    maxItr = minItr;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                    <span class="keywordtype">float</span> prevValue = *maxItr--;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                    <span class="keywordflow">while</span>(maxItr != startItr)</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                    {</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                        <span class="comment">// Decreasing for two bins</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                        <span class="keywordflow">if</span> (prevValue &gt; 0. &amp;&amp; *maxItr &lt; prevValue)</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                        {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                            <span class="comment">// reset to what was the actual minimum value</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                            maxItr += 1;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                        }</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                    </div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                        prevValue = *maxItr--;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                    }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="comment">// Check that the range from maximum to minimum is over threshold</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keywordtype">float</span> maxMinRange    = *maxItr - *minItr;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        <span class="keywordtype">int</span>   maxMinDistance = std::distance(maxItr,minItr);</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ac2e22dec30639fc1def309ca72b1eeb9">fOutputHistograms</a> &amp;&amp; maxMinRange &gt; 2. * truncRMS)</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        {</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ac158d6db5421a5f15363153688f4df46">fMinMaxDPeakHist</a>-&gt;Fill(maxMinRange, 1.);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#aa1139427d3639e5196f3491cad2ca58e">fMinMaxDistHist</a>-&gt;Fill(maxMinDistance, 1.);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a0a6023542c4f4647f0fde648173df715">fMinMaxSigmaHist</a>-&gt;Fill(maxMinRange/truncRMS, 1.);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;            <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ad58032b4e946bfbe6d75c7b8770e9b31">fDPeakVDistHist</a>-&gt;Fill(maxMinRange, maxMinDistance, 1.);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        <span class="keywordflow">if</span> (maxMinRange &gt; <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a19308015afe4ee761c2c41d644ad7731">fNumSigma</a> * truncRMS &amp;&amp; maxMinDistance &gt;= 0 &amp;&amp; maxMinDistance &lt; <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ac09e57c11f2186ba5431184bb4ae51c8">fMax2MinDistance</a>)</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            <span class="comment">// To complete the edges of the ROI, search both sides for the point which is essentially back to zero,</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            <span class="comment">// or in reality back into the rms level...</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            Waveform::const_reverse_iterator revItr = std::find_if(std::make_reverse_iterator(maxItr), std::make_reverse_iterator(startItr), std::bind(std::less&lt;float&gt;(),std::placeholders::_1,truncRMS));</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            maxItr = revItr.base();</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            minItr = std::find_if(minItr,stopItr,std::bind(std::greater&lt;float&gt;(),std::placeholders::_1,-truncRMS));</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            <span class="comment">// Before saving this ROI, look for candidates preceeding this one</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            <span class="comment">// Note that preceeding snippet will reference to the current roiStartTick</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a37563a05a83e3c6e114fd99d0b2ea201">findROICandidates</a>(startItr, maxItr, channel, roiStartTick, truncRMS, roiCandidateVec);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <span class="comment">// Save this ROI</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            <span class="keywordtype">size_t</span> newStartTick = std::distance(startItr,maxItr) + roiStartTick;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            <span class="keywordtype">size_t</span> newStopTick  = std::distance(startItr,minItr) + roiStartTick;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            roiCandidateVec.push_back(<a class="code" href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#ad229ce67942c5ed0f0cc0e5cfe85423a">CandidateROI</a>(newStartTick, newStopTick));</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        </div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            <span class="comment">// Now look for candidate ROI&#39;s downstream of this one</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a37563a05a83e3c6e114fd99d0b2ea201">findROICandidates</a>(minItr, stopItr, channel, newStopTick, truncRMS, roiCandidateVec);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        }</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    }</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    </div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;}</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    </div>
<div class="line"><a name="l00408"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#aad07600897d7a682525617fb49806ae4">  408</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#aad07600897d7a682525617fb49806ae4">ROIFinderDifferential::averageInputWaveform</a>(<span class="keyword">const</span> <a class="code" href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#a4b23786331b1347d64f0277c05469d42">Waveform</a>&amp; inputWaveform, <a class="code" href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#a4b23786331b1347d64f0277c05469d42">Waveform</a>&amp; outputWaveform)<span class="keyword"> const</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="comment">// Vector reduction - take the 10 bin average</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordtype">float</span> aveSum(0.);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    </div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">if</span> (outputWaveform.size() != inputWaveform.size()) outputWaveform.resize(inputWaveform.size());</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> idx = 0; idx &lt; inputWaveform.size(); idx++)</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    {</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        aveSum += <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#afc374071b43722f5a7825b358e273290">fAveWeightVec</a>.at(idx % <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a3945a180f9b56fba712e90f7b2d3f3a6">fNumBinsToAve</a>) * inputWaveform.at(idx);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <span class="keywordflow">if</span> ((idx + 1) % fNumBinsToAve == 0)</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            outputWaveform[idx/<a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a3945a180f9b56fba712e90f7b2d3f3a6">fNumBinsToAve</a>] = aveSum / <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#acc3dc220bc88dcfb0753390332976bc4">fWeightSum</a>;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            aveSum = 0.;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        }</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    }</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;}</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    </div>
<div class="line"><a name="l00430"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a8e6dd523fb0c884bed141e917c91e26f">  430</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a8e6dd523fb0c884bed141e917c91e26f">ROIFinderDifferential::smoothInputWaveform</a>(<span class="keyword">const</span> <a class="code" href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#a4b23786331b1347d64f0277c05469d42">Waveform</a>&amp; inputWaveform, <a class="code" href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#a4b23786331b1347d64f0277c05469d42">Waveform</a>&amp; outputWaveform)<span class="keyword"> const</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="comment">// Vector smoothing - take the 10 bin average</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordtype">int</span>   halfBins = <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a3945a180f9b56fba712e90f7b2d3f3a6">fNumBinsToAve</a> / 2;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    outputWaveform.resize(inputWaveform.size());</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="comment">// Set the edge bins which can&#39;t be smoothed</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <a class="code" href="../../d6/dd6/RangeForWrapper__test_8cc.html#a2a47a7f29f0ddd7ff5d68f8aff63125c">std::copy</a>(inputWaveform.begin(),inputWaveform.begin()+halfBins,outputWaveform.begin());</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <a class="code" href="../../d6/dd6/RangeForWrapper__test_8cc.html#a2a47a7f29f0ddd7ff5d68f8aff63125c">std::copy</a>(inputWaveform.end()-halfBins,inputWaveform.end(),outputWaveform.end()-halfBins);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    </div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> idx = halfBins; idx &lt; inputWaveform.size() - halfBins; idx++)</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    {</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="keywordtype">float</span> weightedSum(0.);</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> wIdx = 0; wIdx &lt; <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a3945a180f9b56fba712e90f7b2d3f3a6">fNumBinsToAve</a>; wIdx++) weightedSum += <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#afc374071b43722f5a7825b358e273290">fAveWeightVec</a>.at(wIdx) * inputWaveform.at(idx - wIdx + halfBins);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        outputWaveform.at(idx) = weightedSum / <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#acc3dc220bc88dcfb0753390332976bc4">fWeightSum</a>;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    }</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;}</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div>
<div class="line"><a name="l00453"></a><span class="lineno"><a class="line" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#acb847f75db798de48b6a30e4cdb19f0e">  453</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#acb847f75db798de48b6a30e4cdb19f0e">ROIFinderDifferential::initializeHistograms</a>(art::TFileDirectory&amp; histDir)<span class="keyword"> const</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="comment">// It is assumed that the input TFileDirectory has been set up to group histograms into a common</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="comment">// folder at the calling routine&#39;s level. Here we create one more level of indirection to keep</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="comment">// histograms made by this tool separate.</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">    std::string dirName = &quot;ROIFinderPlane_&quot; + std::to_string(fPlane);</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">    art::TFileDirectory dir = histDir.mkdir(dirName.c_str());</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">    auto const* detprop      = lar::providerFrom&lt;detinfo::DetectorPropertiesService&gt;();</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">    double      samplingRate = detprop-&gt;SamplingRate();</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">    double      numBins      = fROIFinderVec.size();</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">    double      maxFreq      = 500. / samplingRate;</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">    std::string histName     = &quot;ROIFinderPlane_&quot; + std::to_string(fPlane);</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">    TH1D*       hist         = dir.make&lt;TH1D&gt;(histName.c_str(), &quot;ROIFinder;Frequency(MHz)&quot;, numBins, 0., maxFreq);</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">    for(int bin = 0; bin &lt; numBins; bin++)</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">        double freq = maxFreq * double(bin + 0.5) / double(numBins);</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">        </span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">        hist-&gt;Fill(freq, fROIFinderVec.at(bin).Re());</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;}</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;DEFINE_ART_CLASS_TOOL(<a class="code" href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html">ROIFinderDifferential</a>)</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;}</div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_a34e37791c42fd0f7bd47f4ee35b62527"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a34e37791c42fd0f7bd47f4ee35b62527">icarus_tool::ROIFinderDifferential::fHistDirectory</a></div><div class="ttdeci">art::TFileDirectory * fHistDirectory</div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00065">ROIFinderDifferential_tool.cc:65</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_a85773172f3e7b1ada2073f1807384fe0"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a85773172f3e7b1ada2073f1807384fe0">icarus_tool::ROIFinderDifferential::fWaveformTool</a></div><div class="ttdeci">icarus_signal_processing::WaveformTools&lt; float &gt; fWaveformTool</div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00076">ROIFinderDifferential_tool.cc:76</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_afc374071b43722f5a7825b358e273290"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#afc374071b43722f5a7825b358e273290">icarus_tool::ROIFinderDifferential::fAveWeightVec</a></div><div class="ttdeci">std::vector&lt; float &gt; fAveWeightVec</div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00062">ROIFinderDifferential_tool.cc:62</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_a5220f9db12e19384743f97336e9af831"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a5220f9db12e19384743f97336e9af831">icarus_tool::ROIFinderDifferential::fPostROIPad</a></div><div class="ttdeci">unsigned short fPostROIPad</div><div class="ttdoc">ROI padding. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00058">ROIFinderDifferential_tool.cc:58</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_a8e6dd523fb0c884bed141e917c91e26f"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a8e6dd523fb0c884bed141e917c91e26f">icarus_tool::ROIFinderDifferential::smoothInputWaveform</a></div><div class="ttdeci">void smoothInputWaveform(const Waveform &amp;, Waveform &amp;) const </div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00430">ROIFinderDifferential_tool.cc:430</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html">icarus_tool::ROIFinderDifferential</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00026">ROIFinderDifferential_tool.cc:26</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_ab58f2f2bb70b92d911e5f223f7c74d3f"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ab58f2f2bb70b92d911e5f223f7c74d3f">icarus_tool::ROIFinderDifferential::FindROIs</a></div><div class="ttdeci">void FindROIs(const Waveform &amp;, size_t, size_t, double, CandidateROIVec &amp;) const override</div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00158">ROIFinderDifferential_tool.cc:158</a></div></div>
<div class="ttc" id="structgeo_1_1PlaneID_html"><div class="ttname"><a href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a></div><div class="ttdoc">The data type to uniquely identify a Plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00472">geo_types.h:472</a></div></div>
<div class="ttc" id="pmttriggerproducer_8fcl_html_a527d89be40c3c20ca8162df059180fd9"><div class="ttname"><a href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">max</a></div><div class="ttdeci">BEGIN_PROLOG pmt_uncoated ideal single PE test page of manual option are OR or AND window for pmt trigger time start window for pmt trigger time end etc then what events all hists are saved for max</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5a/pmttriggerproducer_8fcl_source.html#l00023">pmttriggerproducer.fcl:23</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_ae161119d7ae3a2f8202264b64305595e"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ae161119d7ae3a2f8202264b64305595e">icarus_tool::ROIFinderDifferential::configure</a></div><div class="ttdeci">void configure(const fhicl::ParameterSet &amp;pset) override</div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00093">ROIFinderDifferential_tool.cc:93</a></div></div>
<div class="ttc" id="classgeo_1_1GeometryCore_html_a0c5d3db5d5490bc3fc8fb3bbdb282f36"><div class="ttname"><a href="../../d7/d63/classgeo_1_1GeometryCore.html#a0c5d3db5d5490bc3fc8fb3bbdb282f36">geo::GeometryCore::ChannelToWire</a></div><div class="ttdeci">std::vector&lt; geo::WireID &gt; ChannelToWire(raw::ChannelID_t const channel) const </div><div class="ttdoc">Returns a list of wires connected to the specified TPC channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d6a/GeometryCore_8cxx_source.html#l01107">GeometryCore.cxx:1107</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_a3945a180f9b56fba712e90f7b2d3f3a6"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a3945a180f9b56fba712e90f7b2d3f3a6">icarus_tool::ROIFinderDifferential::fNumBinsToAve</a></div><div class="ttdeci">int fNumBinsToAve</div><div class="ttdoc">Controls the averaging. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00054">ROIFinderDifferential_tool.cc:54</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_a1bc37ef47bb51050a44db70a6d9e3cc8"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a1bc37ef47bb51050a44db70a6d9e3cc8">icarus_tool::ROIFinderDifferential::fPreROIPad</a></div><div class="ttdeci">unsigned short fPreROIPad</div><div class="ttdoc">ROI padding. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00057">ROIFinderDifferential_tool.cc:57</a></div></div>
<div class="ttc" id="classicarus__tool_1_1IROIFinder_html_a12a32f6e1338c584273217dbc4fb6378"><div class="ttname"><a href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#a12a32f6e1338c584273217dbc4fb6378">icarus_tool::IROIFinder::CandidateROIVec</a></div><div class="ttdeci">std::vector&lt; CandidateROI &gt; CandidateROIVec</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8e/icaruscode_2icaruscode_2TPC_2SignalProcessing_2RecoWire_2DeconTools_2IROIFinder_8h_source.html#l00056">icaruscode/icaruscode/TPC/SignalProcessing/RecoWire/DeconTools/IROIFinder.h:56</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_a19308015afe4ee761c2c41d644ad7731"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a19308015afe4ee761c2c41d644ad7731">icarus_tool::ROIFinderDifferential::fNumSigma</a></div><div class="ttdeci">float fNumSigma</div><div class="ttdoc">&amp;quot;# sigma&amp;quot; rms noise for ROI threshold </div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00053">ROIFinderDifferential_tool.cc:53</a></div></div>
<div class="ttc" id="classgeo_1_1GeometryCore_html_a748e324d604cec19be4553eaa4a8e208"><div class="ttname"><a href="../../d7/d63/classgeo_1_1GeometryCore.html#a748e324d604cec19be4553eaa4a8e208">geo::GeometryCore::SignalType</a></div><div class="ttdeci">SigType_t SignalType(geo::PlaneID const &amp;pid) const </div><div class="ttdoc">Returns the type of signal on the channels of specified TPC plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d6a/GeometryCore_8cxx_source.html#l00578">GeometryCore.cxx:578</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_af4d247046a1df37c46aaabb2f180fdc2"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#af4d247046a1df37c46aaabb2f180fdc2">icarus_tool::ROIFinderDifferential::fDiffRmsHist</a></div><div class="ttdeci">TH1F * fDiffRmsHist</div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00069">ROIFinderDifferential_tool.cc:69</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_ac158d6db5421a5f15363153688f4df46"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ac158d6db5421a5f15363153688f4df46">icarus_tool::ROIFinderDifferential::fMinMaxDPeakHist</a></div><div class="ttdeci">TH1F * fMinMaxDPeakHist</div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00071">ROIFinderDifferential_tool.cc:71</a></div></div>
<div class="ttc" id="DetectorPropertiesService_8h_html"><div class="ttname"><a href="../../de/df8/DetectorPropertiesService_8h.html">DetectorPropertiesService.h</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_ac09e57c11f2186ba5431184bb4ae51c8"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ac09e57c11f2186ba5431184bb4ae51c8">icarus_tool::ROIFinderDifferential::fMax2MinDistance</a></div><div class="ttdeci">int fMax2MinDistance</div><div class="ttdoc">Maxmimum allow peak to peak distance. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00055">ROIFinderDifferential_tool.cc:55</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_a555b2df9a9b91b8d94a8f9518a565a85"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a555b2df9a9b91b8d94a8f9518a565a85">icarus_tool::ROIFinderDifferential::plane</a></div><div class="ttdeci">size_t plane() const override</div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00035">ROIFinderDifferential_tool.cc:35</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_aad07600897d7a682525617fb49806ae4"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#aad07600897d7a682525617fb49806ae4">icarus_tool::ROIFinderDifferential::averageInputWaveform</a></div><div class="ttdeci">void averageInputWaveform(const Waveform &amp;, Waveform &amp;) const </div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00408">ROIFinderDifferential_tool.cc:408</a></div></div>
<div class="ttc" id="icaruscode_2icaruscode_2TPC_2SignalProcessing_2RecoWire_2DeconTools_2IROIFinder_8h_html"><div class="ttname"><a href="../../d1/d8e/icaruscode_2icaruscode_2TPC_2SignalProcessing_2RecoWire_2DeconTools_2IROIFinder_8h.html">IROIFinder.h</a></div></div>
<div class="ttc" id="namespacegeo_html_a59a0688ea6aaa04f0ffa6451f8083ca1"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#a59a0688ea6aaa04f0ffa6451f8083ca1">geo::SigType_t</a></div><div class="ttdeci">enum geo::_plane_sigtype SigType_t</div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_af030d484f8b6068c7a7aa7756089f88d"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#af030d484f8b6068c7a7aa7756089f88d">icarus_tool::ROIFinderDifferential::fGeometry</a></div><div class="ttdeci">const geo::GeometryCore * fGeometry</div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00079">ROIFinderDifferential_tool.cc:79</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_acb847f75db798de48b6a30e4cdb19f0e"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#acb847f75db798de48b6a30e4cdb19f0e">icarus_tool::ROIFinderDifferential::initializeHistograms</a></div><div class="ttdeci">void initializeHistograms(art::TFileDirectory &amp;) const override</div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00453">ROIFinderDifferential_tool.cc:453</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_a38959f55ee6c8f231f2c7a1def0c7fa2"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a38959f55ee6c8f231f2c7a1def0c7fa2">icarus_tool::ROIFinderDifferential::fDiffMeanHist</a></div><div class="ttdeci">TH1F * fDiffMeanHist</div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00068">ROIFinderDifferential_tool.cc:68</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_ad58032b4e946bfbe6d75c7b8770e9b31"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ad58032b4e946bfbe6d75c7b8770e9b31">icarus_tool::ROIFinderDifferential::fDPeakVDistHist</a></div><div class="ttdeci">TH2F * fDPeakVDistHist</div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00074">ROIFinderDifferential_tool.cc:74</a></div></div>
<div class="ttc" id="classicarus__tool_1_1IROIFinder_html_a4b23786331b1347d64f0277c05469d42"><div class="ttname"><a href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#a4b23786331b1347d64f0277c05469d42">icarus_tool::IROIFinder::Waveform</a></div><div class="ttdeci">std::vector&lt; float &gt; Waveform</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8e/icaruscode_2icaruscode_2TPC_2SignalProcessing_2RecoWire_2DeconTools_2IROIFinder_8h_source.html#l00052">icaruscode/icaruscode/TPC/SignalProcessing/RecoWire/DeconTools/IROIFinder.h:52</a></div></div>
<div class="ttc" id="classgeo_1_1GeometryCore_html"><div class="ttname"><a href="../../d7/d63/classgeo_1_1GeometryCore.html">geo::GeometryCore</a></div><div class="ttdoc">Description of geometry of one entire detector. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de7/GeometryCore_8h_source.html#l01468">GeometryCore.h:1468</a></div></div>
<div class="ttc" id="namespacedropbox_html_a407b5b895ba9265893768748aaa73825"><div class="ttname"><a href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dropbox.dir</a></div><div class="ttdeci">tuple dir</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d81/dropbox_8py_source.html#l00028">dropbox.py:28</a></div></div>
<div class="ttc" id="classicarus__tool_1_1IROIFinder_html"><div class="ttname"><a href="../../d2/d32/classicarus__tool_1_1IROIFinder.html">icarus_tool::IROIFinder</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8e/icaruscode_2icaruscode_2TPC_2SignalProcessing_2RecoWire_2DeconTools_2IROIFinder_8h_source.html#l00042">icaruscode/icaruscode/TPC/SignalProcessing/RecoWire/DeconTools/IROIFinder.h:42</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_afaaf217d522af79dbc28abf56b58a6a1"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#afaaf217d522af79dbc28abf56b58a6a1">icarus_tool::ROIFinderDifferential::fMaxTicksGap</a></div><div class="ttdeci">size_t fMaxTicksGap</div><div class="ttdoc">Maximum gap between ROI&amp;#39;s before merging. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00056">ROIFinderDifferential_tool.cc:56</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_aa1139427d3639e5196f3491cad2ca58e"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#aa1139427d3639e5196f3491cad2ca58e">icarus_tool::ROIFinderDifferential::fMinMaxDistHist</a></div><div class="ttdeci">TH1F * fMinMaxDistHist</div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00072">ROIFinderDifferential_tool.cc:72</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_a71619a774e7741b02739a541bae00a18"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a71619a774e7741b02739a541bae00a18">icarus_tool::ROIFinderDifferential::~ROIFinderDifferential</a></div><div class="ttdeci">~ROIFinderDifferential()</div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00089">ROIFinderDifferential_tool.cc:89</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_a98daafb4cda67f13be9eed26e00ac7d2"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a98daafb4cda67f13be9eed26e00ac7d2">icarus_tool::ROIFinderDifferential::fTruncRMSMinFraction</a></div><div class="ttdeci">float fTruncRMSMinFraction</div><div class="ttdoc">or at least this fraction of time bins </div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00059">ROIFinderDifferential_tool.cc:59</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_a37563a05a83e3c6e114fd99d0b2ea201"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a37563a05a83e3c6e114fd99d0b2ea201">icarus_tool::ROIFinderDifferential::findROICandidates</a></div><div class="ttdeci">void findROICandidates(Waveform::const_iterator startItr, Waveform::const_iterator stopItr, size_t channel, size_t roiStartTick, float roiThreshold, CandidateROIVec &amp;roiCandidateVec) const </div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00292">ROIFinderDifferential_tool.cc:292</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_ac2e22dec30639fc1def309ca72b1eeb9"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#ac2e22dec30639fc1def309ca72b1eeb9">icarus_tool::ROIFinderDifferential::fOutputHistograms</a></div><div class="ttdeci">bool fOutputHistograms</div><div class="ttdoc">Output histograms? </div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00060">ROIFinderDifferential_tool.cc:60</a></div></div>
<div class="ttc" id="RangeForWrapper__test_8cc_html_a2a47a7f29f0ddd7ff5d68f8aff63125c"><div class="ttname"><a href="../../d6/dd6/RangeForWrapper__test_8cc.html#a2a47a7f29f0ddd7ff5d68f8aff63125c">copy</a></div><div class="ttdeci">T copy(T const &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd6/RangeForWrapper__test_8cc_source.html#l00098">RangeForWrapper_test.cc:98</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_a40444ea5bbeac2806886386456deb059"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a40444ea5bbeac2806886386456deb059">icarus_tool::ROIFinderDifferential::ROIFinderDifferential</a></div><div class="ttdeci">ROIFinderDifferential(const fhicl::ParameterSet &amp;pset)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00084">ROIFinderDifferential_tool.cc:84</a></div></div>
<div class="ttc" id="NuVertexChargeTree__module_8cc_html_aa8ae0901ab0cec47d6c9bf9c22af764f"><div class="ttname"><a href="../../dd/d33/NuVertexChargeTree__module_8cc.html#aa8ae0901ab0cec47d6c9bf9c22af764f">tfs</a></div><div class="ttdeci">art::ServiceHandle&lt; art::TFileService &gt; tfs</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d33/NuVertexChargeTree__module_8cc_source.html#l00253">NuVertexChargeTree_module.cc:253</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_acc3dc220bc88dcfb0753390332976bc4"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#acc3dc220bc88dcfb0753390332976bc4">icarus_tool::ROIFinderDifferential::fWeightSum</a></div><div class="ttdeci">float fWeightSum</div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00063">ROIFinderDifferential_tool.cc:63</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_aa49711b9ae3d4471a42024b86db30df9"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#aa49711b9ae3d4471a42024b86db30df9">icarus_tool::ROIFinderDifferential::fPlane</a></div><div class="ttdeci">size_t fPlane</div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00052">ROIFinderDifferential_tool.cc:52</a></div></div>
<div class="ttc" id="classicarus__tool_1_1ROIFinderDifferential_html_a0a6023542c4f4647f0fde648173df715"><div class="ttname"><a href="../../d5/df6/classicarus__tool_1_1ROIFinderDifferential.html#a0a6023542c4f4647f0fde648173df715">icarus_tool::ROIFinderDifferential::fMinMaxSigmaHist</a></div><div class="ttdeci">TH1F * fMinMaxSigmaHist</div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddf/ROIFinderDifferential__tool_8cc_source.html#l00073">ROIFinderDifferential_tool.cc:73</a></div></div>
<div class="ttc" id="classicarus__tool_1_1IROIFinder_html_ad229ce67942c5ed0f0cc0e5cfe85423a"><div class="ttname"><a href="../../d2/d32/classicarus__tool_1_1IROIFinder.html#ad229ce67942c5ed0f0cc0e5cfe85423a">icarus_tool::IROIFinder::CandidateROI</a></div><div class="ttdeci">std::pair&lt; size_t, size_t &gt; CandidateROI</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8e/icaruscode_2icaruscode_2TPC_2SignalProcessing_2RecoWire_2DeconTools_2IROIFinder_8h_source.html#l00055">icaruscode/icaruscode/TPC/SignalProcessing/RecoWire/DeconTools/IROIFinder.h:55</a></div></div>
<div class="ttc" id="Geometry_8h_html"><div class="ttname"><a href="../../d3/d8b/Geometry_8h.html">Geometry.h</a></div><div class="ttdoc">art framework interface to geometry description </div></div>
<div class="ttc" id="messageservice_8fcl_html_a6699b4dbd72f548e48d81c88697d35a6"><div class="ttname"><a href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">cout</a></div><div class="ttdeci">BEGIN_PROLOG could also be cout</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/df5/messageservice_8fcl_source.html#l00010">messageservice.fcl:10</a></div></div>
<div class="ttc" id="namespacegeo_html_a3b3c27511a16721236b09f14b66a58bea0cb0a8adf7d7ffd1771088bdff443f63"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#a3b3c27511a16721236b09f14b66a58bea0cb0a8adf7d7ffd1771088bdff443f63">geo::kCollection</a></div><div class="ttdoc">Signal from collection planes. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00146">geo_types.h:146</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
