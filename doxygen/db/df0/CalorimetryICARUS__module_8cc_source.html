<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>CalorimetryICARUS_module.cc Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_b73b02d482d1c4a3db20c3d9ad52d395.html">srcs</a></li><li class="navelem"><a class="el" href="../../dir_04d670c4adcb884258431ddc1ce2763c.html">icaruscode</a></li><li class="navelem"><a class="el" href="../../dir_94314c0f385d81f04de3b3bdb34c1673.html">icaruscode</a></li><li class="navelem"><a class="el" href="../../dir_4f081efc6e34d5090b09a872dc566d00.html">TPC</a></li><li class="navelem"><a class="el" href="../../dir_119a8a7f983e821c951cdfac6a4c6ec5.html">Calorimetry</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">CalorimetryICARUS_module.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../db/df0/CalorimetryICARUS__module_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"></span><span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Calorimetry class</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// maddalena.antonello@lngs.infn.it</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// ornella.palamara@lngs.infn.it</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// ART port echurch@fnal.gov</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//  This algorithm is designed to perform the calorimetric reconstruction</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//  of the 3D reconstructed tracks</span><span class="comment"></span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;optional&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;limits&gt;</span> <span class="comment">// std::numeric_limits&lt;&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/d03/CalorimetryIcarusAlg_8h.html">icaruscode/TPC/Calorimetry/Algorithms/CalorimetryIcarusAlg.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d09/PhysicalConstants_8h.html">larcoreobj/SimpleTypesAndConstants/PhysicalConstants.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/df8/DetectorPropertiesService_8h.html">lardata/DetectorInfoServices/DetectorPropertiesService.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/d26/Hit_8h.html">lardataobj/RecoBase/Hit.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/d12/SpacePoint_8h.html">lardataobj/RecoBase/SpacePoint.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/d53/bj_2lardataobj_2RecoBase_2Track_8h.html">lardataobj/RecoBase/Track.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/de1/TrackHitMeta_8h.html">lardataobj/RecoBase/TrackHitMeta.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/d83/Calorimetry_8h.html">lardataobj/AnalysisBase/Calorimetry.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/d14/T0_8h.html">lardataobj/AnalysisBase/T0.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d9c/lardata_2lardata_2Utilities_2AssociationUtil_8h.html">lardata/Utilities/AssociationUtil.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/da1/ChannelStatusService_8h.html">larevt/CalibrationDBI/Interface/ChannelStatusService.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/ded/ChannelStatusProvider_8h.html">larevt/CalibrationDBI/Interface/ChannelStatusProvider.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/d97/TrackUtils_8h.html">lardata/ArtDataHelper/TrackUtils.h</a>&quot;</span> <span class="comment">// lar::util::TrackPitchInView()</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d80/PlaneGeo_8h.html">larcorealg/Geometry/PlaneGeo.h</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/de5/WireGeo_8h.html">larcorealg/Geometry/WireGeo.h</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/d16/NumericUtils_8h.html">larcorealg/CoreUtils/NumericUtils.h</a>&quot;</span> <span class="comment">// util::absDiff()</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/db6/SpaceCharge_8h.html">larevt/SpaceCharge/SpaceCharge.h</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/dda/SpaceChargeService_8h.html">larevt/SpaceChargeServices/SpaceChargeService.h</a>&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">// ROOT includes</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &lt;TMath.h&gt;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &lt;TGraph.h&gt;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &lt;TF1.h&gt;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &lt;TVector3.h&gt;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">// Framework includes</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;art/Framework/Core/EDProducer.h&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;art/Framework/Core/ModuleMacros.h&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;canvas/Persistency/Common/FindManyP.h&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;art/Framework/Principal/Event.h&quot;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;fhiclcpp/ParameterSet.h&quot;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;art/Framework/Principal/Handle.h&quot;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;canvas/Persistency/Common/Ptr.h&quot;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;art/Framework/Services/Registry/ServiceHandle.h&quot;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;messagefacility/MessageLogger/MessageLogger.h&quot;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;cetlib/pow.h&quot;</span> <span class="comment">// cet::sum_of_squares()</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">///calorimetry</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment"></span><span class="keyword">namespace </span><a class="code" href="../../db/d54/pid_8fcl.html#af0bae0facc8191fc6df47d3c75a24e2f">calo</a></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;{</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">   * @brief Estimates the energy deposited by reconstructed tracks.</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">   * Output</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">   * =======</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">   * * `std::vector&lt;anab::Calorimetry&gt;`: collection of calorimetry information,</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">   *      per reconstructed track and per wire plane</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">   * * `art::Assns&lt;recob::Track, anab::Calorimetry&gt;` association of each track</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">   *      with its calorimetry information</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">   * Configuration</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">   * ==============</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">   * @note This documentation is grossly incomplete.</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">   * * **NotOnTrackZcut** (real, optional): if specified, hits associated to all</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">   *     trajectory points whose _z_ coordinate is below `NotOnTrackZcut` value</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">   *     (including electric field distortion correction if enabled)</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">   *     are excluded from the calorimetry. The value is specified as absolute</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">   *     _z_ coordinate in world reference frame, in centimeters.</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">   *     The legacy value of this cut was hard coded to `-100.0` cm.</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html">   86</a></span>&#160;<span class="keyword">class </span><a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html">CalorimetryICARUS</a> : <span class="keyword">public</span> art::EDProducer</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;{</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="keyword">explicit</span> <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a0dde643f7c31a30a7017ca88fbbc4e16">CalorimetryICARUS</a>(fhicl::ParameterSet <span class="keyword">const</span> &amp;pset);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a6301ba491b1076a291102850587795a2">produce</a>(art::Event &amp;<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>) <span class="keyword">override</span>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#ae5770793d013875db997a3fd7383666c">ReadCaloTree</a>();</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#ab909865a1c49cd5e1f7cf6d070522117">BeginsOnBoundary</a>(art::Ptr&lt;recob::Track&gt; lar_track);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a2600ea0400a30dbfe8867125d3e9bf07">EndsOnBoundary</a>(art::Ptr&lt;recob::Track&gt; lar_track);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#ae9140e651f793edd2b43652a409c3e6a">GetPitch</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                art::Ptr&lt;recob::Hit&gt; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>, std::vector&lt;double&gt; trkx, std::vector&lt;double&gt; trky, std::vector&lt;double&gt; trkz, std::vector&lt;double&gt; trkw, std::vector&lt;double&gt; trkx0, <span class="keywordtype">double</span> *xyz3d, <span class="keywordtype">double</span> &amp;pitch, <span class="keywordtype">double</span> TickT0);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a985d7ca38c27647540ca52c50d4c6876">  102</a></span>&#160;  std::string <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a985d7ca38c27647540ca52c50d4c6876">fTrackModuleLabel</a>;</div>
<div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a85b2321c92e5c85fa2d432f0fc132303">  103</a></span>&#160;  std::string <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a85b2321c92e5c85fa2d432f0fc132303">fSpacePointModuleLabel</a>;</div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#ae0540c5ec3803bc0e7a75f0e4d3841c0">  104</a></span>&#160;  std::string <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#ae0540c5ec3803bc0e7a75f0e4d3841c0">fT0ModuleLabel</a>;</div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#afdcac46c473f832a0d9cdd48fbf926b1">  105</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#afdcac46c473f832a0d9cdd48fbf926b1">fUseArea</a>;</div>
<div class="line"><a name="l00106"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#aa72ee229c5962fb905dfbe4864340385">  106</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#aa72ee229c5962fb905dfbe4864340385">fUseIntegral</a>;</div>
<div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#abedea72f89ff81470efb94d4462b4d6b">  107</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#abedea72f89ff81470efb94d4462b4d6b">fSCE</a>;</div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#ac721cba5fe3e190d15cd6291ef76182b">  108</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#ac721cba5fe3e190d15cd6291ef76182b">fFlipTrack_dQdx</a>;                  <span class="comment">//flip track direction if significant rise of dQ/dx at the track start</span></div>
<div class="line"><a name="l00109"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#aeeb26c7297a4e61a67be431bd310a375">  109</a></span>&#160;  std::optional&lt;double&gt; <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#aeeb26c7297a4e61a67be431bd310a375">fNotOnTrackZcut</a>; <span class="comment">///&lt; Exclude trajectory points with _z_ lower than this [cm]</span></div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a3d22457e79b255e4e49e19f9ebbd80f5">  110</a></span>&#160;<span class="comment"></span>  <a class="code" href="../../db/d0e/classcalo_1_1CalorimetryIcarusAlg.html">CalorimetryIcarusAlg</a> <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a3d22457e79b255e4e49e19f9ebbd80f5">caloAlg</a>;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a777400ea2368c3dbde1c53a95d4c4a80">  112</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a777400ea2368c3dbde1c53a95d4c4a80">fnsps</a>;</div>
<div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a25b8299b25f505c820b150bc30ba0a2b">  113</a></span>&#160;  std::vector&lt;int&gt; <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a25b8299b25f505c820b150bc30ba0a2b">fwire</a>;</div>
<div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a4f86f384dbbf16816e76dcbfc8f6376b">  114</a></span>&#160;  std::vector&lt;double&gt; <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a4f86f384dbbf16816e76dcbfc8f6376b">ftime</a>;</div>
<div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#ad12a4b25a650d3a2c34f0ebe013f2131">  115</a></span>&#160;  std::vector&lt;double&gt; <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#ad12a4b25a650d3a2c34f0ebe013f2131">fstime</a>;</div>
<div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a3f309f9c946ef109cac779abee3a3954">  116</a></span>&#160;  std::vector&lt;double&gt; <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a3f309f9c946ef109cac779abee3a3954">fetime</a>;</div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a2975eec86ea0cbbb59cc9d449d1f3954">  117</a></span>&#160;  std::vector&lt;double&gt; <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a2975eec86ea0cbbb59cc9d449d1f3954">fMIPs</a>;</div>
<div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a55f99f1499c61988a7edebec02d0d2f0">  118</a></span>&#160;  std::vector&lt;double&gt; <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a55f99f1499c61988a7edebec02d0d2f0">fdQdx</a>;</div>
<div class="line"><a name="l00119"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#aba1923f2859a87e0565e057adebb1b10">  119</a></span>&#160;  std::vector&lt;double&gt; <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#aba1923f2859a87e0565e057adebb1b10">fdEdx</a>;</div>
<div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a8c8a77c26847ebcd873095c0555e9787">  120</a></span>&#160;  std::vector&lt;double&gt; <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a8c8a77c26847ebcd873095c0555e9787">fResRng</a>;</div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#aea47fe8f54023c6fde37746cb3374378">  121</a></span>&#160;  std::vector&lt;float&gt; <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#aea47fe8f54023c6fde37746cb3374378">fpitch</a>;</div>
<div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a12e5a90ab87dabfabbfc82bbd0867abc">  122</a></span>&#160;  std::vector&lt;TVector3&gt; <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a12e5a90ab87dabfabbfc82bbd0867abc">fXYZ</a>;</div>
<div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#addc20f2e718387df3ae6c7b852083026">  123</a></span>&#160;  std::vector&lt;size_t&gt; <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#addc20f2e718387df3ae6c7b852083026">fHitIndex</a>;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;}; <span class="comment">// class Calorimetry</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;} <span class="comment">// namespace calo</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">//-------------------------------------------------</span></div>
<div class="line"><a name="l00130"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a0dde643f7c31a30a7017ca88fbbc4e16">  130</a></span>&#160;<a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a0dde643f7c31a30a7017ca88fbbc4e16">calo::CalorimetryICARUS::CalorimetryICARUS</a>(fhicl::ParameterSet <span class="keyword">const</span> &amp;pset)</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    : EDProducer{pset},</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      fTrackModuleLabel(pset.get&lt;std::string&gt;(<span class="stringliteral">&quot;TrackModuleLabel&quot;</span>)),</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      fSpacePointModuleLabel(pset.get&lt;std::string&gt;(<span class="stringliteral">&quot;SpacePointModuleLabel&quot;</span>)),</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      fT0ModuleLabel(pset.get&lt;std::string&gt;(<span class="stringliteral">&quot;T0ModuleLabel&quot;</span>)),</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      fUseArea(pset.get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;UseArea&quot;</span>)),</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      fUseIntegral(pset.get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;UseIntegral&quot;</span>,<span class="keyword">true</span>)),</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      fSCE(pset.get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;CorrectSCE&quot;</span>)),</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      fFlipTrack_dQdx(pset.get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;FlipTrack_dQdx&quot;</span>, <span class="keyword">true</span>)),</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      caloAlg(pset.get&lt;fhicl::ParameterSet&gt;(<span class="stringliteral">&quot;CaloAlg&quot;</span>))</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;{</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">//std::cout &lt;&lt;&quot; initializing calorimetry... &quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="keywordflow">if</span> (pset.has_key(<span class="stringliteral">&quot;NotOnTrackZcut&quot;</span>))</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    fNotOnTrackZcut = pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;NotOnTrackZcut&quot;</span>);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  produces&lt;std::vector&lt;anab::Calorimetry&gt;&gt;();</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  produces&lt;art::Assns&lt;recob::Track, anab::Calorimetry&gt;&gt;();</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;}</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">//------------------------------------------------------------------------------------//</span></div>
<div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a6301ba491b1076a291102850587795a2">  150</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a6301ba491b1076a291102850587795a2">calo::CalorimetryICARUS::produce</a>(art::Event &amp;<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>)</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;{</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="keyword">auto</span> <span class="keyword">const</span> clockData = art::ServiceHandle&lt;detinfo::DetectorClocksService const&gt;()-&gt;DataFor(evt);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keyword">auto</span> <span class="keyword">const</span> <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a> = art::ServiceHandle&lt;detinfo::DetectorPropertiesService const&gt;()-&gt;DataFor(evt, clockData);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="comment">//std::cout &lt;&lt;&quot; producing calorimetry... &quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot; useintegral &quot;</span> &lt;&lt; fUseIntegral &lt;&lt; std::endl;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keyword">auto</span> <span class="keyword">const</span> *sce = lar::providerFrom&lt;spacecharge::SpaceChargeService&gt;();</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  art::Handle&lt;std::vector&lt;recob::Track&gt;&gt; trackListHandle;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  std::vector&lt;art::Ptr&lt;recob::Track&gt;&gt; tracklist;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="keywordflow">if</span> (evt.getByLabel(fTrackModuleLabel, trackListHandle))</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    art::fill_ptr_vector(tracklist, trackListHandle);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">//std::cout &lt;&lt; &quot; track list size &quot; &lt;&lt; tracklist.size() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="comment">// Get Geometry</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  art::ServiceHandle&lt;geo::Geometry const&gt; geom;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="comment">// channel quality</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <a class="code" href="../../d8/d7e/classlariov_1_1ChannelStatusProvider.html">lariov::ChannelStatusProvider</a> <span class="keyword">const</span> &amp;channelStatus = art::ServiceHandle&lt;lariov::ChannelStatusService const&gt;()-&gt;GetProvider();</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keywordtype">size_t</span> nplanes = geom-&gt;Nplanes();</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="comment">//create anab::Calorimetry objects and make association with recob::Track</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  std::unique_ptr&lt;std::vector&lt;anab::Calorimetry&gt;&gt; calorimetrycol(<span class="keyword">new</span> std::vector&lt;anab::Calorimetry&gt;);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  std::unique_ptr&lt;art::Assns&lt;recob::Track, anab::Calorimetry&gt;&gt; assn(<span class="keyword">new</span> art::Assns&lt;recob::Track, anab::Calorimetry&gt;);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="comment">//art::FindManyP&lt;recob::SpacePoint&gt; fmsp(trackListHandle, evt, fTrackModuleLabel);</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  art::FindManyP&lt;recob::Hit&gt; fmht(trackListHandle, evt, fTrackModuleLabel);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  art::FindManyP&lt;recob::Hit, recob::TrackHitMeta&gt; fmthm(trackListHandle, evt, fTrackModuleLabel); <span class="comment">//this has more information about hit-track association, only available in PMA for now</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  art::FindManyP&lt;anab::T0&gt; fmt0(trackListHandle, evt, fT0ModuleLabel);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> trkIter = 0; trkIter &lt; tracklist.size(); ++trkIter)</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    decltype(<span class="keyword">auto</span>) larEnd = tracklist[trkIter]-&gt;Trajectory().End();</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">// Some variables for the hit</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordtype">float</span> time;             <span class="comment">//hit time at maximum</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordtype">float</span> stime;            <span class="comment">//hit start time</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordtype">float</span> etime;            <span class="comment">//hit end time</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    uint32_t channel = 0;   <span class="comment">//channel number</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cstat = 0; <span class="comment">//hit cryostat number</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tpc = 0;   <span class="comment">//hit tpc number</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wire = 0;  <span class="comment">//hit wire number</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> plane = 0; <span class="comment">//hit plane number</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt; allHits = fmht.at(trkIter);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../db/dd5/gen__protons_8fcl.html#a2ba58fd55d60df6cb1370202e33b642e">T0</a> = 0;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordtype">double</span> TickT0 = 0;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="keywordflow">if</span> (fmt0.isValid())</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      std::vector&lt;art::Ptr&lt;anab::T0&gt;&gt; allT0 = fmt0.at(trkIter);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <span class="keywordflow">if</span> (allT0.size())</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        T0 = allT0[0]-&gt;Time();</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      TickT0 = T0 / <a class="code" href="../../d7/d8a/namespacedetinfo.html#a0c4d3d5b85e37497364174c3513ffcae">sampling_rate</a>(clockData);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    std::vector&lt;std::vector&lt;unsigned int&gt;&gt; hits(nplanes);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    art::FindManyP&lt;recob::SpacePoint&gt; fmspts(allHits, evt, fSpacePointModuleLabel);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ah = 0; ah &lt; allHits.size(); ++ah)</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      hits[allHits[ah]-&gt;WireID().Plane].push_back(ah);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    }</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">//get hits in each plane</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ipl = 0; ipl &lt; nplanes; ++ipl)</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    { <span class="comment">//loop over all wire planes</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> planeID; <span class="comment">//(cstat,tpc,ipl);</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      fwire.clear();</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      ftime.clear();</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      fstime.clear();</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      fetime.clear();</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      fMIPs.clear();</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      fdQdx.clear();</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      fdEdx.clear();</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      fpitch.clear();</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      fResRng.clear();</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      fXYZ.clear();</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      fHitIndex.clear();</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      <span class="keywordtype">float</span> Kin_En = 0.;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="keywordtype">float</span> Trk_Length = 0.;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      std::vector&lt;float&gt; vdEdx;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      std::vector&lt;float&gt; vresRange;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      std::vector&lt;float&gt; vdQdx;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      std::vector&lt;float&gt; deadwire; <span class="comment">//residual range for dead wires</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      std::vector&lt;TVector3&gt; vXYZ;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      <span class="comment">// Require at least 2 hits in this view</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      <span class="keywordflow">if</span> (hits[ipl].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() &lt; 2)</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="keywordflow">if</span> (hits[ipl].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() == 1)</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;          mf::LogWarning(<span class="stringliteral">&quot;Calorimetry&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Only one hit in plane &quot;</span> &lt;&lt; ipl &lt;&lt; <span class="stringliteral">&quot; associated with track id &quot;</span> &lt;&lt; trkIter;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        }</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        calorimetrycol-&gt;push_back(<a class="code" href="../../db/ddb/classanab_1_1Calorimetry.html">anab::Calorimetry</a>(<a class="code" href="../../d6/d72/namespaceutil.html#a85007be2ce41bf247364673c302f8a5b">util::kBogusD</a>,</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                                                    vdEdx,</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                                                    vdQdx,</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                                                    vresRange,</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                                                    deadwire,</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                                                    <a class="code" href="../../d6/d72/namespaceutil.html#a85007be2ce41bf247364673c302f8a5b">util::kBogusD</a>,</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                                                    fpitch,</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                                                    <a class="code" href="../../d6/d6b/namespacerecob_1_1tracking.html#a2253bf96e69f939f133551c86bdd2e37">recob::tracking::convertCollToPoint</a>(vXYZ),</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                                                    planeID));</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <a class="code" href="../../d6/d72/namespaceutil.html#ac016dc123242a7f1d5c81594de910717">util::CreateAssn</a>(*<span class="keyword">this</span>, evt, *calorimetrycol, tracklist[trkIter], *assn);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      }</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="comment">//range of wire signals</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wire0 = 100000;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wire1 = 0;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <span class="keywordtype">double</span> PIDA = 0;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      <span class="keywordtype">int</span> nPIDA = 0;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      <span class="comment">// determine track direction. Fill residual range array</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      <span class="keywordtype">bool</span> GoingDS = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      <span class="comment">// find the track direction by comparing US and DS charge BB</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="keywordtype">double</span> USChg = 0;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      <span class="keywordtype">double</span> DSChg = 0;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <span class="comment">// temp array holding distance betweeen space points</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      std::vector&lt;double&gt; spdelta;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <span class="comment">//int nht = 0; //number of hits</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      fnsps = 0; <span class="comment">//number of space points</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      std::vector&lt;double&gt; ChargeBeg;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      std::stack&lt;double&gt; ChargeEnd;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      <span class="comment">// find track pitch</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="keywordtype">double</span> fTrkPitch = 0;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> itp = 0; itp &lt; tracklist[trkIter]-&gt;NumberTrajectoryPoints(); ++itp)</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      {</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> &amp;pos = tracklist[trkIter]-&gt;LocationAtPoint(itp);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> = tracklist[trkIter]-&gt;DirectionAtPoint(itp);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> Position[3] = {pos.X(), pos.Y(), pos.Z()};</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a> tpcid = geom-&gt;FindTPCAtPosition(Position);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordflow">if</span> (tpcid.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a9384db80f2ab08f013fc630316d7bd05">isValid</a>)</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;          <span class="keywordflow">try</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;          {</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            fTrkPitch = <a class="code" href="../../d9/d3d/namespacelar_1_1util.html#a6788fc3784bdf9eff832087f034412bb">lar::util::TrackPitchInView</a>(*tracklist[trkIter], geom-&gt;Plane(ipl).View(), itp);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            <span class="comment">//Correct for SCE</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            <a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a> posOffsets = {0., 0., 0.};</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            <a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a> dirOffsets = {0., 0., 0.};</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            <span class="keywordflow">if</span> (sce-&gt;EnableCalSpatialSCE() &amp;&amp; fSCE)</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;              posOffsets = sce-&gt;GetCalPosOffsets(<a class="code" href="../../d6/d23/namespacegeo.html#a5a6f22c2aa9d0ccf6ca08bf2773a0541">geo::Point_t</a>(pos), tpcid.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            <span class="keywordflow">if</span> (sce-&gt;EnableCalSpatialSCE() &amp;&amp; fSCE)</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;              dirOffsets = sce-&gt;GetCalPosOffsets(<a class="code" href="../../d6/d23/namespacegeo.html#a5a6f22c2aa9d0ccf6ca08bf2773a0541">geo::Point_t</a>{pos.X() + fTrkPitch * <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>.X(), pos.Y() + fTrkPitch * <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>.Y(), pos.Z() + fTrkPitch * <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>.Z()}, tpcid.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            TVector3 dir_corr = {fTrkPitch * <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>.X() - dirOffsets.X() + posOffsets.X(), fTrkPitch * <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>.Y() + dirOffsets.Y() - posOffsets.Y(), fTrkPitch * <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>.Z() + dirOffsets.Z() - posOffsets.Z()};</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            fTrkPitch = dir_corr.Mag();</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;          }</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;          <span class="keywordflow">catch</span> (cet::exception &amp;<a class="code" href="../../d4/dca/updateVersionList_8sh.html#a067a8c1534d6da9b2c501a6cf4ef89bd">e</a>)</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;          {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            mf::LogWarning(<span class="stringliteral">&quot;Calorimetry&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;caught exception &quot;</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                                          &lt;&lt; e &lt;&lt; <span class="stringliteral">&quot;\n setting pitch (C) to &quot;</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                                          &lt;&lt; <a class="code" href="../../d6/d72/namespaceutil.html#a85007be2ce41bf247364673c302f8a5b">util::kBogusD</a>;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            fTrkPitch = 0;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;          }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      }</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <span class="comment">// find the separation between all space points</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="keywordtype">double</span> xx = 0., yy = 0., zz = 0.;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="comment">//save track 3d points</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      std::vector&lt;double&gt; trkx;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      std::vector&lt;double&gt; trky;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      std::vector&lt;double&gt; trkz;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      std::vector&lt;double&gt; trkw;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      std::vector&lt;double&gt; trkx0;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; hits[ipl].size(); ++i)</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      {</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="comment">//Get space points associated with the hit</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        std::vector&lt;art::Ptr&lt;recob::SpacePoint&gt;&gt; sptv = fmspts.at(hits[ipl][i]);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; sptv.size(); ++j)</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        {</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;          <span class="keywordtype">double</span> t = allHits[hits[ipl][i]]-&gt;PeakTime() - TickT0; <span class="comment">// Want T0 here? Otherwise ticks to x is wrong?</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;          <span class="keywordtype">double</span> <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a> = <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>.ConvertTicksToX(t, allHits[hits[ipl][i]]-&gt;<a class="code" href="../../d2/d66/namespacegeo_1_1fhicl.html#a48509e22b6681725c899fc354de43ae2">WireID</a>().<a class="code" href="../../d6/d5e/rawdigitfilter__icarus_8fcl.html#aa2b9cfdf9a8f294302be0cdf6affea22">Plane</a>, allHits[hits[ipl][i]]-&gt;<a class="code" href="../../d2/d66/namespacegeo_1_1fhicl.html#a48509e22b6681725c899fc354de43ae2">WireID</a>().<a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>, allHits[hits[ipl][i]]-&gt;<a class="code" href="../../d2/d66/namespacegeo_1_1fhicl.html#a48509e22b6681725c899fc354de43ae2">WireID</a>().Cryostat);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;          <span class="keywordtype">double</span> <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">w</a> = allHits[hits[ipl][i]]-&gt;WireID().Wire;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;          <span class="keywordflow">if</span> (TickT0)</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;          {</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            trkx.push_back(sptv[j]-&gt;XYZ()[0] - <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>.ConvertTicksToX(TickT0, allHits[hits[ipl][i]]-&gt;WireID().Plane, allHits[hits[ipl][i]]-&gt;WireID().TPC, allHits[hits[ipl][i]]-&gt;WireID().Cryostat));</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;          }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;          {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            trkx.push_back(sptv[j]-&gt;XYZ()[0]);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;          }</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;          trky.push_back(sptv[j]-&gt;XYZ()[1]);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;          trkz.push_back(sptv[j]-&gt;XYZ()[2]);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;          trkw.push_back(w);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;          trkx0.push_back(x);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        }</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ihit = 0; ihit &lt; hits[ipl].size(); ++ihit)</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      { <span class="comment">//loop over all hits on each wire plane</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="comment">//std::cout&lt;&lt;ihit&lt;&lt;std::endl;</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <span class="keywordflow">if</span> (!planeID.isValid)</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        {</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;          plane = allHits[hits[ipl][ihit]]-&gt;WireID().Plane;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;          tpc = allHits[hits[ipl][ihit]]-&gt;WireID().TPC;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;          cstat = allHits[hits[ipl][ihit]]-&gt;WireID().Cryostat;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;          planeID.Cryostat = cstat;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;          planeID.TPC = tpc;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;          planeID.Plane = plane;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;          planeID.isValid = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        wire = allHits[hits[ipl][ihit]]-&gt;WireID().Wire;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        time = allHits[hits[ipl][ihit]]-&gt;PeakTime(); <span class="comment">// What about here? T0</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        stime = allHits[hits[ipl][ihit]]-&gt;PeakTimeMinusRMS();</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        etime = allHits[hits[ipl][ihit]]-&gt;PeakTimePlusRMS();</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">size_t</span> &amp;hitIndex = allHits[hits[ipl][ihit]].key();</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="keywordtype">double</span> charge = allHits[hits[ipl][ihit]]-&gt;PeakAmplitude();</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordflow">if</span> (fUseArea)</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        {</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;       <span class="comment">//   std::cout &lt;&lt; &quot; integral &quot; &lt;&lt; allHits[hits[ipl][ihit]]-&gt;Integral() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">//std::cout &lt;&lt; &quot; sumadc &quot; &lt;&lt; allHits[hits[ipl][ihit]]-&gt;SummedADC() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;          <span class="keywordflow">if</span> (fUseIntegral) charge = allHits[hits[ipl][ihit]]-&gt;Integral();</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;          <span class="keywordflow">else</span>              charge = allHits[hits[ipl][ihit]]-&gt;SummedADC();</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">//std::cout &lt;&lt; &quot; ipl &quot; &lt;&lt; ipl &lt;&lt; &quot; ihit &quot; &lt;&lt; ihit &lt;&lt; &quot; charge &quot; &lt;&lt; charge &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        <span class="comment">//get 3d coordinate and track pitch for the current hit</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="comment">//not all hits are associated with space points, the method uses neighboring spacepts to interpolate</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <span class="keywordtype">double</span> xyz3d[3];</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="keywordtype">double</span> pitch;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <span class="keywordtype">bool</span> fBadhit = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="keywordflow">if</span> (fmthm.isValid())</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;          <span class="keyword">auto</span> vhit = fmthm.at(trkIter);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;          <span class="keyword">auto</span> vmeta = fmthm.data(trkIter);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ii = 0; ii &lt; vhit.size(); ++ii)</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;          {</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            <span class="keywordflow">if</span> (vhit[ii].key() == allHits[hits[ipl][ihit]].key())</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;              <span class="keywordflow">if</span> (vmeta[ii]-&gt;Index() == <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::numeric_limits&lt;unsigned int&gt;::max</a>())</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;              {</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                fBadhit = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;              }</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;              <span class="keywordflow">if</span> (vmeta[ii]-&gt;Index() &gt;= tracklist[trkIter]-&gt;NumberTrajectoryPoints())</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;              {</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;Calorimetry_module.cc&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Requested track trajectory index &quot;</span> &lt;&lt; vmeta[ii]-&gt;Index() &lt;&lt; <span class="stringliteral">&quot; exceeds the total number of trajectory points &quot;</span> &lt;&lt; tracklist[trkIter]-&gt;NumberTrajectoryPoints() &lt;&lt; <span class="stringliteral">&quot; for track index &quot;</span> &lt;&lt; trkIter &lt;&lt; <span class="stringliteral">&quot;. Something is wrong with the track reconstruction. Please contact tjyang@fnal.gov&quot;</span>;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;              }</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;              <span class="keywordflow">if</span> (!tracklist[trkIter]-&gt;HasValidPoint(vmeta[ii]-&gt;Index()))</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;              {</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                fBadhit = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;              }</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;              <span class="comment">//Correct location for SCE</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;              <a class="code" href="../../d6/d23/namespacegeo.html#a5a6f22c2aa9d0ccf6ca08bf2773a0541">geo::Point_t</a> <span class="keyword">const</span> <a class="code" href="../../d0/d8f/runFilesFromSAM_8sh.html#aeee9f371db14fda0de35d16324a167df">loc</a> = tracklist[trkIter]-&gt;LocationAtPoint(vmeta[ii]-&gt;Index());</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;              <a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a> locOffsets = {</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                  0.,</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                  0.,</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                  0.,</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;              };</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;              <span class="keywordflow">if</span> (sce-&gt;EnableCalSpatialSCE() &amp;&amp; fSCE)</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                locOffsets = sce-&gt;GetCalPosOffsets(loc, vhit[ii]-&gt;WireID().TPC);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;              xyz3d[0] = loc.X() - locOffsets.X();</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;              xyz3d[1] = loc.Y() + locOffsets.Y();</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;              xyz3d[2] = loc.Z() + locOffsets.Z();</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;              <span class="keywordtype">double</span> angleToVert = geom-&gt;WireAngleToVertical(vhit[ii]-&gt;View(), vhit[ii]-&gt;<a class="code" href="../../d2/d66/namespacegeo_1_1fhicl.html#a48509e22b6681725c899fc354de43ae2">WireID</a>().<a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>, vhit[ii]-&gt;<a class="code" href="../../d2/d66/namespacegeo_1_1fhicl.html#a48509e22b6681725c899fc354de43ae2">WireID</a>().Cryostat) - 0.5 * ::util::pi&lt;&gt;();</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;              <span class="keyword">const</span> <a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a> &amp;<a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> = tracklist[trkIter]-&gt;DirectionAtPoint(vmeta[ii]-&gt;Index());</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;              <span class="keywordtype">double</span> cosgamma = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(std::sin(angleToVert) * dir.Y() + std::cos(angleToVert) * dir.Z());</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;              <span class="keywordflow">if</span> (cosgamma)</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;              {</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                pitch = geom-&gt;WirePitch(vhit[ii]-&gt;View()) / cosgamma;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;              }</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;              {</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                pitch = 0;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;              }</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;              <span class="comment">//Correct pitch for SCE</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;              <a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a> dirOffsets = {0., 0., 0.};</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;              <span class="keywordflow">if</span> (sce-&gt;EnableCalSpatialSCE() &amp;&amp; fSCE)</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                dirOffsets = sce-&gt;GetCalPosOffsets(<a class="code" href="../../d6/d23/namespacegeo.html#a5a6f22c2aa9d0ccf6ca08bf2773a0541">geo::Point_t</a>{loc.X() + pitch * dir.X(), loc.Y() + pitch * dir.Y(), loc.Z() + pitch * dir.Z()}, vhit[ii]-&gt;WireID().TPC);</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;              <span class="keyword">const</span> TVector3 &amp;dir_corr = {pitch * <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>.X() - dirOffsets.X() + locOffsets.X(), pitch * <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>.Y() + dirOffsets.Y() - locOffsets.Y(), pitch * <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>.Z() + dirOffsets.Z() - locOffsets.Z()};</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;              pitch = dir_corr.Mag();</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;          }</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        }</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;          <a class="code" href="../../d7/d67/namespacesbn.html#a26e09a34b4fa0cd63629b6f2cfb241b8">GetPitch</a>(<a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>, allHits[hits[ipl][ihit]], trkx, trky, trkz, trkw, trkx0, xyz3d, pitch, TickT0);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <span class="keywordflow">if</span> (fBadhit)</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="keywordflow">if</span> (fNotOnTrackZcut &amp;&amp; (xyz3d[2] &lt; fNotOnTrackZcut.value()))</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;          <span class="keywordflow">continue</span>; <span class="comment">//hit not on track</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="keywordflow">if</span> (pitch &lt;= 0)</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;          pitch = fTrkPitch;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="keywordflow">if</span> (!pitch)</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="keywordflow">if</span> (fnsps == 0)</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;          xx = xyz3d[0];</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;          yy = xyz3d[1];</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;          zz = xyz3d[2];</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;          spdelta.push_back(0);</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        }</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        {</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;          <span class="keywordtype">double</span> dx = xyz3d[0] - xx;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;          <span class="keywordtype">double</span> dy = xyz3d[1] - yy;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;          <span class="keywordtype">double</span> dz = xyz3d[2] - zz;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;          spdelta.push_back(sqrt(dx * dx + dy * dy + dz * dz));</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;          Trk_Length += spdelta.back();</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;          xx = xyz3d[0];</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;          yy = xyz3d[1];</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;          zz = xyz3d[2];</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        }</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        ChargeBeg.push_back(charge);</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        ChargeEnd.push(charge);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <span class="keywordtype">double</span> MIPs = charge;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <span class="keywordtype">double</span> dQdx = MIPs / pitch;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../de/d0f/namespacetca.html#a03d7925cba1cd1c5952d280736887b6b">dEdx</a> = 0;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="keywordflow">if</span> (fUseArea) {</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                   <span class="keywordflow">if</span>(fUseIntegral) dEdx = caloAlg.dEdx_AREA(clockData, <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>, *allHits[hits[ipl][ihit]], pitch, T0);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                   <span class="keywordflow">else</span> dEdx = caloAlg.dEdx_SUMADC(clockData, <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>, allHits[hits[ipl][ihit]], pitch, T0);</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">//std::cout &lt;&lt; &quot; ipl &quot; &lt;&lt; ipl &lt;&lt; &quot; ihit &quot; &lt;&lt; ihit &lt;&lt; &quot; charge &quot; &lt;&lt; charge &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;}</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;          dEdx = caloAlg.dEdx_AMP(clockData, <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>, *allHits[hits[ipl][ihit]], pitch, T0);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        Kin_En = Kin_En + dEdx * pitch;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="keywordflow">if</span> (allHits[hits[ipl][ihit]]-&gt;<a class="code" href="../../d2/d66/namespacegeo_1_1fhicl.html#a48509e22b6681725c899fc354de43ae2">WireID</a>().Wire &lt; wire0)</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;          wire0 = allHits[hits[ipl][ihit]]-&gt;WireID().Wire;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="keywordflow">if</span> (allHits[hits[ipl][ihit]]-&gt;<a class="code" href="../../d2/d66/namespacegeo_1_1fhicl.html#a48509e22b6681725c899fc354de43ae2">WireID</a>().Wire &gt; wire1)</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;          wire1 = allHits[hits[ipl][ihit]]-&gt;WireID().Wire;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        fMIPs.push_back(MIPs);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        fdEdx.push_back(dEdx);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        fdQdx.push_back(dQdx);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        fwire.push_back(wire);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        ftime.push_back(time);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        fstime.push_back(stime);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        fetime.push_back(etime);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        fpitch.push_back(pitch);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        TVector3 v(xyz3d[0], xyz3d[1], xyz3d[2]);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="comment">//std::cout &lt;&lt; &quot;Adding these positions to v and then fXYZ &quot; &lt;&lt; xyz3d[0] &lt;&lt; &quot; &quot; &lt;&lt; xyz3d[1] &lt;&lt; &quot; &quot; &lt;&lt; xyz3d[2] &lt;&lt; &quot;\n&quot; &lt;&lt;std::endl;</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        fXYZ.push_back(v);</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        fHitIndex.push_back(hitIndex);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        ++fnsps;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      }</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      <span class="keywordflow">if</span> (fnsps &lt; 2)</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        vdEdx.clear();</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        vdQdx.clear();</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        vresRange.clear();</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        deadwire.clear();</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        fpitch.clear();</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="comment">//std::cout &lt;&lt; &quot;Adding the aforementioned positions...&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        calorimetrycol-&gt;push_back(<a class="code" href="../../db/ddb/classanab_1_1Calorimetry.html">anab::Calorimetry</a>(<a class="code" href="../../d6/d72/namespaceutil.html#a85007be2ce41bf247364673c302f8a5b">util::kBogusD</a>,</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                                                    vdEdx,</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                                                    vdQdx,</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                                                    vresRange,</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                                                    deadwire,</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                                                    <a class="code" href="../../d6/d72/namespaceutil.html#a85007be2ce41bf247364673c302f8a5b">util::kBogusD</a>,</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                                                    fpitch,</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                                                    <a class="code" href="../../d6/d6b/namespacerecob_1_1tracking.html#a2253bf96e69f939f133551c86bdd2e37">recob::tracking::convertCollToPoint</a>(vXYZ),</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                                                    planeID));</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <a class="code" href="../../d6/d72/namespaceutil.html#ac016dc123242a7f1d5c81594de910717">util::CreateAssn</a>(*<span class="keyword">this</span>, evt, *calorimetrycol, tracklist[trkIter], *assn);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      }</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> isp = 0; isp &lt; fnsps; ++isp)</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      {</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <span class="keywordflow">if</span> (isp &gt; 3)</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        USChg += ChargeBeg[isp];</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      }</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <span class="keywordtype">int</span> countsp = 0;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <span class="keywordflow">while</span> (!ChargeEnd.empty())</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      {</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <span class="keywordflow">if</span> (countsp &gt; 3)</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        DSChg += ChargeEnd.top();</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        ChargeEnd.pop();</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        ++countsp;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      }</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keywordflow">if</span> (fFlipTrack_dQdx)</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      {</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="comment">// Going DS if charge is higher at the end</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        GoingDS = (DSChg &gt; USChg);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      }</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      {</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <span class="comment">// Use the track direction to determine the residual range</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="keywordflow">if</span> (!fXYZ.empty())</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        {</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;          TVector3 track_start(tracklist[trkIter]-&gt;Trajectory().Vertex().<a class="code" href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a>(),</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                               tracklist[trkIter]-&gt;Trajectory().Vertex().Y(),</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                               tracklist[trkIter]-&gt;Trajectory().Vertex().Z());</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;          TVector3 track_end(tracklist[trkIter]-&gt;Trajectory().End().<a class="code" href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a>(),</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                             tracklist[trkIter]-&gt;Trajectory().End().Y(),</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                             tracklist[trkIter]-&gt;Trajectory().End().Z());</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;          <span class="keywordflow">if</span> ((fXYZ[0] - track_start).Mag() + (fXYZ.back() - track_end).Mag() &lt;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;              (fXYZ[0] - track_end).Mag() + (fXYZ.back() - track_start).Mag())</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;          {</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            GoingDS = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;          }</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;          {</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            GoingDS = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;          }</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      }</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      <span class="comment">// determine the starting residual range and fill the array</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      fResRng.resize(fnsps);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      <span class="keywordflow">if</span> (fResRng.size() &lt; 2 || spdelta.size() &lt; 2)</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      {</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        mf::LogWarning(<span class="stringliteral">&quot;Calorimetry&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;fResrng.size() = &quot;</span> &lt;&lt; fResRng.size() &lt;&lt; <span class="stringliteral">&quot; spdelta.size() = &quot;</span> &lt;&lt; spdelta.size();</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      }</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      <span class="keywordflow">if</span> (GoingDS)</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      {</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        fResRng[fnsps - 1] = spdelta[fnsps - 1] / 2;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> isp = fnsps - 2; isp &gt; -1; isp--)</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        {</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;          fResRng[isp] = fResRng[isp + 1] + spdelta[isp + 1];</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        }</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      }</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      {</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        fResRng[0] = spdelta[1] / 2;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> isp = 1; isp &lt; fnsps; isp++)</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        {</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;          fResRng[isp] = fResRng[isp - 1] + spdelta[isp];</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        }</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      }</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      MF_LOG_DEBUG(<span class="stringliteral">&quot;CaloPrtHit&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; pt wire  time  ResRng    MIPs   pitch   dE/dx    Ai X Y Z\n&quot;</span>;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      <span class="keywordtype">double</span> Ai = -1;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; fnsps; ++i)</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      { <span class="comment">//loop over all 3D points</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        vresRange.push_back(fResRng[i]);</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        vdEdx.push_back(fdEdx[i]);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        vdQdx.push_back(fdQdx[i]);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        vXYZ.push_back(fXYZ[i]);</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <span class="keywordflow">if</span> (i != 0 &amp;&amp; i != fnsps - 1)</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        { <span class="comment">//ignore the first and last point</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;          <span class="comment">// Calculate PIDA</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;          Ai = fdEdx[i] * pow(fResRng[i], 0.42);</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;          nPIDA++;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;          PIDA += Ai;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        }</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        MF_LOG_DEBUG(<span class="stringliteral">&quot;CaloPrtHit&quot;</span>) &lt;&lt; std::setw(4) &lt;&lt; trkIter</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                                   <span class="comment">//std::cout&lt;&lt;std::setw(4)&lt;&lt; trkIter</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                                   &lt;&lt; std::setw(4) &lt;&lt; ipl</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                                   &lt;&lt; std::setw(4) &lt;&lt; i</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                                   &lt;&lt; std::setw(4) &lt;&lt; fwire[i]</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                                   &lt;&lt; std::setw(6) &lt;&lt; (int)ftime[i]</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                                   &lt;&lt; std::setiosflags(std::ios::fixed | std::ios::showpoint)</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                                   &lt;&lt; std::setprecision(2)</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                                   &lt;&lt; std::setw(8) &lt;&lt; fResRng[i]</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                                   &lt;&lt; std::setprecision(1)</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                                   &lt;&lt; std::setw(8) &lt;&lt; fMIPs[i]</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                                   &lt;&lt; std::setprecision(2)</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                                   &lt;&lt; std::setw(8) &lt;&lt; fpitch[i]</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                                   &lt;&lt; std::setw(8) &lt;&lt; fdEdx[i]</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                                   &lt;&lt; std::setw(8) &lt;&lt; Ai</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                                   &lt;&lt; std::setw(8) &lt;&lt; fXYZ[i].x()</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                                   &lt;&lt; std::setw(8) &lt;&lt; fXYZ[i].y()</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                                   &lt;&lt; std::setw(8) &lt;&lt; fXYZ[i].z()</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                                   &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      } <span class="comment">//end looping over 3D points</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      <span class="keywordflow">if</span> (nPIDA &gt; 0)</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      {</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        PIDA = PIDA / (double)nPIDA;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      }</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        PIDA = -1;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      }</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      MF_LOG_DEBUG(<span class="stringliteral">&quot;CaloPrtTrk&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Plane # &quot;</span> &lt;&lt; ipl</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                                 &lt;&lt; <span class="stringliteral">&quot;TrkPitch= &quot;</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                                 &lt;&lt; std::setprecision(2) &lt;&lt; fTrkPitch</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                                 &lt;&lt; <span class="stringliteral">&quot; nhits= &quot;</span> &lt;&lt; fnsps</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                                 &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                                 &lt;&lt; std::setiosflags(std::ios::fixed | std::ios::showpoint)</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                                 &lt;&lt; <span class="stringliteral">&quot;Trk Length= &quot;</span> &lt;&lt; std::setprecision(1)</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                                 &lt;&lt; Trk_Length &lt;&lt; <span class="stringliteral">&quot; cm,&quot;</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                                 &lt;&lt; <span class="stringliteral">&quot; KE calo= &quot;</span> &lt;&lt; std::setprecision(1)</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                                 &lt;&lt; Kin_En &lt;&lt; <span class="stringliteral">&quot; MeV,&quot;</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                                 &lt;&lt; <span class="stringliteral">&quot; PIDA= &quot;</span> &lt;&lt; PIDA</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                                 &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      <span class="comment">// look for dead wires</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iw = wire0; iw &lt; wire1 + 1; ++iw)</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      {</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        plane = allHits[hits[ipl][0]]-&gt;WireID().Plane;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        tpc = allHits[hits[ipl][0]]-&gt;WireID().TPC;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        cstat = allHits[hits[ipl][0]]-&gt;WireID().Cryostat;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        channel = geom-&gt;PlaneWireToChannel(plane, iw, tpc, cstat);</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        <span class="keywordflow">if</span> (channelStatus.<a class="code" href="../../d8/d7e/classlariov_1_1ChannelStatusProvider.html#abda9787c4790d2e8a5cfbd5d3a806fb1">IsBad</a>(channel))</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        {</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;          MF_LOG_DEBUG(<span class="stringliteral">&quot;Calorimetry&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Found dead wire at Plane = &quot;</span> &lt;&lt; plane</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                                      &lt;&lt; <span class="stringliteral">&quot; Wire =&quot;</span> &lt;&lt; iw;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> closestwire = 0;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> endwire = 0;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dwire = 100000;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;          <span class="keywordtype">double</span> mindis = 100000;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;          <span class="keywordtype">double</span> goodresrange = 0;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;          <span class="comment">//hitCtr = 0;</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ihit = 0; ihit &lt; hits[ipl].size(); ++ihit)</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;          {</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;            <span class="comment">//  for(art::PtrVector&lt;recob::Hit&gt;::const_iterator hitIter = hitsV.begin();</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            <span class="comment">//      hitIter != hitsV.end();</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;            <span class="comment">//      ++hitCtr, hitIter++){</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            channel = allHits[hits[ipl][ihit]]-&gt;Channel();</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            <span class="keywordflow">if</span> (channelStatus.<a class="code" href="../../d8/d7e/classlariov_1_1ChannelStatusProvider.html#abda9787c4790d2e8a5cfbd5d3a806fb1">IsBad</a>(channel))</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;              <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;            <span class="comment">// grab the space points associated with this hit</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            std::vector&lt;art::Ptr&lt;recob::SpacePoint&gt;&gt; sppv = fmspts.at(hits[ipl][ihit]);</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;            <span class="keywordflow">if</span> (sppv.size() &lt; 1)</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;              <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            <span class="comment">// only use the first space point in the collection, really each hit should</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;            <span class="comment">// only map to 1 space point</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d9/dca/classrecob_1_1Track.html#ab1291b0f34f4c62c8089bfd8a5eef464">recob::Track::Point_t</a> xyz{sppv[0]-&gt;XYZ()[0],</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                                            sppv[0]-&gt;XYZ()[1],</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                                            sppv[0]-&gt;XYZ()[2]};</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            <span class="keywordtype">double</span> dis1 = (larEnd - xyz).Mag2();</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            <span class="keywordflow">if</span> (dis1)</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;              dis1 = std::sqrt(dis1);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            <span class="keywordflow">if</span> (dis1 &lt; mindis)</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;            {</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;              endwire = allHits[hits[ipl][ihit]]-&gt;WireID().Wire;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;              mindis = dis1;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            }</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d6/d72/namespaceutil.html#aaae39c2a7066e6a24ff172e5471939ae">util::absDiff</a>(wire, iw) &lt; dwire)</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            {</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;              closestwire = allHits[hits[ipl][ihit]]-&gt;WireID().Wire;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;              dwire = <a class="code" href="../../d6/d72/namespaceutil.html#aaae39c2a7066e6a24ff172e5471939ae">util::absDiff</a>(allHits[hits[ipl][ihit]]-&gt;<a class="code" href="../../d2/d66/namespacegeo_1_1fhicl.html#a48509e22b6681725c899fc354de43ae2">WireID</a>().Wire, iw);</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;              goodresrange = dis1;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            }</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;          }</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;          <span class="keywordflow">if</span> (closestwire)</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;          {</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            <span class="keywordflow">if</span> (iw &lt; endwire)</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;              deadwire.push_back(goodresrange + (<span class="keywordtype">int</span>(closestwire) - <span class="keywordtype">int</span>(iw)) * fTrkPitch);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;            }</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            {</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;              deadwire.push_back(goodresrange + (<span class="keywordtype">int</span>(iw) - <span class="keywordtype">int</span>(closestwire)) * fTrkPitch);</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;            }</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;          }</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        }</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      }</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      <span class="comment">//std::cout &lt;&lt; &quot;Adding at the end but still same fXYZ&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      calorimetrycol-&gt;push_back(<a class="code" href="../../db/ddb/classanab_1_1Calorimetry.html">anab::Calorimetry</a>(Kin_En,</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                                                  vdEdx,</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                                                  vdQdx,</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                                                  vresRange,</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                                                  deadwire,</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                                                  Trk_Length,</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                                                  fpitch,</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                                                  <a class="code" href="../../d6/d6b/namespacerecob_1_1tracking.html#a2253bf96e69f939f133551c86bdd2e37">recob::tracking::convertCollToPoint</a>(vXYZ),</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                                                  fHitIndex,</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                                                  planeID));</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      <a class="code" href="../../d6/d72/namespaceutil.html#ac016dc123242a7f1d5c81594de910717">util::CreateAssn</a>(*<span class="keyword">this</span>, evt, *calorimetrycol, tracklist[trkIter], *assn);</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    } <span class="comment">//end looping over planes</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  }   <span class="comment">//end looping over tracks</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.put(std::move(calorimetrycol));</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.put(std::move(assn));</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;}</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div>
<div class="line"><a name="l00741"></a><span class="lineno"><a class="line" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#ae9140e651f793edd2b43652a409c3e6a">  741</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#ae9140e651f793edd2b43652a409c3e6a">calo::CalorimetryICARUS::GetPitch</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                                       art::Ptr&lt;recob::Hit&gt; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>, std::vector&lt;double&gt; trkx, std::vector&lt;double&gt; trky, std::vector&lt;double&gt; trkz, std::vector&lt;double&gt; trkw, std::vector&lt;double&gt; trkx0, <span class="keywordtype">double</span> *xyz3d, <span class="keywordtype">double</span> &amp;pitch, <span class="keywordtype">double</span> TickT0)</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;{</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  <span class="comment">//Get 3d coordinates and track pitch for each hit</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="comment">//Find 5 nearest space points and determine xyz and curvature-&gt;track pitch</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <span class="comment">//std::cout &lt;&lt; &quot;Start of get pitch&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  <span class="comment">// Get services</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  art::ServiceHandle&lt;geo::Geometry const&gt; geom;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <span class="keyword">auto</span> <span class="keyword">const</span> *sce = lar::providerFrom&lt;spacecharge::SpaceChargeService&gt;();</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="comment">//save distance to each spacepoint sorted by distance</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  std::map&lt;double, size_t&gt; sptmap;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  <span class="comment">//save the sign of distance</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  std::map&lt;size_t, int&gt; sptsignmap;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  <span class="keywordtype">double</span> wire_pitch = geom-&gt;WirePitch(0);</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../d6/d11/namespacemake__calib__df.html#a2b8237bac57d5c373c623869ad4513c8">t0</a> = hit-&gt;PeakTime() - TickT0;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  <span class="keywordtype">double</span> x0 = detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a8e4b4b8d755ffded5a9f956ae7c9c1ec">ConvertTicksToX</a>(t0, hit-&gt;WireID().Plane, hit-&gt;WireID().TPC, hit-&gt;WireID().Cryostat);</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  <span class="keywordtype">double</span> w0 = hit-&gt;WireID().Wire;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; trkx.size(); ++i)</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  {</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="keywordtype">double</span> distance = cet::sum_of_squares((trkw[i] - w0) * wire_pitch, trkx0[i] - x0);</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordflow">if</span> (distance &gt; 0)</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      distance = sqrt(distance);</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="comment">//std::cout &lt;&lt; &quot;Dis &quot; &lt;&lt; distance &lt;&lt; &quot;, sqaured &quot; &lt;&lt; distance*distance &lt;&lt; &quot; = &quot; &lt;&lt; wire_pitch*wire_pitch &lt;&lt;&quot;(&quot;&lt;&lt;trkw[i]&lt;&lt;&quot;-&quot;&lt;&lt;w0&lt;&lt;&quot;)^2 + (&quot;&lt;&lt;trkx0[i]&lt;&lt;&quot;-&quot;&lt;&lt;x0&lt;&lt;&quot;)^2&quot;&lt;&lt;std::endl;</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    sptmap.insert(std::pair&lt;double, size_t&gt;(distance, i));</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="keywordflow">if</span> (w0 - trkw[i] &gt; 0)</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;      sptsignmap.insert(std::pair&lt;size_t, int&gt;(i, 1));</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      sptsignmap.insert(std::pair&lt;size_t, int&gt;(i, -1));</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  }</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="comment">//x,y,z vs distance</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  std::vector&lt;double&gt; vx;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  std::vector&lt;double&gt; vy;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  std::vector&lt;double&gt; vz;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  std::vector&lt;double&gt; vs;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <span class="keywordtype">double</span> kx = 0, ky = 0, kz = 0;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  <span class="keywordtype">int</span> np = 0;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> isp = sptmap.begin(); isp != sptmap.end(); isp++)</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  {</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="comment">//    const double *xyz = new double[3];</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="comment">//    xyz = isp-&gt;second-&gt;XYZ();</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keywordtype">double</span> xyz[3];</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    xyz[0] = trkx[isp-&gt;second];</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    xyz[1] = trky[isp-&gt;second];</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    xyz[2] = trkz[isp-&gt;second];</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keywordtype">double</span> distancesign = sptsignmap[isp-&gt;second];</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <span class="comment">//std::cout&lt;&lt;np&lt;&lt;&quot; &quot;&lt;&lt;xyz[0]&lt;&lt;&quot; &quot;&lt;&lt;xyz[1]&lt;&lt;&quot; &quot;&lt;&lt;xyz[2]&lt;&lt;&quot; &quot;&lt;&lt;(*isp).first&lt;&lt;std::endl;</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="keywordflow">if</span> (np == 0 &amp;&amp; isp-&gt;first &gt; 30)</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    { <span class="comment">//hit not on track</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;      xyz3d[0] = std::numeric_limits&lt;double&gt;::lowest();</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      xyz3d[1] = std::numeric_limits&lt;double&gt;::lowest();</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      xyz3d[2] = std::numeric_limits&lt;double&gt;::lowest();</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      pitch = -1;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    }</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="comment">//std::cout&lt;&lt;np&lt;&lt;&quot; &quot;&lt;&lt;xyz[0]&lt;&lt;&quot; &quot;&lt;&lt;xyz[1]&lt;&lt;&quot; &quot;&lt;&lt;xyz[2]&lt;&lt;&quot; &quot;&lt;&lt;(*isp).first&lt;&lt;&quot; Plane &quot; &lt;&lt; hit-&gt;WireID().Plane &lt;&lt; &quot; TPC &quot; &lt;&lt; hit-&gt;WireID().TPC &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="keywordflow">if</span> (np &lt; 5)</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    {</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;      vx.push_back(xyz[0]);</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;      vy.push_back(xyz[1]);</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      vz.push_back(xyz[2]);</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      vs.push_back(isp-&gt;first * distancesign);</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    }</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    {</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    }</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    np++;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="comment">//delete [] xyz;</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  }</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  <span class="comment">//std::cout&lt;&lt;&quot;np=&quot;&lt;&lt;np&lt;&lt;std::endl;</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;  <span class="keywordflow">if</span> (np &gt;= 2)</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  { <span class="comment">//at least two points</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <span class="comment">//std::cout &lt;&lt; &quot;At least 2 points..&quot;&lt;&lt;std::endl;</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    TGraph *xs = <span class="keyword">new</span> TGraph(np, &amp;vs[0], &amp;vx[0]);</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="comment">//for (int i = 0; i&lt;np; i++) std::cout&lt;&lt;i&lt;&lt;&quot; &quot;&lt;&lt;vs[i]&lt;&lt;&quot; &quot;&lt;&lt;vx[i]&lt;&lt;&quot; &quot;&lt;&lt;vy[i]&lt;&lt;&quot; &quot;&lt;&lt;vz[i]&lt;&lt;std::endl;</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="keywordflow">try</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    {</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      <span class="keywordflow">if</span> (np &gt; 2)</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;      {</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        xs-&gt;Fit(<span class="stringliteral">&quot;pol2&quot;</span>, <span class="stringliteral">&quot;Q&quot;</span>);</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      }</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      {</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        xs-&gt;Fit(<span class="stringliteral">&quot;pol1&quot;</span>, <span class="stringliteral">&quot;Q&quot;</span>);</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      }</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;      TF1 *pol = 0;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;      <span class="keywordflow">if</span> (np &gt; 2)</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        pol = (TF1 *)xs-&gt;GetFunction(<span class="stringliteral">&quot;pol2&quot;</span>);</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        pol = (TF1 *)xs-&gt;GetFunction(<span class="stringliteral">&quot;pol1&quot;</span>);</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      xyz3d[0] = pol-&gt;Eval(0);</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      kx = pol-&gt;GetParameter(1);</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      <span class="comment">//std::cout&lt;&lt;&quot;X fit &quot;&lt;&lt;xyz3d[0]&lt;&lt;&quot; &quot;&lt;&lt;kx&lt;&lt;std::endl;</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    }</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="keywordflow">catch</span> (...)</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    {</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;      mf::LogWarning(<span class="stringliteral">&quot;Calorimetry::GetPitch&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Fitter failed&quot;</span>;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;      xyz3d[0] = vx[0];</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    }</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <span class="keyword">delete</span> xs;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    TGraph *ys = <span class="keyword">new</span> TGraph(np, &amp;vs[0], &amp;vy[0]);</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="keywordflow">try</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    {</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      <span class="keywordflow">if</span> (np &gt; 2)</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;      {</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        ys-&gt;Fit(<span class="stringliteral">&quot;pol2&quot;</span>, <span class="stringliteral">&quot;Q&quot;</span>);</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;      }</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      {</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        ys-&gt;Fit(<span class="stringliteral">&quot;pol1&quot;</span>, <span class="stringliteral">&quot;Q&quot;</span>);</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      }</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      TF1 *pol = 0;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      <span class="keywordflow">if</span> (np &gt; 2)</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        pol = (TF1 *)ys-&gt;GetFunction(<span class="stringliteral">&quot;pol2&quot;</span>);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        pol = (TF1 *)ys-&gt;GetFunction(<span class="stringliteral">&quot;pol1&quot;</span>);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      xyz3d[1] = pol-&gt;Eval(0);</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;      ky = pol-&gt;GetParameter(1);</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;      <span class="comment">//std::cout&lt;&lt;&quot;Y fit &quot;&lt;&lt;xyz3d[1]&lt;&lt;&quot; &quot;&lt;&lt;ky&lt;&lt;std::endl;</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    }</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="keywordflow">catch</span> (...)</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    {</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;      mf::LogWarning(<span class="stringliteral">&quot;Calorimetry::GetPitch&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Fitter failed&quot;</span>;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      xyz3d[1] = vy[0];</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    }</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="keyword">delete</span> ys;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    TGraph *zs = <span class="keyword">new</span> TGraph(np, &amp;vs[0], &amp;vz[0]);</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="keywordflow">try</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    {</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;      <span class="keywordflow">if</span> (np &gt; 2)</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;      {</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        zs-&gt;Fit(<span class="stringliteral">&quot;pol2&quot;</span>, <span class="stringliteral">&quot;Q&quot;</span>);</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;      }</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      {</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        zs-&gt;Fit(<span class="stringliteral">&quot;pol1&quot;</span>, <span class="stringliteral">&quot;Q&quot;</span>);</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      }</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      TF1 *pol = 0;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      <span class="keywordflow">if</span> (np &gt; 2)</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        pol = (TF1 *)zs-&gt;GetFunction(<span class="stringliteral">&quot;pol2&quot;</span>);</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        pol = (TF1 *)zs-&gt;GetFunction(<span class="stringliteral">&quot;pol1&quot;</span>);</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;      xyz3d[2] = pol-&gt;Eval(0);</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      kz = pol-&gt;GetParameter(1);</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      <span class="comment">//std::cout&lt;&lt;&quot;Z fit &quot;&lt;&lt;xyz3d[2]&lt;&lt;&quot; &quot;&lt;&lt;kz&lt;&lt;std::endl;</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    }</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="keywordflow">catch</span> (...)</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    {</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      mf::LogWarning(<span class="stringliteral">&quot;Calorimetry::GetPitch&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Fitter failed&quot;</span>;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      xyz3d[2] = vz[0];</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    }</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <span class="keyword">delete</span> zs;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  }</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (np)</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  {</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    xyz3d[0] = vx[0];</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    xyz3d[1] = vy[0];</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    xyz3d[2] = vz[0];</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  }</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  {</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    xyz3d[0] = std::numeric_limits&lt;double&gt;::lowest();</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    xyz3d[1] = std::numeric_limits&lt;double&gt;::lowest();</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    xyz3d[2] = std::numeric_limits&lt;double&gt;::lowest();</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    pitch = -1;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  }</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  pitch = -1;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <span class="keywordflow">if</span> (kx * kx + ky * ky + kz * kz)</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  {</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <span class="keywordtype">double</span> tot = sqrt(kx * kx + ky * ky + kz * kz);</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    kx /= tot;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    ky /= tot;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    kz /= tot;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <span class="comment">//get pitch</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    <span class="keywordtype">double</span> wirePitch = geom-&gt;WirePitch(hit-&gt;WireID().Plane, hit-&gt;WireID().TPC, hit-&gt;WireID().Cryostat);</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="keywordtype">double</span> angleToVert = geom-&gt;Plane(hit-&gt;WireID().Plane, hit-&gt;WireID().TPC, hit-&gt;WireID().Cryostat).Wire(0).ThetaZ(<span class="keyword">false</span>) - 0.5 * TMath::Pi();</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="keywordtype">double</span> cosgamma = TMath::Abs(TMath::Sin(angleToVert) * ky + TMath::Cos(angleToVert) * kz);</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    <span class="keywordflow">if</span> (cosgamma &gt; 0)</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      pitch = wirePitch / cosgamma;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="comment">//Correct for SCE</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a> posOffsets = {0., 0., 0.};</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a> dirOffsets = {0., 0., 0.};</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keywordflow">if</span> (sce-&gt;EnableCalSpatialSCE() &amp;&amp; fSCE)</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      posOffsets = sce-&gt;GetCalPosOffsets(<a class="code" href="../../d6/d23/namespacegeo.html#a5a6f22c2aa9d0ccf6ca08bf2773a0541">geo::Point_t</a>{xyz3d[0], xyz3d[1], xyz3d[2]}, hit-&gt;WireID().TPC);</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="keywordflow">if</span> (sce-&gt;EnableCalSpatialSCE() &amp;&amp; fSCE)</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;      dirOffsets = sce-&gt;GetCalPosOffsets(<a class="code" href="../../d6/d23/namespacegeo.html#a5a6f22c2aa9d0ccf6ca08bf2773a0541">geo::Point_t</a>{xyz3d[0] + pitch * kx, xyz3d[1] + pitch * ky, xyz3d[2] + pitch * kz}, <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;WireID().TPC);</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    xyz3d[0] = xyz3d[0] - posOffsets.X();</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    xyz3d[1] = xyz3d[1] + posOffsets.Y();</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    xyz3d[2] = xyz3d[2] + posOffsets.Z();</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="comment">//Correct pitch for SCE</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    TVector3 <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> = {pitch * kx - dirOffsets.X() + posOffsets.X(), pitch * ky + dirOffsets.Y() - posOffsets.Y(), pitch * kz + dirOffsets.Z() - posOffsets.Z()};</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    pitch = dir.Mag();</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  }</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="comment">//std::cout &lt;&lt; &quot;At end of get pitch &quot; &lt;&lt; xyz3d[0] &lt;&lt; &quot; &quot; &lt;&lt; xyz3d[1] &lt;&lt; &quot; &quot; &lt;&lt; xyz3d[2] &lt;&lt; &quot; &quot; &lt;&lt; x0 &lt;&lt; &quot; &quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;}</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="keyword">namespace </span><a class="code" href="../../db/d54/pid_8fcl.html#af0bae0facc8191fc6df47d3c75a24e2f">calo</a></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;{</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;DEFINE_ART_MODULE(CalorimetryICARUS)</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;} <span class="comment">// namespace calo</span></div>
<div class="ttc" id="SpaceCharge_8h_html"><div class="ttname"><a href="../../d3/db6/SpaceCharge_8h.html">SpaceCharge.h</a></div></div>
<div class="ttc" id="namespacegeo_html_a22d2a7c73b2795146b92cd54ded9e817"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a></div><div class="ttdeci">ROOT::Math::DisplacementVector3D&lt; ROOT::Math::Cartesian3D&lt; double &gt;, ROOT::Math::GlobalCoordinateSystemTag &gt; Vector_t</div><div class="ttdoc">Type for representation of momenta in 3D space. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7d/geo__vectors_8h_source.html#l00164">geo_vectors.h:164</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_ae5770793d013875db997a3fd7383666c"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#ae5770793d013875db997a3fd7383666c">calo::CalorimetryICARUS::ReadCaloTree</a></div><div class="ttdeci">void ReadCaloTree()</div></div>
<div class="ttc" id="NumericUtils_8h_html"><div class="ttname"><a href="../../da/d16/NumericUtils_8h.html">NumericUtils.h</a></div><div class="ttdoc">Functions to help with numbers. </div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_aa72ee229c5962fb905dfbe4864340385"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#aa72ee229c5962fb905dfbe4864340385">calo::CalorimetryICARUS::fUseIntegral</a></div><div class="ttdeci">bool fUseIntegral</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00106">CalorimetryICARUS_module.cc:106</a></div></div>
<div class="ttc" id="rawdigitfilter__icarus_8fcl_html_aa2b9cfdf9a8f294302be0cdf6affea22"><div class="ttname"><a href="../../d6/d5e/rawdigitfilter__icarus_8fcl.html#aa2b9cfdf9a8f294302be0cdf6affea22">Plane</a></div><div class="ttdeci">BEGIN_PROLOG true icarus_rawdigitfilter FilterTools FilterPlane1 Plane</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d5e/rawdigitfilter__icarus_8fcl_source.html#l00008">rawdigitfilter_icarus.fcl:8</a></div></div>
<div class="ttc" id="run__opflash__electron_8fcl_html_a6673f03521899f7844189bcfd8ee5941"><div class="ttname"><a href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a></div><div class="ttdeci">process_name opflash particleana ie x</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d84/run__opflash__electron_8fcl_source.html#l00090">run_opflash_electron.fcl:90</a></div></div>
<div class="ttc" id="classlariov_1_1ChannelStatusProvider_html_abda9787c4790d2e8a5cfbd5d3a806fb1"><div class="ttname"><a href="../../d8/d7e/classlariov_1_1ChannelStatusProvider.html#abda9787c4790d2e8a5cfbd5d3a806fb1">lariov::ChannelStatusProvider::IsBad</a></div><div class="ttdeci">virtual bool IsBad(raw::ChannelID_t channel) const =0</div><div class="ttdoc">Returns whether the specified channel is bad in the current run. </div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_abedea72f89ff81470efb94d4462b4d6b"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#abedea72f89ff81470efb94d4462b4d6b">calo::CalorimetryICARUS::fSCE</a></div><div class="ttdeci">bool fSCE</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00107">CalorimetryICARUS_module.cc:107</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_a0dde643f7c31a30a7017ca88fbbc4e16"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a0dde643f7c31a30a7017ca88fbbc4e16">calo::CalorimetryICARUS::CalorimetryICARUS</a></div><div class="ttdeci">CalorimetryICARUS(fhicl::ParameterSet const &amp;pset)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00130">CalorimetryICARUS_module.cc:130</a></div></div>
<div class="ttc" id="Hit_8h_html"><div class="ttname"><a href="../../de/d26/Hit_8h.html">Hit.h</a></div><div class="ttdoc">Declaration of signal hit object. </div></div>
<div class="ttc" id="classdetinfo_1_1DetectorPropertiesData_html"><div class="ttname"><a href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7a/DetectorPropertiesData_8h_source.html#l00011">DetectorPropertiesData.h:11</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_a2975eec86ea0cbbb59cc9d449d1f3954"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a2975eec86ea0cbbb59cc9d449d1f3954">calo::CalorimetryICARUS::fMIPs</a></div><div class="ttdeci">std::vector&lt; double &gt; fMIPs</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00117">CalorimetryICARUS_module.cc:117</a></div></div>
<div class="ttc" id="structgeo_1_1PlaneID_html"><div class="ttname"><a href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a></div><div class="ttdoc">The data type to uniquely identify a Plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00472">geo_types.h:472</a></div></div>
<div class="ttc" id="structgeo_1_1CryostatID_html_a9384db80f2ab08f013fc630316d7bd05"><div class="ttname"><a href="../../d9/d73/structgeo_1_1CryostatID.html#a9384db80f2ab08f013fc630316d7bd05">geo::CryostatID::isValid</a></div><div class="ttdeci">bool isValid</div><div class="ttdoc">Whether this ID points to a valid element. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00211">geo_types.h:211</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html">calo::CalorimetryICARUS</a></div><div class="ttdoc">Estimates the energy deposited by reconstructed tracks. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00086">CalorimetryICARUS_module.cc:86</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_a4f86f384dbbf16816e76dcbfc8f6376b"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a4f86f384dbbf16816e76dcbfc8f6376b">calo::CalorimetryICARUS::ftime</a></div><div class="ttdeci">std::vector&lt; double &gt; ftime</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00114">CalorimetryICARUS_module.cc:114</a></div></div>
<div class="ttc" id="TrackHitMeta_8h_html"><div class="ttname"><a href="../../dc/de1/TrackHitMeta_8h.html">TrackHitMeta.h</a></div><div class="ttdoc">Class to keep data related to recob::Hit associated with recob::Track. </div></div>
<div class="ttc" id="pmttriggerproducer_8fcl_html_a527d89be40c3c20ca8162df059180fd9"><div class="ttname"><a href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">max</a></div><div class="ttdeci">BEGIN_PROLOG pmt_uncoated ideal single PE test page of manual option are OR or AND window for pmt trigger time start window for pmt trigger time end etc then what events all hists are saved for max</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5a/pmttriggerproducer_8fcl_source.html#l00023">pmttriggerproducer.fcl:23</a></div></div>
<div class="ttc" id="namespaceicarus_1_1ns_1_1util_html_aaae74cf315284bc0f44c2e050c119781"><div class="ttname"><a href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">icarus::ns::util::size</a></div><div class="ttdeci">std::size_t size(FixedBins&lt; T, C &gt; const &amp;) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dbd/FixedBins_8h_source.html#l00561">FixedBins.h:561</a></div></div>
<div class="ttc" id="T0_8h_html"><div class="ttname"><a href="../../dc/d14/T0_8h.html">T0.h</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_a2600ea0400a30dbfe8867125d3e9bf07"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a2600ea0400a30dbfe8867125d3e9bf07">calo::CalorimetryICARUS::EndsOnBoundary</a></div><div class="ttdeci">bool EndsOnBoundary(art::Ptr&lt; recob::Track &gt; lar_track)</div></div>
<div class="ttc" id="classcalo_1_1CalorimetryIcarusAlg_html"><div class="ttname"><a href="../../db/d0e/classcalo_1_1CalorimetryIcarusAlg.html">calo::CalorimetryIcarusAlg</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d03/CalorimetryIcarusAlg_8h_source.html#l00032">CalorimetryIcarusAlg.h:32</a></div></div>
<div class="ttc" id="cheaterreco_8fcl_html_abf2e819dbf4c327e098bebd4b2dc0597"><div class="ttname"><a href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a></div><div class="ttdeci">process_name hit</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d36/cheaterreco_8fcl_source.html#l00051">cheaterreco.fcl:51</a></div></div>
<div class="ttc" id="find__global__symbol_8sh_html_ae2fcd9af85e9525dadab1ac2cb45a22d"><div class="ttname"><a href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a></div><div class="ttdeci">then echo echo For and will not be changed by echo further linking echo echo B echo The symbol is in the uninitialized data multiple common symbols may appear with the echo same name If the symbol is defined the common echo symbols are treated as undefined references For more echo details on common see the discussion of warn common echo in *Note Linker see the discussion of warn common echo in *Note Linker such as a global int variable echo as opposed to a large global array echo echo I echo The symbol is an indirect reference to another symbol This echo is a GNU extension to the a out object file format which is echo rarely used echo echo N echo The symbol is a debugging symbol echo echo R echo The symbol is in a read only data section echo echo S echo The symbol is in an uninitialized data section for small echo objects echo echo T echo The symbol is in the the normal defined echo symbol is used with no error When a weak undefined symbol echo is linked and the symbol is not the value of the echo weak symbol becomes zero with no error echo echo W echo The symbol is a weak symbol that has not been specifically echo tagged as a weak object symbol When a weak defined symbol echo is linked with a normal defined the normal defined echo symbol is used with no error When a weak undefined symbol echo is linked and the symbol is not the value of the echo weak symbol becomes zero with no error echo echo echo The symbol is a stabs symbol in an a out object file In echo this the next values printed are the stabs other echo the stabs desc and the stab type Stabs symbols are echo used to hold debugging information For more echo see *Note or object file format specific echo echo For Mac OS X</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/df9/find__global__symbol_8sh_source.html#l00107">find_global_symbol.sh:107</a></div></div>
<div class="ttc" id="SpaceChargeService_8h_html"><div class="ttname"><a href="../../d1/dda/SpaceChargeService_8h.html">SpaceChargeService.h</a></div></div>
<div class="ttc" id="classanab_1_1Calorimetry_html"><div class="ttname"><a href="../../db/ddb/classanab_1_1Calorimetry.html">anab::Calorimetry</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d83/Calorimetry_8h_source.html#l00022">Calorimetry.h:22</a></div></div>
<div class="ttc" id="sbnd__flashalgo_8fcl_html_a648c7afac4085c93cd1ba4a75dfe8818"><div class="ttname"><a href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a></div><div class="ttdeci">BEGIN_PROLOG TPC</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d22/sbnd__flashalgo_8fcl_source.html#l00014">sbnd_flashalgo.fcl:14</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_aeeb26c7297a4e61a67be431bd310a375"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#aeeb26c7297a4e61a67be431bd310a375">calo::CalorimetryICARUS::fNotOnTrackZcut</a></div><div class="ttdeci">std::optional&lt; double &gt; fNotOnTrackZcut</div><div class="ttdoc">Exclude trajectory points with z lower than this [cm]. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00109">CalorimetryICARUS_module.cc:109</a></div></div>
<div class="ttc" id="DetectorPropertiesService_8h_html"><div class="ttname"><a href="../../de/df8/DetectorPropertiesService_8h.html">DetectorPropertiesService.h</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_aba1923f2859a87e0565e057adebb1b10"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#aba1923f2859a87e0565e057adebb1b10">calo::CalorimetryICARUS::fdEdx</a></div><div class="ttdeci">std::vector&lt; double &gt; fdEdx</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00119">CalorimetryICARUS_module.cc:119</a></div></div>
<div class="ttc" id="pid_8fcl_html_af0bae0facc8191fc6df47d3c75a24e2f"><div class="ttname"><a href="../../db/d54/pid_8fcl.html#af0bae0facc8191fc6df47d3c75a24e2f">calo</a></div><div class="ttdeci">process_name can override from command line with o or output calo</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d54/pid_8fcl_source.html#l00040">pid.fcl:40</a></div></div>
<div class="ttc" id="namespacemake__calib__df_html_a2b8237bac57d5c373c623869ad4513c8"><div class="ttname"><a href="../../d6/d11/namespacemake__calib__df.html#a2b8237bac57d5c373c623869ad4513c8">make_calib_df.t0</a></div><div class="ttdeci">int t0</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d0e/make__calib__df_8py_source.html#l00042">make_calib_df.py:42</a></div></div>
<div class="ttc" id="sparse__vector__test_8cc_html_a39f16bf854ba527dee7eba5bbbd93f3f"><div class="ttname"><a href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a></div><div class="ttdeci">T abs(T value)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d59/sparse__vector__test_8cc_source.html#l00030">sparse_vector_test.cc:30</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_aea47fe8f54023c6fde37746cb3374378"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#aea47fe8f54023c6fde37746cb3374378">calo::CalorimetryICARUS::fpitch</a></div><div class="ttdeci">std::vector&lt; float &gt; fpitch</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00121">CalorimetryICARUS_module.cc:121</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_a6301ba491b1076a291102850587795a2"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a6301ba491b1076a291102850587795a2">calo::CalorimetryICARUS::produce</a></div><div class="ttdeci">void produce(art::Event &amp;evt) override</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00150">CalorimetryICARUS_module.cc:150</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_a12e5a90ab87dabfabbfc82bbd0867abc"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a12e5a90ab87dabfabbfc82bbd0867abc">calo::CalorimetryICARUS::fXYZ</a></div><div class="ttdeci">std::vector&lt; TVector3 &gt; fXYZ</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00122">CalorimetryICARUS_module.cc:122</a></div></div>
<div class="ttc" id="namespacegeo_1_1fhicl_html_a48509e22b6681725c899fc354de43ae2"><div class="ttname"><a href="../../d2/d66/namespacegeo_1_1fhicl.html#a48509e22b6681725c899fc354de43ae2">geo::fhicl::WireID</a></div><div class="ttdeci">IDparameter&lt; geo::WireID &gt; WireID</div><div class="ttdoc">Member type of validated geo::WireID parameter. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddc/geo__types__fhicl_8h_source.html#l00407">geo_types_fhicl.h:407</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_a3d22457e79b255e4e49e19f9ebbd80f5"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a3d22457e79b255e4e49e19f9ebbd80f5">calo::CalorimetryICARUS::caloAlg</a></div><div class="ttdeci">CalorimetryIcarusAlg caloAlg</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00110">CalorimetryICARUS_module.cc:110</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_addc20f2e718387df3ae6c7b852083026"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#addc20f2e718387df3ae6c7b852083026">calo::CalorimetryICARUS::fHitIndex</a></div><div class="ttdeci">std::vector&lt; size_t &gt; fHitIndex</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00123">CalorimetryICARUS_module.cc:123</a></div></div>
<div class="ttc" id="Calorimetry_8h_html"><div class="ttname"><a href="../../d4/d83/Calorimetry_8h.html">Calorimetry.h</a></div></div>
<div class="ttc" id="namespacerecob_1_1tracking_html_a2253bf96e69f939f133551c86bdd2e37"><div class="ttname"><a href="../../d6/d6b/namespacerecob_1_1tracking.html#a2253bf96e69f939f133551c86bdd2e37">recob::tracking::convertCollToPoint</a></div><div class="ttdeci">std::vector&lt; Point_t &gt; convertCollToPoint(std::vector&lt; Point &gt; const &amp;coll)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da9/TrackingTypes_8h_source.html#l00055">TrackingTypes.h:55</a></div></div>
<div class="ttc" id="classlariov_1_1ChannelStatusProvider_html"><div class="ttname"><a href="../../d8/d7e/classlariov_1_1ChannelStatusProvider.html">lariov::ChannelStatusProvider</a></div><div class="ttdoc">Class providing information about the quality of channels. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/ded/ChannelStatusProvider_8h_source.html#l00049">ChannelStatusProvider.h:49</a></div></div>
<div class="ttc" id="namespacesbn_html_a26e09a34b4fa0cd63629b6f2cfb241b8"><div class="ttname"><a href="../../d7/d67/namespacesbn.html#a26e09a34b4fa0cd63629b6f2cfb241b8">sbn::GetPitch</a></div><div class="ttdeci">double GetPitch(const geo::GeometryCore *geo, const spacecharge::SpaceCharge *sce, geo::Point_t loc, geo::Vector_t dir, geo::View_t view, geo::TPCID tpc, bool correct_sce, bool track_is_sce_corrected, float xsign=1.)</div><div class="ttdoc">Computes the track-pitch on a plane given an input direction and location. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df9/StubMergeAlgorithms_8cxx_source.html#l00047">StubMergeAlgorithms.cxx:47</a></div></div>
<div class="ttc" id="structgeo_1_1TPCID_html"><div class="ttname"><a href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a></div><div class="ttdoc">The data type to uniquely identify a TPC. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00386">geo_types.h:386</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_a777400ea2368c3dbde1c53a95d4c4a80"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a777400ea2368c3dbde1c53a95d4c4a80">calo::CalorimetryICARUS::fnsps</a></div><div class="ttdeci">int fnsps</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00112">CalorimetryICARUS_module.cc:112</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_ae9140e651f793edd2b43652a409c3e6a"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#ae9140e651f793edd2b43652a409c3e6a">calo::CalorimetryICARUS::GetPitch</a></div><div class="ttdeci">void GetPitch(detinfo::DetectorPropertiesData const &amp;detProp, art::Ptr&lt; recob::Hit &gt; hit, std::vector&lt; double &gt; trkx, std::vector&lt; double &gt; trky, std::vector&lt; double &gt; trkz, std::vector&lt; double &gt; trkw, std::vector&lt; double &gt; trkx0, double *xyz3d, double &amp;pitch, double TickT0)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00741">CalorimetryICARUS_module.cc:741</a></div></div>
<div class="ttc" id="namespacetca_html_a03d7925cba1cd1c5952d280736887b6b"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a03d7925cba1cd1c5952d280736887b6b">tca::dEdx</a></div><div class="ttdeci">float dEdx(detinfo::DetectorClocksData const &amp;clockData, detinfo::DetectorPropertiesData const &amp;detProp, const TCSlice &amp;slc, TP3D &amp;tp3d)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02686">PFPUtils.cxx:2686</a></div></div>
<div class="ttc" id="bj_2lardataobj_2RecoBase_2Track_8h_html"><div class="ttname"><a href="../../d7/d53/bj_2lardataobj_2RecoBase_2Track_8h.html">Track.h</a></div><div class="ttdoc">Provides recob::Track data product. </div></div>
<div class="ttc" id="namespacegen__crt__frags_html_a8cdc67339147aad209b4122a38d7e246"><div class="ttname"><a href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">gen_crt_frags.w</a></div><div class="ttdeci">tuple w</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d8c/gen__crt__frags_8py_source.html#l01416">gen_crt_frags.py:1416</a></div></div>
<div class="ttc" id="namespaceutil_html_aaae39c2a7066e6a24ff172e5471939ae"><div class="ttname"><a href="../../d6/d72/namespaceutil.html#aaae39c2a7066e6a24ff172e5471939ae">util::absDiff</a></div><div class="ttdeci">constexpr auto absDiff(A const &amp;a, B const &amp;b)</div><div class="ttdoc">Returns the absolute value of the difference between two values. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d16/NumericUtils_8h_source.html#l00043">NumericUtils.h:43</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_a25b8299b25f505c820b150bc30ba0a2b"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a25b8299b25f505c820b150bc30ba0a2b">calo::CalorimetryICARUS::fwire</a></div><div class="ttdeci">std::vector&lt; int &gt; fwire</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00113">CalorimetryICARUS_module.cc:113</a></div></div>
<div class="ttc" id="namespacedropbox_html_a407b5b895ba9265893768748aaa73825"><div class="ttname"><a href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dropbox.dir</a></div><div class="ttdeci">tuple dir</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d81/dropbox_8py_source.html#l00028">dropbox.py:28</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_afdcac46c473f832a0d9cdd48fbf926b1"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#afdcac46c473f832a0d9cdd48fbf926b1">calo::CalorimetryICARUS::fUseArea</a></div><div class="ttdeci">bool fUseArea</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00105">CalorimetryICARUS_module.cc:105</a></div></div>
<div class="ttc" id="WireGeo_8h_html"><div class="ttname"><a href="../../da/de5/WireGeo_8h.html">WireGeo.h</a></div><div class="ttdoc">Encapsulate the geometry of a wire. </div></div>
<div class="ttc" id="classdetinfo_1_1DetectorPropertiesData_html_a8e4b4b8d755ffded5a9f956ae7c9c1ec"><div class="ttname"><a href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a8e4b4b8d755ffded5a9f956ae7c9c1ec">detinfo::DetectorPropertiesData::ConvertTicksToX</a></div><div class="ttdeci">double ConvertTicksToX(double ticks, int p, int t, int c) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d64/DetectorPropertiesData_8cc_source.html#l00115">DetectorPropertiesData.cc:115</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_ae0540c5ec3803bc0e7a75f0e4d3841c0"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#ae0540c5ec3803bc0e7a75f0e4d3841c0">calo::CalorimetryICARUS::fT0ModuleLabel</a></div><div class="ttdeci">std::string fT0ModuleLabel</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00104">CalorimetryICARUS_module.cc:104</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_ac721cba5fe3e190d15cd6291ef76182b"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#ac721cba5fe3e190d15cd6291ef76182b">calo::CalorimetryICARUS::fFlipTrack_dQdx</a></div><div class="ttdeci">bool fFlipTrack_dQdx</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00108">CalorimetryICARUS_module.cc:108</a></div></div>
<div class="ttc" id="namespaceutil_html_ac016dc123242a7f1d5c81594de910717"><div class="ttname"><a href="../../d6/d72/namespaceutil.html#ac016dc123242a7f1d5c81594de910717">util::CreateAssn</a></div><div class="ttdeci">bool CreateAssn(art::Event &amp;evt, std::vector&lt; T &gt; const &amp;a, art::Ptr&lt; U &gt; const &amp;b, art::Assns&lt; U, T &gt; &amp;assn, std::string a_instance, size_t index=UINT_MAX)</div><div class="ttdoc">Creates a single one-to-one association. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d9c/lardata_2lardata_2Utilities_2AssociationUtil_8h_source.html#l00581">lardata/lardata/Utilities/AssociationUtil.h:581</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_ad12a4b25a650d3a2c34f0ebe013f2131"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#ad12a4b25a650d3a2c34f0ebe013f2131">calo::CalorimetryICARUS::fstime</a></div><div class="ttdeci">std::vector&lt; double &gt; fstime</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00115">CalorimetryICARUS_module.cc:115</a></div></div>
<div class="ttc" id="CalorimetryIcarusAlg_8h_html"><div class="ttname"><a href="../../da/d03/CalorimetryIcarusAlg_8h.html">CalorimetryIcarusAlg.h</a></div></div>
<div class="ttc" id="SpacePoint_8h_html"><div class="ttname"><a href="../../d9/d12/SpacePoint_8h.html">SpacePoint.h</a></div></div>
<div class="ttc" id="PlaneGeo_8h_html"><div class="ttname"><a href="../../d8/d80/PlaneGeo_8h.html">PlaneGeo.h</a></div><div class="ttdoc">Encapsulate the construction of a single detector plane. </div></div>
<div class="ttc" id="lardata_2lardata_2Utilities_2AssociationUtil_8h_html"><div class="ttname"><a href="../../d5/d9c/lardata_2lardata_2Utilities_2AssociationUtil_8h.html">AssociationUtil.h</a></div></div>
<div class="ttc" id="classrecob_1_1Track_html_ab1291b0f34f4c62c8089bfd8a5eef464"><div class="ttname"><a href="../../d9/dca/classrecob_1_1Track.html#ab1291b0f34f4c62c8089bfd8a5eef464">recob::Track::Point_t</a></div><div class="ttdeci">tracking::Point_t Point_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d53/bj_2lardataobj_2RecoBase_2Track_8h_source.html#l00053">bj/lardataobj/RecoBase/Track.h:53</a></div></div>
<div class="ttc" id="namespacelar_1_1util_html_a6788fc3784bdf9eff832087f034412bb"><div class="ttname"><a href="../../d9/d3d/namespacelar_1_1util.html#a6788fc3784bdf9eff832087f034412bb">lar::util::TrackPitchInView</a></div><div class="ttdeci">double TrackPitchInView(recob::Track const &amp;track, geo::View_t view, size_t trajectory_point=0U)</div><div class="ttdoc">Returns the projected length of track on a wire pitch step [cm]. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd9/TrackUtils_8cxx_source.html#l00078">TrackUtils.cxx:78</a></div></div>
<div class="ttc" id="ChannelStatusProvider_8h_html"><div class="ttname"><a href="../../d7/ded/ChannelStatusProvider_8h.html">ChannelStatusProvider.h</a></div><div class="ttdoc">Interface for experiment-specific channel quality info provider. </div></div>
<div class="ttc" id="updateVersionList_8sh_html_a067a8c1534d6da9b2c501a6cf4ef89bd"><div class="ttname"><a href="../../d4/dca/updateVersionList_8sh.html#a067a8c1534d6da9b2c501a6cf4ef89bd">e</a></div><div class="ttdeci">do i e</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/updateVersionList_8sh_source.html#l00068">updateVersionList.sh:68</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_a3f309f9c946ef109cac779abee3a3954"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a3f309f9c946ef109cac779abee3a3954">calo::CalorimetryICARUS::fetime</a></div><div class="ttdeci">std::vector&lt; double &gt; fetime</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00116">CalorimetryICARUS_module.cc:116</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_ab909865a1c49cd5e1f7cf6d070522117"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#ab909865a1c49cd5e1f7cf6d070522117">calo::CalorimetryICARUS::BeginsOnBoundary</a></div><div class="ttdeci">bool BeginsOnBoundary(art::Ptr&lt; recob::Track &gt; lar_track)</div></div>
<div class="ttc" id="namespaceutil_html_a85007be2ce41bf247364673c302f8a5b"><div class="ttname"><a href="../../d6/d72/namespaceutil.html#a85007be2ce41bf247364673c302f8a5b">util::kBogusD</a></div><div class="ttdeci">constexpr double kBogusD</div><div class="ttdoc">obviously bogus double value </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d09/PhysicalConstants_8h_source.html#l00071">PhysicalConstants.h:71</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_a85b2321c92e5c85fa2d432f0fc132303"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a85b2321c92e5c85fa2d432f0fc132303">calo::CalorimetryICARUS::fSpacePointModuleLabel</a></div><div class="ttdeci">std::string fSpacePointModuleLabel</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00103">CalorimetryICARUS_module.cc:103</a></div></div>
<div class="ttc" id="namespacetca_html_a3bc30aeace71ea50324b602afa2155f2"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">tca::evt</a></div><div class="ttdeci">TCEvent evt</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/DataStructs_8cxx_source.html#l00007">DataStructs.cxx:7</a></div></div>
<div class="ttc" id="structgeo_1_1TPCID_html_a4a7f86b46d9d48a040b7ef5d65973811"><div class="ttname"><a href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">geo::TPCID::TPC</a></div><div class="ttdeci">TPCID_t TPC</div><div class="ttdoc">Index of the TPC within its cryostat. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00406">geo_types.h:406</a></div></div>
<div class="ttc" id="ChannelStatusService_8h_html"><div class="ttname"><a href="../../d8/da1/ChannelStatusService_8h.html">ChannelStatusService.h</a></div><div class="ttdoc">Interface for experiment-specific service for channel quality info. </div></div>
<div class="ttc" id="PhysicalConstants_8h_html"><div class="ttname"><a href="../../dd/d09/PhysicalConstants_8h.html">PhysicalConstants.h</a></div><div class="ttdoc">Collection of Physical constants used in LArSoft. </div></div>
<div class="ttc" id="runFilesFromSAM_8sh_html_aeee9f371db14fda0de35d16324a167df"><div class="ttname"><a href="../../d0/d8f/runFilesFromSAM_8sh.html#aeee9f371db14fda0de35d16324a167df">loc</a></div><div class="ttdeci">loc</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8f/runFilesFromSAM_8sh_source.html#l00257">runFilesFromSAM.sh:257</a></div></div>
<div class="ttc" id="namespacedetinfo_html_a0c4d3d5b85e37497364174c3513ffcae"><div class="ttname"><a href="../../d7/d8a/namespacedetinfo.html#a0c4d3d5b85e37497364174c3513ffcae">detinfo::sampling_rate</a></div><div class="ttdeci">double sampling_rate(DetectorClocksData const &amp;data)</div><div class="ttdoc">Returns the period of the TPC readout electronics clock. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d5b/DetectorClocksData_8h_source.html#l00643">DetectorClocksData.h:643</a></div></div>
<div class="ttc" id="namespacegeo_html_a5a6f22c2aa9d0ccf6ca08bf2773a0541"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#a5a6f22c2aa9d0ccf6ca08bf2773a0541">geo::Point_t</a></div><div class="ttdeci">ROOT::Math::PositionVector3D&lt; ROOT::Math::Cartesian3D&lt; double &gt;, ROOT::Math::GlobalCoordinateSystemTag &gt; Point_t</div><div class="ttdoc">Type for representation of position in physical 3D space. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7d/geo__vectors_8h_source.html#l00184">geo_vectors.h:184</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_a985d7ca38c27647540ca52c50d4c6876"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a985d7ca38c27647540ca52c50d4c6876">calo::CalorimetryICARUS::fTrackModuleLabel</a></div><div class="ttdeci">std::string fTrackModuleLabel</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00102">CalorimetryICARUS_module.cc:102</a></div></div>
<div class="ttc" id="TrackUtils_8h_html"><div class="ttname"><a href="../../d2/d97/TrackUtils_8h.html">TrackUtils.h</a></div><div class="ttdoc">Utility functions to extract information from recob::Track </div></div>
<div class="ttc" id="messageservice_8fcl_html_a6699b4dbd72f548e48d81c88697d35a6"><div class="ttname"><a href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">cout</a></div><div class="ttdeci">BEGIN_PROLOG could also be cout</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/df5/messageservice_8fcl_source.html#l00010">messageservice.fcl:10</a></div></div>
<div class="ttc" id="namespacedetsim_html_a560adbb3abf95a23d45a53ed25d8c0c7"><div class="ttname"><a href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detsim::detProp</a></div><div class="ttdeci">auto const detProp</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/SimWire__module_8cc_source.html#l00154">SimWire_module.cc:154</a></div></div>
<div class="ttc" id="gen__protons_8fcl_html_a2ba58fd55d60df6cb1370202e33b642e"><div class="ttname"><a href="../../db/dd5/gen__protons_8fcl.html#a2ba58fd55d60df6cb1370202e33b642e">T0</a></div><div class="ttdeci">process_name opdaq physics producers generator physics producers generator physics producers generator physics producers generator physics producers generator physics producers generator physics producers generator physics producers generator T0</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dd5/gen__protons_8fcl_source.html#l00045">gen_protons.fcl:45</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_a55f99f1499c61988a7edebec02d0d2f0"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a55f99f1499c61988a7edebec02d0d2f0">calo::CalorimetryICARUS::fdQdx</a></div><div class="ttdeci">std::vector&lt; double &gt; fdQdx</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00118">CalorimetryICARUS_module.cc:118</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryICARUS_html_a8c8a77c26847ebcd873095c0555e9787"><div class="ttname"><a href="../../d2/d02/classcalo_1_1CalorimetryICARUS.html#a8c8a77c26847ebcd873095c0555e9787">calo::CalorimetryICARUS::fResRng</a></div><div class="ttdeci">std::vector&lt; double &gt; fResRng</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df0/CalorimetryICARUS__module_8cc_source.html#l00120">CalorimetryICARUS_module.cc:120</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
