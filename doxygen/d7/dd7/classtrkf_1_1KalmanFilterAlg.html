<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>trkf::KalmanFilterAlg Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="../../hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="../../functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d0/da2/namespacetrkf.html">trkf</a></li><li class="navelem"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html">KalmanFilterAlg</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="../../d0/d77/classtrkf_1_1KalmanFilterAlg-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">trkf::KalmanFilterAlg Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ae22aa4a910f70f1ecd56de67494db70d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae22aa4a910f70f1ecd56de67494db70d">KalmanFilterAlg</a> (const fhicl::ParameterSet &amp;pset)</td></tr>
<tr class="memdesc:ae22aa4a910f70f1ecd56de67494db70d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="#ae22aa4a910f70f1ecd56de67494db70d">More...</a><br/></td></tr>
<tr class="separator:ae22aa4a910f70f1ecd56de67494db70d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a504f5ddae4c107e296f085b8d8792d7b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a504f5ddae4c107e296f085b8d8792d7b">getTrace</a> () const </td></tr>
<tr class="memdesc:a504f5ddae4c107e296f085b8d8792d7b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Trace config parameters.  <a href="#a504f5ddae4c107e296f085b8d8792d7b">More...</a><br/></td></tr>
<tr class="separator:a504f5ddae4c107e296f085b8d8792d7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3c277f05df0f31630f248fbf59c3494"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ac3c277f05df0f31630f248fbf59c3494">getPlane</a> () const </td></tr>
<tr class="memdesc:ac3c277f05df0f31630f248fbf59c3494"><td class="mdescLeft">&#160;</td><td class="mdescRight">Preferred view plane.  <a href="#ac3c277f05df0f31630f248fbf59c3494">More...</a><br/></td></tr>
<tr class="separator:ac3c277f05df0f31630f248fbf59c3494"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05d9ee3aac6fecd86ddc9da64ee83785"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a05d9ee3aac6fecd86ddc9da64ee83785">setTrace</a> (bool <a class="el" href="../../d0/da2/namespacetrkf.html#a02fec8e0cecf3305fca58a71de0d42c1">trace</a>)</td></tr>
<tr class="memdesc:a05d9ee3aac6fecd86ddc9da64ee83785"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set trace config parameter.  <a href="#a05d9ee3aac6fecd86ddc9da64ee83785">More...</a><br/></td></tr>
<tr class="separator:a05d9ee3aac6fecd86ddc9da64ee83785"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a659e75ed385886b11601361421b7a3a9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a659e75ed385886b11601361421b7a3a9">setPlane</a> (int plane)</td></tr>
<tr class="memdesc:a659e75ed385886b11601361421b7a3a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set preferred view plane.  <a href="#a659e75ed385886b11601361421b7a3a9">More...</a><br/></td></tr>
<tr class="separator:a659e75ed385886b11601361421b7a3a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ef684650695df5d3f1bf71552576ab6"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a5ef684650695df5d3f1bf71552576ab6">buildTrack</a> (const <a class="el" href="../../da/dcf/classtrkf_1_1KTrack.html">KTrack</a> &amp;trk, <a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> &amp;trg, const <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a> &amp;prop, const <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354">Propagator::PropDirection</a> <a class="el" href="../../d6/d91/make__tar__sbnd_8sh.html#aaf78092b2b7e15dcd60eda6328769a09">dir</a>, <a class="el" href="../../d5/dcd/classtrkf_1_1KHitContainer.html">KHitContainer</a> &amp;hits, bool linear) const </td></tr>
<tr class="memdesc:a5ef684650695df5d3f1bf71552576ab6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Make a new track.  <a href="#a5ef684650695df5d3f1bf71552576ab6">More...</a><br/></td></tr>
<tr class="separator:a5ef684650695df5d3f1bf71552576ab6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae241a8a34643e37524cdec9b8fd2f7b5"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae241a8a34643e37524cdec9b8fd2f7b5">smoothTrack</a> (<a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> &amp;trg, <a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> *trg1, const <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a> &amp;prop) const </td></tr>
<tr class="memdesc:ae241a8a34643e37524cdec9b8fd2f7b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Smooth track.  <a href="#ae241a8a34643e37524cdec9b8fd2f7b5">More...</a><br/></td></tr>
<tr class="separator:ae241a8a34643e37524cdec9b8fd2f7b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f8e9a720427a64e88b24d109da0bfd6"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a2f8e9a720427a64e88b24d109da0bfd6">extendTrack</a> (<a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> &amp;trg, const <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a> &amp;prop, <a class="el" href="../../d5/dcd/classtrkf_1_1KHitContainer.html">KHitContainer</a> &amp;hits) const </td></tr>
<tr class="memdesc:a2f8e9a720427a64e88b24d109da0bfd6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add hits to existing track.  <a href="#a2f8e9a720427a64e88b24d109da0bfd6">More...</a><br/></td></tr>
<tr class="separator:a2f8e9a720427a64e88b24d109da0bfd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6aaeba5b204bf8af5c8e52043df09cbc"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a6aaeba5b204bf8af5c8e52043df09cbc">fitMomentumRange</a> (const <a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> &amp;trg, <a class="el" href="../../df/db0/classtrkf_1_1KETrack.html">KETrack</a> &amp;tremom) const </td></tr>
<tr class="memdesc:a6aaeba5b204bf8af5c8e52043df09cbc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Estimate track momentum using range.  <a href="#a6aaeba5b204bf8af5c8e52043df09cbc">More...</a><br/></td></tr>
<tr class="separator:a6aaeba5b204bf8af5c8e52043df09cbc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7dd1e940d54ff0f794c8c5be027ac50e"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a7dd1e940d54ff0f794c8c5be027ac50e">fitMomentumMS</a> (const <a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> &amp;trg, const <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a> &amp;prop, <a class="el" href="../../df/db0/classtrkf_1_1KETrack.html">KETrack</a> &amp;tremom) const </td></tr>
<tr class="memdesc:a7dd1e940d54ff0f794c8c5be027ac50e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Estimate track momentum using multiple scattering.  <a href="#a7dd1e940d54ff0f794c8c5be027ac50e">More...</a><br/></td></tr>
<tr class="separator:a7dd1e940d54ff0f794c8c5be027ac50e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f95ca6dd70252aa52effbcf378e7288"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a4f95ca6dd70252aa52effbcf378e7288">fitMomentum</a> (const <a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> &amp;trg, const <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a> &amp;prop, <a class="el" href="../../df/db0/classtrkf_1_1KETrack.html">KETrack</a> &amp;tremom) const </td></tr>
<tr class="memdesc:a4f95ca6dd70252aa52effbcf378e7288"><td class="mdescLeft">&#160;</td><td class="mdescRight">Estimate track momentum using either range or multiple scattering.  <a href="#a4f95ca6dd70252aa52effbcf378e7288">More...</a><br/></td></tr>
<tr class="separator:a4f95ca6dd70252aa52effbcf378e7288"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a5a5f4ed347ca0dad0faefae9adec93"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a2a5a5f4ed347ca0dad0faefae9adec93">updateMomentum</a> (const <a class="el" href="../../df/db0/classtrkf_1_1KETrack.html">KETrack</a> &amp;tremom, const <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a> &amp;prop, <a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> &amp;trg) const </td></tr>
<tr class="memdesc:a2a5a5f4ed347ca0dad0faefae9adec93"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set track momentum at each track surface.  <a href="#a2a5a5f4ed347ca0dad0faefae9adec93">More...</a><br/></td></tr>
<tr class="separator:a2a5a5f4ed347ca0dad0faefae9adec93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae505c5bbe7b919d15f3af3e32fd7ad68"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae505c5bbe7b919d15f3af3e32fd7ad68">smoothTrackIter</a> (int niter, <a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> &amp;trg, const <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a> &amp;prop) const </td></tr>
<tr class="memdesc:ae505c5bbe7b919d15f3af3e32fd7ad68"><td class="mdescLeft">&#160;</td><td class="mdescRight">Iteratively smooth a track.  <a href="#ae505c5bbe7b919d15f3af3e32fd7ad68">More...</a><br/></td></tr>
<tr class="separator:ae505c5bbe7b919d15f3af3e32fd7ad68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc18359dc25a380997a38d537eaeccad"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#afc18359dc25a380997a38d537eaeccad">cleanTrack</a> (<a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> &amp;trg) const </td></tr>
<tr class="memdesc:afc18359dc25a380997a38d537eaeccad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clean track by removing noise hits near endpoints.  <a href="#afc18359dc25a380997a38d537eaeccad">More...</a><br/></td></tr>
<tr class="separator:afc18359dc25a380997a38d537eaeccad"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a1e70c929d23cb24aae387474026a2ffa"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a></td></tr>
<tr class="memdesc:a1e70c929d23cb24aae387474026a2ffa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Trace flag.  <a href="#a1e70c929d23cb24aae387474026a2ffa">More...</a><br/></td></tr>
<tr class="separator:a1e70c929d23cb24aae387474026a2ffa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6bcc54a19e33e2e7639f6110c821ac2"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ab6bcc54a19e33e2e7639f6110c821ac2">fMaxPErr</a></td></tr>
<tr class="memdesc:ab6bcc54a19e33e2e7639f6110c821ac2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum pointing error for free propagation.  <a href="#ab6bcc54a19e33e2e7639f6110c821ac2">More...</a><br/></td></tr>
<tr class="separator:ab6bcc54a19e33e2e7639f6110c821ac2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab02403fa9fdf6f09573ce7d90feadad9"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ab02403fa9fdf6f09573ce7d90feadad9">fGoodPErr</a></td></tr>
<tr class="memdesc:ab02403fa9fdf6f09573ce7d90feadad9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pointing error threshold for switching to free propagation.  <a href="#ab02403fa9fdf6f09573ce7d90feadad9">More...</a><br/></td></tr>
<tr class="separator:ab02403fa9fdf6f09573ce7d90feadad9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a955c9082fc249a45f79f4a8997c6d291"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a955c9082fc249a45f79f4a8997c6d291">fMaxIncChisq</a></td></tr>
<tr class="memdesc:a955c9082fc249a45f79f4a8997c6d291"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum incremental chisquare to accept a hit.  <a href="#a955c9082fc249a45f79f4a8997c6d291">More...</a><br/></td></tr>
<tr class="separator:a955c9082fc249a45f79f4a8997c6d291"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4cd6ede9183db3c03fce6297237c1587"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a4cd6ede9183db3c03fce6297237c1587">fMaxSeedIncChisq</a></td></tr>
<tr class="memdesc:a4cd6ede9183db3c03fce6297237c1587"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum incremental chisquare to accept a hit in seed phase.  <a href="#a4cd6ede9183db3c03fce6297237c1587">More...</a><br/></td></tr>
<tr class="separator:a4cd6ede9183db3c03fce6297237c1587"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31d494ce1fe055c04e21df6864027279"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a31d494ce1fe055c04e21df6864027279">fMaxSmoothIncChisq</a></td></tr>
<tr class="memdesc:a31d494ce1fe055c04e21df6864027279"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum incremental chisquare to accept a hit in smooth phase.  <a href="#a31d494ce1fe055c04e21df6864027279">More...</a><br/></td></tr>
<tr class="separator:a31d494ce1fe055c04e21df6864027279"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd1ec322451d3befc68ecc5c66bf1cf7"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#abd1ec322451d3befc68ecc5c66bf1cf7">fMaxEndChisq</a></td></tr>
<tr class="memdesc:abd1ec322451d3befc68ecc5c66bf1cf7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum incremental chisquare for endpoint hit.  <a href="#abd1ec322451d3befc68ecc5c66bf1cf7">More...</a><br/></td></tr>
<tr class="separator:abd1ec322451d3befc68ecc5c66bf1cf7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbc4b24d83f7b22928fb9b8e3f57dee7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#adbc4b24d83f7b22928fb9b8e3f57dee7">fMinLHits</a></td></tr>
<tr class="memdesc:adbc4b24d83f7b22928fb9b8e3f57dee7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Minimum number of hits to turn off linearized propagation.  <a href="#adbc4b24d83f7b22928fb9b8e3f57dee7">More...</a><br/></td></tr>
<tr class="separator:adbc4b24d83f7b22928fb9b8e3f57dee7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf64b31d2add93fcfc89736839b4f72d"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aaf64b31d2add93fcfc89736839b4f72d">fMaxLDist</a></td></tr>
<tr class="memdesc:aaf64b31d2add93fcfc89736839b4f72d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum distance for linearized propagation.  <a href="#aaf64b31d2add93fcfc89736839b4f72d">More...</a><br/></td></tr>
<tr class="separator:aaf64b31d2add93fcfc89736839b4f72d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8450d720a8df6f545925efa49c17869f"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a8450d720a8df6f545925efa49c17869f">fMaxPredDist</a></td></tr>
<tr class="memdesc:a8450d720a8df6f545925efa49c17869f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum prediciton distance to accept a hit.  <a href="#a8450d720a8df6f545925efa49c17869f">More...</a><br/></td></tr>
<tr class="separator:a8450d720a8df6f545925efa49c17869f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1661d1cda07b5d91d6ddec6bca467b56"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1661d1cda07b5d91d6ddec6bca467b56">fMaxSeedPredDist</a></td></tr>
<tr class="memdesc:a1661d1cda07b5d91d6ddec6bca467b56"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum prediciton distance to accept a hit in seed phase.  <a href="#a1661d1cda07b5d91d6ddec6bca467b56">More...</a><br/></td></tr>
<tr class="separator:a1661d1cda07b5d91d6ddec6bca467b56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78b312879081cd58cc8ba80db633c875"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a78b312879081cd58cc8ba80db633c875">fMaxPropDist</a></td></tr>
<tr class="memdesc:a78b312879081cd58cc8ba80db633c875"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum propagation distance to candidate surface.  <a href="#a78b312879081cd58cc8ba80db633c875">More...</a><br/></td></tr>
<tr class="separator:a78b312879081cd58cc8ba80db633c875"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca86ef9f5e11ebb521a86c7f9a120251"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aca86ef9f5e11ebb521a86c7f9a120251">fMinSortDist</a></td></tr>
<tr class="memdesc:aca86ef9f5e11ebb521a86c7f9a120251"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sort low distance threshold.  <a href="#aca86ef9f5e11ebb521a86c7f9a120251">More...</a><br/></td></tr>
<tr class="separator:aca86ef9f5e11ebb521a86c7f9a120251"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a064806b6f47119501c2a4b1a8c0d43d4"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a064806b6f47119501c2a4b1a8c0d43d4">fMaxSortDist</a></td></tr>
<tr class="memdesc:a064806b6f47119501c2a4b1a8c0d43d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sort high distance threshold.  <a href="#a064806b6f47119501c2a4b1a8c0d43d4">More...</a><br/></td></tr>
<tr class="separator:a064806b6f47119501c2a4b1a8c0d43d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa116c60288b506aeddffd04ad08f9df"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#afa116c60288b506aeddffd04ad08f9df">fMaxSamePlane</a></td></tr>
<tr class="memdesc:afa116c60288b506aeddffd04ad08f9df"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum consecutive hits in same plane.  <a href="#afa116c60288b506aeddffd04ad08f9df">More...</a><br/></td></tr>
<tr class="separator:afa116c60288b506aeddffd04ad08f9df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf1964ef45b2fe837428a8719eddbe2e"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#abf1964ef45b2fe837428a8719eddbe2e">fGapDist</a></td></tr>
<tr class="memdesc:abf1964ef45b2fe837428a8719eddbe2e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Minimum gap distance.  <a href="#abf1964ef45b2fe837428a8719eddbe2e">More...</a><br/></td></tr>
<tr class="separator:abf1964ef45b2fe837428a8719eddbe2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d0ff60ed611fc2b67398f0855a5499e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a8d0ff60ed611fc2b67398f0855a5499e">fMaxNoiseHits</a></td></tr>
<tr class="memdesc:a8d0ff60ed611fc2b67398f0855a5499e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum number of hits in noise cluster.  <a href="#a8d0ff60ed611fc2b67398f0855a5499e">More...</a><br/></td></tr>
<tr class="separator:a8d0ff60ed611fc2b67398f0855a5499e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c04c3bbed317634e4f46079d79c4617"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a7c04c3bbed317634e4f46079d79c4617">fMinSampleDist</a></td></tr>
<tr class="memdesc:a7c04c3bbed317634e4f46079d79c4617"><td class="mdescLeft">&#160;</td><td class="mdescRight">Minimum sample distance (for momentum measurement).  <a href="#a7c04c3bbed317634e4f46079d79c4617">More...</a><br/></td></tr>
<tr class="separator:a7c04c3bbed317634e4f46079d79c4617"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9956be6404dc3569538feae4d1a0100d"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a9956be6404dc3569538feae4d1a0100d">fFitMomRange</a></td></tr>
<tr class="memdesc:a9956be6404dc3569538feae4d1a0100d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fit momentum using range.  <a href="#a9956be6404dc3569538feae4d1a0100d">More...</a><br/></td></tr>
<tr class="separator:a9956be6404dc3569538feae4d1a0100d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8264f4b6fe22a1d500b8bfaa353f29f"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae8264f4b6fe22a1d500b8bfaa353f29f">fFitMomMS</a></td></tr>
<tr class="memdesc:ae8264f4b6fe22a1d500b8bfaa353f29f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fit momentum using multiple scattering.  <a href="#ae8264f4b6fe22a1d500b8bfaa353f29f">More...</a><br/></td></tr>
<tr class="separator:ae8264f4b6fe22a1d500b8bfaa353f29f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98537b1f46ca2024dec2b9504c4fccc3"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">fGTrace</a></td></tr>
<tr class="memdesc:a98537b1f46ca2024dec2b9504c4fccc3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Graphical trace flag.  <a href="#a98537b1f46ca2024dec2b9504c4fccc3">More...</a><br/></td></tr>
<tr class="separator:a98537b1f46ca2024dec2b9504c4fccc3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ebc4c4ebd9dc2818c01c9efedb0a1a7"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a5ebc4c4ebd9dc2818c01c9efedb0a1a7">fGTraceWW</a></td></tr>
<tr class="memdesc:a5ebc4c4ebd9dc2818c01c9efedb0a1a7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Window width.  <a href="#a5ebc4c4ebd9dc2818c01c9efedb0a1a7">More...</a><br/></td></tr>
<tr class="separator:a5ebc4c4ebd9dc2818c01c9efedb0a1a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6bb8099e4dad21564e1d9a78ec54f3b3"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a6bb8099e4dad21564e1d9a78ec54f3b3">fGTraceWH</a></td></tr>
<tr class="memdesc:a6bb8099e4dad21564e1d9a78ec54f3b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Window height.  <a href="#a6bb8099e4dad21564e1d9a78ec54f3b3">More...</a><br/></td></tr>
<tr class="separator:a6bb8099e4dad21564e1d9a78ec54f3b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7320aebefc2a6f9678ca1f532da8ea7"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aa7320aebefc2a6f9678ca1f532da8ea7">fGTraceXMin</a></td></tr>
<tr class="memdesc:aa7320aebefc2a6f9678ca1f532da8ea7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Graphical trace minimum x.  <a href="#aa7320aebefc2a6f9678ca1f532da8ea7">More...</a><br/></td></tr>
<tr class="separator:aa7320aebefc2a6f9678ca1f532da8ea7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acba53dfdbc63042caf3c269aa7bed491"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#acba53dfdbc63042caf3c269aa7bed491">fGTraceXMax</a></td></tr>
<tr class="memdesc:acba53dfdbc63042caf3c269aa7bed491"><td class="mdescLeft">&#160;</td><td class="mdescRight">Graphical trace maximum x.  <a href="#acba53dfdbc63042caf3c269aa7bed491">More...</a><br/></td></tr>
<tr class="separator:acba53dfdbc63042caf3c269aa7bed491"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad78812f0d30f985143b40d639932efed"><td class="memItemLeft" align="right" valign="top">std::vector&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ad78812f0d30f985143b40d639932efed">fGTraceZMin</a></td></tr>
<tr class="memdesc:ad78812f0d30f985143b40d639932efed"><td class="mdescLeft">&#160;</td><td class="mdescRight">Graphical trace minimum z for each view.  <a href="#ad78812f0d30f985143b40d639932efed">More...</a><br/></td></tr>
<tr class="separator:ad78812f0d30f985143b40d639932efed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a669d84f36f01743ce8048e11b067b819"><td class="memItemLeft" align="right" valign="top">std::vector&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a669d84f36f01743ce8048e11b067b819">fGTraceZMax</a></td></tr>
<tr class="memdesc:a669d84f36f01743ce8048e11b067b819"><td class="mdescLeft">&#160;</td><td class="mdescRight">Graphical trace maximum z for each view.  <a href="#a669d84f36f01743ce8048e11b067b819">More...</a><br/></td></tr>
<tr class="separator:a669d84f36f01743ce8048e11b067b819"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18bdb931d6b6730cfe499df7379da449"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a18bdb931d6b6730cfe499df7379da449">fPlane</a></td></tr>
<tr class="memdesc:a18bdb931d6b6730cfe499df7379da449"><td class="mdescLeft">&#160;</td><td class="mdescRight">Preferred view plane.  <a href="#a18bdb931d6b6730cfe499df7379da449">More...</a><br/></td></tr>
<tr class="separator:a18bdb931d6b6730cfe499df7379da449"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae784305d3e992d3650c1aab19487c7b0"><td class="memItemLeft" align="right" valign="top">std::vector&lt; std::unique_ptr<br class="typebreak"/>
&lt; TCanvas &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a></td></tr>
<tr class="memdesc:ae784305d3e992d3650c1aab19487c7b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Graphical trace canvases.  <a href="#ae784305d3e992d3650c1aab19487c7b0">More...</a><br/></td></tr>
<tr class="separator:ae784305d3e992d3650c1aab19487c7b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20cddd0f3cbc4d4b2b999a42f0915b27"><td class="memItemLeft" align="right" valign="top">std::vector&lt; TVirtualPad * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a20cddd0f3cbc4d4b2b999a42f0915b27">fPads</a></td></tr>
<tr class="memdesc:a20cddd0f3cbc4d4b2b999a42f0915b27"><td class="mdescLeft">&#160;</td><td class="mdescRight">View pads in current canvas.  <a href="#a20cddd0f3cbc4d4b2b999a42f0915b27">More...</a><br/></td></tr>
<tr class="separator:a20cddd0f3cbc4d4b2b999a42f0915b27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab59822b5451db197c582cbd098be11a"><td class="memItemLeft" align="right" valign="top">TVirtualPad *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aab59822b5451db197c582cbd098be11a">fInfoPad</a></td></tr>
<tr class="memdesc:aab59822b5451db197c582cbd098be11a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Information pad.  <a href="#aab59822b5451db197c582cbd098be11a">More...</a><br/></td></tr>
<tr class="separator:aab59822b5451db197c582cbd098be11a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac88efbb9c1344f770aac5d9e11ebe9e9"><td class="memItemLeft" align="right" valign="top">TPaveText *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ac88efbb9c1344f770aac5d9e11ebe9e9">fMessages</a></td></tr>
<tr class="memdesc:ac88efbb9c1344f770aac5d9e11ebe9e9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Message box.  <a href="#ac88efbb9c1344f770aac5d9e11ebe9e9">More...</a><br/></td></tr>
<tr class="separator:ac88efbb9c1344f770aac5d9e11ebe9e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96c1397d785be158129c8d36ea6987a6"><td class="memItemLeft" align="right" valign="top">std::map&lt; int, TMarker * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a></td></tr>
<tr class="memdesc:a96c1397d785be158129c8d36ea6987a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Markers in current canvas.  <a href="#a96c1397d785be158129c8d36ea6987a6">More...</a><br/></td></tr>
<tr class="separator:a96c1397d785be158129c8d36ea6987a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00068">68</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ae22aa4a910f70f1ecd56de67494db70d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">trkf::KalmanFilterAlg::KalmanFilterAlg </td>
          <td>(</td>
          <td class="paramtype">const fhicl::ParameterSet &amp;&#160;</td>
          <td class="paramname"><em>pset</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor. </p>

<p>Definition at line <a class="el" href="../../d2/dab/KalmanFilterAlg_8cxx_source.html#l00226">226</a> of file <a class="el" href="../../d2/dab/KalmanFilterAlg_8cxx_source.html">KalmanFilterAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  : <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>(<span class="keyword">false</span>)</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ab6bcc54a19e33e2e7639f6110c821ac2">fMaxPErr</a>(0.)</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ab02403fa9fdf6f09573ce7d90feadad9">fGoodPErr</a>(0.)</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a955c9082fc249a45f79f4a8997c6d291">fMaxIncChisq</a>(0.)</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a4cd6ede9183db3c03fce6297237c1587">fMaxSeedIncChisq</a>(0.)</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a31d494ce1fe055c04e21df6864027279">fMaxSmoothIncChisq</a>(0.)</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#abd1ec322451d3befc68ecc5c66bf1cf7">fMaxEndChisq</a>(0.)</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#adbc4b24d83f7b22928fb9b8e3f57dee7">fMinLHits</a>(0)</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aaf64b31d2add93fcfc89736839b4f72d">fMaxLDist</a>(0.)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a8450d720a8df6f545925efa49c17869f">fMaxPredDist</a>(0.)</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1661d1cda07b5d91d6ddec6bca467b56">fMaxSeedPredDist</a>(0.)</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a78b312879081cd58cc8ba80db633c875">fMaxPropDist</a>(0.)</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aca86ef9f5e11ebb521a86c7f9a120251">fMinSortDist</a>(0.)</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a064806b6f47119501c2a4b1a8c0d43d4">fMaxSortDist</a>(0.)</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#afa116c60288b506aeddffd04ad08f9df">fMaxSamePlane</a>(0)</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#abf1964ef45b2fe837428a8719eddbe2e">fGapDist</a>(0.)</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a8d0ff60ed611fc2b67398f0855a5499e">fMaxNoiseHits</a>(0)</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a7c04c3bbed317634e4f46079d79c4617">fMinSampleDist</a>(0.)</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a9956be6404dc3569538feae4d1a0100d">fFitMomRange</a>(<span class="keyword">false</span>)</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae8264f4b6fe22a1d500b8bfaa353f29f">fFitMomMS</a>(<span class="keyword">false</span>)</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">fGTrace</a>(<span class="keyword">false</span>)</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a5ebc4c4ebd9dc2818c01c9efedb0a1a7">fGTraceWW</a>(0)</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a6bb8099e4dad21564e1d9a78ec54f3b3">fGTraceWH</a>(0)</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a18bdb931d6b6730cfe499df7379da449">fPlane</a>(-1)</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aab59822b5451db197c582cbd098be11a">fInfoPad</a>(0)</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  , <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ac88efbb9c1344f770aac5d9e11ebe9e9">fMessages</a>(0)</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;{</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  mf::LogInfo(<span class="stringliteral">&quot;KalmanFilterAlg&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;KalmanFilterAlg instantiated.&quot;</span>;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a> = pset.get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;Trace&quot;</span>);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ab6bcc54a19e33e2e7639f6110c821ac2">fMaxPErr</a> = pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;MaxPErr&quot;</span>);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ab02403fa9fdf6f09573ce7d90feadad9">fGoodPErr</a> = pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;GoodPErr&quot;</span>);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a955c9082fc249a45f79f4a8997c6d291">fMaxIncChisq</a> = pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;MaxIncChisq&quot;</span>);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a4cd6ede9183db3c03fce6297237c1587">fMaxSeedIncChisq</a> = pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;MaxSeedIncChisq&quot;</span>);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a31d494ce1fe055c04e21df6864027279">fMaxSmoothIncChisq</a> = pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;MaxSmoothIncChisq&quot;</span>);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#abd1ec322451d3befc68ecc5c66bf1cf7">fMaxEndChisq</a> = pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;MaxEndChisq&quot;</span>);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#adbc4b24d83f7b22928fb9b8e3f57dee7">fMinLHits</a> = pset.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;MinLHits&quot;</span>);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aaf64b31d2add93fcfc89736839b4f72d">fMaxLDist</a> = pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;MaxLDist&quot;</span>);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a8450d720a8df6f545925efa49c17869f">fMaxPredDist</a> = pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;MaxPredDist&quot;</span>);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1661d1cda07b5d91d6ddec6bca467b56">fMaxSeedPredDist</a> = pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;MaxSeedPredDist&quot;</span>);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a78b312879081cd58cc8ba80db633c875">fMaxPropDist</a> = pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;MaxPropDist&quot;</span>);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aca86ef9f5e11ebb521a86c7f9a120251">fMinSortDist</a> = pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;MinSortDist&quot;</span>);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a064806b6f47119501c2a4b1a8c0d43d4">fMaxSortDist</a> = pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;MaxSortDist&quot;</span>);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#afa116c60288b506aeddffd04ad08f9df">fMaxSamePlane</a> = pset.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;MaxSamePlane&quot;</span>);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#abf1964ef45b2fe837428a8719eddbe2e">fGapDist</a> = pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;GapDist&quot;</span>);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a8d0ff60ed611fc2b67398f0855a5499e">fMaxNoiseHits</a> = pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;MaxNoiseHits&quot;</span>);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a7c04c3bbed317634e4f46079d79c4617">fMinSampleDist</a> = pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;MinSampleDist&quot;</span>);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a9956be6404dc3569538feae4d1a0100d">fFitMomRange</a> = pset.get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;FitMomRange&quot;</span>);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae8264f4b6fe22a1d500b8bfaa353f29f">fFitMomMS</a> = pset.get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;FitMomMS&quot;</span>);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">fGTrace</a> = pset.get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;GTrace&quot;</span>);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="keywordflow">if</span> (fGTrace) {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a5ebc4c4ebd9dc2818c01c9efedb0a1a7">fGTraceWW</a> = pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;GTraceWW&quot;</span>);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a6bb8099e4dad21564e1d9a78ec54f3b3">fGTraceWH</a> = pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;GTraceWH&quot;</span>);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aa7320aebefc2a6f9678ca1f532da8ea7">fGTraceXMin</a> = pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;GTraceXMin&quot;</span>);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#acba53dfdbc63042caf3c269aa7bed491">fGTraceXMax</a> = pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;GTraceXMax&quot;</span>);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ad78812f0d30f985143b40d639932efed">fGTraceZMin</a> = pset.get&lt;std::vector&lt;double&gt;&gt;(<span class="stringliteral">&quot;GTraceZMin&quot;</span>);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a669d84f36f01743ce8048e11b067b819">fGTraceZMax</a> = pset.get&lt;std::vector&lt;double&gt;&gt;(<span class="stringliteral">&quot;GTraceZMax&quot;</span>);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  }</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;}</div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a98537b1f46ca2024dec2b9504c4fccc3"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">trkf::KalmanFilterAlg::fGTrace</a></div><div class="ttdeci">bool fGTrace</div><div class="ttdoc">Graphical trace flag. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00168">KalmanFilterAlg.h:168</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a9956be6404dc3569538feae4d1a0100d"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a9956be6404dc3569538feae4d1a0100d">trkf::KalmanFilterAlg::fFitMomRange</a></div><div class="ttdeci">bool fFitMomRange</div><div class="ttdoc">Fit momentum using range. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00166">KalmanFilterAlg.h:166</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a78b312879081cd58cc8ba80db633c875"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a78b312879081cd58cc8ba80db633c875">trkf::KalmanFilterAlg::fMaxPropDist</a></div><div class="ttdeci">double fMaxPropDist</div><div class="ttdoc">Maximum propagation distance to candidate surface. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00159">KalmanFilterAlg.h:159</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_abf1964ef45b2fe837428a8719eddbe2e"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#abf1964ef45b2fe837428a8719eddbe2e">trkf::KalmanFilterAlg::fGapDist</a></div><div class="ttdeci">double fGapDist</div><div class="ttdoc">Minimum gap distance. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00163">KalmanFilterAlg.h:163</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_ae8264f4b6fe22a1d500b8bfaa353f29f"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae8264f4b6fe22a1d500b8bfaa353f29f">trkf::KalmanFilterAlg::fFitMomMS</a></div><div class="ttdeci">bool fFitMomMS</div><div class="ttdoc">Fit momentum using multiple scattering. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00167">KalmanFilterAlg.h:167</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_abd1ec322451d3befc68ecc5c66bf1cf7"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#abd1ec322451d3befc68ecc5c66bf1cf7">trkf::KalmanFilterAlg::fMaxEndChisq</a></div><div class="ttdeci">double fMaxEndChisq</div><div class="ttdoc">Maximum incremental chisquare for endpoint hit. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00154">KalmanFilterAlg.h:154</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a1e70c929d23cb24aae387474026a2ffa"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">trkf::KalmanFilterAlg::fTrace</a></div><div class="ttdeci">bool fTrace</div><div class="ttdoc">Trace flag. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00148">KalmanFilterAlg.h:148</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_ad78812f0d30f985143b40d639932efed"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ad78812f0d30f985143b40d639932efed">trkf::KalmanFilterAlg::fGTraceZMin</a></div><div class="ttdeci">std::vector&lt; double &gt; fGTraceZMin</div><div class="ttdoc">Graphical trace minimum z for each view. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00173">KalmanFilterAlg.h:173</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_aaf64b31d2add93fcfc89736839b4f72d"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aaf64b31d2add93fcfc89736839b4f72d">trkf::KalmanFilterAlg::fMaxLDist</a></div><div class="ttdeci">double fMaxLDist</div><div class="ttdoc">Maximum distance for linearized propagation. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00156">KalmanFilterAlg.h:156</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a064806b6f47119501c2a4b1a8c0d43d4"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a064806b6f47119501c2a4b1a8c0d43d4">trkf::KalmanFilterAlg::fMaxSortDist</a></div><div class="ttdeci">double fMaxSortDist</div><div class="ttdoc">Sort high distance threshold. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00161">KalmanFilterAlg.h:161</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a1661d1cda07b5d91d6ddec6bca467b56"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1661d1cda07b5d91d6ddec6bca467b56">trkf::KalmanFilterAlg::fMaxSeedPredDist</a></div><div class="ttdeci">double fMaxSeedPredDist</div><div class="ttdoc">Maximum prediciton distance to accept a hit in seed phase. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00158">KalmanFilterAlg.h:158</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a8450d720a8df6f545925efa49c17869f"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a8450d720a8df6f545925efa49c17869f">trkf::KalmanFilterAlg::fMaxPredDist</a></div><div class="ttdeci">double fMaxPredDist</div><div class="ttdoc">Maximum prediciton distance to accept a hit. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00157">KalmanFilterAlg.h:157</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a6bb8099e4dad21564e1d9a78ec54f3b3"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a6bb8099e4dad21564e1d9a78ec54f3b3">trkf::KalmanFilterAlg::fGTraceWH</a></div><div class="ttdeci">double fGTraceWH</div><div class="ttdoc">Window height. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00170">KalmanFilterAlg.h:170</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_aab59822b5451db197c582cbd098be11a"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aab59822b5451db197c582cbd098be11a">trkf::KalmanFilterAlg::fInfoPad</a></div><div class="ttdeci">TVirtualPad * fInfoPad</div><div class="ttdoc">Information pad. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00181">KalmanFilterAlg.h:181</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_aa7320aebefc2a6f9678ca1f532da8ea7"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aa7320aebefc2a6f9678ca1f532da8ea7">trkf::KalmanFilterAlg::fGTraceXMin</a></div><div class="ttdeci">double fGTraceXMin</div><div class="ttdoc">Graphical trace minimum x. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00171">KalmanFilterAlg.h:171</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_ab02403fa9fdf6f09573ce7d90feadad9"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ab02403fa9fdf6f09573ce7d90feadad9">trkf::KalmanFilterAlg::fGoodPErr</a></div><div class="ttdeci">double fGoodPErr</div><div class="ttdoc">Pointing error threshold for switching to free propagation. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00150">KalmanFilterAlg.h:150</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_ac88efbb9c1344f770aac5d9e11ebe9e9"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ac88efbb9c1344f770aac5d9e11ebe9e9">trkf::KalmanFilterAlg::fMessages</a></div><div class="ttdeci">TPaveText * fMessages</div><div class="ttdoc">Message box. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00182">KalmanFilterAlg.h:182</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a4cd6ede9183db3c03fce6297237c1587"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a4cd6ede9183db3c03fce6297237c1587">trkf::KalmanFilterAlg::fMaxSeedIncChisq</a></div><div class="ttdeci">double fMaxSeedIncChisq</div><div class="ttdoc">Maximum incremental chisquare to accept a hit in seed phase. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00152">KalmanFilterAlg.h:152</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a31d494ce1fe055c04e21df6864027279"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a31d494ce1fe055c04e21df6864027279">trkf::KalmanFilterAlg::fMaxSmoothIncChisq</a></div><div class="ttdeci">double fMaxSmoothIncChisq</div><div class="ttdoc">Maximum incremental chisquare to accept a hit in smooth phase. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00153">KalmanFilterAlg.h:153</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a955c9082fc249a45f79f4a8997c6d291"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a955c9082fc249a45f79f4a8997c6d291">trkf::KalmanFilterAlg::fMaxIncChisq</a></div><div class="ttdeci">double fMaxIncChisq</div><div class="ttdoc">Maximum incremental chisquare to accept a hit. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00151">KalmanFilterAlg.h:151</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a7c04c3bbed317634e4f46079d79c4617"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a7c04c3bbed317634e4f46079d79c4617">trkf::KalmanFilterAlg::fMinSampleDist</a></div><div class="ttdeci">double fMinSampleDist</div><div class="ttdoc">Minimum sample distance (for momentum measurement). </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00165">KalmanFilterAlg.h:165</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_aca86ef9f5e11ebb521a86c7f9a120251"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aca86ef9f5e11ebb521a86c7f9a120251">trkf::KalmanFilterAlg::fMinSortDist</a></div><div class="ttdeci">double fMinSortDist</div><div class="ttdoc">Sort low distance threshold. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00160">KalmanFilterAlg.h:160</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_acba53dfdbc63042caf3c269aa7bed491"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#acba53dfdbc63042caf3c269aa7bed491">trkf::KalmanFilterAlg::fGTraceXMax</a></div><div class="ttdeci">double fGTraceXMax</div><div class="ttdoc">Graphical trace maximum x. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00172">KalmanFilterAlg.h:172</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a5ebc4c4ebd9dc2818c01c9efedb0a1a7"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a5ebc4c4ebd9dc2818c01c9efedb0a1a7">trkf::KalmanFilterAlg::fGTraceWW</a></div><div class="ttdeci">double fGTraceWW</div><div class="ttdoc">Window width. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00169">KalmanFilterAlg.h:169</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a669d84f36f01743ce8048e11b067b819"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a669d84f36f01743ce8048e11b067b819">trkf::KalmanFilterAlg::fGTraceZMax</a></div><div class="ttdeci">std::vector&lt; double &gt; fGTraceZMax</div><div class="ttdoc">Graphical trace maximum z for each view. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00174">KalmanFilterAlg.h:174</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_afa116c60288b506aeddffd04ad08f9df"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#afa116c60288b506aeddffd04ad08f9df">trkf::KalmanFilterAlg::fMaxSamePlane</a></div><div class="ttdeci">int fMaxSamePlane</div><div class="ttdoc">Maximum consecutive hits in same plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00162">KalmanFilterAlg.h:162</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a8d0ff60ed611fc2b67398f0855a5499e"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a8d0ff60ed611fc2b67398f0855a5499e">trkf::KalmanFilterAlg::fMaxNoiseHits</a></div><div class="ttdeci">int fMaxNoiseHits</div><div class="ttdoc">Maximum number of hits in noise cluster. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00164">KalmanFilterAlg.h:164</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_ab6bcc54a19e33e2e7639f6110c821ac2"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ab6bcc54a19e33e2e7639f6110c821ac2">trkf::KalmanFilterAlg::fMaxPErr</a></div><div class="ttdeci">double fMaxPErr</div><div class="ttdoc">Maximum pointing error for free propagation. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00149">KalmanFilterAlg.h:149</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_adbc4b24d83f7b22928fb9b8e3f57dee7"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#adbc4b24d83f7b22928fb9b8e3f57dee7">trkf::KalmanFilterAlg::fMinLHits</a></div><div class="ttdeci">int fMinLHits</div><div class="ttdoc">Minimum number of hits to turn off linearized propagation. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00155">KalmanFilterAlg.h:155</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a18bdb931d6b6730cfe499df7379da449"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a18bdb931d6b6730cfe499df7379da449">trkf::KalmanFilterAlg::fPlane</a></div><div class="ttdeci">int fPlane</div><div class="ttdoc">Preferred view plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00178">KalmanFilterAlg.h:178</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a5ef684650695df5d3f1bf71552576ab6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::KalmanFilterAlg::buildTrack </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../da/dcf/classtrkf_1_1KTrack.html">KTrack</a> &amp;&#160;</td>
          <td class="paramname"><em>trk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> &amp;&#160;</td>
          <td class="paramname"><em>trg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a> &amp;&#160;</td>
          <td class="paramname"><em>prop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354">Propagator::PropDirection</a>&#160;</td>
          <td class="paramname"><em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d5/dcd/classtrkf_1_1KHitContainer.html">KHitContainer</a> &amp;&#160;</td>
          <td class="paramname"><em>hits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>linear</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Make a new track. </p>
<p>Add hits to track.</p>
<p>Arguments:</p>
<p>trk - Starting track. trg - Result global track. prop - <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a>. dir - Direction. hits - Candidate hits.</p>
<p>Returns: True if success.</p>
<p>This method makes a unidirectional Kalman fit in the specified direction, visiting each surface of the passed <a class="el" href="../../d5/dcd/classtrkf_1_1KHitContainer.html">KHitContainer</a> and updating the track. In case of multiple measurements on the same surface, keep (at most) the one with the smallest incremental chisquare. Any measurements that fail the incremental chisquare cut are rejected. Resolved hits (accepted or rejected) are moved to the unused list in <a class="el" href="../../d5/dcd/classtrkf_1_1KHitContainer.html">KHitContainer</a>. The container is sorted at the start of the method, and may be resorted during the progress of the fit. </p>

<p>Definition at line <a class="el" href="../../d2/dab/KalmanFilterAlg_8cxx_source.html#l00310">310</a> of file <a class="el" href="../../d2/dab/KalmanFilterAlg_8cxx_source.html">KalmanFilterAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;{</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="comment">// Direction must be forward or backward (unknown is not allowed).</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> != <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">Propagator::FORWARD</a> &amp;&amp; <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> != <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354abb50b9e012a19f7643321f6aa64ecb19">Propagator::BACKWARD</a>)</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;KalmanFilterAlg&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;No direction for Kalman fit.\n&quot;</span>;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="comment">// Set up canvas for graphical trace.</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">fGTrace</a>) {</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">// Make a new canvas with a unique name.</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">int</span> cnum = 0;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    ++cnum;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    std::ostringstream ostr;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    ostr &lt;&lt; <span class="stringliteral">&quot;khit&quot;</span> &lt;&lt; cnum;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.emplace_back(</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="keyword">new</span> TCanvas(ostr.str().c_str(), ostr.str().c_str(), <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a5ebc4c4ebd9dc2818c01c9efedb0a1a7">fGTraceWW</a>, <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a6bb8099e4dad21564e1d9a78ec54f3b3">fGTraceWH</a>));</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a20cddd0f3cbc4d4b2b999a42f0915b27">fPads</a>.clear();</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.clear();</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordtype">int</span> nview = 3;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.back()-&gt;Divide(2, nview / 2 + 1);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="comment">// Make subpad for each view.</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iview = 0; iview &lt; nview; ++iview) {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      std::ostringstream ostr;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      ostr &lt;&lt; <span class="stringliteral">&quot;Plane &quot;</span> &lt;&lt; iview;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.back()-&gt;cd(iview + 1);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <span class="keywordtype">double</span> zmin = 0.06;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <span class="keywordtype">double</span> zmax = 0.94;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      <span class="keywordtype">double</span> <a class="code" href="../../d4/d48/run__vertexcharge__icarus_8fcl.html#a0bb005bed46cb3379a0703e7b92b23c5">xmin</a> = 0.04;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <span class="keywordtype">double</span> xmax = 0.95;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      TPad* <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> = <span class="keyword">new</span> TPad(ostr.str().c_str(), ostr.str().c_str(), zmin, <a class="code" href="../../d4/d48/run__vertexcharge__icarus_8fcl.html#a0bb005bed46cb3379a0703e7b92b23c5">xmin</a>, zmax, xmax);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      p-&gt;SetBit(kCanDelete); <span class="comment">// Give away ownership.</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      p-&gt;Range(<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ad78812f0d30f985143b40d639932efed">fGTraceZMin</a>[iview], <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aa7320aebefc2a6f9678ca1f532da8ea7">fGTraceXMin</a>, <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a669d84f36f01743ce8048e11b067b819">fGTraceZMax</a>[iview], <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#acba53dfdbc63042caf3c269aa7bed491">fGTraceXMax</a>);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      p-&gt;SetFillStyle(4000); <span class="comment">// Transparent.</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      p-&gt;Draw();</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a20cddd0f3cbc4d4b2b999a42f0915b27">fPads</a>.push_back(p);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      <span class="comment">// Draw label.</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      TText* t = <span class="keyword">new</span> TText(zmax - 0.02, xmax - 0.03, ostr.str().c_str());</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      t-&gt;SetBit(kCanDelete); <span class="comment">// Give away ownership.</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      t-&gt;SetTextAlign(33);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      t-&gt;SetTextFont(42);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      t-&gt;SetTextSize(0.04);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      t-&gt;Draw();</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="comment">// Draw axes.</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      TGaxis* pz1 =</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keyword">new</span> TGaxis(zmin, xmin, zmax, xmin, <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ad78812f0d30f985143b40d639932efed">fGTraceZMin</a>[iview], <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a669d84f36f01743ce8048e11b067b819">fGTraceZMax</a>[iview], 510, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      pz1-&gt;SetBit(kCanDelete); <span class="comment">// Give away ownership.</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      pz1-&gt;Draw();</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      TGaxis* px1 = <span class="keyword">new</span> TGaxis(zmin, xmin, zmin, xmax, <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aa7320aebefc2a6f9678ca1f532da8ea7">fGTraceXMin</a>, <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#acba53dfdbc63042caf3c269aa7bed491">fGTraceXMax</a>, 510, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      px1-&gt;SetBit(kCanDelete); <span class="comment">// Give away ownership.</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      px1-&gt;Draw();</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      TGaxis* pz2 =</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="keyword">new</span> TGaxis(zmin, xmax, zmax, xmax, <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ad78812f0d30f985143b40d639932efed">fGTraceZMin</a>[iview], <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a669d84f36f01743ce8048e11b067b819">fGTraceZMax</a>[iview], 510, <span class="stringliteral">&quot;-&quot;</span>);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      pz2-&gt;SetBit(kCanDelete); <span class="comment">// Give away ownership.</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      pz2-&gt;Draw();</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      TGaxis* px2 = <span class="keyword">new</span> TGaxis(zmax, xmin, zmax, xmax, <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aa7320aebefc2a6f9678ca1f532da8ea7">fGTraceXMin</a>, <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#acba53dfdbc63042caf3c269aa7bed491">fGTraceXMax</a>, 510, <span class="stringliteral">&quot;L+&quot;</span>);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      px2-&gt;SetBit(kCanDelete); <span class="comment">// Give away ownership.</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      px2-&gt;Draw();</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    }</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="comment">// Draw legend.</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.back()-&gt;cd(nview + 1);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aab59822b5451db197c582cbd098be11a">fInfoPad</a> = gPad;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    TLegend* leg = <span class="keyword">new</span> TLegend(0.6, 0.5, 0.99, 0.99);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    leg-&gt;SetBit(kCanDelete); <span class="comment">// Give away ownership.</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    TLegendEntry* entry = 0;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    TMarker* <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a> = 0;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    m = <span class="keyword">new</span> TMarker(0., 0., 20);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    m-&gt;SetBit(kCanDelete);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    m-&gt;SetMarkerSize(1.2);</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    m-&gt;SetMarkerColor(kRed);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    entry = leg-&gt;AddEntry(m, <span class="stringliteral">&quot;Hits on Track&quot;</span>, <span class="stringliteral">&quot;P&quot;</span>);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    entry-&gt;SetBit(kCanDelete);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    m = <span class="keyword">new</span> TMarker(0., 0., 20);</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    m-&gt;SetBit(kCanDelete);</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    m-&gt;SetMarkerSize(1.2);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    m-&gt;SetMarkerColor(kOrange);</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    entry = leg-&gt;AddEntry(m, <span class="stringliteral">&quot;Smoothed Hits on Track&quot;</span>, <span class="stringliteral">&quot;P&quot;</span>);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    entry-&gt;SetBit(kCanDelete);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    m = <span class="keyword">new</span> TMarker(0., 0., 20);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    m-&gt;SetBit(kCanDelete);</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    m-&gt;SetMarkerSize(1.2);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    m-&gt;SetMarkerColor(kBlack);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    entry = leg-&gt;AddEntry(m, <span class="stringliteral">&quot;Available Hits&quot;</span>, <span class="stringliteral">&quot;P&quot;</span>);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    entry-&gt;SetBit(kCanDelete);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    m = <span class="keyword">new</span> TMarker(0., 0., 20);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    m-&gt;SetBit(kCanDelete);</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    m-&gt;SetMarkerSize(1.2);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    m-&gt;SetMarkerColor(kBlue);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    entry = leg-&gt;AddEntry(m, <span class="stringliteral">&quot;Rejected Hits&quot;</span>, <span class="stringliteral">&quot;P&quot;</span>);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    entry-&gt;SetBit(kCanDelete);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    m = <span class="keyword">new</span> TMarker(0., 0., 20);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    m-&gt;SetBit(kCanDelete);</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    m-&gt;SetMarkerSize(1.2);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    m-&gt;SetMarkerColor(kGreen);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    entry = leg-&gt;AddEntry(m, <span class="stringliteral">&quot;Removed Hits&quot;</span>, <span class="stringliteral">&quot;P&quot;</span>);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    entry-&gt;SetBit(kCanDelete);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    m = <span class="keyword">new</span> TMarker(0., 0., 20);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    m-&gt;SetBit(kCanDelete);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    m-&gt;SetMarkerSize(1.2);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    m-&gt;SetMarkerColor(kMagenta);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    entry = leg-&gt;AddEntry(m, <span class="stringliteral">&quot;Seed Hits&quot;</span>, <span class="stringliteral">&quot;P&quot;</span>);</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    entry-&gt;SetBit(kCanDelete);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    m = <span class="keyword">new</span> TMarker(0., 0., 20);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    m-&gt;SetBit(kCanDelete);</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    m-&gt;SetMarkerSize(1.2);</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    m-&gt;SetMarkerColor(kCyan);</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    entry = leg-&gt;AddEntry(m, <span class="stringliteral">&quot;Unreachable Seed Hits&quot;</span>, <span class="stringliteral">&quot;P&quot;</span>);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    entry-&gt;SetBit(kCanDelete);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    leg-&gt;Draw();</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="comment">// Draw message box.</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ac88efbb9c1344f770aac5d9e11ebe9e9">fMessages</a> = <span class="keyword">new</span> TPaveText(0.01, 0.01, 0.55, 0.99, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ac88efbb9c1344f770aac5d9e11ebe9e9">fMessages</a>-&gt;SetBit(kCanDelete);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ac88efbb9c1344f770aac5d9e11ebe9e9">fMessages</a>-&gt;SetTextFont(42);</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ac88efbb9c1344f770aac5d9e11ebe9e9">fMessages</a>-&gt;SetTextSize(0.04);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ac88efbb9c1344f770aac5d9e11ebe9e9">fMessages</a>-&gt;SetTextAlign(12);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ac88efbb9c1344f770aac5d9e11ebe9e9">fMessages</a>-&gt;Draw();</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    TText* t = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ac88efbb9c1344f770aac5d9e11ebe9e9">fMessages</a>-&gt;AddText(<span class="stringliteral">&quot;Enter buildTrack&quot;</span>);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    t-&gt;SetBit(kCanDelete);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.back()-&gt;Update();</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  }</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="comment">// Sort container using this seed track.</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  hits.sort(trk, <span class="keyword">true</span>, prop, <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185">Propagator::UNKNOWN</a>);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="comment">// Draw hits and populate hit-&gt;marker map.</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">fGTrace</a> &amp;&amp; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.size() &gt; 0) {</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="comment">// Loop over sorted KHitGroups.</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="comment">// Paint sorted seed hits magenta.</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keyword">const</span> std::list&lt;KHitGroup&gt;&amp; groups = hits.getSorted();</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; gr : groups) {</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      <span class="comment">// Loop over hits in this group.</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;const KHitBase&gt;&gt;&amp; phits = gr.getHits();</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; phit : phits) {</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <span class="keyword">const</span> KHitBase&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = *phit;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="keywordtype">int</span> pl = hit.getMeasPlane();</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="keywordflow">if</span> (pl &gt;= 0 &amp;&amp; pl &lt; <span class="keywordtype">int</span>(<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a20cddd0f3cbc4d4b2b999a42f0915b27">fPads</a>.size())) {</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;          <span class="keywordtype">double</span> <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#ae40184b0245025a43c56daa3261d5e3c">z</a> = 0.;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;          <span class="keywordtype">double</span> <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a> = 0.;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;          hit_position(hit, z, x);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;          TMarker* marker = <span class="keyword">new</span> TMarker(z, x, 20);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;          <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>[hit.getID()] = marker;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;          <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a20cddd0f3cbc4d4b2b999a42f0915b27">fPads</a>[pl]-&gt;cd();</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;          marker-&gt;SetBit(kCanDelete); <span class="comment">// Give away ownership.</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;          marker-&gt;SetMarkerSize(0.5);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;          marker-&gt;SetMarkerColor(kMagenta);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;          marker-&gt;Draw();</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        }</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      }</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    }</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="comment">// Loop over unsorted KHitGroups.</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="comment">// Paint unsorted seed hits cyan.</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="comment">// There should be few, if any, unsorted seed hits.</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keyword">const</span> std::list&lt;KHitGroup&gt;&amp; ugroups = hits.getUnsorted();</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; gr : ugroups) {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      <span class="comment">// Loop over hits in this group.</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;const KHitBase&gt;&gt;&amp; phits = gr.getHits();</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; phit : phits) {</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="keyword">const</span> KHitBase&amp; hit = *phit;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keywordtype">int</span> pl = hit.getMeasPlane();</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="keywordflow">if</span> (pl &gt;= 0 &amp;&amp; pl &lt; <span class="keywordtype">int</span>(<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a20cddd0f3cbc4d4b2b999a42f0915b27">fPads</a>.size())) {</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;          <span class="keywordtype">double</span> z = 0.;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;          <span class="keywordtype">double</span> x = 0.;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;          hit_position(hit, z, x);</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;          TMarker* marker = <span class="keyword">new</span> TMarker(z, x, 20);</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;          <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>[hit.getID()] = marker;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;          <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a20cddd0f3cbc4d4b2b999a42f0915b27">fPads</a>[pl]-&gt;cd();</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;          marker-&gt;SetBit(kCanDelete); <span class="comment">// Give away ownership.</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;          marker-&gt;SetMarkerSize(0.5);</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;          marker-&gt;SetMarkerColor(kCyan);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;          marker-&gt;Draw();</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        }</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      }</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    }</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.back()-&gt;Update();</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  }</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="comment">// Loop over measurements (KHitGroup) from sorted list.</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="keywordtype">double</span> tchisq = 0.;          <span class="comment">// Cumulative chisquare.</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="keywordtype">double</span> path = 0.;            <span class="comment">// Cumulative path distance.</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keywordtype">int</span> step = 0;                <span class="comment">// Step count.</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="keywordtype">int</span> nsame = 0;               <span class="comment">// Number of consecutive measurements in same plane.</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="keywordtype">int</span> last_plane = -1;         <span class="comment">// Last plane.</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <span class="keywordtype">bool</span> has_pref_plane = <span class="keyword">false</span>; <span class="comment">// Set to true when first preferred plane hit is added to track.</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <span class="comment">// Make a copy of the starting track, in the form of a KFitTrack,</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <span class="comment">// which we will update as we go.</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <a class="code" href="../../d0/da2/namespacetrkf.html#a20fcb423cfba1923040c27599fd3bf83">TrackError</a> <a class="code" href="../../da/d2d/namespaceevd.html#a911fe581afad27a720ee200bd61362a6">err</a>;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  trk.getSurface()-&gt;getStartingError(err);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  KETrack tre(trk, err);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  KFitTrack trf(tre, path, tchisq);</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="comment">// Also use the starting track as the reference track for linearized</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="comment">// propagation, until the track is established with reasonably small</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="comment">// errors.</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  KTrack ref(trk);</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  KTrack* pref = &amp;ref;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  mf::LogInfo log(<span class="stringliteral">&quot;KalmanFilterAlg&quot;</span>);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="comment">// Loop over measurement groups (KHitGroups).</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <span class="keywordflow">while</span> (hits.getSorted().size() &gt; 0) {</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    ++step;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>) {</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      log &lt;&lt; <span class="stringliteral">&quot;Build Step &quot;</span> &lt;&lt; step &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      log &lt;&lt; <span class="stringliteral">&quot;KGTrack has &quot;</span> &lt;&lt; trg.numHits() &lt;&lt; <span class="stringliteral">&quot; hits.\n&quot;</span>;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      log &lt;&lt; trf;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    }</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="comment">// Get an iterator for the next KHitGroup.</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    std::list&lt;KHitGroup&gt;::iterator it;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> == <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">Propagator::FORWARD</a>)</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      it = hits.getSorted().begin();</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      it = hits.getSorted().end();</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      --it;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    }</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keyword">const</span> KHitGroup&amp; gr = *it;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>) {</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      <span class="keywordtype">double</span> path_est = gr.getPath();</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      log &lt;&lt; <span class="stringliteral">&quot;Next surface: &quot;</span> &lt;&lt; *(gr.getSurface()) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      log &lt;&lt; <span class="stringliteral">&quot;  Estimated path length of hit group = &quot;</span> &lt;&lt; path_est &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    }</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="comment">// Get the next prediction surface.  If this KHitGroup is on the</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="comment">// preferred plane, use that as the prediction surface.</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="comment">// Otherwise, use the current track surface as the prediction</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="comment">// surface.</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    std::shared_ptr&lt;const Surface&gt; psurf = trf.getSurface();</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordflow">if</span> (gr.getPlane() &lt; 0) <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;KalmanFilterAlg&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;negative plane?\n&quot;</span>;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a18bdb931d6b6730cfe499df7379da449">fPlane</a> &lt; 0 || gr.getPlane() &lt; 0 || <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a18bdb931d6b6730cfe499df7379da449">fPlane</a> == gr.getPlane()) psurf = gr.getSurface();</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="comment">// Propagate track to the prediction surface.</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    std::optional&lt;double&gt; <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a> = prop.noise_prop(trf, psurf, <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185">Propagator::UNKNOWN</a>, <span class="keyword">true</span>, pref);</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keywordflow">if</span> (dist &amp;&amp; <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(*dist) &gt; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a78b312879081cd58cc8ba80db633c875">fMaxPropDist</a>) dist = std::nullopt;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../d9/d69/namespacelariov_1_1DataSource.html#a9877bcd384b60abd8cbe121d11f43b5b">ds</a> = 0.;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keywordflow">if</span> (dist) {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      <span class="comment">// Propagation succeeded.</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      <span class="comment">// Update cumulative path distance and track status.</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      ds = *<a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      path += <a class="code" href="../../d9/d69/namespacelariov_1_1DataSource.html#a9877bcd384b60abd8cbe121d11f43b5b">ds</a>;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      trf.setPath(path);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> == <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">Propagator::FORWARD</a>)</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        trf.setStat(<a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a6f3336fe810af67d6ce9069176fb6af7">KFitTrack::FORWARD_PREDICTED</a>);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        trf.setStat(<a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5aecd7b60b3e363d4bb97e476bff2ade03">KFitTrack::BACKWARD_PREDICTED</a>);</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      }</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>) {</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        log &lt;&lt; <span class="stringliteral">&quot;After propagation\n&quot;</span>;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        log &lt;&lt; <span class="stringliteral">&quot;  Incremental propagation distance = &quot;</span> &lt;&lt; ds &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        log &lt;&lt; <span class="stringliteral">&quot;  Path length of prediction surface = &quot;</span> &lt;&lt; path &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        log &lt;&lt; <span class="stringliteral">&quot;KGTrack has &quot;</span> &lt;&lt; trg.numHits() &lt;&lt; <span class="stringliteral">&quot; hits.\n&quot;</span>;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        log &lt;&lt; trf;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      }</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      <span class="comment">// Loop over measurements in this group.</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;const KHitBase&gt;&gt;&amp; hits = gr.getHits();</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <span class="keywordtype">double</span> best_chisq = 0.;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      std::shared_ptr&lt;const KHitBase&gt; best_hit;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;std::shared_ptr&lt;const KHitBase&gt;&gt;::const_iterator ihit = hits.begin();</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;           ihit != hits.end();</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;           ++ihit) {</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <span class="keyword">const</span> KHitBase&amp; hit = **ihit;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        <span class="comment">// Turn this hit blue.</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">fGTrace</a> &amp;&amp; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.size() &gt; 0) {</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;          <span class="keyword">auto</span> marker_it = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.find(hit.getID());</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;          <span class="keywordflow">if</span> (marker_it != <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.end()) {</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            TMarker* marker = marker_it-&gt;second;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            marker-&gt;SetMarkerColor(kBlue);</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;          }</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;          <span class="comment">//fCanvases.back()-&gt;Update();</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        }</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <span class="comment">// Update predction using current track hypothesis and get</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        <span class="comment">// incremental chisquare.</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        <span class="keywordflow">if</span> (hit.predict(trf, prop)) {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;          <span class="keywordtype">double</span> chisq = hit.getChisq();</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;          <span class="keywordtype">double</span> preddist = hit.getPredDistance();</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>) {</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            log &lt;&lt; <span class="stringliteral">&quot;Trying Hit.\n&quot;</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                &lt;&lt; hit &lt;&lt; <span class="stringliteral">&quot;\nchisq = &quot;</span> &lt;&lt; chisq &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;prediction distance = &quot;</span> &lt;&lt; preddist &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;          }</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;          <span class="keywordflow">if</span> ((!has_pref_plane || <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a>(preddist) &lt; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1661d1cda07b5d91d6ddec6bca467b56">fMaxSeedPredDist</a>) &amp;&amp;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;              (best_hit.get() == 0 || chisq &lt; best_chisq)) {</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            best_chisq = chisq;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;            <span class="keywordflow">if</span> (chisq &lt; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a4cd6ede9183db3c03fce6297237c1587">fMaxSeedIncChisq</a>) best_hit = *ihit;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;          }</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        }</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      }</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>) {</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        log &lt;&lt; <span class="stringliteral">&quot;Best hit incremental chisquare = &quot;</span> &lt;&lt; best_chisq &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <span class="keywordflow">if</span> (best_hit.get() != 0) {</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;          log &lt;&lt; <span class="stringliteral">&quot;Hit after prediction\n&quot;</span>;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;          log &lt;&lt; *best_hit;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        }</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;          log &lt;&lt; <span class="stringliteral">&quot;No hit passed chisquare cut.\n&quot;</span>;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      }</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">fGTrace</a> &amp;&amp; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.size() &gt; 0) <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.back()-&gt;Update();</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="comment">// If we found a best measurement, and if the incremental</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      <span class="comment">// chisquare passes the cut, add it to the track and update</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <span class="comment">// fit information.</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      <span class="keywordtype">bool</span> update_ok = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      <span class="keywordflow">if</span> (best_hit.get() != 0) {</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        KFitTrack trf0(trf);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        best_hit-&gt;update(trf);</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        update_ok = trf.isValid();</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <span class="keywordflow">if</span> (!update_ok) trf = trf0;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      }</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="keywordflow">if</span> (update_ok) {</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        ds += best_hit-&gt;getPredDistance();</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        tchisq += best_chisq;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        trf.setChisq(tchisq);</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> == <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">Propagator::FORWARD</a>)</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;          trf.setStat(<a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5ad3811944785e6ac5a7496a98d167110d">KFitTrack::FORWARD</a>);</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;          trf.setStat(<a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5ad673adc72cebdfb1864653ad774eec1c">KFitTrack::BACKWARD</a>);</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        }</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        <span class="comment">// If the pointing error got too large, and there is no</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        <span class="comment">// reference track, quit.</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        <span class="keywordflow">if</span> (pref == 0 &amp;&amp; trf.PointingError() &gt; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ab6bcc54a19e33e2e7639f6110c821ac2">fMaxPErr</a>) {</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>) log &lt;&lt; <span class="stringliteral">&quot;Quitting because pointing error got too large.\n&quot;</span>;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        }</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        <span class="comment">// Test number of consecutive measurements in the same plane.</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        <span class="keywordflow">if</span> (gr.getPlane() &gt;= 0) {</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;          <span class="keywordflow">if</span> (gr.getPlane() == last_plane)</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            ++nsame;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;          <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            nsame = 1;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            last_plane = gr.getPlane();</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;          }</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        }</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;          nsame = 0;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;          last_plane = -1;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        }</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        <span class="keywordflow">if</span> (nsame &lt;= <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#afa116c60288b506aeddffd04ad08f9df">fMaxSamePlane</a>) {</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;          <span class="comment">// Turn best hit red.</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">fGTrace</a> &amp;&amp; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.size() &gt; 0) {</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;            <span class="keywordtype">int</span> pl = best_hit-&gt;getMeasPlane();</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            <span class="keywordflow">if</span> (pl &gt;= 0 &amp;&amp; pl &lt; <span class="keywordtype">int</span>(<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a20cddd0f3cbc4d4b2b999a42f0915b27">fPads</a>.size())) {</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;              <span class="keyword">auto</span> marker_it = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.find(best_hit-&gt;getID());</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;              <span class="keywordflow">if</span> (marker_it != <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.end()) {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                TMarker* marker = marker_it-&gt;second;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                marker-&gt;SetMarkerColor(kRed);</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                <span class="comment">// Redraw marker so that it will be on top.</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a20cddd0f3cbc4d4b2b999a42f0915b27">fPads</a>[pl]-&gt;cd();</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                marker-&gt;Draw();</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;              }</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;            }</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;            <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.back()-&gt;Update();</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;          }</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;          <span class="comment">// Make a KHitTrack and add it to the KGTrack.</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;          KHitTrack trh(trf, best_hit);</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;          trg.addTrack(trh);</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a18bdb931d6b6730cfe499df7379da449">fPlane</a> == gr.getPlane()) has_pref_plane = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;          <span class="comment">// Decide if we want to kill the reference track.</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;          <span class="keywordflow">if</span> (!linear &amp;&amp; pref != 0 &amp;&amp; <span class="keywordtype">int</span>(trg.numHits()) &gt;= <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#adbc4b24d83f7b22928fb9b8e3f57dee7">fMinLHits</a> &amp;&amp;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;              (trf.PointingError() &lt; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ab02403fa9fdf6f09573ce7d90feadad9">fGoodPErr</a> || path &gt; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aaf64b31d2add93fcfc89736839b4f72d">fMaxLDist</a>)) {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;            pref = 0;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>) log &lt;&lt; <span class="stringliteral">&quot;Killing reference track.\n&quot;</span>;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;          }</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>) {</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;            log &lt;&lt; <span class="stringliteral">&quot;After update\n&quot;</span>;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            log &lt;&lt; <span class="stringliteral">&quot;KGTrack has &quot;</span> &lt;&lt; trg.numHits() &lt;&lt; <span class="stringliteral">&quot; hits.\n&quot;</span>;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            log &lt;&lt; trf;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;          }</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        }</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      }</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    }</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="comment">// The current KHitGroup is now resolved.</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="comment">// Move it to unused list.</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    hits.getUnused().splice(hits.getUnused().end(), hits.getSorted(), it);</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="comment">// If the propagation distance was the wrong direction, resort the measurements.</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="keywordflow">if</span> (pref == 0 &amp;&amp; dist &amp;&amp;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        ((<a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> == <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">Propagator::FORWARD</a> &amp;&amp; (ds &lt; fMinSortDist || ds &gt; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a064806b6f47119501c2a4b1a8c0d43d4">fMaxSortDist</a>)) ||</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;         (<a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> == <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354abb50b9e012a19f7643321f6aa64ecb19">Propagator::BACKWARD</a> &amp;&amp; (-ds &lt; fMinSortDist || -ds &gt; fMaxSortDist)))) {</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>) log &lt;&lt; <span class="stringliteral">&quot;Resorting measurements.\n&quot;</span>;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;      hits.sort(trf, <span class="keyword">true</span>, prop, <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>);</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    }</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  }</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  <span class="comment">// Clean track.</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#afc18359dc25a380997a38d537eaeccad">cleanTrack</a>(trg);</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="comment">// Set the fit status of the last added KHitTrack to optimal and get</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <span class="comment">// the final chisquare and path length.</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="keywordtype">double</span> fchisq = 0.;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  path = 0.;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  <span class="keywordflow">if</span> (trg.isValid()) {</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    path = trg.endTrack().getPath() - trg.startTrack().getPath();</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> == <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">Propagator::FORWARD</a>) {</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      trg.endTrack().setStat(<a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1">KFitTrack::OPTIMAL</a>);</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      fchisq = trg.endTrack().getChisq();</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    }</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      trg.startTrack().setStat(<a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1">KFitTrack::OPTIMAL</a>);</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      fchisq = trg.startTrack().getChisq();</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    }</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  }</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;  <span class="comment">// Summary.</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  log &lt;&lt; <span class="stringliteral">&quot;KalmanFilterAlg build track summary.\n&quot;</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Build direction = &quot;</span> &lt;&lt; (<a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> == <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">Propagator::FORWARD</a> ? <span class="stringliteral">&quot;FORWARD&quot;</span> : <span class="stringliteral">&quot;BACKWARD&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Track has &quot;</span> &lt;&lt; trg.numHits() &lt;&lt; <span class="stringliteral">&quot; hits.\n&quot;</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Track length = &quot;</span> &lt;&lt; path &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Track chisquare = &quot;</span> &lt;&lt; fchisq &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="comment">// Done.  Return success if we added at least one measurement.</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="keywordtype">bool</span> ok = trg.numHits() &gt; 0;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">fGTrace</a> &amp;&amp; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.size() &gt; 0) {</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    TText* t = 0;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <span class="keywordflow">if</span> (ok)</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;      t = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ac88efbb9c1344f770aac5d9e11ebe9e9">fMessages</a>-&gt;AddText(<span class="stringliteral">&quot;Exit buildTrack, status success&quot;</span>);</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;      t = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ac88efbb9c1344f770aac5d9e11ebe9e9">fMessages</a>-&gt;AddText(<span class="stringliteral">&quot;Exit buildTrack, status fail&quot;</span>);</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    t-&gt;SetBit(kCanDelete);</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aab59822b5451db197c582cbd098be11a">fInfoPad</a>-&gt;Modified();</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.back()-&gt;Update();</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  }</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  <span class="keywordflow">return</span> ok;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;}</div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a98537b1f46ca2024dec2b9504c4fccc3"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">trkf::KalmanFilterAlg::fGTrace</a></div><div class="ttdeci">bool fGTrace</div><div class="ttdoc">Graphical trace flag. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00168">KalmanFilterAlg.h:168</a></div></div>
<div class="ttc" id="run__opflash__electron_8fcl_html_ae40184b0245025a43c56daa3261d5e3c"><div class="ttname"><a href="../../d0/d84/run__opflash__electron_8fcl.html#ae40184b0245025a43c56daa3261d5e3c">z</a></div><div class="ttdeci">process_name opflash particleana ie ie ie z</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d84/run__opflash__electron_8fcl_source.html#l00092">run_opflash_electron.fcl:92</a></div></div>
<div class="ttc" id="namespacelariov_1_1DataSource_html_a9877bcd384b60abd8cbe121d11f43b5b"><div class="ttname"><a href="../../d9/d69/namespacelariov_1_1DataSource.html#a9877bcd384b60abd8cbe121d11f43b5b">lariov::DataSource::ds</a></div><div class="ttdeci">ds</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dca/IOVDataConstants_8h_source.html#l00015">IOVDataConstants.h:15</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a78b312879081cd58cc8ba80db633c875"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a78b312879081cd58cc8ba80db633c875">trkf::KalmanFilterAlg::fMaxPropDist</a></div><div class="ttdeci">double fMaxPropDist</div><div class="ttdoc">Maximum propagation distance to candidate surface. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00159">KalmanFilterAlg.h:159</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a96c1397d785be158129c8d36ea6987a6"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">trkf::KalmanFilterAlg::fMarkerMap</a></div><div class="ttdeci">std::map&lt; int, TMarker * &gt; fMarkerMap</div><div class="ttdoc">Markers in current canvas. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00183">KalmanFilterAlg.h:183</a></div></div>
<div class="ttc" id="run__opflash__electron_8fcl_html_a6673f03521899f7844189bcfd8ee5941"><div class="ttname"><a href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a></div><div class="ttdeci">process_name opflash particleana ie x</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d84/run__opflash__electron_8fcl_source.html#l00090">run_opflash_electron.fcl:90</a></div></div>
<div class="ttc" id="namespacetrkf_html_a20fcb423cfba1923040c27599fd3bf83"><div class="ttname"><a href="../../d0/da2/namespacetrkf.html#a20fcb423cfba1923040c27599fd3bf83">trkf::TrackError</a></div><div class="ttdeci">KSymMatrix&lt; 5 &gt;::type TrackError</div><div class="ttdoc">Track error matrix, dimension 5x5. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d7d/KalmanLinearAlgebra_8h_source.html#l00093">KalmanLinearAlgebra.h:93</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a1e70c929d23cb24aae387474026a2ffa"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">trkf::KalmanFilterAlg::fTrace</a></div><div class="ttdeci">bool fTrace</div><div class="ttdoc">Trace flag. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00148">KalmanFilterAlg.h:148</a></div></div>
<div class="ttc" id="namespaceevd_html_a911fe581afad27a720ee200bd61362a6"><div class="ttname"><a href="../../da/d2d/namespaceevd.html#a911fe581afad27a720ee200bd61362a6">evd::err</a></div><div class="ttdeci">EResult err(const char *call)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2a/WebEVDServer_8cxx_source.html#l00138">WebEVDServer.cxx:138</a></div></div>
<div class="ttc" id="classtrkf_1_1KFitTrack_html_acbd881884cdbb8f20e56b6e2bf6cc0f5a6f3336fe810af67d6ce9069176fb6af7"><div class="ttname"><a href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a6f3336fe810af67d6ce9069176fb6af7">trkf::KFitTrack::FORWARD_PREDICTED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db4/KFitTrack_8h_source.html#l00045">KFitTrack.h:45</a></div></div>
<div class="ttc" id="selectors_8fcl_html_a24c8335057af14a9b508d5ac18999ce5"><div class="ttname"><a href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a></div><div class="ttdeci">pdgs p</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd2/selectors_8fcl_source.html#l00022">selectors.fcl:22</a></div></div>
<div class="ttc" id="classtrkf_1_1KFitTrack_html_acbd881884cdbb8f20e56b6e2bf6cc0f5ad673adc72cebdfb1864653ad774eec1c"><div class="ttname"><a href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5ad673adc72cebdfb1864653ad774eec1c">trkf::KFitTrack::BACKWARD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db4/KFitTrack_8h_source.html#l00046">KFitTrack.h:46</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_afc18359dc25a380997a38d537eaeccad"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#afc18359dc25a380997a38d537eaeccad">trkf::KalmanFilterAlg::cleanTrack</a></div><div class="ttdeci">void cleanTrack(KGTrack &amp;trg) const </div><div class="ttdoc">Clean track by removing noise hits near endpoints. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dab/KalmanFilterAlg_8cxx_source.html#l02107">KalmanFilterAlg.cxx:2107</a></div></div>
<div class="ttc" id="cheaterreco_8fcl_html_abf2e819dbf4c327e098bebd4b2dc0597"><div class="ttname"><a href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a></div><div class="ttdeci">process_name hit</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d36/cheaterreco_8fcl_source.html#l00051">cheaterreco.fcl:51</a></div></div>
<div class="ttc" id="classtrkf_1_1KFitTrack_html_acbd881884cdbb8f20e56b6e2bf6cc0f5aecd7b60b3e363d4bb97e476bff2ade03"><div class="ttname"><a href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5aecd7b60b3e363d4bb97e476bff2ade03">trkf::KFitTrack::BACKWARD_PREDICTED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db4/KFitTrack_8h_source.html#l00047">KFitTrack.h:47</a></div></div>
<div class="ttc" id="namespacegen__crt__frags_html_a55a56854d78e363691470c7297fde77c"><div class="ttname"><a href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">gen_crt_frags.m</a></div><div class="ttdeci">tuple m</div><div class="ttdoc">now if test mode generate materials, CRT shell, world, gdml header else just generate CRT shell for u...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d8c/gen__crt__frags_8py_source.html#l01347">gen_crt_frags.py:1347</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_ad78812f0d30f985143b40d639932efed"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ad78812f0d30f985143b40d639932efed">trkf::KalmanFilterAlg::fGTraceZMin</a></div><div class="ttdeci">std::vector&lt; double &gt; fGTraceZMin</div><div class="ttdoc">Graphical trace minimum z for each view. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00173">KalmanFilterAlg.h:173</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_af689f4b8a505b7a64dcd9c7e6c824354abb50b9e012a19f7643321f6aa64ecb19"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354abb50b9e012a19f7643321f6aa64ecb19">trkf::Propagator::BACKWARD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00094">Propagator.h:94</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_aaf64b31d2add93fcfc89736839b4f72d"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aaf64b31d2add93fcfc89736839b4f72d">trkf::KalmanFilterAlg::fMaxLDist</a></div><div class="ttdeci">double fMaxLDist</div><div class="ttdoc">Maximum distance for linearized propagation. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00156">KalmanFilterAlg.h:156</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a064806b6f47119501c2a4b1a8c0d43d4"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a064806b6f47119501c2a4b1a8c0d43d4">trkf::KalmanFilterAlg::fMaxSortDist</a></div><div class="ttdeci">double fMaxSortDist</div><div class="ttdoc">Sort high distance threshold. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00161">KalmanFilterAlg.h:161</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a1661d1cda07b5d91d6ddec6bca467b56"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1661d1cda07b5d91d6ddec6bca467b56">trkf::KalmanFilterAlg::fMaxSeedPredDist</a></div><div class="ttdeci">double fMaxSeedPredDist</div><div class="ttdoc">Maximum prediciton distance to accept a hit in seed phase. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00158">KalmanFilterAlg.h:158</a></div></div>
<div class="ttc" id="run__vertexcharge__icarus_8fcl_html_a0bb005bed46cb3379a0703e7b92b23c5"><div class="ttname"><a href="../../d4/d48/run__vertexcharge__icarus_8fcl.html#a0bb005bed46cb3379a0703e7b92b23c5">xmin</a></div><div class="ttdeci">process_name pandoraGausCryo1 vertexChargeCryo1 vertexStubCryo1 xmin</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d48/run__vertexcharge__icarus_8fcl_source.html#l00109">run_vertexcharge_icarus.fcl:109</a></div></div>
<div class="ttc" id="namespacelar_1_1dump_html_a71d4403edbac4d265176f8677118194f"><div class="ttname"><a href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">lar::dump::vector</a></div><div class="ttdeci">auto vector(Vector const &amp;v)</div><div class="ttdoc">Returns a manipulator which will print the specified array. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/DumpUtils_8h_source.html#l00265">DumpUtils.h:265</a></div></div>
<div class="ttc" id="sparse__vector__test_8cc_html_a39f16bf854ba527dee7eba5bbbd93f3f"><div class="ttname"><a href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a></div><div class="ttdeci">T abs(T value)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d59/sparse__vector__test_8cc_source.html#l00030">sparse_vector_test.cc:30</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185">trkf::Propagator::UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00094">Propagator.h:94</a></div></div>
<div class="ttc" id="classtrkf_1_1KFitTrack_html_acbd881884cdbb8f20e56b6e2bf6cc0f5ad3811944785e6ac5a7496a98d167110d"><div class="ttname"><a href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5ad3811944785e6ac5a7496a98d167110d">trkf::KFitTrack::FORWARD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db4/KFitTrack_8h_source.html#l00044">KFitTrack.h:44</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a6bb8099e4dad21564e1d9a78ec54f3b3"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a6bb8099e4dad21564e1d9a78ec54f3b3">trkf::KalmanFilterAlg::fGTraceWH</a></div><div class="ttdeci">double fGTraceWH</div><div class="ttdoc">Window height. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00170">KalmanFilterAlg.h:170</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_aab59822b5451db197c582cbd098be11a"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aab59822b5451db197c582cbd098be11a">trkf::KalmanFilterAlg::fInfoPad</a></div><div class="ttdeci">TVirtualPad * fInfoPad</div><div class="ttdoc">Information pad. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00181">KalmanFilterAlg.h:181</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_ae784305d3e992d3650c1aab19487c7b0"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">trkf::KalmanFilterAlg::fCanvases</a></div><div class="ttdeci">std::vector&lt; std::unique_ptr&lt; TCanvas &gt; &gt; fCanvases</div><div class="ttdoc">Graphical trace canvases. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00179">KalmanFilterAlg.h:179</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">trkf::Propagator::FORWARD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00094">Propagator.h:94</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_aa7320aebefc2a6f9678ca1f532da8ea7"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aa7320aebefc2a6f9678ca1f532da8ea7">trkf::KalmanFilterAlg::fGTraceXMin</a></div><div class="ttdeci">double fGTraceXMin</div><div class="ttdoc">Graphical trace minimum x. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00171">KalmanFilterAlg.h:171</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_ab02403fa9fdf6f09573ce7d90feadad9"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ab02403fa9fdf6f09573ce7d90feadad9">trkf::KalmanFilterAlg::fGoodPErr</a></div><div class="ttdeci">double fGoodPErr</div><div class="ttdoc">Pointing error threshold for switching to free propagation. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00150">KalmanFilterAlg.h:150</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_ac88efbb9c1344f770aac5d9e11ebe9e9"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ac88efbb9c1344f770aac5d9e11ebe9e9">trkf::KalmanFilterAlg::fMessages</a></div><div class="ttdeci">TPaveText * fMessages</div><div class="ttdoc">Message box. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00182">KalmanFilterAlg.h:182</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a4cd6ede9183db3c03fce6297237c1587"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a4cd6ede9183db3c03fce6297237c1587">trkf::KalmanFilterAlg::fMaxSeedIncChisq</a></div><div class="ttdeci">double fMaxSeedIncChisq</div><div class="ttdoc">Maximum incremental chisquare to accept a hit in seed phase. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00152">KalmanFilterAlg.h:152</a></div></div>
<div class="ttc" id="namespacedropbox_html_a407b5b895ba9265893768748aaa73825"><div class="ttname"><a href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dropbox.dir</a></div><div class="ttdeci">tuple dir</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d81/dropbox_8py_source.html#l00028">dropbox.py:28</a></div></div>
<div class="ttc" id="namespacelarg4_html_a3b23adbb58bc71f7c54806914226f1f8"><div class="ttname"><a href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">larg4::dist</a></div><div class="ttdeci">constexpr double dist(const TReal *x, const TReal *y, const unsigned int dimension)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d8a/OpFastScintillation_8hh_source.html#l00563">OpFastScintillation.hh:563</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_acba53dfdbc63042caf3c269aa7bed491"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#acba53dfdbc63042caf3c269aa7bed491">trkf::KalmanFilterAlg::fGTraceXMax</a></div><div class="ttdeci">double fGTraceXMax</div><div class="ttdoc">Graphical trace maximum x. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00172">KalmanFilterAlg.h:172</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a20cddd0f3cbc4d4b2b999a42f0915b27"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a20cddd0f3cbc4d4b2b999a42f0915b27">trkf::KalmanFilterAlg::fPads</a></div><div class="ttdeci">std::vector&lt; TVirtualPad * &gt; fPads</div><div class="ttdoc">View pads in current canvas. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00180">KalmanFilterAlg.h:180</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a5ebc4c4ebd9dc2818c01c9efedb0a1a7"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a5ebc4c4ebd9dc2818c01c9efedb0a1a7">trkf::KalmanFilterAlg::fGTraceWW</a></div><div class="ttdeci">double fGTraceWW</div><div class="ttdoc">Window width. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00169">KalmanFilterAlg.h:169</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a669d84f36f01743ce8048e11b067b819"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a669d84f36f01743ce8048e11b067b819">trkf::KalmanFilterAlg::fGTraceZMax</a></div><div class="ttdeci">std::vector&lt; double &gt; fGTraceZMax</div><div class="ttdoc">Graphical trace maximum z for each view. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00174">KalmanFilterAlg.h:174</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_afa116c60288b506aeddffd04ad08f9df"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#afa116c60288b506aeddffd04ad08f9df">trkf::KalmanFilterAlg::fMaxSamePlane</a></div><div class="ttdeci">int fMaxSamePlane</div><div class="ttdoc">Maximum consecutive hits in same plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00162">KalmanFilterAlg.h:162</a></div></div>
<div class="ttc" id="classtrkf_1_1KFitTrack_html_acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1"><div class="ttname"><a href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1">trkf::KFitTrack::OPTIMAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db4/KFitTrack_8h_source.html#l00048">KFitTrack.h:48</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_ab6bcc54a19e33e2e7639f6110c821ac2"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ab6bcc54a19e33e2e7639f6110c821ac2">trkf::KalmanFilterAlg::fMaxPErr</a></div><div class="ttdeci">double fMaxPErr</div><div class="ttdoc">Maximum pointing error for free propagation. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00149">KalmanFilterAlg.h:149</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_adbc4b24d83f7b22928fb9b8e3f57dee7"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#adbc4b24d83f7b22928fb9b8e3f57dee7">trkf::KalmanFilterAlg::fMinLHits</a></div><div class="ttdeci">int fMinLHits</div><div class="ttdoc">Minimum number of hits to turn off linearized propagation. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00155">KalmanFilterAlg.h:155</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a18bdb931d6b6730cfe499df7379da449"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a18bdb931d6b6730cfe499df7379da449">trkf::KalmanFilterAlg::fPlane</a></div><div class="ttdeci">int fPlane</div><div class="ttdoc">Preferred view plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00178">KalmanFilterAlg.h:178</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afc18359dc25a380997a38d537eaeccad"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void trkf::KalmanFilterAlg::cleanTrack </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> &amp;&#160;</td>
          <td class="paramname"><em>trg</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clean track by removing noise hits near endpoints. </p>
<p>Clean track by removing noise hits near endpoints.</p>
<p>Arguments:</p>
<p>trg - <a class="el" href="../../d4/d66/structTrack.html">Track</a>. </p>

<p>Definition at line <a class="el" href="../../d2/dab/KalmanFilterAlg_8cxx_source.html#l02107">2107</a> of file <a class="el" href="../../d2/dab/KalmanFilterAlg_8cxx_source.html">KalmanFilterAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;{</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;  <span class="comment">// Get hold of a modifiable track map from trg.</span></div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;  std::multimap&lt;double, KHitTrack&gt;&amp; trackmap = trg.getTrackMap();</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;  <span class="comment">// Do an indefinite loop until we no longer find any dirt.</span></div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;  <span class="keywordtype">bool</span> done = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;  <span class="keywordflow">while</span> (!done) {</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;    <span class="comment">// If track map has fewer than fMaxNoiseHits tracks, then this is a</span></div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;    <span class="comment">// noise track.  Clear the map, making the whole track invalid.</span></div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;    <span class="keywordtype">int</span> ntrack = trackmap.size();</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;    <span class="keywordflow">if</span> (ntrack &lt;= <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a8d0ff60ed611fc2b67398f0855a5499e">fMaxNoiseHits</a>) {</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; trackmap_entry : trackmap) {</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;        <span class="keyword">const</span> KHitTrack&amp; trh = trackmap_entry.second;</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;        <span class="keyword">const</span> KHitBase&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = *(trh.getHit());</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;        <span class="keyword">auto</span> marker_it = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.find(hit.getID());</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;        <span class="keywordflow">if</span> (marker_it != <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.end()) {</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;          TMarker* marker = marker_it-&gt;second;</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;          marker-&gt;SetMarkerColor(kGreen);</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;        }</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;      }</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;      trackmap.clear();</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;      done = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;    }</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;    <span class="comment">// Make sure the first two and last two tracks belong to different</span></div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;    <span class="comment">// views.  If not, remove the first or last track.</span></div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    <span class="keywordflow">if</span> (ntrack &gt;= 2) {</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;      <span class="comment">// Check start.</span></div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;      std::multimap&lt;double, KHitTrack&gt;::iterator it = trackmap.begin();</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;      <span class="keyword">const</span> KHitTrack&amp; trh1a = (*it).second;</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;      <span class="keyword">const</span> KHitBase&amp; hit1a = *(trh1a.getHit());</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;      <span class="keywordtype">int</span> plane1 = hit1a.getMeasPlane();</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;      <span class="keywordtype">double</span> chisq1 = hit1a.getChisq();</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;      ++it;</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;      <span class="keyword">const</span> KHitTrack&amp; trh2a = (*it).second;</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;      <span class="keyword">const</span> KHitBase&amp; hit2a = *(trh2a.getHit());</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;      <span class="keywordtype">int</span> plane2 = hit2a.getMeasPlane();</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;      <span class="keywordtype">double</span> chisq2 = hit2a.getChisq();</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;      <span class="keywordflow">if</span> ((plane1 &gt;= 0 &amp;&amp; plane2 &gt;= 0 &amp;&amp; plane1 == plane2) || chisq1 &gt; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#abd1ec322451d3befc68ecc5c66bf1cf7">fMaxEndChisq</a> ||</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;          chisq2 &gt; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#abd1ec322451d3befc68ecc5c66bf1cf7">fMaxEndChisq</a>) {</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;        <span class="keyword">auto</span> marker_it = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.find(hit1a.getID());</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;        <span class="keywordflow">if</span> (marker_it != <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.end()) {</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;          TMarker* marker = marker_it-&gt;second;</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;          marker-&gt;SetMarkerColor(kGreen);</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;        }</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;        trackmap.erase(trackmap.begin(), it);</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;        done = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;      }</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;      <span class="comment">// Check end.</span></div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;      it = trackmap.end();</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;      --it;</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;      <span class="keyword">const</span> KHitTrack&amp; trh1b = (*it).second;</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;      <span class="keyword">const</span> KHitBase&amp; hit1b = *(trh1b.getHit());</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;      plane1 = hit1b.getMeasPlane();</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;      chisq1 = hit1b.getChisq();</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;      --it;</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;      <span class="keyword">const</span> KHitTrack&amp; trh2b = (*it).second;</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;      <span class="keyword">const</span> KHitBase&amp; hit2b = *(trh2b.getHit());</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;      plane2 = hit2b.getMeasPlane();</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;      chisq2 = hit2b.getChisq();</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;      <span class="keywordflow">if</span> ((plane1 &gt;= 0 &amp;&amp; plane2 &gt;= 0 &amp;&amp; plane1 == plane2) || chisq1 &gt; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#abd1ec322451d3befc68ecc5c66bf1cf7">fMaxEndChisq</a> ||</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;          chisq2 &gt; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#abd1ec322451d3befc68ecc5c66bf1cf7">fMaxEndChisq</a>) {</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;        ++it;</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;        <span class="keyword">auto</span> marker_it = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.find(hit1b.getID());</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;        <span class="keywordflow">if</span> (marker_it != <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.end()) {</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;          TMarker* marker = marker_it-&gt;second;</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;          marker-&gt;SetMarkerColor(kGreen);</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;        }</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;        trackmap.erase(it, trackmap.end());</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;        done = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;      }</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;    }</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;    <span class="comment">// Loop over successive pairs of elements of track map.  Look for</span></div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;    <span class="comment">// adjacent elements with distance separation greater than</span></div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;    <span class="comment">// fGapDist.</span></div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;    std::multimap&lt;double, KHitTrack&gt;::iterator it = trackmap.begin();</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;    std::multimap&lt;double, KHitTrack&gt;::iterator jt = trackmap.end();</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;    <span class="keywordtype">int</span> nb = 0;      <span class="comment">// Number of elements from begin to jt.</span></div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;    <span class="keywordtype">int</span> ne = ntrack; <span class="comment">// Number of elements it to end.</span></div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;    <span class="keywordtype">bool</span> found_noise = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;    <span class="keywordflow">for</span> (; it != trackmap.end(); ++it, ++nb, --ne) {</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;      <span class="keywordflow">if</span> (jt == trackmap.end())</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;        jt = trackmap.begin();</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;        <span class="keywordflow">if</span> (nb &lt; 1)</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;          <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;KalmanFilterAlg&quot;</span>)</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;KalmanFilterAlg::cleanTrack(): nb not positive\n&quot;</span>;</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;        <span class="keywordflow">if</span> (ne &lt; 1)</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;          <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;KalmanFilterAlg&quot;</span>)</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;KalmanFilterAlg::cleanTrack(): ne not positive\n&quot;</span>;</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;        <span class="keywordtype">double</span> disti = (*it).first;</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;        <span class="keywordtype">double</span> distj = (*jt).first;</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;        <span class="keywordtype">double</span> sep = disti - distj;</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;        <span class="keywordflow">if</span> (sep &lt; 0.)</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;          <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;KalmanFilterAlg&quot;</span>)</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;KalmanFilterAlg::fitMomentumRange(): negative separation\n&quot;</span>;</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;        <span class="keywordflow">if</span> (sep &gt; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#abf1964ef45b2fe837428a8719eddbe2e">fGapDist</a>) {</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;          <span class="comment">// Found a gap.  See if we want to trim track.</span></div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;          <span class="keywordflow">if</span> (nb &lt;= <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a8d0ff60ed611fc2b67398f0855a5499e">fMaxNoiseHits</a>) {</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;            <span class="comment">// Trim front.</span></div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;            found_noise = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span> jt = trackmap.begin(); jt != it; ++jt) {</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;              <span class="keyword">const</span> KHitTrack&amp; trh = jt-&gt;second;</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;              <span class="keyword">const</span> KHitBase&amp; hit = *(trh.getHit());</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;              <span class="keyword">auto</span> marker_it = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.find(hit.getID());</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;              <span class="keywordflow">if</span> (marker_it != <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.end()) {</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;                TMarker* marker = marker_it-&gt;second;</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;                marker-&gt;SetMarkerColor(kGreen);</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;              }</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;            }</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;            trackmap.erase(trackmap.begin(), it);</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;          }</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;          <span class="keywordflow">if</span> (ne &lt;= <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a8d0ff60ed611fc2b67398f0855a5499e">fMaxNoiseHits</a>) {</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;            <span class="comment">// Trim back.</span></div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;            found_noise = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span> jt = it; jt != trackmap.end(); ++jt) {</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;              <span class="keyword">const</span> KHitTrack&amp; trh = jt-&gt;second;</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;              <span class="keyword">const</span> KHitBase&amp; hit = *(trh.getHit());</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;              <span class="keyword">auto</span> marker_it = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.find(hit.getID());</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;              <span class="keywordflow">if</span> (marker_it != <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.end()) {</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;                TMarker* marker = marker_it-&gt;second;</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;                marker-&gt;SetMarkerColor(kGreen);</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;              }</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;            }</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;            trackmap.erase(it, trackmap.end());</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;          }</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;        }</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;        ++jt;</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;      }</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;    }</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;    <span class="comment">// Decide if we are done.</span></div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;    done = !found_noise;</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;  }</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">fGTrace</a> &amp;&amp; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.size() &gt; 0) <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.back()-&gt;Update();</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;}</div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a98537b1f46ca2024dec2b9504c4fccc3"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">trkf::KalmanFilterAlg::fGTrace</a></div><div class="ttdeci">bool fGTrace</div><div class="ttdoc">Graphical trace flag. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00168">KalmanFilterAlg.h:168</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_abf1964ef45b2fe837428a8719eddbe2e"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#abf1964ef45b2fe837428a8719eddbe2e">trkf::KalmanFilterAlg::fGapDist</a></div><div class="ttdeci">double fGapDist</div><div class="ttdoc">Minimum gap distance. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00163">KalmanFilterAlg.h:163</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a96c1397d785be158129c8d36ea6987a6"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">trkf::KalmanFilterAlg::fMarkerMap</a></div><div class="ttdeci">std::map&lt; int, TMarker * &gt; fMarkerMap</div><div class="ttdoc">Markers in current canvas. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00183">KalmanFilterAlg.h:183</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_abd1ec322451d3befc68ecc5c66bf1cf7"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#abd1ec322451d3befc68ecc5c66bf1cf7">trkf::KalmanFilterAlg::fMaxEndChisq</a></div><div class="ttdeci">double fMaxEndChisq</div><div class="ttdoc">Maximum incremental chisquare for endpoint hit. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00154">KalmanFilterAlg.h:154</a></div></div>
<div class="ttc" id="cheaterreco_8fcl_html_abf2e819dbf4c327e098bebd4b2dc0597"><div class="ttname"><a href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a></div><div class="ttdeci">process_name hit</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d36/cheaterreco_8fcl_source.html#l00051">cheaterreco.fcl:51</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_ae784305d3e992d3650c1aab19487c7b0"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">trkf::KalmanFilterAlg::fCanvases</a></div><div class="ttdeci">std::vector&lt; std::unique_ptr&lt; TCanvas &gt; &gt; fCanvases</div><div class="ttdoc">Graphical trace canvases. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00179">KalmanFilterAlg.h:179</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a8d0ff60ed611fc2b67398f0855a5499e"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a8d0ff60ed611fc2b67398f0855a5499e">trkf::KalmanFilterAlg::fMaxNoiseHits</a></div><div class="ttdeci">int fMaxNoiseHits</div><div class="ttdoc">Maximum number of hits in noise cluster. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00164">KalmanFilterAlg.h:164</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2f8e9a720427a64e88b24d109da0bfd6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::KalmanFilterAlg::extendTrack </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> &amp;&#160;</td>
          <td class="paramname"><em>trg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a> &amp;&#160;</td>
          <td class="paramname"><em>prop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d5/dcd/classtrkf_1_1KHitContainer.html">KHitContainer</a> &amp;&#160;</td>
          <td class="paramname"><em>hits</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add hits to existing track. </p>
<p>Add hits to existing track.</p>
<p>Arguments:</p>
<p>trg - <a class="el" href="../../d4/d66/structTrack.html">Track</a> to extend. prop - <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a>. hits - Hit collection to choose hits from.</p>
<p>This method extends a <a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> by adding hits. The <a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> must have previously been produced by a unidirectional Kalman fit (it should be optimal at one end). This method finds the optimal end and extends the track in that direction. If any hits are added, the originally optimal end has its status reset to forward or backward, and the new endpoint is optimal. In any case, the final result is unidirectionally fit <a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a>. </p>

<p>Definition at line <a class="el" href="../../d2/dab/KalmanFilterAlg_8cxx_source.html#l01158">1158</a> of file <a class="el" href="../../d2/dab/KalmanFilterAlg_8cxx_source.html">KalmanFilterAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;{</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;  <span class="comment">// Default result failure.</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">fGTrace</a> &amp;&amp; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.size() &gt; 0) {</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    TText* t = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ac88efbb9c1344f770aac5d9e11ebe9e9">fMessages</a>-&gt;AddText(<span class="stringliteral">&quot;Enter extendTrack&quot;</span>);</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    t-&gt;SetBit(kCanDelete);</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aab59822b5451db197c582cbd098be11a">fInfoPad</a>-&gt;Modified();</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.back()-&gt;Update();</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  }</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  <span class="comment">// Remember the original number of measurement.</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nhits0 = trg.numHits();</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  <span class="comment">// It is an error if the KGTrack is not valid.</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  <span class="keywordflow">if</span> (trg.isValid()) {</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    mf::LogInfo log(<span class="stringliteral">&quot;KalmanFilterAlg&quot;</span>);</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="comment">// Examine the track endpoints and figure out which end of the</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    <span class="comment">// track to extend.  The track is always extended from the optimal</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <span class="comment">// end.  It is an error if neither end point is optimal, or both</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <span class="comment">// endoints are optimal.  Reset the status of the optimal, and</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <span class="comment">// make a copy of the starting track fit.  Also get starting path</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="comment">// and chisquare.</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    KHitTrack&amp; trh0 = trg.startTrack();</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    KHitTrack&amp; trh1 = trg.endTrack();</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5">KFitTrack::FitStatus</a> stat0 = trh0.getStat();</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5">KFitTrack::FitStatus</a> stat1 = trh1.getStat();</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    <span class="keywordtype">bool</span> dofit = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354">Propagator::PropDirection</a> <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> = <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185">Propagator::UNKNOWN</a>;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    KFitTrack trf;</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    <span class="keywordtype">double</span> path = 0.;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    <span class="keywordtype">double</span> tchisq = 0.;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    <span class="keywordflow">if</span> (stat0 == <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1">KFitTrack::OPTIMAL</a>) {</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;      <span class="keywordflow">if</span> (stat1 == <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1">KFitTrack::OPTIMAL</a>) {</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;        <span class="comment">// Both ends optimal (do nothing, return failure).</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        dofit = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        result = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;      }</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;        <span class="comment">// Start optimal.  Extend backward.</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        dofit = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;        dir = <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354abb50b9e012a19f7643321f6aa64ecb19">Propagator::BACKWARD</a>;</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        trh0.setStat(<a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5ad673adc72cebdfb1864653ad774eec1c">KFitTrack::BACKWARD</a>);</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        trf = trh0;</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;        path = trh0.getPath();</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;        tchisq = trh0.getChisq();</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;      }</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    }</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;      <span class="keywordflow">if</span> (stat1 == <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1">KFitTrack::OPTIMAL</a>) {</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        <span class="comment">// End optimal.  Extend forward.</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;        dofit = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;        dir = <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">Propagator::FORWARD</a>;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;        trh1.setStat(<a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5ad3811944785e6ac5a7496a98d167110d">KFitTrack::FORWARD</a>);</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;        trf = trh1;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;        path = trh1.getPath();</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;        tchisq = trh1.getChisq();</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        <span class="comment">// Make sure forward extend track momentum is over some</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        <span class="comment">// minimum value.</span></div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        <span class="keywordflow">if</span> (trf.getVector()(4) &gt; 5.) {</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;          trf.getVector()(4) = 5.;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;          trf.getError()(4, 4) = 5.;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;        }</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;      }</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        <span class="comment">// Neither end optimal (do nothing, return failure).</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;        dofit = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        result = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;      }</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    }</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <span class="keywordflow">if</span> (dofit) {</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;      <span class="comment">// Sort hit container using starting track.</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;      hits.sort(trf, <span class="keyword">true</span>, prop, dir);</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;      <span class="comment">// Draw and add hits in hit-&gt;marker map that are not already there.</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">fGTrace</a> &amp;&amp; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.size() &gt; 0) {</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;        <span class="comment">// Loop over sorted KHitGroups.</span></div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;        <span class="comment">// Paint sorted hits black.</span></div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;        <span class="keyword">const</span> std::list&lt;KHitGroup&gt;&amp; groups = hits.getSorted();</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; gr : groups) {</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;          <span class="comment">// Loop over hits in this group.</span></div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;          <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;const KHitBase&gt;&gt;&amp; phits = gr.getHits();</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;          <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; phit : phits) {</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;            <span class="keyword">const</span> KHitBase&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = *phit;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;            <span class="keywordtype">int</span> pl = hit.getMeasPlane();</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;            <span class="keywordflow">if</span> (pl &gt;= 0 &amp;&amp; pl &lt; <span class="keywordtype">int</span>(<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a20cddd0f3cbc4d4b2b999a42f0915b27">fPads</a>.size())) {</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;              <span class="comment">// Is this hit already in map?</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;              TMarker* marker = 0;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;              <span class="keyword">auto</span> marker_it = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.find(hit.getID());</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;              <span class="keywordflow">if</span> (marker_it == <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.end()) {</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;                <span class="keywordtype">double</span> <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#ae40184b0245025a43c56daa3261d5e3c">z</a> = 0.;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;                <span class="keywordtype">double</span> <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a> = 0.;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;                hit_position(hit, z, x);</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;                marker = <span class="keyword">new</span> TMarker(z, x, 20);</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;                <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>[hit.getID()] = marker;</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;                <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a20cddd0f3cbc4d4b2b999a42f0915b27">fPads</a>[pl]-&gt;cd();</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;                marker-&gt;SetBit(kCanDelete); <span class="comment">// Give away ownership.</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;                marker-&gt;SetMarkerSize(0.5);</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;                marker-&gt;Draw();</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;              }</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;                marker = marker_it-&gt;second;</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;              marker-&gt;SetMarkerColor(kBlack);</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;            }</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;          }</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;        }</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;        <span class="comment">// Loop over unsorted KHitGroups.</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;        <span class="comment">// Paint unsorted hits blue.</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;        <span class="keyword">const</span> std::list&lt;KHitGroup&gt;&amp; ugroups = hits.getUnsorted();</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; gr : ugroups) {</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;          <span class="comment">// Loop over hits in this group.</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;          <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;const KHitBase&gt;&gt;&amp; phits = gr.getHits();</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;          <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; phit : phits) {</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            <span class="keyword">const</span> KHitBase&amp; hit = *phit;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;            <span class="keywordtype">int</span> pl = hit.getMeasPlane();</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;            <span class="keywordflow">if</span> (pl &gt;= 0 &amp;&amp; pl &lt; <span class="keywordtype">int</span>(<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a20cddd0f3cbc4d4b2b999a42f0915b27">fPads</a>.size())) {</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;              <span class="comment">// Is this hit already in map?</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;              TMarker* marker = 0;</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;              <span class="keyword">auto</span> marker_it = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.find(hit.getID());</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;              <span class="keywordflow">if</span> (marker_it == <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.end()) {</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;                <span class="keywordtype">double</span> z = 0.;</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;                <span class="keywordtype">double</span> x = 0.;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;                hit_position(hit, z, x);</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;                marker = <span class="keyword">new</span> TMarker(z, x, 20);</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;                <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>[hit.getID()] = marker;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;                <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a20cddd0f3cbc4d4b2b999a42f0915b27">fPads</a>[pl]-&gt;cd();</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;                marker-&gt;SetBit(kCanDelete); <span class="comment">// Give away ownership.</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;                marker-&gt;SetMarkerSize(0.5);</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;                marker-&gt;Draw();</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;              }</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;                marker = marker_it-&gt;second;</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;              marker-&gt;SetMarkerColor(kBlue);</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;            }</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;          }</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;        }</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;        <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.back()-&gt;Update();</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;      }</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;      <span class="comment">//std::cout &lt;&lt; &quot;extendTrack: marker map has &quot; &lt;&lt; fMarkerMap.size() &lt;&lt; &quot; entries.&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;      <span class="comment">// Extend loop starts here.</span></div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;      <span class="keywordtype">int</span> step = 0;</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;      <span class="keywordtype">int</span> nsame = 0;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;      <span class="keywordtype">int</span> last_plane = -1;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;      <span class="keywordflow">while</span> (hits.getSorted().size() &gt; 0) {</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        ++step;</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>) {</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;          log &lt;&lt; <span class="stringliteral">&quot;Extend Step &quot;</span> &lt;&lt; step &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;          log &lt;&lt; <span class="stringliteral">&quot;KGTrack has &quot;</span> &lt;&lt; trg.numHits() &lt;&lt; <span class="stringliteral">&quot; hits.\n&quot;</span>;</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;          log &lt;&lt; trf;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;        }</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;        <span class="comment">// Get an iterator for the next KHitGroup.</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;        std::list&lt;KHitGroup&gt;::iterator it;</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;        <span class="keywordflow">switch</span> (dir) {</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">Propagator::FORWARD</a>: it = hits.getSorted().begin(); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354abb50b9e012a19f7643321f6aa64ecb19">Propagator::BACKWARD</a>:</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;          it = hits.getSorted().end();</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;          --it;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;          <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;KalmanFilterAlg&quot;</span>)</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;KalmanFilterAlg::extendTrack(): invalid direction\n&quot;</span>;</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        } <span class="comment">// switch</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;        <span class="keyword">const</span> KHitGroup&amp; gr = *it;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>) {</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;          <span class="keywordtype">double</span> path_est = gr.getPath();</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;          log &lt;&lt; <span class="stringliteral">&quot;Next surface: &quot;</span> &lt;&lt; *(gr.getSurface()) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;          log &lt;&lt; <span class="stringliteral">&quot;  Estimated path length of hit group = &quot;</span> &lt;&lt; path_est &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;        }</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;        <span class="comment">// Get the next prediction surface.  If this KHitGroup is on the</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;        <span class="comment">// preferred plane, use that as the prediction surface.</span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        <span class="comment">// Otherwise, use the current track surface as the prediction</span></div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;        <span class="comment">// surface.</span></div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        std::shared_ptr&lt;const Surface&gt; psurf = trf.getSurface();</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;        <span class="keywordflow">if</span> (gr.getPlane() &lt; 0)</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;          <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;KalmanFilterAlg&quot;</span>)</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;KalmanFilterAlg::extendTrack(): negative plane?\n&quot;</span>;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a18bdb931d6b6730cfe499df7379da449">fPlane</a> &lt; 0 || gr.getPlane() &lt; 0 || <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a18bdb931d6b6730cfe499df7379da449">fPlane</a> == gr.getPlane()) psurf = gr.getSurface();</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;        <span class="comment">// Propagate track to the prediction surface.</span></div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;        std::optional&lt;double&gt; <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a> = prop.noise_prop(trf, psurf, <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185">Propagator::UNKNOWN</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;        <span class="keywordflow">if</span> (dist &amp;&amp; <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(*dist) &gt; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a78b312879081cd58cc8ba80db633c875">fMaxPropDist</a>) dist = std::nullopt;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../d9/d69/namespacelariov_1_1DataSource.html#a9877bcd384b60abd8cbe121d11f43b5b">ds</a> = 0.;</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;        <span class="keywordflow">if</span> (dist) {</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;          <span class="comment">// Propagation succeeded.</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;          <span class="comment">// Update cumulative path distance and track status.</span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;          ds = *<a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>;</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;          path += <a class="code" href="../../d9/d69/namespacelariov_1_1DataSource.html#a9877bcd384b60abd8cbe121d11f43b5b">ds</a>;</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;          trf.setPath(path);</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;          <span class="keywordflow">if</span> (dir == <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">Propagator::FORWARD</a>)</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;            trf.setStat(<a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a6f3336fe810af67d6ce9069176fb6af7">KFitTrack::FORWARD_PREDICTED</a>);</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;          <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;            trf.setStat(<a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5aecd7b60b3e363d4bb97e476bff2ade03">KFitTrack::BACKWARD_PREDICTED</a>);</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;          }</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>) {</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;            log &lt;&lt; <span class="stringliteral">&quot;After propagation\n&quot;</span>;</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;            log &lt;&lt; <span class="stringliteral">&quot;  Incremental distance = &quot;</span> &lt;&lt; ds &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;            log &lt;&lt; <span class="stringliteral">&quot;  Track path length = &quot;</span> &lt;&lt; path &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;            log &lt;&lt; <span class="stringliteral">&quot;KGTrack has &quot;</span> &lt;&lt; trg.numHits() &lt;&lt; <span class="stringliteral">&quot; hits.\n&quot;</span>;</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;            log &lt;&lt; trf;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;          }</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;          <span class="comment">// Loop over measurements in this group.</span></div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;          <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;const KHitBase&gt;&gt;&amp; hits = gr.getHits();</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;          <span class="keywordtype">double</span> best_chisq = 0.;</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;          std::shared_ptr&lt;const KHitBase&gt; best_hit;</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;std::shared_ptr&lt;const KHitBase&gt;&gt;::const_iterator ihit = hits.begin();</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;               ihit != hits.end();</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;               ++ihit) {</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;            <span class="keyword">const</span> KHitBase&amp; hit = **ihit;</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;            <span class="comment">// Turn this hit blue.</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">fGTrace</a> &amp;&amp; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.size() &gt; 0) {</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;              <span class="keyword">auto</span> marker_it = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.find(hit.getID());</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;              <span class="keywordflow">if</span> (marker_it != <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.end()) {</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;                TMarker* marker = marker_it-&gt;second;</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;                marker-&gt;SetMarkerColor(kBlue);</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;              }</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;              <span class="comment">//fCanvases.back()-&gt;Update();</span></div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;            }</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;            <span class="comment">// Update predction using current track hypothesis and get</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;            <span class="comment">// incremental chisquare.</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;            <span class="keywordtype">bool</span> ok = hit.predict(trf, prop);</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;            <span class="keywordflow">if</span> (ok) {</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;              <span class="keywordtype">double</span> chisq = hit.getChisq();</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;              <span class="keywordtype">double</span> preddist = hit.getPredDistance();</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;              <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a>(preddist) &lt; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a8450d720a8df6f545925efa49c17869f">fMaxPredDist</a> &amp;&amp; (best_hit.get() == 0 || chisq &lt; best_chisq)) {</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;                best_chisq = chisq;</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;                <span class="keywordflow">if</span> (chisq &lt; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a955c9082fc249a45f79f4a8997c6d291">fMaxIncChisq</a>) best_hit = *ihit;</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;              }</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;            }</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;          }</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>) {</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;            log &lt;&lt; <span class="stringliteral">&quot;Best hit incremental chisquare = &quot;</span> &lt;&lt; best_chisq &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;            <span class="keywordflow">if</span> (best_hit.get() != 0) {</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;              log &lt;&lt; <span class="stringliteral">&quot;Hit after prediction\n&quot;</span>;</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;              log &lt;&lt; *best_hit;</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;            }</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;              log &lt;&lt; <span class="stringliteral">&quot;No hit passed chisquare cut.\n&quot;</span>;</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;          }</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">fGTrace</a> &amp;&amp; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.size() &gt; 0) <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.back()-&gt;Update();</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;          <span class="comment">// If we found a best measurement, and if the incremental</span></div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;          <span class="comment">// chisquare passes the cut, add it to the track and update</span></div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;          <span class="comment">// fit information.</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;          <span class="keywordtype">bool</span> update_ok = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;          <span class="keywordflow">if</span> (best_hit.get() != 0) {</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;            KFitTrack trf0(trf);</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;            best_hit-&gt;update(trf);</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;            update_ok = trf.isValid();</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;            <span class="keywordflow">if</span> (!update_ok) trf = trf0;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;          }</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;          <span class="keywordflow">if</span> (update_ok) {</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;            ds += best_hit-&gt;getPredDistance();</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;            tchisq += best_chisq;</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;            trf.setChisq(tchisq);</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;            <span class="keywordflow">if</span> (dir == <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">Propagator::FORWARD</a>)</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;              trf.setStat(<a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5ad3811944785e6ac5a7496a98d167110d">KFitTrack::FORWARD</a>);</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;            <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;              trf.setStat(<a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5ad673adc72cebdfb1864653ad774eec1c">KFitTrack::BACKWARD</a>);</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;            }</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;            <span class="comment">// If the pointing error got too large, quit.</span></div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;            <span class="keywordflow">if</span> (trf.PointingError() &gt; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ab6bcc54a19e33e2e7639f6110c821ac2">fMaxPErr</a>) {</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;              <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>) log &lt;&lt; <span class="stringliteral">&quot;Quitting because pointing error got too large.\n&quot;</span>;</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;            }</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;            <span class="comment">// Test number of consecutive measurements in the same plane.</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;            <span class="keywordflow">if</span> (gr.getPlane() &gt;= 0) {</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;              <span class="keywordflow">if</span> (gr.getPlane() == last_plane)</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;                ++nsame;</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;              <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;                nsame = 1;</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;                last_plane = gr.getPlane();</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;              }</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;            }</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;            <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;              nsame = 0;</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;              last_plane = -1;</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;            }</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;            <span class="keywordflow">if</span> (nsame &lt;= <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#afa116c60288b506aeddffd04ad08f9df">fMaxSamePlane</a>) {</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;              <span class="comment">// Turn best hit red.</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;              <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">fGTrace</a> &amp;&amp; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.size() &gt; 0) {</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;                <span class="keywordtype">int</span> pl = best_hit-&gt;getMeasPlane();</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;                <span class="keywordflow">if</span> (pl &gt;= 0 &amp;&amp; pl &lt; <span class="keywordtype">int</span>(<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a20cddd0f3cbc4d4b2b999a42f0915b27">fPads</a>.size())) {</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;                  <span class="keyword">auto</span> marker_it = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.find(best_hit-&gt;getID());</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;                  <span class="keywordflow">if</span> (marker_it != <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.end()) {</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;                    TMarker* marker = marker_it-&gt;second;</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;                    marker-&gt;SetMarkerColor(kRed);</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;                    <span class="comment">// Redraw marker so that it will be on top.</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;                    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a20cddd0f3cbc4d4b2b999a42f0915b27">fPads</a>[pl]-&gt;cd();</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;                    marker-&gt;Draw();</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;                  }</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;                }</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;                <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.back()-&gt;Update();</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;              }</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;              <span class="comment">// Make a KHitTrack and add it to the KGTrack.</span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;              KHitTrack trh(trf, best_hit);</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;              trg.addTrack(trh);</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;              <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>) {</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;                log &lt;&lt; <span class="stringliteral">&quot;After update\n&quot;</span>;</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;                log &lt;&lt; <span class="stringliteral">&quot;KGTrack has &quot;</span> &lt;&lt; trg.numHits() &lt;&lt; <span class="stringliteral">&quot; hits.\n&quot;</span>;</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;                log &lt;&lt; trf;</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;              }</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;            }</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;          }</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;        }</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        <span class="comment">// The current KHitGroup is now resolved.</span></div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        <span class="comment">// Move it to unused list.</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;        hits.getUnused().splice(hits.getUnused().end(), hits.getSorted(), it);</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;        <span class="comment">// If the propagation distance was the wrong direction, resort the measurements.</span></div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;        <span class="keywordflow">if</span> (dist &amp;&amp; ((dir == <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">Propagator::FORWARD</a> &amp;&amp; (ds &lt; fMinSortDist || ds &gt; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a064806b6f47119501c2a4b1a8c0d43d4">fMaxSortDist</a>)) ||</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;                     (dir == <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354abb50b9e012a19f7643321f6aa64ecb19">Propagator::BACKWARD</a> &amp;&amp; (-ds &lt; fMinSortDist || -ds &gt; fMaxSortDist)))) {</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>) log &lt;&lt; <span class="stringliteral">&quot;Resorting measurements.\n&quot;</span>;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;          hits.sort(trf, <span class="keyword">true</span>, prop, dir);</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;        }</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;      }</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;    }</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    <span class="comment">// Clean track.</span></div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#afc18359dc25a380997a38d537eaeccad">cleanTrack</a>(trg);</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    <span class="comment">// Set the fit status of the last added KHitTrack to optimal and</span></div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    <span class="comment">// get the final chisquare and path length.</span></div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    <span class="keywordtype">double</span> fchisq = 0.;</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    path = 0.;</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    <span class="keywordflow">if</span> (trg.isValid()) {</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;      path = trg.endTrack().getPath() - trg.startTrack().getPath();</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;      <span class="keywordflow">switch</span> (dir) {</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">Propagator::FORWARD</a>:</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;        trg.endTrack().setStat(<a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1">KFitTrack::OPTIMAL</a>);</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;        fchisq = trg.endTrack().getChisq();</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354abb50b9e012a19f7643321f6aa64ecb19">Propagator::BACKWARD</a>:</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;        trg.startTrack().setStat(<a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1">KFitTrack::OPTIMAL</a>);</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;        fchisq = trg.startTrack().getChisq();</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;      <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;        <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;KalmanFilterAlg&quot;</span>)</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;KalmanFilterAlg::extendTrack(): invalid direction [II]\n&quot;</span>;</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;      } <span class="comment">// switch</span></div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    }</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <span class="comment">// Summary.</span></div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    log &lt;&lt; <span class="stringliteral">&quot;KalmanFilterAlg extend track summary.\n&quot;</span></div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Extend direction = &quot;</span> &lt;&lt; (dir == <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">Propagator::FORWARD</a> ? <span class="stringliteral">&quot;FORWARD&quot;</span> : <span class="stringliteral">&quot;BACKWARD&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Track has &quot;</span> &lt;&lt; trg.numHits() &lt;&lt; <span class="stringliteral">&quot; hits.\n&quot;</span></div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Track length = &quot;</span> &lt;&lt; path &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Track chisquare = &quot;</span> &lt;&lt; fchisq &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    <span class="comment">// log &lt;&lt; trg &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;  }</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  <span class="comment">// Done.</span></div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;  result = (trg.numHits() &gt; nhits0);</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">fGTrace</a> &amp;&amp; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.size() &gt; 0) {</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    TText* t = 0;</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    <span class="keywordflow">if</span> (result)</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;      t = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ac88efbb9c1344f770aac5d9e11ebe9e9">fMessages</a>-&gt;AddText(<span class="stringliteral">&quot;Exit extendTrack, status success&quot;</span>);</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;      t = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ac88efbb9c1344f770aac5d9e11ebe9e9">fMessages</a>-&gt;AddText(<span class="stringliteral">&quot;Exit extendTrack, status fail&quot;</span>);</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    t-&gt;SetBit(kCanDelete);</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aab59822b5451db197c582cbd098be11a">fInfoPad</a>-&gt;Modified();</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.back()-&gt;Update();</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;  }</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;}</div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a98537b1f46ca2024dec2b9504c4fccc3"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">trkf::KalmanFilterAlg::fGTrace</a></div><div class="ttdeci">bool fGTrace</div><div class="ttdoc">Graphical trace flag. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00168">KalmanFilterAlg.h:168</a></div></div>
<div class="ttc" id="run__opflash__electron_8fcl_html_ae40184b0245025a43c56daa3261d5e3c"><div class="ttname"><a href="../../d0/d84/run__opflash__electron_8fcl.html#ae40184b0245025a43c56daa3261d5e3c">z</a></div><div class="ttdeci">process_name opflash particleana ie ie ie z</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d84/run__opflash__electron_8fcl_source.html#l00092">run_opflash_electron.fcl:92</a></div></div>
<div class="ttc" id="namespacelariov_1_1DataSource_html_a9877bcd384b60abd8cbe121d11f43b5b"><div class="ttname"><a href="../../d9/d69/namespacelariov_1_1DataSource.html#a9877bcd384b60abd8cbe121d11f43b5b">lariov::DataSource::ds</a></div><div class="ttdeci">ds</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dca/IOVDataConstants_8h_source.html#l00015">IOVDataConstants.h:15</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a78b312879081cd58cc8ba80db633c875"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a78b312879081cd58cc8ba80db633c875">trkf::KalmanFilterAlg::fMaxPropDist</a></div><div class="ttdeci">double fMaxPropDist</div><div class="ttdoc">Maximum propagation distance to candidate surface. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00159">KalmanFilterAlg.h:159</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a96c1397d785be158129c8d36ea6987a6"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">trkf::KalmanFilterAlg::fMarkerMap</a></div><div class="ttdeci">std::map&lt; int, TMarker * &gt; fMarkerMap</div><div class="ttdoc">Markers in current canvas. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00183">KalmanFilterAlg.h:183</a></div></div>
<div class="ttc" id="run__opflash__electron_8fcl_html_a6673f03521899f7844189bcfd8ee5941"><div class="ttname"><a href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a></div><div class="ttdeci">process_name opflash particleana ie x</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d84/run__opflash__electron_8fcl_source.html#l00090">run_opflash_electron.fcl:90</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a1e70c929d23cb24aae387474026a2ffa"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">trkf::KalmanFilterAlg::fTrace</a></div><div class="ttdeci">bool fTrace</div><div class="ttdoc">Trace flag. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00148">KalmanFilterAlg.h:148</a></div></div>
<div class="ttc" id="classtrkf_1_1KFitTrack_html_acbd881884cdbb8f20e56b6e2bf6cc0f5a6f3336fe810af67d6ce9069176fb6af7"><div class="ttname"><a href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a6f3336fe810af67d6ce9069176fb6af7">trkf::KFitTrack::FORWARD_PREDICTED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db4/KFitTrack_8h_source.html#l00045">KFitTrack.h:45</a></div></div>
<div class="ttc" id="classtrkf_1_1KFitTrack_html_acbd881884cdbb8f20e56b6e2bf6cc0f5ad673adc72cebdfb1864653ad774eec1c"><div class="ttname"><a href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5ad673adc72cebdfb1864653ad774eec1c">trkf::KFitTrack::BACKWARD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db4/KFitTrack_8h_source.html#l00046">KFitTrack.h:46</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_afc18359dc25a380997a38d537eaeccad"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#afc18359dc25a380997a38d537eaeccad">trkf::KalmanFilterAlg::cleanTrack</a></div><div class="ttdeci">void cleanTrack(KGTrack &amp;trg) const </div><div class="ttdoc">Clean track by removing noise hits near endpoints. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dab/KalmanFilterAlg_8cxx_source.html#l02107">KalmanFilterAlg.cxx:2107</a></div></div>
<div class="ttc" id="classtrkf_1_1KFitTrack_html_acbd881884cdbb8f20e56b6e2bf6cc0f5"><div class="ttname"><a href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5">trkf::KFitTrack::FitStatus</a></div><div class="ttdeci">FitStatus</div><div class="ttdoc">Fit status enum. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db4/KFitTrack_8h_source.html#l00041">KFitTrack.h:41</a></div></div>
<div class="ttc" id="cheaterreco_8fcl_html_abf2e819dbf4c327e098bebd4b2dc0597"><div class="ttname"><a href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a></div><div class="ttdeci">process_name hit</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d36/cheaterreco_8fcl_source.html#l00051">cheaterreco.fcl:51</a></div></div>
<div class="ttc" id="classtrkf_1_1KFitTrack_html_acbd881884cdbb8f20e56b6e2bf6cc0f5aecd7b60b3e363d4bb97e476bff2ade03"><div class="ttname"><a href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5aecd7b60b3e363d4bb97e476bff2ade03">trkf::KFitTrack::BACKWARD_PREDICTED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db4/KFitTrack_8h_source.html#l00047">KFitTrack.h:47</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_af689f4b8a505b7a64dcd9c7e6c824354abb50b9e012a19f7643321f6aa64ecb19"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354abb50b9e012a19f7643321f6aa64ecb19">trkf::Propagator::BACKWARD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00094">Propagator.h:94</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a064806b6f47119501c2a4b1a8c0d43d4"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a064806b6f47119501c2a4b1a8c0d43d4">trkf::KalmanFilterAlg::fMaxSortDist</a></div><div class="ttdeci">double fMaxSortDist</div><div class="ttdoc">Sort high distance threshold. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00161">KalmanFilterAlg.h:161</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a8450d720a8df6f545925efa49c17869f"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a8450d720a8df6f545925efa49c17869f">trkf::KalmanFilterAlg::fMaxPredDist</a></div><div class="ttdeci">double fMaxPredDist</div><div class="ttdoc">Maximum prediciton distance to accept a hit. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00157">KalmanFilterAlg.h:157</a></div></div>
<div class="ttc" id="namespacelar_1_1dump_html_a71d4403edbac4d265176f8677118194f"><div class="ttname"><a href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">lar::dump::vector</a></div><div class="ttdeci">auto vector(Vector const &amp;v)</div><div class="ttdoc">Returns a manipulator which will print the specified array. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/DumpUtils_8h_source.html#l00265">DumpUtils.h:265</a></div></div>
<div class="ttc" id="sparse__vector__test_8cc_html_a39f16bf854ba527dee7eba5bbbd93f3f"><div class="ttname"><a href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a></div><div class="ttdeci">T abs(T value)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d59/sparse__vector__test_8cc_source.html#l00030">sparse_vector_test.cc:30</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185">trkf::Propagator::UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00094">Propagator.h:94</a></div></div>
<div class="ttc" id="classtrkf_1_1KFitTrack_html_acbd881884cdbb8f20e56b6e2bf6cc0f5ad3811944785e6ac5a7496a98d167110d"><div class="ttname"><a href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5ad3811944785e6ac5a7496a98d167110d">trkf::KFitTrack::FORWARD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db4/KFitTrack_8h_source.html#l00044">KFitTrack.h:44</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_aab59822b5451db197c582cbd098be11a"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#aab59822b5451db197c582cbd098be11a">trkf::KalmanFilterAlg::fInfoPad</a></div><div class="ttdeci">TVirtualPad * fInfoPad</div><div class="ttdoc">Information pad. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00181">KalmanFilterAlg.h:181</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_ae784305d3e992d3650c1aab19487c7b0"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">trkf::KalmanFilterAlg::fCanvases</a></div><div class="ttdeci">std::vector&lt; std::unique_ptr&lt; TCanvas &gt; &gt; fCanvases</div><div class="ttdoc">Graphical trace canvases. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00179">KalmanFilterAlg.h:179</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">trkf::Propagator::FORWARD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00094">Propagator.h:94</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_ac88efbb9c1344f770aac5d9e11ebe9e9"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ac88efbb9c1344f770aac5d9e11ebe9e9">trkf::KalmanFilterAlg::fMessages</a></div><div class="ttdeci">TPaveText * fMessages</div><div class="ttdoc">Message box. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00182">KalmanFilterAlg.h:182</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a955c9082fc249a45f79f4a8997c6d291"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a955c9082fc249a45f79f4a8997c6d291">trkf::KalmanFilterAlg::fMaxIncChisq</a></div><div class="ttdeci">double fMaxIncChisq</div><div class="ttdoc">Maximum incremental chisquare to accept a hit. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00151">KalmanFilterAlg.h:151</a></div></div>
<div class="ttc" id="namespacedropbox_html_a407b5b895ba9265893768748aaa73825"><div class="ttname"><a href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dropbox.dir</a></div><div class="ttdeci">tuple dir</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d81/dropbox_8py_source.html#l00028">dropbox.py:28</a></div></div>
<div class="ttc" id="namespacelarg4_html_a3b23adbb58bc71f7c54806914226f1f8"><div class="ttname"><a href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">larg4::dist</a></div><div class="ttdeci">constexpr double dist(const TReal *x, const TReal *y, const unsigned int dimension)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d8a/OpFastScintillation_8hh_source.html#l00563">OpFastScintillation.hh:563</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a20cddd0f3cbc4d4b2b999a42f0915b27"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a20cddd0f3cbc4d4b2b999a42f0915b27">trkf::KalmanFilterAlg::fPads</a></div><div class="ttdeci">std::vector&lt; TVirtualPad * &gt; fPads</div><div class="ttdoc">View pads in current canvas. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00180">KalmanFilterAlg.h:180</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_afa116c60288b506aeddffd04ad08f9df"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#afa116c60288b506aeddffd04ad08f9df">trkf::KalmanFilterAlg::fMaxSamePlane</a></div><div class="ttdeci">int fMaxSamePlane</div><div class="ttdoc">Maximum consecutive hits in same plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00162">KalmanFilterAlg.h:162</a></div></div>
<div class="ttc" id="classtrkf_1_1KFitTrack_html_acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1"><div class="ttname"><a href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1">trkf::KFitTrack::OPTIMAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db4/KFitTrack_8h_source.html#l00048">KFitTrack.h:48</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_ab6bcc54a19e33e2e7639f6110c821ac2"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ab6bcc54a19e33e2e7639f6110c821ac2">trkf::KalmanFilterAlg::fMaxPErr</a></div><div class="ttdeci">double fMaxPErr</div><div class="ttdoc">Maximum pointing error for free propagation. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00149">KalmanFilterAlg.h:149</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_af689f4b8a505b7a64dcd9c7e6c824354"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354">trkf::Propagator::PropDirection</a></div><div class="ttdeci">PropDirection</div><div class="ttdoc">Propagation direction enum. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00094">Propagator.h:94</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a18bdb931d6b6730cfe499df7379da449"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a18bdb931d6b6730cfe499df7379da449">trkf::KalmanFilterAlg::fPlane</a></div><div class="ttdeci">int fPlane</div><div class="ttdoc">Preferred view plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00178">KalmanFilterAlg.h:178</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4f95ca6dd70252aa52effbcf378e7288"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::KalmanFilterAlg::fitMomentum </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> &amp;&#160;</td>
          <td class="paramname"><em>trg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a> &amp;&#160;</td>
          <td class="paramname"><em>prop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../df/db0/classtrkf_1_1KETrack.html">KETrack</a> &amp;&#160;</td>
          <td class="paramname"><em>tremom</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Estimate track momentum using either range or multiple scattering. </p>
<p>Estimate track momentum using either range or multiple scattering.</p>
<p>Arguments:</p>
<p>trg - Global track whose momentum is to be updated. prop - <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a>. tremom - <a class="el" href="../../d4/d66/structTrack.html">Track</a> with momentum estimate.</p>
<p>Returns: True if success. </p>

<p>Definition at line <a class="el" href="../../d2/dab/KalmanFilterAlg_8cxx_source.html#l01860">1860</a> of file <a class="el" href="../../d2/dab/KalmanFilterAlg_8cxx_source.html">KalmanFilterAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;{</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;  mf::LogInfo log(<span class="stringliteral">&quot;KalmanFilterAlg&quot;</span>);</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;  <span class="keywordtype">double</span> invp_range = 0.;</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;  <span class="keywordtype">double</span> invp_ms = 0.;</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;  <span class="comment">// Get multiple scattering momentum estimate.</span></div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;  KETrack tremom_ms;</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;  <span class="keywordtype">bool</span> ok_ms = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae8264f4b6fe22a1d500b8bfaa353f29f">fFitMomMS</a>) {</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    ok_ms = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a7dd1e940d54ff0f794c8c5be027ac50e">fitMomentumMS</a>(trg, prop, tremom_ms);</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    <span class="keywordflow">if</span> (ok_ms) {</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;      KGTrack trg_ms(trg);</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;      ok_ms = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a2a5a5f4ed347ca0dad0faefae9adec93">updateMomentum</a>(tremom_ms, prop, trg_ms);</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;      <span class="keywordflow">if</span> (ok_ms) {</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;        invp_ms = trg_ms.startTrack().getVector()(4);</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;        <span class="keywordtype">double</span> var_invp = trg_ms.startTrack().getError()(4, 4);</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> = 0.;</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;        <span class="keywordflow">if</span> (invp_ms != 0.) p = 1. / invp_ms;</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;        <span class="keywordtype">double</span> err_p = p * p * std::sqrt(var_invp);</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;        log &lt;&lt; <span class="stringliteral">&quot;Multiple scattering momentum estimate = &quot;</span> &lt;&lt; p &lt;&lt; <span class="stringliteral">&quot;+-&quot;</span> &lt;&lt; err_p &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;      }</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;    }</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;  }</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;  <span class="comment">// Get range momentum estimate.</span></div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;  KETrack tremom_range;</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;  <span class="keywordtype">bool</span> ok_range = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a9956be6404dc3569538feae4d1a0100d">fFitMomRange</a>) {</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;    ok_range = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a6aaeba5b204bf8af5c8e52043df09cbc">fitMomentumRange</a>(trg, tremom_range);</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;    <span class="keywordflow">if</span> (ok_range) {</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;      KGTrack trg_range(trg);</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;      ok_range = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a2a5a5f4ed347ca0dad0faefae9adec93">updateMomentum</a>(tremom_range, prop, trg_range);</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;      <span class="keywordflow">if</span> (ok_range) {</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;        invp_range = trg_range.startTrack().getVector()(4);</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;        <span class="keywordtype">double</span> var_invp = trg_range.startTrack().getError()(4, 4);</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> = 0.;</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;        <span class="keywordflow">if</span> (invp_range != 0.) p = 1. / invp_range;</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;        <span class="keywordtype">double</span> err_p = p * p * std::sqrt(var_invp);</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;        log &lt;&lt; <span class="stringliteral">&quot;Range momentum estimate               = &quot;</span> &lt;&lt; p &lt;&lt; <span class="stringliteral">&quot;+-&quot;</span> &lt;&lt; err_p &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;      }</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    }</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;  }</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;  <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;  <span class="keywordflow">if</span> (ok_range) {</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;    tremom = tremom_range;</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;    result = ok_range;</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;  }</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ok_ms) {</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;    tremom = tremom_ms;</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;    result = ok_ms;</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;  }</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;}</div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a9956be6404dc3569538feae4d1a0100d"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a9956be6404dc3569538feae4d1a0100d">trkf::KalmanFilterAlg::fFitMomRange</a></div><div class="ttdeci">bool fFitMomRange</div><div class="ttdoc">Fit momentum using range. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00166">KalmanFilterAlg.h:166</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_ae8264f4b6fe22a1d500b8bfaa353f29f"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae8264f4b6fe22a1d500b8bfaa353f29f">trkf::KalmanFilterAlg::fFitMomMS</a></div><div class="ttdeci">bool fFitMomMS</div><div class="ttdoc">Fit momentum using multiple scattering. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00167">KalmanFilterAlg.h:167</a></div></div>
<div class="ttc" id="selectors_8fcl_html_a24c8335057af14a9b508d5ac18999ce5"><div class="ttname"><a href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a></div><div class="ttdeci">pdgs p</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd2/selectors_8fcl_source.html#l00022">selectors.fcl:22</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a7dd1e940d54ff0f794c8c5be027ac50e"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a7dd1e940d54ff0f794c8c5be027ac50e">trkf::KalmanFilterAlg::fitMomentumMS</a></div><div class="ttdeci">bool fitMomentumMS(const KGTrack &amp;trg, const Propagator &amp;prop, KETrack &amp;tremom) const </div><div class="ttdoc">Estimate track momentum using multiple scattering. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dab/KalmanFilterAlg_8cxx_source.html#l01665">KalmanFilterAlg.cxx:1665</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a6aaeba5b204bf8af5c8e52043df09cbc"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a6aaeba5b204bf8af5c8e52043df09cbc">trkf::KalmanFilterAlg::fitMomentumRange</a></div><div class="ttdeci">bool fitMomentumRange(const KGTrack &amp;trg, KETrack &amp;tremom) const </div><div class="ttdoc">Estimate track momentum using range. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dab/KalmanFilterAlg_8cxx_source.html#l01611">KalmanFilterAlg.cxx:1611</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a2a5a5f4ed347ca0dad0faefae9adec93"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a2a5a5f4ed347ca0dad0faefae9adec93">trkf::KalmanFilterAlg::updateMomentum</a></div><div class="ttdeci">bool updateMomentum(const KETrack &amp;tremom, const Propagator &amp;prop, KGTrack &amp;trg) const </div><div class="ttdoc">Set track momentum at each track surface. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dab/KalmanFilterAlg_8cxx_source.html#l01942">KalmanFilterAlg.cxx:1942</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7dd1e940d54ff0f794c8c5be027ac50e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::KalmanFilterAlg::fitMomentumMS </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> &amp;&#160;</td>
          <td class="paramname"><em>trg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a> &amp;&#160;</td>
          <td class="paramname"><em>prop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../df/db0/classtrkf_1_1KETrack.html">KETrack</a> &amp;&#160;</td>
          <td class="paramname"><em>tremom</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Estimate track momentum using multiple scattering. </p>
<p>Estimate track momentum using multiple scattering.</p>
<p>Arguments:</p>
<p>trg - Global track. prop - <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a>. tremom - <a class="el" href="../../d4/d66/structTrack.html">Track</a> containing momentum estimate.</p>
<p>Returns: True if success.</p>
<p>This method estimates the momentum of the specified track using multiple scattering. As a result of calling this method, the original global track is not updated, but a <a class="el" href="../../df/db0/classtrkf_1_1KETrack.html">KETrack</a> is produced near the starting surface that has the estimated momentum.</p>
<p>The global track passed as argument should have been smoothed prior to calling this method so that all or most fits are optimal. If either the first or last fit is not optimal, return false.</p>
<p>This method assumes that track parameter four is 1/p. This sort of momentum estimation only makes sense if the momentum track parameter is uncorrelated with any other track parameter. The error matrix of the first and last fit is checked for this. If it is found that either error matrix has correlated track parameter four with any other track parameter, this method returns without doing anything (return false). </p>

<p>Definition at line <a class="el" href="../../d2/dab/KalmanFilterAlg_8cxx_source.html#l01665">1665</a> of file <a class="el" href="../../d2/dab/KalmanFilterAlg_8cxx_source.html">KalmanFilterAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;{</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;  <span class="comment">// Get iterators pointing to the first and last tracks.</span></div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;  <span class="keyword">const</span> std::multimap&lt;double, KHitTrack&gt;&amp; trackmap = trg.getTrackMap();</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;  <span class="keywordflow">if</span> (trackmap.size() &lt; 2) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;  std::multimap&lt;double, KHitTrack&gt;::const_iterator itend[2];</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;  itend[0] = trackmap.begin();</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;  itend[1] = trackmap.end();</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;  --itend[1];</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;  <span class="comment">// Check the fit status and error matrix of the first and last</span></div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;  <span class="comment">// track.</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;  <span class="keywordtype">bool</span> result = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; result &amp;&amp; i &lt; 2; ++i) {</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    <span class="keyword">const</span> KHitTrack&amp; trh = itend[i]-&gt;second;</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5">KFitTrack::FitStatus</a> <a class="code" href="../../d9/d4d/namespacepython_1_1larbatch__posix.html#a8975349ec6b0427eebf111f540b9cd11">stat</a> = trh.getStat();</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;    <span class="keywordflow">if</span> (stat != <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1">KFitTrack::OPTIMAL</a>) result = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d0/da2/namespacetrkf.html#a20fcb423cfba1923040c27599fd3bf83">TrackError</a>&amp; <a class="code" href="../../da/d2d/namespaceevd.html#a911fe581afad27a720ee200bd61362a6">err</a> = trh.getError();</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; ++j) {</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../da/d2d/namespaceevd.html#a911fe581afad27a720ee200bd61362a6">err</a>(4, j) != 0.) result = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;    }</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;  }</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;  <span class="keywordflow">if</span> (!result) <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;  <span class="comment">// We will periodically sample the track trajectory.  At each sample</span></div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;  <span class="comment">// point, collect the following information.</span></div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;  <span class="comment">// 1.  The path distance at the sample point.</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;  <span class="comment">// 2.  The original momentum of the track at the sample point and its error.</span></div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;  <span class="comment">// 3.  One copy of the track (KETrack) that will be propagated without noise</span></div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;  <span class="comment">//     (infinite momentum track).</span></div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;  <span class="comment">// 3.  A second copy of the track (KETrack) that will be propagated with the</span></div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;  <span class="comment">//     minimum allowed momentum (range out track).</span></div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;  <span class="comment">// 4.  A third copy of the track (KETrack) that will propagated with noise</span></div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;  <span class="comment">//     with some intermediate momentum (noise track).</span></div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;  <span class="comment">// Collect the first sample from the maximum path distance track.</span></div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;  <span class="keywordtype">double</span> s_sample = itend[1]-&gt;first;</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;  <span class="keyword">const</span> KETrack&amp; tre = itend[1]-&gt;second;</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;  KETrack tre_inf(tre);</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;  KTrack trk_range(tre);</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;  KETrack tre_noise(tre);</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;  tre_inf.getVector()(4) = 0.;</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;  tre_inf.getError()(4, 4) = 0.;</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;  trk_range.getVector()(4) = 100.;</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;  tre_noise.getError()(4, 4) = 0.;</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;  tre_noise.getVector()(4) = 1.;</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;  tre_noise.getError()(4, 4) = 10.;</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;  <span class="keywordtype">double</span> invp0 = tre_noise.getVector()(4);</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;  <span class="keywordtype">double</span> var_invp0 = tre_noise.getError()(4, 4);</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;  <span class="comment">// Loop over fits, starting at the high path distance (low momentum)</span></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;  <span class="comment">// end.</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = trackmap.rbegin(); it != trackmap.rend(); ++it) {</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> = it-&gt;first;</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;    <span class="keyword">const</span> KHitTrack&amp; trh = it-&gt;second;</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    <span class="comment">// Ignore non-optimal fits.</span></div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;    <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5">KFitTrack::FitStatus</a> stat = trh.getStat();</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    <span class="keywordflow">if</span> (stat != <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1">KFitTrack::OPTIMAL</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;    <span class="comment">// See if this track is far enough from the previous sample to</span></div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    <span class="comment">// make a new sample point.</span></div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(s - s_sample) &gt; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a7c04c3bbed317634e4f46079d79c4617">fMinSampleDist</a>) {</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;      <span class="comment">// Propagate tracks to the current track surface.</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;      std::shared_ptr&lt;const Surface&gt; psurf = trh.getSurface();</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;      std::optional&lt;double&gt; dist_inf = prop.err_prop(tre_inf, psurf, <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185">Propagator::UNKNOWN</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;      std::optional&lt;double&gt; dist_range =</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;        prop.vec_prop(trk_range, psurf, <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185">Propagator::UNKNOWN</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;      std::optional&lt;double&gt; dist_noise =</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;        prop.noise_prop(tre_noise, psurf, <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185">Propagator::UNKNOWN</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;      <span class="comment">// All propagations should normally succeed.  If they don&#39;t,</span></div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;      <span class="comment">// ignore this sample for the purpose of updating the momentum.</span></div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;      <span class="keywordtype">bool</span> momentum_updated = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;      <span class="keywordflow">if</span> (dist_inf &amp;&amp; dist_range &amp;&amp; dist_noise) {</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;        <span class="comment">// Extract the momentum at the new sample point.</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;        <span class="keywordtype">double</span> invp1 = tre_noise.getVector()(4);</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;        <span class="keywordtype">double</span> var_invp1 = tre_noise.getError()(4, 4);</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;        <span class="comment">// Get the average momentum and error for this pair of</span></div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;        <span class="comment">// sample points, and other data.</span></div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;        <span class="keywordtype">double</span> invp = 0.5 * (invp0 + invp1);</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;        <span class="keywordtype">double</span> var_invp = 0.5 * (var_invp0 + var_invp1);</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">mass</a> = tre_inf.Mass();</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;        <span class="keywordtype">double</span> beta = std::sqrt(1. + mass * mass * invp * invp);</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;        <span class="keywordtype">double</span> invbp = invp / beta;</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;        <span class="comment">// Extract slope subvectors and sub-error-matrices.</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;        <span class="comment">// We have the following variables.</span></div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;        <span class="comment">// slope0 - Predicted slope vector (from infinite momentum track).</span></div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;        <span class="comment">// slope1 - Measured slope vector (from new sample point).</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;        <span class="comment">// defl - Deflection (slope residual = difference between measured</span></div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;        <span class="comment">//        and predicted slope vector).</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;        <span class="comment">// err0 - Slope error matrix of prediction.</span></div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;        <span class="comment">// err1 - Slope error matrix of measurement</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;        <span class="comment">// errc - Slope residual error matrix = err0 + err1.</span></div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        <span class="comment">// errn - Noise slope error matrix divided by (1/beta*momentum).</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        <a class="code" href="../../d0/d8f/runFilesFromSAM_8sh.html#a7aead736a07eaf25623ad7bfa1f0ee2d">KVector&lt;2&gt;::type</a> slope0 = project(tre_inf.getVector(), ublas::range(2, 4));</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;        <a class="code" href="../../d0/d8f/runFilesFromSAM_8sh.html#a7aead736a07eaf25623ad7bfa1f0ee2d">KVector&lt;2&gt;::type</a> slope1 = project(trh.getVector(), ublas::range(2, 4));</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;        <a class="code" href="../../d0/d8f/runFilesFromSAM_8sh.html#a7aead736a07eaf25623ad7bfa1f0ee2d">KVector&lt;2&gt;::type</a> defl = slope1 - slope0;</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;        <a class="code" href="../../d0/d8f/runFilesFromSAM_8sh.html#a7aead736a07eaf25623ad7bfa1f0ee2d">KSymMatrix&lt;2&gt;::type</a> err0 =</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;          project(tre_inf.getError(), ublas::range(2, 4), ublas::range(2, 4));</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;        <a class="code" href="../../d0/d8f/runFilesFromSAM_8sh.html#a7aead736a07eaf25623ad7bfa1f0ee2d">KSymMatrix&lt;2&gt;::type</a> err1 = project(trh.getError(), ublas::range(2, 4), ublas::range(2, 4));</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;        <a class="code" href="../../d0/d8f/runFilesFromSAM_8sh.html#a7aead736a07eaf25623ad7bfa1f0ee2d">KSymMatrix&lt;2&gt;::type</a> errc = err0 + err1;</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;        <a class="code" href="../../d0/d8f/runFilesFromSAM_8sh.html#a7aead736a07eaf25623ad7bfa1f0ee2d">KSymMatrix&lt;2&gt;::type</a> errn =</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;          project(tre_noise.getError(), ublas::range(2, 4), ublas::range(2, 4));</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;        errn -= err0;</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;        errn /= invbp;</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;        <span class="comment">// Calculate updated average momentum and error.</span></div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;        <span class="keywordtype">double</span> new_invp = invp;</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;        <span class="keywordtype">double</span> new_var_invp = var_invp;</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;        update_momentum(defl, errc, errn, mass, new_invp, new_var_invp);</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;        <span class="comment">// Calculate updated momentum and error at the second sample</span></div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;        <span class="comment">// point.</span></div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;        <span class="keywordtype">double</span> dp = 1. / new_invp - 1. / invp;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;        invp0 = 1. / (1. / invp1 + dp);</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;        var_invp0 = new_var_invp;</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;        momentum_updated = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;        <span class="comment">// Make sure that updated momentum is not less than minimum</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;        <span class="comment">// allowed momentum.</span></div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;        <span class="keywordtype">double</span> invp_range = trk_range.getVector()(4);</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;        <span class="keywordflow">if</span> (invp0 &gt; invp_range) invp0 = invp_range;</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;      }</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;      <span class="comment">// Update sample.</span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;      <span class="keywordflow">if</span> (momentum_updated) {</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;        s_sample = <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>;</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;        tre_inf = trh;</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;        tre_inf.getVector()(4) = 0.;</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;        tre_inf.getError()(4, 4) = 0.;</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;        <span class="keywordtype">double</span> invp_range = trk_range.getVector()(4);</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;        trk_range = trh;</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;        trk_range.getVector()(4) = invp_range;</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;        tre_noise = trh;</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;        tre_noise.getVector()(4) = invp0;</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;        tre_noise.getError()(4, 4) = var_invp0;</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;      }</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    }</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;  }</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;  <span class="comment">// Propagate noise track to starting (high momentum) track surface</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;  <span class="comment">// to get final starting momentum.  This propagation should normally</span></div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;  <span class="comment">// always succeed, but if it doesn&#39;t, don&#39;t update the track.</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;  <span class="keyword">const</span> KHitTrack&amp; trh0 = itend[0]-&gt;second;</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;  std::shared_ptr&lt;const Surface&gt; psurf = trh0.getSurface();</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;  std::optional&lt;double&gt; dist_noise = prop.noise_prop(tre_noise, psurf, <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185">Propagator::UNKNOWN</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;  result = dist_noise.has_value();</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;  <span class="comment">// Update momentum-estimating track.</span></div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;  mf::LogInfo log(<span class="stringliteral">&quot;KalmanFilterAlg&quot;</span>);</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;  <span class="keywordflow">if</span> (result) tremom = tre_noise;</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;  <span class="comment">// Done.</span></div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;}</div>
<div class="ttc" id="namespacepython_1_1larbatch__posix_html_a8975349ec6b0427eebf111f540b9cd11"><div class="ttname"><a href="../../d9/d4d/namespacepython_1_1larbatch__posix.html#a8975349ec6b0427eebf111f540b9cd11">python.larbatch_posix.stat</a></div><div class="ttdeci">def stat</div><div class="ttdef"><b>Definition:</b> <a href="../../db/db8/larbatch__posix_8py_source.html#l00482">larbatch_posix.py:482</a></div></div>
<div class="ttc" id="namespacetrkf_html_a20fcb423cfba1923040c27599fd3bf83"><div class="ttname"><a href="../../d0/da2/namespacetrkf.html#a20fcb423cfba1923040c27599fd3bf83">trkf::TrackError</a></div><div class="ttdeci">KSymMatrix&lt; 5 &gt;::type TrackError</div><div class="ttdoc">Track error matrix, dimension 5x5. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d7d/KalmanLinearAlgebra_8h_source.html#l00093">KalmanLinearAlgebra.h:93</a></div></div>
<div class="ttc" id="namespaceevd_html_a911fe581afad27a720ee200bd61362a6"><div class="ttname"><a href="../../da/d2d/namespaceevd.html#a911fe581afad27a720ee200bd61362a6">evd::err</a></div><div class="ttdeci">EResult err(const char *call)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2a/WebEVDServer_8cxx_source.html#l00138">WebEVDServer.cxx:138</a></div></div>
<div class="ttc" id="classtrkf_1_1KFitTrack_html_acbd881884cdbb8f20e56b6e2bf6cc0f5"><div class="ttname"><a href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5">trkf::KFitTrack::FitStatus</a></div><div class="ttdeci">FitStatus</div><div class="ttdoc">Fit status enum. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db4/KFitTrack_8h_source.html#l00041">KFitTrack.h:41</a></div></div>
<div class="ttc" id="sparse__vector__test_8cc_html_a39f16bf854ba527dee7eba5bbbd93f3f"><div class="ttname"><a href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a></div><div class="ttdeci">T abs(T value)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d59/sparse__vector__test_8cc_source.html#l00030">sparse_vector_test.cc:30</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185">trkf::Propagator::UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00094">Propagator.h:94</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a7c04c3bbed317634e4f46079d79c4617"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a7c04c3bbed317634e4f46079d79c4617">trkf::KalmanFilterAlg::fMinSampleDist</a></div><div class="ttdeci">double fMinSampleDist</div><div class="ttdoc">Minimum sample distance (for momentum measurement). </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00165">KalmanFilterAlg.h:165</a></div></div>
<div class="ttc" id="runFilesFromSAM_8sh_html_a7aead736a07eaf25623ad7bfa1f0ee2d"><div class="ttname"><a href="../../d0/d8f/runFilesFromSAM_8sh.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a></div><div class="ttdeci">type</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8f/runFilesFromSAM_8sh_source.html#l00253">runFilesFromSAM.sh:253</a></div></div>
<div class="ttc" id="file__to__url_8sh_html_a096ad3d3698082826189c839d7a6e46f"><div class="ttname"><a href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a></div><div class="ttdeci">then echo File list $list not found else cat $list while read file do echo $file sed s</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dea/file__to__url_8sh_source.html#l00060">file_to_url.sh:60</a></div></div>
<div class="ttc" id="namespacelib_1_1dedx_html_af9508f78ba8143119daa95dbd8220f91"><div class="ttname"><a href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">lib.dedx.mass</a></div><div class="ttdeci">float mass</div><div class="ttdef"><b>Definition:</b> <a href="../../df/df9/dedx_8py_source.html#l00047">dedx.py:47</a></div></div>
<div class="ttc" id="classtrkf_1_1KFitTrack_html_acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1"><div class="ttname"><a href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1">trkf::KFitTrack::OPTIMAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db4/KFitTrack_8h_source.html#l00048">KFitTrack.h:48</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6aaeba5b204bf8af5c8e52043df09cbc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::KalmanFilterAlg::fitMomentumRange </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> &amp;&#160;</td>
          <td class="paramname"><em>trg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../df/db0/classtrkf_1_1KETrack.html">KETrack</a> &amp;&#160;</td>
          <td class="paramname"><em>tremom</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Estimate track momentum using range. </p>
<p>Estimate track momentum using range.</p>
<p>Arguments:</p>
<p>trg - Global track. prop - <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a>. tremom - <a class="el" href="../../d4/d66/structTrack.html">Track</a> with momentum estimate.</p>
<p>Returns: True if success.</p>
<p>This method generates a momentum-estimating track by extracting the last track from a global track, and setting its momentum to some small value. </p>

<p>Definition at line <a class="el" href="../../d2/dab/KalmanFilterAlg_8cxx_source.html#l01611">1611</a> of file <a class="el" href="../../d2/dab/KalmanFilterAlg_8cxx_source.html">KalmanFilterAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;{</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;  <span class="keywordflow">if</span> (!trg.isValid()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;  <span class="comment">// Extract track with lowest momentum.</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;  <span class="keyword">const</span> KHitTrack&amp; trh = trg.endTrack();</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;  <span class="keywordflow">if</span> (trh.getStat() == <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5aad0c29b5616b8b47d8d3317f1696201b">KFitTrack::INVALID</a>)</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;    <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;KalmanFilterAlg&quot;</span>)</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;KalmanFilterAlg::fitMomentumRange(): invalid end track\n&quot;</span>;</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;  tremom = trh;</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;  <span class="comment">// Set track momentum to a small value.</span></div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;  tremom.getVector()(4) = 100.;</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;  tremom.getError()(4, 0) = 0.;</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;  tremom.getError()(4, 1) = 0.;</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;  tremom.getError()(4, 2) = 0.;</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;  tremom.getError()(4, 3) = 0.;</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;  tremom.getError()(4, 4) = 10000.;</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;  <span class="comment">// Done.</span></div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;}</div>
<div class="ttc" id="classtrkf_1_1KFitTrack_html_acbd881884cdbb8f20e56b6e2bf6cc0f5aad0c29b5616b8b47d8d3317f1696201b"><div class="ttname"><a href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5aad0c29b5616b8b47d8d3317f1696201b">trkf::KFitTrack::INVALID</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db4/KFitTrack_8h_source.html#l00042">KFitTrack.h:42</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac3c277f05df0f31630f248fbf59c3494"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int trkf::KalmanFilterAlg::getPlane </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Preferred view plane. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00080">80</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a504f5ddae4c107e296f085b8d8792d7b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::KalmanFilterAlg::getTrace </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Trace config parameters. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00075">75</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a659e75ed385886b11601361421b7a3a9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void trkf::KalmanFilterAlg::setPlane </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>plane</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set preferred view plane. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00093">93</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a05d9ee3aac6fecd86ddc9da64ee83785"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void trkf::KalmanFilterAlg::setTrace </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>trace</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set trace config parameter. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00088">88</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="ae241a8a34643e37524cdec9b8fd2f7b5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::KalmanFilterAlg::smoothTrack </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> &amp;&#160;</td>
          <td class="paramname"><em>trg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> *&#160;</td>
          <td class="paramname"><em>trg1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a> &amp;&#160;</td>
          <td class="paramname"><em>prop</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Smooth track. </p>
<p>Smooth track.</p>
<p>Arguments:</p>
<p>trg - <a class="el" href="../../d4/d66/structTrack.html">Track</a> to be smoothed. trg1 - <a class="el" href="../../d4/d66/structTrack.html">Track</a> to receive result of unidirectional fit. prop - <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a>.</p>
<p>Returns: True if success.</p>
<p>The starting track should be a global track that has been fit in one direction. Fit status should be optimal at (at least) one end. It is an error if the fit status is not optimal at either end. If the fit status is optimal at both ends, do nothing, but return success.</p>
<p>If the second argument is non-null, save the result of the unidirectional track fit produced as a byproduct of the smoothing operation. This track can be smoothed in order to iterate the Kalman fit, etc.</p>
<p>The Kalman smoothing algorithm starts at the optimal end and fits the track in the reverse direction, calculating optimal track parameters at each measurement surface.</p>
<p>All measurements are included in the reverse fit. No incremental chisquare cut is applied.</p>
<p>If any measurement surface can not be reached because of a measurement error, the entire smoothing operation is considered a failure. In that case, false is returned and the track is left in an undefined state. </p>

<p>Definition at line <a class="el" href="../../d2/dab/KalmanFilterAlg_8cxx_source.html#l00850">850</a> of file <a class="el" href="../../d2/dab/KalmanFilterAlg_8cxx_source.html">KalmanFilterAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;{</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  <span class="keywordflow">if</span> (not trg.isValid()) {</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <span class="comment">// It is an error if the KGTrack is not valid.</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  }</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="comment">// Examine the track endpoints and figure out which end of the track</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="comment">// to start from.  The fit always starts at the optimal end.  It is</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <span class="comment">// an error if neither end point is optimal.  Do nothing and return</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <span class="comment">// success if both end points are optimal.</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  <span class="keyword">const</span> KHitTrack&amp; trh0 = trg.startTrack();</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  <span class="keyword">const</span> KHitTrack&amp; trh1 = trg.endTrack();</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5">KFitTrack::FitStatus</a> stat0 = trh0.getStat();</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5">KFitTrack::FitStatus</a> stat1 = trh1.getStat();</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="keywordtype">bool</span> dofit = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  <span class="comment">// Remember starting direction, track, and distance.</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354">Propagator::PropDirection</a> <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> = <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185">Propagator::UNKNOWN</a>;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  <span class="keyword">const</span> KTrack* trk = 0;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <span class="keywordtype">double</span> path = 0.;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="keywordflow">if</span> (stat0 == <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1">KFitTrack::OPTIMAL</a>) {</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <span class="keywordflow">if</span> (stat1 == <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1">KFitTrack::OPTIMAL</a>) {</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;      <span class="comment">// Both ends optimal (do nothing, return success).</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;      dofit = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      result = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    }</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      <span class="comment">// Start optimal.</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      dofit = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      dir = <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">Propagator::FORWARD</a>;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      trk = &amp;trh0;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      path = 0.;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    }</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  }</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="keywordflow">if</span> (stat1 == <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1">KFitTrack::OPTIMAL</a>) {</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      <span class="comment">// End optimal.</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      dofit = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      dir = <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354abb50b9e012a19f7643321f6aa64ecb19">Propagator::BACKWARD</a>;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      trk = &amp;trh1;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      path = trh1.getPath();</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    }</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      <span class="comment">// Neither end optimal (do nothing, return failure).</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      dofit = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      result = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    }</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  }</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="keywordflow">if</span> (dofit) {</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <span class="keywordflow">if</span> (!trk)</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;KalmanFilterAlg&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;KalmanFilterAlg::smoothTrack(): no track!\n&quot;</span>;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="comment">// Cumulative chisquare.</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    <span class="keywordtype">double</span> tchisq = 0.;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <span class="comment">// Construct starting KFitTrack with track information and distance</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <span class="comment">// taken from the optimal end, but with &quot;infinite&quot; errors.</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <a class="code" href="../../d0/da2/namespacetrkf.html#a20fcb423cfba1923040c27599fd3bf83">TrackError</a> <a class="code" href="../../da/d2d/namespaceevd.html#a911fe581afad27a720ee200bd61362a6">err</a>;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    trk-&gt;getSurface()-&gt;getStartingError(err);</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    KETrack tre(*trk, err);</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    KFitTrack trf(tre, path, tchisq);</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="comment">// Make initial reference track to be same as initial fit track.</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    KTrack ref(trf);</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="comment">// Loop over KHitTracks contained in KGTrack.</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    std::multimap&lt;double, KHitTrack&gt;::iterator it;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    std::multimap&lt;double, KHitTrack&gt;::iterator itend;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="keywordflow">switch</span> (dir) {</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">Propagator::FORWARD</a>:</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;      it = trg.getTrackMap().begin();</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      itend = trg.getTrackMap().end();</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354abb50b9e012a19f7643321f6aa64ecb19">Propagator::BACKWARD</a>:</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;      it = trg.getTrackMap().end();</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      itend = trg.getTrackMap().begin();</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;KalmanFilterAlg&quot;</span>)</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;KalmanFilterAlg::smoothTrack(): invalid direction\n&quot;</span>;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    } <span class="comment">// switch</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    mf::LogInfo log(<span class="stringliteral">&quot;KalmanFilterAlg&quot;</span>);</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="comment">// Loop starts here.</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    result = <span class="keyword">true</span>; <span class="comment">// Result success unless we find an error.</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="keywordtype">int</span> step = 0;  <span class="comment">// Step count.</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <span class="keywordflow">while</span> (dofit &amp;&amp; it != itend) {</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;      ++step;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>) {</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        log &lt;&lt; <span class="stringliteral">&quot;Smooth Step &quot;</span> &lt;&lt; step &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        log &lt;&lt; <span class="stringliteral">&quot;Reverse fit track:\n&quot;</span>;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        log &lt;&lt; trf;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;      }</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      <span class="comment">// For backward fit, decrement iterator at start of loop.</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;      <span class="keywordflow">if</span> (dir == <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354abb50b9e012a19f7643321f6aa64ecb19">Propagator::BACKWARD</a>) --it;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      KHitTrack&amp; trh = (*it).second;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>) {</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        log &lt;&lt; <span class="stringliteral">&quot;Forward track:\n&quot;</span>;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        log &lt;&lt; trh;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;      }</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      <span class="comment">// Extract measurement.</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      <span class="keyword">const</span> KHitBase&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = *(trh.getHit());</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      <span class="comment">// Propagate KFitTrack to the next track surface.</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      std::shared_ptr&lt;const Surface&gt; psurf = trh.getSurface();</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      std::optional&lt;double&gt; <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a> = prop.noise_prop(trf, psurf, <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185">Propagator::UNKNOWN</a>, <span class="keyword">true</span>, &amp;ref);</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      <span class="comment">// Check if propagation succeeded.  If propagation fails, this</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      <span class="comment">// measurement will be dropped from the unidirectional fit</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      <span class="comment">// track.  This measurement will still be in the original</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;      <span class="comment">// track, but with a status other than optimal.</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;      <span class="keywordflow">if</span> (dist) {</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        <span class="comment">// Propagation succeeded.</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        <span class="comment">// Update cumulative path distance and track status.</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../d9/d69/namespacelariov_1_1DataSource.html#a9877bcd384b60abd8cbe121d11f43b5b">ds</a> = *<a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        path += <a class="code" href="../../d9/d69/namespacelariov_1_1DataSource.html#a9877bcd384b60abd8cbe121d11f43b5b">ds</a>;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        trf.setPath(path);</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <span class="keywordflow">if</span> (dir == <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">Propagator::FORWARD</a>)</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;          trf.setStat(<a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a6f3336fe810af67d6ce9069176fb6af7">KFitTrack::FORWARD_PREDICTED</a>);</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;          trf.setStat(<a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5aecd7b60b3e363d4bb97e476bff2ade03">KFitTrack::BACKWARD_PREDICTED</a>);</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        }</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>) {</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;          log &lt;&lt; <span class="stringliteral">&quot;Reverse fit track after propagation:\n&quot;</span>;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;          log &lt;&lt; <span class="stringliteral">&quot;  Propagation distance = &quot;</span> &lt;&lt; ds &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;          log &lt;&lt; trf;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        }</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        <span class="comment">// See if we have the proper information to calculate an optimal track</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        <span class="comment">// at this surface (should normally be possible).</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5">KFitTrack::FitStatus</a> <a class="code" href="../../d9/d4d/namespacepython_1_1larbatch__posix.html#a8975349ec6b0427eebf111f540b9cd11">stat</a> = trh.getStat();</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5">KFitTrack::FitStatus</a> newstat = trf.getStat();</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <span class="keywordflow">if</span> ((newstat == <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a6f3336fe810af67d6ce9069176fb6af7">KFitTrack::FORWARD_PREDICTED</a> &amp;&amp; stat == <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5ad673adc72cebdfb1864653ad774eec1c">KFitTrack::BACKWARD</a>) ||</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;            (newstat == <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5aecd7b60b3e363d4bb97e476bff2ade03">KFitTrack::BACKWARD_PREDICTED</a> &amp;&amp; stat == <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5ad3811944785e6ac5a7496a98d167110d">KFitTrack::FORWARD</a>)) {</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;          <span class="comment">// Update stored KHitTrack to be optimal.</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;          <span class="keywordtype">bool</span> ok = trh.combineFit(trf);</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;          <span class="comment">// Update the stored path distance to be from the currently fitting track.</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;          trh.setPath(trf.getPath());</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;          <span class="comment">// Update reference track.</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;          ref = trh;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;          <span class="comment">// If combination failed, abandon the fit and return failure.</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;          <span class="keywordflow">if</span> (!ok) {</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;            dofit = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;            result = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;          }</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>) {</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;            log &lt;&lt; <span class="stringliteral">&quot;Combined track:\n&quot;</span>;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;            log &lt;&lt; trh;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;          }</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        }</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;        <span class="comment">// Update measurement predction using current track hypothesis.</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        <span class="keywordflow">if</span> (not hit.predict(trf, prop, &amp;ref)) {</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;          <span class="comment">// Abandon the fit and return failure.</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;          dofit = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;          result = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        }</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        <span class="comment">// Prediction succeeded.  Get incremental chisquare.  If this</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        <span class="comment">// hit fails incremental chisquare cut, this hit will be</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        <span class="comment">// dropped from the unidirecitonal Kalman fit track, but may</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        <span class="comment">// still be in the smoothed track.</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        <span class="keywordtype">double</span> chisq = hit.getChisq();</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        <span class="keywordflow">if</span> (chisq &lt; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a31d494ce1fe055c04e21df6864027279">fMaxSmoothIncChisq</a>) {</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;          <span class="comment">// Update the reverse fitting track using the current measurement</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;          <span class="comment">// (both track parameters and status).</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;          KFitTrack trf0(trf);</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;          hit.update(trf);</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;          <span class="keywordtype">bool</span> update_ok = trf.isValid();</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;          <span class="keywordflow">if</span> (!update_ok)</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;            trf = trf0;</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;          <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;            tchisq += chisq;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;            trf.setChisq(tchisq);</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;            <span class="keywordflow">if</span> (dir == <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">Propagator::FORWARD</a>)</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;              trf.setStat(<a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5ad3811944785e6ac5a7496a98d167110d">KFitTrack::FORWARD</a>);</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;            <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;              trf.setStat(<a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5ad673adc72cebdfb1864653ad774eec1c">KFitTrack::BACKWARD</a>);</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;            }</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">fTrace</a>) {</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;              log &lt;&lt; <span class="stringliteral">&quot;Reverse fit track after update:\n&quot;</span>;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;              log &lt;&lt; trf;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;            }</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">fGTrace</a> &amp;&amp; <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.size() &gt; 0) {</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;              <span class="keyword">auto</span> marker_it = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.find(hit.getID());</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;              <span class="keywordflow">if</span> (marker_it != <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">fMarkerMap</a>.end()) {</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;                TMarker* marker = marker_it-&gt;second;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;                marker-&gt;SetMarkerColor(kOrange);</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;              }</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;              <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">fCanvases</a>.back()-&gt;Update();</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;            }</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;            <span class="comment">// If unidirectional track pointer is not null, make a</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;            <span class="comment">// KHitTrack and save it in the unidirectional track.</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            <span class="keywordflow">if</span> (trg1 != 0) {</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;              KHitTrack trh1(trf, trh.getHit());</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;              trg1-&gt;addTrack(trh1);</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;            }</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;          }</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;        }</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;      }</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      <span class="comment">// For forward fit, increment iterator at end of loop.</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      <span class="keywordflow">if</span> (dir == <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">Propagator::FORWARD</a>) ++it;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    } <span class="comment">// Loop over KHitTracks.</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <span class="comment">// If fit was successful and the unidirectional track pointer</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="comment">// is not null and the track is valid, set the fit status of</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    <span class="comment">// the last added KHitTrack to optimal.</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    <span class="keywordflow">if</span> (result &amp;&amp; trg1 != 0 &amp;&amp; trg1-&gt;isValid()) {</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      <span class="keywordflow">if</span> (dir == <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">Propagator::FORWARD</a>)</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        trg1-&gt;endTrack().setStat(<a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1">KFitTrack::OPTIMAL</a>);</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;        trg1-&gt;startTrack().setStat(<a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1">KFitTrack::OPTIMAL</a>);</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      }</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    }</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <span class="comment">// Recalibrate track map.</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    trg.recalibrate();</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;  } <span class="comment">// Do fit.</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  <span class="comment">// Get the final chisquare.</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  <span class="keywordtype">double</span> fchisq = 0.5 * (trg.startTrack().getChisq() + trg.endTrack().getChisq());</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;  <span class="comment">// Summary.</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;  mf::LogInfo log(<span class="stringliteral">&quot;KalmanFilterAlg&quot;</span>);</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  log &lt;&lt; <span class="stringliteral">&quot;KalmanFilterAlg smooth track summary.\n&quot;</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Smooth direction = &quot;</span> &lt;&lt; (dir == <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">Propagator::FORWARD</a> ? <span class="stringliteral">&quot;FORWARD&quot;</span> : <span class="stringliteral">&quot;BACKWARD&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Track has &quot;</span> &lt;&lt; trg.numHits() &lt;&lt; <span class="stringliteral">&quot; hits.\n&quot;</span></div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Track length = &quot;</span> &lt;&lt; trg.endTrack().getPath() - trg.startTrack().getPath() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Track chisquare = &quot;</span> &lt;&lt; fchisq &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;}</div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a98537b1f46ca2024dec2b9504c4fccc3"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a98537b1f46ca2024dec2b9504c4fccc3">trkf::KalmanFilterAlg::fGTrace</a></div><div class="ttdeci">bool fGTrace</div><div class="ttdoc">Graphical trace flag. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00168">KalmanFilterAlg.h:168</a></div></div>
<div class="ttc" id="namespacelariov_1_1DataSource_html_a9877bcd384b60abd8cbe121d11f43b5b"><div class="ttname"><a href="../../d9/d69/namespacelariov_1_1DataSource.html#a9877bcd384b60abd8cbe121d11f43b5b">lariov::DataSource::ds</a></div><div class="ttdeci">ds</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dca/IOVDataConstants_8h_source.html#l00015">IOVDataConstants.h:15</a></div></div>
<div class="ttc" id="namespacepython_1_1larbatch__posix_html_a8975349ec6b0427eebf111f540b9cd11"><div class="ttname"><a href="../../d9/d4d/namespacepython_1_1larbatch__posix.html#a8975349ec6b0427eebf111f540b9cd11">python.larbatch_posix.stat</a></div><div class="ttdeci">def stat</div><div class="ttdef"><b>Definition:</b> <a href="../../db/db8/larbatch__posix_8py_source.html#l00482">larbatch_posix.py:482</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a96c1397d785be158129c8d36ea6987a6"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a96c1397d785be158129c8d36ea6987a6">trkf::KalmanFilterAlg::fMarkerMap</a></div><div class="ttdeci">std::map&lt; int, TMarker * &gt; fMarkerMap</div><div class="ttdoc">Markers in current canvas. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00183">KalmanFilterAlg.h:183</a></div></div>
<div class="ttc" id="namespacetrkf_html_a20fcb423cfba1923040c27599fd3bf83"><div class="ttname"><a href="../../d0/da2/namespacetrkf.html#a20fcb423cfba1923040c27599fd3bf83">trkf::TrackError</a></div><div class="ttdeci">KSymMatrix&lt; 5 &gt;::type TrackError</div><div class="ttdoc">Track error matrix, dimension 5x5. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d7d/KalmanLinearAlgebra_8h_source.html#l00093">KalmanLinearAlgebra.h:93</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a1e70c929d23cb24aae387474026a2ffa"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a1e70c929d23cb24aae387474026a2ffa">trkf::KalmanFilterAlg::fTrace</a></div><div class="ttdeci">bool fTrace</div><div class="ttdoc">Trace flag. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00148">KalmanFilterAlg.h:148</a></div></div>
<div class="ttc" id="namespaceevd_html_a911fe581afad27a720ee200bd61362a6"><div class="ttname"><a href="../../da/d2d/namespaceevd.html#a911fe581afad27a720ee200bd61362a6">evd::err</a></div><div class="ttdeci">EResult err(const char *call)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2a/WebEVDServer_8cxx_source.html#l00138">WebEVDServer.cxx:138</a></div></div>
<div class="ttc" id="classtrkf_1_1KFitTrack_html_acbd881884cdbb8f20e56b6e2bf6cc0f5a6f3336fe810af67d6ce9069176fb6af7"><div class="ttname"><a href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a6f3336fe810af67d6ce9069176fb6af7">trkf::KFitTrack::FORWARD_PREDICTED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db4/KFitTrack_8h_source.html#l00045">KFitTrack.h:45</a></div></div>
<div class="ttc" id="classtrkf_1_1KFitTrack_html_acbd881884cdbb8f20e56b6e2bf6cc0f5ad673adc72cebdfb1864653ad774eec1c"><div class="ttname"><a href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5ad673adc72cebdfb1864653ad774eec1c">trkf::KFitTrack::BACKWARD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db4/KFitTrack_8h_source.html#l00046">KFitTrack.h:46</a></div></div>
<div class="ttc" id="classtrkf_1_1KFitTrack_html_acbd881884cdbb8f20e56b6e2bf6cc0f5"><div class="ttname"><a href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5">trkf::KFitTrack::FitStatus</a></div><div class="ttdeci">FitStatus</div><div class="ttdoc">Fit status enum. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db4/KFitTrack_8h_source.html#l00041">KFitTrack.h:41</a></div></div>
<div class="ttc" id="cheaterreco_8fcl_html_abf2e819dbf4c327e098bebd4b2dc0597"><div class="ttname"><a href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a></div><div class="ttdeci">process_name hit</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d36/cheaterreco_8fcl_source.html#l00051">cheaterreco.fcl:51</a></div></div>
<div class="ttc" id="classtrkf_1_1KFitTrack_html_acbd881884cdbb8f20e56b6e2bf6cc0f5aecd7b60b3e363d4bb97e476bff2ade03"><div class="ttname"><a href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5aecd7b60b3e363d4bb97e476bff2ade03">trkf::KFitTrack::BACKWARD_PREDICTED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db4/KFitTrack_8h_source.html#l00047">KFitTrack.h:47</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_af689f4b8a505b7a64dcd9c7e6c824354abb50b9e012a19f7643321f6aa64ecb19"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354abb50b9e012a19f7643321f6aa64ecb19">trkf::Propagator::BACKWARD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00094">Propagator.h:94</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185">trkf::Propagator::UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00094">Propagator.h:94</a></div></div>
<div class="ttc" id="classtrkf_1_1KFitTrack_html_acbd881884cdbb8f20e56b6e2bf6cc0f5ad3811944785e6ac5a7496a98d167110d"><div class="ttname"><a href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5ad3811944785e6ac5a7496a98d167110d">trkf::KFitTrack::FORWARD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db4/KFitTrack_8h_source.html#l00044">KFitTrack.h:44</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_ae784305d3e992d3650c1aab19487c7b0"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae784305d3e992d3650c1aab19487c7b0">trkf::KalmanFilterAlg::fCanvases</a></div><div class="ttdeci">std::vector&lt; std::unique_ptr&lt; TCanvas &gt; &gt; fCanvases</div><div class="ttdoc">Graphical trace canvases. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00179">KalmanFilterAlg.h:179</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a75a7893a288d2eadaba054cc056b2fed">trkf::Propagator::FORWARD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00094">Propagator.h:94</a></div></div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_a31d494ce1fe055c04e21df6864027279"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#a31d494ce1fe055c04e21df6864027279">trkf::KalmanFilterAlg::fMaxSmoothIncChisq</a></div><div class="ttdeci">double fMaxSmoothIncChisq</div><div class="ttdoc">Maximum incremental chisquare to accept a hit in smooth phase. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/KalmanFilterAlg_8h_source.html#l00153">KalmanFilterAlg.h:153</a></div></div>
<div class="ttc" id="namespacedropbox_html_a407b5b895ba9265893768748aaa73825"><div class="ttname"><a href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dropbox.dir</a></div><div class="ttdeci">tuple dir</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d81/dropbox_8py_source.html#l00028">dropbox.py:28</a></div></div>
<div class="ttc" id="namespacelarg4_html_a3b23adbb58bc71f7c54806914226f1f8"><div class="ttname"><a href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">larg4::dist</a></div><div class="ttdeci">constexpr double dist(const TReal *x, const TReal *y, const unsigned int dimension)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d8a/OpFastScintillation_8hh_source.html#l00563">OpFastScintillation.hh:563</a></div></div>
<div class="ttc" id="classtrkf_1_1KFitTrack_html_acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1"><div class="ttname"><a href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5a8f6b21a4dff9327cbb79f1a2f2f084f1">trkf::KFitTrack::OPTIMAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db4/KFitTrack_8h_source.html#l00048">KFitTrack.h:48</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_af689f4b8a505b7a64dcd9c7e6c824354"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354">trkf::Propagator::PropDirection</a></div><div class="ttdeci">PropDirection</div><div class="ttdoc">Propagation direction enum. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00094">Propagator.h:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae505c5bbe7b919d15f3af3e32fd7ad68"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::KalmanFilterAlg::smoothTrackIter </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nsmooth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> &amp;&#160;</td>
          <td class="paramname"><em>trg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a> &amp;&#160;</td>
          <td class="paramname"><em>prop</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Iteratively smooth a track. </p>
<p>Iteratively smooth a track.</p>
<p>Arguments:</p>
<p>nsmooth - Number of iterations. trg - <a class="el" href="../../d4/d66/structTrack.html">Track</a> to be smoothed. prop - <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a>.</p>
<p>Returns: True if success.</p>
<p>The initial track should have been unidirectionally fit. </p>

<p>Definition at line <a class="el" href="../../d2/dab/KalmanFilterAlg_8cxx_source.html#l02078">2078</a> of file <a class="el" href="../../d2/dab/KalmanFilterAlg_8cxx_source.html">KalmanFilterAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;{</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;  <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;  <span class="comment">// Call smoothTrack method in a loop.</span></div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ismooth = 0; ok &amp;&amp; ismooth &lt; nsmooth - 1; ++ismooth) {</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    KGTrack trg1{trg.getPrefPlane()};</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;    ok = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae241a8a34643e37524cdec9b8fd2f7b5">smoothTrack</a>(trg, &amp;trg1, prop);</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;    <span class="keywordflow">if</span> (ok) trg = trg1;</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;  }</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;  <span class="comment">// Do one final smooth without generating a new unidirectional</span></div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;  <span class="comment">// track.</span></div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;  <span class="keywordflow">if</span> (ok) ok = <a class="code" href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae241a8a34643e37524cdec9b8fd2f7b5">smoothTrack</a>(trg, 0, prop);</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;  <span class="comment">// Done.</span></div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;  <span class="keywordflow">return</span> ok;</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;}</div>
<div class="ttc" id="classtrkf_1_1KalmanFilterAlg_html_ae241a8a34643e37524cdec9b8fd2f7b5"><div class="ttname"><a href="../../d7/dd7/classtrkf_1_1KalmanFilterAlg.html#ae241a8a34643e37524cdec9b8fd2f7b5">trkf::KalmanFilterAlg::smoothTrack</a></div><div class="ttdeci">bool smoothTrack(KGTrack &amp;trg, KGTrack *trg1, const Propagator &amp;prop) const </div><div class="ttdoc">Smooth track. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dab/KalmanFilterAlg_8cxx_source.html#l00850">KalmanFilterAlg.cxx:850</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2a5a5f4ed347ca0dad0faefae9adec93"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::KalmanFilterAlg::updateMomentum </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../df/db0/classtrkf_1_1KETrack.html">KETrack</a> &amp;&#160;</td>
          <td class="paramname"><em>tremom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a> &amp;&#160;</td>
          <td class="paramname"><em>prop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d5c/classtrkf_1_1KGTrack.html">KGTrack</a> &amp;&#160;</td>
          <td class="paramname"><em>trg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set track momentum at each track surface. </p>
<p>Set track momentum at each track surface.</p>
<p>Arguments:</p>
<p>tremom - <a class="el" href="../../d4/d66/structTrack.html">Track</a> containing momentum estimate. prop - <a class="el" href="../../d3/d02/classtrkf_1_1Propagator.html">Propagator</a>. trg - Global track to be updated.</p>
<p>The track containing the momentum estimate is propagated to the first or last track fit of the global track (whichever is closer), then the momentum estimate is transfered to that track fit. In similar fashion, the momentum estimate is successively transfered from that track fit to each track fit of the global track.</p>
<p>Only momentum track parameters of the global track fits are updated. Other track parameters and their errors are unmodified. Unreachable track fits are deleted from the global track. Overall failure will occur if the momentum-estimating track can't be propagated to the initial track fit, or if the final global track has no valid track fits. </p>

<p>Definition at line <a class="el" href="../../d2/dab/KalmanFilterAlg_8cxx_source.html#l01942">1942</a> of file <a class="el" href="../../d2/dab/KalmanFilterAlg_8cxx_source.html">KalmanFilterAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;{</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;  <span class="comment">// Get modifiable track map.</span></div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;  std::multimap&lt;double, KHitTrack&gt;&amp; trackmap = trg.getTrackMap();</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;  <span class="comment">// If track map is empty, immediately return failure.</span></div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;  <span class="keywordflow">if</span> (trackmap.size() == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;  <span class="comment">// Make trial propagations to the first and last track fit to figure</span></div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;  <span class="comment">// out which track fit is closer to the momentum estimating track.</span></div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;  <span class="comment">// Find distance to first track fit.</span></div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;  KETrack tre0(tremom);</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;  std::optional&lt;double&gt; dist0 =</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;    prop.vec_prop(tre0, trackmap.begin()-&gt;second.getSurface(), <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185">Propagator::UNKNOWN</a>, <span class="keyword">false</span>, 0, 0);</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;  <span class="comment">// Find distance to last track fit.</span></div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;  KETrack tre1(tremom);</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;  std::optional&lt;double&gt; dist1 =</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;    prop.vec_prop(tre1, trackmap.rbegin()-&gt;second.getSurface(), <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185">Propagator::UNKNOWN</a>, <span class="keyword">false</span>, 0, 0);</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;  <span class="comment">// Based on distances, make starting iterator and direction flag.</span></div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;  <span class="keywordtype">bool</span> forward = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;  std::multimap&lt;double, KHitTrack&gt;::iterator it = trackmap.begin();</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;  <span class="keywordflow">if</span> (dist0) {</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;    <span class="comment">// Propagation to first track succeeded.</span></div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;    <span class="keywordflow">if</span> (dist1) {</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;      <span class="comment">// Propagation to both ends succeeded.  If the last track is</span></div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;      <span class="comment">// closer, initialize iterator and direction flag for reverse</span></div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;      <span class="comment">// direction.</span></div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(*dist0) &gt; <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(*dist1)) {</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;        it = trackmap.end();</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;        --it;</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;        forward = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;      }</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    }</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;  }</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;    <span class="comment">// Propagation to first track failed.  Initialize iterator and</span></div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;    <span class="comment">// direction flag for reverse direction, provided that the</span></div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;    <span class="comment">// propagation to the last track succeeded.</span></div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    <span class="keywordflow">if</span> (dist1) {</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;      it = trackmap.end();</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;      --it;</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;      forward = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;    }</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;      <span class="comment">// Propagation to both ends failed.  Return failure.</span></div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;    }</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;  }</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;  <span class="comment">// Loop over track fits in global track.</span></div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;  KETrack tre(tremom);</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;  <span class="keywordtype">bool</span> done = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;  <span class="keywordflow">while</span> (!done) {</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;    KHitTrack&amp; trh = it-&gt;second;</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;    <span class="keywordflow">if</span> (trh.getStat() == <a class="code" href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5aad0c29b5616b8b47d8d3317f1696201b">KFitTrack::INVALID</a>)</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;KalmanFilterAlg&quot;</span>)</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;KalmanFilterAlg::updateMomentum(): invalid track\n&quot;</span>;</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;    <span class="comment">// Propagate momentum-estimating track to current track surface</span></div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;    <span class="comment">// and update momentum.</span></div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;    std::optional&lt;double&gt; <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a> = prop.noise_prop(tre, trh.getSurface(), <a class="code" href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185">Propagator::UNKNOWN</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    <span class="comment">// Copy momentum to global track.</span></div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;    std::multimap&lt;double, KHitTrack&gt;::iterator erase_it = trackmap.end();</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;    <span class="keywordflow">if</span> (dist) {</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;      trh.getVector()(4) = tre.getVector()(4);</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;      trh.getError()(4, 0) = 0.;</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;      trh.getError()(4, 1) = 0.;</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;      trh.getError()(4, 2) = 0.;</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;      trh.getError()(4, 3) = 0.;</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;      trh.getError()(4, 4) = tre.getError()(4, 4);</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;    }</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;      <span class="comment">// If the propagation failed, remember that we are supposed to</span></div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;      <span class="comment">// erase this track from the global track.</span></div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;      erase_it = it;</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    }</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;    <span class="comment">// Advance the iterator and set the done flag.</span></div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    <span class="keywordflow">if</span> (forward) {</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;      ++it;</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;      done = (it == trackmap.end());</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    }</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;      done = (it == trackmap.begin());</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;      <span class="keywordflow">if</span> (!done) --it;</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;    }</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;    <span class="comment">// Update momentum-estimating track from just-updated global track</span></div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;    <span class="comment">// fit, or erase global track fit.</span></div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;    <span class="keywordflow">if</span> (erase_it == trackmap.end())</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;      tre = trh;</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;      trackmap.erase(erase_it);</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;  }</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;  <span class="keywordflow">return</span> not <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#a74da18d4f0023feee71c1352a99b3910">empty</a>(trackmap);</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;}</div>
<div class="ttc" id="classtrkf_1_1KFitTrack_html_acbd881884cdbb8f20e56b6e2bf6cc0f5aad0c29b5616b8b47d8d3317f1696201b"><div class="ttname"><a href="../../d2/df5/classtrkf_1_1KFitTrack.html#acbd881884cdbb8f20e56b6e2bf6cc0f5aad0c29b5616b8b47d8d3317f1696201b">trkf::KFitTrack::INVALID</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db4/KFitTrack_8h_source.html#l00042">KFitTrack.h:42</a></div></div>
<div class="ttc" id="sparse__vector__test_8cc_html_a39f16bf854ba527dee7eba5bbbd93f3f"><div class="ttname"><a href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a></div><div class="ttdeci">T abs(T value)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d59/sparse__vector__test_8cc_source.html#l00030">sparse_vector_test.cc:30</a></div></div>
<div class="ttc" id="classtrkf_1_1Propagator_html_af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185"><div class="ttname"><a href="../../d3/d02/classtrkf_1_1Propagator.html#af689f4b8a505b7a64dcd9c7e6c824354a82b0a2a02cd741e3651edcfe4294b185">trkf::Propagator::UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df9/Propagator_8h_source.html#l00094">Propagator.h:94</a></div></div>
<div class="ttc" id="namespacelarg4_html_a3b23adbb58bc71f7c54806914226f1f8"><div class="ttname"><a href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">larg4::dist</a></div><div class="ttdeci">constexpr double dist(const TReal *x, const TReal *y, const unsigned int dimension)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d8a/OpFastScintillation_8hh_source.html#l00563">OpFastScintillation.hh:563</a></div></div>
<div class="ttc" id="namespaceicarus_1_1ns_1_1util_html_a74da18d4f0023feee71c1352a99b3910"><div class="ttname"><a href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#a74da18d4f0023feee71c1352a99b3910">icarus::ns::util::empty</a></div><div class="ttdeci">bool empty(FixedBins&lt; T, C &gt; const &amp;) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dbd/FixedBins_8h_source.html#l00555">FixedBins.h:555</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="ae784305d3e992d3650c1aab19487c7b0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;std::unique_ptr&lt;TCanvas&gt; &gt; trkf::KalmanFilterAlg::fCanvases</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Graphical trace canvases. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00179">179</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="ae8264f4b6fe22a1d500b8bfaa353f29f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::KalmanFilterAlg::fFitMomMS</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Fit momentum using multiple scattering. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00167">167</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a9956be6404dc3569538feae4d1a0100d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::KalmanFilterAlg::fFitMomRange</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Fit momentum using range. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00166">166</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="abf1964ef45b2fe837428a8719eddbe2e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double trkf::KalmanFilterAlg::fGapDist</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Minimum gap distance. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00163">163</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab02403fa9fdf6f09573ce7d90feadad9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double trkf::KalmanFilterAlg::fGoodPErr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Pointing error threshold for switching to free propagation. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00150">150</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a98537b1f46ca2024dec2b9504c4fccc3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::KalmanFilterAlg::fGTrace</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Graphical trace flag. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00168">168</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a6bb8099e4dad21564e1d9a78ec54f3b3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double trkf::KalmanFilterAlg::fGTraceWH</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Window height. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00170">170</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a5ebc4c4ebd9dc2818c01c9efedb0a1a7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double trkf::KalmanFilterAlg::fGTraceWW</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Window width. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00169">169</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="acba53dfdbc63042caf3c269aa7bed491"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double trkf::KalmanFilterAlg::fGTraceXMax</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Graphical trace maximum x. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00172">172</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="aa7320aebefc2a6f9678ca1f532da8ea7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double trkf::KalmanFilterAlg::fGTraceXMin</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Graphical trace minimum x. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00171">171</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a669d84f36f01743ce8048e11b067b819"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;double&gt; trkf::KalmanFilterAlg::fGTraceZMax</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Graphical trace maximum z for each view. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00174">174</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad78812f0d30f985143b40d639932efed"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;double&gt; trkf::KalmanFilterAlg::fGTraceZMin</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Graphical trace minimum z for each view. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00173">173</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="aab59822b5451db197c582cbd098be11a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">TVirtualPad* trkf::KalmanFilterAlg::fInfoPad</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Information pad. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00181">181</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a96c1397d785be158129c8d36ea6987a6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;int, TMarker*&gt; trkf::KalmanFilterAlg::fMarkerMap</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Markers in current canvas. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00183">183</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="abd1ec322451d3befc68ecc5c66bf1cf7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double trkf::KalmanFilterAlg::fMaxEndChisq</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Maximum incremental chisquare for endpoint hit. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00154">154</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a955c9082fc249a45f79f4a8997c6d291"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double trkf::KalmanFilterAlg::fMaxIncChisq</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Maximum incremental chisquare to accept a hit. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00151">151</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="aaf64b31d2add93fcfc89736839b4f72d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double trkf::KalmanFilterAlg::fMaxLDist</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Maximum distance for linearized propagation. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00156">156</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a8d0ff60ed611fc2b67398f0855a5499e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int trkf::KalmanFilterAlg::fMaxNoiseHits</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Maximum number of hits in noise cluster. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00164">164</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab6bcc54a19e33e2e7639f6110c821ac2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double trkf::KalmanFilterAlg::fMaxPErr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Maximum pointing error for free propagation. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00149">149</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a8450d720a8df6f545925efa49c17869f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double trkf::KalmanFilterAlg::fMaxPredDist</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Maximum prediciton distance to accept a hit. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00157">157</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a78b312879081cd58cc8ba80db633c875"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double trkf::KalmanFilterAlg::fMaxPropDist</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Maximum propagation distance to candidate surface. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00159">159</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="afa116c60288b506aeddffd04ad08f9df"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int trkf::KalmanFilterAlg::fMaxSamePlane</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Maximum consecutive hits in same plane. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00162">162</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a4cd6ede9183db3c03fce6297237c1587"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double trkf::KalmanFilterAlg::fMaxSeedIncChisq</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Maximum incremental chisquare to accept a hit in seed phase. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00152">152</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a1661d1cda07b5d91d6ddec6bca467b56"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double trkf::KalmanFilterAlg::fMaxSeedPredDist</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Maximum prediciton distance to accept a hit in seed phase. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00158">158</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a31d494ce1fe055c04e21df6864027279"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double trkf::KalmanFilterAlg::fMaxSmoothIncChisq</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Maximum incremental chisquare to accept a hit in smooth phase. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00153">153</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a064806b6f47119501c2a4b1a8c0d43d4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double trkf::KalmanFilterAlg::fMaxSortDist</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sort high distance threshold. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00161">161</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="ac88efbb9c1344f770aac5d9e11ebe9e9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">TPaveText* trkf::KalmanFilterAlg::fMessages</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Message box. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00182">182</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="adbc4b24d83f7b22928fb9b8e3f57dee7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int trkf::KalmanFilterAlg::fMinLHits</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Minimum number of hits to turn off linearized propagation. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00155">155</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a7c04c3bbed317634e4f46079d79c4617"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double trkf::KalmanFilterAlg::fMinSampleDist</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Minimum sample distance (for momentum measurement). </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00165">165</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="aca86ef9f5e11ebb521a86c7f9a120251"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double trkf::KalmanFilterAlg::fMinSortDist</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sort low distance threshold. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00160">160</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a20cddd0f3cbc4d4b2b999a42f0915b27"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;TVirtualPad*&gt; trkf::KalmanFilterAlg::fPads</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>View pads in current canvas. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00180">180</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a18bdb931d6b6730cfe499df7379da449"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int trkf::KalmanFilterAlg::fPlane</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Preferred view plane. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00178">178</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a1e70c929d23cb24aae387474026a2ffa"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::KalmanFilterAlg::fTrace</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Trace flag. </p>

<p>Definition at line <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html#l00148">148</a> of file <a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="../../db/d35/KalmanFilterAlg_8h_source.html">KalmanFilterAlg.h</a></li>
<li><a class="el" href="../../d2/dab/KalmanFilterAlg_8cxx_source.html">KalmanFilterAlg.cxx</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
