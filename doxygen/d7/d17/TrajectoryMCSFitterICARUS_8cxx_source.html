<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>TrajectoryMCSFitterICARUS.cxx Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_b73b02d482d1c4a3db20c3d9ad52d395.html">srcs</a></li><li class="navelem"><a class="el" href="../../dir_04d670c4adcb884258431ddc1ce2763c.html">icaruscode</a></li><li class="navelem"><a class="el" href="../../dir_94314c0f385d81f04de3b3bdb34c1673.html">icaruscode</a></li><li class="navelem"><a class="el" href="../../dir_4f081efc6e34d5090b09a872dc566d00.html">TPC</a></li><li class="navelem"><a class="el" href="../../dir_d511a02d74100aab1c9912a99510057c.html">Tracking</a></li><li class="navelem"><a class="el" href="../../dir_dfb4c387d0e8691832babf8ae07fd2e6.html">MCS</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">TrajectoryMCSFitterICARUS.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d7/d17/TrajectoryMCSFitterICARUS_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/d68/TrajectoryMCSFitterICARUS_8h.html">TrajectoryMCSFitterICARUS.h</a>&quot;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/d53/bj_2lardataobj_2RecoBase_2Track_8h.html">lardataobj/RecoBase/Track.h</a>&quot;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d6c/geo__vectors__utils_8h.html">larcorealg/Geometry/geo_vectors_utils.h</a>&quot;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &quot;TMatrixDSym.h&quot;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &quot;TMatrixDSymEigen.h&quot;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;TH1.h&quot;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;TFile.h&quot;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/dfd/lardata_2RecoBaseProxy_2Track_8h.html">lardata/RecoBaseProxy/Track.h</a>&quot;</span> <span class="comment">//needed only if you do use the proxies</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../da/dc9/namespacepmtana.html#a9860e62c78db1dd9c7d635a2832b883a">std</a>;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">using namespace </span>trkf;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">using namespace </span>recob::tracking;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno"><a class="line" href="../../d6/d3b/classtrkf_1_1TrajectoryMCSFitterICARUS.html#aca8178d1aece4173d3fd747fe3d023da">   15</a></span>&#160;<a class="code" href="../../dd/d39/classrecob_1_1MCSFitResult.html">recob::MCSFitResult</a> TrajectoryMCSFitterICARUS::fitMcs(<span class="keyword">const</span> <a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html">recob::TrackTrajectory</a>&amp; traj, <span class="keywordtype">int</span> pid, <span class="keywordtype">bool</span> momDepConst)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;   <span class="comment">//std::cout &lt;&lt; &quot; traj nhits &quot; &lt;&lt; traj.NHits() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;   <span class="comment">//std::cout &lt;&lt; &quot; traj lenght &quot; &lt;&lt; traj.Length() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;   GetOptimalSegLen(1000,traj.<a class="code" href="../../d7/d1c/classrecob_1_1Trajectory.html#a9d4e1c313cdd82a5cd1332217e95118d">NPoints</a>(),2,traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#a64e9b10abf9f0833b8908e7e5d24a7e1">Length</a>());</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  <span class="comment">//std::cout &lt;&lt; &quot; D3p &quot; &lt;&lt; d3p &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  <span class="comment">// Break the trajectory in segments of length approximately equal to segLen_</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  vector&lt;size_t&gt; breakpoints;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  vector&lt;float&gt; segradlengths;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  vector&lt;float&gt; cumseglens;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  breakTrajInSegments(traj, breakpoints, segradlengths, cumseglens);</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="comment">//std::cout &lt;&lt; &quot; n segments &quot; &lt;&lt; segradlengths.size() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="comment">// Fit segment directions, and get 3D angles between them</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="comment">//resi</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordflow">if</span> (segradlengths.size()&lt;2) <span class="keywordflow">return</span> <a class="code" href="../../dd/d39/classrecob_1_1MCSFitResult.html">recob::MCSFitResult</a>();</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  vector&lt;float&gt; dtheta;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <a class="code" href="../../d0/da2/namespacetrkf.html#afce448b0c24542e8646ade72b3bd51b3">Vector_t</a> pcdir0;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <a class="code" href="../../d0/da2/namespacetrkf.html#afce448b0c24542e8646ade72b3bd51b3">Vector_t</a> pcdir1;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> = 0; <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>&lt;segradlengths.size(); <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>++) {</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    linearRegression(traj, breakpoints[<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>], breakpoints[p+1], pcdir1);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keywordflow">if</span> (p&gt;0) {</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;      <span class="keywordflow">if</span> (segradlengths[p]&lt;-100. || segradlengths[p-1]&lt;-100.) {</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        dtheta.push_back(-999.);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;      } <span class="keywordflow">else</span> { </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> cosval = pcdir0.X()*pcdir1.X()+pcdir0.Y()*pcdir1.Y()+pcdir0.Z()*pcdir1.Z();</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="comment">//assert(std::abs(cosval)&lt;=1);</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        <span class="comment">//units are mrad</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <span class="keywordtype">double</span> dt = 1000.*acos(cosval);<span class="comment">//should we try to use expansion for small angles?</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        dtheta.push_back(dt);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="comment">//std::cout &lt;&lt; &quot; linearfit angle &quot; &lt;&lt; dt &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  }</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    }</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    pcdir0 = pcdir1;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  }</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; vector&lt;Vector_t&gt; barycenters;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; <a class="code" href="../../d0/da2/namespacetrkf.html#afce448b0c24542e8646ade72b3bd51b3">Vector_t</a> bary;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;vector&lt;float&gt; dthetaPoly;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> = 0; <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>&lt;segradlengths.size(); <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>++) {</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    findSegmentBarycenter(traj, breakpoints[<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>], breakpoints[p+1], bary);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    barycenters.push_back(bary);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;}</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> = 2; <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>&lt;segradlengths.size(); <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>++) {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      <span class="keywordflow">if</span> (segradlengths[<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>]&lt;-100. || segradlengths[<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>-1]&lt;-100. || segradlengths[<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>-2]&lt;-100.) {</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        dtheta.push_back(-999.);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <a class="code" href="../../d0/da2/namespacetrkf.html#afce448b0c24542e8646ade72b3bd51b3">Vector_t</a> dbcp=barycenters[<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>]-barycenters[<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>-1];</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="keywordtype">float</span> <a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>=sqrt(dbcp.X()*dbcp.X()+dbcp.Y()*dbcp.Y()+dbcp.Z()*dbcp.Z());</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        dbcp/=<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="comment">//std::cout &lt;&lt; &quot; dbcp &quot; &lt;&lt; dbcp &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <a class="code" href="../../d0/da2/namespacetrkf.html#afce448b0c24542e8646ade72b3bd51b3">Vector_t</a> dbcm=barycenters[<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>-1]-barycenters[<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>-2];</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;         norm=sqrt(dbcm.X()*dbcm.X()+dbcm.Y()*dbcm.Y()+dbcm.Z()*dbcm.Z());</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;dbcm/=<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="comment">//std::cout &lt;&lt; &quot; dbcm &quot; &lt;&lt; dbcm &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> cosval = dbcp.X()*dbcm.X()+dbcp.Y()*dbcm.Y()+dbcp.Z()*dbcm.Z();</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="comment">//assert(std::abs(cosval)&lt;=1);</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="comment">//units are mrad</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;       <span class="comment">//std::cout &lt;&lt; &quot; cosval &quot; &lt;&lt; cosval &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;       <span class="keywordtype">double</span> dt = 1000.*acos(cosval);<span class="comment">//should we try to use expansion for small angles?</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        dthetaPoly.push_back(dt);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">//std::cout &lt;&lt; &quot; polygonal angle &quot; &lt;&lt; dt &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      }</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  }</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="comment">// Perform likelihood scan in forward and backward directions</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; <span class="comment">// std::ofstream outDtheta(&quot;dtheta2gev.out&quot;,ios::app);</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="comment">//outDtheta &lt;&lt; dtheta[0] &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  vector&lt;float&gt; cumLenFwd;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  vector&lt;float&gt; cumLenBwd;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i&lt;cumseglens.size()-2; i++) {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="comment">//std::cout &lt;&lt; &quot; seglen &quot; &lt;&lt; cumseglens[i] &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    cumLenFwd.push_back(cumseglens[i]);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    cumLenBwd.push_back(cumseglens.back()-cumseglens[i+2]);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  }</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d6/d7e/structtrkf_1_1TrajectoryMCSFitterICARUS_1_1ScanResult.html">ScanResult</a> fwdResult = doLikelihoodScan(dtheta, segradlengths, cumLenFwd, <span class="keyword">true</span>,  momDepConst, pid);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d6/d7e/structtrkf_1_1TrajectoryMCSFitterICARUS_1_1ScanResult.html">ScanResult</a> bwdResult = doLikelihoodScan(dtheta, segradlengths, cumLenBwd, <span class="keyword">false</span>, momDepConst, pid);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="comment">//std::cout &lt;&lt; &quot; fwdResult &quot; &lt;&lt; fwdResult.p &lt;&lt; &quot; bwdResult &quot; &lt;&lt; bwdResult.p &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="comment">//const ScanResult fwdResultPoly = doLikelihoodScan(dthetaPoly, segradlengths, cumLenFwd, true,  momDepConst, pid);</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="comment">//const ScanResult bwdResultPoly = doLikelihoodScan(dthetaPoly, segradlengths, cumLenBwd, false, momDepConst, pid);</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="comment">//std::cout &lt;&lt; &quot; fwdResultPoly &quot; &lt;&lt; fwdResultPoly.p &lt;&lt; &quot; bwdResultPoly &quot; &lt;&lt; bwdResultPoly.p &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">//for(unsigned int j=0;j&lt;segradlengths.size();j++)</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="comment">//std::cout &lt;&lt; &quot; dtheta &quot; &lt;&lt; dtheta.at(j) &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dd/d39/classrecob_1_1MCSFitResult.html">recob::MCSFitResult</a>(pid,</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                             fwdResult.<a class="code" href="../../d6/d7e/structtrkf_1_1TrajectoryMCSFitterICARUS_1_1ScanResult.html#ae229b715ea9fb52dc62fbe84b4f2248f">p</a>,fwdResult.<a class="code" href="../../d6/d7e/structtrkf_1_1TrajectoryMCSFitterICARUS_1_1ScanResult.html#ac8741111e68a58808edf0894d0dcbc46">pUnc</a>,fwdResult.<a class="code" href="../../d6/d7e/structtrkf_1_1TrajectoryMCSFitterICARUS_1_1ScanResult.html#a075db875f9a456c2e99edead112ff809">logL</a>,</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                             bwdResult.<a class="code" href="../../d6/d7e/structtrkf_1_1TrajectoryMCSFitterICARUS_1_1ScanResult.html#ae229b715ea9fb52dc62fbe84b4f2248f">p</a>,bwdResult.<a class="code" href="../../d6/d7e/structtrkf_1_1TrajectoryMCSFitterICARUS_1_1ScanResult.html#ac8741111e68a58808edf0894d0dcbc46">pUnc</a>,bwdResult.<a class="code" href="../../d6/d7e/structtrkf_1_1TrajectoryMCSFitterICARUS_1_1ScanResult.html#a075db875f9a456c2e99edead112ff809">logL</a>,</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                             segradlengths,dtheta);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;}</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="../../d6/d3b/classtrkf_1_1TrajectoryMCSFitterICARUS.html#aee66fb406f8eb865dba961ead8c8170a">  112</a></span>&#160;<span class="keywordtype">void</span> TrajectoryMCSFitterICARUS::breakTrajInSegments(<span class="keyword">const</span> <a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html">recob::TrackTrajectory</a>&amp; traj, vector&lt;size_t&gt;&amp; breakpoints, vector&lt;float&gt;&amp; segradlengths, vector&lt;float&gt;&amp; cumseglens)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> trajlen = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#a64e9b10abf9f0833b8908e7e5d24a7e1">Length</a>();</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> nseg = <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::max</a>(minNSegs_,<span class="keywordtype">int</span>(trajlen/segLen_));</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> thisSegLen = trajlen/double(nseg);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="comment">// std::cout &lt;&lt; &quot;track with length=&quot; &lt;&lt; trajlen &lt;&lt; &quot; broken in nseg=&quot; &lt;&lt; nseg &lt;&lt; &quot; of length=&quot; &lt;&lt; thisSegLen &lt;&lt; &quot; where segLen_=&quot; &lt;&lt; segLen_ &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  constexpr <span class="keywordtype">double</span> lar_radl_inv = 1./14.0;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  cumseglens.push_back(0.);<span class="comment">//first segment has zero cumulative length from previous segments</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="keywordtype">double</span> thislen = 0.;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keyword">auto</span> nextValid=traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#ad935eb6f307165c6c84b659c21ef0c3b">FirstValidPoint</a>();</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  breakpoints.push_back(nextValid);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="keyword">auto</span> pos0 = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#ac5b2211c3729d3b51481f0445df1718c">LocationAtPoint</a>(nextValid);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  nextValid = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#a63a68d3d4608ba73321df782a3e8b430">NextValidPoint</a>(nextValid+1);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="keywordtype">int</span> npoints = 0;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordflow">while</span> (nextValid!=<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#a16ac7e8b7d7b38c1237c7df1b941dde8">recob::TrackTrajectory::InvalidIndex</a>) {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keyword">auto</span> pos1 = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#ac5b2211c3729d3b51481f0445df1718c">LocationAtPoint</a>(nextValid);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    thislen += ( (pos1-pos0).R() );</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    pos0=pos1;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    npoints++;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordflow">if</span> (thislen&gt;=thisSegLen) {</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      breakpoints.push_back(nextValid);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      <span class="keywordflow">if</span> (npoints&gt;=minHitsPerSegment_) segradlengths.push_back(thislen*lar_radl_inv);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="keywordflow">else</span> segradlengths.push_back(-999.);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      cumseglens.push_back(cumseglens.back()+thislen);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      thislen = 0.;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      npoints = 0;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    }</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    nextValid = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#a63a68d3d4608ba73321df782a3e8b430">NextValidPoint</a>(nextValid+1);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="comment">//then add last segment</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keywordflow">if</span> (thislen&gt;0.) {</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    breakpoints.push_back(traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#adbef272269b31b0a213a9b4de8504d07">LastValidPoint</a>()+1);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    segradlengths.push_back(thislen*lar_radl_inv);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    cumseglens.push_back(cumseglens.back()+thislen);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  }</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;}</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div>
<div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="../../d6/d3b/classtrkf_1_1TrajectoryMCSFitterICARUS.html#a92ce990dbdb2fbef449870e24071680b">  151</a></span>&#160;<span class="keyword">const</span> <a class="code" href="../../d6/d7e/structtrkf_1_1TrajectoryMCSFitterICARUS_1_1ScanResult.html">TrajectoryMCSFitterICARUS::ScanResult</a> TrajectoryMCSFitterICARUS::doLikelihoodScan(std::vector&lt;float&gt;&amp; dtheta, std::vector&lt;float&gt;&amp; seg_nradlengths, std::vector&lt;float&gt;&amp; cumLen, <span class="keywordtype">bool</span> fwdFit, <span class="keywordtype">bool</span> momDepConst, <span class="keywordtype">int</span> pid)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="keywordtype">int</span>    best_idx  = -1;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordtype">double</span> best_logL = <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::numeric_limits&lt;double&gt;::max</a>();</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordtype">double</span> best_p    = -1.0;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  std::vector&lt;float&gt; vlogL;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; <span class="keywordflow">for</span> (<span class="keywordtype">double</span> p_test = pMin_; p_test &lt;= pMax_; p_test+=pStep_) {</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordtype">double</span> logL = mcsLikelihood(p_test, angResol_, dtheta, seg_nradlengths, cumLen, fwdFit, momDepConst, pid);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">if</span> (logL &lt; best_logL) {</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      best_p    = p_test;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      best_logL = logL;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      best_idx  = vlogL.size();</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    }</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">// std::cout &lt;&lt; &quot; ptest &quot; &lt;&lt; p_test &lt;&lt; &quot; likeli &quot; &lt;&lt; logL &lt;&lt; &quot; bestp &quot;&lt;&lt; best_p &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">//compute likelihood for MC momentum</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="comment">/*  double logL = mcsLikelihood(2., angResol_, dtheta, seg_nradlengths, cumLen, fwdFit, momDepConst, pid);</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">    if (logL &lt; best_logL) {</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">      best_p    = 2.;</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">      best_logL = logL;</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">      best_idx  = vlogL.size();</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">    }*/</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    vlogL.push_back(logL);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="comment">//uncertainty from left side scan</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordtype">double</span> lunc = -1.0;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keywordflow">if</span> (best_idx&gt;0) {</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=best_idx-1;j&gt;=0;j--) {</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <span class="keywordtype">double</span> dLL = vlogL[j]-vlogL[best_idx];</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="keywordflow">if</span> ( dLL&lt;0.5 ) {</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        lunc = (best_idx-j)*pStep_;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    }</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="comment">//uncertainty from right side scan</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keywordtype">double</span> runc = -1.0;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordflow">if</span> (best_idx&lt;<span class="keywordtype">int</span>(vlogL.size()-1)) {  </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=best_idx+1;j&lt;vlogL.size();j++) {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      <span class="keywordtype">double</span> dLL = vlogL[j]-vlogL[best_idx];</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      <span class="keywordflow">if</span> ( dLL&lt;0.5 ) {</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        runc = (j-best_idx)*pStep_;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    }</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  }</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d6/d7e/structtrkf_1_1TrajectoryMCSFitterICARUS_1_1ScanResult.html">ScanResult</a>(best_p, <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::max</a>(lunc,runc), best_logL);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;}</div>
<div class="line"><a name="l00196"></a><span class="lineno"><a class="line" href="../../d6/d3b/classtrkf_1_1TrajectoryMCSFitterICARUS.html#a6d690f07ad270a0c0472240e197e9d1a">  196</a></span>&#160;<span class="keywordtype">void</span> TrajectoryMCSFitterICARUS::findSegmentBarycenter(<span class="keyword">const</span> <a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html">recob::TrackTrajectory</a>&amp; traj, <span class="keyword">const</span> <span class="keywordtype">size_t</span> firstPoint, <span class="keyword">const</span> <span class="keywordtype">size_t</span> lastPoint, <a class="code" href="../../d0/da2/namespacetrkf.html#afce448b0c24542e8646ade72b3bd51b3">Vector_t</a>&amp; bary)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="keywordtype">int</span> npoints = 0;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <a class="code" href="../../d3/dcb/classgeo_1_1vect_1_1MiddlePointAccumulatorDim.html">geo::vect::MiddlePointAccumulator</a> middlePointCalc;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="keywordtype">size_t</span> nextValid = firstPoint;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="keywordflow">while</span> (nextValid&lt;lastPoint) {</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    middlePointCalc.<a class="code" href="../../d3/dcb/classgeo_1_1vect_1_1MiddlePointAccumulatorDim.html#a6c46bfab403c51fa43d4d7a7d4bf7069">add</a>(traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#ac5b2211c3729d3b51481f0445df1718c">LocationAtPoint</a>(nextValid));</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    nextValid = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#a63a68d3d4608ba73321df782a3e8b430">NextValidPoint</a>(nextValid+1);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    npoints++;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> avgpos = middlePointCalc.<a class="code" href="../../d3/dcb/classgeo_1_1vect_1_1MiddlePointAccumulatorDim.html#a6ff7d454670025ebad308ef91967545a">middlePoint</a>();</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  bary=avgpos;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="comment">//std::cout &lt;&lt; &quot; avgpos &quot; &lt;&lt; avgpos &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;}</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="../../d6/d3b/classtrkf_1_1TrajectoryMCSFitterICARUS.html#a1fbd1707f40c136705bcedf619ad4d66">  210</a></span>&#160;<span class="keywordtype">void</span> TrajectoryMCSFitterICARUS::linearRegression(<span class="keyword">const</span> <a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html">recob::TrackTrajectory</a>&amp; traj, <span class="keyword">const</span> <span class="keywordtype">size_t</span> firstPoint, <span class="keyword">const</span> <span class="keywordtype">size_t</span> lastPoint, <a class="code" href="../../d0/da2/namespacetrkf.html#afce448b0c24542e8646ade72b3bd51b3">Vector_t</a>&amp; pcdir)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keywordtype">int</span> npoints = 0;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <a class="code" href="../../d3/dcb/classgeo_1_1vect_1_1MiddlePointAccumulatorDim.html">geo::vect::MiddlePointAccumulator</a> middlePointCalc;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="keywordtype">size_t</span> nextValid = firstPoint;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="keywordflow">while</span> (nextValid&lt;lastPoint) {</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    middlePointCalc.<a class="code" href="../../d3/dcb/classgeo_1_1vect_1_1MiddlePointAccumulatorDim.html#a6c46bfab403c51fa43d4d7a7d4bf7069">add</a>(traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#ac5b2211c3729d3b51481f0445df1718c">LocationAtPoint</a>(nextValid));</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    nextValid = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#a63a68d3d4608ba73321df782a3e8b430">NextValidPoint</a>(nextValid+1);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    npoints++;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  }</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> avgpos = middlePointCalc.<a class="code" href="../../d3/dcb/classgeo_1_1vect_1_1MiddlePointAccumulatorDim.html#a6ff7d454670025ebad308ef91967545a">middlePoint</a>();</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a> = 1./double(npoints);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="comment">//assert(npoints&gt;0);</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  TMatrixDSym <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>(3);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  nextValid = firstPoint;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="keywordflow">while</span> (nextValid&lt;lastPoint) {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#ac5b2211c3729d3b51481f0445df1718c">LocationAtPoint</a>(nextValid);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> xxw0 = <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.X()-avgpos.X();</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> yyw0 = <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.Y()-avgpos.Y();</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> zzw0 = <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.Z()-avgpos.Z();</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>(0, 0) += xxw0*xxw0*<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>(0, 1) += xxw0*yyw0*<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>(0, 2) += xxw0*zzw0*<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>(1, 0) += yyw0*xxw0*<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>(1, 1) += yyw0*yyw0*<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>(1, 2) += yyw0*zzw0*<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>(2, 0) += zzw0*xxw0*<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>(2, 1) += zzw0*yyw0*<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>(2, 2) += zzw0*zzw0*<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    nextValid = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#a63a68d3d4608ba73321df782a3e8b430">NextValidPoint</a>(nextValid+1);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="keyword">const</span> TMatrixDSymEigen me(m);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; eigenval = me.GetEigenValues();</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; eigenvec = me.GetEigenVectors();</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="keywordtype">int</span> maxevalidx = 0;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordtype">double</span> maxeval = eigenval(0);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;3; ++i) {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordflow">if</span> (eigenval(i)&gt;maxeval) {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      maxevalidx = i;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      maxeval = eigenval(i);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  } </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  pcdir = <a class="code" href="../../db/dfa/PMAlgTracking_8cxx.html#aba288dcf8037152d32ec29330d952878">Vector_t</a>(eigenvec(0, maxevalidx),eigenvec(1, maxevalidx),eigenvec(2, maxevalidx));</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="keywordflow">if</span> (traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#afb2d5aa9d104c3215733c28e7de4be99">DirectionAtPoint</a>(firstPoint).Dot(pcdir)&lt;0.) pcdir*=-1.;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;}</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div>
<div class="line"><a name="l00262"></a><span class="lineno"><a class="line" href="../../d6/d3b/classtrkf_1_1TrajectoryMCSFitterICARUS.html#a6d78ef0e4a0890d9a4117ed33f5388c2">  262</a></span>&#160;<span class="keywordtype">double</span> TrajectoryMCSFitterICARUS::mcsLikelihood(<span class="keywordtype">double</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>, <span class="keywordtype">double</span> theta0x, std::vector&lt;float&gt;&amp; dthetaij, std::vector&lt;float&gt;&amp; seg_nradl, std::vector&lt;float&gt;&amp; cumLen, <span class="keywordtype">bool</span> fwd, <span class="keywordtype">bool</span> momDepConst, <span class="keywordtype">int</span> pid)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> beg  = (fwd ? 0 : (dthetaij.size()-1));</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>  = (fwd ? dthetaij.size() : -1);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> incr = (fwd ? +1 : -1);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">//  bool print;</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">//  if(p&gt;1.29&amp;&amp;p&lt;1.32)  print = true;//(p&gt;1.999 &amp;&amp; p&lt;2.001);</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">//  else print=false;</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a> = <a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">mass</a>(pid);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> m2 = m*<a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> Etot = sqrt(p*p + m2);<span class="comment">//Initial energy</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="keywordtype">double</span> Eij2 = 0.;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="keywordtype">double</span> <span class="keyword">const</span> fixedterm = 0.5 * std::log( 2.0 * M_PI );</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordtype">double</span> result = 0;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = beg; i != <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>; i+=incr ) {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordflow">if</span> (dthetaij[i]&lt;0) {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;skip segment with too few points&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    }</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordflow">if</span> (eLossMode_==1) {</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      <span class="comment">// ELoss mode: MIP (constant)</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      constexpr <span class="keywordtype">double</span> kcal = 0.002105;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> Eij = Etot - kcal*cumLen[i];<span class="comment">//energy at this segment</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      Eij2 = Eij*Eij;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="comment">// Non constant energy loss distribution</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> Eij = GetE(Etot,cumLen[i],m);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      Eij2 = Eij*Eij;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    }</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">if</span> ( Eij2 &lt;= m2 ) {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      result = <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::numeric_limits&lt;double&gt;::max</a>();</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    }</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> pij = sqrt(Eij2 - m2);<span class="comment">//momentum at this segment</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> beta = sqrt( 1. - ((m2)/(pij*pij + m2)) );</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    constexpr <span class="keywordtype">double</span> tuned_HL_term1 = 11.0038; <span class="comment">// https://arxiv.org/abs/1703.06187</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    constexpr <span class="keywordtype">double</span> HL_term2 = 0.038;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> tH0 = ( (momDepConst ? MomentumDependentConstant(pij) : tuned_HL_term1) / (pij*beta) ) * ( 1.0 + HL_term2 * std::log( seg_nradl[i] ) ) * sqrt( seg_nradl[i] );</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> rms = sqrt( 2.0*( tH0 * tH0 + theta0x * theta0x ) );</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">if</span> (rms==0.0) {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      <span class="comment">//std::cout &lt;&lt; &quot; Error : RMS cannot be zero ! &quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::numeric_limits&lt;double&gt;::max</a>();</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    } </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> arg = dthetaij[i]/rms;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    result += ( std::log( rms ) + 0.5 * arg * arg + fixedterm);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">//    if (print &amp;&amp; fwd==true) cout &lt;&lt; &quot;TrajectoryMCSFitterICARUS pij=&quot; &lt;&lt; pij &lt;&lt; &quot; dthetaij[i]=&quot; &lt;&lt; dthetaij[i] &lt;&lt; &quot; tH0=&quot; &lt;&lt; tH0 &lt;&lt; &quot; rms=&quot; &lt;&lt; rms &lt;&lt; &quot; prob=&quot; &lt;&lt; ( std::log( rms ) + 0.5 * arg * arg + fixedterm) &lt;&lt; &quot; const=&quot; &lt;&lt; (momDepConst ? MomentumDependentConstant(pij) : tuned_HL_term1) &lt;&lt; &quot; beta=&quot; &lt;&lt; beta &lt;&lt; &quot; red_length=&quot; &lt;&lt; seg_nradl[i] &lt;&lt;  &quot; result &quot; &lt;&lt; result &lt;&lt; endl;</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="comment">//std::cout &lt;&lt; &quot; momentum &quot; &lt;&lt; p &lt;&lt;&quot; likelihood &quot; &lt;&lt; result &lt;&lt; std::endl; </span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;}</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div>
<div class="line"><a name="l00319"></a><span class="lineno"><a class="line" href="../../d6/d3b/classtrkf_1_1TrajectoryMCSFitterICARUS.html#a47f88b30bbadd8c10cef9c9485d22282">  319</a></span>&#160;<span class="keywordtype">double</span> TrajectoryMCSFitterICARUS::energyLossLandau(<span class="keyword">const</span> <span class="keywordtype">double</span> mass2,<span class="keyword">const</span> <span class="keywordtype">double</span> e2, <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="comment">// eq. (33.11) in http://pdg.lbl.gov/2016/reviews/rpp2016-rev-passage-particles-matter.pdf (except density correction is ignored)</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <span class="keywordflow">if</span> (x&lt;=0.) <span class="keywordflow">return</span> 0.;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  constexpr <span class="keywordtype">double</span> Iinv2 = 1./(188.E-6*188.E-6);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  constexpr <span class="keywordtype">double</span> matConst = 1.4*18./40.;<span class="comment">//density*Z/A</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  constexpr <span class="keywordtype">double</span> me = 0.511;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  constexpr <span class="keywordtype">double</span> kappa = 0.307075;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  constexpr <span class="keywordtype">double</span> j = 0.200;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> beta2 = (e2-mass2)/e2;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> gamma2 = 1./(1.0 - beta2);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> epsilon = 0.5*kappa*x*matConst/beta2;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="keywordflow">return</span> 0.001*epsilon*( log(2.*me*beta2*gamma2*epsilon*Iinv2) + j - beta2 );</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;}</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00337"></a><span class="lineno"><a class="line" href="../../d6/d3b/classtrkf_1_1TrajectoryMCSFitterICARUS.html#aa1c9d85bef5da4d6b54ec3e704626fbb">  337</a></span>&#160;<span class="keywordtype">double</span> TrajectoryMCSFitterICARUS::energyLossBetheBloch(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">mass</a>,<span class="keyword">const</span> <span class="keywordtype">double</span> e2)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="comment">// stolen, mostly, from GFMaterialEffects.</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  constexpr <span class="keywordtype">double</span> Iinv = 1./188.E-6;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  constexpr <span class="keywordtype">double</span> matConst = 1.4*18./40.;<span class="comment">//density*Z/A</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  constexpr <span class="keywordtype">double</span> me = 0.511;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  constexpr <span class="keywordtype">double</span> kappa = 0.307075;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> beta2 = (e2-mass*<a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">mass</a>)/e2;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> gamma2 = 1./(1.0 - beta2);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> massRatio = me/<a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">mass</a>;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> argument = (2.*me*gamma2*beta2*Iinv) * std::sqrt(1+2*std::sqrt(gamma2)*massRatio + massRatio*massRatio);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keywordtype">double</span> dedx = kappa*matConst/beta2;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="keywordflow">if</span> (mass==0.0) <span class="keywordflow">return</span>(0.0);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keywordflow">if</span> (argument &lt;= <a class="code" href="../../d6/d11/namespacemake__calib__df.html#ada2bd95dba6a990f1012b56dacc20b0e">exp</a>(beta2)) {</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      dedx = 0.;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  } <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    dedx *= (log(argument)-beta2)*1.<a class="code" href="../../d4/d3a/rawtorootconvert_8fcl.html#a073d3febd81cab639f2a8aa357dc5ef1">E</a>-3; <span class="comment">// Bethe-Bloch, converted to GeV/cm</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">if</span> (dedx&lt;0.) dedx = 0.;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  }</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="keywordflow">return</span> dedx;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;}</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00361"></a><span class="lineno"><a class="line" href="../../d6/d3b/classtrkf_1_1TrajectoryMCSFitterICARUS.html#aac696b915ab8fa93165136c7ea35028c">  361</a></span>&#160;<span class="keywordtype">double</span> TrajectoryMCSFitterICARUS::GetE(<span class="keyword">const</span> <span class="keywordtype">double</span> initial_E, <span class="keyword">const</span> <span class="keywordtype">double</span> length_travelled, <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> step_size = length_travelled / nElossSteps_;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keywordtype">double</span> current_E = initial_E;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> m2 = m*<a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> i = 0; i &lt; nElossSteps_; ++i) {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">if</span> (eLossMode_==2) {</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      <span class="keywordtype">double</span> dedx = energyLossBetheBloch(m,current_E);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      current_E -= (dedx * step_size);</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      <span class="comment">// MPV of Landau energy loss distribution</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      current_E -= energyLossLandau(m2,current_E*current_E,step_size);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    }</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">if</span> ( current_E &lt;= m ) {</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      <span class="comment">// std::cout&lt;&lt;&quot;WARNING: current_E less than mu mass. it is &quot;&lt;&lt;current_E&lt;&lt;std::endl;</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <span class="keywordflow">return</span> 0.;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="keywordflow">return</span> current_E;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;}</div>
<div class="line"><a name="l00383"></a><span class="lineno"><a class="line" href="../../d6/d3b/classtrkf_1_1TrajectoryMCSFitterICARUS.html#ae50b5bda9fe4da224838fd9c41f10d95">  383</a></span>&#160;<span class="keywordtype">double</span> TrajectoryMCSFitterICARUS::GetOptimalSegLen(<span class="keyword">const</span> <span class="keywordtype">double</span> guess_p, <span class="keyword">const</span> <span class="keywordtype">int</span> n_points, <span class="keyword">const</span> <span class="keywordtype">int</span> plane, <span class="keyword">const</span> <span class="keywordtype">double</span> length_travelled)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">// check units of measurment! (energy, length...)</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="keywordtype">double</span> initial_p=guess_p*-0.211*length_travelled;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="keywordtype">double</span> MIN_P=1000;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="keywordflow">if</span>(initial_p&lt;MIN_P) initial_p=MIN_P;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="keywordtype">double</span> sigma=d3p; <span class="comment">//to be replaced by computed D3P when ready!</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">//double cosa=1;</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="keywordtype">double</span> sinb=1; <span class="comment">//both to be replaced by angles when ready!</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="keywordtype">double</span> DsTot=length_travelled; <span class="comment">//to be checked!</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="keywordtype">double</span> p0=13.6; <span class="comment">//MeV! constant in MCS formula</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="keywordtype">double</span> LogTerm=0.038; <span class="comment">//log term in MCS formula</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="keywordtype">double</span> <a class="code" href="../../d6/d55/multigen_8fcl.html#ac34c9cce9286f898da9018a51aa394c0">X0</a>=140.; <span class="comment">//interaction length in mm</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="keywordtype">double</span> xi=(sigma/DsTot)*(initial_p/2.)/p0*sqrt(X0/length_travelled)/sqrt(<span class="keywordtype">double</span>(n_points))*sinb;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">//double K=6*xi*xi;</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="keywordtype">double</span> <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>=1/sqrt(6*xi);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">//double sigmaMS=p0/(initial_p/2.)*sqrt(length_travelled/X0/m/cosa)/sqrt(2.)/cosa;</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">//double sigmaMeas=pow(m,1.5)*sqrt(double(6.))*sigma*sinb/cosa/DsTot/sqrt(double(n_points));</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="keywordtype">double</span> alfa=1+LogTerm*log(DsTot/sinb/<span class="keywordtype">double</span>(m)/X0);</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="keywordtype">double</span> m_corr=(m==1)?m:sqrt(m/(m-1));</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="keywordtype">double</span> xiCorr=sigma/DsTot*((initial_p/2.)/p0)*sqrt(X0/length_travelled)*sqrt((<span class="keywordtype">double</span>)n_points)*sinb/alfa;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="keywordtype">double</span> m2=m_corr/sqrt(6.*xiCorr);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="keywordflow">if</span>(m==1) m2=10;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;m2+=0.5;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="keywordflow">return</span> m2;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;}</div>
<div class="line"><a name="l00419"></a><span class="lineno"><a class="line" href="../../d6/d3b/classtrkf_1_1TrajectoryMCSFitterICARUS.html#ab0df1bc1080dd14516056595391fd217">  419</a></span>&#160;<span class="keywordtype">void</span> TrajectoryMCSFitterICARUS::ComputeD3P()  {</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;{   </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordtype">double</span> res;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    vector&lt;double&gt; h0;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    vector&lt;double&gt; alf;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    TH1D* hd3pv=<span class="keyword">new</span> TH1D(<span class="stringliteral">&quot;hd3pv&quot;</span>,<span class="stringliteral">&quot;hd3pv&quot;</span>,100,-5.,5.);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0;j&lt;hits2d.size()-2;j+=3) {</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            <span class="keywordtype">double</span> <a class="code" href="../../d0/d8f/decode__signalprocess__icarus_8fcl.html#a2a105cb669129f9c63eb7a4c15bf2d9b">a</a>;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            res=computeResidual(j,a);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            <span class="comment">//cout &lt;&lt; &quot; point &quot;  &lt;&lt; j &lt;&lt; &quot; residual &quot; &lt;&lt;res &lt;&lt; endl;</span><span class="comment"></span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">            //! for each triplet of consecutive hits, save absolute value of residuale</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment"></span>            <span class="keywordflow">if</span>(<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a>(res)&lt;5) { <span class="comment">//mm</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                h0.push_back(res);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                alf.push_back(a);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                hd3pv-&gt;Fill(res);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;               </div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            }}</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="keywordtype">bool</span> writeHisto=<span class="keyword">true</span>;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="keywordflow">if</span>(writeHisto) {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;       TFile *f = <span class="keyword">new</span> TFile(<span class="stringliteral">&quot;d3phisto.root&quot;</span>,<span class="stringliteral">&quot;UPDATE&quot;</span>);</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    hd3pv-&gt;Write();</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        f-&gt;Close();</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        f-&gt;Delete();</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        }</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordflow">if</span>(!h0.size())</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;       d3p=0.4;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;       d3p=hd3pv-&gt;GetRMS();</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    </div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="comment">//d3pvector=h0;</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="comment">//return d3p;</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;}</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;}</div>
<div class="line"><a name="l00457"></a><span class="lineno"><a class="line" href="../../d6/d3b/classtrkf_1_1TrajectoryMCSFitterICARUS.html#ac7d34c899d763369c8a28613a2caa797">  457</a></span>&#160;<span class="keywordtype">double</span> TrajectoryMCSFitterICARUS::computeResidual(<span class="keywordtype">int</span> i, <span class="keywordtype">double</span>&amp; alfa)<span class="keyword"> const</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="comment">/*const auto p0 = traj.LocationAtPoint(i);</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">    const auto p1 = traj.LocationAtPoint(i+1);</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">    const auto p2 = traj.LocationAtPoint(i+2);</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">    auto x0=p0.X();  auto x1=p1.X();  auto x2=p2.X();</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">    auto y0=p0.Y();  auto y1=p1.Y();  auto y2=p2.Y();</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">   // auto z0=p0.Z();  auto z1=p1.Z();  auto z2=p2.Z();*/</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<a class="code" href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a> h0=hits2d.at(i);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<a class="code" href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a> h1=hits2d.at(i+1);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<a class="code" href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a> h2=hits2d.at(i+2);</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">//std::cout &lt;&lt; &quot; PeakTime &quot; &lt;&lt; h0.PeakTime() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="keywordtype">float</span> x0=h0.<a class="code" href="../../db/d4e/classrecob_1_1Hit.html#ac490abcf98854d93cf2fa85eadf4d469">WireID</a>().<a class="code" href="../../de/db1/structgeo_1_1WireID.html#ac303d2971eb9697f3a65821bb92bb934">Wire</a>*3; <span class="keyword">auto</span> y0=h0.<a class="code" href="../../db/d4e/classrecob_1_1Hit.html#a46ddaf21b6eec49d205220f7daf3a85c">PeakTime</a>()*0.622;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="keywordtype">float</span> x1=h1.<a class="code" href="../../db/d4e/classrecob_1_1Hit.html#ac490abcf98854d93cf2fa85eadf4d469">WireID</a>().<a class="code" href="../../de/db1/structgeo_1_1WireID.html#ac303d2971eb9697f3a65821bb92bb934">Wire</a>*3; <span class="keyword">auto</span> y1=h1.<a class="code" href="../../db/d4e/classrecob_1_1Hit.html#a46ddaf21b6eec49d205220f7daf3a85c">PeakTime</a>()*0.622;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="keywordtype">float</span> x2=h2.<a class="code" href="../../db/d4e/classrecob_1_1Hit.html#ac490abcf98854d93cf2fa85eadf4d469">WireID</a>().<a class="code" href="../../de/db1/structgeo_1_1WireID.html#ac303d2971eb9697f3a65821bb92bb934">Wire</a>*3; <span class="keyword">auto</span> y2=h2.<a class="code" href="../../db/d4e/classrecob_1_1Hit.html#a46ddaf21b6eec49d205220f7daf3a85c">PeakTime</a>()*0.622;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">//std::cout &lt;&lt; &quot; x0 &quot; &lt;&lt; x0 &lt;&lt; &quot; x1 &quot; &lt;&lt; x1 &lt;&lt; &quot; x2 &quot; &lt;&lt; x2 &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">//std::cout &lt;&lt; &quot; y0 &quot; &lt;&lt; y0 &lt;&lt; &quot; y1 &quot; &lt;&lt; y1 &lt;&lt; &quot; y2 &quot; &lt;&lt; y2 &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordtype">double</span> ym=y0+(x1-x0)/(x2-x0)*(y2-y0);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a>(x2-x0)&lt;0.001)</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <span class="keywordflow">return</span> -999;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a>(x2-x1)&lt;0.001)</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="keywordflow">return</span> -999;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a>(x1-x0)&lt;0.001)</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        <span class="keywordflow">return</span> -999;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordtype">double</span> K=(x1-x0)/(x2-x0);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    alfa=1/sqrt(1+K*K+(1-K)*(1-K));</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordtype">double</span> dy=y1-ym;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordtype">double</span> res=dy*(alfa);</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;   </div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="comment">//cout &lt;&lt; &quot; y1 &quot; &lt;&lt; y1 &lt;&lt; &quot; ym &quot; &lt;&lt; ym &lt;&lt; &quot; alfa &quot; &lt;&lt; alfa &lt;&lt; endl;</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;   <span class="comment">// cout &lt;&lt; &quot; deltafit residual &quot; &lt;&lt; res &lt;&lt; endl;</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;           <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;}</div>
<div class="ttc" id="namespacepmtana_html_a9860e62c78db1dd9c7d635a2832b883a"><div class="ttname"><a href="../../da/dc9/namespacepmtana.html#a9860e62c78db1dd9c7d635a2832b883a">pmtana::std</a></div><div class="ttdeci">double std(const std::vector&lt; short &gt; &amp;wf, const double ped_mean, size_t start, size_t nsample)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/de4/UtilFunc_8cxx_source.html#l00042">UtilFunc.cxx:42</a></div></div>
<div class="ttc" id="run__opflash__electron_8fcl_html_a6673f03521899f7844189bcfd8ee5941"><div class="ttname"><a href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a></div><div class="ttdeci">process_name opflash particleana ie x</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d84/run__opflash__electron_8fcl_source.html#l00090">run_opflash_electron.fcl:90</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html_afb2d5aa9d104c3215733c28e7de4be99"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html#afb2d5aa9d104c3215733c28e7de4be99">recob::TrackTrajectory::DirectionAtPoint</a></div><div class="ttdeci">T DirectionAtPoint(unsigned int p) const </div><div class="ttdoc">Direction at point p. Use e.g. as: </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/TrackTrajectory_8h_source.html#l00559">TrackTrajectory.h:559</a></div></div>
<div class="ttc" id="structtrkf_1_1TrajectoryMCSFitterICARUS_1_1ScanResult_html_ac8741111e68a58808edf0894d0dcbc46"><div class="ttname"><a href="../../d6/d7e/structtrkf_1_1TrajectoryMCSFitterICARUS_1_1ScanResult.html#ac8741111e68a58808edf0894d0dcbc46">trkf::TrajectoryMCSFitterICARUS::ScanResult::pUnc</a></div><div class="ttdeci">double pUnc</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d68/TrajectoryMCSFitterICARUS_8h_source.html#l00135">TrajectoryMCSFitterICARUS.h:135</a></div></div>
<div class="ttc" id="namespacetrkf_html_afce448b0c24542e8646ade72b3bd51b3"><div class="ttname"><a href="../../d0/da2/namespacetrkf.html#afce448b0c24542e8646ade72b3bd51b3">trkf::Vector_t</a></div><div class="ttdeci">recob::tracking::Vector_t Vector_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d2f/TrackState_8h_source.html#l00019">TrackState.h:19</a></div></div>
<div class="ttc" id="classrecob_1_1Hit_html_ac490abcf98854d93cf2fa85eadf4d469"><div class="ttname"><a href="../../db/d4e/classrecob_1_1Hit.html#ac490abcf98854d93cf2fa85eadf4d469">recob::Hit::WireID</a></div><div class="ttdeci">geo::WireID WireID() const </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d26/Hit_8h_source.html#l00233">Hit.h:233</a></div></div>
<div class="ttc" id="classgeo_1_1vect_1_1MiddlePointAccumulatorDim_html"><div class="ttname"><a href="../../d3/dcb/classgeo_1_1vect_1_1MiddlePointAccumulatorDim.html">geo::vect::MiddlePointAccumulatorDim</a></div><div class="ttdoc">Helper class to compute the middle point in a point set. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d6c/geo__vectors__utils_8h_source.html#l01246">geo_vectors_utils.h:1246</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html_adbef272269b31b0a213a9b4de8504d07"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html#adbef272269b31b0a213a9b4de8504d07">recob::TrackTrajectory::LastValidPoint</a></div><div class="ttdeci">size_t LastValidPoint() const </div><div class="ttdoc">Returns the index of the last valid point in the trajectory. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/TrackTrajectory_8h_source.html#l00235">TrackTrajectory.h:235</a></div></div>
<div class="ttc" id="TrajectoryMCSFitterICARUS_8h_html"><div class="ttname"><a href="../../d9/d68/TrajectoryMCSFitterICARUS_8h.html">TrajectoryMCSFitterICARUS.h</a></div></div>
<div class="ttc" id="selectors_8fcl_html_a24c8335057af14a9b508d5ac18999ce5"><div class="ttname"><a href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a></div><div class="ttdeci">pdgs p</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd2/selectors_8fcl_source.html#l00022">selectors.fcl:22</a></div></div>
<div class="ttc" id="pmttriggerproducer_8fcl_html_a527d89be40c3c20ca8162df059180fd9"><div class="ttname"><a href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">max</a></div><div class="ttdeci">BEGIN_PROLOG pmt_uncoated ideal single PE test page of manual option are OR or AND window for pmt trigger time start window for pmt trigger time end etc then what events all hists are saved for max</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5a/pmttriggerproducer_8fcl_source.html#l00023">pmttriggerproducer.fcl:23</a></div></div>
<div class="ttc" id="structgeo_1_1WireID_html_ac303d2971eb9697f3a65821bb92bb934"><div class="ttname"><a href="../../de/db1/structgeo_1_1WireID.html#ac303d2971eb9697f3a65821bb92bb934">geo::WireID::Wire</a></div><div class="ttdeci">WireID_t Wire</div><div class="ttdoc">Index of the wire within its plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00580">geo_types.h:580</a></div></div>
<div class="ttc" id="rawtorootconvert_8fcl_html_a073d3febd81cab639f2a8aa357dc5ef1"><div class="ttname"><a href="../../d4/d3a/rawtorootconvert_8fcl.html#a073d3febd81cab639f2a8aa357dc5ef1">E</a></div><div class="ttdeci">process_name E</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d3a/rawtorootconvert_8fcl_source.html#l00026">rawtorootconvert.fcl:26</a></div></div>
<div class="ttc" id="namespacegen__crt__frags_html_a55a56854d78e363691470c7297fde77c"><div class="ttname"><a href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">gen_crt_frags.m</a></div><div class="ttdeci">tuple m</div><div class="ttdoc">now if test mode generate materials, CRT shell, world, gdml header else just generate CRT shell for u...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d8c/gen__crt__frags_8py_source.html#l01347">gen_crt_frags.py:1347</a></div></div>
<div class="ttc" id="classgeo_1_1vect_1_1MiddlePointAccumulatorDim_html_a6c46bfab403c51fa43d4d7a7d4bf7069"><div class="ttname"><a href="../../d3/dcb/classgeo_1_1vect_1_1MiddlePointAccumulatorDim.html#a6c46bfab403c51fa43d4d7a7d4bf7069">geo::vect::MiddlePointAccumulatorDim::add</a></div><div class="ttdeci">void add(Point const &amp;p)</div><div class="ttdoc">Accumulates a point. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d6c/geo__vectors__utils_8h_source.html#l01316">geo_vectors_utils.h:1316</a></div></div>
<div class="ttc" id="lardata_2RecoBaseProxy_2Track_8h_html"><div class="ttname"><a href="../../d0/dfd/lardata_2RecoBaseProxy_2Track_8h.html">Track.h</a></div><div class="ttdoc">Offers proxy::Tracks and proxy::Track class for recob::Track access. </div></div>
<div class="ttc" id="decode__signalprocess__icarus_8fcl_html_a2a105cb669129f9c63eb7a4c15bf2d9b"><div class="ttname"><a href="../../d0/d8f/decode__signalprocess__icarus_8fcl.html#a2a105cb669129f9c63eb7a4c15bf2d9b">a</a></div><div class="ttdeci">process_name gaushit a</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8f/decode__signalprocess__icarus_8fcl_source.html#l00037">decode_signalprocess_icarus.fcl:37</a></div></div>
<div class="ttc" id="sparse__vector__test_8cc_html_a39f16bf854ba527dee7eba5bbbd93f3f"><div class="ttname"><a href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a></div><div class="ttdeci">T abs(T value)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d59/sparse__vector__test_8cc_source.html#l00030">sparse_vector_test.cc:30</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html_a64e9b10abf9f0833b8908e7e5d24a7e1"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html#a64e9b10abf9f0833b8908e7e5d24a7e1">recob::TrackTrajectory::Length</a></div><div class="ttdeci">double Length(size_t startAt=0) const </div><div class="ttdoc">Returns the approximate length of the trajectory. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d36/TrackTrajectory_8cxx_source.html#l00070">TrackTrajectory.cxx:70</a></div></div>
<div class="ttc" id="multigen_8fcl_html_ac34c9cce9286f898da9018a51aa394c0"><div class="ttname"><a href="../../d6/d55/multigen_8fcl.html#ac34c9cce9286f898da9018a51aa394c0">X0</a></div><div class="ttdeci">standard_singlep gaussian distribution X0</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d55/multigen_8fcl_source.html#l00008">multigen.fcl:8</a></div></div>
<div class="ttc" id="classrecob_1_1Trajectory_html_a9d4e1c313cdd82a5cd1332217e95118d"><div class="ttname"><a href="../../d7/d1c/classrecob_1_1Trajectory.html#a9d4e1c313cdd82a5cd1332217e95118d">recob::Trajectory::NPoints</a></div><div class="ttdeci">size_t NPoints() const </div><div class="ttdoc">Returns the number of stored trajectory points. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/db7/Trajectory_8h_source.html#l00167">Trajectory.h:167</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html">recob::TrackTrajectory</a></div><div class="ttdoc">A trajectory in space reconstructed from hits. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/TrackTrajectory_8h_source.html#l00062">TrackTrajectory.h:62</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html_ac5b2211c3729d3b51481f0445df1718c"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html#ac5b2211c3729d3b51481f0445df1718c">recob::TrackTrajectory::LocationAtPoint</a></div><div class="ttdeci">T LocationAtPoint(unsigned int p) const </div><div class="ttdoc">Position at point p. Use e.g. as: </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/TrackTrajectory_8h_source.html#l00547">TrackTrajectory.h:547</a></div></div>
<div class="ttc" id="namespaceicarus_1_1ns_1_1util_html_aac918da84f16d53ad17bab4f817da1c4"><div class="ttname"><a href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">icarus::ns::util::end</a></div><div class="ttdeci">auto end(FixedBins&lt; T, C &gt; const &amp;) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dbd/FixedBins_8h_source.html#l00585">FixedBins.h:585</a></div></div>
<div class="ttc" id="geo__vectors__utils_8h_html"><div class="ttname"><a href="../../d5/d6c/geo__vectors__utils_8h.html">geo_vectors_utils.h</a></div><div class="ttdoc">Utilities to extend the interface of geometry vectors. </div></div>
<div class="ttc" id="structtrkf_1_1TrajectoryMCSFitterICARUS_1_1ScanResult_html_ae229b715ea9fb52dc62fbe84b4f2248f"><div class="ttname"><a href="../../d6/d7e/structtrkf_1_1TrajectoryMCSFitterICARUS_1_1ScanResult.html#ae229b715ea9fb52dc62fbe84b4f2248f">trkf::TrajectoryMCSFitterICARUS::ScanResult::p</a></div><div class="ttdeci">double p</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d68/TrajectoryMCSFitterICARUS_8h_source.html#l00135">TrajectoryMCSFitterICARUS.h:135</a></div></div>
<div class="ttc" id="bj_2lardataobj_2RecoBase_2Track_8h_html"><div class="ttname"><a href="../../d7/d53/bj_2lardataobj_2RecoBase_2Track_8h.html">Track.h</a></div><div class="ttdoc">Provides recob::Track data product. </div></div>
<div class="ttc" id="namespacegeo_1_1vect_html_a22bf6b956ca4ad2050a44810c80c805f"><div class="ttname"><a href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">geo::vect::norm</a></div><div class="ttdeci">auto norm(Vector const &amp;v)</div><div class="ttdoc">Return norm of the specified vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d6c/geo__vectors__utils_8h_source.html#l01202">geo_vectors_utils.h:1202</a></div></div>
<div class="ttc" id="structtrkf_1_1TrajectoryMCSFitterICARUS_1_1ScanResult_html"><div class="ttname"><a href="../../d6/d7e/structtrkf_1_1TrajectoryMCSFitterICARUS_1_1ScanResult.html">trkf::TrajectoryMCSFitterICARUS::ScanResult</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d68/TrajectoryMCSFitterICARUS_8h_source.html#l00132">TrajectoryMCSFitterICARUS.h:132</a></div></div>
<div class="ttc" id="namespacemake__calib__df_html_ada2bd95dba6a990f1012b56dacc20b0e"><div class="ttname"><a href="../../d6/d11/namespacemake__calib__df.html#ada2bd95dba6a990f1012b56dacc20b0e">make_calib_df.exp</a></div><div class="ttdeci">def exp</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d0e/make__calib__df_8py_source.html#l00043">make_calib_df.py:43</a></div></div>
<div class="ttc" id="classrecob_1_1MCSFitResult_html"><div class="ttname"><a href="../../dd/d39/classrecob_1_1MCSFitResult.html">recob::MCSFitResult</a></div><div class="ttdoc">Class storing the result of the Maximum Likelihood fit of Multiple Coulomb Scattering angles between ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df1/MCSFitResult_8h_source.html#l00019">MCSFitResult.h:19</a></div></div>
<div class="ttc" id="classrecob_1_1Hit_html_a46ddaf21b6eec49d205220f7daf3a85c"><div class="ttname"><a href="../../db/d4e/classrecob_1_1Hit.html#a46ddaf21b6eec49d205220f7daf3a85c">recob::Hit::PeakTime</a></div><div class="ttdeci">float PeakTime() const </div><div class="ttdoc">Time of the signal peak, in tick units. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d26/Hit_8h_source.html#l00218">Hit.h:218</a></div></div>
<div class="ttc" id="classgeo_1_1vect_1_1MiddlePointAccumulatorDim_html_a6ff7d454670025ebad308ef91967545a"><div class="ttname"><a href="../../d3/dcb/classgeo_1_1vect_1_1MiddlePointAccumulatorDim.html#a6ff7d454670025ebad308ef91967545a">geo::vect::MiddlePointAccumulatorDim::middlePoint</a></div><div class="ttdeci">geo::Point_t middlePoint() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d6c/geo__vectors__utils_8h_source.html#l01297">geo_vectors_utils.h:1297</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html_ad935eb6f307165c6c84b659c21ef0c3b"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html#ad935eb6f307165c6c84b659c21ef0c3b">recob::TrackTrajectory::FirstValidPoint</a></div><div class="ttdeci">size_t FirstValidPoint() const </div><div class="ttdoc">Returns the index of the first valid point in the trajectory. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/TrackTrajectory_8h_source.html#l00197">TrackTrajectory.h:197</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html_a16ac7e8b7d7b38c1237c7df1b941dde8"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html#a16ac7e8b7d7b38c1237c7df1b941dde8">recob::TrackTrajectory::InvalidIndex</a></div><div class="ttdeci">static constexpr size_t InvalidIndex</div><div class="ttdoc">Value returned on failed index queries. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/TrackTrajectory_8h_source.html#l00661">TrackTrajectory.h:661</a></div></div>
<div class="ttc" id="namespacelib_1_1dedx_html_af9508f78ba8143119daa95dbd8220f91"><div class="ttname"><a href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">lib.dedx.mass</a></div><div class="ttdeci">float mass</div><div class="ttdef"><b>Definition:</b> <a href="../../df/df9/dedx_8py_source.html#l00047">dedx.py:47</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html_a63a68d3d4608ba73321df782a3e8b430"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html#a63a68d3d4608ba73321df782a3e8b430">recob::TrackTrajectory::NextValidPoint</a></div><div class="ttdeci">size_t NextValidPoint(size_t index) const </div><div class="ttdoc">Returns the index of the next valid point in the trajectory. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/TrackTrajectory_8h_source.html#l00211">TrackTrajectory.h:211</a></div></div>
<div class="ttc" id="classrecob_1_1Hit_html"><div class="ttname"><a href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a></div><div class="ttdoc">2D representation of charge deposited in the TDC/wire plane </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d26/Hit_8h_source.html#l00048">Hit.h:48</a></div></div>
<div class="ttc" id="structtrkf_1_1TrajectoryMCSFitterICARUS_1_1ScanResult_html_a075db875f9a456c2e99edead112ff809"><div class="ttname"><a href="../../d6/d7e/structtrkf_1_1TrajectoryMCSFitterICARUS_1_1ScanResult.html#a075db875f9a456c2e99edead112ff809">trkf::TrajectoryMCSFitterICARUS::ScanResult::logL</a></div><div class="ttdeci">double logL</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d68/TrajectoryMCSFitterICARUS_8h_source.html#l00135">TrajectoryMCSFitterICARUS.h:135</a></div></div>
<div class="ttc" id="PMAlgTracking_8cxx_html_aba288dcf8037152d32ec29330d952878"><div class="ttname"><a href="../../db/dfa/PMAlgTracking_8cxx.html#aba288dcf8037152d32ec29330d952878">Vector_t</a></div><div class="ttdeci">recob::tracking::Vector_t Vector_t</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfa/PMAlgTracking_8cxx_source.html#l00021">PMAlgTracking.cxx:21</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
