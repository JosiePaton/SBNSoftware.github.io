<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>EMShowerAlg.cxx Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_b73b02d482d1c4a3db20c3d9ad52d395.html">srcs</a></li><li class="navelem"><a class="el" href="../../dir_f58b2474d7db671760af109c057c9f12.html">larreco</a></li><li class="navelem"><a class="el" href="../../dir_bfd42686fcf7bc0e8145fd17787a17cd.html">larreco</a></li><li class="navelem"><a class="el" href="../../dir_a92975983e87729a773cfa3b8109c8c3.html">RecoAlg</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">EMShowerAlg.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d0/d28/EMShowerAlg_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">///////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"></span><span class="comment">// Implementation of the EMShower algorithm</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// Forms EM showers from clusters and associated tracks.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// Also provides methods for finding the vertex and further</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// properties of the shower.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// Mike Wallbank (m.wallbank@sheffield.ac.uk), September 2015</span><span class="comment"></span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;cetlib/container_algorithms.h&quot;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;cetlib/pow.h&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;messagefacility/MessageLogger/MessageLogger.h&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d7c/Exceptions_8h.html">larcorealg/Geometry/Exceptions.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/dbc/ToElement_8h.html">lardata/ArtDataHelper/ToElement.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/d97/TrackUtils_8h.html">lardata/ArtDataHelper/TrackUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d65/EMShowerAlg_8h.html">larreco/RecoAlg/EMShowerAlg.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;TAxis.h&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;TCanvas.h&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;TFile.h&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;TGraph.h&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;TH1.h&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;TLine.h&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;TMath.h&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;TMathBase.h&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;TMultiGraph.h&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;TProfile.h&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;range/v3/numeric.hpp&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;range/v3/view.hpp&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keyword">using</span> <a class="code" href="../../d7/d0b/namespacelar.html#ac7ad65c5dbecd0f69500e739fe324e82">lar::to_element</a>;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="keyword">using namespace </span>ranges;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a2f9ef1ea7dcc0cd6b7b17cca1326a669">   37</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a2f9ef1ea7dcc0cd6b7b17cca1326a669">shower::EMShowerAlg::EMShowerAlg</a>(fhicl::ParameterSet <span class="keyword">const</span>&amp; pset, <span class="keywordtype">int</span> <span class="keyword">const</span> <a class="code" href="../../dd/db0/testFHiCLfiles_8sh.html#a0514aabed091ee5e2f35766eb01eced6">debug</a>)</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  : fDebug{debug}</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  , fMinTrackLength{pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;MinTrackLength&quot;</span>)}</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  , fdEdxTrackLength{pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;dEdxTrackLength&quot;</span>)}</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  , fSpacePointSize{pset.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;SpacePointSize&quot;</span>)}</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  , fNfitpass{pset.get&lt;<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;Nfitpass&quot;</span>)}</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  , fNfithits{pset.get&lt;std::vector&lt;unsigned int&gt;&gt;(<span class="stringliteral">&quot;Nfithits&quot;</span>)}</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  , fToler{pset.get&lt;std::vector&lt;double&gt;&gt;(<span class="stringliteral">&quot;Toler&quot;</span>)}</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  , fShowerEnergyAlg(pset.get&lt;fhicl::ParameterSet&gt;(<span class="stringliteral">&quot;ShowerEnergyAlg&quot;</span>))</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  , fCalorimetryAlg(pset.get&lt;fhicl::ParameterSet&gt;(<span class="stringliteral">&quot;CalorimetryAlg&quot;</span>))</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  , fProjectionMatchingAlg(pset.get&lt;fhicl::ParameterSet&gt;(<span class="stringliteral">&quot;ProjectionMatchingAlg&quot;</span>))</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  , fDetector{pset.get&lt;std::string&gt;(<span class="stringliteral">&quot;Detector&quot;</span>, <span class="stringliteral">&quot;dune35t&quot;</span>)} <span class="comment">// tmp</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  , fMakeGradientPlot{pset.get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;MakeGradientPlot&quot;</span>, <span class="keyword">false</span>)}</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  , fMakeRMSGradientPlot{pset.get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;MakeRMSGradientPlot&quot;</span>, <span class="keyword">false</span>)}</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  , fNumShowerSegments{pset.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NumShowerSegments&quot;</span>, 4)}</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;{</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordflow">if</span> (fNfitpass != fNfithits.size() || fNfitpass != fToler.size()) {</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">throw</span> art::Exception(art::errors::Configuration)</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;EMShowerAlg: fNfithits and fToler need to have size fNfitpass&quot;</span>;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  }</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;}</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a99f86c0f523fe77955a03d426d36f303">   60</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a99f86c0f523fe77955a03d426d36f303">shower::EMShowerAlg::AssociateClustersAndTracks</a>(</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Cluster&gt;&gt; <span class="keyword">const</span>&amp; clusters,</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  art::FindManyP&lt;recob::Hit&gt; <span class="keyword">const</span>&amp; fmh,</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  art::FindManyP&lt;recob::Track&gt; <span class="keyword">const</span>&amp; fmt,</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  std::map&lt;<span class="keywordtype">int</span>, std::vector&lt;int&gt;&gt;&amp; clusterToTracks,</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  std::map&lt;<span class="keywordtype">int</span>, std::vector&lt;int&gt;&gt;&amp; trackToClusters)<span class="keyword"> const</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  std::vector&lt;int&gt; clustersToIgnore = {-999};</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  AssociateClustersAndTracks(</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    clusters, fmh, fmt, clustersToIgnore, clusterToTracks, trackToClusters);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;}</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a953ccdc68a626391c423bfdbbd9da483">   73</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a99f86c0f523fe77955a03d426d36f303">shower::EMShowerAlg::AssociateClustersAndTracks</a>(</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Cluster&gt;&gt; <span class="keyword">const</span>&amp; clusters,</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  art::FindManyP&lt;recob::Hit&gt; <span class="keyword">const</span>&amp; fmh,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  art::FindManyP&lt;recob::Track&gt; <span class="keyword">const</span>&amp; fmt,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  std::vector&lt;int&gt; <span class="keyword">const</span>&amp; clustersToIgnore,</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  std::map&lt;<span class="keywordtype">int</span>, std::vector&lt;int&gt;&gt;&amp; clusterToTracks,</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  std::map&lt;<span class="keywordtype">int</span>, std::vector&lt;int&gt;&gt;&amp; trackToClusters)<span class="keyword"> const</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="comment">// Look through all the clusters</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; clusterPtr : clusters) {</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">// Get the hits in this cluster</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keyword">auto</span> <span class="keyword">const</span>&amp; clusterHits = fmh.at(clusterPtr.key());</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">// Look at all these hits and find the associated tracks</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; clusterHitPtr : clusterHits) {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      <span class="comment">// Get the tracks associated with this hit</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span>&amp; clusterHitTracks = fmt.at(clusterHitPtr.key());</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      <span class="keywordflow">if</span> (clusterHitTracks.size() &gt; 1) {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;More than one track associated with this hit!\n&quot;</span>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      }</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <span class="keywordflow">if</span> (clusterHitTracks.size() &lt; 1) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span>&amp; clusterHitTrackPtr = clusterHitTracks[0];</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      <span class="keywordflow">if</span> (clusterHitTrackPtr-&gt;Length() &lt; fMinTrackLength) {</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="keywordflow">if</span> (fDebug &gt; 2)</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;          <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Track &quot;</span> &lt;&lt; clusterHitTrackPtr-&gt;ID() &lt;&lt; <span class="stringliteral">&quot; is too short! (&quot;</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                    &lt;&lt; clusterHitTrackPtr-&gt;Length() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      }</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <span class="comment">// Add this cluster to the track map</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../df/df2/standard__reco_8fcl.html#a8e7c4631bab825a68b0a82d8223c2ec2">track</a> = clusterHitTrackPtr.key();</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#afac1ac7b61385644c993fbb774a1922f">cluster</a> = clusterPtr.key();</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <span class="keywordflow">if</span> (cet::search_all(clustersToIgnore, cluster)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      <span class="keywordflow">if</span> (not cet::search_all(trackToClusters[track], cluster))</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        trackToClusters[<a class="code" href="../../df/df2/standard__reco_8fcl.html#a8e7c4631bab825a68b0a82d8223c2ec2">track</a>].push_back(cluster);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      <span class="keywordflow">if</span> (not cet::search_all(clusterToTracks[cluster], track))</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        clusterToTracks[<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#afac1ac7b61385644c993fbb774a1922f">cluster</a>].push_back(track);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    }</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00119"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#abf9168bf6abdd97fa5c39b4f38821b17">  119</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#abf9168bf6abdd97fa5c39b4f38821b17">shower::EMShowerAlg::CheckIsolatedHits_</a>(</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt;&amp; showerHitsMap)<span class="keyword"> const</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  std::map&lt;int, std::vector&lt;int&gt;&gt; firstTPC;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; [plane, hits] : showerHitsMap)</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    firstTPC[hits.at(0)-&gt;WireID().TPC].push_back(plane);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="comment">// If all in the same TPC then that&#39;s great!</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordflow">if</span> (firstTPC.size() != 2) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="comment">// If they are in more than two TPCs, not much we can do</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (firstTPC.size() &gt; 2)</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="comment">// If we get to this point, there should be something we can do!</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="comment">// Find the problem plane</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="keywordtype">int</span> problemPlane = -1;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/dbd/trackfinderalgorithms_8fcl.html#ac996980052e16111a1efc913778a5f5f">planes</a> : firstTPC | <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#a5db4217e69ac7c2d95856da42b13f8e5">views::values</a>)</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d2/dbd/trackfinderalgorithms_8fcl.html#ac996980052e16111a1efc913778a5f5f">planes</a>.size() == 1) problemPlane = <a class="code" href="../../d2/dbd/trackfinderalgorithms_8fcl.html#ac996980052e16111a1efc913778a5f5f">planes</a>[0];</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="comment">// Require three hits</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keywordflow">if</span> (showerHitsMap.at(problemPlane).size() &lt; 3) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="comment">// and get the other planes with at least three hits</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  std::vector&lt;int&gt; otherPlanes;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> plane = 0; plane &lt; (int)<a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;MaxPlanes(); ++plane)</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">if</span> (plane != problemPlane <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a> showerHitsMap.count(plane) <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        showerHitsMap.at(plane).size() &gt;= 3)</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      otherPlanes.push_back(plane);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="keywordflow">if</span> (otherPlanes.size() == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="comment">// Look at the hits after the first one</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wrongTPC = showerHitsMap.at(problemPlane).at(0)-&gt;WireID().TPC;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nHits = 0;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;::iterator hitIt = showerHitsMap.at(problemPlane).begin();</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;       hitIt != showerHitsMap.at(problemPlane).end() <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a> (*hitIt)-&gt;WireID().TPC == wrongTPC;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;       ++hitIt)</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    ++nHits;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="comment">// If there are more than two hits in the &#39;wrong TPC&#39;, we can&#39;t be sure it is indeed wrong</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="keywordflow">if</span> (nHits &gt; 2) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="comment">// See if at least the next four times as many hits are in a different TPC</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  std::map&lt;int, int&gt; otherTPCs;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;::iterator hitIt =</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;         std::next(showerHitsMap.at(problemPlane).begin(), nHits);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;       hitIt != showerHitsMap.at(problemPlane).end() <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;       std::distance(std::next(showerHitsMap.at(problemPlane).begin(), nHits), hitIt) &lt; 4 * nHits;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;       ++hitIt)</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    ++otherTPCs[(*hitIt)-&gt;WireID().TPC];</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keywordflow">if</span> (otherTPCs.size() &gt; 1) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="comment">// If we get this far, we can move the problem hits from the front of the shower to the back</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  std::map&lt;int, int&gt; tpcCount;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keyword">const</span> otherPlane : otherPlanes)</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;::iterator hitIt =</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;           std::next(showerHitsMap.at(otherPlane).begin());</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;         hitIt != showerHitsMap.at(otherPlane).end() <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;         hitIt != std::next(showerHitsMap.at(otherPlane).begin(), 2);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;         ++hitIt)</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      ++tpcCount[(*hitIt)-&gt;WireID().TPC];</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="comment">// Remove the first hit if it is in the wrong TPC</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keywordflow">if</span> (tpcCount.size() == 1 <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      tpcCount.begin()-&gt;first ==</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        (int)(*std::next(showerHitsMap.at(problemPlane).begin(), nHits))-&gt;WireID().TPC) {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt; naughty_hits;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;::iterator hitIt = showerHitsMap.at(problemPlane).begin();</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;         hitIt != std::next(showerHitsMap.at(problemPlane).begin(), nHits);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;         ++hitIt) {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      naughty_hits.push_back(*hitIt);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      showerHitsMap.at(problemPlane).erase(hitIt);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    }</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; naughty_hit : naughty_hits)</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      showerHitsMap.at(problemPlane).push_back(naughty_hit);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  }</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;}</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l00201"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a5207fcc2d3eed13fe3f214c81788c016">  201</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a5207fcc2d3eed13fe3f214c81788c016">shower::EMShowerAlg::CheckShowerHits_</a>(</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt; <span class="keyword">const</span>&amp; showerHitsMap)<span class="keyword"> const</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordtype">bool</span> consistencyCheck = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordflow">if</span> (showerHitsMap.size() &lt; 2) { consistencyCheck = <span class="keyword">true</span>; }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (showerHitsMap.size() == 2) {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">// With two views, we can check:</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">//  -- timing between views is consistent</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">//  -- the 3D start point makes sense when projected back onto the individual planes</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt; startHits;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    std::vector&lt;int&gt; <a class="code" href="../../d2/dbd/trackfinderalgorithms_8fcl.html#ac996980052e16111a1efc913778a5f5f">planes</a>;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; [plane, hits] : showerHitsMap) {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      startHits.push_back(hits.front());</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      planes.push_back(plane);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    }</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    TVector3 showerStartPos = Construct3DPoint_(detProp, startHits.at(0), startHits.at(1));</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    TVector2 proj1 = Project3DPointOntoPlane_(detProp, showerStartPos, planes.at(0));</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    TVector2 proj2 = Project3DPointOntoPlane_(detProp, showerStartPos, planes.at(1));</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordtype">double</span> timingDifference = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(startHits.at(0)-&gt;PeakTime() - startHits.at(1)-&gt;PeakTime());</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordtype">double</span> projectionDifference = ((HitPosition_(detProp, *startHits.at(0)) - proj1).Mod() +</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                                   (HitPosition_(detProp, *startHits.at(1)) - proj2).Mod()) /</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                                  (<span class="keywordtype">double</span>)2;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">if</span> (timingDifference &gt; 40 or projectionDifference &gt; 5 or showerStartPos.X() == -9999 or</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        showerStartPos.Y() == -9999 or showerStartPos.Z() == -9999)</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      consistencyCheck = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordflow">if</span> (fDebug &gt; 1)</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Timing difference is &quot;</span> &lt;&lt; timingDifference &lt;&lt; <span class="stringliteral">&quot; and projection distance is &quot;</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                &lt;&lt; projectionDifference &lt;&lt; <span class="stringliteral">&quot; (start is (&quot;</span> &lt;&lt; showerStartPos.X() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                &lt;&lt; showerStartPos.Y() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; showerStartPos.Z() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (showerHitsMap.size() == 3) {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="comment">// With three views, we can check:</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="comment">//  -- the timing between views is consistent</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="comment">//  -- the 3D start point formed by two views and projected back into the third is close to the start point in that view</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    std::map&lt;int, art::Ptr&lt;recob::Hit&gt;&gt; start2DMap;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; [plane, hits] : showerHitsMap) {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      start2DMap[plane] = hits.front();</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    }</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    std::map&lt;int, double&gt; projDiff;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    std::map&lt;int, double&gt; timingDiff;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> plane = 0; plane &lt; 3; ++plane) {</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      std::vector&lt;int&gt; otherPlanes;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> otherPlane = 0; otherPlane &lt; 3; ++otherPlane)</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="keywordflow">if</span> (otherPlane != plane) otherPlanes.push_back(otherPlane);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      TVector3 showerStartPos = Construct3DPoint_(</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        detProp, start2DMap.at(otherPlanes.at(0)), start2DMap.at(otherPlanes.at(1)));</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      TVector2 showerStartProj = Project3DPointOntoPlane_(detProp, showerStartPos, plane);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="keywordflow">if</span> (fDebug &gt; 2) {</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Plane... &quot;</span> &lt;&lt; plane;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;\nStart position in this plane is &quot;</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                  &lt;&lt; HitPosition_(detProp, *start2DMap.at(plane)).<a class="code" href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a>() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                  &lt;&lt; HitPosition_(detProp, *start2DMap.at(plane)).Y() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Shower start from other two planes is (&quot;</span> &lt;&lt; showerStartPos.X() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                  &lt;&lt; showerStartPos.Y() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; showerStartPos.Z() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Projecting the other two planes gives position (&quot;</span> &lt;&lt; showerStartProj.X()</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; showerStartProj.Y() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      }</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <span class="keywordtype">double</span> projDiff =</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>((showerStartProj - HitPosition_(detProp, *start2DMap.at(plane))).Mod());</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="keywordtype">double</span> timeDiff = TMath::Max(</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(start2DMap.at(plane)-&gt;PeakTime() - start2DMap.at(otherPlanes.at(0))-&gt;PeakTime()),</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(start2DMap.at(plane)-&gt;PeakTime() - start2DMap.at(otherPlanes.at(1))-&gt;PeakTime()));</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="keywordflow">if</span> (fDebug &gt; 1)</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Plane &quot;</span> &lt;&lt; plane &lt;&lt; <span class="stringliteral">&quot; has projDiff &quot;</span> &lt;&lt; projDiff &lt;&lt; <span class="stringliteral">&quot; and timeDiff &quot;</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                  &lt;&lt; timeDiff &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      <span class="keywordflow">if</span> (projDiff &gt; 5 or timeDiff &gt; 40) consistencyCheck = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="keywordflow">if</span> (fDebug &gt; 1) <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Consistency check is &quot;</span> &lt;&lt; consistencyCheck &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keywordflow">return</span> consistencyCheck;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;}</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;std::vector&lt;int&gt;</div>
<div class="line"><a name="l00294"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a5c173c4a5ef8331f8e7d546a660d00d1">  294</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a5c173c4a5ef8331f8e7d546a660d00d1">shower::EMShowerAlg::CheckShowerPlanes</a>(<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;std::vector&lt;int&gt;&gt; <span class="keyword">const</span>&amp; initialShowers,</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                                       <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Cluster&gt;&gt; <span class="keyword">const</span>&amp; clusters,</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                                       art::FindManyP&lt;recob::Hit&gt; <span class="keyword">const</span>&amp; fmh)<span class="keyword"> const</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  std::vector&lt;int&gt; clustersToIgnore;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="comment">// Look at each shower</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> initialShowerIt = initialShowers.cbegin(); initialShowerIt != initialShowers.cend();</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;       ++initialShowerIt) {</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordflow">if</span> (std::distance(initialShowers.cbegin(), initialShowerIt) &gt; 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="comment">// Map the clusters and cluster hits to each view</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    std::map&lt;int, std::vector&lt;art::Ptr&lt;recob::Cluster&gt;&gt;&gt; planeClusters;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    std::map&lt;int, std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt; planeHits;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keyword">const</span> clusterIndex : *initialShowerIt) {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      art::Ptr&lt;recob::Cluster&gt; <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#afac1ac7b61385644c993fbb774a1922f">cluster</a> = clusters.at(clusterIndex);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      planeClusters[cluster-&gt;Plane().Plane].push_back(cluster);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : fmh.at(cluster.key()))</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        planeHits[<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;WireID().Plane].push_back(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    TFile* <a class="code" href="../../d1/d27/preparseGDML_8cpp.html#a91214e8e0e1bf4d60b1d72e9de27e51b">outFile</a> = <span class="keyword">new</span> TFile(<span class="stringliteral">&quot;chargeDistributions.root&quot;</span>, <span class="stringliteral">&quot;RECREATE&quot;</span>);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    std::map&lt;int, TH1D*&gt; chargeDist;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; [plane, clusterPtrs] : planeClusters) {</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; clusterPtr : clusterPtrs) {</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        chargeDist[plane] = <span class="keyword">new</span> TH1D(std::string(<span class="stringliteral">&quot;chargeDist_Plane&quot;</span> + <a class="code" href="../../dd/df6/namespaceicarus_1_1trigger.html#a7718dbf2e5e4aa346e7fbabaa451457f">std::to_string</a>(plane) +</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                                                 <span class="stringliteral">&quot;_Cluster&quot;</span> + <a class="code" href="../../dd/df6/namespaceicarus_1_1trigger.html#a7718dbf2e5e4aa346e7fbabaa451457f">std::to_string</a>(clusterPtr.key()))</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                                       .c_str(),</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                                     <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                                     150,</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                                     0,</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                                     1000);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="keyword">auto</span> <span class="keyword">const</span>&amp; hits = fmh.at(clusterPtr.key());</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : hits | <a class="code" href="../../d5/d45/namespaceicarus_1_1waveform__operations_1_1details.html#ae295d3f6cb2f9181dccdf0e3492d44e0">views::transform</a>(<a class="code" href="../../d7/d0b/namespacelar.html#ac7ad65c5dbecd0f69500e739fe324e82">to_element</a>)) {</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;          chargeDist[plane]-&gt;Fill(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.Integral());</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        }</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        outFile-&gt;cd();</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        chargeDist[plane]-&gt;Write();</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      }</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    }</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    outFile-&gt;Close();</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keyword">delete</span> <a class="code" href="../../d1/d27/preparseGDML_8cpp.html#a91214e8e0e1bf4d60b1d72e9de27e51b">outFile</a>;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="comment">// Can&#39;t do much with fewer than three views</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">if</span> (planeClusters.size() &lt; 3) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="comment">// Look at how many clusters each plane has, and the proportion of hits each one uses</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    std::map&lt;int, std::vector&lt;double&gt;&gt; planeClusterSizes;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">for</span> (std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Cluster&gt;&gt;&gt;::iterator planeClustersIt =</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;           planeClusters.begin();</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;         planeClustersIt != planeClusters.end();</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;         ++planeClustersIt) {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Cluster&gt;&gt;::iterator planeClusterIt =</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;             planeClustersIt-&gt;second.begin();</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;           planeClusterIt != planeClustersIt-&gt;second.end();</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;           ++planeClusterIt) {</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt; hits = fmh.at(planeClusterIt-&gt;key());</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        planeClusterSizes[planeClustersIt-&gt;first].push_back(</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;          (<span class="keywordtype">double</span>)hits.size() / (double)planeHits.at(planeClustersIt-&gt;first).size());</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      }</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    }</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="comment">// Find the average hit fraction across all clusters in the plane</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    std::map&lt;int, double&gt; planeClustersAvSizes;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; [plane, cluster_sizes] : planeClusterSizes) {</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> average = accumulate(cluster_sizes, 0.) / cluster_sizes.size();</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      planeClustersAvSizes[plane] = average;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="comment">// Now decide if there is one plane which is ruining the reconstruction</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="comment">// If two planes have a low average cluster fraction and one high, this plane likely merges two particle deposits together</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordtype">int</span> badPlane = -1;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span> [plane, avg] : planeClustersAvSizes) {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="comment">// Get averages from other planes and add in quadrature</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      std::vector&lt;double&gt; otherAverages;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span> [other_plane, other_avg] : planeClustersAvSizes)</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="keywordflow">if</span> (plane != other_plane) otherAverages.push_back(other_avg);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> sumSquareAvgsOtherPlanes = accumulate(</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        otherAverages, 0., [](<span class="keywordtype">double</span> sum, <span class="keywordtype">double</span> avg) { <span class="keywordflow">return</span> sum + cet::square(avg); });</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> quadOtherPlanes = std::sqrt(sumSquareAvgsOtherPlanes);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <span class="comment">// If this plane has an average higher than the quadratic sum of the</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <span class="comment">// others, it may be bad</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      <span class="keywordflow">if</span> (avg &gt;= quadOtherPlanes) badPlane = plane;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    }</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordflow">if</span> (badPlane != -1) {</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      <span class="keywordflow">if</span> (fDebug &gt; 1) <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Bad plane is &quot;</span> &lt;&lt; badPlane &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#afac1ac7b61385644c993fbb774a1922f">cluster</a> : planeClusters.at(badPlane))</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        clustersToIgnore.push_back(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#afac1ac7b61385644c993fbb774a1922f">cluster</a>.key());</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  }</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="keywordflow">return</span> clustersToIgnore;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;}</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;TVector3</div>
<div class="line"><a name="l00394"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a451c03e8d71ebc67678ca0dd9a18db46">  394</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a451c03e8d71ebc67678ca0dd9a18db46">shower::EMShowerAlg::Construct3DPoint_</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                                       art::Ptr&lt;recob::Hit&gt; <span class="keyword">const</span>&amp; hit1,</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                                       art::Ptr&lt;recob::Hit&gt; <span class="keyword">const</span>&amp; hit2)<span class="keyword"> const</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="comment">// x is average of the two x&#39;s</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a> = (detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a8e4b4b8d755ffded5a9f956ae7c9c1ec">ConvertTicksToX</a>(hit1-&gt;PeakTime(), hit1-&gt;WireID().planeID()) +</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;              detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a8e4b4b8d755ffded5a9f956ae7c9c1ec">ConvertTicksToX</a>(hit2-&gt;PeakTime(), hit2-&gt;WireID().planeID())) /</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;             (double)2;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <span class="comment">// y and z got from the wire interections</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  <a class="code" href="../../da/d3d/structgeo_1_1WireIDIntersection.html">geo::WireIDIntersection</a> intersection;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;WireIDsIntersect(hit1-&gt;WireID(), hit2-&gt;WireID(), intersection);</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keywordflow">return</span> TVector3(x, intersection.<a class="code" href="../../da/d3d/structgeo_1_1WireIDIntersection.html#a10d38a5448d172ff4c9879e0a349fbc3">y</a>, intersection.<a class="code" href="../../da/d3d/structgeo_1_1WireIDIntersection.html#a99e74ffcbcfd46cdb9754cde0a2019a1">z</a>);</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;}</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;std::unique_ptr&lt;recob::Track&gt;</div>
<div class="line"><a name="l00412"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#af61f93f824644f41da4ea9b91a20979d">  412</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#af61f93f824644f41da4ea9b91a20979d">shower::EMShowerAlg::ConstructTrack</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                                    <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt; <span class="keyword">const</span>&amp; hits1,</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                                    <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt; <span class="keyword">const</span>&amp; hits2,</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                                    std::map&lt;int, TVector2&gt; <span class="keyword">const</span>&amp; showerCentreMap)<span class="keyword"> const</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  std::unique_ptr&lt;recob::Track&gt; <a class="code" href="../../df/df2/standard__reco_8fcl.html#a8e7c4631bab825a68b0a82d8223c2ec2">track</a>;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt; track1, track2;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  <span class="comment">// Check the TPCs</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="keywordflow">if</span> ((*hits1.begin())-&gt;<a class="code" href="../../d2/d66/namespacegeo_1_1fhicl.html#a48509e22b6681725c899fc354de43ae2">WireID</a>().TPC != (*hits2.begin())-&gt;<a class="code" href="../../d2/d66/namespacegeo_1_1fhicl.html#a48509e22b6681725c899fc354de43ae2">WireID</a>().TPC) {</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    mf::LogWarning(<span class="stringliteral">&quot;EMShowerAlg&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Warning: attempting to construct a track from two different &quot;</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                                     <span class="stringliteral">&quot;TPCs.  Returning a null track.&quot;</span>;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../df/df2/standard__reco_8fcl.html#a8e7c4631bab825a68b0a82d8223c2ec2">track</a>;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  }</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="comment">// Check for tracks crossing TPC boundaries</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  std::map&lt;int, int&gt; tpcMap;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : hits1)</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    ++tpcMap[<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;WireID().TPC];</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : hits2)</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    ++tpcMap[<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;WireID().TPC];</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="keywordflow">if</span> (tpcMap.size() &gt; 1) {</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    mf::LogWarning(<span class="stringliteral">&quot;EMShowerAlg&quot;</span>)</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Warning: attempting to construct a track which crosses more than one TPC -- PMTrack &quot;</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;         <span class="stringliteral">&quot;can&#39;t handle this right now.  Returning a track made just from hits in the first TPC it &quot;</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;         <span class="stringliteral">&quot;traverses.&quot;</span>;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> firstTPC1 = hits1.at(0)-&gt;WireID().TPC, firstTPC2 = hits2.at(0)-&gt;WireID().TPC;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : hits1)</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;WireID().TPC == firstTPC1) track1.push_back(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>);</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : hits2)</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;WireID().TPC == firstTPC2) track2.push_back(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  }</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    track1 = hits1;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    track2 = hits2;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  }</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="keywordflow">if</span> (fDebug &gt; 1) {</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;About to make a track from these hits:\n&quot;</span>;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keyword">auto</span> print_hits = [<span class="keyword">this</span>](<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../df/df2/standard__reco_8fcl.html#a8e7c4631bab825a68b0a82d8223c2ec2">track</a>) {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : track | <a class="code" href="../../d5/d45/namespaceicarus_1_1waveform__operations_1_1details.html#ae295d3f6cb2f9181dccdf0e3492d44e0">views::transform</a>(<a class="code" href="../../d7/d0b/namespacelar.html#ac7ad65c5dbecd0f69500e739fe324e82">to_element</a>)) {</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Hit (&quot;</span> &lt;&lt; HitCoordinates_(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>).X() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; HitCoordinates_(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>).Y()</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;) (real wire &quot;</span> &lt;&lt; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.WireID().Wire &lt;&lt; <span class="stringliteral">&quot;) in TPC &quot;</span> &lt;&lt; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.WireID().TPC</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                  &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      }</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    };</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    print_hits(track1);</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    print_hits(track2);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  }</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  TVector3 trackStart = Construct3DPoint_(detProp, track1.at(0), track2.at(0));</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* pmatrack = fProjectionMatchingAlg.buildSegment(detProp, track1, track2, trackStart);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keywordflow">if</span> (!pmatrack) {</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    mf::LogInfo(<span class="stringliteral">&quot;EMShowerAlg&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Skipping this event because not enough hits in two views&quot;</span>;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../df/df2/standard__reco_8fcl.html#a8e7c4631bab825a68b0a82d8223c2ec2">track</a>;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  }</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  std::vector&lt;TVector3&gt; xyz, dircos;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; pmatrack-&gt;size(); i++) {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    xyz.push_back((*pmatrack)[i]-&gt;<a class="code" href="../../d1/d4e/namespacelar_1_1fhicl_1_1geo.html#aff5db21a0b87718dbf7debb3cd62dbd0">Point3D</a>());</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">if</span> (i &lt; pmatrack-&gt;<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() - 1) {</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      <span class="keywordtype">size_t</span> j = i + 1;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      <span class="keywordtype">double</span> mag = 0.0;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      TVector3 dc(0., 0., 0.);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <span class="keywordflow">while</span> ((mag == 0.0) <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a> (j &lt; pmatrack-&gt;<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>())) {</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        dc = (*pmatrack)[j]-&gt;Point3D();</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        dc -= (*pmatrack)[i]-&gt;Point3D();</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        mag = dc.Mag();</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        ++j;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      }</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      <span class="keywordflow">if</span> (mag &gt; 0.0)</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        dc *= 1.0 / mag;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!dircos.empty())</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        dc = dircos.back();</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      dircos.push_back(dc);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    }</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      dircos.push_back(dircos.back());</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  }</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="comment">// Orient the track correctly</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  std::map&lt;int, double&gt; distanceToVertex, distanceToEnd;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  TVector3 <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#a2e91c077dea2ff30aae790c67de81ea2">vertex</a> = *xyz.begin(), <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> = *xyz.rbegin();</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="comment">// Loop over all the planes and find the distance from the vertex and end</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <span class="comment">// projections to the centre in each plane</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="keywordflow">for</span> (std::map&lt;int, TVector2&gt;::const_iterator showerCentreIt = showerCentreMap.begin();</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;       showerCentreIt != showerCentreMap.end();</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;       ++showerCentreIt) {</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="comment">// Project the vertex and the end point onto this plane</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    TVector2 vertexProj = Project3DPointOntoPlane_(detProp, vertex, showerCentreIt-&gt;first);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    TVector2 endProj = Project3DPointOntoPlane_(detProp, <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>, showerCentreIt-&gt;first);</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="comment">// Find the distance of each to the centre of the cluster</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    distanceToVertex[showerCentreIt-&gt;first] = (vertexProj - showerCentreIt-&gt;second).Mod();</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    distanceToEnd[showerCentreIt-&gt;first] = (endProj - showerCentreIt-&gt;second).Mod();</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="comment">// Find the average distance to the vertex and the end across the planes</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <span class="keywordtype">double</span> avDistanceToVertex = 0, avDistanceToEnd = 0;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <span class="keywordflow">for</span> (std::map&lt;int, double&gt;::iterator distanceToVertexIt = distanceToVertex.begin();</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;       distanceToVertexIt != distanceToVertex.end();</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;       ++distanceToVertexIt)</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    avDistanceToVertex += distanceToVertexIt-&gt;second;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  avDistanceToVertex /= distanceToVertex.size();</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keywordflow">for</span> (std::map&lt;int, double&gt;::iterator distanceToEndIt = distanceToEnd.begin();</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;       distanceToEndIt != distanceToEnd.end();</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;       ++distanceToEndIt)</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    avDistanceToEnd += distanceToEndIt-&gt;second;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <a class="code" href="../../de/d71/neoSmazza_8sh.html#ae55989c903f0c76190facfb5e5211732">if</a> (distanceToEnd.size() != 0) avDistanceToEnd /= distanceToEnd.size();</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="keywordflow">if</span> (fDebug &gt; 2)</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Distance to vertex is &quot;</span> &lt;&lt; avDistanceToVertex &lt;&lt; <span class="stringliteral">&quot; and distance to end is &quot;</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;              &lt;&lt; avDistanceToEnd &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <span class="comment">// Change order if necessary</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <span class="keywordflow">if</span> (avDistanceToEnd &gt; avDistanceToVertex) {</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    std::reverse(xyz.begin(), xyz.end());</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <a class="code" href="../../d5/d45/namespaceicarus_1_1waveform__operations_1_1details.html#ae295d3f6cb2f9181dccdf0e3492d44e0">std::transform</a>(</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      dircos.begin(), dircos.end(), dircos.begin(), [](TVector3 <span class="keyword">const</span>&amp; vec) { <span class="keywordflow">return</span> -1 * vec; });</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  }</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="keywordflow">if</span> (xyz.size() != dircos.size())</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    mf::LogError(<span class="stringliteral">&quot;EMShowerAlg&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Problem converting pma::Track3D to recob::Track&quot;</span>;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  track = std::make_unique&lt;recob::Track&gt;(</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html">recob::TrackTrajectory</a>(<a class="code" href="../../d6/d6b/namespacerecob_1_1tracking.html#a2253bf96e69f939f133551c86bdd2e37">recob::tracking::convertCollToPoint</a>(xyz),</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                           <a class="code" href="../../d6/d6b/namespacerecob_1_1tracking.html#a159ae849126aae38dcc0675e448c0727">recob::tracking::convertCollToVector</a>(dircos),</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                           <a class="code" href="../../d9/dca/classrecob_1_1Track.html#a79f1b57342d70962685e749753d76ad1">recob::Track::Flags_t</a>(xyz.size()),</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                           <span class="keyword">false</span>),</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    0,</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    -1.,</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    0,</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <a class="code" href="../../d6/d6b/namespacerecob_1_1tracking.html#aedd77b5ebb70d48a9b4673b8efcbc32e">recob::tracking::SMatrixSym55</a>(),</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <a class="code" href="../../d6/d6b/namespacerecob_1_1tracking.html#aedd77b5ebb70d48a9b4673b8efcbc32e">recob::tracking::SMatrixSym55</a>(),</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    -1);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../df/df2/standard__reco_8fcl.html#a8e7c4631bab825a68b0a82d8223c2ec2">track</a>;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;}</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;std::unique_ptr&lt;recob::Track&gt;</div>
<div class="line"><a name="l00561"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a1d1ec984275554a287ad7b86e80ff325">  561</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#af61f93f824644f41da4ea9b91a20979d">shower::EMShowerAlg::ConstructTrack</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                                    <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt; <span class="keyword">const</span>&amp; track1,</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                                    <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt; <span class="keyword">const</span>&amp; track2)<span class="keyword"> const</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  std::map&lt;int, TVector2&gt; showerCentreMap;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="keywordflow">return</span> ConstructTrack(detProp, track1, track2, showerCentreMap);</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;}</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="keywordtype">double</span></div>
<div class="line"><a name="l00570"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a3cae4d7c9ab3440dadfee1638a60f583">  570</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a3cae4d7c9ab3440dadfee1638a60f583">shower::EMShowerAlg::FinddEdx_</a>(<a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html">detinfo::DetectorClocksData</a> <span class="keyword">const</span>&amp; clockData,</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                               <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                               <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt; <span class="keyword">const</span>&amp; trackHits,</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                               std::unique_ptr&lt;recob::Track&gt; <span class="keyword">const</span>&amp; <a class="code" href="../../df/df2/standard__reco_8fcl.html#a8e7c4631bab825a68b0a82d8223c2ec2">track</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  assert(not <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#a74da18d4f0023feee71c1352a99b3910">empty</a>(trackHits));</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <span class="keywordflow">if</span> (!track) <span class="keywordflow">return</span> -999;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <a class="code" href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a> <span class="keyword">const</span>&amp; firstHit = *trackHits.front();</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <span class="comment">// Get the pitch</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="keywordtype">double</span> pitch = 0;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    pitch = <a class="code" href="../../d9/d3d/namespacelar_1_1util.html#a6788fc3784bdf9eff832087f034412bb">lar::util::TrackPitchInView</a>(*track, firstHit.<a class="code" href="../../db/d4e/classrecob_1_1Hit.html#a025b7a27fcb52523170cf0e0b2ab5c03">View</a>());</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  }</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  }</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  <span class="comment">// Deal with large pitches</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  <span class="keywordflow">if</span> (pitch &gt; fdEdxTrackLength) {</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">return</span> fCalorimetryAlg.dEdx_AREA(clockData, detProp, firstHit, pitch);</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  }</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  <span class="keywordtype">double</span> totalCharge = 0, totalDistance = 0, avHitTime = 0;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nHits = 0;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : trackHits | <a class="code" href="../../d5/d45/namespaceicarus_1_1waveform__operations_1_1details.html#ae295d3f6cb2f9181dccdf0e3492d44e0">views::transform</a>(<a class="code" href="../../d7/d0b/namespacelar.html#ac7ad65c5dbecd0f69500e739fe324e82">to_element</a>)) {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordflow">if</span> (totalDistance + pitch &lt; fdEdxTrackLength) {</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      totalDistance += pitch;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      totalCharge += <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.Integral();</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      avHitTime += <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.PeakTime();</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      ++nHits;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    }</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  }</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  avHitTime /= (double)nHits;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="keywordtype">double</span> <span class="keyword">const</span> dQdx = totalCharge / totalDistance;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <span class="keywordflow">return</span> fCalorimetryAlg.dEdx_AREA(clockData, detProp, dQdx, avHitTime, firstHit.<a class="code" href="../../db/d4e/classrecob_1_1Hit.html#ac490abcf98854d93cf2fa85eadf4d469">WireID</a>().<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;}</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00612"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#adcd7fc39cb4df63607c7aae53f0a2789">  612</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#adcd7fc39cb4df63607c7aae53f0a2789">shower::EMShowerAlg::FindInitialTrack</a>(</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  <span class="keyword">const</span> std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt;&amp; showerHitsMap,</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  std::unique_ptr&lt;recob::Track&gt;&amp; initialTrack,</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt;&amp; initialTrackHits,</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  <span class="keywordtype">int</span> plane)<span class="keyword"> const</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment">  /// Finding the initial track requires three stages:</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment">  ///  -- find the initial track-like hits in each view</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">  ///  -- use these to construct a track</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  <span class="comment">// Now find the hits belonging to the track</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="keywordflow">if</span> (fDebug &gt; 1)</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot; ------------------ Finding initial track hits &quot;</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                 <span class="stringliteral">&quot;-------------------- \n&quot;</span>;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  initialTrackHits = FindShowerStart_(showerHitsMap);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="keywordflow">if</span> (fDebug &gt; 1) {</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Here are the initial shower hits... \n&quot;</span>;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; [plane, hitPtrs] : initialTrackHits) {</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;  Plane &quot;</span> &lt;&lt; plane &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : hitPtrs | <a class="code" href="../../d5/d45/namespaceicarus_1_1waveform__operations_1_1details.html#ae295d3f6cb2f9181dccdf0e3492d44e0">views::transform</a>(<a class="code" href="../../d7/d0b/namespacelar.html#ac7ad65c5dbecd0f69500e739fe324e82">to_element</a>)) {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;    Hit is (&quot;</span> &lt;&lt; HitCoordinates_(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>).X() &lt;&lt; <span class="stringliteral">&quot; (real hit &quot;</span> &lt;&lt; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.WireID()</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;), &quot;</span> &lt;&lt; HitCoordinates_(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>).Y() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      }</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  }</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="keywordflow">if</span> (fDebug &gt; 1)</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot; ------------------ End finding initial track hits &quot;</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                 <span class="stringliteral">&quot;-------------------- \n&quot;</span>;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  <span class="comment">// Now we have the track hits -- can make a track!</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <span class="keywordflow">if</span> (fDebug &gt; 1) <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot; ------------------ Finding initial track -------------------- \n&quot;</span>;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  initialTrack = MakeInitialTrack_(detProp, initialTrackHits, showerHitsMap);</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <span class="keywordflow">if</span> (initialTrack <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a> fDebug &gt; 1) {</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;The track start is (&quot;</span> &lt;&lt; initialTrack-&gt;<a class="code" href="../../d9/dca/classrecob_1_1Track.html#af3d605dc3abfa9dfc98923bb584beb08">Vertex</a>().X() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;              &lt;&lt; initialTrack-&gt;<a class="code" href="../../d9/dca/classrecob_1_1Track.html#af3d605dc3abfa9dfc98923bb584beb08">Vertex</a>().Y() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; initialTrack-&gt;<a class="code" href="../../d9/dca/classrecob_1_1Track.html#af3d605dc3abfa9dfc98923bb584beb08">Vertex</a>().Z() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;The track direction is (&quot;</span> &lt;&lt; initialTrack-&gt;<a class="code" href="../../d9/dca/classrecob_1_1Track.html#aa8edf54b2357ba4e9f19ff23a4880156">VertexDirection</a>().X() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;              &lt;&lt; initialTrack-&gt;<a class="code" href="../../d9/dca/classrecob_1_1Track.html#aa8edf54b2357ba4e9f19ff23a4880156">VertexDirection</a>().Y() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; initialTrack-&gt;<a class="code" href="../../d9/dca/classrecob_1_1Track.html#aa8edf54b2357ba4e9f19ff23a4880156">VertexDirection</a>().Z()</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  }</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="keywordflow">if</span> (fDebug &gt; 1)</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot; ------------------ End finding initial track &quot;</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                 <span class="stringliteral">&quot;-------------------- \n&quot;</span>;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;}</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt;</div>
<div class="line"><a name="l00659"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a8ef060a8aad9418d7034b06bbc47b675">  659</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a8ef060a8aad9418d7034b06bbc47b675">shower::EMShowerAlg::FindOrderOfHits_</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                                      <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt; <span class="keyword">const</span>&amp; hits,</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                                      <span class="keywordtype">bool</span> perpendicular)<span class="keyword"> const</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="comment">// Find the charge-weighted centre (in [cm]) of this shower</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  TVector2 centre = ShowerCenter_(detProp, hits);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <span class="comment">// Find a rough shower &#39;direction&#39;</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  TVector2 direction = ShowerDirection_(detProp, hits);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  <span class="keywordflow">if</span> (perpendicular) direction = direction.Rotate(TMath::Pi() / 2);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <span class="comment">// Find how far each hit (projected onto this axis) is from the centre</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  TVector2 pos;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  std::map&lt;double, art::Ptr&lt;recob::Hit&gt;&gt; hitProjection;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; hitPtr : hits) {</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    pos = HitPosition_(detProp, *hitPtr) - centre;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    hitProjection[direction * pos] = hitPtr;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  }</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <span class="comment">// Get a vector of hits in order of the shower</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt; showerHits;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  cet::transform_all(</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    hitProjection, std::back_inserter(showerHits), [](<span class="keyword">auto</span> <span class="keyword">const</span>&amp; pr) { <span class="keywordflow">return</span> pr.second; });</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="comment">// Make gradient plot</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="keywordflow">if</span> (fMakeGradientPlot) {</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    std::map&lt;int, TGraph*&gt; graphs;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : showerHits | <a class="code" href="../../d5/d45/namespaceicarus_1_1waveform__operations_1_1details.html#ae295d3f6cb2f9181dccdf0e3492d44e0">views::transform</a>(<a class="code" href="../../d7/d0b/namespacelar.html#ac7ad65c5dbecd0f69500e739fe324e82">to_element</a>)) {</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      <span class="keywordtype">int</span> tpc = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.WireID().TPC;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      <span class="keywordflow">if</span> (graphs[tpc] == <span class="keyword">nullptr</span>) graphs[tpc] = <span class="keyword">new</span> TGraph();</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      graphs[tpc]-&gt;SetPoint(</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        graphs[tpc]-&gt;GetN(), HitPosition_(detProp, <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>).<a class="code" href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a>(), HitPosition_(detProp, <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>).Y());</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    }</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    TMultiGraph* multigraph = <span class="keyword">new</span> TMultiGraph();</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span> [color, graph] : graphs) {</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;      graph-&gt;SetMarkerColor(color);</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      graph-&gt;SetMarkerStyle(8);</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      graph-&gt;SetMarkerSize(2);</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      multigraph-&gt;Add(graph);</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    }</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    TCanvas* canvas = <span class="keyword">new</span> TCanvas();</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    multigraph-&gt;Draw(<span class="stringliteral">&quot;AP&quot;</span>);</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    TLine line;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    line.SetLineColor(2);</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    line.DrawLine(centre.X() - 1000 * direction.X(),</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                  centre.Y() - 1000 * direction.Y(),</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                  centre.X() + 1000 * direction.X(),</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                  centre.Y() + 1000 * direction.Y());</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    canvas-&gt;SaveAs(<span class="stringliteral">&quot;Gradient.png&quot;</span>);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keyword">delete</span> canvas;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="keyword">delete</span> multigraph;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  }</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="keywordflow">return</span> showerHits;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;}</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;std::vector&lt;std::vector&lt;int&gt;&gt;</div>
<div class="line"><a name="l00717"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a0ea322f15b62c1a0b9d8342745c7b251">  717</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a0ea322f15b62c1a0b9d8342745c7b251">shower::EMShowerAlg::FindShowers</a>(std::map&lt;<span class="keywordtype">int</span>, std::vector&lt;int&gt;&gt; <span class="keyword">const</span>&amp; trackToClusters)<span class="keyword"> const</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  <span class="comment">// Showers are vectors of clusters</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  std::vector&lt;std::vector&lt;int&gt;&gt; showers;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="comment">// Loop over all tracks</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; clusters : trackToClusters | <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#a5db4217e69ac7c2d95856da42b13f8e5">views::values</a>) {</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="comment">// Find which showers already made are associated with this track</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    std::vector&lt;int&gt; matchingShowers;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#ad36c739018def8e4e44032f4cf395c9d">shower</a> = 0; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#ad36c739018def8e4e44032f4cf395c9d">shower</a> &lt; showers.size(); ++<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#ad36c739018def8e4e44032f4cf395c9d">shower</a>)</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keyword">const</span> <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#afac1ac7b61385644c993fbb774a1922f">cluster</a> : clusters) {</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        <span class="keywordflow">if</span> (cet::search_all(showers[<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#ad36c739018def8e4e44032f4cf395c9d">shower</a>], <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#afac1ac7b61385644c993fbb774a1922f">cluster</a>) <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            not cet::search_all(matchingShowers, shower)) {</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;          matchingShowers.push_back(shower);</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        }</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      }</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <span class="comment">// THINK THERE PROBABLY CAN BE MORE THAN ONE!</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="comment">// IN FACT, THIS WOULD BE A SUCCESS OF THE SHOWERING METHOD!</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="comment">// // Shouldn&#39;t be more than one</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <span class="comment">// if (matchingShowers.size() &gt; 1)</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="comment">//   mf::LogInfo(&quot;EMShowerAlg&quot;) &lt;&lt; &quot;Number of showers this track matches is &quot; &lt;&lt; matchingShowers.size() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="comment">// New shower</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <span class="keywordflow">if</span> (matchingShowers.size() &lt; 1) showers.push_back(clusters);</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="comment">// Add to existing shower</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keyword">const</span> <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#afac1ac7b61385644c993fbb774a1922f">cluster</a> : clusters) {</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        <span class="keywordflow">if</span> (not cet::search_all(showers.at(matchingShowers[0]), <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#afac1ac7b61385644c993fbb774a1922f">cluster</a>))</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;          showers.at(matchingShowers.at(0)).push_back(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#afac1ac7b61385644c993fbb774a1922f">cluster</a>);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      }</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    }</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  }</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="keywordflow">return</span> showers;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;}</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;std::map&lt;int, std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt;</div>
<div class="line"><a name="l00757"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a23d09637ff2c64a1f60c936a665ac90a">  757</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a23d09637ff2c64a1f60c936a665ac90a">shower::EMShowerAlg::FindShowerStart_</a>(</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt; <span class="keyword">const</span>&amp; orderedShowerMap)<span class="keyword"> const</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  std::map&lt;int, std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt; initialHitsMap;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; [plane, orderedShower] : orderedShowerMap) {</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt; initialHits;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="comment">// Find if the shower is traveling along ticks or wires</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordtype">bool</span> wireDirection = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    std::vector&lt;int&gt; wires;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : orderedShower | <a class="code" href="../../d5/d45/namespaceicarus_1_1waveform__operations_1_1details.html#ae295d3f6cb2f9181dccdf0e3492d44e0">views::transform</a>(<a class="code" href="../../d7/d0b/namespacelar.html#ac7ad65c5dbecd0f69500e739fe324e82">to_element</a>))</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;      wires.push_back(std::round(HitCoordinates_(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>).<a class="code" href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a>()));</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    cet::sort_all(wires);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(*wires.begin() - std::round(HitCoordinates_(**orderedShower.begin()).<a class="code" href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a>())) &gt; 3 <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(*wires.rbegin() - std::round(HitCoordinates_(**orderedShower.begin()).<a class="code" href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a>())) &gt; 3)</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      wireDirection = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="comment">// Deal with showers traveling along wires</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keywordflow">if</span> (wireDirection) {</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      <span class="keywordtype">bool</span> increasing = HitCoordinates_(**orderedShower.rbegin()).<a class="code" href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a>() &gt;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                        HitCoordinates_(**orderedShower.begin()).<a class="code" href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a>();</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      std::map&lt;int, std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt; wireHitMap;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      <span class="keywordtype">int</span> multipleWires = 0;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; hitPtr : orderedShower)</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        wireHitMap[std::round(HitCoordinates_(*hitPtr).X())].push_back(hitPtr);</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; hitPtr : orderedShower) {</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="keywordtype">int</span> wire = std::round(HitCoordinates_(*hitPtr).X());</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        <span class="keywordflow">if</span> (wireHitMap[wire].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() &gt; 1) {</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;          ++multipleWires;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;          <span class="keywordflow">if</span> (multipleWires &gt; 5) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        }</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((increasing <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a> wireHitMap[wire + 1].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() &gt; 1 <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                  (wireHitMap[wire + 2].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() &gt; 1 or wireHitMap[wire + 3].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() &gt; 1)) or</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                 (!increasing <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a> wireHitMap[wire - 1].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() &gt; 1 <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                  (wireHitMap[wire - 2].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() &gt; 1 or wireHitMap[wire - 3].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() &gt; 1))) {</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;          <span class="keywordflow">if</span> ((increasing <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;               (wireHitMap[wire + 4].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() &lt; 2 <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a> wireHitMap[wire + 5].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() &lt; 2 <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                wireHitMap[wire + 6].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() &lt; 2 <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a> wireHitMap[wire + 9].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() &gt; 1)) or</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;              (!increasing <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;               (wireHitMap[wire - 4].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() &lt; 2 <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a> wireHitMap[wire - 5].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() &lt; 2 <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                wireHitMap[wire - 6].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() &lt; 2) <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;               wireHitMap[wire - 9].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() &gt; 1))</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            initialHits.push_back(hitPtr);</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        }</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;          initialHits.push_back(hitPtr);</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      }</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      <span class="keywordflow">if</span> (!initialHits.size()) initialHits.push_back(*orderedShower.begin());</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    }</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="comment">// Deal with showers travelling along ticks</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      <span class="keywordtype">bool</span> increasing = HitCoordinates_(**orderedShower.rbegin()).Y() &gt;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                        HitCoordinates_(**orderedShower.begin()).Y();</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      std::map&lt;int, std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt; tickHitMap;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;::const_iterator hitIt = orderedShower.begin();</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;           hitIt != orderedShower.end();</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;           ++hitIt)</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        tickHitMap[std::round(HitCoordinates_(**hitIt).Y())].push_back(*hitIt);</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; hitPtr : orderedShower) {</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        <span class="keywordtype">int</span> <span class="keyword">const</span> <a class="code" href="../../d3/d63/namespaceutil_1_1quantities.html#a1a08bc762b79d6e1d7816c34d3e36f78">tick</a> = std::round(HitCoordinates_(*hitPtr).Y());</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        <span class="keywordflow">if</span> ((increasing <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a> (tickHitMap[tick + 1].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() or tickHitMap[tick + 2].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() or</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                             tickHitMap[tick + 3].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() or tickHitMap[tick + 4].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() or</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                             tickHitMap[tick + 5].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>())) or</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;            (!increasing <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a> (tickHitMap[tick - 1].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() or tickHitMap[tick - 2].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() or</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                              tickHitMap[tick - 3].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() or tickHitMap[tick - 4].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() or</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                              tickHitMap[tick - 5].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>())))</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;          initialHits.push_back(hitPtr);</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      }</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;      <span class="keywordflow">if</span> (initialHits.empty()) initialHits.push_back(*orderedShower.begin());</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    }</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="comment">// Need at least two hits to make a track</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="keywordflow">if</span> (initialHits.size() == 1 <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a> orderedShower.size() &gt; 2)</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      initialHits.push_back(orderedShower[1]);</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="comment">// Quality check -- make sure there isn&#39;t a single hit in a different TPC (artefact of tracking failure)</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt; newInitialHits;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    std::map&lt;int, int&gt; tpcHitMap;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    std::vector&lt;int&gt; singleHitTPCs;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : initialHits | <a class="code" href="../../d5/d45/namespaceicarus_1_1waveform__operations_1_1details.html#ae295d3f6cb2f9181dccdf0e3492d44e0">views::transform</a>(<a class="code" href="../../d7/d0b/namespacelar.html#ac7ad65c5dbecd0f69500e739fe324e82">to_element</a>))</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;      ++tpcHitMap[<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.WireID().TPC];</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span> [tpc, <a class="code" href="../../db/df5/IntegerRanges__test_8cc.html#abbc7e5f346bfa932ca51b4b07ccef76d">count</a>] : tpcHitMap)</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/df5/IntegerRanges__test_8cc.html#abbc7e5f346bfa932ca51b4b07ccef76d">count</a> == 1) singleHitTPCs.push_back(tpc);</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <span class="keywordflow">if</span> (singleHitTPCs.size()) {</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      <span class="keywordflow">if</span> (fDebug &gt; 2)</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keyword">const</span> tpc : singleHitTPCs)</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;          <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Removed hits in TPC &quot;</span> &lt;&lt; tpc &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; hitPtr : initialHits)</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        <span class="keywordflow">if</span> (not cet::search_all(singleHitTPCs, hitPtr-&gt;WireID().TPC))</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;          newInitialHits.push_back(hitPtr);</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      <span class="keywordflow">if</span> (!newInitialHits.size()) newInitialHits.push_back(*orderedShower.begin());</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    }</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      newInitialHits = initialHits;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    initialHitsMap[plane] = newInitialHits;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  }</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <span class="keywordflow">return</span> initialHitsMap;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;}</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;std::map&lt;int, std::map&lt;int, bool&gt;&gt;</div>
<div class="line"><a name="l00873"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a917c47a83913694099c85868a314cda0">  873</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a917c47a83913694099c85868a314cda0">shower::EMShowerAlg::GetPlanePermutations_</a>(</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="keyword">const</span> std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt;&amp; showerHitsMap)<span class="keyword"> const</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  <span class="comment">// The map to return</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  std::map&lt;int, std::map&lt;int, bool&gt;&gt; permutations;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  <span class="comment">// Get the properties of the shower hits across the planes which will be used to</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <span class="comment">// determine the likelihood of a particular reorientation permutation</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  <span class="comment">//   -- relative width in the wire direction (if showers travel along the wire</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="comment">//      direction in a particular plane)</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="comment">//   -- the RMS gradients (how likely it is the RMS of the hit positions from</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="comment">//      central axis increases along a particular orientation)</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="comment">// Find the RMS, RMS gradient and wire widths</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  std::map&lt;int, double&gt; planeRMSGradients, planeRMS;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; [plane, hitPtrs] : showerHitsMap) {</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    planeRMS[plane] = ShowerHitRMS_(detProp, hitPtrs);</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    planeRMSGradients[plane] = ShowerHitRMSGradient_(detProp, hitPtrs);</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  }</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  <span class="comment">// Order these backwards so they can be used to discriminate between planes</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  std::map&lt;double, int&gt; gradientMap;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keyword">const</span> plane : showerHitsMap | views::keys)</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    gradientMap[<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(planeRMSGradients.at(plane))] = plane;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  std::map&lt;double, int&gt; wireWidthMap = RelativeWireWidth_(showerHitsMap);</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <span class="keywordflow">if</span> (fDebug &gt; 1)</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span> [gradient, plane] : wireWidthMap)</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Plane &quot;</span> &lt;&lt; plane &lt;&lt; <span class="stringliteral">&quot; has relative width in wire of &quot;</span> &lt;&lt; gradient</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;; and an RMS gradient of &quot;</span> &lt;&lt; planeRMSGradients[plane] &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  <span class="comment">// Find the correct permutations</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  <span class="keywordtype">int</span> perm = 0;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  std::vector&lt;std::map&lt;int, bool&gt;&gt; usedPermutations;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  <span class="comment">// Most likely is to not change anything</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keyword">const</span> plane : showerHitsMap | views::keys)</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    permutations[perm][plane] = 0;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  ++perm;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="comment">// Use properties of the shower to determine the middle cases</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keyword">const</span> plane : wireWidthMap | <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#a5db4217e69ac7c2d95856da42b13f8e5">views::values</a>) {</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    std::map&lt;int, bool&gt; permutation;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    permutation[plane] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keyword">const</span> plane2 : wireWidthMap | <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#a5db4217e69ac7c2d95856da42b13f8e5">views::values</a>)</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      <span class="keywordflow">if</span> (plane != plane2) permutation[plane2] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <span class="keywordflow">if</span> (not cet::search_all(usedPermutations, permutation)) {</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      permutations[perm] = permutation;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      usedPermutations.push_back(permutation);</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      ++perm;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    }</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  }</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keyword">const</span> plane : wireWidthMap | views::reverse | <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#a5db4217e69ac7c2d95856da42b13f8e5">views::values</a>) {</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    std::map&lt;int, bool&gt; permutation;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    permutation[plane] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keyword">const</span> plane2 : wireWidthMap | <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#a5db4217e69ac7c2d95856da42b13f8e5">views::values</a>)</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      <span class="keywordflow">if</span> (plane != plane2) permutation[plane2] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keywordflow">if</span> (not cet::search_all(usedPermutations, permutation)) {</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      permutations[perm] = permutation;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      usedPermutations.push_back(permutation);</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;      ++perm;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    }</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  }</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  <span class="comment">// Least likely is to change everything</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keyword">const</span> plane : showerHitsMap | views::keys)</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    permutations[perm][plane] = 1;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  ++perm;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="keywordflow">if</span> (fDebug &gt; 1) {</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Here are the permutations!\n&quot;</span>;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; [index, permutation] : permutations) {</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;      <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Permutation &quot;</span> &lt;&lt; index &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span> [plane, <a class="code" href="../../da/d36/pmtsimulation__icarus_8fcl.html#a9fc569190f32b40862f18ac3c03a8e49">value</a>] : permutation)</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;  Plane &quot;</span> &lt;&lt; plane &lt;&lt; <span class="stringliteral">&quot; has value &quot;</span> &lt;&lt; <a class="code" href="../../da/d36/pmtsimulation__icarus_8fcl.html#a9fc569190f32b40862f18ac3c03a8e49">value</a> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    }</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  }</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  <span class="keywordflow">return</span> permutations;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;}</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;std::unique_ptr&lt;recob::Track&gt;</div>
<div class="line"><a name="l00960"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a32ccb98410dcc3d6e259d36adb05aa6c">  960</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a32ccb98410dcc3d6e259d36adb05aa6c">shower::EMShowerAlg::MakeInitialTrack_</a>(</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt; <span class="keyword">const</span>&amp; initialHitsMap,</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt; <span class="keyword">const</span>&amp; showerHitsMap)<span class="keyword"> const</span></div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <span class="comment">// Can&#39;t do much with just one view</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordflow">if</span> (initialHitsMap.size() &lt; 2) {</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    mf::LogInfo(<span class="stringliteral">&quot;EMShowerAlg&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Only one useful view for this shower; nothing can be done\n&quot;</span>;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="keywordflow">return</span> std::unique_ptr&lt;recob::Track&gt;();</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  }</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  std::vector&lt;std::pair&lt;int, int&gt;&gt; initialHitsSize;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  <span class="keywordflow">for</span> (std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt;::const_iterator initialHitIt =</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;         initialHitsMap.begin();</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;       initialHitIt != initialHitsMap.end();</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;       ++initialHitIt)</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    initialHitsSize.push_back(std::make_pair(initialHitIt-&gt;first, initialHitIt-&gt;second.size()));</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  <span class="comment">// Sort the planes by number of hits</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  std::sort(initialHitsSize.begin(),</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;            initialHitsSize.end(),</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;            [](std::pair&lt;int, int&gt; <span class="keyword">const</span>&amp; size1, std::pair&lt;int, int&gt; <span class="keyword">const</span>&amp; size2) {</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;              <span class="keywordflow">return</span> size1.second &gt; size2.second;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;            });</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="comment">// Pick the two planes to use to make the track</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  <span class="comment">//   -- if more than two planes, can choose the two views</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <span class="comment">//      more accurately</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  <span class="comment">//   -- if not, just use the two views available</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  std::vector&lt;int&gt; <a class="code" href="../../d2/dbd/trackfinderalgorithms_8fcl.html#ac996980052e16111a1efc913778a5f5f">planes</a>;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  <span class="keywordflow">if</span> (initialHitsSize.size() &gt; 2 <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a> !CheckShowerHits_(detProp, showerHitsMap)) {</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="keywordtype">int</span> planeToIgnore = WorstPlane_(showerHitsMap);</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="keywordflow">if</span> (fDebug &gt; 1)</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Igoring plane &quot;</span> &lt;&lt; planeToIgnore &lt;&lt; <span class="stringliteral">&quot; in creation of initial track\n&quot;</span>;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;std::pair&lt;int, int&gt;&gt;::iterator hitsSizeIt = initialHitsSize.begin();</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;         hitsSizeIt != initialHitsSize.end() <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a> planes.size() &lt; 2;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;         ++hitsSizeIt) {</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      <span class="keywordflow">if</span> (hitsSizeIt-&gt;first == planeToIgnore) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      planes.push_back(hitsSizeIt-&gt;first);</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    }</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  }</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    planes = {initialHitsSize.at(0).first, initialHitsSize.at(1).first};</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <span class="keywordflow">return</span> ConstructTrack(detProp, initialHitsMap.at(planes.at(0)), initialHitsMap.at(planes.at(1)));</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;}</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<a class="code" href="../../d4/d14/classrecob_1_1Shower.html">recob::Shower</a></div>
<div class="line"><a name="l01010"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a31f278cbc6fd8523478331036ee805b5"> 1010</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a31f278cbc6fd8523478331036ee805b5">shower::EMShowerAlg::MakeShower</a>(</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html">detinfo::DetectorClocksData</a> <span class="keyword">const</span>&amp; clockData,</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  art::PtrVector&lt;recob::Hit&gt; <span class="keyword">const</span>&amp; hits,</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  std::unique_ptr&lt;recob::Track&gt; <span class="keyword">const</span>&amp; initialTrack,</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt; <span class="keyword">const</span>&amp; initialHitsMap)<span class="keyword"> const</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;  <span class="comment">// Find the shower hits on each plane</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;  std::map&lt;int, std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt; planeHitsMap;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; hitPtr : hits)</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    planeHitsMap[hitPtr-&gt;View()].push_back(hitPtr);</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  <span class="keywordtype">int</span> bestPlane = -1;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> highestNumberOfHits = 0;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  std::vector&lt;double&gt; totalEnergy, totalEnergyError, <a class="code" href="../../de/d0f/namespacetca.html#a03d7925cba1cd1c5952d280736887b6b">dEdx</a>, dEdxError;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <span class="comment">// Look at each of the planes</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> plane = 0; plane &lt; <a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;MaxPlanes(); ++plane) {</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    <span class="comment">// If there&#39;s hits on this plane...</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    <span class="keywordflow">if</span> (planeHitsMap.count(plane)) {</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      dEdx.push_back(FinddEdx_(clockData, detProp, initialHitsMap.at(plane), initialTrack));</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      totalEnergy.push_back(</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        fShowerEnergyAlg.ShowerEnergy(clockData, detProp, planeHitsMap.at(plane), plane));</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      <span class="keywordflow">if</span> (planeHitsMap.at(plane).size() &gt; highestNumberOfHits <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a> initialHitsMap.count(plane)) {</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        bestPlane = plane;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        highestNumberOfHits = planeHitsMap.at(plane).size();</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;      }</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    }</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    <span class="comment">// If not...</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      dEdx.push_back(0);</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;      totalEnergy.push_back(0);</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    }</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  }</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  TVector3 direction, directionError, showerStart, showerStartError;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <span class="keywordflow">if</span> (initialTrack) {</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    direction = initialTrack-&gt;<a class="code" href="../../d9/dca/classrecob_1_1Track.html#aa8edf54b2357ba4e9f19ff23a4880156">VertexDirection</a>&lt;TVector3&gt;();</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    showerStart = initialTrack-&gt;<a class="code" href="../../d9/dca/classrecob_1_1Track.html#af3d605dc3abfa9dfc98923bb584beb08">Vertex</a>&lt;TVector3&gt;();</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  }</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;  <span class="keywordflow">if</span> (fDebug &gt; 0) {</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Best plane is &quot;</span> &lt;&lt; bestPlane;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;\ndE/dx for each plane is: &quot;</span> &lt;&lt; dEdx[0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dEdx[1] &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; dEdx[2];</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;\nTotal energy for each plane is: &quot;</span> &lt;&lt; totalEnergy[0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; totalEnergy[1]</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; totalEnergy[2];</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;\nThe shower start is (&quot;</span> &lt;&lt; showerStart.X() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; showerStart.Y() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;              &lt;&lt; showerStart.Z() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;The shower direction is (&quot;</span> &lt;&lt; direction.X() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; direction.Y() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;              &lt;&lt; direction.Z() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  }</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d4/d14/classrecob_1_1Shower.html">recob::Shower</a>(direction,</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                       directionError,</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;                       showerStart,</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;                       showerStartError,</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;                       totalEnergy,</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;                       totalEnergyError,</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;                       dEdx,</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;                       dEdxError,</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;                       bestPlane);</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;}</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<a class="code" href="../../d4/d14/classrecob_1_1Shower.html">recob::Shower</a></div>
<div class="line"><a name="l01077"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#af3cb2f744c6c5ddd030609f1d5055e81"> 1077</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a31f278cbc6fd8523478331036ee805b5">shower::EMShowerAlg::MakeShower</a>(<a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html">detinfo::DetectorClocksData</a> <span class="keyword">const</span>&amp; clockData,</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;                                <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;                                art::PtrVector&lt;recob::Hit&gt; <span class="keyword">const</span>&amp; hits,</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;                                art::Ptr&lt;recob::Vertex&gt; <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#a2e91c077dea2ff30aae790c67de81ea2">vertex</a>,</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;                                <span class="keywordtype">int</span>&amp; iok)<span class="keyword"> const</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  iok = 1;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;  <span class="comment">// Find the shower hits on each plane</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  std::map&lt;int, std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt; planeHitsMap;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; hitPtr : hits)</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    planeHitsMap[hitPtr-&gt;WireID().Plane].push_back(hitPtr);</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  std::vector&lt;std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt; initialTrackHits(3);</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  <span class="keywordtype">int</span> pl0 = -1;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <span class="keywordtype">int</span> pl1 = -1;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  <span class="keywordtype">unsigned</span> maxhits0 = 0;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  <span class="keywordtype">unsigned</span> maxhits1 = 0;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  <span class="keywordflow">for</span> (std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt;::iterator planeHits = planeHitsMap.begin();</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;       planeHits != planeHitsMap.end();</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;       ++planeHits) {</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt; showerHits;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    OrderShowerHits_(detProp, planeHits-&gt;second, showerHits, vertex);</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    FindInitialTrackHits(showerHits, vertex, initialTrackHits[planeHits-&gt;first]);</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <span class="keywordflow">if</span> ((planeHits-&gt;second).size() &gt; maxhits0) {</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      <span class="keywordflow">if</span> (pl0 != -1) {</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        maxhits1 = maxhits0;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        pl1 = pl0;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      }</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      pl0 = planeHits-&gt;first;</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      maxhits0 = (planeHits-&gt;second).<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>();</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    }</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((planeHits-&gt;second).size() &gt; maxhits1) {</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      pl1 = planeHits-&gt;first;</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      maxhits1 = (planeHits-&gt;second).<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>();</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    }</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  }</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;  <span class="keywordflow">if</span> (pl0 != -1 &amp;&amp; pl1 != -1 &amp;&amp; initialTrackHits[pl0].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() &gt;= 2 &amp;&amp;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      initialTrackHits[pl1].size() &gt;= 2 &amp;&amp;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;      initialTrackHits[pl0][0]-&gt;WireID().TPC == initialTrackHits[pl1][0]-&gt;WireID().TPC) {</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <span class="keywordtype">double</span> xyz[3];</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    vertex-&gt;XYZ(xyz);</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    TVector3 vtx(xyz);</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* pmatrack =</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;      fProjectionMatchingAlg.buildSegment(detProp, initialTrackHits[pl0], initialTrackHits[pl1]);</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    std::vector&lt;TVector3&gt; spts;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; pmatrack-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a61676c8fb2963a14f6497d47b490296e">size</a>(); ++i) {</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      <span class="keywordflow">if</span> ((*pmatrack)[i]-&gt;IsEnabled()) {</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        TVector3 p3d = (*pmatrack)[i]-&gt;Point3D();</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        spts.push_back(p3d);</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;      }</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    }</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <span class="keywordflow">if</span> (spts.size() &gt;= 2) { <span class="comment">// at least two space points</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;      TVector3 shwxyz, shwxyzerr;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      TVector3 shwdir, shwdirerr;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;      std::vector&lt;double&gt; totalEnergy, totalEnergyError, <a class="code" href="../../de/d0f/namespacetca.html#a03d7925cba1cd1c5952d280736887b6b">dEdx</a>, dEdxError;</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;      <span class="keywordtype">int</span> bestPlane = pl0;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;      <span class="keywordtype">double</span> minpitch = 1000;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      std::vector&lt;TVector3&gt; dirs;</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;      <span class="keywordflow">if</span> ((spts[0] - vtx).Mag() &lt; (spts.back() - vtx).Mag()) {</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;        shwxyz = spts[0];</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        <span class="keywordtype">size_t</span> i = 5;</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        <span class="keywordflow">if</span> (spts.size() - 1 &lt; 5) i = spts.size() - 1;</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        shwdir = spts[i] - spts[0];</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;        shwdir = shwdir.Unit();</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      }</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        shwxyz = spts.back();</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        <span class="keywordtype">size_t</span> i = 0;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        <span class="keywordflow">if</span> (spts.size() &gt; 6) i = spts.size() - 6;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;        shwdir = spts[i] - spts[spts.size() - 1];</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        shwdir = shwdir.Unit();</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      }</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> plane = 0; plane &lt; <a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;MaxPlanes(); ++plane) {</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;        <span class="keywordflow">if</span> (planeHitsMap.find(plane) != planeHitsMap.end()) {</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;          totalEnergy.push_back(</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;            fShowerEnergyAlg.ShowerEnergy(clockData, detProp, planeHitsMap[plane], plane));</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;        }</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;          totalEnergy.push_back(0);</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        }</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        <span class="keywordflow">if</span> (initialTrackHits[plane].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>()) {</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;          <span class="keywordtype">double</span> fdEdx = 0;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;          <span class="keywordtype">double</span> totQ = 0;</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;          <span class="keywordtype">double</span> avgT = 0;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;          <span class="keywordtype">double</span> pitch = 0;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;          <span class="keywordtype">double</span> wirepitch = <a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;WirePitch(initialTrackHits[plane][0]-&gt;<a class="code" href="../../d2/d66/namespacegeo_1_1fhicl.html#a48509e22b6681725c899fc354de43ae2">WireID</a>().planeID());</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;          <span class="keywordtype">double</span> angleToVert =</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;            <a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;WireAngleToVertical(<a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;Plane(plane).View(),</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;                                       initialTrackHits[plane][0]-&gt;WireID().planeID()) -</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;            0.5 * TMath::Pi();</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;          <span class="keywordtype">double</span> cosgamma = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(sin(angleToVert) * shwdir.Y() + cos(angleToVert) * shwdir.Z());</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;          <span class="keywordflow">if</span> (cosgamma &gt; 0) pitch = wirepitch / cosgamma;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;          <span class="keywordflow">if</span> (pitch) {</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;            <span class="keywordflow">if</span> (pitch &lt; minpitch) {</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;              minpitch = pitch;</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;              bestPlane = plane;</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;            }</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;            <span class="keywordtype">int</span> nhits = 0;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;            std::vector&lt;float&gt; vQ;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : initialTrackHits[plane]) {</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;              <span class="keywordtype">int</span> w1 = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;WireID().Wire;</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;              <span class="keywordtype">int</span> w0 = initialTrackHits[plane][0]-&gt;WireID().Wire;</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;              <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>((w1 - w0) * pitch) &lt; fdEdxTrackLength) {</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;                vQ.push_back(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;Integral());</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                totQ += <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;Integral();</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;                avgT += <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;PeakTime();</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;                ++nhits;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;              }</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;            }</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;            <span class="keywordflow">if</span> (totQ) {</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;              <span class="keywordtype">double</span> dQdx = TMath::Median(vQ.size(), &amp;vQ[0]) / pitch;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;              fdEdx = fCalorimetryAlg.dEdx_AREA(</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;                clockData, detProp, dQdx, avgT / nhits, initialTrackHits[plane][0]-&gt;<a class="code" href="../../d2/d66/namespacegeo_1_1fhicl.html#a48509e22b6681725c899fc354de43ae2">WireID</a>().<a class="code" href="../../d6/d5e/rawdigitfilter__icarus_8fcl.html#aa2b9cfdf9a8f294302be0cdf6affea22">Plane</a>);</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;            }</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;          }</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;          dEdx.push_back(fdEdx);</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;        }</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;          dEdx.push_back(0);</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;        }</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;      }</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;      iok = 0;</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;      <span class="keywordflow">if</span> (fDebug &gt; 1) {</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Best plane is &quot;</span> &lt;&lt; bestPlane;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;\ndE/dx for each plane is: &quot;</span> &lt;&lt; dEdx[0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dEdx[1] &lt;&lt; <span class="stringliteral">&quot; and &quot;</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;                  &lt;&lt; dEdx[2];</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;\nTotal energy for each plane is: &quot;</span> &lt;&lt; totalEnergy[0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;                  &lt;&lt; totalEnergy[1] &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; totalEnergy[2];</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;\nThe shower start is (&quot;</span> &lt;&lt; shwxyz.X() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; shwxyz.Y() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;                  &lt;&lt; shwxyz.Z() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        shwxyz.Print();</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;      }</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d4/d14/classrecob_1_1Shower.html">recob::Shower</a>(shwdir,</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;                           shwdirerr,</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;                           shwxyz,</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;                           shwxyzerr,</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                           totalEnergy,</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;                           totalEnergyError,</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;                           dEdx,</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;                           dEdxError,</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;                           bestPlane);</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    }</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;  }</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d4/d14/classrecob_1_1Shower.html">recob::Shower</a>();</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;}</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;std::vector&lt;recob::SpacePoint&gt;</div>
<div class="line"><a name="l01230"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a5cca4cc475f14c8c2e709c5053457917"> 1230</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a5cca4cc475f14c8c2e709c5053457917">shower::EMShowerAlg::MakeSpacePoints</a>(</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt; <span class="keyword">const</span>&amp; showerHits,</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt;&amp; hitAssns)<span class="keyword"> const</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;  <span class="comment">// Space points to return</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  std::vector&lt;recob::SpacePoint&gt; spacePoints;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  <span class="comment">// Make space points</span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  <span class="comment">// Use the following procedure:</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  <span class="comment">//  -- Consider hits plane by plane</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;  <span class="comment">//  -- For each hit on the first plane, consider the 3D point made by combining with each hit from the second plane</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  <span class="comment">//  -- Project this 3D point back into the two planes</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="comment">//  -- Determine how close to a the original hits this point lies</span></div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  <span class="comment">//  -- If close enough, make a 3D space point from this point</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  <span class="comment">//  -- Discard these used hits in future iterations, along with hits in the</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  <span class="comment">//     third plane (if exists) close to the projection of the point into this</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  <span class="comment">//     plane</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;  <span class="comment">// Container to hold used hits</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  std::vector&lt;int&gt; usedHits;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;  <span class="comment">// Look through plane by plane</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  <span class="keywordflow">for</span> (std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt;::const_iterator showerHitIt =</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;         showerHits.begin();</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;       showerHitIt != showerHits.end();</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;       ++showerHitIt) {</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    <span class="comment">// Find the other planes with hits</span></div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    std::vector&lt;int&gt; otherPlanes;</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> otherPlane = 0; otherPlane &lt; <a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;MaxPlanes(); ++otherPlane)</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;      <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)otherPlane != showerHitIt-&gt;first <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a> showerHits.count(otherPlane))</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;        otherPlanes.push_back(otherPlane);</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    <span class="comment">// Can&#39;t make space points if we only have one view</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <span class="keywordflow">if</span> (otherPlanes.size() == 0) <span class="keywordflow">return</span> spacePoints;</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <span class="comment">// Look at all hits on this plane</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;::const_iterator planeHitIt = showerHitIt-&gt;second.begin();</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;         planeHitIt != showerHitIt-&gt;second.end();</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;         ++planeHitIt) {</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;      <span class="keywordflow">if</span> (std::find(usedHits.begin(), usedHits.end(), planeHitIt-&gt;key()) != usedHits.end())</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      <span class="comment">// Make a 3D point with every hit on the second plane</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;      <span class="keyword">const</span> std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt; otherPlaneHits = showerHits.at(otherPlanes.at(0));</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;::const_iterator otherPlaneHitIt =</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;             otherPlaneHits.begin();</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;           otherPlaneHitIt != otherPlaneHits.end() <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;           std::find(usedHits.begin(), usedHits.end(), planeHitIt-&gt;key()) == usedHits.end();</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;           ++otherPlaneHitIt) {</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;        <span class="keywordflow">if</span> ((*otherPlaneHitIt)-&gt;WireID().TPC != (*planeHitIt)-&gt;WireID().TPC or</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;            std::find(usedHits.begin(), usedHits.end(), otherPlaneHitIt-&gt;key()) != usedHits.end())</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;        TVector3 point = Construct3DPoint_(detProp, *planeHitIt, *otherPlaneHitIt);</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;        std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt; pointHits;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        <span class="keywordtype">bool</span> truePoint = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;        <span class="keywordflow">if</span> (otherPlanes.size() &gt; 1) {</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;          TVector2 projThirdPlane = Project3DPointOntoPlane_(detProp, point, otherPlanes.at(1));</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;          <span class="keyword">const</span> std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt; otherOtherPlaneHits =</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;            showerHits.at(otherPlanes.at(1));</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;::const_iterator otherOtherPlaneHitIt =</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;                 otherOtherPlaneHits.begin();</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;               otherOtherPlaneHitIt != otherOtherPlaneHits.end() <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a> !truePoint;</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;               ++otherOtherPlaneHitIt) {</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;            <span class="keywordflow">if</span> ((*otherOtherPlaneHitIt)-&gt;WireID().TPC == (*planeHitIt)-&gt;WireID().TPC <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;                (projThirdPlane - HitPosition_(detProp, **otherOtherPlaneHitIt)).Mod() &lt;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;                  fSpacePointSize) {</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;              truePoint = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;              <span class="comment">// Remove hits used to make the point</span></div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;              usedHits.push_back(planeHitIt-&gt;key());</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;              usedHits.push_back(otherPlaneHitIt-&gt;key());</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;              usedHits.push_back(otherOtherPlaneHitIt-&gt;key());</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;              pointHits.push_back(*planeHitIt);</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;              pointHits.push_back(*otherPlaneHitIt);</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;              pointHits.push_back(*otherOtherPlaneHitIt);</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;            }</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;          }</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;        }</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((Project3DPointOntoPlane_(detProp, point, (*planeHitIt)-&gt;WireID().Plane) -</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;                  HitPosition_(detProp, **planeHitIt))</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;                     .Mod() &lt; fSpacePointSize <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;                 (Project3DPointOntoPlane_(detProp, point, (*otherPlaneHitIt)-&gt;WireID().Plane) -</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;                  HitPosition_(detProp, **otherPlaneHitIt))</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;                     .Mod() &lt; fSpacePointSize) {</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;          truePoint = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;          usedHits.push_back(planeHitIt-&gt;key());</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;          usedHits.push_back(otherPlaneHitIt-&gt;key());</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;          pointHits.push_back(*planeHitIt);</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;          pointHits.push_back(*otherPlaneHitIt);</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;        }</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;        <span class="comment">// Make space point</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        <span class="keywordflow">if</span> (truePoint) {</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;          <span class="keywordtype">double</span> xyz[3] = {point.X(), point.Y(), point.Z()};</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;          <span class="keywordtype">double</span> xyzerr[6] = {fSpacePointSize,</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                              fSpacePointSize,</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;                              fSpacePointSize,</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;                              fSpacePointSize,</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;                              fSpacePointSize,</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;                              fSpacePointSize};</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;          <span class="keywordtype">double</span> chisq = 0.;</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;          spacePoints.emplace_back(xyz, xyzerr, chisq);</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;          hitAssns.push_back(pointHits);</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;        }</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;      } <span class="comment">// end loop over second plane hits</span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    } <span class="comment">// end loop over first plane hits</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;  } <span class="comment">// end loop over planes</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;  <span class="keywordflow">if</span> (fDebug &gt; 0) {</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;-------------------- Space points -------------------\n&quot;</span>;</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;There are &quot;</span> &lt;&lt; spacePoints.size() &lt;&lt; <span class="stringliteral">&quot; space points:\n&quot;</span>;</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    <span class="keywordflow">if</span> (fDebug &gt; 1)</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;      <span class="keywordflow">for</span> (std::vector&lt;recob::SpacePoint&gt;::const_iterator spacePointIt = spacePoints.begin();</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;           spacePointIt != spacePoints.end();</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;           ++spacePointIt) {</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span>* xyz = spacePointIt-&gt;XYZ();</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;  Space point (&quot;</span> &lt;&lt; xyz[0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; xyz[1] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; xyz[2] &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;      }</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;  }</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;  <span class="keywordflow">return</span> spacePoints;</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;}</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;std::map&lt;int, std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt;</div>
<div class="line"><a name="l01372"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a2f7c76aa2451e2ca9dc6a1fbe9ebc96e"> 1372</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a2f7c76aa2451e2ca9dc6a1fbe9ebc96e">shower::EMShowerAlg::OrderShowerHits</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;                                     art::PtrVector&lt;recob::Hit&gt; <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#ad36c739018def8e4e44032f4cf395c9d">shower</a>,</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;                                     <span class="keywordtype">int</span> desired_plane)<span class="keyword"> const</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="keyword"></span>{<span class="comment"></span></div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="comment">  /// Ordering the shower hits requires three stages:</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="comment">  ///  -- putting all the hits in a given plane in some kind of order</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;<span class="comment">  ///  -- use the properties of the hits in all three planes to check this order</span></div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;<span class="comment">  ///  -- orient the hits correctly using properties of the shower</span></div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  <span class="comment">// ------------- Put hits in order ------------</span></div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  <span class="comment">// Find the shower hits on each plane</span></div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  std::map&lt;int, std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt; showerHitsMap;</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; hitPtr : shower) {</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    showerHitsMap[hitPtr-&gt;WireID().Plane].push_back(hitPtr);</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;  }</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  <span class="comment">// Order the hits, get the RMS and the RMS gradient for the hits in this plane</span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;  std::map&lt;int, double&gt; planeRMSGradients, planeRMS;</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; [plane, hits] : showerHitsMap) {</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    <span class="keywordflow">if</span> (desired_plane != plane <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a> desired_plane != -1) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt; orderedHits = FindOrderOfHits_(detProp, hits);</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    planeRMS[plane] = ShowerHitRMS_(detProp, orderedHits);</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    planeRMSGradients[plane] = ShowerHitRMSGradient_(detProp, orderedHits);</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    showerHitsMap[plane] = orderedHits;</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;  }</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;  <span class="keywordflow">if</span> (fDebug &gt; 1) {</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span> [plane, shower_hit_rms] : planeRMS) {</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;      <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Plane &quot;</span> &lt;&lt; plane &lt;&lt; <span class="stringliteral">&quot; has RMS &quot;</span> &lt;&lt; shower_hit_rms &lt;&lt; <span class="stringliteral">&quot; and RMS gradient &quot;</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;                &lt;&lt; planeRMSGradients.at(plane) &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    }</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;  }</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  <span class="keywordflow">if</span> (fDebug &gt; 2) {</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;\nHits in order; after ordering, before reversing...\n&quot;</span>;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; [plane, hitPtrs] : showerHitsMap) {</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;      <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;  Plane &quot;</span> &lt;&lt; plane &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : hitPtrs | <a class="code" href="../../d5/d45/namespaceicarus_1_1waveform__operations_1_1details.html#ae295d3f6cb2f9181dccdf0e3492d44e0">views::transform</a>(<a class="code" href="../../d7/d0b/namespacelar.html#ac7ad65c5dbecd0f69500e739fe324e82">to_element</a>)) {</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;    Hit at (&quot;</span> &lt;&lt; HitCoordinates_(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>).X() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; HitCoordinates_(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>).Y()</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;) -- real wire &quot;</span> &lt;&lt; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.WireID() &lt;&lt; <span class="stringliteral">&quot;, hit position (&quot;</span></div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;                  &lt;&lt; HitPosition_(detProp, <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>).X() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; HitPosition_(detProp, <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>).Y()</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;      }</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    }</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  }</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;  <span class="comment">// ------------- Check between the views to ensure consistency of ordering -------------</span></div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  <span class="comment">// Check between the views to make sure there isn&#39;t a poorly formed shower in just one view</span></div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;  <span class="comment">// First, determine the average RMS and RMS gradient across the other planes</span></div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;  std::map&lt;int, double&gt; planeOtherRMS, planeOtherRMSGradients;</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;  <span class="keywordflow">for</span> (std::map&lt;int, double&gt;::iterator planeRMSIt = planeRMS.begin(); planeRMSIt != planeRMS.end();</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;       ++planeRMSIt) {</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    planeOtherRMS[planeRMSIt-&gt;first] = 0;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    planeOtherRMSGradients[planeRMSIt-&gt;first] = 0;</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    <span class="keywordtype">int</span> nOtherPlanes = 0;</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> plane = 0; plane &lt; (int)<a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;MaxPlanes(); ++plane) {</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;      <span class="keywordflow">if</span> (plane != planeRMSIt-&gt;first <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a> planeRMS.count(plane)) {</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;        planeOtherRMS[planeRMSIt-&gt;first] += planeRMS.at(plane);</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;        planeOtherRMSGradients[planeRMSIt-&gt;first] += planeRMSGradients.at(plane);</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;        ++nOtherPlanes;</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;      }</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    }</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    planeOtherRMS[planeRMSIt-&gt;first] /= (double)nOtherPlanes;</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    planeOtherRMSGradients[planeRMSIt-&gt;first] /= (double)nOtherPlanes;</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;  }</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  <span class="comment">// Look to see if one plane has a particularly high RMS (compared to the</span></div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  <span class="comment">// others) whilst having a similar gradient</span></div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; [plane, hitPtrs] : showerHitsMap) {</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    <span class="keywordflow">if</span> (planeRMS.at(plane) &gt; planeOtherRMS.at(plane) * 2) {</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;      <span class="keywordflow">if</span> (fDebug &gt; 1) <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Plane &quot;</span> &lt;&lt; plane &lt;&lt; <span class="stringliteral">&quot; was perpendicular... recalculating\n&quot;</span>;</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;      std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt; orderedHits =</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;        this-&gt;FindOrderOfHits_(detProp, hitPtrs, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;      showerHitsMap[plane] = orderedHits;</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;      planeRMSGradients[plane] = this-&gt;ShowerHitRMSGradient_(detProp, orderedHits);</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    }</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;  }</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;  <span class="comment">// ------------- Orient the shower correctly ---------------</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;  <span class="keywordflow">if</span> (fDebug &gt; 1) {</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Before reversing, here are the start and end points...\n&quot;</span>;</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; [plane, hitPtrs] : showerHitsMap) {</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;      <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;  Plane &quot;</span> &lt;&lt; plane &lt;&lt; <span class="stringliteral">&quot; has start (&quot;</span> &lt;&lt; HitCoordinates_(*hitPtrs.front()).<a class="code" href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a>()</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; HitCoordinates_(*hitPtrs.front()).Y() &lt;&lt; <span class="stringliteral">&quot;) (real wire &quot;</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;                &lt;&lt; hitPtrs.front()-&gt;WireID() &lt;&lt; <span class="stringliteral">&quot;) and end (&quot;</span></div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;                &lt;&lt; HitCoordinates_(*hitPtrs.back()).<a class="code" href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a>() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;                &lt;&lt; HitCoordinates_(*hitPtrs.back()).Y() &lt;&lt; <span class="stringliteral">&quot;) (real wire &quot;</span></div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;                &lt;&lt; hitPtrs.back()-&gt;WireID() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    }</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;  }</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  <span class="comment">// Use the RMS gradient information to get an initial ordering</span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;  <span class="keywordflow">for</span> (std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt;::iterator showerHitsIt =</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;         showerHitsMap.begin();</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;       showerHitsIt != showerHitsMap.end();</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;       ++showerHitsIt) {</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    <span class="keywordtype">double</span> gradient = planeRMSGradients.at(showerHitsIt-&gt;first);</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    <span class="keywordflow">if</span> (gradient &lt; 0) std::reverse(showerHitsIt-&gt;second.begin(), showerHitsIt-&gt;second.end());</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;  }</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;  <span class="keywordflow">if</span> (fDebug &gt; 2) {</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;\nHits in order; after reversing, before checking isolated hits...\n&quot;</span>;</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    <span class="keywordflow">for</span> (std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt;::iterator showerHitsIt =</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;           showerHitsMap.begin();</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;         showerHitsIt != showerHitsMap.end();</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;         ++showerHitsIt) {</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;      <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;  Plane &quot;</span> &lt;&lt; showerHitsIt-&gt;first &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;::iterator hitIt = showerHitsIt-&gt;second.begin();</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;           hitIt != showerHitsIt-&gt;second.end();</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;           ++hitIt)</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;    Hit at (&quot;</span> &lt;&lt; HitCoordinates_(**hitIt).X() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;                  &lt;&lt; HitCoordinates_(**hitIt).Y() &lt;&lt; <span class="stringliteral">&quot;) -- real wire &quot;</span> &lt;&lt; (*hitIt)-&gt;WireID()</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;, hit position (&quot;</span> &lt;&lt; HitPosition_(detProp, **hitIt).X() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;                  &lt;&lt; HitPosition_(detProp, **hitIt).Y() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    }</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;  }</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;  CheckIsolatedHits_(showerHitsMap);</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;  <span class="keywordflow">if</span> (fDebug &gt; 2) {</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;\nHits in order; after checking isolated hits...\n&quot;</span>;</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    <span class="keywordflow">for</span> (std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt;::iterator showerHitsIt =</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;           showerHitsMap.begin();</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;         showerHitsIt != showerHitsMap.end();</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;         ++showerHitsIt) {</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;      <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;  Plane &quot;</span> &lt;&lt; showerHitsIt-&gt;first &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;::iterator hitIt = showerHitsIt-&gt;second.begin();</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;           hitIt != showerHitsIt-&gt;second.end();</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;           ++hitIt)</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;    Hit at (&quot;</span> &lt;&lt; HitCoordinates_(**hitIt).X() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;                  &lt;&lt; HitCoordinates_(**hitIt).Y() &lt;&lt; <span class="stringliteral">&quot;) -- real wire &quot;</span> &lt;&lt; (*hitIt)-&gt;WireID()</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;, hit position (&quot;</span> &lt;&lt; HitPosition_(detProp, **hitIt).X() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;                  &lt;&lt; HitPosition_(detProp, **hitIt).Y() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    }</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;  }</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;  <span class="keywordflow">if</span> (fDebug &gt; 1) {</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;After reversing and checking isolated hits, here are the &quot;</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;                 <span class="stringliteral">&quot;start and end points...\n&quot;</span>;</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    <span class="keywordflow">for</span> (std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt;::iterator showerHitsIt =</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;           showerHitsMap.begin();</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;         showerHitsIt != showerHitsMap.end();</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;         ++showerHitsIt)</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;      <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;  Plane &quot;</span> &lt;&lt; showerHitsIt-&gt;first &lt;&lt; <span class="stringliteral">&quot; has start (&quot;</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;                &lt;&lt; HitCoordinates_(*showerHitsIt-&gt;second.front()).<a class="code" href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a>() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;                &lt;&lt; HitCoordinates_(*showerHitsIt-&gt;second.front()).Y() &lt;&lt; <span class="stringliteral">&quot;) (real wire &quot;</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;                &lt;&lt; showerHitsIt-&gt;second.front()-&gt;WireID() &lt;&lt; <span class="stringliteral">&quot;) and end (&quot;</span></div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;                &lt;&lt; HitCoordinates_(*showerHitsIt-&gt;second.back()).<a class="code" href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a>() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;                &lt;&lt; HitCoordinates_(*showerHitsIt-&gt;second.back()).Y() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;  }</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;  <span class="comment">// Check for views in which the shower travels almost along the wire planes</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;  <span class="comment">// (shown by a small relative wire width)</span></div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;  std::map&lt;double, int&gt; wireWidths = RelativeWireWidth_(showerHitsMap);</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;  std::vector&lt;int&gt; badPlanes;</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  <span class="keywordflow">if</span> (fDebug &gt; 1) <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Here are the relative wire widths... \n&quot;</span>;</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span> [relative_wire_width, plane] : wireWidths) {</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    <span class="keywordflow">if</span> (fDebug &gt; 1)</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;      <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Plane &quot;</span> &lt;&lt; plane &lt;&lt; <span class="stringliteral">&quot; has relative wire width &quot;</span> &lt;&lt; relative_wire_width &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    <span class="keywordflow">if</span> (relative_wire_width &lt; 1 / (<span class="keywordtype">double</span>)wireWidths.size()) badPlanes.push_back(plane);</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;  }</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;  std::map&lt;int, std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt; ignoredPlanes;</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  <span class="keywordflow">if</span> (badPlanes.size() == 1) {</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;    <span class="keywordtype">int</span> <span class="keyword">const</span> badPlane = badPlanes[0];</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;    <span class="keywordflow">if</span> (fDebug &gt; 1) <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Ignoring plane &quot;</span> &lt;&lt; badPlane &lt;&lt; <span class="stringliteral">&quot; when orientating\n&quot;</span>;</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    ignoredPlanes[badPlane] = showerHitsMap.at(badPlane);</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    showerHitsMap.erase(badPlane);</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;  }</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;  <span class="comment">// Consider all possible permutations of planes (0/1, oriented</span></div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;  <span class="comment">// correctly/incorrectly)</span></div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;  std::map&lt;int, std::map&lt;int, bool&gt;&gt; permutations = GetPlanePermutations_(detProp, showerHitsMap);</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;  <span class="comment">// Go through all permutations until we have a satisfactory orientation</span></div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;  <span class="keyword">auto</span> <span class="keyword">const</span> originalShowerHitsMap = showerHitsMap;</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> = 0;</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  <span class="keywordflow">while</span> (!CheckShowerHits_(detProp, showerHitsMap) <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a></div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;         n &lt; TMath::Power(2, (<span class="keywordtype">int</span>)showerHitsMap.size())) {</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    <span class="keywordflow">if</span> (fDebug &gt; 1) <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Permutation &quot;</span> &lt;&lt; n &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keyword">const</span> plane : showerHitsMap | views::keys) {</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;      <span class="keyword">auto</span> hits = originalShowerHitsMap.at(plane);</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;      <span class="keywordflow">if</span> (permutations[n][plane] == 1) { std::reverse(hits.begin(), hits.end()); }</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;      showerHitsMap[plane] = hits;</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    }</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    ++<a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>;</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  }</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;  <span class="comment">// Go back to original if still no consistency</span></div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;  <span class="keywordflow">if</span> (!CheckShowerHits_(detProp, showerHitsMap)) showerHitsMap = originalShowerHitsMap;</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  <span class="keywordflow">if</span> (fDebug &gt; 2) {</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;End of OrderShowerHits: here are the order of hits:\n&quot;</span>;</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; [plane, hitPtrs] : showerHitsMap) {</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;      <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;  Plane &quot;</span> &lt;&lt; plane &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : hitPtrs | <a class="code" href="../../d5/d45/namespaceicarus_1_1waveform__operations_1_1details.html#ae295d3f6cb2f9181dccdf0e3492d44e0">views::transform</a>(<a class="code" href="../../d7/d0b/namespacelar.html#ac7ad65c5dbecd0f69500e739fe324e82">to_element</a>)) {</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;    Hit (&quot;</span> &lt;&lt; HitCoordinates_(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>).X() &lt;&lt; <span class="stringliteral">&quot; (real wire &quot;</span> &lt;&lt; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.WireID()</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;), &quot;</span> &lt;&lt; HitCoordinates_(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>).Y() &lt;&lt; <span class="stringliteral">&quot;) -- pos (&quot;</span></div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;                  &lt;&lt; HitPosition_(detProp, <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>).X() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; HitPosition_(detProp, <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>).Y()</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;      }</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    }</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  }</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;  <span class="keywordflow">if</span> (ignoredPlanes.size())</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    showerHitsMap[ignoredPlanes.begin()-&gt;first] = ignoredPlanes.begin()-&gt;second;</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;  <span class="keywordflow">return</span> showerHitsMap;</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;}</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l01587"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#af9f3fea80917997b0e15b341f0c65073"> 1587</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#af9f3fea80917997b0e15b341f0c65073">shower::EMShowerAlg::OrderShowerHits_</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;                                      <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt; <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#ad36c739018def8e4e44032f4cf395c9d">shower</a>,</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;                                      <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&amp; showerHits,</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;                                      art::Ptr&lt;recob::Vertex&gt; <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#a2e91c077dea2ff30aae790c67de81ea2">vertex</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;  showerHits = FindOrderOfHits_(detProp, <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#ad36c739018def8e4e44032f4cf395c9d">shower</a>);</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;  <span class="comment">// Find TPC for the vertex</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;  <span class="keywordtype">double</span> xyz[3];</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;  vertex-&gt;XYZ(xyz);</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;  <a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a> tpc = <a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;FindTPCAtPosition(xyz);</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;  <span class="keywordflow">if</span> (!tpc.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a9384db80f2ab08f013fc630316d7bd05">isValid</a> &amp;&amp; showerHits.size()) tpc = <a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a>(showerHits[0]-&gt;<a class="code" href="../../d2/d66/namespacegeo_1_1fhicl.html#a48509e22b6681725c899fc354de43ae2">WireID</a>());</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  <span class="comment">// Find hits in the same TPC</span></div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;  art::Ptr&lt;recob::Hit&gt; hit0, hit1;</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : showerHits) {</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;WireID().TPC == tpc.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>) {</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;      <span class="keywordflow">if</span> (hit0.isNull()) { hit0 = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>; }</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;      hit1 = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>;</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    }</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;  }</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;  <span class="keywordflow">if</span> (hit0.isNull() || hit1.isNull()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;  TVector2 coord0 = TVector2(hit0-&gt;WireID().Wire, hit0-&gt;PeakTime());</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;  TVector2 coord1 = TVector2(hit1-&gt;WireID().Wire, hit1-&gt;PeakTime());</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;  TVector2 coordvtx = TVector2(<a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;WireCoordinate(xyz[1], xyz[2], hit0-&gt;WireID().planeID()),</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;                               detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a359d6255bb14f321d76e6085204ea52a">ConvertXToTicks</a>(xyz[0], hit0-&gt;WireID().planeID()));</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;  <span class="keywordflow">if</span> ((coord1 - coordvtx).Mod() &lt; (coord0 - coordvtx).Mod()) {</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    std::reverse(showerHits.begin(), showerHits.end());</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;  }</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;}</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l01620"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#aae81809d92db7fb7a3a638dd3c9ad0a6"> 1620</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#aae81809d92db7fb7a3a638dd3c9ad0a6">shower::EMShowerAlg::FindInitialTrackHits</a>(<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt; <span class="keyword">const</span>&amp; showerHits,</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;                                          art::Ptr&lt;recob::Vertex&gt; <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#a2e91c077dea2ff30aae790c67de81ea2">vertex</a>,</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;                                          <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&amp; trackHits)<span class="keyword"> const</span></div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;  <span class="comment">// Find TPC for the vertex</span></div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;  <span class="keywordtype">double</span> xyz[3];</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;  vertex-&gt;XYZ(xyz);</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;  <a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a> tpc = <a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;FindTPCAtPosition(xyz);</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;  <span class="comment">// vertex cannot be projected into a TPC, find the TPC that has the most hits</span></div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;  <span class="keywordflow">if</span> (!tpc.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a9384db80f2ab08f013fc630316d7bd05">isValid</a>) {</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    std::map&lt;geo::TPCID, unsigned int&gt; tpcmap;</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;    <span class="keywordtype">unsigned</span> maxhits = 0;</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : showerHits) {</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;      ++tpcmap[<a class="code" href="../../d2/d66/namespacegeo_1_1fhicl.html#a526fdd18f5e73f8f37d263e9b230165c">geo::TPCID</a>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;WireID())];</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    }</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; t : tpcmap) {</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;      <span class="keywordflow">if</span> (t.second &gt; maxhits) {</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;        maxhits = t.second;</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;        tpc = t.first;</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;      }</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    }</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;  }</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;  <span class="keywordflow">if</span> (!tpc.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a9384db80f2ab08f013fc630316d7bd05">isValid</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;  <span class="keywordtype">double</span> parm[2];</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;  <span class="keywordtype">int</span> fitok = 0;</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;  std::vector&lt;double&gt; wfit;</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;  std::vector&lt;double&gt; tfit;</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;  std::vector&lt;double&gt; cfit;</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; fNfitpass; ++i) {</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    <span class="comment">// Fit a straight line through hits</span></div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nhits = 0;</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : showerHits) {</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;WireID().TPC == tpc.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>) {</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;        TVector2 <a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#adf21d5aa6342f2562c635c8a6779592f">coord</a> = HitCoordinates_(*<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>);</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;        <span class="keywordflow">if</span> (i == 0 ||</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;            (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>((coord.Y() - (parm[0] + coord.X() * parm[1])) * cos(atan(parm[1]))) &lt;</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;             fToler[i - 1]) ||</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;            fitok == 1) {</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;          ++nhits;</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;          <span class="keywordflow">if</span> (nhits == fNfithits[i] + 1) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;          wfit.push_back(coord.X());</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;          tfit.push_back(coord.Y());</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;          cfit.push_back(1.);</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;          <span class="keywordflow">if</span> (i == fNfitpass - 1) { trackHits.push_back(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>); }</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;        }</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;      }</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;    }</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    <span class="keywordflow">if</span> (i &lt; fNfitpass - 1 &amp;&amp; wfit.size()) {</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;      fitok = WeightedFit(wfit.size(), &amp;wfit[0], &amp;tfit[0], &amp;cfit[0], &amp;parm[0]);</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    }</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;    wfit.clear();</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;    tfit.clear();</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;    cfit.clear();</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;  }</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;}</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;TVector2</div>
<div class="line"><a name="l01683"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#adb661b6d325aef55d4b9b36f4860149f"> 1683</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#adb661b6d325aef55d4b9b36f4860149f">shower::EMShowerAlg::HitCoordinates_</a>(<a class="code" href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;  <span class="keywordflow">return</span> TVector2(GlobalWire_(hit.<a class="code" href="../../db/d4e/classrecob_1_1Hit.html#ac490abcf98854d93cf2fa85eadf4d469">WireID</a>()), hit.<a class="code" href="../../db/d4e/classrecob_1_1Hit.html#a46ddaf21b6eec49d205220f7daf3a85c">PeakTime</a>());</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;}</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;TVector2</div>
<div class="line"><a name="l01689"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#afb83f5b59e19144dd2b8a9a2c6bc1320"> 1689</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#afb83f5b59e19144dd2b8a9a2c6bc1320">shower::EMShowerAlg::HitPosition_</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;                                  <a class="code" href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;  <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> planeID = hit.<a class="code" href="../../db/d4e/classrecob_1_1Hit.html#ac490abcf98854d93cf2fa85eadf4d469">WireID</a>().<a class="code" href="../../de/db1/structgeo_1_1WireID.html#ada0a7c63318565f37beaf5894f8172ea">planeID</a>();</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;  <span class="keywordflow">return</span> HitPosition_(detProp, HitCoordinates_(hit), planeID);</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;}</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;TVector2</div>
<div class="line"><a name="l01697"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#aed0d0c46ef4e8b89c741dfc226a71732"> 1697</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#afb83f5b59e19144dd2b8a9a2c6bc1320">shower::EMShowerAlg::HitPosition_</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;                                  TVector2 <span class="keyword">const</span>&amp; pos,</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;                                  <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> planeID)<span class="keyword"> const</span></div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;  <span class="keywordflow">return</span> TVector2(pos.X() * <a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;WirePitch(planeID), detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a8e4b4b8d755ffded5a9f956ae7c9c1ec">ConvertTicksToX</a>(pos.Y(), planeID));</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;}</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;<span class="keywordtype">double</span></div>
<div class="line"><a name="l01705"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#aa29fb1c6798054324f5ea3b11e67ee67"> 1705</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#aa29fb1c6798054324f5ea3b11e67ee67">shower::EMShowerAlg::GlobalWire_</a>(<span class="keyword">const</span> <a class="code" href="../../de/db1/structgeo_1_1WireID.html">geo::WireID</a>&amp; wireID)<span class="keyword"> const</span></div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;  <span class="keywordtype">double</span> globalWire = -999;</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;  <span class="comment">// Induction</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;SignalType(wireID) == <a class="code" href="../../d6/d23/namespacegeo.html#a3b3c27511a16721236b09f14b66a58beafb721fe41f98f339c81e6bc7611820e8">geo::kInduction</a>) {</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    <span class="keywordtype">double</span> wireCentre[3];</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    <a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;WireIDToWireGeo(wireID).GetCenter(wireCentre);</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    <span class="keywordflow">if</span> (wireID.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a> % 2 == 0)</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;      globalWire =</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;        <a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;WireCoordinate(wireCentre[1], wireCentre[2], wireID.<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>, 0, wireID.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>);</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;      globalWire =</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;        <a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;WireCoordinate(wireCentre[1], wireCentre[2], wireID.<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>, 1, wireID.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>);</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;  }</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;  <span class="comment">// Collection</span></div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    <span class="comment">// FOR COLLECTION WIRES, HARD CODE THE GEOMETRY FOR GIVEN DETECTORS</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    <span class="comment">// THIS _SHOULD_ BE TEMPORARY. GLOBAL WIRE SUPPORT IS BEING ADDED TO THE LARSOFT GEOMETRY AND SHOULD BE AVAILABLE SOON</span></div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    <span class="keywordflow">if</span> (fDetector == <span class="stringliteral">&quot;dune35t&quot;</span>) {</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nwires = <a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;Nwires(wireID.<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>, 0, wireID.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>);</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;      <span class="keywordflow">if</span> (wireID.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a> == 0 or wireID.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a> == 1)</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;        globalWire = wireID.<a class="code" href="../../de/db1/structgeo_1_1WireID.html#ac303d2971eb9697f3a65821bb92bb934">Wire</a>;</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wireID.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a> == 2 or wireID.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a> == 3 or wireID.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a> == 4 or wireID.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a> == 5)</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;        globalWire = nwires + wireID.<a class="code" href="../../de/db1/structgeo_1_1WireID.html#ac303d2971eb9697f3a65821bb92bb934">Wire</a>;</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wireID.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a> == 6 or wireID.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a> == 7)</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;        globalWire = (2 * nwires) + wireID.<a class="code" href="../../de/db1/structgeo_1_1WireID.html#ac303d2971eb9697f3a65821bb92bb934">Wire</a>;</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;        mf::LogError(<span class="stringliteral">&quot;BlurredClusterAlg&quot;</span>)</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Error when trying to find a global induction plane coordinate for TPC &quot;</span> &lt;&lt; wireID.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a></div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; (geometry&quot;</span> &lt;&lt; fDetector &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;    }</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fDetector == <span class="stringliteral">&quot;dune10kt&quot;</span>) {</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nwires = <a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;Nwires(wireID.<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>, 0, wireID.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>);</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;      <span class="comment">// Detector geometry has four TPCs, two on top of each other, repeated along z...</span></div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;      <span class="keywordtype">int</span> block = wireID.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a> / 4;</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;      globalWire = (nwires * block) + wireID.<a class="code" href="../../de/db1/structgeo_1_1WireID.html#ac303d2971eb9697f3a65821bb92bb934">Wire</a>;</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    }</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;      <span class="keywordtype">double</span> wireCentre[3];</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;      <a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;WireIDToWireGeo(wireID).GetCenter(wireCentre);</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;      <span class="keywordflow">if</span> (wireID.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a> % 2 == 0)</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;        globalWire =</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;          <a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;WireCoordinate(wireCentre[1], wireCentre[2], wireID.<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>, 0, wireID.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>);</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;        globalWire =</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;          <a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;WireCoordinate(wireCentre[1], wireCentre[2], wireID.<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>, 1, wireID.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>);</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    }</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;  }</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;  <span class="keywordflow">return</span> globalWire;</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;}</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;std::map&lt;double, int&gt;</div>
<div class="line"><a name="l01760"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a8cc3b4c212645850e571159628cd6576"> 1760</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a8cc3b4c212645850e571159628cd6576">shower::EMShowerAlg::RelativeWireWidth_</a>(</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;  <span class="keyword">const</span> std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt;&amp; showerHitsMap)<span class="keyword"> const</span></div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;  <span class="comment">// Get the wire widths</span></div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;  std::map&lt;int, int&gt; planeWireLength;</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;  <span class="keywordflow">for</span> (std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt;::const_iterator showerHitsIt =</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;         showerHitsMap.begin();</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;       showerHitsIt != showerHitsMap.end();</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;       ++showerHitsIt)</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    planeWireLength[showerHitsIt-&gt;first] =</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;      <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(HitCoordinates_(*showerHitsIt-&gt;second.front()).<a class="code" href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a>() -</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;               HitCoordinates_(*showerHitsIt-&gt;second.back()).<a class="code" href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a>());</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;  <span class="comment">// Find the relative wire width for each plane with respect to the others</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;  std::map&lt;int, double&gt; planeOtherWireLengths;</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;  <span class="keywordflow">for</span> (std::map&lt;int, int&gt;::iterator planeWireLengthIt = planeWireLength.begin();</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;       planeWireLengthIt != planeWireLength.end();</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;       ++planeWireLengthIt) {</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;    <span class="keywordtype">double</span> quad = 0.;</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> plane = 0; plane &lt; (int)<a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;MaxPlanes(); ++plane)</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;      <span class="keywordflow">if</span> (plane != planeWireLengthIt-&gt;first <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a> planeWireLength.count(plane))</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;        quad += cet::square(planeWireLength[plane]);</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;    quad = std::sqrt(quad);</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    planeOtherWireLengths[planeWireLengthIt-&gt;first] =</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;      planeWireLength[planeWireLengthIt-&gt;first] / (double)quad;</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;  }</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;  <span class="comment">// Order these backwards</span></div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;  std::map&lt;double, int&gt; wireWidthMap;</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;  <span class="keywordflow">for</span> (std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt;::const_iterator showerHitsIt =</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;         showerHitsMap.begin();</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;       showerHitsIt != showerHitsMap.end();</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;       ++showerHitsIt)</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    wireWidthMap[planeOtherWireLengths.at(showerHitsIt-&gt;first)] = showerHitsIt-&gt;first;</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;  <span class="keywordflow">return</span> wireWidthMap;</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;}</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;TVector2</div>
<div class="line"><a name="l01800"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a1cfae1b378e6c65ba5a6a1b3af4fb678"> 1800</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a1cfae1b378e6c65ba5a6a1b3af4fb678">shower::EMShowerAlg::ShowerDirection_</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;                                      <span class="keyword">const</span> <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&amp; showerHits)<span class="keyword"> const</span></div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;  TVector2 pos;</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;  <span class="keywordtype">double</span> weight = 1;</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;  <span class="keywordtype">double</span> sumx = 0., sumy = 0., sumx2 = 0., sumxy = 0., sumweight = 0.;</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;::const_iterator <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = showerHits.begin();</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;       <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> != showerHits.end();</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;       ++<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>) {</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    <span class="comment">//++nhits;</span></div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    pos = HitPosition_(detProp, **<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>);</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    weight = cet::square((*hit)-&gt;Integral());</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    sumweight += weight;</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    sumx += weight * pos.X();</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    sumy += weight * pos.Y();</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    sumx2 += weight * pos.X() * pos.X();</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    sumxy += weight * pos.X() * pos.Y();</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;  }</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;  <span class="keywordtype">double</span> gradient = (sumweight * sumxy - sumx * sumy) / (sumweight * sumx2 - sumx * sumx);</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;  TVector2 direction = TVector2(1, gradient).Unit();</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;  <span class="keywordflow">return</span> direction;</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;}</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;TVector2</div>
<div class="line"><a name="l01826"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#aeaa9d738ecf381014196e6e68ac25891"> 1826</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#aeaa9d738ecf381014196e6e68ac25891">shower::EMShowerAlg::ShowerCenter_</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;                                   <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt; <span class="keyword">const</span>&amp; showerHits)<span class="keyword"> const</span></div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;  TVector2 pos, chargePoint = TVector2(0, 0);</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;  <span class="keywordtype">double</span> totalCharge = 0;</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;::const_iterator <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = showerHits.begin();</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;       <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> != showerHits.end();</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;       ++<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>) {</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;    pos = HitPosition_(detProp, **<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>);</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;    chargePoint += (*hit)-&gt;Integral() * pos;</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;    totalCharge += (*hit)-&gt;Integral();</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;  }</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;  TVector2 centre = chargePoint / totalCharge;</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;  <span class="keywordflow">return</span> centre;</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;}</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;<span class="keywordtype">double</span></div>
<div class="line"><a name="l01845"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#ad88f6dd8025165b026b1dd2767201eec"> 1845</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#ad88f6dd8025165b026b1dd2767201eec">shower::EMShowerAlg::ShowerHitRMS_</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&amp; showerHits)<span class="keyword"> const</span></div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;  TVector2 direction = ShowerDirection_(detProp, showerHits);</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;  TVector2 centre = ShowerCenter_(detProp, showerHits);</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;  std::vector&lt;double&gt; distanceToAxis;</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;::const_iterator showerHitsIt = showerHits.begin();</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;       showerHitsIt != showerHits.end();</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;       ++showerHitsIt) {</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;    TVector2 proj = (HitPosition_(detProp, **showerHitsIt) - centre).Proj(direction) + centre;</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;    distanceToAxis.push_back((HitPosition_(detProp, **showerHitsIt) - proj).Mod());</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;  }</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;  <span class="keywordtype">double</span> RMS = TMath::RMS(distanceToAxis.begin(), distanceToAxis.end());</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;  <span class="keywordflow">return</span> RMS;</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;}</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;<span class="keywordtype">double</span></div>
<div class="line"><a name="l01865"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a69f9a3937084f1748ab44be94e62fa19"> 1865</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a69f9a3937084f1748ab44be94e62fa19">shower::EMShowerAlg::ShowerHitRMSGradient_</a>(</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;  <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&amp; showerHits)<span class="keyword"> const</span></div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;  <span class="comment">// Find a rough shower &#39;direction&#39; and center</span></div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;  TVector2 direction = ShowerDirection_(detProp, showerHits);</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;  <span class="comment">// Bin the hits into discreet chunks</span></div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;  <span class="keywordtype">int</span> nShowerSegments = fNumShowerSegments;</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;  <span class="keywordtype">double</span> lengthOfShower =</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    (HitPosition_(detProp, *showerHits.back()) - HitPosition_(detProp, *showerHits.front())).Mod();</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;  <span class="keywordtype">double</span> lengthOfSegment = lengthOfShower / (double)nShowerSegments;</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;  std::map&lt;int, std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt; showerSegments;</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;  std::map&lt;int, double&gt; segmentCharge;</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; hitPtr : showerHits) {</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    <span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = *hitPtr;</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    <span class="keywordtype">int</span> <span class="keyword">const</span> segment =</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;      (HitPosition_(detProp, <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>) - HitPosition_(detProp, *showerHits.front())).Mod() /</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;      lengthOfSegment;</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    showerSegments[segment].push_back(hitPtr);</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;    segmentCharge[segment] += <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.Integral();</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;  }</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;  TGraph* graph = <span class="keyword">new</span> TGraph();</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;  std::vector&lt;std::pair&lt;int, double&gt;&gt; binVsRMS;</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;  <span class="comment">// Loop over the bins to find the distribution of hits as the shower</span></div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;  <span class="comment">// progresses</span></div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; [segment, hitPtrs] : showerSegments) {</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;    <span class="comment">// Get the mean position of the hits in this bin</span></div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;    TVector2 meanPosition(0, 0);</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : hitPtrs | <a class="code" href="../../d5/d45/namespaceicarus_1_1waveform__operations_1_1details.html#ae295d3f6cb2f9181dccdf0e3492d44e0">views::transform</a>(<a class="code" href="../../d7/d0b/namespacelar.html#ac7ad65c5dbecd0f69500e739fe324e82">to_element</a>))</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;      meanPosition += HitPosition_(detProp, <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>);</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;    meanPosition /= (double)hitPtrs.size();</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;    <span class="comment">// Get the RMS of this bin</span></div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;    std::vector&lt;double&gt; distanceToAxisBin;</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : hitPtrs | <a class="code" href="../../d5/d45/namespaceicarus_1_1waveform__operations_1_1details.html#ae295d3f6cb2f9181dccdf0e3492d44e0">views::transform</a>(<a class="code" href="../../d7/d0b/namespacelar.html#ac7ad65c5dbecd0f69500e739fe324e82">to_element</a>)) {</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;      TVector2 proj = (HitPosition_(detProp, <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>) - meanPosition).Proj(direction) + meanPosition;</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;      distanceToAxisBin.push_back((HitPosition_(detProp, <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>) - proj).Mod());</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    }</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;    <span class="keywordtype">double</span> RMSBin = TMath::RMS(distanceToAxisBin.begin(), distanceToAxisBin.end());</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;    binVsRMS.emplace_back(segment, RMSBin);</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;    <span class="keywordflow">if</span> (fMakeRMSGradientPlot) graph-&gt;SetPoint(graph-&gt;GetN(), segment, RMSBin);</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;  }</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;  <span class="comment">// Get the gradient of the RMS-bin plot</span></div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;  <span class="keywordtype">double</span> sumx = 0., sumy = 0., sumx2 = 0., sumxy = 0., sumweight = 0.;</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span> [<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#a512aa20fb28b8c00f3d290ba176b40e1">bin</a>, RMSBin] : binVsRMS) {</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;    <span class="keywordtype">double</span> weight = segmentCharge.at(<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#a512aa20fb28b8c00f3d290ba176b40e1">bin</a>);</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;    sumweight += weight;</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;    sumx += weight * <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#a512aa20fb28b8c00f3d290ba176b40e1">bin</a>;</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;    sumy += weight * RMSBin;</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    sumx2 += weight * bin * <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#a512aa20fb28b8c00f3d290ba176b40e1">bin</a>;</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;    sumxy += weight * bin * RMSBin;</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;  }</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;  <span class="keywordtype">double</span> RMSgradient = (sumweight * sumxy - sumx * sumy) / (sumweight * sumx2 - sumx * sumx);</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;  <span class="keywordflow">if</span> (fMakeRMSGradientPlot) {</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;    TVector2 direction = TVector2(1, RMSgradient).Unit();</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;    TCanvas* canv = <span class="keyword">new</span> TCanvas();</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;    graph-&gt;Draw();</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;    graph-&gt;GetXaxis()-&gt;SetTitle(<span class="stringliteral">&quot;Shower segment&quot;</span>);</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;    graph-&gt;GetYaxis()-&gt;SetTitle(<span class="stringliteral">&quot;RMS of hit distribution&quot;</span>);</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;    TVector2 centre = TVector2(graph-&gt;GetMean(1), graph-&gt;GetMean(2));</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;    TLine line;</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    line.SetLineColor(2);</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;    line.DrawLine(centre.X() - 1000 * direction.X(),</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;                  centre.Y() - 1000 * direction.Y(),</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;                  centre.X() + 1000 * direction.X(),</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;                  centre.Y() + 1000 * direction.Y());</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    canv-&gt;SaveAs(<span class="stringliteral">&quot;RMSGradient.png&quot;</span>);</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;    <span class="keyword">delete</span> canv;</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;  }</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;  <span class="keyword">delete</span> graph;</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;  <span class="keywordflow">return</span> RMSgradient;</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;}</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;TVector2</div>
<div class="line"><a name="l01947"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a92f23d05d7dc718c72aa4918409479b2"> 1947</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a92f23d05d7dc718c72aa4918409479b2">shower::EMShowerAlg::Project3DPointOntoPlane_</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;                                              TVector3 <span class="keyword">const</span>&amp; point,</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;                                              <span class="keywordtype">int</span> plane,</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;                                              <span class="keywordtype">int</span> cryostat)<span class="keyword"> const</span></div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;  TVector2 wireTickPos = TVector2(-999., -999.);</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;  <span class="keywordtype">double</span> pointPosition[3] = {point.X(), point.Y(), point.Z()};</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;  <a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a> tpcID = <a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;FindTPCAtPosition(pointPosition);</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;  <span class="keywordtype">int</span> tpc = 0;</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;  <span class="keywordflow">if</span> (tpcID.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a9384db80f2ab08f013fc630316d7bd05">isValid</a>)</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;    tpc = tpcID.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>;</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;    <span class="keywordflow">return</span> wireTickPos;</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;  <span class="comment">// Construct wire ID for this point projected onto the plane</span></div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;  <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> planeID = <a class="code" href="../../d2/d66/namespacegeo_1_1fhicl.html#a05ff5cebd7313582756a33d8e8a5971a">geo::PlaneID</a>(cryostat, tpc, plane);</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;  <a class="code" href="../../de/db1/structgeo_1_1WireID.html">geo::WireID</a> wireID;</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;  <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;    wireID = <a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;NearestWireID(point, planeID);</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;  }</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;  <span class="keywordflow">catch</span> (<a class="code" href="../../d6/d6c/classgeo_1_1InvalidWireError.html">geo::InvalidWireError</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d4/dca/updateVersionList_8sh.html#a067a8c1534d6da9b2c501a6cf4ef89bd">e</a>) {</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;    wireID = e.<a class="code" href="../../d6/d6c/classgeo_1_1InvalidWireError.html#a174c7f48dc6c32f680e033c960fbc9eb">suggestedWireID</a>(); <span class="comment">// pick the closest valid wire</span></div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;  }</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;  wireTickPos = TVector2(GlobalWire_(wireID), detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a359d6255bb14f321d76e6085204ea52a">ConvertXToTicks</a>(point.X(), planeID));</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;  <span class="keywordflow">return</span> HitPosition_(detProp, wireTickPos, planeID);</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;}</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l01980"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#aa94f6ee6f7fe62b62ea5a8dda24cd279"> 1980</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#aa94f6ee6f7fe62b62ea5a8dda24cd279">shower::EMShowerAlg::WorstPlane_</a>(</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;  <span class="keyword">const</span> std::map&lt;<span class="keywordtype">int</span>, <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&gt;&amp; showerHitsMap)<span class="keyword"> const</span></div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;  <span class="comment">// Get the width of the shower in wire coordinate</span></div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;  std::map&lt;int, int&gt; planeWireLength;</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;  std::map&lt;int, double&gt; planeOtherWireLengths;</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; [plane, hits] : showerHitsMap)</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    planeWireLength[plane] =</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;      <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(HitCoordinates_(*hits.front()).<a class="code" href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a>() - HitCoordinates_(*hits.back()).<a class="code" href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a>());</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;  <span class="keywordflow">for</span> (std::map&lt;int, int&gt;::iterator planeWireLengthIt = planeWireLength.begin();</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;       planeWireLengthIt != planeWireLength.end();</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;       ++planeWireLengthIt) {</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;    <span class="keywordtype">double</span> quad = 0.;</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> plane = 0; plane &lt; (int)<a class="code" href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a>-&gt;MaxPlanes(); ++plane)</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;      <span class="keywordflow">if</span> (plane != planeWireLengthIt-&gt;first <a class="code" href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a> planeWireLength.count(plane))</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;        quad += cet::square(planeWireLength[plane]);</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    quad = std::sqrt(quad);</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;    planeOtherWireLengths[planeWireLengthIt-&gt;first] =</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;      planeWireLength[planeWireLengthIt-&gt;first] / (double)quad;</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;  }</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;  <span class="keywordflow">if</span> (fDebug &gt; 1)</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span> [plane, relative_width] : planeOtherWireLengths) {</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;      <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Plane &quot;</span> &lt;&lt; plane &lt;&lt; <span class="stringliteral">&quot; has &quot;</span> &lt;&lt; planeWireLength[plane]</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; wire width and therefore has relative width in wire of &quot;</span> &lt;&lt; relative_width</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;                &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;    }</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;  std::map&lt;double, int&gt; wireWidthMap;</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keyword">const</span> plane : showerHitsMap | views::keys) {</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;    <span class="keywordtype">double</span> wireWidth = planeWireLength.at(plane);</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    wireWidthMap[wireWidth] = plane;</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;  }</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;  <span class="keywordflow">return</span> wireWidthMap.begin()-&gt;second;</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;}</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;Int_t</div>
<div class="line"><a name="l02018"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a66a212efa45ea778a7cdb0541e4f5c8d"> 2018</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a66a212efa45ea778a7cdb0541e4f5c8d">shower::EMShowerAlg::WeightedFit</a>(<span class="keyword">const</span> Int_t <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>,</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;                                 <span class="keyword">const</span> Double_t* <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a>,</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;                                 <span class="keyword">const</span> Double_t* <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a1e5aaaf25e8609a835e8c7c6fda71456">y</a>,</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;                                 <span class="keyword">const</span> Double_t* <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">w</a>,</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;                                 Double_t* parm)<span class="keyword"> const</span></div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;  Double_t sumx = 0.;</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;  Double_t sumx2 = 0.;</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;  Double_t sumy = 0.;</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;  Double_t sumy2 = 0.;</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;  Double_t sumxy = 0.;</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;  Double_t sumw = 0.;</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;  Double_t eparm[2];</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;  parm[0] = 0.;</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;  parm[1] = 0.;</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;  eparm[0] = 0.;</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;  eparm[1] = 0.;</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;  <span class="keywordflow">for</span> (Int_t i = 0; i &lt; <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>; i++) {</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;    sumx += x[i] * w[i];</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    sumx2 += x[i] * x[i] * w[i];</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;    sumy += y[i] * w[i];</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;    sumy2 += y[i] * y[i] * w[i];</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;    sumxy += x[i] * y[i] * w[i];</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    sumw += w[i];</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;  }</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;  <span class="keywordflow">if</span> (sumx2 * sumw - sumx * sumx == 0.) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;  <span class="keywordflow">if</span> (sumx2 - sumx * sumx / sumw == 0.) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;  parm[0] = (sumy * sumx2 - sumx * sumxy) / (sumx2 * sumw - sumx * sumx);</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;  parm[1] = (sumxy - sumx * sumy / sumw) / (sumx2 - sumx * sumx / sumw);</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;  eparm[0] = sumx2 * (sumx2 * sumw - sumx * sumx);</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;  eparm[1] = (sumx2 - sumx * sumx / sumw);</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;  <span class="keywordflow">if</span> (eparm[0] &lt; 0. || eparm[1] &lt; 0.) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;  eparm[0] = sqrt(eparm[0]) / (sumx2 * sumw - sumx * sumx);</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;  eparm[1] = sqrt(eparm[1]) / (sumx2 - sumx * sumx / sumw);</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;}</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l02065"></a><span class="lineno"><a class="line" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a6855d0ed03aea075aa7a80b06d7a3e2b"> 2065</a></span>&#160;<a class="code" href="../../d5/d77/classshower_1_1EMShowerAlg.html#a6855d0ed03aea075aa7a80b06d7a3e2b">shower::EMShowerAlg::isCleanShower</a>(<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt; <span class="keyword">const</span>&amp; hits)<span class="keyword"> const</span></div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;  <span class="keywordflow">if</span> (hits.empty()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;  <span class="keywordflow">if</span> (hits.size() &gt; 2000) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;  <span class="keywordflow">if</span> (hits.size() &lt; 20) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;  std::map&lt;int, int&gt; hitmap;</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;  <span class="keywordtype">unsigned</span> nhits = 0;</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : hits | <a class="code" href="../../d5/d45/namespaceicarus_1_1waveform__operations_1_1details.html#ae295d3f6cb2f9181dccdf0e3492d44e0">views::transform</a>(<a class="code" href="../../d7/d0b/namespacelar.html#ac7ad65c5dbecd0f69500e739fe324e82">to_element</a>)) {</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;    ++nhits;</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;    <span class="keywordflow">if</span> (nhits &gt; 2) ++hitmap[<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.WireID().Wire];</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;    <span class="keywordflow">if</span> (nhits == 20) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;  }</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;  <span class="keywordflow">if</span> (<span class="keywordtype">float</span>(nhits - 2) / hitmap.size() &gt; 1.4)</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;}</div>
<div class="ttc" id="cheaterreco_8fcl_html_a2e91c077dea2ff30aae790c67de81ea2"><div class="ttname"><a href="../../d2/d36/cheaterreco_8fcl.html#a2e91c077dea2ff30aae790c67de81ea2">vertex</a></div><div class="ttdeci">process_name vertex</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d36/cheaterreco_8fcl_source.html#l00051">cheaterreco.fcl:51</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/PmaTrack3D_8h_source.html#l00037">PmaTrack3D.h:37</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_afb83f5b59e19144dd2b8a9a2c6bc1320"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#afb83f5b59e19144dd2b8a9a2c6bc1320">shower::EMShowerAlg::HitPosition_</a></div><div class="ttdeci">TVector2 HitPosition_(detinfo::DetectorPropertiesData const &amp;detProp, recob::Hit const &amp;hit) const </div><div class="ttdoc">Return the coordinates of this hit in units of cm. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l01689">EMShowerAlg.cxx:1689</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_a5cca4cc475f14c8c2e709c5053457917"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#a5cca4cc475f14c8c2e709c5053457917">shower::EMShowerAlg::MakeSpacePoints</a></div><div class="ttdeci">std::vector&lt; recob::SpacePoint &gt; MakeSpacePoints(detinfo::DetectorPropertiesData const &amp;detProp, std::map&lt; int, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt;&gt; const &amp;hits, std::vector&lt; std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt;&gt; &amp;hitAssns) const </div><div class="ttdoc">Makes space points from the shower hits in each plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l01230">EMShowerAlg.cxx:1230</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_aae81809d92db7fb7a3a638dd3c9ad0a6"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#aae81809d92db7fb7a3a638dd3c9ad0a6">shower::EMShowerAlg::FindInitialTrackHits</a></div><div class="ttdeci">void FindInitialTrackHits(std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; const &amp;showerHits, art::Ptr&lt; recob::Vertex &gt; const &amp;vertex, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; &amp;trackHits) const </div><div class="ttdoc">&amp;lt;Tingjun to=&amp;quot;&amp;quot; document&amp;gt;=&amp;quot;&amp;quot;&amp;gt; </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l01620">EMShowerAlg.cxx:1620</a></div></div>
<div class="ttc" id="neoSmazza_8sh_html_ae55989c903f0c76190facfb5e5211732"><div class="ttname"><a href="../../de/d71/neoSmazza_8sh.html#ae55989c903f0c76190facfb5e5211732">if</a></div><div class="ttdeci">then if[[&quot;$THISISATEST&quot;==1]]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d71/neoSmazza_8sh_source.html#l00095">neoSmazza.sh:95</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_aa94f6ee6f7fe62b62ea5a8dda24cd279"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#aa94f6ee6f7fe62b62ea5a8dda24cd279">shower::EMShowerAlg::WorstPlane_</a></div><div class="ttdeci">int WorstPlane_(const std::map&lt; int, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt;&gt; &amp;showerHitsMap) const </div><div class="ttdoc">Returns the plane which is determined to be the least likely to be correct. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l01980">EMShowerAlg.cxx:1980</a></div></div>
<div class="ttc" id="structgeo_1_1WireIDIntersection_html_a99e74ffcbcfd46cdb9754cde0a2019a1"><div class="ttname"><a href="../../da/d3d/structgeo_1_1WireIDIntersection.html#a99e74ffcbcfd46cdb9754cde0a2019a1">geo::WireIDIntersection::z</a></div><div class="ttdeci">double z</div><div class="ttdoc">z position of intersection </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00805">geo_types.h:805</a></div></div>
<div class="ttc" id="namespacelar_html_ac7ad65c5dbecd0f69500e739fe324e82"><div class="ttname"><a href="../../d7/d0b/namespacelar.html#ac7ad65c5dbecd0f69500e739fe324e82">lar::to_element</a></div><div class="ttdeci">constexpr to_element_t to_element</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dbc/ToElement_8h_source.html#l00024">ToElement.h:24</a></div></div>
<div class="ttc" id="rawdigitfilter__icarus_8fcl_html_aa2b9cfdf9a8f294302be0cdf6affea22"><div class="ttname"><a href="../../d6/d5e/rawdigitfilter__icarus_8fcl.html#aa2b9cfdf9a8f294302be0cdf6affea22">Plane</a></div><div class="ttdeci">BEGIN_PROLOG true icarus_rawdigitfilter FilterTools FilterPlane1 Plane</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d5e/rawdigitfilter__icarus_8fcl_source.html#l00008">rawdigitfilter_icarus.fcl:8</a></div></div>
<div class="ttc" id="namespaceicarus_1_1waveform__operations_1_1details_html_ae295d3f6cb2f9181dccdf0e3492d44e0"><div class="ttname"><a href="../../d5/d45/namespaceicarus_1_1waveform__operations_1_1details.html#ae295d3f6cb2f9181dccdf0e3492d44e0">icarus::waveform_operations::details::transform</a></div><div class="ttdeci">static constexpr Sample_t transform(Sample_t sample)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d8e/WaveformOperations_8h_source.html#l00145">WaveformOperations.h:145</a></div></div>
<div class="ttc" id="run__opflash__electron_8fcl_html_a6673f03521899f7844189bcfd8ee5941"><div class="ttname"><a href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a></div><div class="ttdeci">process_name opflash particleana ie x</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d84/run__opflash__electron_8fcl_source.html#l00090">run_opflash_electron.fcl:90</a></div></div>
<div class="ttc" id="cheaterreco_8fcl_html_afac1ac7b61385644c993fbb774a1922f"><div class="ttname"><a href="../../d2/d36/cheaterreco_8fcl.html#afac1ac7b61385644c993fbb774a1922f">cluster</a></div><div class="ttdeci">process_name cluster</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d36/cheaterreco_8fcl_source.html#l00051">cheaterreco.fcl:51</a></div></div>
<div class="ttc" id="namespacerecob_1_1tracking_html_aedd77b5ebb70d48a9b4673b8efcbc32e"><div class="ttname"><a href="../../d6/d6b/namespacerecob_1_1tracking.html#aedd77b5ebb70d48a9b4673b8efcbc32e">recob::tracking::SMatrixSym55</a></div><div class="ttdeci">ROOT::Math::SMatrix&lt; Double32_t, 5, 5, ROOT::Math::MatRepSym&lt; Double32_t, 5 &gt; &gt; SMatrixSym55</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da9/TrackingTypes_8h_source.html#l00085">TrackingTypes.h:85</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_a31f278cbc6fd8523478331036ee805b5"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#a31f278cbc6fd8523478331036ee805b5">shower::EMShowerAlg::MakeShower</a></div><div class="ttdeci">recob::Shower MakeShower(detinfo::DetectorClocksData const &amp;clockData, detinfo::DetectorPropertiesData const &amp;detProp, art::PtrVector&lt; recob::Hit &gt; const &amp;hits, std::unique_ptr&lt; recob::Track &gt; const &amp;initialTrack, std::map&lt; int, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt;&gt; const &amp;initialTrackHits) const </div><div class="ttdoc">Makes a recob::Shower object given the hits in the shower and the initial track-like part...</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l01010">EMShowerAlg.cxx:1010</a></div></div>
<div class="ttc" id="namespacerecob_1_1tracking_html_a159ae849126aae38dcc0675e448c0727"><div class="ttname"><a href="../../d6/d6b/namespacerecob_1_1tracking.html#a159ae849126aae38dcc0675e448c0727">recob::tracking::convertCollToVector</a></div><div class="ttdeci">std::vector&lt; Vector_t &gt; convertCollToVector(std::vector&lt; Vector &gt; const &amp;coll)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da9/TrackingTypes_8h_source.html#l00058">TrackingTypes.h:58</a></div></div>
<div class="ttc" id="namespacegeo_1_1vect_html_adf21d5aa6342f2562c635c8a6779592f"><div class="ttname"><a href="../../d0/d8e/namespacegeo_1_1vect.html#adf21d5aa6342f2562c635c8a6779592f">geo::vect::coord</a></div><div class="ttdeci">auto coord(Vector &amp;v, unsigned int n) noexcept</div><div class="ttdoc">Returns an object to manage the coordinate n of a vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d6c/geo__vectors__utils_8h_source.html#l02049">geo_vectors_utils.h:2049</a></div></div>
<div class="ttc" id="classrecob_1_1Hit_html_ac490abcf98854d93cf2fa85eadf4d469"><div class="ttname"><a href="../../db/d4e/classrecob_1_1Hit.html#ac490abcf98854d93cf2fa85eadf4d469">recob::Hit::WireID</a></div><div class="ttdeci">geo::WireID WireID() const </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d26/Hit_8h_source.html#l00233">Hit.h:233</a></div></div>
<div class="ttc" id="classdetinfo_1_1DetectorPropertiesData_html"><div class="ttname"><a href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7a/DetectorPropertiesData_8h_source.html#l00011">DetectorPropertiesData.h:11</a></div></div>
<div class="ttc" id="namespacelar_1_1fhicl_1_1geo_html_aff5db21a0b87718dbf7debb3cd62dbd0"><div class="ttname"><a href="../../d1/d4e/namespacelar_1_1fhicl_1_1geo.html#aff5db21a0b87718dbf7debb3cd62dbd0">lar::fhicl::geo::Point3D</a></div><div class="ttdeci">::fhicl::TupleAs&lt; Point(::geo::Length_t,::geo::Length_t,::geo::Length_t)&gt; Point3D</div><div class="ttdoc">Atom object for reading a 3D point or vector (centimeters). </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0b/geo__vectors__fhicl_8h_source.html#l00038">geo_vectors_fhicl.h:38</a></div></div>
<div class="ttc" id="structgeo_1_1PlaneID_html"><div class="ttname"><a href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a></div><div class="ttdoc">The data type to uniquely identify a Plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00472">geo_types.h:472</a></div></div>
<div class="ttc" id="structgeo_1_1CryostatID_html_a9384db80f2ab08f013fc630316d7bd05"><div class="ttname"><a href="../../d9/d73/structgeo_1_1CryostatID.html#a9384db80f2ab08f013fc630316d7bd05">geo::CryostatID::isValid</a></div><div class="ttdeci">bool isValid</div><div class="ttdoc">Whether this ID points to a valid element. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00211">geo_types.h:211</a></div></div>
<div class="ttc" id="classrecob_1_1Track_html_a79f1b57342d70962685e749753d76ad1"><div class="ttname"><a href="../../d9/dca/classrecob_1_1Track.html#a79f1b57342d70962685e749753d76ad1">recob::Track::Flags_t</a></div><div class="ttdeci">TrackTrajectory::Flags_t Flags_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d53/bj_2lardataobj_2RecoBase_2Track_8h_source.html#l00068">bj/lardataobj/RecoBase/Track.h:68</a></div></div>
<div class="ttc" id="classrecob_1_1Track_html_aa8edf54b2357ba4e9f19ff23a4880156"><div class="ttname"><a href="../../d9/dca/classrecob_1_1Track.html#aa8edf54b2357ba4e9f19ff23a4880156">recob::Track::VertexDirection</a></div><div class="ttdeci">Vector_t VertexDirection() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d53/bj_2lardataobj_2RecoBase_2Track_8h_source.html#l00132">bj/lardataobj/RecoBase/Track.h:132</a></div></div>
<div class="ttc" id="structgeo_1_1CryostatID_html_a2bfb744818e075d94be15dd18c950441"><div class="ttname"><a href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">geo::CryostatID::Cryostat</a></div><div class="ttdeci">CryostatID_t Cryostat</div><div class="ttdoc">Index of cryostat. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00212">geo_types.h:212</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_a99f86c0f523fe77955a03d426d36f303"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#a99f86c0f523fe77955a03d426d36f303">shower::EMShowerAlg::AssociateClustersAndTracks</a></div><div class="ttdeci">void AssociateClustersAndTracks(std::vector&lt; art::Ptr&lt; recob::Cluster &gt;&gt; const &amp;clusters, art::FindManyP&lt; recob::Hit &gt; const &amp;fmh, art::FindManyP&lt; recob::Track &gt; const &amp;fmt, std::map&lt; int, std::vector&lt; int &gt;&gt; &amp;clusterToTracks, std::map&lt; int, std::vector&lt; int &gt;&gt; &amp;trackToClusters) const </div><div class="ttdoc">Map associated tracks and clusters together given their associated hits. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l00060">EMShowerAlg.cxx:60</a></div></div>
<div class="ttc" id="namespaceicarus_1_1ns_1_1util_html_aaae74cf315284bc0f44c2e050c119781"><div class="ttname"><a href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">icarus::ns::util::size</a></div><div class="ttdeci">std::size_t size(FixedBins&lt; T, C &gt; const &amp;) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dbd/FixedBins_8h_source.html#l00561">FixedBins.h:561</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_a917c47a83913694099c85868a314cda0"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#a917c47a83913694099c85868a314cda0">shower::EMShowerAlg::GetPlanePermutations_</a></div><div class="ttdeci">std::map&lt; int, std::map&lt; int, bool &gt; &gt; GetPlanePermutations_(const detinfo::DetectorPropertiesData &amp;detProp, const std::map&lt; int, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt;&gt; &amp;showerHitsMap) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l00873">EMShowerAlg.cxx:873</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_aa29fb1c6798054324f5ea3b11e67ee67"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#aa29fb1c6798054324f5ea3b11e67ee67">shower::EMShowerAlg::GlobalWire_</a></div><div class="ttdeci">double GlobalWire_(const geo::WireID &amp;wireID) const </div><div class="ttdoc">Find the global wire position. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l01705">EMShowerAlg.cxx:1705</a></div></div>
<div class="ttc" id="classrecob_1_1Hit_html_a025b7a27fcb52523170cf0e0b2ab5c03"><div class="ttname"><a href="../../db/d4e/classrecob_1_1Hit.html#a025b7a27fcb52523170cf0e0b2ab5c03">recob::Hit::View</a></div><div class="ttdeci">geo::View_t View() const </div><div class="ttdoc">View for the plane of the hit. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d26/Hit_8h_source.html#l00232">Hit.h:232</a></div></div>
<div class="ttc" id="structgeo_1_1WireID_html_ac303d2971eb9697f3a65821bb92bb934"><div class="ttname"><a href="../../de/db1/structgeo_1_1WireID.html#ac303d2971eb9697f3a65821bb92bb934">geo::WireID::Wire</a></div><div class="ttdeci">WireID_t Wire</div><div class="ttdoc">Index of the wire within its plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00580">geo_types.h:580</a></div></div>
<div class="ttc" id="standard__reco_8fcl_html_a8e7c4631bab825a68b0a82d8223c2ec2"><div class="ttname"><a href="../../df/df2/standard__reco_8fcl.html#a8e7c4631bab825a68b0a82d8223c2ec2">track</a></div><div class="ttdeci">process_name use argoneut_mc_hitfinder track</div><div class="ttdef"><b>Definition:</b> <a href="../../df/df2/standard__reco_8fcl_source.html#l00036">standard_reco.fcl:36</a></div></div>
<div class="ttc" id="structgeo_1_1WireID_html"><div class="ttname"><a href="../../de/db1/structgeo_1_1WireID.html">geo::WireID</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00560">geo_types.h:560</a></div></div>
<div class="ttc" id="cheaterreco_8fcl_html_abf2e819dbf4c327e098bebd4b2dc0597"><div class="ttname"><a href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a></div><div class="ttdeci">process_name hit</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d36/cheaterreco_8fcl_source.html#l00051">cheaterreco.fcl:51</a></div></div>
<div class="ttc" id="testFHiCLfiles_8sh_html_a0514aabed091ee5e2f35766eb01eced6"><div class="ttname"><a href="../../dd/db0/testFHiCLfiles_8sh.html#a0514aabed091ee5e2f35766eb01eced6">debug</a></div><div class="ttdeci">debug</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/db0/testFHiCLfiles_8sh_source.html#l00353">testFHiCLfiles.sh:353</a></div></div>
<div class="ttc" id="find__global__symbol_8sh_html_ae2fcd9af85e9525dadab1ac2cb45a22d"><div class="ttname"><a href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a></div><div class="ttdeci">then echo echo For and will not be changed by echo further linking echo echo B echo The symbol is in the uninitialized data multiple common symbols may appear with the echo same name If the symbol is defined the common echo symbols are treated as undefined references For more echo details on common see the discussion of warn common echo in *Note Linker see the discussion of warn common echo in *Note Linker such as a global int variable echo as opposed to a large global array echo echo I echo The symbol is an indirect reference to another symbol This echo is a GNU extension to the a out object file format which is echo rarely used echo echo N echo The symbol is a debugging symbol echo echo R echo The symbol is in a read only data section echo echo S echo The symbol is in an uninitialized data section for small echo objects echo echo T echo The symbol is in the the normal defined echo symbol is used with no error When a weak undefined symbol echo is linked and the symbol is not the value of the echo weak symbol becomes zero with no error echo echo W echo The symbol is a weak symbol that has not been specifically echo tagged as a weak object symbol When a weak defined symbol echo is linked with a normal defined the normal defined echo symbol is used with no error When a weak undefined symbol echo is linked and the symbol is not the value of the echo weak symbol becomes zero with no error echo echo echo The symbol is a stabs symbol in an a out object file In echo this the next values printed are the stabs other echo the stabs desc and the stab type Stabs symbols are echo used to hold debugging information For more echo see *Note or object file format specific echo echo For Mac OS X</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/df9/find__global__symbol_8sh_source.html#l00107">find_global_symbol.sh:107</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_aeaa9d738ecf381014196e6e68ac25891"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#aeaa9d738ecf381014196e6e68ac25891">shower::EMShowerAlg::ShowerCenter_</a></div><div class="ttdeci">TVector2 ShowerCenter_(detinfo::DetectorPropertiesData const &amp;detProp, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; const &amp;showerHits) const </div><div class="ttdoc">Returns the charge-weighted shower center. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l01826">EMShowerAlg.cxx:1826</a></div></div>
<div class="ttc" id="cheaterreco_8fcl_html_ad36c739018def8e4e44032f4cf395c9d"><div class="ttname"><a href="../../d2/d36/cheaterreco_8fcl.html#ad36c739018def8e4e44032f4cf395c9d">shower</a></div><div class="ttdeci">process_name shower</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d36/cheaterreco_8fcl_source.html#l00051">cheaterreco.fcl:51</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_a0ea322f15b62c1a0b9d8342745c7b251"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#a0ea322f15b62c1a0b9d8342745c7b251">shower::EMShowerAlg::FindShowers</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; int &gt; &gt; FindShowers(std::map&lt; int, std::vector&lt; int &gt;&gt; const &amp;trackToClusters) const </div><div class="ttdoc">Makes showers given a map between tracks and all clusters associated with them. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l00717">EMShowerAlg.cxx:717</a></div></div>
<div class="ttc" id="preparseGDML_8cpp_html_a91214e8e0e1bf4d60b1d72e9de27e51b"><div class="ttname"><a href="../../d1/d27/preparseGDML_8cpp.html#a91214e8e0e1bf4d60b1d72e9de27e51b">outFile</a></div><div class="ttdeci">TString outFile</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d27/preparseGDML_8cpp_source.html#l00432">preparseGDML.cpp:432</a></div></div>
<div class="ttc" id="ExtractEnergyDepositionSummary__module_8cc_html_a0799b53d7ed2b2b303a8168f11134862"><div class="ttname"><a href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc.html#a0799b53d7ed2b2b303a8168f11134862">fGeom</a></div><div class="ttdeci">fGeom</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d11/ExtractEnergyDepositionSummary__module_8cc_source.html#l00301">ExtractEnergyDepositionSummary_module.cc:301</a></div></div>
<div class="ttc" id="namespaceicarus_1_1ns_1_1util_html_a512aa20fb28b8c00f3d290ba176b40e1"><div class="ttname"><a href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#a512aa20fb28b8c00f3d290ba176b40e1">icarus::ns::util::bin</a></div><div class="ttdeci">constexpr details::BinObj&lt; T &gt; bin(T value)</div><div class="ttdoc">Returns a wrapper to print the specified data in binary format. </div></div>
<div class="ttc" id="namespacegeo_1_1fhicl_html_a05ff5cebd7313582756a33d8e8a5971a"><div class="ttname"><a href="../../d2/d66/namespacegeo_1_1fhicl.html#a05ff5cebd7313582756a33d8e8a5971a">geo::fhicl::PlaneID</a></div><div class="ttdeci">IDparameter&lt; geo::PlaneID &gt; PlaneID</div><div class="ttdoc">Member type of validated geo::PlaneID parameter. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddc/geo__types__fhicl_8h_source.html#l00375">geo_types_fhicl.h:375</a></div></div>
<div class="ttc" id="namespacelar_1_1dump_html_a71d4403edbac4d265176f8677118194f"><div class="ttname"><a href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">lar::dump::vector</a></div><div class="ttdeci">auto vector(Vector const &amp;v)</div><div class="ttdoc">Returns a manipulator which will print the specified array. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/DumpUtils_8h_source.html#l00265">DumpUtils.h:265</a></div></div>
<div class="ttc" id="sparse__vector__test_8cc_html_a39f16bf854ba527dee7eba5bbbd93f3f"><div class="ttname"><a href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a></div><div class="ttdeci">T abs(T value)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d59/sparse__vector__test_8cc_source.html#l00030">sparse_vector_test.cc:30</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_abf9168bf6abdd97fa5c39b4f38821b17"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#abf9168bf6abdd97fa5c39b4f38821b17">shower::EMShowerAlg::CheckIsolatedHits_</a></div><div class="ttdeci">void CheckIsolatedHits_(std::map&lt; int, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt;&gt; &amp;showerHitsMap) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l00119">EMShowerAlg.cxx:119</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_a66a212efa45ea778a7cdb0541e4f5c8d"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#a66a212efa45ea778a7cdb0541e4f5c8d">shower::EMShowerAlg::WeightedFit</a></div><div class="ttdeci">Int_t WeightedFit(const Int_t n, const Double_t *x, const Double_t *y, const Double_t *w, Double_t *parm) const </div><div class="ttdoc">&amp;lt;Tingjun to=&amp;quot;&amp;quot; document&amp;gt;=&amp;quot;&amp;quot;&amp;gt; </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l02018">EMShowerAlg.cxx:2018</a></div></div>
<div class="ttc" id="Exceptions_8h_html"><div class="ttname"><a href="../../df/d7c/Exceptions_8h.html">Exceptions.h</a></div><div class="ttdoc">Collection of exceptions for Geometry system. </div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_a451c03e8d71ebc67678ca0dd9a18db46"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#a451c03e8d71ebc67678ca0dd9a18db46">shower::EMShowerAlg::Construct3DPoint_</a></div><div class="ttdeci">TVector3 Construct3DPoint_(detinfo::DetectorPropertiesData const &amp;detProp, art::Ptr&lt; recob::Hit &gt; const &amp;hit1, art::Ptr&lt; recob::Hit &gt; const &amp;hit2) const </div><div class="ttdoc">Constructs a 3D point (in [cm]) to represent the hits given in two views. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l00394">EMShowerAlg.cxx:394</a></div></div>
<div class="ttc" id="run__opflash__electron_8fcl_html_a1e5aaaf25e8609a835e8c7c6fda71456"><div class="ttname"><a href="../../d0/d84/run__opflash__electron_8fcl.html#a1e5aaaf25e8609a835e8c7c6fda71456">y</a></div><div class="ttdeci">process_name opflash particleana ie ie y</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d84/run__opflash__electron_8fcl_source.html#l00091">run_opflash_electron.fcl:91</a></div></div>
<div class="ttc" id="namespacegeo_1_1fhicl_html_a48509e22b6681725c899fc354de43ae2"><div class="ttname"><a href="../../d2/d66/namespacegeo_1_1fhicl.html#a48509e22b6681725c899fc354de43ae2">geo::fhicl::WireID</a></div><div class="ttdeci">IDparameter&lt; geo::WireID &gt; WireID</div><div class="ttdoc">Member type of validated geo::WireID parameter. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddc/geo__types__fhicl_8h_source.html#l00407">geo_types_fhicl.h:407</a></div></div>
<div class="ttc" id="namespacegeo_html_a3b3c27511a16721236b09f14b66a58beafb721fe41f98f339c81e6bc7611820e8"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#a3b3c27511a16721236b09f14b66a58beafb721fe41f98f339c81e6bc7611820e8">geo::kInduction</a></div><div class="ttdoc">Signal from induction planes. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00145">geo_types.h:145</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html">recob::TrackTrajectory</a></div><div class="ttdoc">A trajectory in space reconstructed from hits. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/TrackTrajectory_8h_source.html#l00062">TrackTrajectory.h:62</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_a5c173c4a5ef8331f8e7d546a660d00d1"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#a5c173c4a5ef8331f8e7d546a660d00d1">shower::EMShowerAlg::CheckShowerPlanes</a></div><div class="ttdeci">std::vector&lt; int &gt; CheckShowerPlanes(std::vector&lt; std::vector&lt; int &gt;&gt; const &amp;initialShowers, std::vector&lt; art::Ptr&lt; recob::Cluster &gt;&gt; const &amp;clusters, art::FindManyP&lt; recob::Hit &gt; const &amp;fmh) const </div><div class="ttdoc">Takes the initial showers found and tries to resolve issues where one bad view ruins the event...</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l00294">EMShowerAlg.cxx:294</a></div></div>
<div class="ttc" id="classrecob_1_1Track_html_af3d605dc3abfa9dfc98923bb584beb08"><div class="ttname"><a href="../../d9/dca/classrecob_1_1Track.html#af3d605dc3abfa9dfc98923bb584beb08">recob::Track::Vertex</a></div><div class="ttdeci">Point_t const &amp; Vertex() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d53/bj_2lardataobj_2RecoBase_2Track_8h_source.html#l00124">bj/lardataobj/RecoBase/Track.h:124</a></div></div>
<div class="ttc" id="namespaceicarus_1_1ns_1_1util_html_aac918da84f16d53ad17bab4f817da1c4"><div class="ttname"><a href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">icarus::ns::util::end</a></div><div class="ttdeci">auto end(FixedBins&lt; T, C &gt; const &amp;) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dbd/FixedBins_8h_source.html#l00585">FixedBins.h:585</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_af61f93f824644f41da4ea9b91a20979d"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#af61f93f824644f41da4ea9b91a20979d">shower::EMShowerAlg::ConstructTrack</a></div><div class="ttdeci">std::unique_ptr&lt; recob::Track &gt; ConstructTrack(detinfo::DetectorPropertiesData const &amp;detProp, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; const &amp;track1, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; const &amp;track2, std::map&lt; int, TVector2 &gt; const &amp;showerCentreMap) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l00412">EMShowerAlg.cxx:412</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_a2f7c76aa2451e2ca9dc6a1fbe9ebc96e"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#a2f7c76aa2451e2ca9dc6a1fbe9ebc96e">shower::EMShowerAlg::OrderShowerHits</a></div><div class="ttdeci">std::map&lt; int, std::vector&lt; art::Ptr&lt; recob::Hit &gt; &gt; &gt; OrderShowerHits(detinfo::DetectorPropertiesData const &amp;detProp, art::PtrVector&lt; recob::Hit &gt; const &amp;shower, int plane) const </div><div class="ttdoc">Takes the hits associated with a shower and orders them so they follow the direction of the shower...</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l01372">EMShowerAlg.cxx:1372</a></div></div>
<div class="ttc" id="namespaceutil_1_1quantities_html_a1a08bc762b79d6e1d7816c34d3e36f78"><div class="ttname"><a href="../../d3/d63/namespaceutil_1_1quantities.html#a1a08bc762b79d6e1d7816c34d3e36f78">util::quantities::tick</a></div><div class="ttdeci">tick_as&lt;&gt; tick</div><div class="ttdoc">Tick number, represented by std::ptrdiff_t. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d57/electronics_8h_source.html#l00075">electronics.h:75</a></div></div>
<div class="ttc" id="classdetinfo_1_1DetectorPropertiesData_html_a359d6255bb14f321d76e6085204ea52a"><div class="ttname"><a href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a359d6255bb14f321d76e6085204ea52a">detinfo::DetectorPropertiesData::ConvertXToTicks</a></div><div class="ttdeci">double ConvertXToTicks(double X, int p, int t, int c) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d64/DetectorPropertiesData_8cc_source.html#l00099">DetectorPropertiesData.cc:99</a></div></div>
<div class="ttc" id="structgeo_1_1WireIDIntersection_html"><div class="ttname"><a href="../../da/d3d/structgeo_1_1WireIDIntersection.html">geo::WireIDIntersection</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00803">geo_types.h:803</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_ad88f6dd8025165b026b1dd2767201eec"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#ad88f6dd8025165b026b1dd2767201eec">shower::EMShowerAlg::ShowerHitRMS_</a></div><div class="ttdeci">double ShowerHitRMS_(detinfo::DetectorPropertiesData const &amp;detProp, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; const &amp;showerHits) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l01845">EMShowerAlg.cxx:1845</a></div></div>
<div class="ttc" id="selectors_8fcl_html_aadc113fa4af9aeff01481eed2a98e7cc"><div class="ttname"><a href="../../d9/dd2/selectors_8fcl.html#aadc113fa4af9aeff01481eed2a98e7cc">and</a></div><div class="ttdeci">return match has_match and(match.match_pdg==11 or match.match_pdg==-11)</div></div>
<div class="ttc" id="namespacerecob_1_1tracking_html_a2253bf96e69f939f133551c86bdd2e37"><div class="ttname"><a href="../../d6/d6b/namespacerecob_1_1tracking.html#a2253bf96e69f939f133551c86bdd2e37">recob::tracking::convertCollToPoint</a></div><div class="ttdeci">std::vector&lt; Point_t &gt; convertCollToPoint(std::vector&lt; Point &gt; const &amp;coll)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da9/TrackingTypes_8h_source.html#l00055">TrackingTypes.h:55</a></div></div>
<div class="ttc" id="structgeo_1_1TPCID_html"><div class="ttname"><a href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a></div><div class="ttdoc">The data type to uniquely identify a TPC. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00386">geo_types.h:386</a></div></div>
<div class="ttc" id="structgeo_1_1PlaneID_html_a02c2afa6841ef86ea8ab49478cdf5b29"><div class="ttname"><a href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">geo::PlaneID::Plane</a></div><div class="ttdeci">PlaneID_t Plane</div><div class="ttdoc">Index of the plane within its TPC. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00493">geo_types.h:493</a></div></div>
<div class="ttc" id="EMShowerAlg_8h_html"><div class="ttname"><a href="../../d3/d65/EMShowerAlg_8h.html">EMShowerAlg.h</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_a6855d0ed03aea075aa7a80b06d7a3e2b"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#a6855d0ed03aea075aa7a80b06d7a3e2b">shower::EMShowerAlg::isCleanShower</a></div><div class="ttdeci">bool isCleanShower(std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; const &amp;hits) const </div><div class="ttdoc">&amp;lt;Tingjun to=&amp;quot;&amp;quot; document&amp;gt;=&amp;quot;&amp;quot;&amp;gt; </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l02065">EMShowerAlg.cxx:2065</a></div></div>
<div class="ttc" id="classrecob_1_1Shower_html"><div class="ttname"><a href="../../d4/d14/classrecob_1_1Shower.html">recob::Shower</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d69/Shower_8h_source.html#l00019">Shower.h:19</a></div></div>
<div class="ttc" id="namespacetca_html_a03d7925cba1cd1c5952d280736887b6b"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a03d7925cba1cd1c5952d280736887b6b">tca::dEdx</a></div><div class="ttdeci">float dEdx(detinfo::DetectorClocksData const &amp;clockData, detinfo::DetectorPropertiesData const &amp;detProp, const TCSlice &amp;slc, TP3D &amp;tp3d)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02686">PFPUtils.cxx:2686</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_a92f23d05d7dc718c72aa4918409479b2"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#a92f23d05d7dc718c72aa4918409479b2">shower::EMShowerAlg::Project3DPointOntoPlane_</a></div><div class="ttdeci">TVector2 Project3DPointOntoPlane_(detinfo::DetectorPropertiesData const &amp;detProp, TVector3 const &amp;point, int plane, int cryostat=0) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l01947">EMShowerAlg.cxx:1947</a></div></div>
<div class="ttc" id="namespacegen__crt__frags_html_a8cdc67339147aad209b4122a38d7e246"><div class="ttname"><a href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">gen_crt_frags.w</a></div><div class="ttdeci">tuple w</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d8c/gen__crt__frags_8py_source.html#l01416">gen_crt_frags.py:1416</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_a2f9ef1ea7dcc0cd6b7b17cca1326a669"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#a2f9ef1ea7dcc0cd6b7b17cca1326a669">shower::EMShowerAlg::EMShowerAlg</a></div><div class="ttdeci">EMShowerAlg(fhicl::ParameterSet const &amp;pset, int debug=0)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l00037">EMShowerAlg.cxx:37</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_a1cfae1b378e6c65ba5a6a1b3af4fb678"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#a1cfae1b378e6c65ba5a6a1b3af4fb678">shower::EMShowerAlg::ShowerDirection_</a></div><div class="ttdeci">TVector2 ShowerDirection_(detinfo::DetectorPropertiesData const &amp;detProp, const std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; &amp;showerHits) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l01800">EMShowerAlg.cxx:1800</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_adcd7fc39cb4df63607c7aae53f0a2789"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#adcd7fc39cb4df63607c7aae53f0a2789">shower::EMShowerAlg::FindInitialTrack</a></div><div class="ttdeci">void FindInitialTrack(detinfo::DetectorPropertiesData const &amp;detProp, std::map&lt; int, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt;&gt; const &amp;hits, std::unique_ptr&lt; recob::Track &gt; &amp;initialTrack, std::map&lt; int, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt;&gt; &amp;initialTrackHits, int plane) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l00612">EMShowerAlg.cxx:612</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_a5207fcc2d3eed13fe3f214c81788c016"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#a5207fcc2d3eed13fe3f214c81788c016">shower::EMShowerAlg::CheckShowerHits_</a></div><div class="ttdeci">bool CheckShowerHits_(detinfo::DetectorPropertiesData const &amp;detProp, std::map&lt; int, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt;&gt; const &amp;showerHitsMap) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l00201">EMShowerAlg.cxx:201</a></div></div>
<div class="ttc" id="classdetinfo_1_1DetectorPropertiesData_html_a8e4b4b8d755ffded5a9f956ae7c9c1ec"><div class="ttname"><a href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a8e4b4b8d755ffded5a9f956ae7c9c1ec">detinfo::DetectorPropertiesData::ConvertTicksToX</a></div><div class="ttdeci">double ConvertTicksToX(double ticks, int p, int t, int c) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d64/DetectorPropertiesData_8cc_source.html#l00115">DetectorPropertiesData.cc:115</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_af9f3fea80917997b0e15b341f0c65073"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#af9f3fea80917997b0e15b341f0c65073">shower::EMShowerAlg::OrderShowerHits_</a></div><div class="ttdeci">void OrderShowerHits_(detinfo::DetectorPropertiesData const &amp;detProp, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; const &amp;shower, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; &amp;orderedShower, art::Ptr&lt; recob::Vertex &gt; const &amp;vertex) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l01587">EMShowerAlg.cxx:1587</a></div></div>
<div class="ttc" id="trackfinderalgorithms_8fcl_html_ac996980052e16111a1efc913778a5f5f"><div class="ttname"><a href="../../d2/dbd/trackfinderalgorithms_8fcl.html#ac996980052e16111a1efc913778a5f5f">planes</a></div><div class="ttdeci">BEGIN_PROLOG Z planes</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dbd/trackfinderalgorithms_8fcl_source.html#l00026">trackfinderalgorithms.fcl:26</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_a32ccb98410dcc3d6e259d36adb05aa6c"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#a32ccb98410dcc3d6e259d36adb05aa6c">shower::EMShowerAlg::MakeInitialTrack_</a></div><div class="ttdeci">std::unique_ptr&lt; recob::Track &gt; MakeInitialTrack_(detinfo::DetectorPropertiesData const &amp;detProp, std::map&lt; int, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt;&gt; const &amp;initialHitsMap, std::map&lt; int, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt;&gt; const &amp;showerHitsMap) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l00960">EMShowerAlg.cxx:960</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_a3cae4d7c9ab3440dadfee1638a60f583"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#a3cae4d7c9ab3440dadfee1638a60f583">shower::EMShowerAlg::FinddEdx_</a></div><div class="ttdeci">double FinddEdx_(detinfo::DetectorClocksData const &amp;clockData, detinfo::DetectorPropertiesData const &amp;detProp, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; const &amp;trackHits, std::unique_ptr&lt; recob::Track &gt; const &amp;track) const </div><div class="ttdoc">Finds dE/dx for the track given a set of hits. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l00570">EMShowerAlg.cxx:570</a></div></div>
<div class="ttc" id="classrecob_1_1Hit_html_a46ddaf21b6eec49d205220f7daf3a85c"><div class="ttname"><a href="../../db/d4e/classrecob_1_1Hit.html#a46ddaf21b6eec49d205220f7daf3a85c">recob::Hit::PeakTime</a></div><div class="ttdeci">float PeakTime() const </div><div class="ttdoc">Time of the signal peak, in tick units. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d26/Hit_8h_source.html#l00218">Hit.h:218</a></div></div>
<div class="ttc" id="ToElement_8h_html"><div class="ttname"><a href="../../df/dbc/ToElement_8h.html">ToElement.h</a></div></div>
<div class="ttc" id="classdetinfo_1_1DetectorClocksData_html"><div class="ttname"><a href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html">detinfo::DetectorClocksData</a></div><div class="ttdoc">Contains all timing reference information for the detector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d5b/DetectorClocksData_8h_source.html#l00283">DetectorClocksData.h:283</a></div></div>
<div class="ttc" id="namespacechannelDBConverter_html_a5db4217e69ac7c2d95856da42b13f8e5"><div class="ttname"><a href="../../d4/d43/namespacechannelDBConverter.html#a5db4217e69ac7c2d95856da42b13f8e5">channelDBConverter.values</a></div><div class="ttdeci">list values</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d11/channelDBConverter_8py_source.html#l00248">channelDBConverter.py:248</a></div></div>
<div class="ttc" id="namespaceicarus_1_1trigger_html_a7718dbf2e5e4aa346e7fbabaa451457f"><div class="ttname"><a href="../../dd/df6/namespaceicarus_1_1trigger.html#a7718dbf2e5e4aa346e7fbabaa451457f">icarus::trigger::to_string</a></div><div class="ttdeci">std::string to_string(WindowPattern const &amp;pattern)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d48/WindowPattern_8h_source.html#l00102">WindowPattern.h:102</a></div></div>
<div class="ttc" id="structgeo_1_1WireIDIntersection_html_a10d38a5448d172ff4c9879e0a349fbc3"><div class="ttname"><a href="../../da/d3d/structgeo_1_1WireIDIntersection.html#a10d38a5448d172ff4c9879e0a349fbc3">geo::WireIDIntersection::y</a></div><div class="ttdeci">double y</div><div class="ttdoc">y position of intersection </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00804">geo_types.h:804</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_adb661b6d325aef55d4b9b36f4860149f"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#adb661b6d325aef55d4b9b36f4860149f">shower::EMShowerAlg::HitCoordinates_</a></div><div class="ttdeci">TVector2 HitCoordinates_(recob::Hit const &amp;hit) const </div><div class="ttdoc">Return the coordinates of this hit in global wire/tick space. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l01683">EMShowerAlg.cxx:1683</a></div></div>
<div class="ttc" id="namespacelar_1_1util_html_a6788fc3784bdf9eff832087f034412bb"><div class="ttname"><a href="../../d9/d3d/namespacelar_1_1util.html#a6788fc3784bdf9eff832087f034412bb">lar::util::TrackPitchInView</a></div><div class="ttdeci">double TrackPitchInView(recob::Track const &amp;track, geo::View_t view, size_t trajectory_point=0U)</div><div class="ttdoc">Returns the projected length of track on a wire pitch step [cm]. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd9/TrackUtils_8cxx_source.html#l00078">TrackUtils.cxx:78</a></div></div>
<div class="ttc" id="updateVersionList_8sh_html_a067a8c1534d6da9b2c501a6cf4ef89bd"><div class="ttname"><a href="../../d4/dca/updateVersionList_8sh.html#a067a8c1534d6da9b2c501a6cf4ef89bd">e</a></div><div class="ttdeci">do i e</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/updateVersionList_8sh_source.html#l00068">updateVersionList.sh:68</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_a8ef060a8aad9418d7034b06bbc47b675"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#a8ef060a8aad9418d7034b06bbc47b675">shower::EMShowerAlg::FindOrderOfHits_</a></div><div class="ttdeci">std::vector&lt; art::Ptr&lt; recob::Hit &gt; &gt; FindOrderOfHits_(detinfo::DetectorPropertiesData const &amp;detProp, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; const &amp;hits, bool perpendicular=false) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l00659">EMShowerAlg.cxx:659</a></div></div>
<div class="ttc" id="classgeo_1_1InvalidWireError_html"><div class="ttname"><a href="../../d6/d6c/classgeo_1_1InvalidWireError.html">geo::InvalidWireError</a></div><div class="ttdoc">Exception thrown on invalid wire number. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d7c/Exceptions_8h_source.html#l00042">Exceptions.h:42</a></div></div>
<div class="ttc" id="pmtsimulation__icarus_8fcl_html_a9fc569190f32b40862f18ac3c03a8e49"><div class="ttname"><a href="../../da/d36/pmtsimulation__icarus_8fcl.html#a9fc569190f32b40862f18ac3c03a8e49">value</a></div><div class="ttdeci">temporary value</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d36/pmtsimulation__icarus_8fcl_source.html#l00158">pmtsimulation_icarus.fcl:158</a></div></div>
<div class="ttc" id="namespacegeo_1_1fhicl_html_a526fdd18f5e73f8f37d263e9b230165c"><div class="ttname"><a href="../../d2/d66/namespacegeo_1_1fhicl.html#a526fdd18f5e73f8f37d263e9b230165c">geo::fhicl::TPCID</a></div><div class="ttdeci">IDparameter&lt; geo::TPCID &gt; TPCID</div><div class="ttdoc">Member type of validated geo::TPCID parameter. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddc/geo__types__fhicl_8h_source.html#l00311">geo_types_fhicl.h:311</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_a8cc3b4c212645850e571159628cd6576"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#a8cc3b4c212645850e571159628cd6576">shower::EMShowerAlg::RelativeWireWidth_</a></div><div class="ttdeci">std::map&lt; double, int &gt; RelativeWireWidth_(const std::map&lt; int, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt;&gt; &amp;showerHitsMap) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l01760">EMShowerAlg.cxx:1760</a></div></div>
<div class="ttc" id="classrecob_1_1Hit_html"><div class="ttname"><a href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a></div><div class="ttdoc">2D representation of charge deposited in the TDC/wire plane </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d26/Hit_8h_source.html#l00048">Hit.h:48</a></div></div>
<div class="ttc" id="structgeo_1_1WireID_html_ada0a7c63318565f37beaf5894f8172ea"><div class="ttname"><a href="../../de/db1/structgeo_1_1WireID.html#ada0a7c63318565f37beaf5894f8172ea">geo::WireID::planeID</a></div><div class="ttdeci">constexpr PlaneID const &amp; planeID() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00638">geo_types.h:638</a></div></div>
<div class="ttc" id="IntegerRanges__test_8cc_html_abbc7e5f346bfa932ca51b4b07ccef76d"><div class="ttname"><a href="../../db/df5/IntegerRanges__test_8cc.html#abbc7e5f346bfa932ca51b4b07ccef76d">count</a></div><div class="ttdeci">std::size_t count(Cont const &amp;cont)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df5/IntegerRanges__test_8cc_source.html#l00029">IntegerRanges_test.cc:29</a></div></div>
<div class="ttc" id="structgeo_1_1TPCID_html_a4a7f86b46d9d48a040b7ef5d65973811"><div class="ttname"><a href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">geo::TPCID::TPC</a></div><div class="ttdeci">TPCID_t TPC</div><div class="ttdoc">Index of the TPC within its cryostat. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00406">geo_types.h:406</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a61676c8fb2963a14f6497d47b490296e"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a61676c8fb2963a14f6497d47b490296e">pma::Track3D::size</a></div><div class="ttdeci">size_t size() const </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/PmaTrack3D_8h_source.html#l00108">PmaTrack3D.h:108</a></div></div>
<div class="ttc" id="classgeo_1_1InvalidWireError_html_a174c7f48dc6c32f680e033c960fbc9eb"><div class="ttname"><a href="../../d6/d6c/classgeo_1_1InvalidWireError.html#a174c7f48dc6c32f680e033c960fbc9eb">geo::InvalidWireError::suggestedWireID</a></div><div class="ttdeci">geo::WireID suggestedWireID() const </div><div class="ttdoc">Returns a better wire ID. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d7c/Exceptions_8h_source.html#l00120">Exceptions.h:120</a></div></div>
<div class="ttc" id="namespaceicarus_1_1ns_1_1util_html_a74da18d4f0023feee71c1352a99b3910"><div class="ttname"><a href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#a74da18d4f0023feee71c1352a99b3910">icarus::ns::util::empty</a></div><div class="ttdeci">bool empty(FixedBins&lt; T, C &gt; const &amp;) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dbd/FixedBins_8h_source.html#l00555">FixedBins.h:555</a></div></div>
<div class="ttc" id="TrackUtils_8h_html"><div class="ttname"><a href="../../d2/d97/TrackUtils_8h.html">TrackUtils.h</a></div><div class="ttdoc">Utility functions to extract information from recob::Track </div></div>
<div class="ttc" id="namespacechannelDBConverter_html_ab6cfbbcbb53c275375289d47dec67f46"><div class="ttname"><a href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">channelDBConverter.n</a></div><div class="ttdeci">int n</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d11/channelDBConverter_8py_source.html#l00249">channelDBConverter.py:249</a></div></div>
<div class="ttc" id="messageservice_8fcl_html_a6699b4dbd72f548e48d81c88697d35a6"><div class="ttname"><a href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">cout</a></div><div class="ttdeci">BEGIN_PROLOG could also be cout</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/df5/messageservice_8fcl_source.html#l00010">messageservice.fcl:10</a></div></div>
<div class="ttc" id="namespacedetsim_html_a560adbb3abf95a23d45a53ed25d8c0c7"><div class="ttname"><a href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detsim::detProp</a></div><div class="ttdeci">auto const detProp</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/SimWire__module_8cc_source.html#l00154">SimWire_module.cc:154</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_a23d09637ff2c64a1f60c936a665ac90a"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#a23d09637ff2c64a1f60c936a665ac90a">shower::EMShowerAlg::FindShowerStart_</a></div><div class="ttdeci">std::map&lt; int, std::vector&lt; art::Ptr&lt; recob::Hit &gt; &gt; &gt; FindShowerStart_(std::map&lt; int, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt;&gt; const &amp;orderedShowerMap) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l00757">EMShowerAlg.cxx:757</a></div></div>
<div class="ttc" id="classshower_1_1EMShowerAlg_html_a69f9a3937084f1748ab44be94e62fa19"><div class="ttname"><a href="../../d5/d77/classshower_1_1EMShowerAlg.html#a69f9a3937084f1748ab44be94e62fa19">shower::EMShowerAlg::ShowerHitRMSGradient_</a></div><div class="ttdeci">double ShowerHitRMSGradient_(detinfo::DetectorPropertiesData const &amp;detProp, const std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; &amp;showerHits) const </div><div class="ttdoc">Returns the gradient of the RMS vs shower segment graph. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/EMShowerAlg_8cxx_source.html#l01865">EMShowerAlg.cxx:1865</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
