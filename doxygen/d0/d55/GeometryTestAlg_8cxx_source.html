<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>GeometryTestAlg.cxx Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_b73b02d482d1c4a3db20c3d9ad52d395.html">srcs</a></li><li class="navelem"><a class="el" href="../../dir_0d059e244e4aff9e806074c98175a747.html">larcorealg</a></li><li class="navelem"><a class="el" href="../../dir_534b16e8198e7fb746c47cd96aa3139d.html">test</a></li><li class="navelem"><a class="el" href="../../dir_0073c32e6d508b6f01e92ece5c0612cb.html">Geometry</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">GeometryTestAlg.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d0/d55/GeometryTestAlg_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * @file   GeometryTestAlg.cxx</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * @brief  Unit test for geometry functionalities: implementation file</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * @date   2011/02/17</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * @author brebel@fnal.gov</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * @see    GeometryTestAlg.h</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// our header</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/db1/GeometryTestAlg_8h.html">test/Geometry/GeometryTestAlg.h</a>&quot;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// LArSoft includes</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/dc6/Decomposer_8h.html">larcorealg/Geometry/Decomposer.h</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d7c/Exceptions_8h.html">larcorealg/Geometry/Exceptions.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d79/SimpleGeo_8h.html">larcorealg/Geometry/SimpleGeo.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/de7/GeometryCore_8h.html">larcorealg/Geometry/GeometryCore.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d13/CryostatGeo_8h.html">larcorealg/Geometry/CryostatGeo.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/de9/TPCGeo_8h.html">larcorealg/Geometry/TPCGeo.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d80/PlaneGeo_8h.html">larcorealg/Geometry/PlaneGeo.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/de5/WireGeo_8h.html">larcorealg/Geometry/WireGeo.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/d8a/AuxDetGeo_8h.html">larcorealg/Geometry/AuxDetGeo.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d42/AuxDetSensitiveGeo_8h.html">larcorealg/Geometry/AuxDetSensitiveGeo.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d35/geo_8h.html">larcorealg/Geometry/geo.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d6c/geo__vectors__utils_8h.html">larcorealg/Geometry/geo_vectors_utils.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/dbc/RealComparisons_8h.html">larcorealg/CoreUtils/RealComparisons.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/da9/DumpUtils_8h.html">larcorealg/CoreUtils/DumpUtils.h</a>&quot;</span> <span class="comment">// lar::dump::vector3D(), ...</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d7d/geo__vectors_8h.html">larcoreobj/SimpleTypesAndConstants/geo_vectors.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/d64/readout__types_8h.html">larcoreobj/SimpleTypesAndConstants/readout_types.h</a>&quot;</span> <span class="comment">// readout::ROPID</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/d38/RawTypes_8h.html">larcoreobj/SimpleTypesAndConstants/RawTypes.h</a>&quot;</span> <span class="comment">// raw::ChannelID_t</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d48/geo__types_8h.html">larcoreobj/SimpleTypesAndConstants/geo_types.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d09/PhysicalConstants_8h.html">larcoreobj/SimpleTypesAndConstants/PhysicalConstants.h</a>&quot;</span> <span class="comment">// util::pi&lt;&gt;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">// Framework includes</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;cetlib/pow.h&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;cetlib_except/exception.h&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;fhiclcpp/ParameterSet.h&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;messagefacility/MessageLogger/MessageLogger.h&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">// ROOT includes</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;TGeoManager.h&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;TStopwatch.h&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;TGeoNode.h&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;TGeoVolume.h&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;TClass.h&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;Math/GenVector/DisplacementVector2D.h&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;Math/GenVector/DisplacementVector3D.h&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;Math/GenVector/PositionVector3D.h&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;RtypesCore.h&quot;</span>                                            <span class="comment">// for kTRUE</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;TGeoMaterial.h&quot;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;TGeoMatrix.h&quot;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;TGeoShape.h&quot;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;TObjArray.h&quot;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;TVector2.h&quot;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">// C/C++ standard libraries</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span>                                                <span class="comment">// for abort</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &lt;iterator&gt;</span> <span class="comment">// std::inserter()</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span> <span class="comment">// std::copy()</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &lt;set&gt;</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &lt;array&gt;</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#include &lt;limits&gt;</span> <span class="comment">// std::numeric_limits&lt;&gt;</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#include &lt;initializer_list&gt;</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">// custom stream insertion operators; they need to be defined in the &quot;right&quot;</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">// namespace</span></div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="../../d0/d55/GeometryTestAlg_8cxx.html#ae466a05359ccafa03231cacc5ac22c6b">   75</a></span>&#160;std::ostream&amp; <a class="code" href="../../df/da7/classlar_1_1example_1_1CheatTrack.html#ad5c74ca7059340da77c10d9ba1b01601">operator&lt;&lt; </a>(std::ostream&amp; out, TVector3 <span class="keyword">const</span>&amp; v) {</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  out &lt;&lt; <span class="stringliteral">&quot;( &quot;</span> &lt;&lt; v.X() &lt;&lt; <span class="stringliteral">&quot; ; &quot;</span> &lt;&lt; v.Y() &lt;&lt; <span class="stringliteral">&quot; ; &quot;</span> &lt;&lt; v.Z() &lt;&lt; <span class="stringliteral">&quot; )&quot;</span>;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="keywordflow">return</span> out;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;} <span class="comment">// operator&lt;&lt; (TVector3)</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="../../d0/d55/GeometryTestAlg_8cxx.html#aca2d3aee92d425789012374d12aa0f96">   80</a></span>&#160;std::ostream&amp; <a class="code" href="../../df/da7/classlar_1_1example_1_1CheatTrack.html#ad5c74ca7059340da77c10d9ba1b01601">operator&lt;&lt; </a>(std::ostream&amp; out, TVector2 <span class="keyword">const</span>&amp; v) {</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  out &lt;&lt; <span class="stringliteral">&quot;( &quot;</span> &lt;&lt; v.X() &lt;&lt; <span class="stringliteral">&quot; ; &quot;</span> &lt;&lt; v.Y() &lt;&lt; <span class="stringliteral">&quot; )&quot;</span>;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keywordflow">return</span> out;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;} <span class="comment">// operator&lt;&lt; (TVector2)</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">  /// Returns whether the CET exception e contains the specified category cat</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> hasCategory(cet::exception <span class="keyword">const</span>&amp; <a class="code" href="../../d4/dca/updateVersionList_8sh.html#a067a8c1534d6da9b2c501a6cf4ef89bd">e</a>, std::string <span class="keyword">const</span>&amp; cat) {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; e_category: e.history())</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      <span class="keywordflow">if</span> (e_category == cat) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  } <span class="comment">// hasCategory()</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">  /// Returns a convenience string for the specified direction</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment"></span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Vector&gt;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  std::string directionName(Vector <span class="keyword">const</span>&amp; v) {</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">if</span> (v == geo::Xaxis&lt;Vector&gt;()) <span class="keywordflow">return</span> <span class="stringliteral">&quot;x&quot;</span>;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordflow">if</span> (v == geo::Yaxis&lt;Vector&gt;()) <span class="keywordflow">return</span> <span class="stringliteral">&quot;y&quot;</span>;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordflow">if</span> (v == geo::Zaxis&lt;Vector&gt;()) <span class="keywordflow">return</span> <span class="stringliteral">&quot;z&quot;</span>;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keywordflow">if</span> (v == -geo::Xaxis&lt;Vector&gt;()) <span class="keywordflow">return</span> <span class="stringliteral">&quot;-x&quot;</span>;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordflow">if</span> (v == -geo::Yaxis&lt;Vector&gt;()) <span class="keywordflow">return</span> <span class="stringliteral">&quot;-y&quot;</span>;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keywordflow">if</span> (v == -geo::Zaxis&lt;Vector&gt;()) <span class="keywordflow">return</span> <span class="stringliteral">&quot;-z&quot;</span>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    std::ostringstream sstr;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    sstr &lt;&lt; v;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordflow">return</span> sstr.str();</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  } <span class="comment">// directionName()</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;} <span class="comment">// local namespace</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="keyword">namespace </span>geo{</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#aea9c4e05f9e485d9e0b6715d6d9b25fb">  118</a></span>&#160;  <a class="code" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#aea9c4e05f9e485d9e0b6715d6d9b25fb">GeometryTestAlg::GeometryTestAlg</a>(fhicl::ParameterSet <span class="keyword">const</span>&amp; pset)</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    : geom(nullptr)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    , fDisableValidWireIDcheck( pset.<a class="code" href="../../db/d87/PMTconfigurationExtraction__module_8cc.html#ac33ee765f5ad9f134540bac393721cfe">get</a>&lt;<a class="code" href="../../d7/d6f/namespacelarg4.html#a42b3ada02e272fe2fa2b641ba06ab7d4">bool</a>&gt;(<span class="stringliteral">&quot;DisableWireBoundaryCheck&quot;</span>, <a class="code" href="../../d7/d6f/namespacelarg4.html#a7eeba60c219f2d1b4094606a12d28d18">false</a>) )</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    , fExpectedWirePitches( pset.<a class="code" href="../../db/d87/PMTconfigurationExtraction__module_8cc.html#ac33ee765f5ad9f134540bac393721cfe">get</a>&lt;<a class="code" href="../../da/dc9/namespacepmtana.html#a9860e62c78db1dd9c7d635a2832b883a">std</a>::<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">vector</a>&lt;double&gt;&gt;(<span class="stringliteral">&quot;ExpectedWirePitches&quot;</span>, {}) )</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    , <a class="code" href="../../d6/d23/namespacegeo.html#af19a06f2c5c02e369b7a622e385fddec">fExpectedPlanePitches</a>( pset.get&lt;std::vector&lt;double&gt;&gt;(<span class="stringliteral">&quot;ExpectedPlanePitches&quot;</span>, {}) )</div>
<div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="../../d6/d23/namespacegeo.html#a4234220f2d709cfac66fac07972f6242">  123</a></span>&#160;    , <a class="code" href="../../d6/d23/namespacegeo.html#a4234220f2d709cfac66fac07972f6242">fComputeMass</a>( pset.get(<span class="stringliteral">&quot;ComputeMass&quot;</span>, <span class="keyword">true</span>) )</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">// initialize the list of non-fatal exceptions</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    std::vector&lt;std::string&gt; NonFatalErrors(pset.get&lt;std::vector&lt;std::string&gt;&gt;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      (<span class="stringliteral">&quot;ForgiveExceptions&quot;</span>, std::vector&lt;std::string&gt;()));</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <a class="code" href="../../d6/dd6/RangeForWrapper__test_8cc.html#a2a47a7f29f0ddd7ff5d68f8aff63125c">std::copy</a>(NonFatalErrors.begin(), NonFatalErrors.end(),</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      std::inserter(fNonFatalExceptions, fNonFatalExceptions.end()));</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">// initialize the list of tests to be run</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="comment">// our name selector accepts everything by default;</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="comment">// the default set skips the following:</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    fRunTests.AddToDefinition(<span class="stringliteral">&quot;default&quot;</span>,</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      <span class="stringliteral">&quot;-CheckOverlaps&quot;</span>, <span class="stringliteral">&quot;-ThoroughCheck&quot;</span>, <span class="stringliteral">&quot;-PrintWires&quot;</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      );</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    fRunTests.ParseNames(<span class="stringliteral">&quot;@default&quot;</span>); <span class="comment">// let&#39;s start from default</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">// read and parse the test list from the configuration parameters (if any)</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    fRunTests.Parse(pset.get&lt;std::vector&lt;std::string&gt;&gt;(<span class="stringliteral">&quot;RunTests&quot;</span>, {}));</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    std::ostringstream sstr;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    fRunTests.PrintConfiguration(sstr);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    mf::LogInfo(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Test selection:&quot;</span> &lt;&lt; sstr.str();</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  } <span class="comment">// GeometryTestAlg::GeometryTestAlg()</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a6667f9aa5a16f62a5feffdb9c03d1883">  151</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> GeometryTestAlg::Run()</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  {</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordflow">if</span> (!geom) {</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;GeometryTestAlg not configured: no valid geometry provided.\n&quot;</span>;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a> = 0; <span class="comment">// currently unused</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="comment">// change the printed version number when changing the &quot;GeometryTest&quot; output</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">// Version 1.1:</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="comment">//   more TPC information when printing all geometry</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;GeometryTest version 1.1&quot;</span>;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    mf::LogInfo(<span class="stringliteral">&quot;GeometryTestInfo&quot;</span>)</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Running on detector: &#39;&quot;</span> &lt;&lt; geom-&gt;DetectorName() &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;  Running on detector: &#39;&quot;</span> &lt;&lt; geom-&gt;DetectorName() &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;\nGeometry file: &quot;</span> &lt;&lt; geom-&gt;ROOTFile();</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordflow">try</span>{</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;DetectorIntro&quot;</span>)) {</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;detector introduction:&quot;</span>;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        printDetectorIntro();</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      }</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;CheckOverlaps&quot;</span>)) {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;test for overlaps ...&quot;</span>;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        gGeoManager-&gt;CheckOverlaps(1e-5);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        gGeoManager-&gt;PrintOverlaps();</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="keywordflow">if</span> (!gGeoManager-&gt;GetListOfOverlaps()-&gt;IsEmpty()) {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;          mf::LogError(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            &lt;&lt; gGeoManager-&gt;GetListOfOverlaps()-&gt;GetSize()</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; overlaps found in geometry during overlap test!&quot;</span>;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;          ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        }</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      }</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;ThoroughCheck&quot;</span>)) {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;thorough geometry test ...&quot;</span>;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        gGeoManager-&gt;CheckGeometryFull();</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="keywordflow">if</span> (!gGeoManager-&gt;GetListOfOverlaps()-&gt;IsEmpty()) {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;          mf::LogError(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            &lt;&lt; gGeoManager-&gt;GetListOfOverlaps()-&gt;GetSize()</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; overlaps found in geometry during thorough test!&quot;</span>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;          ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      }</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;Cryostat&quot;</span>)) {</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;test Cryostat methods ...&quot;</span>;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        testCryostat();</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;FindVolumes&quot;</span>)) {</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;test FindAllVolumes method ...&quot;</span>;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        testFindVolumes();</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;PlaneDirections&quot;</span>)) {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;test plane directions...&quot;</span>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        testPlaneDirections();</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      }</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;WireOrientations&quot;</span>)) {</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;test wire orientations...&quot;</span>;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        testWireOrientations();</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      }</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;ChannelToROP&quot;</span>)) {</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;test channel to ROP and back ...&quot;</span>;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        testChannelToROP();</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;ChannelToWire&quot;</span>)) {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;test channel to plane wire and back ...&quot;</span>;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        testChannelToWire();</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;FindPlaneCenters&quot;</span>)) {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;test find plane centers...&quot;</span>;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        testFindPlaneCenters();</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      }</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;WireCoordFromPlane&quot;</span>)) {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;test PlaneGeo::WireCoordinate...&quot;</span>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        testWireCoordFromPlane();</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      }</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;ParallelWires&quot;</span>)) {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;test wire parallelism...&quot;</span>;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        testParallelWires();</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      }</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;PlanePointDecomposition&quot;</span>)) {</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;test plane point decomposition...&quot;</span>;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        testPlanePointDecomposition();</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;PlaneProjections&quot;</span>)) {</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;test PlaneGeo::PointProjection...&quot;</span>;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        testPlaneProjection();</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      }</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;WireCoordAngle&quot;</span>)) {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;testWireCoordAngle...&quot;</span>;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        testWireCoordAngle();</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;Projection&quot;</span>)) {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;testProject...&quot;</span>;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        testProject();</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      }</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;WirePos&quot;</span>)) {</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;testWirePos...&quot;</span>;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="comment">// There is a contradiction here, and these must be tested differently</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="comment">// Testing based on detector ID should NOT become common practice</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;disabled.&quot;</span>;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;NearestWire&quot;</span>)) {</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;testNearestWire...&quot;</span>;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        testNearestWire();</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      }</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;WireIntersection&quot;</span>)) {</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;testWireIntersection...&quot;</span>;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        testWireIntersection();</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;testWireIntersection complete&quot;</span>;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      }</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;ThirdPlane&quot;</span>)) {</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;testThirdPlane...&quot;</span>;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        testThirdPlane();</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;ThirdPlaneSlope&quot;</span>)) {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;testThirdPlaneSlope...&quot;</span>;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        testThirdPlane_dTdW();</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;WirePitch&quot;</span>)) {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;testWirePitch...&quot;</span>;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        testWirePitch();</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      }</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;InterWireProjectedDistance&quot;</span>)) {</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;testInterWireProjectedDistance...&quot;</span>;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        testInterWireProjectedDistance();</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      }</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;PlanePitch&quot;</span>)) {</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;testPlanePitch...&quot;</span>;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        testPlanePitch();</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      }</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;Stepping&quot;</span>)) {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;testStepping...&quot;</span>;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        testStepping();</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      }</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;FindAuxDet&quot;</span>)) {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;testFindAuxDet...&quot;</span>;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        testFindAuxDet();</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      }</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <span class="keywordflow">if</span> (shouldRunTests(<span class="stringliteral">&quot;PrintWires&quot;</span>)) {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;printAllGeometry...&quot;</span>;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        printAllGeometry();</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        MF_LOG_INFO(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;complete.&quot;</span>;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      }</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    }</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">catch</span> (cet::exception &amp;e) {</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      mf::LogWarning(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;exception caught: \n&quot;</span> &lt;&lt; <a class="code" href="../../d4/dca/updateVersionList_8sh.html#a067a8c1534d6da9b2c501a6cf4ef89bd">e</a>;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      <span class="keywordflow">if</span> (fNonFatalExceptions.count(e.category()) == 0) <span class="keywordflow">throw</span>;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    }</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    std::ostringstream out;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">if</span> (!fRunTests.CheckQueryRegistry(out)) {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;(postumous) configuration error detected!\n&quot;</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        &lt;&lt; out.str();</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    mf::LogInfo log(<span class="stringliteral">&quot;GeometryTest&quot;</span>);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    log &lt;&lt; <span class="stringliteral">&quot;Tests completed:&quot;</span>;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keyword">auto</span> tests_run = fRunTests.AcceptedNames();</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">if</span> (tests_run.empty()) {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      log &lt;&lt; <span class="stringliteral">&quot;\n  no test run&quot;</span>;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    }</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      log &lt;&lt; <span class="stringliteral">&quot;\n  &quot;</span> &lt;&lt; tests_run.size() &lt;&lt; <span class="stringliteral">&quot; tests run:\t &quot;</span>;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <span class="keywordflow">for</span> (std::string <span class="keyword">const</span>&amp; test_name: tests_run) log &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; test_name;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    }</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keyword">auto</span> tests_skipped = fRunTests.RejectedNames();</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordflow">if</span> (!tests_skipped.empty()) {</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      log &lt;&lt; <span class="stringliteral">&quot;\n  &quot;</span> &lt;&lt; tests_skipped.size() &lt;&lt; <span class="stringliteral">&quot; tests skipped:\t &quot;</span>;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      <span class="keywordflow">for</span> (std::string <span class="keyword">const</span>&amp; test_name: tests_skipped) log &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; test_name;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  } <span class="comment">// GeometryTestAlg::Run()</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l00386"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a566c2d04ee641516028a8ff148b5f564">  386</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::printDetectorIntro()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <a class="code" href="../../de/dce/classgeo_1_1WireGeo.html">geo::WireGeo</a> <span class="keyword">const</span>&amp; testWire = geom-&gt;Wire(<a class="code" href="../../de/db1/structgeo_1_1WireID.html">geo::WireID</a>(0, 0, 1, 10));</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    mf::LogVerbatim log(<span class="stringliteral">&quot;GeometryTest&quot;</span>);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    log</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      &lt;&lt;   <span class="stringliteral">&quot;Wire Rmax  &quot;</span>         &lt;&lt; testWire.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#a162867ce18b2425721ef51e5ea494485">RMax</a>()</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;\nWire length &quot;</span>        &lt;&lt; 2.*testWire.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#a9e88c4815131ef71cf08acc7328e0624">HalfL</a>()</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;\nWire Rmin  &quot;</span>         &lt;&lt; testWire.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#a71da85277bdfa6b70894d3b32bb4a179">RMin</a>()</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      ;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/d23/namespacegeo.html#a4234220f2d709cfac66fac07972f6242">fComputeMass</a>) {</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      log</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;\nTotal mass &quot;</span>         &lt;&lt; geom-&gt;TotalMass();</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    }</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    log</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;\nNumber of views &quot;</span>    &lt;&lt; geom-&gt;Nviews()</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;\nNumber of channels &quot;</span> &lt;&lt; geom-&gt;Nchannels()</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;\nMaximum number of:&quot;</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;\n  TPC in a cryostat: &quot;</span> &lt;&lt; geom-&gt;MaxTPCs()</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;\n  planes in a TPC:   &quot;</span> &lt;&lt; geom-&gt;MaxPlanes()</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;\n  wires in a plane:  &quot;</span> &lt;&lt; geom-&gt;MaxWires()</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;\nTotal number of TPCs &quot;</span> &lt;&lt; geom-&gt;TotalNTPC()</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;\nAuxiliary detectors  &quot;</span> &lt;&lt; geom-&gt;NAuxDets()</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      ;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  } <span class="comment">// GeometryTestAlg::printDetectorIntro()</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l00416"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a8590da2f98d07a27c5209128c84490ec">  416</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::printChannelSummary()</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> OneSeg = 0;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> TwoSegs = 0;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ThreeSegs = 0;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> FourSegs = 0;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    uint32_t channels = geom-&gt;Nchannels();</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordflow">if</span>(geom-&gt;NTPC() &gt; 1) channels /= geom-&gt;NTPC()/2;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordflow">for</span>(uint32_t c = 0; c &lt; channels; c++){</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ChanSize = geom-&gt;ChannelToWire(c).size();</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;       <span class="keywordflow">if</span>     (ChanSize==1) ++OneSeg;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ChanSize==2) ++TwoSegs;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ChanSize==3) ++ThreeSegs;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ChanSize==4) ++FourSegs;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;     mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;OneSeg: &quot;</span>       &lt;&lt; OneSeg</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                                     &lt;&lt; <span class="stringliteral">&quot;,  TwoSegs: &quot;</span>   &lt;&lt; TwoSegs</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                                     &lt;&lt; <span class="stringliteral">&quot;,  ThreeSegs: &quot;</span> &lt;&lt; ThreeSegs</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                                     &lt;&lt; <span class="stringliteral">&quot;,  FourSegs: &quot;</span>  &lt;&lt; FourSegs;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  }</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l00444"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a5388cfd8c1daa7ace87dfd426a377ea3">  444</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::printVolBounds()</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      <span class="keywordtype">double</span> <a class="code" href="../../d6/d23/namespacegeo.html#a6155d04d62c8bb11135137324ab26b5c">origin</a>[3] = {0.};</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      <span class="keywordtype">double</span> world[3] = {0.};</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = 0; c &lt; geom-&gt;Ncryostats(); ++c){</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        geom-&gt;Cryostat(c).LocalToWorld(origin, world);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Cryo &quot;</span> &lt;&lt; c;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;    -x: &quot;</span> &lt;&lt; world[0] - geom-&gt;Cryostat(c).HalfWidth();</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;    +x: &quot;</span> &lt;&lt; world[0] + geom-&gt;Cryostat(c).HalfWidth();</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;    -y: &quot;</span> &lt;&lt; world[1] - geom-&gt;Cryostat(c).HalfHeight();</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;    +y: &quot;</span> &lt;&lt; world[1] + geom-&gt;Cryostat(c).HalfHeight();</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;    -z: &quot;</span> &lt;&lt; world[2] - geom-&gt;Cryostat(c).Length()/2;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;    +z: &quot;</span> &lt;&lt; world[2] + geom-&gt;Cryostat(c).Length()/2;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> t = 0; t &lt; geom-&gt;NTPC(c); ++t){</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;          geom-&gt;Cryostat(c).TPC(t).LocalToWorld(origin, world);</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;          mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;  TPC &quot;</span> &lt;&lt; t;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;          mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;    -x: &quot;</span> &lt;&lt; world[0] - geom-&gt;Cryostat(c).TPC(t).HalfWidth();</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;          mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;    +x: &quot;</span> &lt;&lt; world[0] + geom-&gt;Cryostat(c).TPC(t).HalfWidth();</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;          mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;    -y: &quot;</span> &lt;&lt; world[1] - geom-&gt;Cryostat(c).TPC(t).HalfHeight();</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;          mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;    +y: &quot;</span> &lt;&lt; world[1] + geom-&gt;Cryostat(c).TPC(t).HalfHeight();</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;          mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;    -z: &quot;</span> &lt;&lt; world[2] - geom-&gt;Cryostat(c).TPC(t).Length()/2;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;          mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;    +z: &quot;</span> &lt;&lt; world[2] + geom-&gt;Cryostat(c).TPC(t).Length()/2;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        }</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      }</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  }</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="comment">// great sanity check for geometry, only call in analyze when debugging</span></div>
<div class="line"><a name="l00478"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a8f64a043dcf22241168c1be08d06e6a9">  478</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::printDetDim()</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  {</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = 0; c &lt; geom-&gt;Ncryostats(); ++c){</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Cryo &quot;</span> &lt;&lt; c;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;    width: &quot;</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                                      &lt;&lt; geom-&gt;CryostatHalfWidth(c);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;    height: &quot;</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                                      &lt;&lt; geom-&gt;CryostatHalfHeight(c);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;    length: &quot;</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                                      &lt;&lt; geom-&gt;CryostatLength(c);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;  TPC 0&quot;</span>;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;    width: &quot;</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                                      &lt;&lt; geom-&gt;DetHalfWidth(0,c);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;    height: &quot;</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                                      &lt;&lt; geom-&gt;DetHalfHeight(0,c);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;    length: &quot;</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                                      &lt;&lt; geom-&gt;DetLength(0,c);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    }</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  }</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="comment">// great sanity check for volume sorting, only call in analyze when debugging</span></div>
<div class="line"><a name="l00502"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#ad5399957e2cd2845bd4d8f58149e2645">  502</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::printWirePos()</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cs = 0;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> t=0; t&lt;std::floor(geom-&gt;NTPC()/12)+1; ++t){</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>=0; <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>&lt;3; ++<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>){</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">w</a>=0; <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">w</a>&lt;geom-&gt;Cryostat(0).TPC(t).Plane(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>).Nwires(); <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">w</a>++){</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;          <span class="keywordtype">double</span> xyz[3] = {0.};</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;          geom-&gt;Cryostat(0).TPC(t).Plane(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>).Wire(<a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">w</a>).GetCenter(xyz);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;          <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;WireID (&quot;</span> &lt;&lt; cs &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; t &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">w</a></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;):  x = &quot;</span> &lt;&lt; xyz[0]</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;, y = &quot;</span> &lt;&lt; xyz[1]</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;, z = &quot;</span> &lt;&lt; xyz[2] &lt;&lt; std::endl;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        }</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      }</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    }</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  }</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="comment">// great insanity: print all wires in a TPC</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::printWiresInTPC</div>
<div class="line"><a name="l00525"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a38b543697d8d55b6e1401d101f3d5d18">  525</a></span>&#160;    (<span class="keyword">const</span> <a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html">geo::TPCGeo</a>&amp; tpc, std::string indent <span class="comment">/* = &quot;&quot; */</span>) <span class="keyword">const</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  {</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nPlanes = tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#ab3391de99203f6a60eeeef152d3adb35">Nplanes</a>();</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a424e1ebac0e28e3a1c6fe14604452ddf">PrintTPCInfo</a>(</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; indent,</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      indent, <a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a5a41751322380e4a0c33b6bb30489f28">geo::TPCGeo::MaxVerbosity</a></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      );</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> = 0; <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> &lt; nPlanes; ++<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>) {</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a>&amp; plane = tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a411eea9dd765636914a618ded267558c">Plane</a>(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>);</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nWires = plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a0aeb7d438b1337c138277335a4e666a1">Nwires</a>();</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#abeb00fea35a1d0fd24d5b71de6e56686">PrintPlaneInfo</a>(</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;  &quot;</span>, indent + <span class="stringliteral">&quot;      &quot;</span>,</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        8 <span class="comment">/* large verbosity */</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        );</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">w</a> = 0;  <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">w</a> &lt; nWires; ++<a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">w</a>) {</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../de/dce/classgeo_1_1WireGeo.html">geo::WireGeo</a>&amp; wire = plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a52fd8fb79c65318b52d60acb58c9a0d3">Wire</a>(<a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">w</a>);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <span class="comment">// this additional check is preserved to test alternative transformation</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <span class="comment">// code paths; center is expected to match wire.GetCenter()</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        <span class="comment">// BUG the double brace syntax is required to work around clang bug 21629</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <span class="comment">// (https://bugs.llvm.org/show_bug.cgi?id=21629)</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        std::array&lt;double, 3U&gt; <span class="keyword">const</span> <a class="code" href="../../d5/d61/make__xml__premcc1_80_8sh.html#a6a381711e6b60dd64d5ecdb1d135c1b8">local</a> = {{ 0.0, 0.0, 0.0 }};</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        std::array&lt;double, 3U&gt; center;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        wire.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#ad9f0c9052fdf23f61440be0c9489943c">LocalToWorld</a>(local.data(), center.data());</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <span class="comment">// the wire should be aligned on z axis, half on each side of 0,</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <span class="comment">// in its local frame</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; indent</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;    wire #&quot;</span> &lt;&lt; <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">w</a></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; at &quot;</span> &lt;&lt; lar::dump::array&lt;3&gt;(center)</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;       start at &quot;</span> &lt;&lt; <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#adb8558d6da99a3196b0b851015b1c288">lar::dump::vector3D</a>(wire.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#a1fe2dceeec7c5c0b14c6c9593482e438">GetStart</a>())</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;      middle at &quot;</span> &lt;&lt; <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#adb8558d6da99a3196b0b851015b1c288">lar::dump::vector3D</a>(wire.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#a967f3f96296bf6953f8405ac4e5e7427">GetCenter</a>())</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;         end at &quot;</span> &lt;&lt; <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#adb8558d6da99a3196b0b851015b1c288">lar::dump::vector3D</a>(wire.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#a23ad5f4a59ea0abdb4b3161378754b2a">GetEnd</a>())</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;          ;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      } <span class="comment">// for wire</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    } <span class="comment">// for plane</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  } <span class="comment">// GeometryTestAlg::printWiresInTPC()</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div>
<div class="line"><a name="l00567"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a26a26c4abf340b39996f6b8c295e4d77">  567</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::printAllGeometry()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nCryostats = geom-&gt;Ncryostats();</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Detector &quot;</span> &lt;&lt; geom-&gt;DetectorName()</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      &lt;&lt; <span class="stringliteral">&quot; has &quot;</span> &lt;&lt; nCryostats &lt;&lt; <span class="stringliteral">&quot; cryostats:&quot;</span>;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = 0; c &lt; nCryostats; ++c) {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../de/da3/classgeo_1_1CryostatGeo.html">geo::CryostatGeo</a>&amp; cryostat = geom-&gt;Cryostat(c);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nTPCs = cryostat.<a class="code" href="../../de/da3/classgeo_1_1CryostatGeo.html#a2f01042b5618212a40a63bb4ea1ff8f2">NTPC</a>();</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;  cryostat #&quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot; at &quot;</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        &lt;&lt; <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#adb8558d6da99a3196b0b851015b1c288">lar::dump::vector3D</a>(cryostat.<a class="code" href="../../de/da3/classgeo_1_1CryostatGeo.html#ac1620d671418fd2cfe6ef69ce076df85">GetCenter</a>()) &lt;&lt; <span class="stringliteral">&quot; cm has &quot;</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        &lt;&lt; nTPCs &lt;&lt; <span class="stringliteral">&quot; TPC(s):&quot;</span>;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> t = 0;  t &lt; nTPCs; ++t) {</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html">geo::TPCGeo</a>&amp; tpc = cryostat.<a class="code" href="../../de/da3/classgeo_1_1CryostatGeo.html#a15e1909a67a64f7880720a7c9ff80a64">TPC</a>(t);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        printWiresInTPC(tpc, <span class="stringliteral">&quot;    &quot;</span>);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      } <span class="comment">// for TPC</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    } <span class="comment">// for cryostat</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    printAuxiliaryDetectors();</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;End of detector &quot;</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                                    &lt;&lt; geom-&gt;DetectorName() &lt;&lt; <span class="stringliteral">&quot; geometry.&quot;</span>;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  } <span class="comment">// GeometryTestAlg::printAllGeometry()</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l00589"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a849500bddbd98e7aa407b5e0736d0371">  589</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::printAuxiliaryDetectors()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    mf::LogVerbatim log(<span class="stringliteral">&quot;GeometryTest&quot;</span>);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="keyword">const</span> nAuxDets = geom-&gt;NAuxDets();</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    log &lt;&lt; <span class="stringliteral">&quot;There are &quot;</span> &lt;&lt; nAuxDets &lt;&lt; <span class="stringliteral">&quot; auxiliary detectors:&quot;</span>;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iDet = 0; iDet &lt; nAuxDets; ++iDet) {</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      log &lt;&lt; <span class="stringliteral">&quot;\n[#&quot;</span> &lt;&lt; iDet &lt;&lt; <span class="stringliteral">&quot;] &quot;</span>;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      printAuxDetGeo(log, geom-&gt;AuxDet(iDet), <span class="stringliteral">&quot;  &quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    } <span class="comment">// for</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  } <span class="comment">// GeometryTestAlg::printAuxiliaryDetectors()</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Stream&gt;</div>
<div class="line"><a name="l00605"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a8d93c6897b4c68d32985e0cab4a661f6">  605</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::printAuxDetGeo(</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <a class="code" href="../../d0/d8f/runFilesFromSAM_8sh.html#a9cafae22b6225844ee0cdf5ea57176ff">Stream</a>&amp;&amp; out, <a class="code" href="../../db/d4f/classgeo_1_1AuxDetGeo.html">geo::AuxDetGeo</a> <span class="keyword">const</span>&amp; auxDet,</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    std::string indent, std::string firstIndent</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    )<span class="keyword"> const</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="keyword">  </span>{</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html">lar::util::RealComparisons&lt;double&gt;</a> coordIs(1e-4);</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    std::array&lt;double, 3U&gt; center, normal;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    auxDet.<a class="code" href="../../db/d4f/classgeo_1_1AuxDetGeo.html#ad07cad0da74717282f501930c0dcdc95">GetCenter</a>(center.data());</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    auxDet.<a class="code" href="../../db/d4f/classgeo_1_1AuxDetGeo.html#a7a41a663624af1fc12a4690d5f8f4fa4">GetNormalVector</a>(normal.data());</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    out &lt;&lt; firstIndent &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span> &lt;&lt; auxDet.<a class="code" href="../../db/d4f/classgeo_1_1AuxDetGeo.html#a11c1d1b633eca8ab4d49d307b3fd50fc">Name</a>()</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;\&quot; centered at &quot;</span> &lt;&lt; lar::dump::array&lt;3U&gt;(center)</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      &lt;&lt; <span class="stringliteral">&quot; cm, size ( &quot;</span> &lt;&lt; (2.0 * auxDet.<a class="code" href="../../db/d4f/classgeo_1_1AuxDetGeo.html#a3695a57d255e0d43833291e520fb4ecb">HalfWidth1</a>());</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keywordflow">if</span> (coordIs.<a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">nonEqual</a>(auxDet.<a class="code" href="../../db/d4f/classgeo_1_1AuxDetGeo.html#a3695a57d255e0d43833291e520fb4ecb">HalfWidth1</a>(), auxDet.<a class="code" href="../../db/d4f/classgeo_1_1AuxDetGeo.html#a809f7b8d168ee8c5b9abbbae7fa74405">HalfWidth2</a>()))</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      out &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; (2.0 * auxDet.<a class="code" href="../../db/d4f/classgeo_1_1AuxDetGeo.html#a809f7b8d168ee8c5b9abbbae7fa74405">HalfWidth2</a>());</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    out &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; (2.0 * auxDet.<a class="code" href="../../db/d4f/classgeo_1_1AuxDetGeo.html#af6f18a062143e4467ea430baaf1447a6">HalfHeight</a>())</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; auxDet.<a class="code" href="../../db/d4f/classgeo_1_1AuxDetGeo.html#a9b43b5f1c298977f5d4f127e020cd2a8">Length</a>() &lt;&lt; <span class="stringliteral">&quot; ) cm&quot;</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;, normal facing &quot;</span> &lt;&lt; lar::dump::array&lt;3U&gt;(normal);</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nSensitive = auxDet.<a class="code" href="../../db/d4f/classgeo_1_1AuxDetGeo.html#ae78d4eec47d921df33279d7f79bb798c">NSensitiveVolume</a>();</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="keywordflow">switch</span> (nSensitive) {</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      <span class="keywordflow">case</span> 0: <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        out &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;with sensitive volume &quot;</span>;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        printAuxDetSensitiveGeo(</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;          std::forward&lt;Stream&gt;(out),</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;          auxDet.<a class="code" href="../../db/d4f/classgeo_1_1AuxDetGeo.html#ac9646d8cfd1b8aad57857851e37215b7">SensitiveVolume</a>(0U), indent + <span class="stringliteral">&quot;  &quot;</span>, <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;          );</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        out &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; indent</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;with &quot;</span> &lt;&lt; auxDet.<a class="code" href="../../db/d4f/classgeo_1_1AuxDetGeo.html#ae78d4eec47d921df33279d7f79bb798c">NSensitiveVolume</a>() &lt;&lt; <span class="stringliteral">&quot; sensitive detectors:&quot;</span>;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iSens = 0; iSens &lt; nSensitive; ++iSens) {</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;          out &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;  [#&quot;</span> &lt;&lt; iSens &lt;&lt; <span class="stringliteral">&quot;] &quot;</span>;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;          printAuxDetSensitiveGeo(std::forward&lt;Stream&gt;(out),</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            auxDet.<a class="code" href="../../db/d4f/classgeo_1_1AuxDetGeo.html#ac9646d8cfd1b8aad57857851e37215b7">SensitiveVolume</a>(iSens), indent + <span class="stringliteral">&quot;  &quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        } <span class="comment">// for</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    } <span class="comment">// if sensitive detectors</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  } <span class="comment">// GeometryTestAlg::printAuxDetGeo()</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Stream&gt;</div>
<div class="line"><a name="l00651"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a749f250f3d64e4e972859d3b8bfe5d73">  651</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::printAuxDetSensitiveGeo(</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <a class="code" href="../../d0/d8f/runFilesFromSAM_8sh.html#a9cafae22b6225844ee0cdf5ea57176ff">Stream</a>&amp;&amp; out, <a class="code" href="../../d5/df8/classgeo_1_1AuxDetSensitiveGeo.html">geo::AuxDetSensitiveGeo</a> <span class="keyword">const</span>&amp; auxDetSens,</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    std::string <span class="comment">/* indent */</span>, std::string firstIndent</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    )<span class="keyword"> const</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="keyword">  </span>{</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html">lar::util::RealComparisons&lt;double&gt;</a> coordIs(1e-4);</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    std::array&lt;double, 3U&gt; center, normal;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    auxDetSens.<a class="code" href="../../d5/df8/classgeo_1_1AuxDetSensitiveGeo.html#a4021fd1394c3f5c41288aaf2062530b9">GetCenter</a>(center.data());</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    auxDetSens.<a class="code" href="../../d5/df8/classgeo_1_1AuxDetSensitiveGeo.html#a81206c68310c8627f64f8066493b299b">GetNormalVector</a>(normal.data());</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    out &lt;&lt; firstIndent &lt;&lt; <span class="stringliteral">&quot;centered at &quot;</span> &lt;&lt; lar::dump::array&lt;3U&gt;(center)</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      &lt;&lt; <span class="stringliteral">&quot; cm, size ( &quot;</span> &lt;&lt; (2.0 * auxDetSens.<a class="code" href="../../d5/df8/classgeo_1_1AuxDetSensitiveGeo.html#a4bddfb859a9d32193399c327f3adaaa8">HalfWidth1</a>());</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keywordflow">if</span> (coordIs.<a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">nonEqual</a>(auxDetSens.<a class="code" href="../../d5/df8/classgeo_1_1AuxDetSensitiveGeo.html#a4bddfb859a9d32193399c327f3adaaa8">HalfWidth1</a>(), auxDetSens.<a class="code" href="../../d5/df8/classgeo_1_1AuxDetSensitiveGeo.html#a71992b010a3e7bc25ca9cf348ab91d21">HalfWidth2</a>()))</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      out &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; (2.0 * auxDetSens.<a class="code" href="../../d5/df8/classgeo_1_1AuxDetSensitiveGeo.html#a71992b010a3e7bc25ca9cf348ab91d21">HalfWidth2</a>());</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    out &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; (2.0 * auxDetSens.<a class="code" href="../../d5/df8/classgeo_1_1AuxDetSensitiveGeo.html#af7917bd36b925dff60bac457504b7b16">HalfHeight</a>())</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; auxDetSens.<a class="code" href="../../d5/df8/classgeo_1_1AuxDetSensitiveGeo.html#a9e05776bc7484ab828433621604ddb8e">Length</a>() &lt;&lt; <span class="stringliteral">&quot; ) cm&quot;</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;, normal facing &quot;</span> &lt;&lt; lar::dump::array&lt;3U&gt;(normal);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  } <span class="comment">// GeometryTestAlg::printAuxDetSensitiveGeo()</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l00674"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a6698e9fe85b4d3ddf05a3481eaaa2f56">  674</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testCryostat()</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  {</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;There are &quot;</span> &lt;&lt; geom-&gt;Ncryostats() &lt;&lt; <span class="stringliteral">&quot; cryostats in the detector&quot;</span>;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordflow">for</span>(<a class="code" href="../../de/da3/classgeo_1_1CryostatGeo.html">geo::CryostatGeo</a> <span class="keyword">const</span>&amp; cryo: geom-&gt;IterateCryostats()) {</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      {</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        mf::LogVerbatim log(<span class="stringliteral">&quot;GeometryTest&quot;</span>);</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        log</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;\n\tCryostat &quot;</span> &lt;&lt; cryo.ID()</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;          &lt;&lt;   <span class="stringliteral">&quot; &quot;</span> &lt;&lt; cryo.Volume()-&gt;GetName()</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;          &lt;&lt;   <span class="stringliteral">&quot; Dimensions [cm]: &quot;</span> &lt;&lt; cryo.Width()</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;          &lt;&lt;                  <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; cryo.Height()</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;          &lt;&lt;                  <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; cryo.Length()</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;          ;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d6/d23/namespacegeo.html#a4234220f2d709cfac66fac07972f6242">fComputeMass</a>) {</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;          log</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\n\t\tmass [kg]: &quot;</span> &lt;&lt; cryo.Mass();</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        }</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        log</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;\n\t\tCryostat boundaries:&quot;</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;          &lt;&lt;   <span class="stringliteral">&quot;  -x:&quot;</span> &lt;&lt; cryo.MinX() &lt;&lt; <span class="stringliteral">&quot; +x:&quot;</span> &lt;&lt; cryo.MaxX()</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;          &lt;&lt;   <span class="stringliteral">&quot;  -y:&quot;</span> &lt;&lt; cryo.MinY() &lt;&lt; <span class="stringliteral">&quot; +y:&quot;</span> &lt;&lt; cryo.MaxY()</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;          &lt;&lt;   <span class="stringliteral">&quot;  -z:&quot;</span> &lt;&lt; cryo.MinZ() &lt;&lt; <span class="stringliteral">&quot; +z:&quot;</span> &lt;&lt; cryo.MaxZ()</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;          ;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;      }</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      <span class="comment">// pick a position in the middle of the cryostat in the world coordinates</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> worldLoc[3]</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        = { cryo.CenterX(), cryo.CenterY(), cryo.CenterZ() };</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      MF_LOG_DEBUG(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\t testing GeometryCore::PoitionToCryostat....&quot;</span>;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      <a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html">geo::CryostatID</a> cid;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      <span class="keywordflow">try</span>{</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        geom-&gt;PositionToCryostat(worldLoc, cid);</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      }</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      <span class="keywordflow">catch</span>(cet::exception &amp;e){</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        mf::LogWarning(<span class="stringliteral">&quot;FailedToLocateCryostat&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\n exception caught:&quot;</span> &lt;&lt; <a class="code" href="../../d4/dca/updateVersionList_8sh.html#a067a8c1534d6da9b2c501a6cf4ef89bd">e</a>;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        <span class="keywordflow">if</span> (fNonFatalExceptions.count(e.category()) == 0) <span class="keywordflow">throw</span>;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      }</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      <span class="keywordflow">if</span> (cid != cryo.ID()) {</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;CryostatTest&quot;</span>)</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Geometry points the middle of cryostat &quot;</span> &lt;&lt; std::string(cryo.ID())</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; to a different one (&quot;</span> &lt;&lt; std::string(cid) &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      }</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      MF_LOG_DEBUG(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;done&quot;</span>;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      MF_LOG_DEBUG(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\t Now test the TPCs associated with this cryostat&quot;</span>;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      testTPC(cryo.ID());</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    }</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  }</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l00730"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a9c7df087b3fceddbcef4c294cb35aba0">  730</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> GeometryTestAlg::testFindWorldVolumes() {</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a> = 0;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    std::set&lt;std::string&gt; volume_names;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    std::vector&lt;TGeoNode const*&gt; <a class="code" href="../../df/d0a/main_8cpp.html#abb11f4d2544da34ecc72c1be4b1796b3">nodes</a>;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="comment">// world</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    volume_names.insert(geom-&gt;GetWorldVolumeName());</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    nodes = geom-&gt;FindAllVolumes(volume_names);</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      mf::LogVerbatim log(<span class="stringliteral">&quot;GeometryTest&quot;</span>);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      log &lt;&lt; <span class="stringliteral">&quot;Found &quot;</span> &lt;&lt; nodes.size() &lt;&lt; <span class="stringliteral">&quot; world volumes &#39;&quot;</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        &lt;&lt; geom-&gt;GetWorldVolumeName() &lt;&lt; <span class="stringliteral">&quot;&#39;:&quot;</span>;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      <span class="keywordflow">for</span> (TGeoNode <span class="keyword">const</span>* node: nodes) {</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        TGeoVolume <span class="keyword">const</span>* pVolume = node-&gt;GetVolume();</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        log &lt;&lt; <span class="stringliteral">&quot;\n - &#39;&quot;</span> &lt;&lt; pVolume-&gt;GetName() &lt;&lt; <span class="stringliteral">&quot;&#39; (a &quot;</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;          &lt;&lt; pVolume-&gt;GetShape()-&gt;GetName() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      } <span class="comment">// for</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    } <span class="comment">// anonymous block</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="keywordflow">if</span> (nodes.size() != 1) {</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      mf::LogError(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Found &quot;</span> &lt;&lt; nodes.size() &lt;&lt; <span class="stringliteral">&quot; world volumes &#39;&quot;</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;          &lt;&lt; geom-&gt;GetWorldVolumeName() &lt;&lt; <span class="stringliteral">&quot;! [expecting: one!!]&quot;</span>;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    } <span class="comment">// if nodes</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  } <span class="comment">// GeometryTestAlg::testFindWorldVolumes()</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div>
<div class="line"><a name="l00761"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a02c9fa57cf38a00e35cc1b6f49823ee0">  761</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> GeometryTestAlg::testFindCryostatVolumes() {</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a> = 0;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    std::set&lt;std::string&gt; volume_names;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    volume_names.insert(geom-&gt;GetWorldVolumeName());</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    volume_names.insert(<span class="stringliteral">&quot;volCryostat&quot;</span>);</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    std::vector&lt;TGeoNode const*&gt; <a class="code" href="../../df/d0a/main_8cpp.html#abb11f4d2544da34ecc72c1be4b1796b3">nodes</a> = geom-&gt;FindAllVolumes(volume_names);</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    mf::LogVerbatim log(<span class="stringliteral">&quot;GeometryTest&quot;</span>);</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    log &lt;&lt; <span class="stringliteral">&quot;Found &quot;</span> &lt;&lt; nodes.size() &lt;&lt; <span class="stringliteral">&quot; world and cryostat volumes:&quot;</span>;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="keywordflow">for</span> (TGeoNode <span class="keyword">const</span>* node: nodes) {</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      TGeoVolume <span class="keyword">const</span>* pVolume = node-&gt;GetVolume();</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      log &lt;&lt; <span class="stringliteral">&quot;\n - &#39;&quot;</span> &lt;&lt; pVolume-&gt;GetName() &lt;&lt; <span class="stringliteral">&quot;&#39; (a &quot;</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        &lt;&lt; pVolume-&gt;GetShape()-&gt;GetName() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    } <span class="comment">// for</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keywordflow">if</span> (nodes.size() != (1 + geom-&gt;Ncryostats())) {</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      mf::LogError(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Found &quot;</span> &lt;&lt; nodes.size() &lt;&lt; <span class="stringliteral">&quot; world and cryostat volumes! &quot;</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        <span class="stringliteral">&quot;[expecting: 1 world and &quot;</span> &lt;&lt; geom-&gt;Ncryostats() &lt;&lt; <span class="stringliteral">&quot; cryostats]&quot;</span>;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    } <span class="comment">// if nodes</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  } <span class="comment">// GeometryTestAlg::testFindCryostatVolumes()</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div>
<div class="line"><a name="l00789"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a6f4288bfca1da91e13396c06335c67ee">  789</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> GeometryTestAlg::testFindTPCvolumePaths() {</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a> = 0;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="comment">// search the full path of all TPCs</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    std::set&lt;std::string&gt; volume_names;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html">geo::TPCGeo</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>: geom-&gt;IterateTPCs())</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      volume_names.insert(<a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>.TotalVolume()-&gt;GetName());</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="comment">// get the right answer: how many TPCs?</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NTPCs = geom-&gt;TotalNTPC();</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    std::vector&lt;std::vector&lt;TGeoNode const*&gt;&gt; node_paths</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      = geom-&gt;FindAllVolumePaths(volume_names);</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    mf::LogVerbatim log(<span class="stringliteral">&quot;GeometryTest&quot;</span>);</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    log &lt;&lt; <span class="stringliteral">&quot;Found &quot;</span> &lt;&lt; node_paths.size() &lt;&lt; <span class="stringliteral">&quot; TPC volumes:&quot;</span>;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; path: node_paths) {</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;      TGeoNode <span class="keyword">const</span>* node = path.back();</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;      TGeoVolume <span class="keyword">const</span>* pVolume = node-&gt;GetVolume();</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;      log &lt;&lt; <span class="stringliteral">&quot;\n - &#39;&quot;</span> &lt;&lt; pVolume-&gt;GetName() &lt;&lt; <span class="stringliteral">&quot;&#39; (a &quot;</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        &lt;&lt; pVolume-&gt;GetShape()-&gt;GetName() &lt;&lt; <span class="stringliteral">&quot;) with &quot;</span> &lt;&lt; (path.size()-1)</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        &lt;&lt; <span class="stringliteral">&quot; ancestors&quot;</span>;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      <span class="keywordflow">for</span> (TGeoNode <span class="keyword">const</span>* pNode: path) {</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        TGeoVolume <span class="keyword">const</span>* pVolume = pNode-&gt;GetVolume();</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        log &lt;&lt; <span class="stringliteral">&quot;\n      * &#39;&quot;</span> &lt;&lt; pVolume-&gt;GetName() &lt;&lt; <span class="stringliteral">&quot;&#39; (a &quot;</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;          &lt;&lt; pVolume-&gt;GetShape()-&gt;GetName() &lt;&lt; <span class="stringliteral">&quot;) with a &quot;</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;          &lt;&lt; pNode-&gt;GetMatrix()-&gt;IsA()-&gt;GetName() &lt;&lt; <span class="stringliteral">&quot; that &quot;</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;          &lt;&lt; (pNode-&gt;GetMatrix()-&gt;IsTranslation()? <span class="stringliteral">&quot;is&quot;</span>: <span class="stringliteral">&quot;is not&quot;</span>)</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; a simple translation&quot;</span>;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      } <span class="comment">// for node</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    } <span class="comment">// for path</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordflow">if</span> (node_paths.size() != NTPCs) {</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      mf::LogError(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Found &quot;</span> &lt;&lt; node_paths.size() &lt;&lt; <span class="stringliteral">&quot; TPC volumes! &quot;</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        <span class="stringliteral">&quot;[expecting: &quot;</span> &lt;&lt; NTPCs &lt;&lt; <span class="stringliteral">&quot; TPCs]&quot;</span>;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    } <span class="comment">// if missed some</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  } <span class="comment">// GeometryTestAlg::testFindTPCvolumePaths()</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div>
<div class="line"><a name="l00832"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a37af141503751199d7491c8b6c7836f3">  832</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testFindVolumes() {</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="comment">     * Finds and checks a selected number of volumes by name:</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="comment">     * - world volume</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="comment">     * - cryostat volumes</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment">     * - TPCs (returns full paths)</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a> = 0;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    nErrors += testFindWorldVolumes();</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    nErrors += testFindCryostatVolumes();</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    nErrors += testFindTPCvolumePaths();</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="keywordflow">if</span> (nErrors != 0) {</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;FindVolumes&quot;</span>)</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Collected &quot;</span> &lt;&lt; nErrors &lt;&lt; <span class="stringliteral">&quot; errors during FindAllVolumes() test!\n&quot;</span>;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    }</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  } <span class="comment">// GeometryTestAlg::testFindVolumes()</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l00855"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a122d830e24b80acaf3b341750966239c">  855</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testTPC(<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html">geo::CryostatID</a> <span class="keyword">const</span>&amp; cid)</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  {</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <a class="code" href="../../de/da3/classgeo_1_1CryostatGeo.html">geo::CryostatGeo</a> <span class="keyword">const</span>&amp; cryo = geom-&gt;Cryostat(cid);</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\tThere are &quot;</span> &lt;&lt; cryo.<a class="code" href="../../de/da3/classgeo_1_1CryostatGeo.html#a2f01042b5618212a40a63bb4ea1ff8f2">NTPC</a>()</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                                    &lt;&lt; <span class="stringliteral">&quot; TPCs in the detector&quot;</span>;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> t = 0; t &lt; cryo.<a class="code" href="../../de/da3/classgeo_1_1CryostatGeo.html#a2f01042b5618212a40a63bb4ea1ff8f2">NTPC</a>(); ++t){</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      <a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a> <span class="keyword">const</span> tpcid(cid, t);</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      <a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html">geo::TPCGeo</a> <span class="keyword">const</span>&amp; tpc = cryo.<a class="code" href="../../de/da3/classgeo_1_1CryostatGeo.html#a15e1909a67a64f7880720a7c9ff80a64">TPC</a>(tpcid);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      decltype(<span class="keyword">auto</span>) activeCenter = tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a61ef94078870f7f4d929a5e81b36b425">GetActiveVolumeCenter</a>();</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      {</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        mf::LogVerbatim log { <span class="stringliteral">&quot;GeometryTest&quot;</span> };</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        log</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;\n\t\tTPC &quot;</span> &lt;&lt; tpcid</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; geom-&gt;GetLArTPCVolumeName(tpcid)</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; has &quot;</span> &lt;&lt; tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#ab3391de99203f6a60eeeef152d3adb35">Nplanes</a>() &lt;&lt; <span class="stringliteral">&quot; planes.&quot;</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;\n\t\tTPC location: ( &quot;</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            &lt;&lt; tpc.<a class="code" href="../../db/d54/classgeo_1_1BoxBoundedGeo.html#afd042da19afb090ba80e93ee64d4dec5">MinX</a>() &lt;&lt; <span class="stringliteral">&quot; ; &quot;</span> &lt;&lt; tpc.<a class="code" href="../../db/d54/classgeo_1_1BoxBoundedGeo.html#abc0cab4f0fcd826d11aaa8b3dfb2de02">MinY</a>() &lt;&lt; <span class="stringliteral">&quot; ; &quot;</span>&lt;&lt; tpc.<a class="code" href="../../db/d54/classgeo_1_1BoxBoundedGeo.html#a67f01c76c031e29c5bcc610f23a0be85">MinZ</a>()</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; ) =&gt;  ( &quot;</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;            &lt;&lt; tpc.<a class="code" href="../../db/d54/classgeo_1_1BoxBoundedGeo.html#ae141949f30631ded82199f4375c21b7e">MaxX</a>() &lt;&lt; <span class="stringliteral">&quot; ; &quot;</span> &lt;&lt; tpc.<a class="code" href="../../db/d54/classgeo_1_1BoxBoundedGeo.html#a71626e62af098d6a8c09dd97bbf4812b">MaxY</a>() &lt;&lt; <span class="stringliteral">&quot; ; &quot;</span>&lt;&lt; tpc.<a class="code" href="../../db/d54/classgeo_1_1BoxBoundedGeo.html#aff3c6d62c880e387d35ab093bdbdcffc">MaxZ</a>()</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; ) [cm]&quot;</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;\n\t\tTPC Dimensions (W x H x L, cm): &quot;</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;            &lt;&lt; tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a02c06159006b35ce2913102d3c862e32">Width</a>() &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; directionName(tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#aa674c11a62557a8aa9fac14c27af6c80">WidthDir</a>()) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a69e909a83e35d91c6abffca531d07d06">Height</a>() &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; directionName(tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#ad4db370e69a9f5c8f3623f8c6edfe2b3">HeightDir</a>()) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a0e39141f154428669f715c957d3c5a5e">Length</a>() &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; directionName(tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a6559a5e3105cc12a7e984e66ed76e078">LengthDir</a>()) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;\n\t\tTPC Active Dimensions: &quot;</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;            &lt;&lt; 2.*tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#ad27c155668c5d9f850334cc2e005e7aa">ActiveHalfWidth</a>() &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; 2.*tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a0fcad5daf16e14b04be6fdb949429fa0">ActiveHalfHeight</a>() &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#adf14d253e55f0968131f4d59bf218fe9">ActiveLength</a>()</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; around ( &quot;</span> &lt;&lt; activeCenter.X() &lt;&lt; <span class="stringliteral">&quot; ; &quot;</span> &lt;&lt; activeCenter.Y()</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; ; &quot;</span>&lt;&lt; activeCenter.Z() &lt;&lt; <span class="stringliteral">&quot; ) cm&quot;</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;          ;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d6/d23/namespacegeo.html#a4234220f2d709cfac66fac07972f6242">fComputeMass</a>)</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;          log &lt;&lt; <span class="stringliteral">&quot;\n\t\tTPC mass: &quot;</span> &lt;&lt; tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a94351b7cd90a2f6471eee59f7e9c592e">ActiveMass</a>();</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        log</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;\n\t\tTPC drift distance: &quot;</span> &lt;&lt; tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a9696ac2c61e57bf62799989078d6eb87">DriftDistance</a>()</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;, direction: &quot;</span> &lt;&lt; tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a7b3c9e3d79a25a20f069007a462ee9ca">DriftDir</a>();</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;      }</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;      </div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> = 0; <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> &lt; tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#ab3391de99203f6a60eeeef152d3adb35">Nplanes</a>(); ++<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>) {</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a> <span class="keyword">const</span>&amp; plane = tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a411eea9dd765636914a618ded267558c">Plane</a>(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>);</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        <span class="comment">// first line indented with two tabs, the others with two more spaces;</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        <span class="comment">// very verbose (8)</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#abeb00fea35a1d0fd24d5b71de6e56686">PrintPlaneInfo</a></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;          (mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\t\t&quot;</span>, <span class="stringliteral">&quot;\t\t  &quot;</span>, 8);</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;\t\t  pitch from plane 0 is &quot;</span> &lt;&lt; tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a8a67d792308b4298d3c782bd219e508a">Plane0Pitch</a>(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>);</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      } <span class="comment">// for plane</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      <a class="code" href="../../d6/d23/namespacegeo.html#af668c8df9412103e6c6ddb54f23d86e4">geo::DriftDirection_t</a> <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> = tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a37b4d0a99be8c2324273589fda87b851">DriftDirection</a>();</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      <span class="keywordflow">if</span>     (dir == <a class="code" href="../../d6/d23/namespacegeo.html#a1b5150a78645f276a21647cc0b48fb69ab6ea94727ba423afbde5dbd7e9306bdf">geo::kNegX</a>) {</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;\t\tdrift direction is towards negative values: &quot;</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;          &lt;&lt; tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a7b3c9e3d79a25a20f069007a462ee9ca">DriftDir</a>();</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      }</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dir == <a class="code" href="../../d6/d23/namespacegeo.html#a1b5150a78645f276a21647cc0b48fb69a540355ba5bfe18985f585e362f847483">geo::kPosX</a>) {</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;\t\tdrift direction is towards positive values: &quot;</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;          &lt;&lt; tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a7b3c9e3d79a25a20f069007a462ee9ca">DriftDir</a>();</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      }</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;UnknownDriftDirection&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\t\tdrift direction is unknown\n&quot;</span>;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      }</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      MF_LOG_DEBUG(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\t testing PositionToTPC...&quot;</span>;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      <span class="comment">// pick a position in the middle of the TPC in the world coordinates</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      <span class="keywordtype">double</span> worldLoc[3] = {0.};</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      <span class="keywordtype">double</span> localLoc[3] = {0.};</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      tpc.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a3f663d96f6fe0ad88a84fa7dd0c9fc77">LocalToWorld</a>(localLoc, worldLoc);</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tpcNo = cryo.<a class="code" href="../../de/da3/classgeo_1_1CryostatGeo.html#adbdb77e96709880e40d5d3f3a46cd2a0">FindTPCAtPosition</a>(worldLoc, 1+1.e-4);</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      <span class="keywordflow">if</span>(tpcNo != t)</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;BadTPCLookupFromPosition&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;TPC look up returned tpc = &quot;</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                                                         &lt;&lt; tpcNo &lt;&lt; <span class="stringliteral">&quot; should be &quot;</span> &lt;&lt; t &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      MF_LOG_DEBUG(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;done.&quot;</span>;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    } <span class="comment">// for TPC</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  }</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l00941"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#aa5b6a5f695e774b1b979cd9196a8ecb9">  941</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testPlaneDirections()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="comment">     * The test verifies that all the planes in the geometry respect the</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="comment">     * orientation requirements:</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="comment">     *   { (wire direction) , (wire coordinate increase), (plane normal) }</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="comment">     *   { (width direction) , (length direction), (plane normal) }</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="comment">     * both be a positively defined base.</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html">lar::util::RealComparisons&lt;double&gt;</a> coordIs(1e-5);</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a> = 0;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a> <span class="keyword">const</span>&amp; plane: geom-&gt;IteratePlanes()) {</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;      <span class="comment">// check the ( wire ; wire coordinate ; normal) base</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;      <span class="comment">// this funny way declares a reference or not, depending on return type</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;      decltype(<span class="keyword">auto</span>) planeNormal = plane.GetNormalDirection();</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      decltype(<span class="keyword">auto</span>) wireCoordDir = plane.GetIncreasingWireDirection();</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;      decltype(<span class="keyword">auto</span>) wireDir = plane.GetWireDirection();</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> wireFrame = wireDir.Cross(wireCoordDir).Dot(planeNormal);</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;      <span class="keywordflow">if</span> (coordIs.<a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">nonEqual</a>(wireFrame, 1.0)) {</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Plane &quot;</span> &lt;&lt; plane.ID()</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; has wire direction &quot;</span> &lt;&lt; wireDir</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; wire coordinate direction &quot;</span> &lt;&lt; wireCoordDir</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; and normal &quot;</span> &lt;&lt; planeNormal</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; , yielding to a non-positive plane-coordinate definition&quot;</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; (l x w . n = &quot;</span> &lt;&lt; wireFrame &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      } <span class="comment">// if error</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;      <span class="comment">// check the ( width ; depth ; normal) base</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      decltype(<span class="keyword">auto</span>) widthDir = plane.WidthDir();</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;      decltype(<span class="keyword">auto</span>) depthDir = plane.DepthDir();</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> geoFrame = widthDir.Cross(depthDir).Dot(planeNormal);</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      <span class="keywordflow">if</span> (coordIs.<a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">nonEqual</a>(geoFrame, 1.0)) {</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Plane &quot;</span> &lt;&lt; plane.ID()</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; has width direction &quot;</span> &lt;&lt; widthDir</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; depth direction &quot;</span> &lt;&lt; depthDir</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; and normal &quot;</span> &lt;&lt; planeNormal</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; , yielding to a non-positive plane-coordinate definition&quot;</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; (w x d . n = &quot;</span> &lt;&lt; geoFrame &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      } <span class="comment">// if error</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    } <span class="comment">// for plane</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    <span class="keywordflow">if</span> (nErrors &gt; 0) {</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;testPlaneDirections() accumulated &quot;</span> &lt;&lt; nErrors</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        &lt;&lt; <span class="stringliteral">&quot; errors (see messages above)\n&quot;</span>;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    }</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  } <span class="comment">// GeometryTestAlg::testPlaneDirections()</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a81c2f62d6225cecbfe1ac7322c8b19d2"> 1013</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testWireOrientations()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment">     * The test verifies that all the wires in the geometry respect the</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="comment">     * orientation requirement described in geo::WireGeo documentation:</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment">     *   { (wire direction) , (wire coordinate increase), (plane normal) }</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="comment">     * be a positively defined base.</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a> = 0;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a> <span class="keyword">const</span>&amp; plane: geom-&gt;IteratePlanes()) {</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      <span class="comment">// this funny way declares a reference or not, depending on return type</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      decltype(<span class="keyword">auto</span>) planeNormal = plane.GetNormalDirection();</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      decltype(<span class="keyword">auto</span>) wireCoordDir = plane.GetIncreasingWireDirection();</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nWires = plane.Nwires();</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wireNo = 0; wireNo &lt; nWires; ++wireNo) {</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        <a class="code" href="../../de/dce/classgeo_1_1WireGeo.html">geo::WireGeo</a> <span class="keyword">const</span>&amp; wire = plane.Wire(wireNo);</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        <span class="keywordtype">double</span> positive = wire.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#a3e7aa14d29e74b735f79b176ffd6a1f8">Direction</a>().Cross(wireCoordDir).Dot(planeNormal);</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        <span class="keywordflow">if</span> (positive &lt; 0.5) {</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;          ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;          <span class="comment">// detail the problem; details of the plane should be read in the</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;          <span class="comment">// output from other tests</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;          decltype(<span class="keyword">auto</span>) wireDir = wire.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#a3e7aa14d29e74b735f79b176ffd6a1f8">Direction</a>();</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;          mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;Wire &quot;</span> &lt;&lt; plane.ID() &lt;&lt; <span class="stringliteral">&quot; W: &quot;</span> &lt;&lt; wireNo</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; has direction ( &quot;</span> &lt;&lt; wireDir</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; , yielding to a non-positive plane-coordinate definition&quot;</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; (l x w . n = &quot;</span> &lt;&lt; positive &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        } <span class="comment">// if error</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      } <span class="comment">// for wire</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    } <span class="comment">// for plane</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <span class="keywordflow">if</span> (nErrors &gt; 0) {</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;testWireOrientations() accumulated &quot;</span> &lt;&lt; nErrors</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        &lt;&lt; <span class="stringliteral">&quot; errors (see messages above)\n&quot;</span>;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    }</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  } <span class="comment">// GeometryTestAlg::testWireOrientations()</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#aff47ab67ba5134d22fab1d9e40c725a8"> 1065</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testWireCoordFromPlane()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="comment">// For each wire:</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="comment">// * picks points lying on the planes including a wire and the normal to the</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    <span class="comment">//   wire plane (which have all the same wire coordinate)</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    <span class="comment">// * tests that the coordinates are as expected (wire number times pitch)</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a> = 0;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a> <span class="keyword">const</span>&amp; plane: geom-&gt;IteratePlanes()) {</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span> nWires = plane.Nwires();</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span> wirePitch = plane.WirePitch();</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> driftDistance = geom-&gt;TPC(plane.ID()).DriftDistance();</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;      decltype(<span class="keyword">auto</span>) planeNormal = plane.GetNormalDirection();</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="../../de/db1/structgeo_1_1WireID.html#a51daaae3404ddba50f4585a9820e751f">geo::WireID::WireID_t</a> wireNo = 0; wireNo &lt; nWires; ++wireNo) {</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        <a class="code" href="../../de/dce/classgeo_1_1WireGeo.html">geo::WireGeo</a> <span class="keyword">const</span>&amp; wire = plane.Wire(wireNo);</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <span class="keywordtype">double</span> <span class="keyword">const</span> expected = wireNo * wirePitch;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;        <span class="comment">// sample 7 points on wire</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        constexpr <span class="keywordtype">int</span> shifts = 3;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        <span class="keywordtype">double</span> <span class="keyword">const</span> step = wire.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#a9e88c4815131ef71cf08acc7328e0624">HalfL</a>() / (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(shifts) + 1);</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iOfs = -shifts; iOfs &lt;= shifts; ++iOfs) {</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;          <span class="keywordtype">double</span> <span class="keyword">const</span> <a class="code" href="../../d2/d0d/CORSIKAGen_8fcl.html#a424b27db311314d6e22e0e78fd28a35a">offset</a> = iOfs * step;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span> basePoint = wire.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#a87b418fce901a25990cecc94055ee1ce">GetPositionFromCenter</a>(offset);</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;          <span class="comment">// at 4 different distances from the plane</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;          constexpr <span class="keywordtype">int</span> quotas = 4;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;          <span class="keywordtype">double</span> <span class="keyword">const</span> jump = driftDistance / (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(quotas) + 1);</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iQuota = 0; iQuota &lt; quotas; ++iQuota) {</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;            <span class="comment">// translate the point along the normal to the plane;</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;            <span class="comment">// this should not change the result</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span> point = basePoint + iQuota * jump * planeNormal;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;            <span class="keywordtype">double</span> <span class="keyword">const</span> distance = plane.PlaneCoordinate(point);</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(distance - expected) &gt; 1e-4) {</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;              mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Point &quot;</span> &lt;&lt; point</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;  (offset: &quot;</span> &lt;&lt; iOfs &lt;&lt; <span class="stringliteral">&quot;x&quot;</span> &lt;&lt; step &lt;&lt; <span class="stringliteral">&quot;, at &quot;</span> &lt;&lt; iQuota</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;x&quot;</span> &lt;&lt; jump &lt;&lt; <span class="stringliteral">&quot; from plane) is reported to be &quot;</span> &lt;&lt; distance</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; cm far from wire &quot;</span> &lt;&lt; plane.ID() &lt;&lt; <span class="stringliteral">&quot; W: &quot;</span> &lt;&lt; wireNo</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; expected &lt;&lt; <span class="stringliteral">&quot; expected)&quot;</span>;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;              ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;            } <span class="comment">// if unexpected</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;          } <span class="comment">// for quotas</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;        } <span class="comment">// for iOfs</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;      } <span class="comment">// for wires</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    } <span class="comment">// for planes</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <span class="keywordflow">if</span> (nErrors &gt; 0) {</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;testWireCoordFromPlane() accumulated &quot;</span> &lt;&lt; nErrors</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;        &lt;&lt; <span class="stringliteral">&quot; errors (see messages above)\n&quot;</span>;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    }</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;  } <span class="comment">// GeometryTestAlg::testWireCoordFromPlane()</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#aecf8811cdee03e92ce484e94f22b280b"> 1139</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testParallelWires()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    <span class="comment">// checks that all the wires in the same plane are parallel</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <span class="keyword">auto</span> <span class="keyword">const</span> vectorIs = <a class="code" href="../../d9/d3d/namespacelar_1_1util.html#a9c7a66b3fecfd5e9fc64e30f3c54effb">lar::util::makeVector3DComparison</a>(geom-&gt;coordIs);</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a> <span class="keyword">const</span>&amp; plane: geom-&gt;IteratePlanes()) {</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;      decltype(<span class="keyword">auto</span>) genDir = plane.GetWireDirection();</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      <a class="code" href="../../de/db1/structgeo_1_1WireID.html#a51daaae3404ddba50f4585a9820e751f">geo::WireID::WireID_t</a> wireNo = 0;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html">geo::WireGeo</a> <span class="keyword">const</span>&amp; wire: plane.IterateWires()) {</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;        <a class="code" href="../../de/db1/structgeo_1_1WireID.html">geo::WireID</a> <span class="keyword">const</span> wireID(plane.ID(), wireNo++);</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;        decltype(<span class="keyword">auto</span>) wireDir = wire.Direction();</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        <span class="keywordflow">if</span> (vectorIs.nonEqual(wireDir, genDir)) {</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;          <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;ParallelWires&quot;</span>)</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;Wire &quot;</span> &lt;&lt; std::string(wireID) &lt;&lt; <span class="stringliteral">&quot; has direction &quot;</span> &lt;&lt; wireDir</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;, not parallel to wire direction &quot;</span> &lt;&lt; genDir</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; according to the plane &quot;</span> &lt;&lt; std::string(plane.ID()) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        }</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;      } <span class="comment">// for wires in plane</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    } <span class="comment">// for planes</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;  } <span class="comment">// GeometryTestAlg::testParallelWires()</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a3567989b919eb60b4b961003fb354672"> 1172</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testPlanePointDecomposition()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    <span class="comment">// For each plane:</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <span class="comment">// 1) create a plane point with arbitrary distance from the plane,</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <span class="comment">//    wire coordinate multiple (N) of wire pitch, and wire direction</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <span class="comment">//    coordinate 0 or half a wire length in either directions</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    <span class="comment">// 2) compose into a 3D vector, and verify that the nearest wire is the one</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <span class="comment">//    expected (N)</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <span class="comment">// 3) decompose back the 3D vector, and verify that the result matches the</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="comment">//    starting decomposition</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <span class="comment">// 4) also verify singly PointProjection() and DistanceFromPlane()</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="comment">// 5) verify DriftPoint()</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    <a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html">lar::util::RealComparisons&lt;double&gt;</a> coordIs(1e-5);</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    <span class="keyword">auto</span> vectorIs = <a class="code" href="../../d9/d3d/namespacelar_1_1util.html#a9c7a66b3fecfd5e9fc64e30f3c54effb">lar::util::makeVector3DComparison</a>(coordIs);</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a> = 0;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a> <span class="keyword">const</span>&amp; plane: geom-&gt;IteratePlanes()) {</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span>&amp; planeNorm = plane.GetNormalDirection();</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span>&amp; wirePitch = plane.WirePitch();</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span>&amp; refPoint = plane.ProjectionReferencePoint();</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="keyword">const</span> lastWire = plane.Nwires() - 1;</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;      <a class="code" href="../../de/db1/structgeo_1_1WireID.html#a51daaae3404ddba50f4585a9820e751f">geo::WireID::WireID_t</a> wireNo = 0;</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html">geo::WireGeo</a> <span class="keyword">const</span>&amp; wire: plane.IterateWires()) {</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;        <a class="code" href="../../de/db1/structgeo_1_1WireID.html">geo::WireID</a> <span class="keyword">const</span> wireID(plane.ID(), wireNo++);</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        constexpr <span class="keywordtype">double</span> distance = 5.0; <span class="comment">// 5 cm from the plane</span></div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;        <span class="keyword">auto</span> <span class="keyword">const</span> wireDirStep = wire.HalfL() / 2.0; <span class="comment">// quarter of the length</span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iWDStep = -1; iWDStep &lt;= 1; ++iWDStep) {</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;          <span class="comment">// prepare expectation</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span> wireDirOffset = iWDStep * wireDirStep;</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span> expectedPoint = wire.GetCenter()</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;            + wireDirOffset * wire.Direction()</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;            + distance * planeNorm;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span> expectedWireCoord = wirePitch * wireID.<a class="code" href="../../de/db1/structgeo_1_1WireID.html#ac303d2971eb9697f3a65821bb92bb934">Wire</a>;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span> expectedWireDirCoord = wireDirOffset</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;            + wire.Direction().Dot(wire.GetCenter() - refPoint);</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;          <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a54262556246be9d7cd55b501d860d9c1">geo::PlaneGeo::WireCoordProjection_t</a> <span class="keyword">const</span> expectedProj</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;            (expectedWireDirCoord, expectedWireCoord);</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;          <span class="comment">// composition</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;          <span class="keyword">auto</span> point = plane.ComposePoint(distance, expectedProj);</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;          <span class="keywordflow">if</span> (vectorIs.nonEqual(point, expectedPoint)) {</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;            mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;[testPlanePointDecomposition] ComposePoint(): &quot;</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;Point with projection &quot;</span> &lt;&lt; expectedProj</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; and distance from plane &quot;</span> &lt;&lt; distance</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; was reported as &quot;</span> &lt;&lt; point</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; while it is expected to be at &quot;</span> &lt;&lt; expectedPoint</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; (on wire &quot;</span> &lt;&lt; std::string(wireID) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;          } <span class="comment">// if wrong point</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;          <span class="comment">// decomposition</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span> decomp = plane.DecomposePoint(point);</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;          <span class="keywordflow">if</span> (coordIs.<a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">nonEqual</a>(decomp.distance, distance)) {</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;            mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;[testPlanePointDecomposition] DecomposePoint(): &quot;</span></div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;Point &quot;</span> &lt;&lt; point &lt;&lt; <span class="stringliteral">&quot; (on wire &quot;</span> &lt;&lt; std::string(wireID) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; is reported to have distance from plane &quot;</span> &lt;&lt; decomp.distance</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; cm, while &quot;</span> &lt;&lt; distance &lt;&lt; <span class="stringliteral">&quot; is expected&quot;</span>;</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;          } <span class="comment">// if wrong distance</span></div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;          <span class="keywordflow">if</span> (coordIs.<a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">nonEqual</a>(decomp.projection.X(), expectedWireDirCoord)) {</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;            mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;[testPlanePointDecomposition] DecomposePoint(): &quot;</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;Point &quot;</span> &lt;&lt; point &lt;&lt; <span class="stringliteral">&quot; (on wire &quot;</span> &lt;&lt; std::string(wireID) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; is reported to have wire direction coordinate &quot;</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;                &lt;&lt; decomp.projection.X()</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; cm, while &quot;</span> &lt;&lt; expectedWireDirCoord &lt;&lt; <span class="stringliteral">&quot; is expected&quot;</span>;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;          } <span class="comment">// if wrong coordinate along the wire</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;          <span class="keywordflow">if</span> (coordIs.<a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">nonEqual</a>(decomp.projection.Y(), expectedWireCoord)) {</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;            mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;[testPlanePointDecomposition] DecomposePoint(): &quot;</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;Point &quot;</span> &lt;&lt; point &lt;&lt; <span class="stringliteral">&quot; (on wire &quot;</span> &lt;&lt; std::string(wireID) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; is reported to have wire coordinate &quot;</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;                &lt;&lt; decomp.projection.Y()</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; cm, while &quot;</span> &lt;&lt; expectedWireCoord &lt;&lt; <span class="stringliteral">&quot; is expected&quot;</span>;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;          } <span class="comment">// if wrong wire coordinate</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;          <span class="comment">// projection</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span> proj = plane.PointProjection(point);</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;          <span class="keywordflow">if</span> (coordIs.<a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">nonEqual</a>(proj.X(), expectedWireDirCoord)) {</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;            mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;[testPlanePointDecomposition] PointProjection(): &quot;</span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;Point &quot;</span> &lt;&lt; point &lt;&lt; <span class="stringliteral">&quot; (on wire &quot;</span> &lt;&lt; std::string(wireID) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; is reported to have wire direction coordinate &quot;</span> &lt;&lt; proj.X()</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; cm, while &quot;</span> &lt;&lt; expectedWireDirCoord &lt;&lt; <span class="stringliteral">&quot; is expected&quot;</span>;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;          } <span class="comment">// if wrong wire coordinate</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;          <span class="keywordflow">if</span> (coordIs.<a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">nonEqual</a>(proj.Y(), expectedWireCoord)) {</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;            mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;[testPlanePointDecomposition] PointProjection(): &quot;</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;Point &quot;</span> &lt;&lt; point &lt;&lt; <span class="stringliteral">&quot; (on wire &quot;</span> &lt;&lt; std::string(wireID) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; is reported to have wire coordinate &quot;</span> &lt;&lt; proj.Y()</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; cm, while &quot;</span> &lt;&lt; expectedWireCoord &lt;&lt; <span class="stringliteral">&quot; is expected&quot;</span>;</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;          } <span class="comment">// if wrong wire coordinate</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;          <span class="comment">// distance</span></div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span> <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a> = plane.DistanceFromPlane(point);</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;          <span class="keywordflow">if</span> (coordIs.<a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">nonEqual</a>(<a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>, distance)) {</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;            mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;[testPlanePointDecomposition] DistanceFromPlane(): &quot;</span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;Point &quot;</span> &lt;&lt; point &lt;&lt; <span class="stringliteral">&quot; (on wire &quot;</span> &lt;&lt; std::string(wireID) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; is reported to have distance &quot;</span> &lt;&lt; <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a> &lt;&lt; <span class="stringliteral">&quot; cm from plane &quot;</span></div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;              &lt;&lt; plane.ID() &lt;&lt; <span class="stringliteral">&quot;, while &quot;</span> &lt;&lt; distance &lt;&lt; <span class="stringliteral">&quot; is expected&quot;</span>;</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;          } <span class="comment">// if wrong distance</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;          <span class="comment">// drift</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;          <span class="comment">// BUG the double brace syntax is required to work around clang bug 21629</span></div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;          <span class="comment">// (https://bugs.llvm.org/show_bug.cgi?id=21629)</span></div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;          std::array&lt;double, 3&gt; drifts {{ -distance, distance, 2.*distance }};</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">double</span> drift: drifts) {</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;            <span class="comment">// DriftPoint() moves the point in the drift direction,</span></div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;            <span class="comment">// which is opposite to the plane normal:</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span> expectedDistance = distance - drift;</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;            <span class="comment">// drift it by a known value</span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;            <span class="keyword">auto</span> point = expectedPoint;</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;            plane.DriftPoint(point, drift);</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;            <span class="comment">// check the new distance</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;            <span class="keyword">auto</span> <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a> = plane.DistanceFromPlane(point);</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;            <span class="keywordflow">if</span> (coordIs.<a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">nonEqual</a>(<a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>, expectedDistance)) {</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;              ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;              mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;[testPlanePointDecomposition] DriftPoint(): &quot;</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Point &quot;</span> &lt;&lt; expectedPoint</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; (distant &quot;</span> &lt;&lt; distance &lt;&lt; <span class="stringliteral">&quot; cm from the plane)&quot;</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; (on wire &quot;</span> &lt;&lt; std::string(wireID) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; drifted by &quot;</span> &lt;&lt; drift &lt;&lt; <span class="stringliteral">&quot; became &quot;</span> &lt;&lt; point</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; which has distance from plane &quot;</span> &lt;&lt; <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; cm, while &quot;</span> &lt;&lt; expectedDistance &lt;&lt; <span class="stringliteral">&quot; was expected&quot;</span>;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;            } <span class="comment">// if wrong distance</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;          } <span class="comment">// for drifts</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;          <span class="comment">// containment</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;          <span class="comment">// skip this test for the first and last wire, since the containment</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;          <span class="comment">// area might well exclude the whole wire if it&#39;s short enough</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;          <span class="keywordtype">bool</span> <span class="keyword">const</span> isExtremeWire</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;            = (wireID.Wire == 0) || (wireID.Wire == lastWire);</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;          <span class="keywordflow">if</span> (!isExtremeWire &amp;&amp; !plane.isProjectionOnPlane(expectedPoint)) {</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;            mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;[testPlanePointDecomposition] isProjectionOnPlane(): &quot;</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;Point &quot;</span> &lt;&lt; expectedPoint &lt;&lt; <span class="stringliteral">&quot; (center of &quot;</span> &lt;&lt; wireID</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;) is not believed to be on the plane, but it should.&quot;</span>;</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;          }</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;        } <span class="comment">// for different wire direction steps</span></div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;      } <span class="comment">// for wires in plane</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    } <span class="comment">// for planes</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    <span class="keywordflow">if</span> (nErrors &gt; 0) {</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;testPlanePointDecomposition() accumulated &quot;</span> &lt;&lt; nErrors</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        &lt;&lt; <span class="stringliteral">&quot; errors (see messages above)\n&quot;</span>;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    }</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;  } <span class="comment">// GeometryTestAlg::testPlanePointDecomposition()</span></div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l01379"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a1196c59f46c056a3e841e28c2c9a1789"> 1379</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testWireCoordAngle()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="comment">     * Tests that the angle PhiZ() actually points to the next wire.</span></div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;<span class="comment">     * The test, for each plane, performs the following:</span></div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="comment">     * - pick the middle wire, verify that we can get the expected wire</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="comment">     *   coordinate for its centre</span></div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="comment">     * - move one wire pitch away from the centre in the direction determined</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment">     *   by PhiZ(), verify that the coordinate increases by 1</span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> <span class="keyword">const</span>&amp; planeid: geom-&gt;IteratePlaneIDs()) {</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;      <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a> <span class="keyword">const</span>&amp; plane = geom-&gt;Plane(planeid);</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;      <span class="comment">// define the wires to work with</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nWires = plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a0aeb7d438b1337c138277335a4e666a1">Nwires</a>();</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;      <a class="code" href="../../de/db1/structgeo_1_1WireID.html">geo::WireID</a> middle_wire_id(planeid, nWires / 2);</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;      <a class="code" href="../../de/db1/structgeo_1_1WireID.html">geo::WireID</a> next_wire_id(planeid, nWires / 2 + 1);</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;      <span class="keywordflow">if</span> (next_wire_id.<a class="code" href="../../de/db1/structgeo_1_1WireID.html#ac303d2971eb9697f3a65821bb92bb934">Wire</a> &gt;= nWires) {</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;        <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;WeirdGeometry&quot;</span>)</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Plane &quot;</span> &lt;&lt; std::string(planeid) &lt;&lt; <span class="stringliteral">&quot; has only &quot;</span> &lt;&lt; nWires</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; wires?!?\n&quot;</span>;</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;      }</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;      <a class="code" href="../../de/dce/classgeo_1_1WireGeo.html">geo::WireGeo</a> <span class="keyword">const</span>&amp; middle_wire = geom-&gt;Wire(middle_wire_id);</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;      decltype(<span class="keyword">auto</span>) middle_wire_center = middle_wire.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#a967f3f96296bf6953f8405ac4e5e7427">GetCenter</a>();</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;      MF_LOG_TRACE(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Center of &quot;</span> &lt;&lt; middle_wire_id &lt;&lt; <span class="stringliteral">&quot; at &quot;</span> &lt;&lt; middle_wire_center;</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;      <span class="comment">// cross check: we can find the middle wire</span></div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> middle_coord = geom-&gt;WireCoordinate</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;        (middle_wire_center, planeid);</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(middle_coord - <span class="keywordtype">double</span>(middle_wire_id.<a class="code" href="../../de/db1/structgeo_1_1WireID.html#ac303d2971eb9697f3a65821bb92bb934">Wire</a>)) &gt; 2e-3) {</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;WireCoordAngle&quot;</span>)</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Center of &quot;</span> &lt;&lt; std::string(middle_wire_id) &lt;&lt; <span class="stringliteral">&quot; at (&quot;</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;          &lt;&lt; middle_wire_center[0]</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;; &quot;</span> &lt;&lt; middle_wire_center[1] &lt;&lt; <span class="stringliteral">&quot;; &quot;</span> &lt;&lt; middle_wire_center[2]</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;) has wire coordinate &quot;</span> &lt;&lt; middle_coord</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; middle_wire_id.<a class="code" href="../../de/db1/structgeo_1_1WireID.html#ac303d2971eb9697f3a65821bb92bb934">Wire</a> &lt;&lt; <span class="stringliteral">&quot; expected)\n&quot;</span>;</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;      } <span class="comment">// if</span></div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;      <span class="comment">// the check: this coordinate should lie on the next wire</span></div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> pitch = plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#abbb4a8a4b112ec8e24cc970a40e8b592">WirePitch</a>();</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;      decltype(<span class="keyword">auto</span>) wireCoordDir = plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#aa136661c166fee6b9f9888423ac2824d">GetIncreasingWireDirection</a>();</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;      MF_LOG_TRACE(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;  pitch: &quot;</span> &lt;&lt; pitch &lt;&lt; <span class="stringliteral">&quot; wire coord dir: cos(phi_z): &quot;</span></div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;        &lt;&lt; wireCoordDir;</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      <span class="keyword">auto</span> on_next_wire = middle_wire_center + pitch * wireCoordDir;</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> next_coord = geom-&gt;WireCoordinate(on_next_wire, planeid);</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(next_coord - <span class="keywordtype">double</span>(next_wire_id.<a class="code" href="../../de/db1/structgeo_1_1WireID.html#ac303d2971eb9697f3a65821bb92bb934">Wire</a>)) &gt; 2e-3) {</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a8d1a8a85a0b2a30cac1090ea528dd015">std::cerr</a></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;  pitch: &quot;</span> &lt;&lt; pitch &lt;&lt; <span class="stringliteral">&quot; wire coord dir: &quot;</span> &lt;&lt; wireCoordDir</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;\n  start wire: &quot;</span> &lt;&lt; middle_wire_id</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; centered at &quot;</span> &lt;&lt; middle_wire_center</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;\n  querying point &quot;</span> &lt;&lt; on_next_wire</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;          &lt;&lt; std::endl;</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;        <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;WireCoordAngle&quot;</span>)</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Position &quot;</span> &lt;&lt; on_next_wire</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; is expected to be on wire &quot;</span> &lt;&lt; std::string(next_wire_id)</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; but it has wire coordinate &quot;</span> &lt;&lt; next_coord &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;      } <span class="comment">// if</span></div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    } <span class="comment">// for</span></div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;  } <span class="comment">// GeometryTestAlg::testWireCoordAngle()</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l01456"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#af543629ba821367749ddb1a6de097b01"> 1456</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testChannelToROP()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <span class="comment">// test that an invalid channel yields an invalid ROP</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;      <a class="code" href="../../dd/d41/structreadout_1_1ROPID.html">readout::ROPID</a> invalidROP = geom-&gt;ChannelToROP(<a class="code" href="../../d9/d63/namespaceraw.html#ac59223371efaecdc5ef8389bc976a20a">raw::InvalidChannelID</a>);</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;      <span class="keywordflow">if</span> (invalidROP.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a9384db80f2ab08f013fc630316d7bd05">isValid</a>) {</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;        <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;testChannelToROP&quot;</span>)</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;ROP from an invalid channel (&quot;</span></div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;          &lt;&lt; <a class="code" href="../../d9/d63/namespaceraw.html#ac59223371efaecdc5ef8389bc976a20a">raw::InvalidChannelID</a> &lt;&lt; <span class="stringliteral">&quot;) is &quot;</span> &lt;&lt; std::string(invalidROP)</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; !?\n&quot;</span>;</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;      } <span class="comment">// if invalid rop is not invalid</span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    }</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    <span class="keywordflow">catch</span> (cet::exception <span class="keyword">const</span>&amp; e) {</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;      mf::LogWarning(<span class="stringliteral">&quot;testChannelToROP&quot;</span>)</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Non-compilant ChannelToROP() throws on invalid channel.&quot;</span>;</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    }</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    <span class="comment">// for each channel, test that its ROP contains it;</span></div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    <span class="comment">// we assume each ROP contains contiguous channel IDs</span></div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../d9/d63/namespaceraw.html#abfe7badfcad7fe0e9474829fbd1408b2">raw::ChannelID_t</a> channel = 0; channel &lt; geom-&gt;Nchannels(); ++channel) {</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;      <a class="code" href="../../dd/d41/structreadout_1_1ROPID.html">readout::ROPID</a> <span class="keyword">const</span> ropid = geom-&gt;ChannelToROP(channel);</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span> firstChannel = geom-&gt;FirstChannelInROP(ropid);</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span> lastChannel = firstChannel + geom-&gt;Nchannels(ropid);</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;      <span class="keywordflow">if</span> ((channel &lt; firstChannel) || (channel &gt;= lastChannel)) {</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;        <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;testChannelToROP&quot;</span>)</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Channel &quot;</span> &lt;&lt; channel &lt;&lt; <span class="stringliteral">&quot; comes from ROP &quot;</span> &lt;&lt; std::string(ropid)</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;, which contains only channels from &quot;</span> &lt;&lt; firstChannel</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; lastChannel &lt;&lt; <span class="stringliteral">&quot; (excluded)\n&quot;</span>;</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      } <span class="comment">// if</span></div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    } <span class="comment">// for channel</span></div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;  } <span class="comment">// GeometryTestAlg::testChannelToROP()</span></div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#ae889e2cf47d1452e329b8fae9e39f0be"> 1495</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testChannelToWire()<span class="keyword"> const</span></div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="keyword">  </span>{</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    <span class="keyword">using</span> <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#acc1957472e01a8d9ecd245e26338f0b9">std::begin</a>;</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    <span class="keyword">using</span> <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">std::end</a>;</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> lastPlane; <span class="comment">// starts invalid</span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    <a class="code" href="../../d6/d23/namespacegeo.html#a6baec40eaf3ff161f7eb1a5f0779794f">geo::View_t</a> planeView = <a class="code" href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486ae329b0f520125896d02940bec370fca7">geo::kUnknown</a>;</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    <a class="code" href="../../d6/d23/namespacegeo.html#a59a0688ea6aaa04f0ffa6451f8083ca1">geo::SigType_t</a> planeSigType = <a class="code" href="../../d6/d23/namespacegeo.html#a3b3c27511a16721236b09f14b66a58beac3aae5646e132e0a884ed6cb736945ad">geo::kMysteryType</a>;</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    <span class="keywordflow">for</span>(<a class="code" href="../../de/db1/structgeo_1_1WireID.html">geo::WireID</a> testWireID: geom-&gt;IterateWireIDs()){</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;      <a class="code" href="../../d9/d63/namespaceraw.html#abfe7badfcad7fe0e9474829fbd1408b2">raw::ChannelID_t</a> channel = geom-&gt;PlaneWireToChannel(testWireID);</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d63/namespaceraw.html#aa6c206cb6dd1c31d7c15f99806f9da0f">raw::isValidChannelID</a>(channel)) {</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;        <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;BadChannelLookup&quot;</span>)</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Invalid channel returned for wire &quot;</span> &lt;&lt; std::string(testWireID)</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;      }</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span> wireIDs = geom-&gt;ChannelToWire(channel);</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;      <span class="keywordflow">if</span> (wireIDs.empty()) {</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;        <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;BadChannelLookup&quot;</span>)</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;List of wires for channel #&quot;</span> &lt;&lt; channel &lt;&lt; <span class="stringliteral">&quot; is empty;&quot;</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; it should have contained at least &quot;</span> &lt;&lt; std::string(testWireID)</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;         &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;      }</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/df5/IntegerRanges__test_8cc.html#abbc7e5f346bfa932ca51b4b07ccef76d">std::count</a>(<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#acc1957472e01a8d9ecd245e26338f0b9">begin</a>(wireIDs), <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>(wireIDs), testWireID) != 1) {</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        mf::LogError log(<span class="stringliteral">&quot;GeometryTest&quot;</span>);</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;        log &lt;&lt; wireIDs.size() &lt;&lt; <span class="stringliteral">&quot; wire IDs associated with channel #&quot;</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;          &lt;&lt; channel &lt;&lt; <span class="stringliteral">&quot;:&quot;</span>;</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; wid: wireIDs)</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;          log &lt;&lt; <span class="stringliteral">&quot;\n  &quot;</span> &lt;&lt; wid;</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;        <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;BadChannelLookup&quot;</span>)</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Wire &quot;</span> &lt;&lt; std::string(testWireID) &lt;&lt; <span class="stringliteral">&quot; is on channel #&quot;</span> &lt;&lt; channel</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; but ChannelToWire() does not map the channel to that wire\n&quot;</span>;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;      }</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;      <span class="comment">// currently (LArSoft 6.12) signal type from channel and from plane use</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;      <span class="comment">// the same underlying code, so the following test is not very valuable</span></div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span> channelSigType = geom-&gt;SignalType(channel);</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;      <span class="keywordflow">if</span> (channelSigType != geom-&gt;SignalType(testWireID.planeID())) {</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;        <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;BadChannelLookup&quot;</span>)</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Geometry service claims channel #&quot;</span> &lt;&lt; channel</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; to be of type &quot;</span> &lt;&lt; channelSigType</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; but that the plane of &quot;</span> &lt;&lt; std::string(testWireID)</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; is of type &quot;</span> &lt;&lt; geom-&gt;SignalType(testWireID.planeID()) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;      }</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span> channelView = geom-&gt;View(channel);</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;      <span class="keywordflow">if</span> (channelView != geom-&gt;Plane(testWireID).View()) {</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;        <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;BadChannelLookup&quot;</span>)</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Geometry service claims channel #&quot;</span> &lt;&lt; channel</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; should be on view &quot;</span> &lt;&lt; geom-&gt;View(channel)</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; but the plane of &quot;</span> &lt;&lt; std::string(testWireID)</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; claims to be on view &quot;</span> &lt;&lt; geom-&gt;Plane(testWireID).View() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;      }</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;      <span class="comment">// check that all the channels on the same plane are consistent</span></div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;      <span class="comment">// (sort of: it&#39;s more like &quot;all contiguous wires in the same plane&quot;)</span></div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;      <span class="keywordflow">if</span> (testWireID.planeID() == lastPlane) {</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;        <span class="keywordflow">if</span> (planeView != channelView) {</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;          <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;BadChannelLookup&quot;</span>)</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;Geometry service claims channel #&quot;</span> &lt;&lt; channel</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; is on view &quot;</span> &lt;&lt; channelView</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; but its plane &quot;</span> &lt;&lt; std::string(lastPlane)</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; claims to be on view &quot;</span> &lt;&lt; planeView &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;        }</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;        <span class="keywordflow">if</span> (planeSigType != channelSigType) {</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;          <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;BadChannelLookup&quot;</span>)</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;Geometry service claims channel #&quot;</span> &lt;&lt; channel</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; is if type &quot;</span> &lt;&lt; channelSigType</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; but its plane &quot;</span> &lt;&lt; std::string(lastPlane)</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; to be of type &quot;</span> &lt;&lt; planeSigType &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;        }</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;      }</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;        lastPlane = testWireID.planeID();</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;        planeView = channelView;</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;        planeSigType = channelSigType;</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;      }</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    } <span class="comment">// for wires in detector</span></div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;  } <span class="comment">// GeometryTestAlg::testChannelToWire()</span></div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l01583"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a546f293255b60902843cfbe7cfec62ed"> 1583</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testFindPlaneCenters()</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;  {</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    <span class="keywordtype">double</span> xyz[3] = {0.},   xyzW[3] = {0.};</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; geom-&gt;Nplanes(); ++i){</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;      geom-&gt;<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>(i).LocalToWorld(xyz,xyzW);</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\n\tplane &quot;</span></div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;                                      &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; is centered at (x,y,z) = (&quot;</span></div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;                                      &lt;&lt; xyzW[0] &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; xyzW[1]</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;                                      &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; xyzW[2] &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;    }</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;  }</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#ac167a55a87ef82d3fb142df9b6786d9c"> 1596</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testPlaneProjectionReference()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;    <span class="comment">// Check the definition of the projection reference</span></div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a> = 0;</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; plane: geom-&gt;IteratePlanes()) {</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;      TVector3 reference = plane.ProjectionReferencePoint();</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;      <span class="keyword">auto</span> decomp = plane.DecomposePoint(reference);</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;      <span class="keywordflow">if</span> (geom-&gt;coordIs.nonZero(decomp.distance)) {</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;        MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Plane &quot;</span> &lt;&lt; plane.ID() &lt;&lt; <span class="stringliteral">&quot; reference point &quot;</span> &lt;&lt; reference</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; has distance &quot;</span> &lt;&lt; decomp.distance &lt;&lt; <span class="stringliteral">&quot; cm (should be 0)&quot;</span>;</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;        ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;      }</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;      <span class="keywordflow">if</span> (geom-&gt;coordIs.nonZero(decomp.projection.X())</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;        || geom-&gt;coordIs.nonZero(decomp.projection.Y())</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;        )</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;      {</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;        MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Plane &quot;</span> &lt;&lt; plane.ID() &lt;&lt; <span class="stringliteral">&quot; reference point &quot;</span> &lt;&lt; reference</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; has projection ( &quot;</span> &lt;&lt; decomp.projection.X()</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; ; &quot;</span> &lt;&lt; decomp.projection.Y() &lt;&lt; <span class="stringliteral">&quot; ) cm (should be (0;0) )&quot;</span>;</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;        ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;      }</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;    } <span class="comment">// for planes</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    <span class="keywordflow">if</span> (nErrors &gt; 0) {</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;GeoTestPlaneProjectionReference&quot;</span>)</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Accumulated &quot;</span> &lt;&lt; nErrors &lt;&lt; <span class="stringliteral">&quot; errors (see messages above)\n&quot;</span>;</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;    }</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;  } <span class="comment">// GeometryTestAlg::testPlaneProjectionReference()</span></div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l01635"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#ae4e788e5b1a238d27112aff3ff6793c4"> 1635</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testPlanePointDecompositionFrame()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    <span class="comment">// For each plane:</span></div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    <span class="comment">// 1) create a plane point with arbitrary distance from the plane,</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    <span class="comment">//    width and depth coordinates all across the plane</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    <span class="comment">// 2) compose into a 3D vector</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;    <span class="comment">// 3) decompose back the 3D vector, and verify that the result matches the</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    <span class="comment">//    starting decomposition</span></div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    <span class="comment">// 4) also verify singly PointProjection() and DistanceFromPlane()</span></div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    <span class="comment">// 5) verify DriftPoint()</span></div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    <a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html">lar::util::RealComparisons&lt;double&gt;</a> coordIs(1e-5);</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    <span class="keyword">auto</span> vectorIs = <a class="code" href="../../d9/d3d/namespacelar_1_1util.html#a9c7a66b3fecfd5e9fc64e30f3c54effb">lar::util::makeVector3DComparison</a>(coordIs);</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    <span class="comment">// steps on each side of the center, within the plane:</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;    constexpr <span class="keywordtype">int</span> steps = 5;</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    static_assert(steps &gt; 0, <span class="stringliteral">&quot;Steps must be a positive number.&quot;</span>);</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    <span class="comment">// how many width units we go far from the center (1 means stay inside)</span></div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;    constexpr <span class="keywordtype">int</span> nOutsides = 1;</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a> = 0;</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a> <span class="keyword">const</span>&amp; plane: geom-&gt;IteratePlanes()) {</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span>&amp; planeNorm = plane.GetNormalDirection();</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span>&amp; widthDir = plane.WidthDir();</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span>&amp; depthDir = plane.DepthDir();</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span>&amp; refPoint = plane.GetCenter();</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> halfWidth = plane.Width() / 2;</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> halfDepth = plane.Depth() / 2;</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> dW_2 = halfWidth / (steps * 2); <span class="comment">// half width step</span></div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> dD_2 = halfDepth / (steps * 2); <span class="comment">// half depth step</span></div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iW = -nOutsides * steps; iW &lt;= +nOutsides * steps; ++iW) {</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        <span class="keywordtype">double</span> <span class="keyword">const</span> expected_w = dW_2 * (iW * 2 + 1); <span class="comment">// width coordinate</span></div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;        <span class="keywordtype">bool</span> <span class="keyword">const</span> inWidth = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(expected_w) &lt;= halfWidth;</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iD = -nOutsides * steps; iD &lt;= +nOutsides * steps; ++iD) {</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;          <span class="keywordtype">double</span> <span class="keyword">const</span> expected_d = dD_2 * (iD * 2 + 1); <span class="comment">// depth coordinate</span></div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;          <span class="keywordtype">bool</span> <span class="keyword">const</span> inDepth = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(expected_d) &lt;= halfDepth;</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;          constexpr <span class="keywordtype">double</span> distance = 5.0; <span class="comment">// we might test this too...</span></div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;          <span class="comment">// prepare expectation</span></div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span> expectedPoint = refPoint</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;            + expected_w * widthDir</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;            + expected_d * depthDir</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;            + distance * planeNorm;</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;          <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a066c372521b61e61bc86146ea4a9fc66">geo::PlaneGeo::WidthDepthProjection_t</a> <span class="keyword">const</span> expectedProj</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;            (expected_w, expected_d);</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;          <span class="comment">// composition</span></div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;          <span class="keyword">auto</span> point = plane.ComposePoint(distance, expectedProj);</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;          <span class="keywordflow">if</span> (vectorIs.nonEqual(point, expectedPoint)) {</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;            mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;[testPlanePointDecompositionFrame] ComposePoint(): &quot;</span></div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;Point with projection &quot;</span> &lt;&lt; expectedProj</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; (width: &quot;</span> &lt;&lt; expected_w &lt;&lt; <span class="stringliteral">&quot;, depth: &quot;</span> &lt;&lt; expected_d</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;) and distance from plane &quot;</span> &lt;&lt; distance</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; was reported as &quot;</span> &lt;&lt; point</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; while it is expected to be at &quot;</span> &lt;&lt; expectedPoint;</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;          } <span class="comment">// if wrong point</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;          <span class="comment">// decomposition</span></div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span> decomp = plane.DecomposePointWidthDepth(point);</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;          <span class="keywordflow">if</span> (coordIs.<a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">nonEqual</a>(decomp.distance, distance)) {</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;            mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;[testPlanePointDecomposition] DecomposePointWidthDepth(): &quot;</span></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;Point &quot;</span> &lt;&lt; point</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; (width: &quot;</span> &lt;&lt; expected_w &lt;&lt; <span class="stringliteral">&quot;, depth: &quot;</span> &lt;&lt; expected_d</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;) is reported to have distance from plane &quot;</span> &lt;&lt; decomp.distance</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; cm, while &quot;</span> &lt;&lt; distance &lt;&lt; <span class="stringliteral">&quot; is expected&quot;</span>;</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;          } <span class="comment">// if wrong distance</span></div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;          <span class="keywordflow">if</span> (coordIs.<a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">nonEqual</a>(decomp.projection.X(), expected_w)) {</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;            mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;[testPlanePointDecomposition] DecomposePointWidthDepth(): &quot;</span></div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;Point &quot;</span> &lt;&lt; point</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; (width: &quot;</span> &lt;&lt; expected_w &lt;&lt; <span class="stringliteral">&quot;, depth: &quot;</span> &lt;&lt; expected_d</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;) is reported to have width direction coordinate &quot;</span></div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;                &lt;&lt; decomp.projection.X()</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; cm, while &quot;</span> &lt;&lt; expected_w &lt;&lt; <span class="stringliteral">&quot; is expected&quot;</span>;</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;          } <span class="comment">// if wrong coordinate along the wire</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;          <span class="keywordflow">if</span> (coordIs.<a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">nonEqual</a>(decomp.projection.Y(), expected_d)) {</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;            mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;[testPlanePointDecomposition] DecomposePointWidthDepth(): &quot;</span></div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;Point &quot;</span> &lt;&lt; point</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; (width: &quot;</span> &lt;&lt; expected_w &lt;&lt; <span class="stringliteral">&quot;, depth: &quot;</span> &lt;&lt; expected_d</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;) is reported to have depth direction coordinate &quot;</span></div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;                &lt;&lt; decomp.projection.Y()</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; cm, while &quot;</span> &lt;&lt; expected_d &lt;&lt; <span class="stringliteral">&quot; is expected&quot;</span>;</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;          } <span class="comment">// if wrong wire coordinate</span></div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;          <span class="comment">// projection</span></div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span> proj = plane.PointWidthDepthProjection(point);</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;          <span class="keywordflow">if</span> (coordIs.<a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">nonEqual</a>(proj.X(), expected_w)) {</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;            mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;[testPlanePointDecomposition] PointProjection(): &quot;</span></div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;Point &quot;</span> &lt;&lt; point</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; (width: &quot;</span> &lt;&lt; expected_w &lt;&lt; <span class="stringliteral">&quot;, depth: &quot;</span> &lt;&lt; expected_d</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;) is reported to have width direction coordinate &quot;</span> &lt;&lt; proj.X()</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; cm, while &quot;</span> &lt;&lt; expected_w &lt;&lt; <span class="stringliteral">&quot; is expected&quot;</span>;</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;          } <span class="comment">// if wrong wire coordinate</span></div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;          <span class="keywordflow">if</span> (coordIs.<a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">nonEqual</a>(proj.Y(), expected_d)) {</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;            mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;[testPlanePointDecomposition] PointProjectionWidthDepth(): &quot;</span></div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;Point &quot;</span> &lt;&lt; point</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; (width: &quot;</span> &lt;&lt; expected_w &lt;&lt; <span class="stringliteral">&quot;, depth: &quot;</span> &lt;&lt; expected_d</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;) is reported to have wire coordinate &quot;</span> &lt;&lt; proj.Y()</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; cm, while &quot;</span> &lt;&lt; expected_d &lt;&lt; <span class="stringliteral">&quot; is expected&quot;</span>;</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;          } <span class="comment">// if wrong wire coordinate</span></div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;          <span class="comment">// distance</span></div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span> <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a> = plane.DistanceFromPlane(point);</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;          <span class="keywordflow">if</span> (coordIs.<a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">nonEqual</a>(<a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>, distance)) {</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;            mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;[testPlanePointDecomposition] DistanceFromPlane(): &quot;</span></div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;Point &quot;</span> &lt;&lt; point</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; (width: &quot;</span> &lt;&lt; expected_w &lt;&lt; <span class="stringliteral">&quot;, depth: &quot;</span> &lt;&lt; expected_d</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;) is reported to have distance from plane &quot;</span> &lt;&lt; <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a></div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; cm, while &quot;</span> &lt;&lt; distance &lt;&lt; <span class="stringliteral">&quot; is expected&quot;</span>;</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;          } <span class="comment">// if wrong distance</span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;          <span class="comment">// drift</span></div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;          <span class="comment">// BUG the double brace syntax is required to work around clang bug 21629</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;          <span class="comment">// (https://bugs.llvm.org/show_bug.cgi?id=21629)</span></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;          std::array&lt;double, 3&gt; drifts {{ -distance, distance, 2.*distance }};</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">double</span> drift: drifts) {</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;            <span class="comment">// DriftPoint() moves the point in the drift direction,</span></div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;            <span class="comment">// which is opposite to the plane normal:</span></div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span> expectedDistance = distance - drift;</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;            <span class="comment">// drift it by a known value</span></div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;            <span class="keyword">auto</span> point = expectedPoint;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;            plane.DriftPoint(point, drift);</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;            <span class="comment">// check the new distance</span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;            <span class="keyword">auto</span> <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a> = plane.DistanceFromPlane(point);</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;            <span class="keywordflow">if</span> (coordIs.<a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">nonEqual</a>(<a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>, expectedDistance)) {</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;              ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;              mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;[testPlanePointDecomposition] DriftPoint(): &quot;</span></div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Point &quot;</span> &lt;&lt; expectedPoint</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; (distant &quot;</span> &lt;&lt; distance &lt;&lt; <span class="stringliteral">&quot; cm from the plane)&quot;</span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; (width: &quot;</span> &lt;&lt; expected_w &lt;&lt; <span class="stringliteral">&quot;, depth: &quot;</span> &lt;&lt; expected_d</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;) drifted by &quot;</span> &lt;&lt; drift &lt;&lt; <span class="stringliteral">&quot; became &quot;</span> &lt;&lt; point</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; which has distance from plane &quot;</span> &lt;&lt; <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a></div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; cm, while &quot;</span> &lt;&lt; expectedDistance &lt;&lt; <span class="stringliteral">&quot; was expected&quot;</span>;</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;            } <span class="comment">// if wrong distance</span></div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;          } <span class="comment">// for drifts</span></div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;          <span class="comment">// containment</span></div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">bool</span> expected_onPlane = inWidth &amp;&amp; inDepth;</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">bool</span> onPlane = plane.isProjectionOnPlane(expectedPoint);</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;          <span class="keywordflow">if</span> (expected_onPlane != onPlane) {</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;            <span class="comment">// always</span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;            mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;[testPlanePointDecompositionFrame] isProjectionOnPlane(): &quot;</span></div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;Point &quot;</span> &lt;&lt; expectedPoint</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; (width: &quot;</span> &lt;&lt; expected_w &lt;&lt; <span class="stringliteral">&quot;, depth: &quot;</span> &lt;&lt; expected_d</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;) is&quot;</span> &lt;&lt; (onPlane? <span class="stringliteral">&quot;&quot;</span>: <span class="stringliteral">&quot; not&quot;</span>)</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; believed to be on plane &quot;</span> &lt;&lt; plane.ID()</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;, but it should&quot;</span> &lt;&lt; (expected_onPlane? <span class="stringliteral">&quot;&quot;</span>: <span class="stringliteral">&quot; not be&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>;</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;          }</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;        } <span class="comment">// for different wire direction steps</span></div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;      } <span class="comment">// for wires in plane</span></div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    } <span class="comment">// for planes</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;    <span class="keywordflow">if</span> (nErrors &gt; 0) {</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;testPlanePointDecomposition() accumulated &quot;</span> &lt;&lt; nErrors</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;        &lt;&lt; <span class="stringliteral">&quot; errors (see messages above)\n&quot;</span>;</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;    }</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;  } <span class="comment">// GeometryTestAlg::testPlanePointDecompositionFrame()</span></div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l01855"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a9f445b4c8c068808226a123952251350"> 1855</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testPlaneProjectionOnFrame()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;    <span class="comment">// Tests:</span></div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;    <span class="comment">// 1. containment (isProjectionOnPlane())</span></div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;    <span class="comment">// 2. capping by closest point</span></div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;    <a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html">lar::util::RealComparisons&lt;double&gt;</a> coordIs(1e-5);</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;    <span class="keyword">auto</span> vectorIs = <a class="code" href="../../d9/d3d/namespacelar_1_1util.html#a9c7a66b3fecfd5e9fc64e30f3c54effb">lar::util::makeVector3DComparison</a>(coordIs);</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;    <span class="keyword">auto</span> <span class="keyword">const</span>&amp; vector2Dis = vectorIs.comp2D();</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;    <span class="comment">// steps on each side of the center, within the plane:</span></div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;    constexpr <span class="keywordtype">int</span> steps = 5;</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    static_assert(steps &gt; 0, <span class="stringliteral">&quot;Steps must be a positive number.&quot;</span>);</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    <span class="comment">// how many width units we go far from the center (1 means stay inside)</span></div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    constexpr <span class="keywordtype">int</span> nOutsides = 2;</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a> = 0;</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a> <span class="keyword">const</span>&amp; plane: geom-&gt;IteratePlanes()) {</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> halfWidth = plane.Width() / 2;</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> halfDepth = plane.Depth() / 2;</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> dW_2 = halfWidth / (steps * 2); <span class="comment">// half width step</span></div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> dD_2 = halfDepth / (steps * 2); <span class="comment">// half depth step</span></div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iW = -nOutsides * steps; iW &lt;= +nOutsides * steps; ++iW) {</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;        <span class="keywordtype">double</span> <span class="keyword">const</span> expected_w = dW_2 * (iW * 2 + 1); <span class="comment">// width coordinate</span></div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;        <span class="keywordtype">bool</span> <span class="keyword">const</span> inWidth = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(expected_w) &lt;= halfWidth;</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iD = -nOutsides * steps; iD &lt;= +nOutsides * steps; ++iD) {</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;          <span class="keywordtype">double</span> <span class="keyword">const</span> expected_d = dD_2 * (iD * 2 + 1); <span class="comment">// depth coordinate</span></div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;          <span class="keywordtype">bool</span> <span class="keyword">const</span> inDepth = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(expected_d) &lt;= halfDepth;</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">double</span> distance: { -30., 0.0, +30.0 }) {</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;            <span class="comment">// prepare expectation</span></div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;            <span class="comment">// definition of the test point</span></div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;            <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a066c372521b61e61bc86146ea4a9fc66">geo::PlaneGeo::WidthDepthProjection_t</a> <span class="keyword">const</span> expected_proj</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;              (expected_w, expected_d);</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span> expected_point</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;              = plane.ComposePoint(distance, expected_proj);</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;            <span class="comment">// 1. Containment test</span></div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">bool</span> expected_onPlane = inWidth &amp;&amp; inDepth;</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">bool</span> onPlane</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;              = plane.isProjectionOnPlane(expected_point);</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;            <span class="keywordflow">if</span> (expected_onPlane != onPlane) {</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;              ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;              mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;[testPlaneProjectionOnFrame] isProjectionOnPlane(): &quot;</span></div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Point &quot;</span> &lt;&lt; expected_point</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; (width: &quot;</span> &lt;&lt; expected_w &lt;&lt; <span class="stringliteral">&quot;, depth: &quot;</span> &lt;&lt; expected_d</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;) is&quot;</span> &lt;&lt; (onPlane? <span class="stringliteral">&quot;&quot;</span>: <span class="stringliteral">&quot; not&quot;</span>)</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; believed to be on plane &quot;</span> &lt;&lt; plane.ID()</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;, but it should&quot;</span> &lt;&lt; (expected_onPlane? <span class="stringliteral">&quot;&quot;</span>: <span class="stringliteral">&quot; not be&quot;</span>)</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>;</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;            }</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;            <span class="comment">// 2. capping by closest point</span></div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;            <span class="comment">// 2.1. capping projection</span></div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;            <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a066c372521b61e61bc86146ea4a9fc66">geo::PlaneGeo::WidthDepthProjection_t</a> expected_movedProjection(</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;                (inWidth?</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;                  expected_w: (expected_w &lt; 0)? -halfWidth: +halfWidth),</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;                (inDepth?</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;                  expected_d: (expected_d &lt; 0)? -halfDepth: +halfDepth)</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;              );</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;            <span class="keyword">auto</span> movedProjection = plane.MoveProjectionToPlane(expected_proj);</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;            <span class="keywordflow">if</span> (vector2Dis.nonEqual(movedProjection, expected_movedProjection))</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;            {</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;              ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;              mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;[testPlaneProjectionOnFrame] moveProjectionOnPlane():&quot;</span></div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Projection of ooint &quot;</span> &lt;&lt; expected_point</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; (width: &quot;</span> &lt;&lt; expected_w &lt;&lt; <span class="stringliteral">&quot;, depth: &quot;</span> &lt;&lt; expected_d</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;) (&quot;</span> &lt;&lt; (onPlane? <span class="stringliteral">&quot;on&quot;</span>: <span class="stringliteral">&quot;off&quot;</span>)</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;-plane &quot;</span> &lt;&lt; plane.ID() &lt;&lt; <span class="stringliteral">&quot;) was moved to &quot;</span></div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;                &lt;&lt; movedProjection &lt;&lt; <span class="stringliteral">&quot; while it should have moved to &quot;</span></div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;                &lt;&lt; expected_movedProjection</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>;</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;            }</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;            <span class="comment">// 2.2. capping point</span></div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;            <span class="keyword">auto</span> expected_movedPoint</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;              = plane.ComposePoint(distance, expected_movedProjection);</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;            <span class="keyword">auto</span> movedPoint = plane.MovePointOverPlane(expected_point);</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;            <span class="keywordflow">if</span> (vectorIs.nonEqual(movedPoint, expected_movedPoint)) {</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;              ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;              mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;[testPlaneProjectionOnFrame] movePointOnPlane(): &quot;</span></div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Point &quot;</span> &lt;&lt; expected_point</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; (width: &quot;</span> &lt;&lt; expected_w &lt;&lt; <span class="stringliteral">&quot;, depth: &quot;</span> &lt;&lt; expected_d</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;) (&quot;</span> &lt;&lt; (onPlane? <span class="stringliteral">&quot;on&quot;</span>: <span class="stringliteral">&quot;off&quot;</span>)</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;-plane &quot;</span> &lt;&lt; plane.ID() &lt;&lt; <span class="stringliteral">&quot;) was moved to &quot;</span></div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;                &lt;&lt; movedPoint &lt;&lt; <span class="stringliteral">&quot; while it should have moved to &quot;</span></div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;                &lt;&lt; expected_movedPoint</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>;</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;            }</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;          } <span class="comment">// for distance</span></div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;        } <span class="comment">// for depth step</span></div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;      } <span class="comment">// for width step</span></div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;    } <span class="comment">// for planes</span></div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;    <span class="keywordflow">if</span> (nErrors &gt; 0) {</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;GeoTestPlaneProjection&quot;</span>)</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Accumulated &quot;</span> &lt;&lt; nErrors &lt;&lt; <span class="stringliteral">&quot; errors (see messages above)\n&quot;</span>;</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    }</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;  } <span class="comment">// testPlaneProjectionOnFrame()</span></div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l01986"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a058cc5c10890fd50cd20360ec48f53f1"> 1986</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testPlaneProjection()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;    <span class="comment">// Check the definition of the reference</span></div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;    testPlaneProjectionReference();</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    <span class="comment">// Check the projections and point composition in the plane frame reference</span></div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;    testPlanePointDecompositionFrame();</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;    <span class="comment">// Check containment</span></div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;    testPlaneProjectionOnFrame();</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;  } <span class="comment">// GeometryTestAlg::testPlaneProjection()</span></div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l02009"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a5df7c8f2b8e5116df956c62c8a7d95d1"> 2009</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testStandardWirePos()</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;  {</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    <span class="keywordtype">double</span> xyz[3] = {0.};</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;    <span class="keywordtype">double</span> xyzprev[3] = {0.};</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> cs = 0; cs &lt; geom-&gt;Ncryostats(); ++cs){</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> t = 0; t &lt; geom-&gt;Cryostat(cs).NTPC(); ++t){</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html">geo::TPCGeo</a>* tpc = &amp;geom-&gt;Cryostat(cs).TPC(t);</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i &lt; tpc-&gt;<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#ab3391de99203f6a60eeeef152d3adb35">Nplanes</a>(); ++i) {</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a>* plane = &amp;tpc-&gt;<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a411eea9dd765636914a618ded267558c">Plane</a>(i);</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 1; j &lt; plane-&gt;<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a0aeb7d438b1337c138277335a4e666a1">Nwires</a>(); ++j) {</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;            <a class="code" href="../../de/dce/classgeo_1_1WireGeo.html">geo::WireGeo</a> <span class="keyword">const</span>&amp; wire = plane-&gt;<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a52fd8fb79c65318b52d60acb58c9a0d3">Wire</a>(j);</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;            <a class="code" href="../../de/dce/classgeo_1_1WireGeo.html">geo::WireGeo</a> <span class="keyword">const</span>&amp; wireprev = plane-&gt;<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a52fd8fb79c65318b52d60acb58c9a0d3">Wire</a>(j-1);</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;            wire.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#a967f3f96296bf6953f8405ac4e5e7427">GetCenter</a>(xyz);</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;            wireprev.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#a967f3f96296bf6953f8405ac4e5e7427">GetCenter</a>(xyzprev);</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;            <span class="comment">// wires increase in +z order</span></div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;            <span class="keywordflow">if</span>(xyz[2] &lt; xyzprev[2])</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;              <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;WireOrderProblem&quot;</span>)         &lt;&lt; <span class="stringliteral">&quot;\n\twires do not increase in +z order in&quot;</span></div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;                                                        &lt;&lt; <span class="stringliteral">&quot;Cryostat &quot;</span> &lt;&lt; cs</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;                                                        &lt;&lt; <span class="stringliteral">&quot;, TPC &quot;</span> &lt;&lt; t</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;                                                        &lt;&lt; <span class="stringliteral">&quot;, Plane &quot;</span> &lt;&lt; i</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;                                                        &lt;&lt; <span class="stringliteral">&quot;;  at wire &quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;          }<span class="comment">// end loop over wires</span></div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;        }<span class="comment">// end loop over planes</span></div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;      }<span class="comment">// end loop over tpcs</span></div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;    }<span class="comment">// end loop over cryostats</span></div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;}</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l02044"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a4af718cd6f6fd7b7bff31b20609ff4b9"> 2044</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testAPAWirePos()</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;  {</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../d6/d23/namespacegeo.html#a6155d04d62c8bb11135137324ab26b5c">origin</a>[3] = {0.};</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    <span class="keywordtype">double</span> tpcworld[3] = {0.};</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;    <span class="keywordtype">double</span> xyz[3] = {0.};</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;    <span class="keywordtype">double</span> xyzprev[3] = {0.};</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> cs = 0; cs &lt; geom-&gt;Ncryostats(); ++cs){</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> t = 0; t &lt; geom-&gt;Cryostat(cs).NTPC(); ++t){</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html">geo::TPCGeo</a>* tpc = &amp;geom-&gt;Cryostat(cs).TPC(t);</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;        tpc-&gt;<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a3f663d96f6fe0ad88a84fa7dd0c9fc77">LocalToWorld</a>(origin, tpcworld);</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i &lt; tpc-&gt;<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#ab3391de99203f6a60eeeef152d3adb35">Nplanes</a>(); ++i) {</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a>* plane = &amp;tpc-&gt;<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a411eea9dd765636914a618ded267558c">Plane</a>(i);</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 1; j &lt; plane-&gt;<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a0aeb7d438b1337c138277335a4e666a1">Nwires</a>(); ++j) {</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;            <a class="code" href="../../de/dce/classgeo_1_1WireGeo.html">geo::WireGeo</a> <span class="keyword">const</span>&amp; wire = plane-&gt;<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a52fd8fb79c65318b52d60acb58c9a0d3">Wire</a>(j);</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;            <a class="code" href="../../de/dce/classgeo_1_1WireGeo.html">geo::WireGeo</a> <span class="keyword">const</span>&amp; wireprev = plane-&gt;<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a52fd8fb79c65318b52d60acb58c9a0d3">Wire</a>(j-1);</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;            wire.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#a967f3f96296bf6953f8405ac4e5e7427">GetCenter</a>(xyz);</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;            wireprev.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#a967f3f96296bf6953f8405ac4e5e7427">GetCenter</a>(xyzprev);</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;            <span class="comment">// top TPC wires increase in -y</span></div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;            <span class="keywordflow">if</span>(tpcworld[1] &gt; 0 &amp;&amp; xyz[1] &gt; xyzprev[1])</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;              <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;WireOrderProblem&quot;</span>)         &lt;&lt; <span class="stringliteral">&quot;\n\ttop TPC wires do not increase in -y order in&quot;</span></div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;                                                        &lt;&lt; <span class="stringliteral">&quot;Cryostat &quot;</span> &lt;&lt; cs</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;                                                        &lt;&lt; <span class="stringliteral">&quot;, TPC &quot;</span> &lt;&lt; t</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;                                                        &lt;&lt; <span class="stringliteral">&quot;, Plane &quot;</span> &lt;&lt; i</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;                                                        &lt;&lt; <span class="stringliteral">&quot;;  at wire &quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;            <span class="comment">// bottom TPC wires increase in +y</span></div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tpcworld[1] &lt; 0 &amp;&amp; xyz[1] &lt; xyzprev[1])</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;              <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;WireOrderProblem&quot;</span>)         &lt;&lt; <span class="stringliteral">&quot;\n\tbottom TPC wires do not increase in +y order in&quot;</span></div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;                                                        &lt;&lt; <span class="stringliteral">&quot;Cryostat &quot;</span> &lt;&lt; cs</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;                                                        &lt;&lt; <span class="stringliteral">&quot;, TPC &quot;</span> &lt;&lt; t</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;                                                        &lt;&lt; <span class="stringliteral">&quot;, Plane &quot;</span> &lt;&lt; i</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;                                                        &lt;&lt; <span class="stringliteral">&quot;;  at wire &quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;          }<span class="comment">// end loop over wires</span></div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;        }<span class="comment">// end loop over planes</span></div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;      }<span class="comment">// end loop over tpcs</span></div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;    }<span class="comment">// end loop over cryostats</span></div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;  }</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;  <span class="keyword">inline</span> std::array&lt;double, 3&gt; GeometryTestAlg::GetIncreasingWireDirection</div>
<div class="line"><a name="l02089"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a64cd5157ec4c3948918f3144f09e6776"> 2089</a></span>&#160;    (<span class="keyword">const</span> <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a>&amp; plane)</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;  {</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;    TVector3 IncreasingWireDir = plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#aa136661c166fee6b9f9888423ac2824d">GetIncreasingWireDirection</a>();</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;    <span class="comment">// BUG the double brace syntax is required to work around clang bug 21629</span></div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;    <span class="comment">// (https://bugs.llvm.org/show_bug.cgi?id=21629)</span></div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;      {{ IncreasingWireDir.X(), IncreasingWireDir.Y(), IncreasingWireDir.Z() }};</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;  } <span class="comment">// GeometryTestAlg::GetIncreasingWireDirection()</span></div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l02100"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#ab9e08fcb49ce7e8adc7bb1c14424994f"> 2100</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testNearestWire()</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;  {</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;    <span class="comment">// Even if you comment it out, please leave the TStopWatch code</span></div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;    <span class="comment">// in this code for additional testing. The NearestChannel routine</span></div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;    <span class="comment">// is the most frequently called in the simulation, so its execution time</span></div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;    <span class="comment">// is an important component of LArSoft&#39;s speed.</span></div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;    TStopwatch stopWatch;</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;    stopWatch.Start();</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;    <span class="keywordtype">bool</span> bTestWireCoordinate = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;    <span class="comment">// get a wire and find its center</span></div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a> <span class="keyword">const</span>&amp; plane: geom-&gt;IteratePlanes()) {</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;      <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> <span class="keyword">const</span>&amp; planeID = plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a9c059f407b135ec46f78688545f9d095">ID</a>();</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NWires = plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a0aeb7d438b1337c138277335a4e666a1">Nwires</a>();</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;      decltype(<span class="keyword">auto</span>) IncreasingWireDir = plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#aa136661c166fee6b9f9888423ac2824d">GetIncreasingWireDirection</a>();</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;      MF_LOG_DEBUG(<span class="stringliteral">&quot;GeoTestWireCoordinate&quot;</span>)</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;The direction of increasing wires for plane &quot;</span> &lt;&lt; planeID</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;        &lt;&lt; <span class="stringliteral">&quot; (theta=&quot;</span> &lt;&lt; plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a52fd8fb79c65318b52d60acb58c9a0d3">Wire</a>(0).<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#a0607dce1b981e52fc158ad5cbfd343d0">ThetaZ</a>() &lt;&lt; <span class="stringliteral">&quot; pitch=&quot;</span></div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;        &lt;&lt; plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#abbb4a8a4b112ec8e24cc970a40e8b592">WirePitch</a>() &lt;&lt; <span class="stringliteral">&quot; orientation=&quot;</span></div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;        &lt;&lt; (plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#ab096479e47140e77ec1050096d446a23">Orientation</a>() == <a class="code" href="../../d6/d23/namespacegeo.html#aa466678f5f635eee4a8179671f3aae7eaf7e5e120c91f8fae9de103aefe12b0ca">geo::kHorizontal</a>? <span class="stringliteral">&quot;H&quot;</span>: <span class="stringliteral">&quot;V&quot;</span>)</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;        &lt;&lt; (plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a194e03f145090c263964158661ed5c12">WireIDincreasesWithZ</a>()? <span class="stringliteral">&quot;+&quot;</span>: <span class="stringliteral">&quot;-&quot;</span>)</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;) is &quot;</span> &lt;&lt; IncreasingWireDir;</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;      <a class="code" href="../../de/db1/structgeo_1_1WireID.html#a51daaae3404ddba50f4585a9820e751f">geo::WireID::WireID_t</a> <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">w</a> = 0;</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html">geo::WireGeo</a> <span class="keyword">const</span>&amp; wire: plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a353efd073bc89de1a1c429b8b66df291">IterateWires</a>()) {</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;        <a class="code" href="../../de/db1/structgeo_1_1WireID.html">geo::WireID</a> wireID(planeID, w++);</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;        decltype(<span class="keyword">auto</span>) wire_center = wire.GetCenter();</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;        uint32_t nearest = 0;</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;        std::vector&lt; geo::WireID &gt; wireIDs;</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;        <span class="keywordflow">try</span>{</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;          <span class="comment">// The double[] version tested here falls back on the</span></div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;          <span class="comment">// TVector3 version, so this test both.</span></div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;          nearest = geom-&gt;NearestChannel(wire_center, planeID);</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;          <span class="comment">// We also want to test the std::vector&lt;double&gt; version</span></div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;          std::vector&lt;double&gt; posWorldV(3);</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;3; ++i) {</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;            posWorldV[i] = wire_center[i] + 0.001;</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;          }</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;          nearest = geom-&gt;NearestChannel(posWorldV, planeID);</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;        }</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;        <span class="keywordflow">catch</span>(cet::exception &amp;e){</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;          mf::LogWarning(<span class="stringliteral">&quot;GeoTestCaughtException&quot;</span>) &lt;&lt; <a class="code" href="../../d4/dca/updateVersionList_8sh.html#a067a8c1534d6da9b2c501a6cf4ef89bd">e</a>;</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;          <span class="keywordflow">if</span> (fNonFatalExceptions.count(e.category()) == 0) <span class="keywordflow">throw</span>;</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;        }</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;        <span class="keywordflow">try</span>{</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;          wireIDs = geom-&gt;ChannelToWire(nearest);</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;          <span class="keywordflow">if</span> ( wireIDs.empty() ) {</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;            <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;BadPositionToChannel&quot;</span>)</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;test point is at &quot;</span> &lt;&lt; wire_center</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; nearest channel is &quot;</span> &lt;&lt; nearest</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; for &quot;</span> &lt;&lt; std::string(wireID)</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;          }</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;        }</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;        <span class="keywordflow">catch</span>(cet::exception &amp;e){</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;          mf::LogWarning(<span class="stringliteral">&quot;GeoTestCaughtException&quot;</span>) &lt;&lt; <a class="code" href="../../d4/dca/updateVersionList_8sh.html#a067a8c1534d6da9b2c501a6cf4ef89bd">e</a>;</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;          <span class="keywordflow">if</span> (fNonFatalExceptions.count(e.category()) == 0) <span class="keywordflow">throw</span>;</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;        }</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;        <span class="keywordflow">if</span>(std::find(wireIDs.begin(), wireIDs.end(), wireID) == wireIDs.end()) {</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;          <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;BadPositionToChannel&quot;</span>)</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;Current wire &quot;</span> &lt;&lt; std::string(wireID)</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; has a world position at &quot;</span> &lt;&lt; wire_center</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\nNearestWire for this position is &quot;</span></div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;              &lt;&lt; geom-&gt;NearestWire(wire_center, planeID)</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\nNearestChannel is &quot;</span> &lt;&lt; nearest</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\nShould be channel &quot;</span> &lt;&lt; geom-&gt;PlaneWireToChannel(wireID);</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;        } <span class="comment">// if good lookup fails</span></div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;        <span class="comment">// nearest wire, integral and floating point</span></div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;        <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;          <span class="comment">// The test consists in sampling NStep (=5) points between the current</span></div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;          <span class="comment">// wire and the previous/next, following the normal to the wire.</span></div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;          <span class="comment">// We expect WireCoordinate() to reflect the same shift.</span></div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;          <span class="comment">// using absolute value just in case (what happens if w1 &gt; w2?)</span></div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">double</span> pitch = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(geom-&gt;WirePitch(planeID));</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;          TVector3 wire_shifted;</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;          TVector3 <span class="keyword">const</span> step = pitch * IncreasingWireDir;</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;          constexpr <span class="keywordtype">int</span> NSteps = 5; <span class="comment">// odd value avoids testing half-way</span></div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = -NSteps; i &lt;= +NSteps; ++i) {</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;            <span class="comment">// we move away by this fraction of wire:</span></div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> f = NSteps? (double(i) / NSteps): 0.0;</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;            <span class="comment">// these are the actual shifts on the positive directions y and z</span></div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;            TVector3 <span class="keyword">const</span> delta = f * step;</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;            TVector3 <span class="keyword">const</span> wire_shifted = wire_center + delta;</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;            <span class="comment">// we expect this wire number</span></div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> expected_wire = wireID.<a class="code" href="../../de/db1/structgeo_1_1WireID.html#ac303d2971eb9697f3a65821bb92bb934">Wire</a> + f;</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;            <span class="keywordtype">double</span> wire_from_wc = 0;</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;            <span class="keywordflow">if</span> (bTestWireCoordinate) {</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;              <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;                wire_from_wc = geom-&gt;WireCoordinate(wire_shifted, planeID);</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;              }</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;              <span class="keywordflow">catch</span> (cet::exception&amp; e) {</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;                <span class="keywordflow">if</span> (hasCategory(e, <span class="stringliteral">&quot;NotImplemented&quot;</span>)) {</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;                  MF_LOG_ERROR(<span class="stringliteral">&quot;GeoTestWireCoordinate&quot;</span>)</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;WireCoordinate() is not implemented for your ChannelMap;&quot;</span></div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;                    <span class="stringliteral">&quot; skipping the test&quot;</span>;</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;                  bTestWireCoordinate = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;                }</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bTestWireCoordinate) <span class="keywordflow">throw</span>;</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;              }</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;            }</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;            <span class="keywordflow">if</span> (bTestWireCoordinate) {</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;              <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(wire_from_wc - expected_wire) &gt; 1e-3) {</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;              <span class="comment">//  throw cet::exception(&quot;GeoTestErrorWireCoordinate&quot;)</span></div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;                mf::LogError(<span class="stringliteral">&quot;GeoTestWireCoordinate&quot;</span>)</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;wire &quot;</span> &lt;&lt; wireID</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; [center: &quot;</span> &lt;&lt; wire_center &lt;&lt; <span class="stringliteral">&quot;] on step of &quot;</span></div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;                  &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; NSteps</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; x&quot;</span> &lt;&lt; step &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; delta</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; cm shows &quot;</span> &lt;&lt; wire_from_wc &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; expected_wire</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; expected.\n&quot;</span>;</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;              } <span class="comment">// if mismatch</span></div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;            } <span class="comment">// if testing WireCoordinate</span></div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;            <span class="keywordflow">if</span> ((expected_wire &gt; -0.5) &amp;&amp; (expected_wire &lt; NWires - 0.5)) {</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> expected_wire_number = std::round(expected_wire);</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;              <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wire_number_from_wc;</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;              <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;                wire_number_from_wc = geom-&gt;NearestWire(wire_shifted, planeID);</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;              }</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;              <span class="keywordflow">catch</span> (cet::exception&amp; e) {</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;                <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;GeoTestErrorWireCoordinate&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, e)</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;              <span class="comment">//  MF_LOG_ERROR(&quot;GeoTestWireCoordinate&quot;)</span></div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;wire &quot;</span> &lt;&lt; std::string(wireID)</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; [center: &quot;</span> &lt;&lt; wire_center &lt;&lt; <span class="stringliteral">&quot;] on step of &quot;</span></div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;                  &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; NSteps</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; x&quot;</span> &lt;&lt; step &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; delta</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; cm failed NearestWire(), &quot;</span> &lt;&lt; expected_wire_number</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; expected (more precisely, &quot;</span> &lt;&lt; expected_wire &lt;&lt; <span class="stringliteral">&quot;).\n&quot;</span>;</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;              }</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;              <span class="keywordflow">if</span> (mf::isDebugEnabled()) {</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;                <span class="comment">// In debug mode, we print a lot and we don&#39;t (fatally) complain</span></div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;                std::stringstream <a class="code" href="../../d4/dca/updateVersionList_8sh.html#a067a8c1534d6da9b2c501a6cf4ef89bd">e</a>;</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;                e &lt;&lt; <span class="stringliteral">&quot;wire &quot;</span> &lt;&lt; wireID</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; [center: &quot;</span> &lt;&lt; wire_center &lt;&lt; <span class="stringliteral">&quot;] on step of &quot;</span></div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;                  &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; NSteps</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; x&quot;</span> &lt;&lt; step &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; delta &lt;&lt; <span class="stringliteral">&quot; cm near to &quot;</span></div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;                  &lt;&lt; wire_number_from_wc;</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;                <span class="keywordflow">if</span> (wire_number_from_wc != expected_wire_number) {</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;                  e &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; expected_wire_number</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; expected (more precisely, &quot;</span> &lt;&lt; expected_wire &lt;&lt; <span class="stringliteral">&quot;).&quot;</span>;</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;                <span class="comment">// throw e;</span></div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;                  MF_LOG_ERROR(<span class="stringliteral">&quot;GeoTestWireCoordinate&quot;</span>) &lt;&lt; e.str();</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;                }</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;                <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;                  mf::LogVerbatim(<span class="stringliteral">&quot;GeoTestWireCoordinate&quot;</span>) &lt;&lt; e.str();</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;                }</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;              }</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wire_number_from_wc != expected_wire_number) {</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;                <span class="comment">// In production mode, we don&#39;t print anything and throw on error</span></div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;                <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;GeoTestErrorWireCoordinate&quot;</span>)</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;wire &quot;</span> &lt;&lt; std::string(wireID)</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; [center: &quot;</span> &lt;&lt; wire_center &lt;&lt; <span class="stringliteral">&quot;] on step of &quot;</span></div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;                  &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; NSteps</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; x&quot;</span> &lt;&lt; step &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; delta</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; cm near to &quot;</span> &lt;&lt; wire_number_from_wc</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; expected_wire_number</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; expected (more precisely, &quot;</span> &lt;&lt; expected_wire &lt;&lt; <span class="stringliteral">&quot;).&quot;</span>;</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;              }</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;            } <span class="comment">// if shifted wire not outside boundaries</span></div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;          } <span class="comment">// for i</span></div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;        } <span class="comment">// try</span></div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;        <span class="keywordflow">catch</span>(cet::exception &amp;e) {</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;          mf::LogWarning(<span class="stringliteral">&quot;GeoTestCaughtException&quot;</span>) &lt;&lt; <a class="code" href="../../d4/dca/updateVersionList_8sh.html#a067a8c1534d6da9b2c501a6cf4ef89bd">e</a>;</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;          <span class="keywordflow">if</span> (fNonFatalExceptions.count(e.category()) == 0) <span class="keywordflow">throw</span>;</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;        }</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;      } <span class="comment">// for all wires in the plane</span></div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;    } <span class="comment">// end loop over planes</span></div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;    stopWatch.Stop();</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;    MF_LOG_DEBUG(<span class="stringliteral">&quot;GeoTestWireCoordinate&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\tdone testing closest channel&quot;</span>;</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;    stopWatch.Print();</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;    <span class="comment">// trigger an exception with NearestChannel</span></div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;    mf::LogVerbatim(<span class="stringliteral">&quot;GeoTestWireCoordinate&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\tattempt to cause an exception to be caught &quot;</span></div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;                                             &lt;&lt; <span class="stringliteral">&quot;when looking for a nearest channel&quot;</span>;</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;    <span class="comment">// pick a position out of the world</span></div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;    <span class="keywordtype">double</span> posWorld[3];</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;    geom-&gt;WorldBox(<span class="keyword">nullptr</span>, posWorld + 0,</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;      <span class="keyword">nullptr</span>, posWorld + 1, <span class="keyword">nullptr</span>, posWorld + 2);</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; ++i) posWorld[i] *= 2.;</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;    <span class="keywordtype">bool</span> hasThrown = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nearest_to_what = 0;</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;    <span class="keywordflow">try</span>{</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;      nearest_to_what = geom-&gt;NearestChannel(posWorld, 0, 0, 0);</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;    }</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;    <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="../../d2/d09/classgeo_1_1InvalidWireIDError.html">geo::InvalidWireIDError</a>&amp; e){</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;      mf::LogWarning(<span class="stringliteral">&quot;GeoTestCaughtException&quot;</span>) &lt;&lt; e</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;\nReturned wire would be: &quot;</span> &lt;&lt; e.<a class="code" href="../../d2/d09/classgeo_1_1InvalidWireIDError.html#ad637cb756a2b9bee0df19f77578ca5df">wire_number</a></div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;, suggested: &quot;</span> &lt;&lt; e.<a class="code" href="../../d2/d09/classgeo_1_1InvalidWireIDError.html#a8174e289df4013b806bd949975ef70a2">better_wire_number</a>;</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;      hasThrown = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;    }</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;    <span class="keywordflow">catch</span>(cet::exception&amp; e){</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;      mf::LogWarning(<span class="stringliteral">&quot;GeoTestCaughtException&quot;</span>) &lt;&lt; <a class="code" href="../../d4/dca/updateVersionList_8sh.html#a067a8c1534d6da9b2c501a6cf4ef89bd">e</a>;</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;      hasThrown = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;    }</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;    <span class="keywordflow">if</span> (!hasThrown) {</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;      <span class="keywordflow">if</span> (fDisableValidWireIDcheck) {</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;        <span class="comment">// ok, then why do we disable it?</span></div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;        <span class="comment">// an implementation might prefer to cap the wire number and go on</span></div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;        <span class="comment">// instead of throwing.</span></div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;        <a class="code" href="../../d2/d1a/namespacedetsim.html#ac17a92de25bbd84bdd320811fff947c6">MF_LOG_WARNING</a>(<span class="stringliteral">&quot;GeoTestWireCoordinate&quot;</span>)</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;GeometryCore::NearestChannel() did not raise an exception&quot;</span></div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;          <span class="stringliteral">&quot; on out-of-world position (&quot;</span> &lt;&lt; posWorld[0] &lt;&lt; <span class="stringliteral">&quot;; &quot;</span></div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;          &lt;&lt; posWorld[1] &lt;&lt; <span class="stringliteral">&quot;; &quot;</span> &lt;&lt; posWorld[2] &lt;&lt; <span class="stringliteral">&quot;), and returned &quot;</span></div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;          &lt;&lt; nearest_to_what &lt;&lt; <span class="stringliteral">&quot; instead.\n&quot;</span></div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;          <span class="stringliteral">&quot;This is normally considered a failure.&quot;</span>;</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;      }</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;        <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;GeoTestErrorNearestChannel&quot;</span>)</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;GeometryCore::NearestChannel() did not raise an exception&quot;</span></div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;          <span class="stringliteral">&quot; on out-of-world position (&quot;</span> &lt;&lt; posWorld[0] &lt;&lt; <span class="stringliteral">&quot;; &quot;</span></div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;          &lt;&lt; posWorld[1] &lt;&lt; <span class="stringliteral">&quot;; &quot;</span> &lt;&lt; posWorld[2] &lt;&lt; <span class="stringliteral">&quot;), and returned &quot;</span></div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;          &lt;&lt; nearest_to_what &lt;&lt; <span class="stringliteral">&quot; instead\n&quot;</span>;</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;      }</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;    }</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;  }</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;  <span class="keywordtype">bool</span> GeometryTestAlg::isWireAlignedToPlaneDirections</div>
<div class="line"><a name="l02348"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a1072a3bb6a739e710aab9c03f6deeae7"> 2348</a></span>&#160;    (<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a> <span class="keyword">const</span>&amp; plane, <a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a> <span class="keyword">const</span>&amp; wireDir) <span class="keyword">const</span></div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;  {</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;<span class="comment">     * Returns `true` if `wireDir` is aligned with plane frame or wire direction</span></div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;    </div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;    <span class="keyword">auto</span> <span class="keyword">const</span> isOrthogonalTo = [&amp;wireDir](<a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a> <span class="keyword">const</span>&amp; other)</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;      { <span class="keywordflow">return</span> <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a6a834f7c51903b6d2bdfdd664f064992">geo::vect::dot</a>(wireDir, other)) &lt; 1.0e-5; };</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;    </div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;    <span class="comment">// we dislike wires aligned to plane frame:</span></div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;    <span class="keywordflow">if</span> (isOrthogonalTo(plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a07e3bb39c18911d0f71e45f1c0c0fe0f">WidthDir</a>&lt;<a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a>&gt;()))</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;    <span class="keywordflow">if</span> (isOrthogonalTo(plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a6751f12e587b8d5c75edb63d751d10d6">DepthDir</a>&lt;<a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a>&gt;()))</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;    </div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;    <span class="keywordflow">if</span> (isOrthogonalTo(plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#aa136661c166fee6b9f9888423ac2824d">GetIncreasingWireDirection</a>&lt;<a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a>&gt;()))</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;    </div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;    </div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;  } <span class="comment">// isWireAlignedToPlaneDirections()</span></div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;  </div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;  </div>
<div class="line"><a name="l02371"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a8aec3310f45dc8858448069eddb3e335"> 2371</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testWireIntersection()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;<span class="comment">     * This is a test for geo::GeometryCore::WireIDsIntersect() and </span></div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;<span class="comment">     * geo::WireGeo::IntersectionWith() methods, that return whether two wires</span></div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;<span class="comment">     * intersect, and where.</span></div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;<span class="comment">     * The test strategy is to check all the TPC one by one:</span></div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;<span class="comment">     * - if a query for wires on different cryostats fails</span></div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;<span class="comment">     * - if a query for wires on different TPCs fails</span></div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;<span class="comment">     * - if a query for wires on the same plane fails</span></div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;<span class="comment">     * - for points at the centre of a grid SplitY x SplitZ on the wire planes,</span></div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;<span class="comment">     *   test these point by testWireIntersectionAt() function (see)</span></div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;<span class="comment">     * All tests are performed; at the end, the test is considered a failure</span></div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;<span class="comment">     * if any of the single tests failed.</span></div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a> = 0;</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html">geo::TPCGeo</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>: geom-&gt;IterateTPCs()) {</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;      MF_LOG_DEBUG(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Wire intersection test on &quot;</span> &lt;&lt; <a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>.ID();</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;      <span class="comment">// sanity: wires on different cryostats</span></div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>.ID().Cryostat &lt; geom-&gt;Ncryostats() - 1) {</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;        </div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;        <a class="code" href="../../de/db1/structgeo_1_1WireID.html">geo::WireID</a> <span class="keyword">const</span> w1 { <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a>{ <a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>.ID(), 0 }, 0 };</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;        <a class="code" href="../../de/dce/classgeo_1_1WireGeo.html">geo::WireGeo</a> <span class="keyword">const</span>&amp; wire1 = geom-&gt;Wire(w1);</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;        <a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a> <span class="keyword">const</span>&amp; wireDir = wire1.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#a3e7aa14d29e74b735f79b176ffd6a1f8">Direction</a>&lt;<a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a>&gt;();</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;        </div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;        <a class="code" href="../../de/da3/classgeo_1_1CryostatGeo.html">geo::CryostatGeo</a> <span class="keyword">const</span>&amp; otherCryo</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;          = geom-&gt;Cryostat(<a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>.ID().Cryostat + 1);</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;        <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a> <span class="keyword">const</span>* otherPlane = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a> <span class="keyword">const</span>&amp; plane: geom-&gt;IteratePlanes(otherCryo.ID())) {</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;          <span class="keywordflow">if</span> (isWireAlignedToPlaneDirections(plane, wireDir)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;          otherPlane = &amp;plane;</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;        }</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;        <span class="keywordflow">if</span> (otherPlane) {</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;          <a class="code" href="../../de/db1/structgeo_1_1WireID.html">geo::WireID</a> <span class="keyword">const</span> w2 { otherPlane-&gt;<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a9c059f407b135ec46f78688545f9d095">ID</a>(), 1 };</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;          MF_LOG_TRACE(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;Off cryostat test (&quot;</span> &lt;&lt; w1 &lt;&lt; <span class="stringliteral">&quot;): chosen wire &quot;</span> &lt;&lt; w2;</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;          <a class="code" href="../../d6/d23/namespacegeo.html#a5a6f22c2aa9d0ccf6ca08bf2773a0541">geo::Point_t</a> xingPoint;</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;          <span class="keywordflow">if</span> (geom-&gt;WireIDsIntersect(w1, w2, xingPoint)) {</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;            MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;WireIDsIntersect() on &quot;</span> &lt;&lt; w1</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; w2 &lt;&lt; <span class="stringliteral">&quot; returned &quot;</span> &lt;&lt; xingPoint</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; cm, while should have reported no intersection at all&quot;</span>;</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;          } <span class="comment">// if intersect</span></div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;          <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;            <span class="comment">// the value of result is not checked here</span></div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;            wire1.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#abe8a2d7e13862adb76df0d12558f088e">IntersectionWith</a>(geom-&gt;Wire(w2));</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;          }</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;          <span class="keywordflow">catch</span>(...) {</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;            MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;WiresIntersect() on &quot;</span> &lt;&lt; w1</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; w2 &lt;&lt; <span class="stringliteral">&quot; threw an exception, which should not have&quot;</span>;</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;          }</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;        }</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;          <a class="code" href="../../d2/d1a/namespacedetsim.html#ac17a92de25bbd84bdd320811fff947c6">MF_LOG_WARNING</a>(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;No wire plane found in &quot;</span> &lt;&lt; otherCryo.ID()</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; with wires not aligned with &quot;</span> &lt;&lt; w1.asPlaneID()</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; wireDir &lt;&lt; <span class="stringliteral">&quot;; off-cryostat sanity check skipped.&quot;</span>;</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;        }</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;        </div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;      } <span class="comment">// if not the last cryostat</span></div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;      <span class="comment">// sanity: wires on different TPC</span></div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>.ID().TPC &lt; geom-&gt;NTPC(<a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>.ID().asCryostatID()) - 1) {</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;        </div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;        <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> <span class="keyword">const</span> refPlaneID { <a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>.ID(), 0 };</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;        <a class="code" href="../../de/db1/structgeo_1_1WireID.html">geo::WireID</a> <span class="keyword">const</span> w1 { refPlaneID, 0 };</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;        <a class="code" href="../../de/dce/classgeo_1_1WireGeo.html">geo::WireGeo</a> <span class="keyword">const</span>&amp; wire1 = geom-&gt;Wire(w1);</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;        <a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a> <span class="keyword">const</span>&amp; wireDir = wire1.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#a3e7aa14d29e74b735f79b176ffd6a1f8">Direction</a>&lt;<a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a>&gt;();</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;        </div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;        <a class="code" href="../../de/da3/classgeo_1_1CryostatGeo.html">geo::CryostatGeo</a> <span class="keyword">const</span>&amp; cryo = geom-&gt;Cryostat(<a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>.ID());</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;        <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a> <span class="keyword">const</span>* otherPlane = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a> <span class="keyword">const</span>&amp; plane: geom-&gt;IteratePlanes(cryo.ID())) {</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;          <span class="keywordflow">if</span> (plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a9c059f407b135ec46f78688545f9d095">ID</a>().<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#afbbfe0283793584dbbb2f2a8a1079de6">asTPCID</a>() == <a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>.ID()) <span class="keywordflow">continue</span>; <span class="comment">// on the same TPC</span></div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;          <span class="keywordflow">if</span> (isWireAlignedToPlaneDirections(plane, wireDir)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;          otherPlane = &amp;plane;</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;        }</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;        <span class="keywordflow">if</span> (otherPlane) {</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;          <a class="code" href="../../de/db1/structgeo_1_1WireID.html">geo::WireID</a> <span class="keyword">const</span> w2 { otherPlane-&gt;<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a9c059f407b135ec46f78688545f9d095">ID</a>(), 1 };</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;          MF_LOG_TRACE(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;Off TPC test (&quot;</span> &lt;&lt; w1 &lt;&lt; <span class="stringliteral">&quot;): chosen wire &quot;</span> &lt;&lt; w2;</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;          <a class="code" href="../../d6/d23/namespacegeo.html#a5a6f22c2aa9d0ccf6ca08bf2773a0541">geo::Point_t</a> xingPoint;</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;          <span class="keywordflow">if</span> (geom-&gt;WireIDsIntersect(w1, w2, xingPoint)) {</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;            MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;WireIDsIntersect() on &quot;</span> &lt;&lt; w1</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; w2 &lt;&lt; <span class="stringliteral">&quot; returned &quot;</span> &lt;&lt; xingPoint</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;, while should have reported no intersection at all&quot;</span>;</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;          } <span class="comment">// if intersect</span></div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;          <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;            <span class="comment">// the value of result is not checked here</span></div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;            wire1.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#abe8a2d7e13862adb76df0d12558f088e">IntersectionWith</a>(geom-&gt;Wire(w2));</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;          }</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;          <span class="keywordflow">catch</span>(...) {</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;            MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;WiresIntersect() on &quot;</span> &lt;&lt; w1</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; w2 &lt;&lt; <span class="stringliteral">&quot; threw an exception, which should not have&quot;</span>;</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;          }</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;        }</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;          <a class="code" href="../../d2/d1a/namespacedetsim.html#ac17a92de25bbd84bdd320811fff947c6">MF_LOG_WARNING</a>(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;No wire plane found in any TPC of &quot;</span> &lt;&lt; cryo.ID()</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; with wires not aligned with &quot;</span> &lt;&lt; refPlaneID</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; wireDir &lt;&lt; <span class="stringliteral">&quot;; off-TPC sanity check skipped.&quot;</span>;</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;        }</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;      } <span class="comment">// if not the last TPC</span></div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;      <span class="comment">// sanity: wires on same plane</span></div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a> <span class="keyword">const</span>&amp; plane: <a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>.IteratePlanes()) {</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;        <a class="code" href="../../de/db1/structgeo_1_1WireID.html">geo::WireID</a> <span class="keyword">const</span> w1 { plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a9c059f407b135ec46f78688545f9d095">ID</a>(), 0 }, w2 { plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a9c059f407b135ec46f78688545f9d095">ID</a>(), 1 };</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;        <a class="code" href="../../d6/d23/namespacegeo.html#a5a6f22c2aa9d0ccf6ca08bf2773a0541">geo::Point_t</a> xingPoint;</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;        <span class="keywordflow">if</span> (geom-&gt;WireIDsIntersect(w1, w2, xingPoint)) {</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;          MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;WireIDsIntersect() on &quot;</span> &lt;&lt; w1</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; w2 &lt;&lt; <span class="stringliteral">&quot; returned &quot;</span> &lt;&lt; xingPoint</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;, while should have reported no intersection at all&quot;</span>;</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;          ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;        } <span class="comment">// if intersect</span></div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;        <span class="comment">// prerequisites of WiresIntersect() are not met here, no test possible</span></div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;      } <span class="comment">// for all planes</span></div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;      <span class="comment">// sample the area covered by all planes, split into SplitW and SplitD</span></div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;      <span class="comment">// rectangles; drift coordinate is chosen roughly in the middle of the TPC</span></div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;      <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a> <span class="keyword">const</span>&amp; refPlane = <a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>.SmallestPlane();</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;      constexpr <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> SplitW = 19, SplitD = 17;</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span> driftOffset = -<a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>.DriftDistance() / 2.0 * <a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>.DriftDir();</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span> refPoint = refPlane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a18b8035717a1111dc0bb899910c0aac0">GetCenter</a>() + driftOffset;</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;      decltype(<span class="keyword">auto</span>) coverage = refPlane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a9e377d1748a3be9d63a4565b9192192e">ActiveArea</a>();</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> stepW = coverage.<a class="code" href="../../d7/de4/structlar_1_1util_1_1simple__geo_1_1Rectangle.html#a3b3e87af84052f0d3c6bd7c2a4ea12bf">width</a>.<a class="code" href="../../d1/df7/structlar_1_1util_1_1simple__geo_1_1Range.html#a496c1aa1afb42b516a1f615f8f931a22">length</a>() / SplitW;</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> stepD = coverage.depth.length() / SplitD;</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">int</span> stepsW = SplitW / 2;</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">int</span> stepsD = SplitD / 2;</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;      <span class="comment">// let&#39;s pick a point:</span></div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iW = -stepsW; iW &lt;= +stepsW; ++iW) {</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;        <span class="keyword">auto</span> <span class="keyword">const</span> widthOffset = (iW * stepW) * refPlane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a07e3bb39c18911d0f71e45f1c0c0fe0f">WidthDir</a>();</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iD = -stepsD; iD &lt; +stepsD; ++iD) {</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span> depthOffset = (iD * stepD) * refPlane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a6751f12e587b8d5c75edb63d751d10d6">DepthDir</a>();</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span> point = refPoint + widthOffset + depthOffset;</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;          <span class="comment">// finally, let&#39;s test this point...</span></div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;          nErrors += testWireIntersectionAt(<a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>, point);</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;        } <span class="comment">// for y</span></div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;      } <span class="comment">// for z</span></div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;    } <span class="comment">// for TPC</span></div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;    <span class="keywordflow">if</span> (nErrors &gt; 0) {</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;GeoTestWireIntersection&quot;</span>)</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Accumulated &quot;</span> &lt;&lt; nErrors &lt;&lt; <span class="stringliteral">&quot; errors (see messages above)\n&quot;</span>;</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;    }</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;  } <span class="comment">// GeometryTestAlg::testWireIntersection()</span></div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> GeometryTestAlg::testWireIntersectionAt</div>
<div class="line"><a name="l02536"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#ad4f7b953bf229c51a55c9c8444369cb6"> 2536</a></span>&#160;    (<span class="keyword">const</span> <a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html">geo::TPCGeo</a>&amp; <a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>, TVector3 <span class="keyword">const</span>&amp; point) <span class="keyword">const</span></div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;  {</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;    <span class="comment">/* Tests WireIDsIntersect() and WiresIntersect() on the specified point on</span></div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;<span class="comment">     * the wire planes of a given TPC.</span></div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;<span class="comment">     * The test follows this strategy:</span></div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;<span class="comment">     * - find the ID of the wires closest to the point on each plane</span></div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;<span class="comment">     * - for all wire plane pairing, ask for the intersection between the wires</span></div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;<span class="comment">     * - fail if the returned point is farther than half a pitch from the</span></div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;<span class="comment">     *   original point</span></div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;<span class="comment">     * This function returns the number of accumulated failures.</span></div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;    <span class="keyword">using</span> <a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a6a834f7c51903b6d2bdfdd664f064992">geo::vect::dot</a>;</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a> = 0;</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NPlanes = TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#ab3391de99203f6a60eeeef152d3adb35">Nplanes</a>();</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;    <span class="keywordtype">bool</span> <span class="keyword">const</span> bDriftOnX = (TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a7b3c9e3d79a25a20f069007a462ee9ca">DriftDir</a>&lt;<a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a>&gt;() == <a class="code" href="../../d6/d23/namespacegeo.html#a62b751f7b8cee6917a9f3f83566adc0a">geo::Xaxis</a>())</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;      || (TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a7b3c9e3d79a25a20f069007a462ee9ca">DriftDir</a>&lt;<a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a>&gt;() == -<a class="code" href="../../d6/d23/namespacegeo.html#a62b751f7b8cee6917a9f3f83566adc0a">geo::Xaxis</a>());</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;    <span class="comment">// collect information per plane:</span></div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;    std::vector&lt;double&gt; WirePitch(NPlanes); <span class="comment">// for convenience</span></div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;    <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a></div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;      &lt;decltype(std::declval&lt;geo::PlaneGeo&gt;().GetIncreasingWireDirection())&gt;</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;      WireCoordDirs(NPlanes);</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;    std::vector&lt;geo::WireID&gt; WireIDs; <span class="comment">// ID of the closest wire</span></div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;    WireIDs.reserve(NPlanes);</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;    std::vector&lt;double&gt; WireDistances(NPlanes); <span class="comment">// distance from the closest wire</span></div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iPlane = 0; iPlane &lt; NPlanes; ++iPlane) {</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a>&amp; plane = TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a411eea9dd765636914a618ded267558c">Plane</a>(iPlane);</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;      WireCoordDirs[iPlane] = plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#aa136661c166fee6b9f9888423ac2824d">GetIncreasingWireDirection</a>();</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;      WirePitch[iPlane] = plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#abbb4a8a4b112ec8e24cc970a40e8b592">WirePitch</a>();</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> WireDistance = geom-&gt;WireCoordinate(point, plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a9c059f407b135ec46f78688545f9d095">ID</a>());</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;      WireIDs.emplace_back(plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a9c059f407b135ec46f78688545f9d095">ID</a>(), (<span class="keywordtype">unsigned</span> int) std::round(WireDistance));</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;      WireDistances[iPlane]</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;        = (WireDistance - std::round(WireDistance)) * WirePitch[iPlane];</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;      MF_LOG_DEBUG(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Nearest wire to &quot;</span> &lt;&lt; point</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;        &lt;&lt; <span class="stringliteral">&quot; on plane &quot;</span> &lt;&lt; std::string(plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a9c059f407b135ec46f78688545f9d095">ID</a>())</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;        &lt;&lt; <span class="stringliteral">&quot; (pitch: &quot;</span> &lt;&lt; WirePitch[iPlane]</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;, coord.dir.=&quot;</span> &lt;&lt; WireCoordDirs[iPlane]</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;) is &quot;</span> &lt;&lt; WireIDs[iPlane] &lt;&lt; <span class="stringliteral">&quot; (position: &quot;</span> &lt;&lt; WireDistance &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;    } <span class="comment">// for planes</span></div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;    <span class="comment">// test all the combinations</span></div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;    <a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html">lar::util::RealComparisons&lt;double&gt;</a> coordIs(1e-3);</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;    <span class="keyword">auto</span> vectorIs = <a class="code" href="../../d9/d3d/namespacelar_1_1util.html#a9c7a66b3fecfd5e9fc64e30f3c54effb">lar::util::makeVector3DComparison</a>(coordIs);</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iPlane1 = 0; iPlane1 &lt; NPlanes; ++iPlane1) {</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../de/db1/structgeo_1_1WireID.html">geo::WireID</a>&amp; w1 = WireIDs[iPlane1];</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;      <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a> <span class="keyword">const</span>&amp; plane1 = TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a411eea9dd765636914a618ded267558c">Plane</a>(w1);</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;      <a class="code" href="../../de/dce/classgeo_1_1WireGeo.html">geo::WireGeo</a> <span class="keyword">const</span>&amp; w1obj = plane1.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a52fd8fb79c65318b52d60acb58c9a0d3">Wire</a>(w1);</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iPlane2 = iPlane1 + 1; iPlane2 &lt; NPlanes; ++iPlane2) {</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../de/db1/structgeo_1_1WireID.html">geo::WireID</a>&amp; w2 = WireIDs[iPlane2];</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;        <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a> <span class="keyword">const</span>&amp; plane2 = TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a411eea9dd765636914a618ded267558c">Plane</a>(w2);</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;        <a class="code" href="../../de/dce/classgeo_1_1WireGeo.html">geo::WireGeo</a> <span class="keyword">const</span>&amp; w2obj = plane2.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a52fd8fb79c65318b52d60acb58c9a0d3">Wire</a>(w2);</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;        <a class="code" href="../../d6/d23/namespacegeo.html#a5a6f22c2aa9d0ccf6ca08bf2773a0541">geo::Point_t</a> xingPoint;</div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;        <span class="keywordflow">if</span> (!geom-&gt;WireIDsIntersect(w1, w2, xingPoint)) {</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;          MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Wires &quot;</span> &lt;&lt; w1 &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; w2</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; should intersect around &quot;</span> &lt;&lt; point &lt;&lt; <span class="stringliteral">&quot; of TPC &quot;</span> &lt;&lt; TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a1664147617bb56a9be21be741f3c96a2">ID</a>()</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;, but they seem not to intersect at all!&quot;</span>;</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;          ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;        }</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;        <a class="code" href="../../d6/d23/namespacegeo.html#a5a6f22c2aa9d0ccf6ca08bf2773a0541">geo::Point_t</a> xingPoint2 = xingPoint; <span class="comment">// matching point on plane 2</span></div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;        plane2.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#aa54c0f7dfa8911933f0757a9573c7c77">DriftPoint</a>(xingPoint2);</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;        <span class="keywordflow">if</span> (bDriftOnX) { <span class="comment">// legacy code check</span></div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;          <a class="code" href="../../da/d3d/structgeo_1_1WireIDIntersection.html">geo::WireIDIntersection</a> widIntersect;</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;          <span class="keywordflow">if</span> (!geom-&gt;WireIDsIntersect(w1, w2, widIntersect)) {</div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;            MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Legacy check: wires &quot;</span> &lt;&lt; w1 &lt;&lt; <span class="stringliteral">&quot; and &quot;</span></div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;              &lt;&lt; w2 &lt;&lt; <span class="stringliteral">&quot; should intersect around &quot;</span> &lt;&lt; point &lt;&lt; <span class="stringliteral">&quot; of TPC &quot;</span></div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;              &lt;&lt; TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a1664147617bb56a9be21be741f3c96a2">ID</a>() &lt;&lt; <span class="stringliteral">&quot;, but they seem not to intersect at all!&quot;</span>;</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;          }</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;          <span class="keywordflow">if</span> (coordIs.<a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">nonEqual</a>(widIntersect.<a class="code" href="../../da/d3d/structgeo_1_1WireIDIntersection.html#a10d38a5448d172ff4c9879e0a349fbc3">y</a>, xingPoint.Y())</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;            || coordIs.<a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">nonEqual</a>(widIntersect.<a class="code" href="../../da/d3d/structgeo_1_1WireIDIntersection.html#a99e74ffcbcfd46cdb9754cde0a2019a1">z</a>, xingPoint.Z()))</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;          {</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;            MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Legacy check: wires &quot;</span> &lt;&lt; w1 &lt;&lt; <span class="stringliteral">&quot; and &quot;</span></div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;              &lt;&lt; w2 &lt;&lt; <span class="stringliteral">&quot; should intersect around &quot;</span> &lt;&lt; point &lt;&lt; <span class="stringliteral">&quot; of TPC &quot;</span></div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;              &lt;&lt; TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a1664147617bb56a9be21be741f3c96a2">ID</a>() &lt;&lt; <span class="stringliteral">&quot;, but legacy code says (?, &quot;</span></div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;              &lt;&lt; widIntersect.<a class="code" href="../../da/d3d/structgeo_1_1WireIDIntersection.html#a10d38a5448d172ff4c9879e0a349fbc3">y</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; widIntersect.<a class="code" href="../../da/d3d/structgeo_1_1WireIDIntersection.html#a99e74ffcbcfd46cdb9754cde0a2019a1">z</a> &lt;&lt; <span class="stringliteral">&quot;)!&quot;</span>;</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;          }</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;        } <span class="comment">// bDriftOnX</span></div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;        <a class="code" href="../../d6/d23/namespacegeo.html#a5a6f22c2aa9d0ccf6ca08bf2773a0541">geo::Point_t</a> xingPointInv;</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;        <span class="keywordflow">if</span> (!geom-&gt;WireIDsIntersect(w2, w1, xingPointInv)) {</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;          MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Wires &quot;</span> &lt;&lt; w2 &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; w1</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; (reversed test) should intersect around &quot;</span> &lt;&lt; point</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; of TPC &quot;</span> &lt;&lt; TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a1664147617bb56a9be21be741f3c96a2">ID</a>()</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;, but they seem not to intersect at all!&quot;</span>;</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;          ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;        }</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;        <span class="keywordflow">if</span> (vectorIs.nonEqual(xingPointInv, xingPoint2)) {</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;          MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;WireIDsIntersect() gives different intersections for &quot;</span></div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;            &lt;&lt; w1 &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; w2</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; xingPoint2 &lt;&lt; <span class="stringliteral">&quot; (direct+shift) and &quot;</span> &lt;&lt; xingPointInv</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; (reversed)&quot;</span>;</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;          ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;        }</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;        <span class="comment">// the expected distance between the probe point and the</span></div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;        <span class="comment">// intersection point is geometrically determined, given the distances</span></div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;        <span class="comment">// of the probe point from the two wires and the angle between the wires</span></div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;        <span class="comment">// the formula is a mix between the Carnot theorem and sine definition;</span></div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;        <span class="comment">// the definition of the angles is tricky though, and we rely on the</span></div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;        <span class="comment">// strong vector definition enforced in the geometry to get the proper</span></div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;        <span class="comment">// &quot;cosine&quot; and corresponding sine</span></div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> d1 = WireDistances[iPlane1], d2 = WireDistances[iPlane2],</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;          cosAlpha = <a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a6a834f7c51903b6d2bdfdd664f064992">dot</a>(WireCoordDirs[iPlane1], WireCoordDirs[iPlane2]);</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> expected_d = std::sqrt(</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;          (cet::square(d1) + cet::square(d2) - 2.0 * d1 * d2 * cosAlpha) / (1 - cet::square(cosAlpha))</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;          );</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;        <span class="comment">// the actual distance we have found:</span></div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;        <span class="keywordtype">double</span> <span class="keyword">const</span> d = plane1.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a9d404b4b6c012292bd9492ca3a741d1e">VectorProjection</a>(xingPoint - <a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#aabcc53a6fd142c7cb43c9aca166a7881">geo::vect::toPoint</a>(point)).R();</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;        MF_LOG_DEBUG(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; - wires &quot;</span> &lt;&lt; w1 &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; w2 &lt;&lt; <span class="stringliteral">&quot; intersect at &quot;</span> &lt;&lt; xingPoint</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; d &lt;&lt; <span class="stringliteral">&quot; cm far from starting point (expected: &quot;</span></div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;          &lt;&lt; expected_d &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;        <span class="comment">// precision of the test is an issue; the 10^-3 x pitch threshold</span></div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;        <span class="comment">// is roughly tuned so that we don&#39;t get errors</span></div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;        <a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html">lar::util::RealComparisons&lt;double&gt;</a> wireCoordIs</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;          (<a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::max</a>(WirePitch[iPlane1], WirePitch[iPlane2]) * 1e-3); <span class="comment">// cm</span></div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;        <span class="keywordflow">if</span> (wireCoordIs.<a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">nonEqual</a>(d, expected_d)) {</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;          MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;wires &quot;</span> &lt;&lt; w1 &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; w2 &lt;&lt; <span class="stringliteral">&quot; intersect at &quot;</span> &lt;&lt; xingPoint</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;            &lt;&lt; d &lt;&lt; <span class="stringliteral">&quot; cm far from starting point: too far from the expected &quot;</span></div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;            &lt;&lt; expected_d &lt;&lt; <span class="stringliteral">&quot; cm!&quot;</span>;</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;          ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;        } <span class="comment">// if too far</span></div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;        <a class="code" href="../../d6/d23/namespacegeo.html#a5a6f22c2aa9d0ccf6ca08bf2773a0541">geo::Point_t</a> objXingPoint;</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;        </div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;        <span class="comment">// test that geo::WiresIntersection() gives the same result as</span></div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;        <span class="comment">// the already validated one from geom-&gt;WireIDsIntersect()</span></div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;        objXingPoint = <a class="code" href="../../d6/d23/namespacegeo.html#af365983f9f6d3e62c0462bd312977b92">geo::WiresIntersection</a>(w1obj, w2obj);</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;        <span class="keywordflow">if</span> (vectorIs.nonEqual(objXingPoint, xingPoint)) {</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;          MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;geo::WiresIntersection() gives wrong intersection for &quot;</span></div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;            &lt;&lt; w1 &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; w2</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; objXingPoint &lt;&lt; <span class="stringliteral">&quot; vs. &quot;</span> &lt;&lt; xingPoint &lt;&lt; <span class="stringliteral">&quot; (expected)&quot;</span>;</div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;          ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;        }</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;</div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;        <span class="comment">// test that geo::WireGeo::IntersectionWith() gives the same result as</span></div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;        <span class="comment">// the already validated one from geom-&gt;WireIDsIntersect()</span></div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;        objXingPoint = w1obj.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#abe8a2d7e13862adb76df0d12558f088e">IntersectionWith</a>(w2obj);</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;        <span class="keywordflow">if</span> (vectorIs.nonEqual(objXingPoint, xingPoint)) {</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;          MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;geo::WireGeo[&quot;</span> &lt;&lt; w1</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;]::IntersectionWith() gives wrong intersection with &quot;</span> &lt;&lt; w2</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; objXingPoint &lt;&lt; <span class="stringliteral">&quot; vs. &quot;</span> &lt;&lt; xingPoint &lt;&lt; <span class="stringliteral">&quot; (expected)&quot;</span>;</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;          ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;        }</div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;        objXingPoint = w2obj.<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#abe8a2d7e13862adb76df0d12558f088e">IntersectionWith</a>(w1obj);</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;        <span class="keywordflow">if</span> (vectorIs.nonEqual(objXingPoint, xingPointInv)) {</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;          MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;geo::WireGeo[&quot;</span> &lt;&lt; w2</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;]::IntersectionWith() gives wrong intersection with &quot;</span> &lt;&lt; w1</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; objXingPoint &lt;&lt; <span class="stringliteral">&quot; vs. &quot;</span> &lt;&lt; xingPoint &lt;&lt; <span class="stringliteral">&quot; (expected)&quot;</span>;</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;          ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;        }</div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;      } <span class="comment">// for iPlane2</span></div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;    } <span class="comment">// for iPlane1</span></div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;</div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;  } <span class="comment">// GeometryTestAlg::testWireIntersectionAt()</span></div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l02729"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#adb8be7d550830701f3ef3593d3b5afe4"> 2729</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testThirdPlane()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;<span class="comment">     * This is a test for ThirdPlane() function, that returns the plane that is</span></div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;<span class="comment">     * not specified in the input.</span></div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;<span class="comment">     * Currently, the only implemented signature is designed for TPCs with 3</span></div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;<span class="comment">     * planes.</span></div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;<span class="comment">     * The test strategy is to check all the TPC one by one:</span></div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;<span class="comment">     * - for all combinations of two planes, if the result is the expected one</span></div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;<span class="comment">     * All tests are performed; at the end, the test is considered a failure</span></div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;<span class="comment">     * if any of the single tests failed.</span></div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a> = 0;</div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../d5/dc7/classgeo_1_1details_1_1TPC__id__iterator__base.html">geo::GeometryCore::TPC_id_iterator</a> iTPC(&amp;*geom); iTPC; ++iTPC) {</div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a> tpcid = *iTPC;</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html">geo::TPCGeo</a>&amp; TPC = geom-&gt;TPC(tpcid);</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nPlanes = TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#ab3391de99203f6a60eeeef152d3adb35">Nplanes</a>();</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;      MF_LOG_DEBUG(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; tpcid &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; nPlanes &lt;&lt; <span class="stringliteral">&quot; planes)&quot;</span>;</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#abf7d62dd39e4ff6c1f1046a76416448e">geo::PlaneID::PlaneID_t</a> iPlane1 = 0; iPlane1 &lt; nPlanes; ++iPlane1) {</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;        <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> pid1(tpcid, iPlane1);</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#abf7d62dd39e4ff6c1f1046a76416448e">geo::PlaneID::PlaneID_t</a> iPlane2 = 0; iPlane2 &lt; nPlanes; ++iPlane2)</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;        {</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;          <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> pid2(tpcid, iPlane2);</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">bool</span> isValidInput = (nPlanes == 3) &amp;&amp; (iPlane1 != iPlane2);</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;          <span class="keywordtype">bool</span> bError = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;          <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> third_plane;</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;          <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;            third_plane = geom-&gt;ThirdPlane(pid1, pid2);</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;          }</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;          <span class="keywordflow">catch</span> (cet::exception <span class="keyword">const</span>&amp; e) {</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;            <span class="keywordflow">if</span> (isValidInput) <span class="keywordflow">throw</span>;</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;            <span class="comment">// we have gotten the error we were looking for</span></div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;            <span class="comment">// if &quot;GeometryCore&quot; is included in the categories of the exception</span></div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;            bError = hasCategory(e, <span class="stringliteral">&quot;GeometryCore&quot;</span>);</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;          } <span class="comment">// try...catch</span></div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;          MF_LOG_TRACE(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;  [&quot;</span> &lt;&lt; pid1 &lt;&lt; <span class="stringliteral">&quot;], [&quot;</span> &lt;&lt; pid2 &lt;&lt; <span class="stringliteral">&quot;] =&gt; &quot;</span></div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;            &lt;&lt; (bError? <span class="stringliteral">&quot;error&quot;</span>: std::string(third_plane));</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;          <span class="keywordflow">if</span> (bError) <span class="keywordflow">continue</span>; <span class="comment">// we got what we wanted</span></div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;          <span class="keywordflow">if</span> (!bError &amp;&amp; !isValidInput) {</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;            MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;ThirdPlane() on &quot;</span> &lt;&lt; pid1</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; pid2 &lt;&lt; <span class="stringliteral">&quot; returned &quot;</span> &lt;&lt; third_plane</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;, while should have thrown an exception&quot;</span>;</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;          } <span class="comment">// if no error</span></div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;          <span class="keywordflow">if</span> (third_plane != tpcid) {</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;            MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;ThirdPlane() on &quot;</span> &lt;&lt; pid1</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; pid2 &lt;&lt; <span class="stringliteral">&quot; returned &quot;</span> &lt;&lt; third_plane</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;, on a different TPC!!!&quot;</span>;</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;          }</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!third_plane.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a9384db80f2ab08f013fc630316d7bd05">isValid</a>) {</div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;            MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;ThirdPlane() on &quot;</span> &lt;&lt; pid1</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; pid2 &lt;&lt; <span class="stringliteral">&quot; returned an invalid &quot;</span> &lt;&lt; third_plane;</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;          }</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (third_plane.<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a> &gt;= nPlanes) {</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;            MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;ThirdPlane() on &quot;</span> &lt;&lt; pid1</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; pid2 &lt;&lt; <span class="stringliteral">&quot; returned &quot;</span> &lt;&lt; third_plane</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; with plane out of range&quot;</span>;</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;          }</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (third_plane == pid1) {</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;            MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;ThirdPlane() on &quot;</span> &lt;&lt; pid1</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; pid2 &lt;&lt; <span class="stringliteral">&quot; returned &quot;</span> &lt;&lt; third_plane</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;, same as the first input&quot;</span>;</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;          }</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (third_plane == pid2) {</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;            MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;ThirdPlane() on &quot;</span> &lt;&lt; pid1</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; pid2 &lt;&lt; <span class="stringliteral">&quot; returned &quot;</span> &lt;&lt; third_plane</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;, same as the second input&quot;</span>;</div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;          }</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;        } <span class="comment">// for plane 2</span></div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;      } <span class="comment">// for plane 1</span></div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;    } <span class="comment">// for TPC</span></div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;    <span class="keywordflow">if</span> (nErrors &gt; 0) {</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;GeoTestThirdPlane&quot;</span>)</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Accumulated &quot;</span> &lt;&lt; nErrors &lt;&lt; <span class="stringliteral">&quot; errors (see messages above)\n&quot;</span>;</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;    }</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;</div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;  } <span class="comment">// GeometryTestAlg::testThirdPlane()</span></div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l02830"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a93a5d245db01254dbd8d0037d0d3430a"> 2830</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testThirdPlane_dTdW()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;<span class="comment">     * This is a test for ThirdPlane_dTdW() function, that returns the apparent</span></div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;<span class="comment">     * slope on a wire plane, given the ones observed on other two planes.</span></div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;<span class="comment">     * The test strategy is to check all the TPC one by one:</span></div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;<span class="comment">     * - if a query for planes on different cryostats fails</span></div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;<span class="comment">     * - if a query for planes on different TPCs fails</span></div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;<span class="comment">     * - for selected 3D points, compute the three dT/dW and verify them by</span></div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;<span class="comment">     *   test these slopes by testThirdPlane__dTdW_at() function (see)</span></div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;<span class="comment">     * All tests are performed; at the end, the test is considered a failure</span></div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;<span class="comment">     * if any of the single tests failed.</span></div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a> = 0;</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../d5/dc7/classgeo_1_1details_1_1TPC__id__iterator__base.html">geo::GeometryCore::TPC_id_iterator</a> iTPC(&amp;*geom); iTPC; ++iTPC) {</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a> tpcid = *iTPC;</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html">geo::TPCGeo</a>&amp; TPC = geom-&gt;TPC(tpcid);</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;</div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> driftVelocity = 0.1</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;        * ((TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a37b4d0a99be8c2324273589fda87b851">DriftDirection</a>() == <a class="code" href="../../d6/d23/namespacegeo.html#a1b5150a78645f276a21647cc0b48fb69ab6ea94727ba423afbde5dbd7e9306bdf">geo::kNegX</a>)? -1.: +1);</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NPlanes = TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#ab3391de99203f6a60eeeef152d3adb35">Nplanes</a>();</div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;      MF_LOG_DEBUG(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; tpcid &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; NPlanes &lt;&lt; <span class="stringliteral">&quot; planes)&quot;</span>;</div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;</div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;      <span class="comment">// sanity: planes on different cryostats</span></div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;      <span class="keywordflow">if</span> (tpcid.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a> &lt; geom-&gt;Ncryostats() - 1) {</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;        <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> <a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a> { tpcid, 0 }, p2 { tpcid.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a> + 1, tpcid.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>, 1 };</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;        <span class="keywordtype">bool</span> bError = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;        <span class="keywordtype">double</span> slope;</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;        <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;          slope = geom-&gt;ThirdPlane_dTdW(<a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a>, +1.0, p2, -1.0);</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;        }</div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;        <span class="keywordflow">catch</span> (cet::exception <span class="keyword">const</span>&amp; e) {</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;          <span class="comment">// we have gotten the error we were looking for</span></div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;          <span class="comment">// if &quot;GeometryCore&quot; is included in the categories of the exception</span></div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;          bError = hasCategory(e, <span class="stringliteral">&quot;GeometryCore&quot;</span>);</div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;        } <span class="comment">// try...catch</span></div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;        <span class="keywordflow">if</span> (!bError) {</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;          MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;ThirdPlane_dTdW() on &quot;</span> &lt;&lt; <a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a></div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; p2 &lt;&lt; <span class="stringliteral">&quot; returned &quot;</span> &lt;&lt; slope</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;, while should have thrown an exception&quot;</span>;</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;          ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;        } <span class="comment">// if no error</span></div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;      } <span class="comment">// if not the last cryostat</span></div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;      <span class="comment">// sanity: planes on different TPC</span></div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;      <span class="keywordflow">if</span> (tpcid.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a> &lt; geom-&gt;NTPC(tpcid.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>) - 1) {</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;        <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> <a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a> { tpcid, 0 }, p2 { tpcid.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>, tpcid.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a> + 1, 1 };</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;        <span class="keywordtype">bool</span> bError = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;        <span class="keywordtype">double</span> slope;</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;        <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;          slope = geom-&gt;ThirdPlane_dTdW(<a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a>, +1.0, p2, -1.0);</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;        }</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;        <span class="keywordflow">catch</span> (cet::exception <span class="keyword">const</span>&amp; e) {</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;          <span class="comment">// we have gotten the error we were looking for</span></div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;          <span class="comment">// if &quot;GeometryCore&quot; is included in the categories of the exception</span></div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;          bError = hasCategory(e, <span class="stringliteral">&quot;GeometryCore&quot;</span>);</div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;        } <span class="comment">// try...catch</span></div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;        <span class="keywordflow">if</span> (!bError) {</div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;          MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;ThirdPlane_dTdW() on &quot;</span> &lt;&lt; <a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a></div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; p2 &lt;&lt; <span class="stringliteral">&quot; returned &quot;</span> &lt;&lt; slope</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;, while should have thrown an exception&quot;</span>;</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;          ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;        } <span class="comment">// if no error</span></div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;      } <span class="comment">// if not the last TPC in its cryostat</span></div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;      <span class="comment">// pick a point in the very middle of the TPC:</span></div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;      <span class="comment">// BUG the double brace syntax is required to work around clang bug 21629</span></div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;      <span class="comment">// (https://bugs.llvm.org/show_bug.cgi?id=21629)</span></div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;      <span class="keyword">const</span> std::array&lt;double, 3&gt; <a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#a62b15446ae03a5857d5e03fa30b03fd4">A</a></div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;        = {{ TPC.<a class="code" href="../../db/d54/classgeo_1_1BoxBoundedGeo.html#a8bbea288bcdf9c746e70ee8de8c489a6">CenterX</a>(), TPC.<a class="code" href="../../db/d54/classgeo_1_1BoxBoundedGeo.html#aafb8d64fc1f79ef0d7418b3fbebf7394">CenterY</a>(), TPC.<a class="code" href="../../db/d54/classgeo_1_1BoxBoundedGeo.html#a008c12369d6de1031dba1dbb92714af7">CenterZ</a>() }};</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;      <span class="comment">// pick a radius half the way to the closest border</span></div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> radius</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;        = std::min({ TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a7ced3f8c920172d2b77f3d010cec6c1f">HalfWidth</a>(), TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a3a222b9dc08e40022cba2a0fcd194f30">HalfHeight</a>(), TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a0e39141f154428669f715c957d3c5a5e">Length</a>()/2. }) / 2.;</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;      <span class="comment">// I arbitrary decide that the second point will have dX equal size as</span></div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;      <span class="comment">// the radius, and on the positive x direction (may be negative dT)</span></div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> dX = radius;</div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> dT = driftVelocity * dX;</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;      <span class="comment">// sample a circle of SplitAngles directions around A</span></div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;      constexpr <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NAngles = 19;</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> start_angle = 0.05; <span class="comment">// radians</span></div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> step_angle = 2. * util::pi&lt;double&gt;() / NAngles; <span class="comment">// radians</span></div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iAngle = 0; iAngle &lt; NAngles; ++iAngle) {</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../d2/dbd/trackfinderalgorithms_8fcl.html#abfae2e504dfa44c403614b6cd601f99e">angle</a> = start_angle + iAngle * step_angle;</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;        <span class="comment">// define B as a point &quot;radius&quot; far from A in the angle direction,</span></div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;        <span class="comment">// with some arbitrary and fixed dx offset</span></div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;        <span class="comment">// BUG the double brace syntax is required to work around clang bug 21629</span></div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;        <span class="comment">// (https://bugs.llvm.org/show_bug.cgi?id=21629)</span></div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;        std::array&lt;double, 3&gt; B = {{</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;          A[0] + dX,</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;          A[1] + radius * std::sin(angle),</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;          A[2] + radius * std::cos(angle)</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;          }};</div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;        <span class="comment">// get the expectation; this function assumes a drift velocity of</span></div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;        <span class="comment">// 1 mm per tick by default; for the test, it does not matter</span></div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;        std::vector&lt;std::pair&lt;geo::PlaneID, double&gt;&gt; dTdWs</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;          = ExpectedPlane_dTdW(A, B, driftVelocity);</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;        <span class="keywordflow">if</span> (mf::isDebugEnabled()) {</div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;          mf::LogTrace log(<span class="stringliteral">&quot;GeometryTest&quot;</span>);</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;          log &lt;&lt; <span class="stringliteral">&quot;Expected dT/dW for a segment with &quot;</span> &lt;&lt; radius</div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; cm long projection at &quot;</span></div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;            &lt;&lt; angle &lt;&lt; <span class="stringliteral">&quot; rad, and dT &quot;</span> &lt;&lt; dT &lt;&lt; <span class="stringliteral">&quot; cm:&quot;</span>;</div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;          <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; dTdW_info: dTdWs)</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;            log &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; dTdW_info.first &lt;&lt; <span class="stringliteral">&quot; slope:&quot;</span> &lt;&lt; dTdW_info.second;</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;        } <span class="comment">// if debug</span></div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;        <span class="comment">// run the test</span></div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;        nErrors += testThirdPlane_dTdW_at(dTdWs);</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;      } <span class="comment">// for angle</span></div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;    } <span class="comment">// for TPC</span></div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;    <span class="keywordflow">if</span> (nErrors &gt; 0) {</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;GeoTestThirdPlane_dTdW&quot;</span>)</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Accumulated &quot;</span> &lt;&lt; nErrors &lt;&lt; <span class="stringliteral">&quot; errors (see messages above)\n&quot;</span>;</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;    }</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;  } <span class="comment">// GeometryTestAlg::testThirdPlane_dTdW()</span></div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;</div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;  std::vector&lt;std::pair&lt;geo::PlaneID, double&gt;&gt;</div>
<div class="line"><a name="l02961"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a07b48377bf850c5fd1c7b413ab4f9ee2"> 2961</a></span>&#160;  GeometryTestAlg::ExpectedPlane_dTdW(</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;    std::array&lt;double, 3&gt; <span class="keyword">const</span>&amp; <a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#a62b15446ae03a5857d5e03fa30b03fd4">A</a>, std::array&lt;double, 3&gt; <span class="keyword">const</span>&amp; B,</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> driftVelocity <span class="comment">/* = 0.1 */</span></div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;    )<span class="keyword"> const</span></div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;<span class="keyword">  </span>{</div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;    <span class="comment">// This function returns a list of entries, one for each plane:</span></div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;    <span class="comment">// - plane ID</span></div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;    <span class="comment">// - slope of the projection of AB from the plane, in dt/dw units</span></div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;    <span class="comment">// find which TPC we are taking about</span></div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;    <a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a> tpcid = geom-&gt;FindTPCAtPosition(A.data());</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;</div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;    <span class="keywordflow">if</span> (!tpcid.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a9384db80f2ab08f013fc630316d7bd05">isValid</a>) {</div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;ExpectedPlane_dTdW(): can&#39;t find any TPC containing point A (&quot;</span></div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;        &lt;&lt; A[0] &lt;&lt; <span class="stringliteral">&quot;; &quot;</span> &lt;&lt; A[1] &lt;&lt; <span class="stringliteral">&quot;; &quot;</span> &lt;&lt; A[2] &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;    }</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;    <span class="keywordflow">if</span> (geom-&gt;FindTPCAtPosition(B.data()) != tpcid) {</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;ExpectedPlane_dTdW(): point A (&quot;</span></div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;        &lt;&lt; A[0] &lt;&lt; <span class="stringliteral">&quot;; &quot;</span> &lt;&lt; A[1] &lt;&lt; <span class="stringliteral">&quot;; &quot;</span> &lt;&lt; A[2] &lt;&lt; <span class="stringliteral">&quot;) is in &quot;</span></div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;        &lt;&lt; std::string(tpcid)</div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;        &lt;&lt; <span class="stringliteral">&quot; while point B (&quot;</span> &lt;&lt; B[0] &lt;&lt; <span class="stringliteral">&quot;; &quot;</span> &lt;&lt; B[1] &lt;&lt; <span class="stringliteral">&quot;; &quot;</span> &lt;&lt; B[2]</div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;) is in &quot;</span> &lt;&lt; std::string(geom-&gt;FindTPCAtPosition(B.data()));</div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;    }</div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;</div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;    <a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html">geo::TPCGeo</a> <span class="keyword">const</span>&amp; TPC = geom-&gt;TPC(tpcid);</div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;    <span class="comment">// conversion from X coordinate to tick coordinate</span></div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;    <span class="keywordtype">double</span> dT_over_dX = 1. / driftVelocity;</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;    <span class="keywordflow">switch</span> (TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a37b4d0a99be8c2324273589fda87b851">DriftDirection</a>()) {</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d6/d23/namespacegeo.html#a1b5150a78645f276a21647cc0b48fb69a540355ba5bfe18985f585e362f847483">geo::kPosX</a>:</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;        <span class="comment">// if the drift direction is toward positive x, higher x will reach the</span></div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;        <span class="comment">// plane earlier and have smaller t, hence the flip in sign</span></div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;        dT_over_dX = -dT_over_dX;</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d6/d23/namespacegeo.html#a1b5150a78645f276a21647cc0b48fb69ab6ea94727ba423afbde5dbd7e9306bdf">geo::kNegX</a>: <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;      <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;        <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;InternalError&quot;</span>)</div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;GeometryTestAlg::ExpectedPlane_dTdW(): drift direction #&quot;</span></div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;          &lt;&lt; ((int) TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a37b4d0a99be8c2324273589fda87b851">DriftDirection</a>()) &lt;&lt; <span class="stringliteral">&quot; of &quot;</span> &lt;&lt; std::string(tpcid)</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; not supported.\n&quot;</span>;</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;    } <span class="comment">// switch drift direction</span></div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nPlanes = TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#ab3391de99203f6a60eeeef152d3adb35">Nplanes</a>();</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;    std::vector&lt;std::pair&lt;geo::PlaneID, double&gt;&gt; slopes(nPlanes);</div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#abf7d62dd39e4ff6c1f1046a76416448e">geo::PlaneID::PlaneID_t</a> iPlane = 0; iPlane &lt; nPlanes; ++iPlane) {</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;      <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> pid(tpcid, iPlane);</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;<span class="comment">//       const double wA = geom-&gt;WireCoordinate(A[1], A[2], pid);</span></div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;<span class="comment">//       const double wB = geom-&gt;WireCoordinate(B[1], B[2], pid);</span></div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> wA</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;        = geom-&gt;WireCoordinate(geo::vect::makeFromCoords&lt;geo::Point_t&gt;(A), pid);</div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> wB</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;        = geom-&gt;WireCoordinate(geo::vect::makeFromCoords&lt;geo::Point_t&gt;(B), pid);</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;</div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;      slopes[iPlane]</div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;        = std::make_pair(pid, ((B[0] - A[0]) * dT_over_dX) / (wB - wA));</div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;    } <span class="comment">// for iPlane</span></div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;</div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;    <span class="keywordflow">return</span> slopes;</div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;  }  <span class="comment">// GeometryTestAlg::ExpectedPlane_dTdW()</span></div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;</div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;</div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> GeometryTestAlg::testThirdPlane_dTdW_at</div>
<div class="line"><a name="l03028"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#adf6ea56cc7d15c092e8d9ddf578e323f"> 3028</a></span>&#160;    (<a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;std::pair&lt;geo::PlaneID, double&gt;&gt; <span class="keyword">const</span>&amp; plane_dTdW) <span class="keyword">const</span></div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;  {</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;<span class="comment">     * This function tests that for every combination of planes, the expected</span></div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;<span class="comment">     * slope is returned within some tolerance.</span></div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;<span class="comment">     * It returns the number of mistakes found.</span></div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;<span class="comment">     * The parameter is a list if pair of expected slope on the paired plane.</span></div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;</div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a> = 0;</div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;    <span class="keywordflow">for</span> (std::pair&lt;geo::PlaneID, double&gt; <span class="keyword">const</span>&amp; input1: plane_dTdW) {</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;      <span class="keywordflow">for</span> (std::pair&lt;geo::PlaneID, double&gt; <span class="keyword">const</span>&amp; input2: plane_dTdW) {</div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> bValidInput = input1.first != input2.first;</div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;</div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;        <span class="keywordflow">for</span> (std::pair&lt;geo::PlaneID, double&gt; <span class="keyword">const</span>&amp; <a class="code" href="../../dd/db4/triggersim__eastmodule__icarus_8fcl.html#a6e6fc5a1833d744f7bd6bde59dd95323">output</a>: plane_dTdW) {</div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;          <span class="keywordtype">bool</span> bError = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;          <span class="keywordtype">double</span> output_slope = 0.;</div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;          <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;            output_slope = geom-&gt;ThirdPlane_dTdW(</div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;              input1.first, input1.second,</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;              input2.first, input2.second,</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;              <a class="code" href="../../dd/db4/triggersim__eastmodule__icarus_8fcl.html#a6e6fc5a1833d744f7bd6bde59dd95323">output</a>.first</div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;              );</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;          }</div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;          <span class="keywordflow">catch</span> (cet::exception <span class="keyword">const</span>&amp; e) {</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;            <span class="comment">// catch only &quot;GeometryCore&quot; category, and only if input is faulty;</span></div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;            <span class="comment">// otherwise, rethrow</span></div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;            <span class="keywordflow">if</span> (bValidInput) <span class="keywordflow">throw</span>;</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;            bError = hasCategory(e, <span class="stringliteral">&quot;GeometryCore&quot;</span>);</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;            <span class="keywordflow">if</span> (!bError) <span class="keywordflow">throw</span>;</div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;            MF_LOG_TRACE(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;              &lt;&lt; input1.first &lt;&lt; <span class="stringliteral">&quot; slope:&quot;</span> &lt;&lt; input1.second</div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; input2.first &lt;&lt; <span class="stringliteral">&quot; slope:&quot;</span> &lt;&lt; input2.second</div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;  =&gt; exception&quot;</span>;</div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;          }</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;          <span class="keywordflow">if</span> (!bValidInput &amp;&amp; !bError) {</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;            MF_LOG_ERROR(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;GeometryCore::ThirdPlane_dTdW() on &quot;</span></div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;              &lt;&lt; input1.first &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; input2.first</div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; should have thrown an exception, it returned &quot;</span></div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;              &lt;&lt; output_slope &lt;&lt; <span class="stringliteral">&quot; instead&quot;</span>;</div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;          } <span class="comment">// if faulty input and no error</span></div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;</div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;          MF_LOG_TRACE(<span class="stringliteral">&quot;GeometryTest&quot;</span>)</div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;            &lt;&lt; input1.first &lt;&lt; <span class="stringliteral">&quot; slope:&quot;</span> &lt;&lt; input1.second</div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; input2.first &lt;&lt; <span class="stringliteral">&quot; slope:&quot;</span> &lt;&lt; input2.second</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;  =&gt; &quot;</span> &lt;&lt; <a class="code" href="../../dd/db4/triggersim__eastmodule__icarus_8fcl.html#a6e6fc5a1833d744f7bd6bde59dd95323">output</a>.first &lt;&lt; <span class="stringliteral">&quot; slope:&quot;</span> &lt;&lt; output_slope;</div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;          <span class="keywordflow">if</span> (((<a class="code" href="../../dd/db4/triggersim__eastmodule__icarus_8fcl.html#a6e6fc5a1833d744f7bd6bde59dd95323">output</a>.second == 0.) &amp;&amp; (output_slope &gt; 1e-3))</div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;            || <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(output_slope/<a class="code" href="../../dd/db4/triggersim__eastmodule__icarus_8fcl.html#a6e6fc5a1833d744f7bd6bde59dd95323">output</a>.second - 1.) &gt; 1e-3)</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;          {</div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;            MF_LOG_ERROR(<span class="stringliteral">&quot;testThirdPlane_dTdW_at&quot;</span>)</div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;GeometryCore::ThirdPlane_dTdW(): &quot;</span></div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;              &lt;&lt; input1.first &lt;&lt; <span class="stringliteral">&quot; slope:&quot;</span> &lt;&lt; input1.second</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; input2.first &lt;&lt; <span class="stringliteral">&quot; slope:&quot;</span> &lt;&lt; input2.second</div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;  =&gt; &quot;</span> &lt;&lt; <a class="code" href="../../dd/db4/triggersim__eastmodule__icarus_8fcl.html#a6e6fc5a1833d744f7bd6bde59dd95323">output</a>.first &lt;&lt; <span class="stringliteral">&quot; slope:&quot;</span> &lt;&lt; output_slope</div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;  (expected: &quot;</span> &lt;&lt; <a class="code" href="../../dd/db4/triggersim__eastmodule__icarus_8fcl.html#a6e6fc5a1833d744f7bd6bde59dd95323">output</a>.second &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;          } <span class="comment">// if too far</span></div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;</div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;          <span class="comment">// now test the automatic detection of the other plane</span></div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;</div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;        } <span class="comment">// for output</span></div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;      } <span class="comment">// for second input</span></div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;    } <span class="comment">// for first input</span></div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;  }  <span class="comment">// GeometryTestAlg::testThirdPlane_dTdW_at()</span></div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;</div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l03103"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a80f4e2c762aeaddec4c82abac7a3f729"> 3103</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testWirePitch()</div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;  {</div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;    <span class="comment">// loop over all planes and wires to be sure the pitch is consistent</span></div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nPitchErrors = 0;</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;    <span class="keywordflow">if</span> (fExpectedWirePitches.empty()) {</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;      <span class="comment">// hard code the value we think it should be for each detector;</span></div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;      <span class="comment">// this is legacy and you should not add anything:</span></div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;      <span class="comment">// add the expectation to the FHiCL configuration of the test instead</span></div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;      <span class="keywordflow">if</span>(geom-&gt;DetectorName() == <span class="stringliteral">&quot;bo&quot;</span>) {</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;        fExpectedWirePitches = { 0.46977, 0.46977, 0.46977 };</div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;      }</div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;      <span class="keywordflow">if</span> (!fExpectedWirePitches.empty()) {</div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;        mf::LogInfo(<span class="stringliteral">&quot;WirePitch&quot;</span>)</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Using legacy wire pitch parameters hard-coded for the detector &#39;&quot;</span></div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;          &lt;&lt; geom-&gt;DetectorName() &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>;</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;      }</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;    }</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;    <span class="keywordflow">if</span> (fExpectedWirePitches.empty()) {</div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;      mf::LogWarning(<span class="stringliteral">&quot;WirePitch&quot;</span>)</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;no expected wire pitch; I&#39;ll just check that they are all the same&quot;</span>;</div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;    }</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;      mf::LogInfo log(<span class="stringliteral">&quot;WirePitch&quot;</span>);</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;      log &lt;&lt; <span class="stringliteral">&quot;Expected wire pitch per plane, in centimetres:&quot;</span>;</div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">double</span> pitch: fExpectedWirePitches) log &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; pitch;</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;      log &lt;&lt; <span class="stringliteral">&quot; [...]&quot;</span>;</div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;    }</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> <span class="keyword">const</span>&amp; planeid: geom-&gt;IteratePlaneIDs()) {</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;      <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a> <span class="keyword">const</span>&amp; plane = geom-&gt;Plane(planeid);</div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nWires = plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a0aeb7d438b1337c138277335a4e666a1">Nwires</a>();</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;      <span class="keywordflow">if</span> (nWires &lt; 2) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;      <a class="code" href="../../de/dce/classgeo_1_1WireGeo.html">geo::WireGeo</a> <span class="keyword">const</span>* pWire = &amp;(plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a52fd8fb79c65318b52d60acb58c9a0d3">Wire</a>(0));</div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;</div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;      <span class="comment">// which pitch to expect:</span></div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;      <span class="comment">// - if they did not tell us anything:</span></div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;      <span class="comment">//     get the one from the first two wires</span></div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;      <span class="comment">// - if they did tell something, but not for this plane:</span></div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;      <span class="comment">//     get the last pitch they told us</span></div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;      <span class="comment">// - if they told us about this plane: well, then use it!</span></div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;      <span class="keywordtype">double</span> expectedPitch = 0.;</div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;      <span class="keywordflow">if</span> (fExpectedWirePitches.empty()) {</div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;        <a class="code" href="../../de/dce/classgeo_1_1WireGeo.html">geo::WireGeo</a> <span class="keyword">const</span>&amp; wire1 = plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a52fd8fb79c65318b52d60acb58c9a0d3">Wire</a>(1); <span class="comment">// pWire now points to wire0</span></div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;        expectedPitch = <a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#a38b8593bbb47f94a5c51a1ffe8e6ceb7">geo::WireGeo::WirePitch</a>(*pWire, wire1);</div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;        MF_LOG_DEBUG(<span class="stringliteral">&quot;WirePitch&quot;</span>)</div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Wire pitch on &quot;</span> &lt;&lt; planeid &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; expectedPitch &lt;&lt; <span class="stringliteral">&quot; cm&quot;</span>;</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;      }</div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (planeid.Plane &lt; fExpectedWirePitches.size())</div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;        expectedPitch = fExpectedWirePitches[planeid.Plane];</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;        expectedPitch = fExpectedWirePitches.back();</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;</div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;      <a class="code" href="../../de/db1/structgeo_1_1WireID.html#a51daaae3404ddba50f4585a9820e751f">geo::WireID::WireID_t</a> <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">w</a> = 0; <span class="comment">// wire number</span></div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;      <span class="keywordflow">while</span> (++w &lt; nWires) {</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;        <a class="code" href="../../de/dce/classgeo_1_1WireGeo.html">geo::WireGeo</a> <span class="keyword">const</span>* pPrevWire = pWire;</div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;        pWire = &amp;(plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a52fd8fb79c65318b52d60acb58c9a0d3">Wire</a>(w));</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;</div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> thisPitch = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(pWire-&gt;<a class="code" href="../../de/dce/classgeo_1_1WireGeo.html#a68c1273caa6c5551923e9f77cc9dd746">DistanceFrom</a>(*pPrevWire));</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(thisPitch - expectedPitch) &gt; 1e-5) {</div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;          mf::LogProblem(<span class="stringliteral">&quot;WirePitch&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;ERROR: on plane &quot;</span> &lt;&lt; planeid</div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; pitch between wires W:&quot;</span> &lt;&lt; (w-1) &lt;&lt; <span class="stringliteral">&quot; and W:&quot;</span> &lt;&lt; w</div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; is &quot;</span> &lt;&lt; thisPitch &lt;&lt; <span class="stringliteral">&quot; cm, not &quot;</span> &lt;&lt; expectedPitch</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; as expected!&quot;</span>;</div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;          ++nPitchErrors;</div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;        } <span class="comment">// if unexpected pitch</span></div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;      } <span class="comment">// while</span></div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;</div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;    } <span class="comment">// for</span></div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;    <span class="keywordflow">if</span> (nPitchErrors &gt; 0) {</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;UnexpectedWirePitch&quot;</span>)</div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;unexpected pitches between &quot;</span> &lt;&lt; nPitchErrors &lt;&lt; <span class="stringliteral">&quot; wires!&quot;</span>;</div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;    } <span class="comment">// end loop over planes</span></div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;  } <span class="comment">// GeometryTestAlg::testWirePitch()</span></div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;</div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l03183"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a2d6ce06b02b0c7e2f20395365777f4ff"> 3183</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testInterWireProjectedDistance()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;</div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;<span class="comment">     * For each wire plane:</span></div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;<span class="comment">     *  * we pick some projected directions; for each one:</span></div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;<span class="comment">     *     * we manipulate it in some way that does not affect the result</span></div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;<span class="comment">     *     * check that the projected distance is as expected</span></div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;<span class="comment">     *     * add some arbitrary component on the drift direction; for each one:</span></div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;<span class="comment">     *       * check that the projected distance is as expected</span></div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;<span class="comment">     *       * check that the 3D distance is as expected</span></div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;<span class="comment">     * We do not test directions parallel to the wires because they get</span></div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;<span class="comment">     * numerically unstable and the expectation may potentially differ a lot</span></div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;<span class="comment">     * being calculated with a different procedure.</span></div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;</div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;    constexpr <a class="code" href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html">lar::util::RealComparisons</a> cmp { 1e-4 };</div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;</div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">double</span> <span class="keyword">const</span> V3 = std::sqrt(3.0);</div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;</div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;    <span class="comment">// BUG the deduction guide for std::array seems not to be implemented yet</span></div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;    <span class="comment">//     in Clang 5.0.0</span></div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;    <span class="comment">// BUG the double brace syntax is required to work around clang bug 21629</span></div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;    <span class="comment">// (https://bugs.llvm.org/show_bug.cgi?id=21629)</span></div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;<span class="comment">//     std::array const testProjections = {</span></div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;    std::array&lt;geo::PlaneGeo::WireCoordProjection_t, 5U&gt; <span class="keyword">const</span> testProjections {{</div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;      <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a54262556246be9d7cd55b501d860d9c1">geo::PlaneGeo::WireCoordProjection_t</a>{ 0.00, 1.00 },</div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;      <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a54262556246be9d7cd55b501d860d9c1">geo::PlaneGeo::WireCoordProjection_t</a>{ 0.75, 1.00 },</div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;      <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a54262556246be9d7cd55b501d860d9c1">geo::PlaneGeo::WireCoordProjection_t</a>{ 1.00, 1.00 },</div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;      <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a54262556246be9d7cd55b501d860d9c1">geo::PlaneGeo::WireCoordProjection_t</a>{   V3, 1.00 },</div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;      <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a54262556246be9d7cd55b501d860d9c1">geo::PlaneGeo::WireCoordProjection_t</a>{ 2.40, 1.00 }</div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;<span class="comment">//     };</span></div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;    }};</div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;    <span class="comment">// BUG the deduction guide for std::array seems not to be implemented yet</span></div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;    <span class="comment">//     in Clang 5.0.0</span></div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;    <span class="comment">// BUG the double brace syntax is required to work around clang bug 21629</span></div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;    <span class="comment">// (https://bugs.llvm.org/show_bug.cgi?id=21629)</span></div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;<span class="comment">//     constexpr std::array testDriftOffsets { -20.0, -10.0, 0.0, +10.0, +20.0 };</span></div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;    constexpr std::array&lt;double, 5U&gt; testDriftOffsets</div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;      {{ -20.0, -10.0, 0.0, +10.0, +20.0 }};</div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;</div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a> = 0; <span class="comment">// error count for the final report</span></div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;</div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a> <span class="keyword">const</span>&amp; plane: geom-&gt;IteratePlanes()) {</div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;</div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> pitch = plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#abbb4a8a4b112ec8e24cc970a40e8b592">WirePitch</a>();</div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span> normalDir = plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a9747db83dd7c5dc6fe68da661b04ffc8">GetNormalDirection</a>&lt;<a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a>&gt;();</div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;</div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; testProjBase: testProjections) {</div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;</div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;        <span class="comment">// expected result is kind of encoded in the chosen projections</span></div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;        <span class="keywordtype">double</span> <span class="keyword">const</span> expected = testProjBase.R() * pitch;</div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;        <span class="keywordtype">double</span> <span class="keyword">const</span> expectedSqr = cet::square(expected);</div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;</div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;        <span class="comment">// we flip the projection around: result should not change</span></div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">double</span> dirL: { -1.0, 1.0 }) <span class="keywordflow">for</span> (<span class="keywordtype">double</span> dirW: { -1.0, 1.0 }) <span class="keywordflow">for</span> (<span class="keywordtype">double</span> scale: { 0.5, 1.0, 3.0 }) {</div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;</div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;          <span class="comment">// test the projection directly</span></div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;          <a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a54262556246be9d7cd55b501d860d9c1">geo::PlaneGeo::WireCoordProjection_t</a> <span class="keyword">const</span> testProj</div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;           { scale * dirL * testProjBase.X(), scale * dirW * testProjBase.Y() };</div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;          <span class="keywordtype">double</span> <span class="keyword">const</span> interWireFromProj</div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;            = plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a6f9d364c5e6bc1180ca4b8656a866c07">InterWireProjectedDistance</a>(testProj);</div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;          <span class="keywordflow">if</span> (cmp.nonEqual(interWireFromProj, expected)) {</div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;            mf::LogProblem(<span class="stringliteral">&quot;&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;ERROR: on plane &quot;</span> &lt;&lt; plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a9c059f407b135ec46f78688545f9d095">ID</a>()</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; distance between wires on projected direction &quot;</span> &lt;&lt; testProj</div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; is &quot;</span> &lt;&lt; interWireFromProj &lt;&lt; <span class="stringliteral">&quot; cm (expected: &quot;</span></div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;              &lt;&lt; expected &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;              ;</div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;          } <span class="comment">// if unexpected result</span></div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;</div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;          <span class="comment">// this is how much we needed to expand the test direction vector</span></div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;          <span class="comment">// (happens to work for the special case expected = 0 too)</span></div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;          <span class="keywordtype">double</span> <span class="keyword">const</span> dScale = expected / testProj.R();</div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;</div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;          <span class="comment">// test a 3D direction</span></div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;</div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;          <span class="keyword">auto</span> <span class="keyword">const</span> baseDir</div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;            = plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a0aeb98121edff8b3db2151baaa2d2ca7">ComposeVector</a>&lt;<a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a>&gt;(0.0, testProj);</div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;</div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">double</span> <span class="keyword">const</span> driftOffset: testDriftOffsets) {</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;            <span class="keyword">auto</span> <span class="keyword">const</span> testDir = baseDir + driftOffset * normalDir;</div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;</div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;            <span class="keywordtype">double</span> <span class="keyword">const</span> interWire = plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a6f9d364c5e6bc1180ca4b8656a866c07">InterWireProjectedDistance</a>(testDir);</div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;            <span class="keywordflow">if</span> (cmp.nonEqual(interWire, expected)) {</div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;              mf::LogProblem(<span class="stringliteral">&quot;&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;ERROR: on plane &quot;</span> &lt;&lt; plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a9c059f407b135ec46f78688545f9d095">ID</a>()</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; projected distance between wires on direction &quot;</span> &lt;&lt; testDir</div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; (from projection &quot;</span> &lt;&lt; testProj &lt;&lt; <span class="stringliteral">&quot; and offset &quot;</span></div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;                &lt;&lt; driftOffset &lt;&lt; <span class="stringliteral">&quot;) is &quot;</span> &lt;&lt; interWire &lt;&lt; <span class="stringliteral">&quot; cm (expected: &quot;</span></div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;                &lt;&lt; expected &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;                ;</div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;              ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;            } <span class="comment">// if unexpected result</span></div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;</div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;            <span class="comment">// build the expectation adding the drift component to the projected</span></div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;            <span class="keywordtype">double</span> <span class="keyword">const</span> expected3D</div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;              = std::sqrt(expectedSqr + cet::square(driftOffset * dScale));</div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;</div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;            <span class="keywordtype">double</span> <span class="keyword">const</span> interWire3D = plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a2500e66d8a1a7aa4b40703ed049fa863">InterWireDistance</a>(testDir);</div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;            <span class="keywordflow">if</span> (cmp.nonEqual(interWire3D, expected3D)) {</div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;              mf::LogProblem(<span class="stringliteral">&quot;&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;ERROR: on plane &quot;</span> &lt;&lt; plane.<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a9c059f407b135ec46f78688545f9d095">ID</a>()</div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; distance between wires on direction &quot;</span> &lt;&lt; testDir</div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; (from projection &quot;</span> &lt;&lt; testProj &lt;&lt; <span class="stringliteral">&quot; and offset &quot;</span></div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;                &lt;&lt; driftOffset &lt;&lt; <span class="stringliteral">&quot;) is &quot;</span> &lt;&lt; interWire3D &lt;&lt; <span class="stringliteral">&quot; cm (expected: &quot;</span></div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;                &lt;&lt; expected3D &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;                ;</div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;              ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;            } <span class="comment">// if unexpected result</span></div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;</div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;</div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;</div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;          } <span class="comment">// for drifts</span></div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;</div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;        } <span class="comment">// for dirL, dirW and scale</span></div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;</div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;      } <span class="comment">// for all test projection directions</span></div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;</div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;    } <span class="comment">// for all planes</span></div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;</div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;</div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;    <span class="keywordflow">if</span> (nErrors &gt; 0U) {</div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;InterWireProjectedDistance&quot;</span>)</div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;unexpected distances in &quot;</span> &lt;&lt; nErrors &lt;&lt; <span class="stringliteral">&quot; tests!&quot;</span>;</div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;    } <span class="comment">// end loop over planes</span></div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;</div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;  } <span class="comment">// GeometryTestAlg::testInterWireProjectedDistance()</span></div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;</div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;</div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l03319"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a6c4c793af130f2d4a0bf5144b34b9ba1"> 3319</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testPlanePitch()</div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;  {</div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;    <span class="comment">// loop over all planes to be sure the pitch is consistent</span></div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;</div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/d23/namespacegeo.html#af19a06f2c5c02e369b7a622e385fddec">fExpectedPlanePitches</a>.empty()) {</div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;      <span class="comment">// hard code the value we think it should be for each detector;</span></div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;      <span class="comment">// this is legacy and you should not add anything:</span></div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;      <span class="comment">// add the expectation to the FHiCL configuration of the test instead</span></div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;      <span class="keywordflow">if</span>(geom-&gt;DetectorName() == <span class="stringliteral">&quot;bo&quot;</span>) {</div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;        <a class="code" href="../../d6/d23/namespacegeo.html#af19a06f2c5c02e369b7a622e385fddec">fExpectedPlanePitches</a> = { 0.65 };</div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;      }</div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d23/namespacegeo.html#af19a06f2c5c02e369b7a622e385fddec">fExpectedPlanePitches</a>.empty()) {</div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;        mf::LogInfo(<span class="stringliteral">&quot;PlanePitch&quot;</span>)</div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Using legacy plane pitch parameters hard-coded for the detector &#39;&quot;</span></div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;          &lt;&lt; geom-&gt;DetectorName() &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>;</div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;      }</div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;    }</div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/d23/namespacegeo.html#af19a06f2c5c02e369b7a622e385fddec">fExpectedPlanePitches</a>.empty()) {</div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;      mf::LogWarning(<span class="stringliteral">&quot;PlanePitch&quot;</span>)</div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;no expected plane pitch;&quot;</span></div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;        <span class="stringliteral">&quot; I&#39;ll just check that they are all the same&quot;</span>;</div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;    }</div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;      mf::LogInfo log(<span class="stringliteral">&quot;PlanePitch&quot;</span>);</div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;      log &lt;&lt; <span class="stringliteral">&quot;Expected plane pitch per plane pair, in centimetres:&quot;</span>;</div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">double</span> pitch: <a class="code" href="../../d6/d23/namespacegeo.html#af19a06f2c5c02e369b7a622e385fddec">fExpectedPlanePitches</a>) log &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; pitch;</div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;      log &lt;&lt; <span class="stringliteral">&quot; [...]&quot;</span>;</div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;    }</div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;</div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nPitchErrors = 0;</div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a> <span class="keyword">const</span>&amp; tpcid: geom-&gt;IterateTPCIDs()) {</div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;</div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;      <a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html">geo::TPCGeo</a> <span class="keyword">const</span>&amp; TPC = geom-&gt;TPC(tpcid);</div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nPlanes = TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#ab3391de99203f6a60eeeef152d3adb35">Nplanes</a>();</div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;      <span class="keywordflow">if</span> (nPlanes &lt; 2) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;</div>
<div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;      <span class="keywordtype">double</span> expectedPitch = 0.;</div>
<div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/d23/namespacegeo.html#af19a06f2c5c02e369b7a622e385fddec">fExpectedPlanePitches</a>.empty()) {</div>
<div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;        expectedPitch = TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a697df19a5c945ce5622c50f80e60fbce">PlanePitch</a>(0, 1);</div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;        MF_LOG_DEBUG(<span class="stringliteral">&quot;PlanePitch&quot;</span>)</div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Plane pitch between the first two planes of &quot;</span> &lt;&lt; tpcid &lt;&lt; <span class="stringliteral">&quot;: &quot;</span></div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;          &lt;&lt; expectedPitch &lt;&lt; <span class="stringliteral">&quot; cm&quot;</span>;</div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;      }</div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;</div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;      <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#abf7d62dd39e4ff6c1f1046a76416448e">geo::PlaneID::PlaneID_t</a> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> = 0; <span class="comment">// plane number</span></div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;      <span class="keywordflow">while</span> (++p &lt; nPlanes) {</div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;        <span class="comment">// which pitch to expect:</span></div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;        <span class="comment">// - if they did not tell us anything:</span></div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;        <span class="comment">//     use the one from the first two planes (already in expectedPitch)</span></div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;        <span class="comment">// - if they did tell something, but not for this plane:</span></div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;        <span class="comment">//     get the last pitch they told us</span></div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;        <span class="comment">// - if they told us about this plane: well, then use it!</span></div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d23/namespacegeo.html#af19a06f2c5c02e369b7a622e385fddec">fExpectedPlanePitches</a>.empty()) {</div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;          <span class="keywordflow">if</span> (p - 1 &lt; <a class="code" href="../../d6/d23/namespacegeo.html#af19a06f2c5c02e369b7a622e385fddec">fExpectedPlanePitches</a>.size())</div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;            expectedPitch = <a class="code" href="../../d6/d23/namespacegeo.html#af19a06f2c5c02e369b7a622e385fddec">fExpectedPlanePitches</a>[p - 1];</div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;            expectedPitch = <a class="code" href="../../d6/d23/namespacegeo.html#af19a06f2c5c02e369b7a622e385fddec">fExpectedPlanePitches</a>.back();</div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;        } <span class="comment">// if we have directions about plane pitch</span></div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;</div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> thisPitch = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a697df19a5c945ce5622c50f80e60fbce">PlanePitch</a>(p - 1, p));</div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(thisPitch - expectedPitch) &gt; 1e-5) {</div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;          mf::LogProblem(<span class="stringliteral">&quot;PlanePitch&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;ERROR: pitch of planes P:&quot;</span> &lt;&lt; (p - 1)</div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; and P: &quot;</span> &lt;&lt; p &lt;&lt; <span class="stringliteral">&quot; in &quot;</span> &lt;&lt; tpcid</div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; is &quot;</span> &lt;&lt; thisPitch &lt;&lt; <span class="stringliteral">&quot; cm, not &quot;</span> &lt;&lt; expectedPitch</div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; as expected!&quot;</span>;</div>
<div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;          ++nPitchErrors;</div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;        } <span class="comment">// if unexpected pitch</span></div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;      } <span class="comment">// while planes</span></div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;</div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;    } <span class="comment">// for TPCs</span></div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;</div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;    <span class="keywordflow">if</span> (nPitchErrors &gt; 0) {</div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;UnexpectedPlanePitch&quot;</span>)</div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;unexpected pitches between &quot;</span> &lt;&lt; nPitchErrors &lt;&lt; <span class="stringliteral">&quot; planes!&quot;</span>;</div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;    } <span class="comment">// end loop over planes</span></div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;</div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;  } <span class="comment">// GeometryTestAlg::testPlanePitch()</span></div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;</div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;</div>
<div class="line"><a name="l03399"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#aa6136193d15d4cc89effbb0f7d31b539"> 3399</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testStepping()</div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;  {</div>
<div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;    <span class="comment">// Test stepping. Example is similar to what one would do for photon</span></div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;    <span class="comment">// transport. Rattles photons around inside the scintillator</span></div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;    <span class="comment">// bouncing them off walls.</span></div>
<div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;    <span class="keywordtype">double</span> xyz[3]      = {0.};</div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;    <span class="keywordtype">double</span> xyzWire[3]  = {0.};</div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;    <span class="keywordtype">double</span> dxyz[3]     = {0.};</div>
<div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;    <span class="keywordtype">double</span> dxyzWire[3] = {0, sin(0.1), cos(0.1)};</div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;</div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;    geom-&gt;Plane(1).Wire(0).LocalToWorld(xyzWire,xyz);</div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;    geom-&gt;Plane(1).Wire(0).LocalToWorldVect(dxyzWire,dxyz);</div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;</div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;    mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\n\t&quot;</span> &lt;&lt; xyz[0]  &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; xyz[1]  &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; xyz[2] ;</div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;    mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span>   &lt;&lt; dxyz[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; dxyz[1] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; dxyz[2];</div>
<div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;</div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;    gGeoManager-&gt;InitTrack(xyz, dxyz);</div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;10; ++i) {</div>
<div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span>* pos = gGeoManager-&gt;GetCurrentPoint();</div>
<div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span>* <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> = gGeoManager-&gt;GetCurrentDirection();</div>
<div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\tnode = &quot;</span></div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;                                      &lt;&lt; gGeoManager-&gt;GetCurrentNode()-&gt;GetName()</div>
<div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;                                      &lt;&lt; <span class="stringliteral">&quot;\n\t\tpos=&quot;</span> &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span></div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;                                      &lt;&lt; pos[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span></div>
<div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;                                      &lt;&lt; pos[1] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span></div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;                                      &lt;&lt; pos[2]</div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;                                      &lt;&lt; <span class="stringliteral">&quot;\n\t\tdir=&quot;</span> &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span></div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;                                      &lt;&lt; dir[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span></div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;                                      &lt;&lt; dir[1] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span></div>
<div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;                                      &lt;&lt; dir[2]</div>
<div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;                                      &lt;&lt; <span class="stringliteral">&quot;\n\t\tmat = &quot;</span></div>
<div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;                                      &lt;&lt; gGeoManager-&gt;GetCurrentNode()-&gt;GetVolume()-&gt;GetMaterial()-&gt;GetName();</div>
<div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;</div>
<div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;      gGeoManager-&gt;FindNextBoundary();</div>
<div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;      gGeoManager-&gt;FindNormal();</div>
<div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;      gGeoManager-&gt;Step(kTRUE,kTRUE);</div>
<div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;    }</div>
<div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;</div>
<div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;    xyz[0] = 306.108; xyz[1] = -7.23775; xyz[2] = 856.757;</div>
<div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;    gGeoManager-&gt;InitTrack(xyz, dxyz);</div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;    mf::LogVerbatim(<span class="stringliteral">&quot;GeometryTest&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\tnode = &quot;</span></div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;                                    &lt;&lt; gGeoManager-&gt;GetCurrentNode()-&gt;GetName()</div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;                                    &lt;&lt; <span class="stringliteral">&quot;\n\tmat = &quot;</span></div>
<div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;                                    &lt;&lt; gGeoManager-&gt;GetCurrentNode()-&gt;GetVolume()-&gt;GetMaterial()-&gt;GetName();</div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;</div>
<div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;    gGeoManager-&gt;GetCurrentNode()-&gt;GetVolume()-&gt;GetMaterial()-&gt;Print();</div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;</div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;  }</div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;</div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;</div>
<div class="line"><a name="l03452"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a2976e250cdbe964910a747da07f69a6e"> 3452</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testProject()</div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;  {</div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;    <span class="keywordtype">double</span> xlo, xhi;</div>
<div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;    <span class="keywordtype">double</span> ylo, yhi;</div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;    <span class="keywordtype">double</span> zlo, zhi;</div>
<div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;    geom-&gt;WorldBox(&amp;xlo, &amp;xhi, &amp;ylo, &amp;yhi, &amp;zlo, &amp;zhi);</div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;</div>
<div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;    <span class="keywordtype">double</span> xyz[3]   = { 0.0, 0.0, 0.0};</div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;    <span class="keywordtype">double</span> dxyz1[3] = { 1.0, 0.0, 0.0};</div>
<div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;    <span class="keywordtype">double</span> dxyz2[3] = {-1.0, 0.0, 0.0};</div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;    <span class="keywordtype">double</span> dxyz3[3] = { 0.0, 1.0, 0.0};</div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;    <span class="keywordtype">double</span> dxyz4[3] = { 0.0,-1.0, 0.0};</div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;    <span class="keywordtype">double</span> dxyz5[3] = { 0.0, 0.0, 1.0};</div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;    <span class="keywordtype">double</span> dxyz6[3] = { 0.0, 0.0,-1.0};</div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;</div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;    <span class="keywordtype">double</span> xyzo[3];</div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;    <a class="code" href="../../d6/d23/namespacegeo.html#aa4f783454188451d17d280826922c2e9">geo::ProjectToBoxEdge</a>(xyz, dxyz1, xlo, xhi, ylo, yhi, zlo, zhi, xyzo);</div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(xyzo[0]-xhi)&gt;1.<a class="code" href="../../d4/d3a/rawtorootconvert_8fcl.html#a073d3febd81cab639f2a8aa357dc5ef1">E</a>-6) abort();</div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;</div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;    <a class="code" href="../../d6/d23/namespacegeo.html#aa4f783454188451d17d280826922c2e9">geo::ProjectToBoxEdge</a>(xyz, dxyz2, xlo, xhi, ylo, yhi, zlo, zhi, xyzo);</div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(xyzo[0]-xlo)&gt;1.<a class="code" href="../../d4/d3a/rawtorootconvert_8fcl.html#a073d3febd81cab639f2a8aa357dc5ef1">E</a>-6) abort();</div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;</div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;    <a class="code" href="../../d6/d23/namespacegeo.html#aa4f783454188451d17d280826922c2e9">geo::ProjectToBoxEdge</a>(xyz, dxyz3, xlo, xhi, ylo, yhi, zlo, zhi, xyzo);</div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(xyzo[1]-yhi)&gt;1.<a class="code" href="../../d4/d3a/rawtorootconvert_8fcl.html#a073d3febd81cab639f2a8aa357dc5ef1">E</a>-6) abort();</div>
<div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;</div>
<div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;    <a class="code" href="../../d6/d23/namespacegeo.html#aa4f783454188451d17d280826922c2e9">geo::ProjectToBoxEdge</a>(xyz, dxyz4, xlo, xhi, ylo, yhi, zlo, zhi, xyzo);</div>
<div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(xyzo[1]-ylo)&gt;1.<a class="code" href="../../d4/d3a/rawtorootconvert_8fcl.html#a073d3febd81cab639f2a8aa357dc5ef1">E</a>-6) abort();</div>
<div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;</div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;    <a class="code" href="../../d6/d23/namespacegeo.html#aa4f783454188451d17d280826922c2e9">geo::ProjectToBoxEdge</a>(xyz, dxyz5, xlo, xhi, ylo, yhi, zlo, zhi, xyzo);</div>
<div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(xyzo[2]-zhi)&gt;1.<a class="code" href="../../d4/d3a/rawtorootconvert_8fcl.html#a073d3febd81cab639f2a8aa357dc5ef1">E</a>-6) abort();</div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;</div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;    <a class="code" href="../../d6/d23/namespacegeo.html#aa4f783454188451d17d280826922c2e9">geo::ProjectToBoxEdge</a>(xyz, dxyz6, xlo, xhi, ylo, yhi, zlo, zhi, xyzo);</div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(xyzo[2]-zlo)&gt;1.<a class="code" href="../../d4/d3a/rawtorootconvert_8fcl.html#a073d3febd81cab639f2a8aa357dc5ef1">E</a>-6) abort();</div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;  }</div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;</div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;</div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;  <span class="keywordtype">bool</span> GeometryTestAlg::CheckAuxDetAtPosition</div>
<div class="line"><a name="l03490"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#ae37aed5ef7550e6301d996aa5b12ecee"> 3490</a></span>&#160;    (<span class="keywordtype">double</span> <span class="keyword">const</span> pos[3], <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> expected) <span class="keyword">const</span></div>
<div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;  {</div>
<div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> foundDet = <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::numeric_limits&lt;unsigned int&gt;::max</a>();</div>
<div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;    <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;      foundDet = geom-&gt;FindAuxDetAtPosition(pos);</div>
<div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;    }</div>
<div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;    <span class="keywordflow">catch</span> (cet::exception <span class="keyword">const</span>&amp; e) {</div>
<div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;      mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Caught an exception while looking for aux det around &quot;</span></div>
<div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;        &lt;&lt; lar::dump::array&lt;3U&gt;(pos) &lt;&lt; <span class="stringliteral">&quot; (within aux det #&quot;</span> &lt;&lt; expected</div>
<div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;); message:\n&quot;</span> &lt;&lt; e.what();</div>
<div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;    }</div>
<div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;    <span class="keywordflow">if</span> (foundDet != expected) {</div>
<div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;      mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Auxiliary detector at position &quot;</span> &lt;&lt; lar::dump::array&lt;3U&gt;(pos)</div>
<div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;, expected within aux det #&quot;</span> &lt;&lt; expected &lt;&lt; <span class="stringliteral">&quot;, was returned to be &quot;</span></div>
<div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;        &lt;&lt; foundDet &lt;&lt; <span class="stringliteral">&quot; instead&quot;</span>;</div>
<div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;    }</div>
<div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;  } <span class="comment">// GeometryTestAlg::CheckAuxDetAtPosition()</span></div>
<div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;</div>
<div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;  <span class="keywordtype">bool</span> GeometryTestAlg::CheckAuxDetSensitiveAtPosition</div>
<div class="line"><a name="l03515"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a185e7b6bdc2ace042b3f4f56157c5814"> 3515</a></span>&#160;    (<span class="keywordtype">double</span> <span class="keyword">const</span> pos[3], <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> expectedDet, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> expectedSens)</div>
<div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;    <span class="keyword">const</span></div>
<div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;  {</div>
<div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;    <span class="keywordtype">size_t</span> foundDet = <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::numeric_limits&lt;unsigned int&gt;::max</a>();</div>
<div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;    <span class="keywordtype">size_t</span> foundSensDet = <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::numeric_limits&lt;unsigned int&gt;::max</a>();</div>
<div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;    <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;      geom-&gt;FindAuxDetSensitiveAtPosition(pos, foundDet, foundSensDet);</div>
<div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;    }</div>
<div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;    <span class="keywordflow">catch</span> (cet::exception <span class="keyword">const</span>&amp; e) {</div>
<div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;      mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Caught an exception while looking for aux det sensitive around &quot;</span></div>
<div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;        &lt;&lt; lar::dump::array&lt;3U&gt;(pos) &lt;&lt; <span class="stringliteral">&quot; (within aux det #&quot;</span> &lt;&lt; expectedDet</div>
<div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;        &lt;&lt; <span class="stringliteral">&quot; sensitive volume #&quot;</span> &lt;&lt; expectedSens &lt;&lt; <span class="stringliteral">&quot;); message:\n&quot;</span> &lt;&lt; e.what();</div>
<div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;    }</div>
<div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;    <span class="keywordflow">if</span> ((foundDet != expectedDet) || (foundSensDet != expectedSens)) {</div>
<div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;      mf::LogProblem(<span class="stringliteral">&quot;GeometryTestAlg&quot;</span>)</div>
<div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Auxiliary detector at position &quot;</span> &lt;&lt; lar::dump::array&lt;3U&gt;(pos)</div>
<div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;, expected within aux det #&quot;</span> &lt;&lt; expectedDet</div>
<div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;, sensitive volume #&quot;</span> &lt;&lt; expectedSens</div>
<div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;, was returned to be in aux det #&quot;</span></div>
<div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;        &lt;&lt; foundDet &lt;&lt; <span class="stringliteral">&quot; sensitive volume #&quot;</span> &lt;&lt; foundSensDet &lt;&lt; <span class="stringliteral">&quot; instead&quot;</span>;</div>
<div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;    }</div>
<div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;  } <span class="comment">// GeometryTestAlg::CheckAuxDetAtPosition()</span></div>
<div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;</div>
<div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l03543"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#ae206490f916471bd9ec3a95e08bdd51a"> 3543</a></span>&#160;  <span class="keywordtype">void</span> GeometryTestAlg::testFindAuxDet()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;</div>
<div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;<span class="comment">     * Picks the center of each sensitive detector and verifies that the</span></div>
<div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;<span class="comment">     * correct sensitive detector and auxiliary detector are found.</span></div>
<div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;</div>
<div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a> = 0;</div>
<div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;</div>
<div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="keyword">const</span> nAuxDets = geom-&gt;NAuxDets();</div>
<div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;</div>
<div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iDet = 0; iDet &lt; nAuxDets; ++iDet) {</div>
<div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;</div>
<div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;      <a class="code" href="../../db/d4f/classgeo_1_1AuxDetGeo.html">geo::AuxDetGeo</a> <span class="keyword">const</span>&amp; auxDet = geom-&gt;AuxDet(iDet);</div>
<div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="keyword">const</span> nSensitive = auxDet.<a class="code" href="../../db/d4f/classgeo_1_1AuxDetGeo.html#ae78d4eec47d921df33279d7f79bb798c">NSensitiveVolume</a>();</div>
<div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;</div>
<div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;      <span class="keywordflow">if</span> (nSensitive == 0) {</div>
<div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;        std::array&lt;double, 3U&gt; center;</div>
<div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;        auxDet.<a class="code" href="../../db/d4f/classgeo_1_1AuxDetGeo.html#ad07cad0da74717282f501930c0dcdc95">GetCenter</a>(center.data());</div>
<div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;</div>
<div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;        <span class="keywordflow">if</span> (!CheckAuxDetAtPosition(center.data(), iDet)) ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;</div>
<div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;      }</div>
<div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;      <span class="keywordflow">else</span> { <span class="comment">// if one or more sensitive detectors</span></div>
<div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;</div>
<div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iDetSens = 0; iDetSens &lt; nSensitive; ++iDetSens) {</div>
<div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;</div>
<div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;          <a class="code" href="../../d5/df8/classgeo_1_1AuxDetSensitiveGeo.html">geo::AuxDetSensitiveGeo</a> <span class="keyword">const</span>&amp; auxDetSens</div>
<div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;            = auxDet.<a class="code" href="../../db/d4f/classgeo_1_1AuxDetGeo.html#ac9646d8cfd1b8aad57857851e37215b7">SensitiveVolume</a>(iDetSens);</div>
<div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;          std::array&lt;double, 3U&gt; center;</div>
<div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;          auxDetSens.<a class="code" href="../../d5/df8/classgeo_1_1AuxDetSensitiveGeo.html#a4021fd1394c3f5c41288aaf2062530b9">GetCenter</a>(center.data());</div>
<div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;</div>
<div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;          <span class="keywordflow">if</span> (!CheckAuxDetAtPosition(center.data(), iDet)) ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;          <span class="keywordflow">if</span> (!CheckAuxDetSensitiveAtPosition(center.data(), iDet, iDetSens))</div>
<div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;            ++<a class="code" href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">nErrors</a>;</div>
<div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;</div>
<div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;        } <span class="comment">// for sensitive detectors</span></div>
<div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;</div>
<div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;      } <span class="comment">// if ... else</span></div>
<div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;</div>
<div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;    } <span class="comment">// for all auxiliary detectors</span></div>
<div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;</div>
<div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;    <span class="keywordflow">if</span> (nErrors != 0) {</div>
<div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;FindAuxDet&quot;</span>)</div>
<div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Collected &quot;</span> &lt;&lt; nErrors &lt;&lt; <span class="stringliteral">&quot; errors during testFindAuxDet() test!\n&quot;</span>;</div>
<div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;    }</div>
<div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;</div>
<div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;</div>
<div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;  } <span class="comment">// GeometryTestAlg::testFindAuxDet()</span></div>
<div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;</div>
<div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;  <span class="comment">//......................................................................</span></div>
<div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;</div>
<div class="line"><a name="l03597"></a><span class="lineno"><a class="line" href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#a8e7b7e236581cc3c153a680271a6e692"> 3597</a></span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">bool</span> GeometryTestAlg::shouldRunTests(std::string test_name)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;    <span class="keywordflow">return</span> fRunTests(test_name);</div>
<div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;  } <span class="comment">// GeometryTestAlg::shouldRunTests()</span></div>
<div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;</div>
<div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;}<span class="comment">//end namespace</span></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_a1664147617bb56a9be21be741f3c96a2"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#a1664147617bb56a9be21be741f3c96a2">geo::TPCGeo::ID</a></div><div class="ttdeci">geo::TPCID const &amp; ID() const </div><div class="ttdoc">Returns the identifier of this TPC. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00333">TPCGeo.h:333</a></div></div>
<div class="ttc" id="classgeo_1_1WireGeo_html_a1fe2dceeec7c5c0b14c6c9593482e438"><div class="ttname"><a href="../../de/dce/classgeo_1_1WireGeo.html#a1fe2dceeec7c5c0b14c6c9593482e438">geo::WireGeo::GetStart</a></div><div class="ttdeci">void GetStart(double *xyz) const </div><div class="ttdef"><b>Definition:</b> <a href="../../da/de5/WireGeo_8h_source.html#l00157">WireGeo.h:157</a></div></div>
<div class="ttc" id="classgeo_1_1WireGeo_html"><div class="ttname"><a href="../../de/dce/classgeo_1_1WireGeo.html">geo::WireGeo</a></div><div class="ttdoc">Geometry description of a TPC wireThe wire is a single straight segment on a wire plane...</div><div class="ttdef"><b>Definition:</b> <a href="../../da/de5/WireGeo_8h_source.html#l00065">WireGeo.h:65</a></div></div>
<div class="ttc" id="namespacegeo_html_a22d2a7c73b2795146b92cd54ded9e817"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a></div><div class="ttdeci">ROOT::Math::DisplacementVector3D&lt; ROOT::Math::Cartesian3D&lt; double &gt;, ROOT::Math::GlobalCoordinateSystemTag &gt; Vector_t</div><div class="ttdoc">Type for representation of momenta in 3D space. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7d/geo__vectors_8h_source.html#l00164">geo_vectors.h:164</a></div></div>
<div class="ttc" id="GeometryTestAlg_8h_html"><div class="ttname"><a href="../../d3/db1/GeometryTestAlg_8h.html">GeometryTestAlg.h</a></div><div class="ttdoc">Unit test for geometry functionalities. </div></div>
<div class="ttc" id="classgeo_1_1CryostatGeo_html_ac1620d671418fd2cfe6ef69ce076df85"><div class="ttname"><a href="../../de/da3/classgeo_1_1CryostatGeo.html#ac1620d671418fd2cfe6ef69ce076df85">geo::CryostatGeo::GetCenter</a></div><div class="ttdeci">geo::Point_t GetCenter() const </div><div class="ttdoc">Returns the geometrical center of the cryostat. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d13/CryostatGeo_8h_source.html#l00124">CryostatGeo.h:124</a></div></div>
<div class="ttc" id="classgeo_1_1GeometryTestAlg_html_aea9c4e05f9e485d9e0b6715d6d9b25fb"><div class="ttname"><a href="../../dc/d05/classgeo_1_1GeometryTestAlg.html#aea9c4e05f9e485d9e0b6715d6d9b25fb">geo::GeometryTestAlg::GeometryTestAlg</a></div><div class="ttdeci">GeometryTestAlg(fhicl::ParameterSet const &amp;pset)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d55/GeometryTestAlg_8cxx_source.html#l00118">GeometryTestAlg.cxx:118</a></div></div>
<div class="ttc" id="namespacepmtana_html_a9860e62c78db1dd9c7d635a2832b883a"><div class="ttname"><a href="../../da/dc9/namespacepmtana.html#a9860e62c78db1dd9c7d635a2832b883a">pmtana::std</a></div><div class="ttdeci">double std(const std::vector&lt; short &gt; &amp;wf, const double ped_mean, size_t start, size_t nsample)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/de4/UtilFunc_8cxx_source.html#l00042">UtilFunc.cxx:42</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_a7b3c9e3d79a25a20f069007a462ee9ca"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#a7b3c9e3d79a25a20f069007a462ee9ca">geo::TPCGeo::DriftDir</a></div><div class="ttdeci">Vector DriftDir() const </div><div class="ttdoc">Returns the direction of the drift (vector pointing toward the planes). </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00773">TPCGeo.h:773</a></div></div>
<div class="ttc" id="structgeo_1_1WireIDIntersection_html_a99e74ffcbcfd46cdb9754cde0a2019a1"><div class="ttname"><a href="../../da/d3d/structgeo_1_1WireIDIntersection.html#a99e74ffcbcfd46cdb9754cde0a2019a1">geo::WireIDIntersection::z</a></div><div class="ttdeci">double z</div><div class="ttdoc">z position of intersection </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00805">geo_types.h:805</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_a697df19a5c945ce5622c50f80e60fbce"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#a697df19a5c945ce5622c50f80e60fbce">geo::TPCGeo::PlanePitch</a></div><div class="ttdeci">double PlanePitch(unsigned int p1=0, unsigned int p2=1) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d00/TPCGeo_8cxx_source.html#l00388">TPCGeo.cxx:388</a></div></div>
<div class="ttc" id="CORSIKAGen_8fcl_html_a424b27db311314d6e22e0e78fd28a35a"><div class="ttname"><a href="../../d2/d0d/CORSIKAGen_8fcl.html#a424b27db311314d6e22e0e78fd28a35a">offset</a></div><div class="ttdeci">BEGIN_PROLOG TPC Trig offset(g4 rise time) ProjectToHeight</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d0d/CORSIKAGen_8fcl_source.html#l00007">CORSIKAGen.fcl:7</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_a424e1ebac0e28e3a1c6fe14604452ddf"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#a424e1ebac0e28e3a1c6fe14604452ddf">geo::TPCGeo::PrintTPCInfo</a></div><div class="ttdeci">void PrintTPCInfo(Stream &amp;&amp;out, std::string indent=&quot;&quot;, unsigned int verbosity=1) const </div><div class="ttdoc">Prints information about this TPC. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00789">TPCGeo.h:789</a></div></div>
<div class="ttc" id="namespacelar_1_1dump_html_adb8558d6da99a3196b0b851015b1c288"><div class="ttname"><a href="../../db/dfa/namespacelar_1_1dump.html#adb8558d6da99a3196b0b851015b1c288">lar::dump::vector3D</a></div><div class="ttdeci">auto vector3D(Vector3D const &amp;v)</div><div class="ttdoc">Returns a manipulator which will print the specified vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/DumpUtils_8h_source.html#l00301">DumpUtils.h:301</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_a61ef94078870f7f4d929a5e81b36b425"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#a61ef94078870f7f4d929a5e81b36b425">geo::TPCGeo::GetActiveVolumeCenter</a></div><div class="ttdeci">Point GetActiveVolumeCenter() const </div><div class="ttdoc">Returns the center of the TPC active volume in world coordinates [cm]. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00288">TPCGeo.h:288</a></div></div>
<div class="ttc" id="namespacegeo_1_1vect_html_a6a834f7c51903b6d2bdfdd664f064992"><div class="ttname"><a href="../../d0/d8e/namespacegeo_1_1vect.html#a6a834f7c51903b6d2bdfdd664f064992">geo::vect::dot</a></div><div class="ttdeci">constexpr auto dot(Vector const &amp;a, Vector const &amp;b)</div><div class="ttdoc">Return cross product of two vectors. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d6c/geo__vectors__utils_8h_source.html#l01194">geo_vectors_utils.h:1194</a></div></div>
<div class="ttc" id="classgeo_1_1AuxDetSensitiveGeo_html_a71992b010a3e7bc25ca9cf348ab91d21"><div class="ttname"><a href="../../d5/df8/classgeo_1_1AuxDetSensitiveGeo.html#a71992b010a3e7bc25ca9cf348ab91d21">geo::AuxDetSensitiveGeo::HalfWidth2</a></div><div class="ttdeci">double HalfWidth2() const </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d42/AuxDetSensitiveGeo_8h_source.html#l00094">AuxDetSensitiveGeo.h:94</a></div></div>
<div class="ttc" id="namespacegeo_html_a3b3c27511a16721236b09f14b66a58beac3aae5646e132e0a884ed6cb736945ad"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#a3b3c27511a16721236b09f14b66a58beac3aae5646e132e0a884ed6cb736945ad">geo::kMysteryType</a></div><div class="ttdoc">Who knows? </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00147">geo_types.h:147</a></div></div>
<div class="ttc" id="structlar_1_1util_1_1RealComparisons_html_ae2cc1b59a9971cab5f940efc88136880"><div class="ttname"><a href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html#ae2cc1b59a9971cab5f940efc88136880">lar::util::RealComparisons::nonEqual</a></div><div class="ttdeci">constexpr bool nonEqual(Value_t a, Value_t b) const </div><div class="ttdoc">Returns whether a and b are farther than the threshold. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dbc/RealComparisons_8h_source.html#l00085">RealComparisons.h:85</a></div></div>
<div class="ttc" id="CryostatGeo_8h_html"><div class="ttname"><a href="../../df/d13/CryostatGeo_8h.html">CryostatGeo.h</a></div><div class="ttdoc">Encapsulate the construction of a single cyostat. </div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_a6559a5e3105cc12a7e984e66ed76e078"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#a6559a5e3105cc12a7e984e66ed76e078">geo::TPCGeo::LengthDir</a></div><div class="ttdeci">decltype(auto) LengthDir() const </div><div class="ttdoc">Returns the direction Length() is measured on. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00138">TPCGeo.h:138</a></div></div>
<div class="ttc" id="geo_8h_html"><div class="ttname"><a href="../../db/d35/geo_8h.html">geo.h</a></div><div class="ttdoc">Collect all the geometry header files together. </div></div>
<div class="ttc" id="AuxDetSensitiveGeo_8h_html"><div class="ttname"><a href="../../db/d42/AuxDetSensitiveGeo_8h.html">AuxDetSensitiveGeo.h</a></div><div class="ttdoc">Encapsulate the geometry of the sensitive portion of an auxiliary detector. </div></div>
<div class="ttc" id="messageservice_8fcl_html_a8d1a8a85a0b2a30cac1090ea528dd015"><div class="ttname"><a href="../../d8/df5/messageservice_8fcl.html#a8d1a8a85a0b2a30cac1090ea528dd015">cerr</a></div><div class="ttdeci">BEGIN_PROLOG could also be cerr</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/df5/messageservice_8fcl_source.html#l00010">messageservice.fcl:10</a></div></div>
<div class="ttc" id="readout__types_8h_html"><div class="ttname"><a href="../../d9/d64/readout__types_8h.html">readout_types.h</a></div><div class="ttdoc">Classes identifying readout-related concepts. </div></div>
<div class="ttc" id="classgeo_1_1AuxDetSensitiveGeo_html_a81206c68310c8627f64f8066493b299b"><div class="ttname"><a href="../../d5/df8/classgeo_1_1AuxDetSensitiveGeo.html#a81206c68310c8627f64f8066493b299b">geo::AuxDetSensitiveGeo::GetNormalVector</a></div><div class="ttdeci">geo::Vector_t GetNormalVector() const </div><div class="ttdoc">Returns the unit normal vector to the detector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d2a/AuxDetSensitiveGeo_8cxx_source.html#l00057">AuxDetSensitiveGeo.cxx:57</a></div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_a52fd8fb79c65318b52d60acb58c9a0d3"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#a52fd8fb79c65318b52d60acb58c9a0d3">geo::PlaneGeo::Wire</a></div><div class="ttdeci">WireGeo const &amp; Wire(unsigned int iwire) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd0/PlaneGeo_8cxx_source.html#l00506">PlaneGeo.cxx:506</a></div></div>
<div class="ttc" id="namespacegeo_html_af19a06f2c5c02e369b7a622e385fddec"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#af19a06f2c5c02e369b7a622e385fddec">geo::fExpectedPlanePitches</a></div><div class="ttdeci">fExpectedPlanePitches(pset.get&lt; std::vector&lt; double &gt;&gt;(&quot;ExpectedPlanePitches&quot;,{}))</div></div>
<div class="ttc" id="namespacegeo_html_a6baec40eaf3ff161f7eb1a5f0779794f"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#a6baec40eaf3ff161f7eb1a5f0779794f">geo::View_t</a></div><div class="ttdeci">enum geo::_plane_proj View_t</div><div class="ttdoc">Enumerate the possible plane projections. </div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_a0fcad5daf16e14b04be6fdb949429fa0"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#a0fcad5daf16e14b04be6fdb949429fa0">geo::TPCGeo::ActiveHalfHeight</a></div><div class="ttdeci">double ActiveHalfHeight() const </div><div class="ttdoc">Half height (associated with y coordinate) of active TPC volume [cm]. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00099">TPCGeo.h:99</a></div></div>
<div class="ttc" id="classgeo_1_1details_1_1TPC__id__iterator__base_html"><div class="ttname"><a href="../../d5/dc7/classgeo_1_1details_1_1TPC__id__iterator__base.html">geo::details::TPC_id_iterator_base</a></div><div class="ttdoc">Base forward iterator browsing all TPC IDs in the detector. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de7/GeometryCore_8h_source.html#l00292">GeometryCore.h:292</a></div></div>
<div class="ttc" id="classgeo_1_1AuxDetGeo_html_ac9646d8cfd1b8aad57857851e37215b7"><div class="ttname"><a href="../../db/d4f/classgeo_1_1AuxDetGeo.html#ac9646d8cfd1b8aad57857851e37215b7">geo::AuxDetGeo::SensitiveVolume</a></div><div class="ttdeci">AuxDetSensitiveGeo const &amp; SensitiveVolume(size_t sv) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d8a/AuxDetGeo_8h_source.html#l00171">AuxDetGeo.h:171</a></div></div>
<div class="ttc" id="classgeo_1_1WireGeo_html_a68c1273caa6c5551923e9f77cc9dd746"><div class="ttname"><a href="../../de/dce/classgeo_1_1WireGeo.html#a68c1273caa6c5551923e9f77cc9dd746">geo::WireGeo::DistanceFrom</a></div><div class="ttdeci">double DistanceFrom(geo::WireGeo const &amp;wire) const </div><div class="ttdoc">Returns 3D distance from the specified wire. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d05/WireGeo_8cxx_source.html#l00113">WireGeo.cxx:113</a></div></div>
<div class="ttc" id="namespacegeo_html_aca2efd2e6b858cf0a9c12384c3b2f486ae329b0f520125896d02940bec370fca7"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486ae329b0f520125896d02940bec370fca7">geo::kUnknown</a></div><div class="ttdoc">Unknown view. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00136">geo_types.h:136</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_ab3391de99203f6a60eeeef152d3adb35"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#ab3391de99203f6a60eeeef152d3adb35">geo::TPCGeo::Nplanes</a></div><div class="ttdeci">unsigned int Nplanes() const </div><div class="ttdoc">Number of planes in this tpc. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00165">TPCGeo.h:165</a></div></div>
<div class="ttc" id="structlar_1_1util_1_1RealComparisons_html"><div class="ttname"><a href="../../d9/de2/structlar_1_1util_1_1RealComparisons.html">lar::util::RealComparisons&lt; double &gt;</a></div></div>
<div class="ttc" id="classgeo_1_1InvalidWireIDError_html_ad637cb756a2b9bee0df19f77578ca5df"><div class="ttname"><a href="../../d2/d09/classgeo_1_1InvalidWireIDError.html#ad637cb756a2b9bee0df19f77578ca5df">geo::InvalidWireIDError::wire_number</a></div><div class="ttdeci">int wire_number</div><div class="ttdoc">the invalid wire number </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d7c/Exceptions_8h_source.html#l00167">Exceptions.h:167</a></div></div>
<div class="ttc" id="PMTconfigurationExtraction__module_8cc_html_ac33ee765f5ad9f134540bac393721cfe"><div class="ttname"><a href="../../db/d87/PMTconfigurationExtraction__module_8cc.html#ac33ee765f5ad9f134540bac393721cfe">get</a></div><div class="ttdeci">get()</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d87/PMTconfigurationExtraction__module_8cc_source.html#l00168">PMTconfigurationExtraction_module.cc:168</a></div></div>
<div class="ttc" id="selectors_8fcl_html_a24c8335057af14a9b508d5ac18999ce5"><div class="ttname"><a href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a></div><div class="ttdeci">pdgs p</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd2/selectors_8fcl_source.html#l00022">selectors.fcl:22</a></div></div>
<div class="ttc" id="classgeo_1_1BoxBoundedGeo_html_afd042da19afb090ba80e93ee64d4dec5"><div class="ttname"><a href="../../db/d54/classgeo_1_1BoxBoundedGeo.html#afd042da19afb090ba80e93ee64d4dec5">geo::BoxBoundedGeo::MinX</a></div><div class="ttdeci">double MinX() const </div><div class="ttdoc">Returns the world x coordinate of the start of the box. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d92/BoxBoundedGeo_8h_source.html#l00088">BoxBoundedGeo.h:88</a></div></div>
<div class="ttc" id="structgeo_1_1PlaneID_html_abf7d62dd39e4ff6c1f1046a76416448e"><div class="ttname"><a href="../../d4/d41/structgeo_1_1PlaneID.html#abf7d62dd39e4ff6c1f1046a76416448e">geo::PlaneID::PlaneID_t</a></div><div class="ttdeci">unsigned int PlaneID_t</div><div class="ttdoc">Type for the ID number. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00473">geo_types.h:473</a></div></div>
<div class="ttc" id="structgeo_1_1PlaneID_html"><div class="ttname"><a href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a></div><div class="ttdoc">The data type to uniquely identify a Plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00472">geo_types.h:472</a></div></div>
<div class="ttc" id="structgeo_1_1CryostatID_html_a9384db80f2ab08f013fc630316d7bd05"><div class="ttname"><a href="../../d9/d73/structgeo_1_1CryostatID.html#a9384db80f2ab08f013fc630316d7bd05">geo::CryostatID::isValid</a></div><div class="ttdeci">bool isValid</div><div class="ttdoc">Whether this ID points to a valid element. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00211">geo_types.h:211</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html">geo::TPCGeo</a></div><div class="ttdoc">Geometry information for a single TPC. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00038">TPCGeo.h:38</a></div></div>
<div class="ttc" id="RawTypes_8h_html"><div class="ttname"><a href="../../d9/d38/RawTypes_8h.html">RawTypes.h</a></div></div>
<div class="ttc" id="classgeo_1_1BoxBoundedGeo_html_a8bbea288bcdf9c746e70ee8de8c489a6"><div class="ttname"><a href="../../db/d54/classgeo_1_1BoxBoundedGeo.html#a8bbea288bcdf9c746e70ee8de8c489a6">geo::BoxBoundedGeo::CenterX</a></div><div class="ttdeci">double CenterX() const </div><div class="ttdoc">Returns the world x coordinate of the center of the box. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d92/BoxBoundedGeo_8h_source.html#l00094">BoxBoundedGeo.h:94</a></div></div>
<div class="ttc" id="namespacegeo_1_1vect_html_aabcc53a6fd142c7cb43c9aca166a7881"><div class="ttname"><a href="../../d0/d8e/namespacegeo_1_1vect.html#aabcc53a6fd142c7cb43c9aca166a7881">geo::vect::toPoint</a></div><div class="ttdeci">::geo::Point_t toPoint(Point const &amp;p)</div><div class="ttdoc">Convert the specified point into a geo::Point_t. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d6c/geo__vectors__utils_8h_source.html#l01485">geo_vectors_utils.h:1485</a></div></div>
<div class="ttc" id="pmttriggerproducer_8fcl_html_a527d89be40c3c20ca8162df059180fd9"><div class="ttname"><a href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">max</a></div><div class="ttdeci">BEGIN_PROLOG pmt_uncoated ideal single PE test page of manual option are OR or AND window for pmt trigger time start window for pmt trigger time end etc then what events all hists are saved for max</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5a/pmttriggerproducer_8fcl_source.html#l00023">pmttriggerproducer.fcl:23</a></div></div>
<div class="ttc" id="classgeo_1_1BoxBoundedGeo_html_a008c12369d6de1031dba1dbb92714af7"><div class="ttname"><a href="../../db/d54/classgeo_1_1BoxBoundedGeo.html#a008c12369d6de1031dba1dbb92714af7">geo::BoxBoundedGeo::CenterZ</a></div><div class="ttdeci">double CenterZ() const </div><div class="ttdoc">Returns the world z coordinate of the center of the box. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d92/BoxBoundedGeo_8h_source.html#l00124">BoxBoundedGeo.h:124</a></div></div>
<div class="ttc" id="structgeo_1_1CryostatID_html_a2bfb744818e075d94be15dd18c950441"><div class="ttname"><a href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">geo::CryostatID::Cryostat</a></div><div class="ttdeci">CryostatID_t Cryostat</div><div class="ttdoc">Index of cryostat. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00212">geo_types.h:212</a></div></div>
<div class="ttc" id="namespacelarg4_html_a42b3ada02e272fe2fa2b641ba06ab7d4"><div class="ttname"><a href="../../d7/d6f/namespacelarg4.html#a42b3ada02e272fe2fa2b641ba06ab7d4">larg4::bool</a></div><div class="ttdeci">static constexpr bool</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d8a/OpFastScintillation_8hh_source.html#l00588">OpFastScintillation.hh:588</a></div></div>
<div class="ttc" id="classgeo_1_1BoxBoundedGeo_html_ae141949f30631ded82199f4375c21b7e"><div class="ttname"><a href="../../db/d54/classgeo_1_1BoxBoundedGeo.html#ae141949f30631ded82199f4375c21b7e">geo::BoxBoundedGeo::MaxX</a></div><div class="ttdeci">double MaxX() const </div><div class="ttdoc">Returns the world x coordinate of the end of the box. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d92/BoxBoundedGeo_8h_source.html#l00091">BoxBoundedGeo.h:91</a></div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_a353efd073bc89de1a1c429b8b66df291"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#a353efd073bc89de1a1c429b8b66df291">geo::PlaneGeo::IterateWires</a></div><div class="ttdeci">ElementIteratorBox IterateWires() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d80/PlaneGeo_8h_source.html#l00401">PlaneGeo.h:401</a></div></div>
<div class="ttc" id="structgeo_1_1WireID_html_ac303d2971eb9697f3a65821bb92bb934"><div class="ttname"><a href="../../de/db1/structgeo_1_1WireID.html#ac303d2971eb9697f3a65821bb92bb934">geo::WireID::Wire</a></div><div class="ttdeci">WireID_t Wire</div><div class="ttdoc">Index of the wire within its plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00580">geo_types.h:580</a></div></div>
<div class="ttc" id="rawtorootconvert_8fcl_html_a073d3febd81cab639f2a8aa357dc5ef1"><div class="ttname"><a href="../../d4/d3a/rawtorootconvert_8fcl.html#a073d3febd81cab639f2a8aa357dc5ef1">E</a></div><div class="ttdeci">process_name E</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d3a/rawtorootconvert_8fcl_source.html#l00026">rawtorootconvert.fcl:26</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_a94351b7cd90a2f6471eee59f7e9c592e"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#a94351b7cd90a2f6471eee59f7e9c592e">geo::TPCGeo::ActiveMass</a></div><div class="ttdeci">double ActiveMass() const </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00118">TPCGeo.h:118</a></div></div>
<div class="ttc" id="structgeo_1_1WireID_html"><div class="ttname"><a href="../../de/db1/structgeo_1_1WireID.html">geo::WireID</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00560">geo_types.h:560</a></div></div>
<div class="ttc" id="namespacegeo_html_a1b5150a78645f276a21647cc0b48fb69ab6ea94727ba423afbde5dbd7e9306bdf"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#a1b5150a78645f276a21647cc0b48fb69ab6ea94727ba423afbde5dbd7e9306bdf">geo::kNegX</a></div><div class="ttdoc">Drift towards negative X values. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00162">geo_types.h:162</a></div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_a9e377d1748a3be9d63a4565b9192192e"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#a9e377d1748a3be9d63a4565b9192192e">geo::PlaneGeo::ActiveArea</a></div><div class="ttdeci">Rect const &amp; ActiveArea() const </div><div class="ttdoc">Returns an area covered by the wires in the plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d80/PlaneGeo_8h_source.html#l00758">PlaneGeo.h:758</a></div></div>
<div class="ttc" id="classgeo_1_1CryostatGeo_html"><div class="ttname"><a href="../../de/da3/classgeo_1_1CryostatGeo.html">geo::CryostatGeo</a></div><div class="ttdoc">Geometry information for a single cryostat. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d13/CryostatGeo_8h_source.html#l00043">CryostatGeo.h:43</a></div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_a9747db83dd7c5dc6fe68da661b04ffc8"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#a9747db83dd7c5dc6fe68da661b04ffc8">geo::PlaneGeo::GetNormalDirection</a></div><div class="ttdeci">Vector GetNormalDirection() const </div><div class="ttdoc">Returns the direction normal to the plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d80/PlaneGeo_8h_source.html#l00442">PlaneGeo.h:442</a></div></div>
<div class="ttc" id="classgeo_1_1WireGeo_html_a38b8593bbb47f94a5c51a1ffe8e6ceb7"><div class="ttname"><a href="../../de/dce/classgeo_1_1WireGeo.html#a38b8593bbb47f94a5c51a1ffe8e6ceb7">geo::WireGeo::WirePitch</a></div><div class="ttdeci">static double WirePitch(geo::WireGeo const &amp;w1, geo::WireGeo const &amp;w2)</div><div class="ttdoc">Returns the pitch (distance on y/z plane) between two wires, in cm. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/de5/WireGeo_8h_source.html#l00476">WireGeo.h:476</a></div></div>
<div class="ttc" id="classgeo_1_1AuxDetSensitiveGeo_html_a4bddfb859a9d32193399c327f3adaaa8"><div class="ttname"><a href="../../d5/df8/classgeo_1_1AuxDetSensitiveGeo.html#a4bddfb859a9d32193399c327f3adaaa8">geo::AuxDetSensitiveGeo::HalfWidth1</a></div><div class="ttdeci">double HalfWidth1() const </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d42/AuxDetSensitiveGeo_8h_source.html#l00093">AuxDetSensitiveGeo.h:93</a></div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_aa136661c166fee6b9f9888423ac2824d"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#aa136661c166fee6b9f9888423ac2824d">geo::PlaneGeo::GetIncreasingWireDirection</a></div><div class="ttdeci">Vector GetIncreasingWireDirection() const </div><div class="ttdoc">Returns the direction of increasing wires. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d80/PlaneGeo_8h_source.html#l00457">PlaneGeo.h:457</a></div></div>
<div class="ttc" id="classgeo_1_1WireGeo_html_a0607dce1b981e52fc158ad5cbfd343d0"><div class="ttname"><a href="../../de/dce/classgeo_1_1WireGeo.html#a0607dce1b981e52fc158ad5cbfd343d0">geo::WireGeo::ThetaZ</a></div><div class="ttdeci">double ThetaZ() const </div><div class="ttdoc">Returns angle of wire with respect to z axis in the Y-Z plane in radians. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/de5/WireGeo_8h_source.html#l00250">WireGeo.h:250</a></div></div>
<div class="ttc" id="namespacelarg4_html_a7eeba60c219f2d1b4094606a12d28d18"><div class="ttname"><a href="../../d7/d6f/namespacelarg4.html#a7eeba60c219f2d1b4094606a12d28d18">larg4::false</a></div><div class="ttdeci">return false</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d8a/OpFastScintillation_8hh_source.html#l00592">OpFastScintillation.hh:592</a></div></div>
<div class="ttc" id="RealComparisons_8h_html"><div class="ttname"><a href="../../d5/dbc/RealComparisons_8h.html">RealComparisons.h</a></div><div class="ttdoc">Class for approximate comparisons. </div></div>
<div class="ttc" id="sbnd__flashalgo_8fcl_html_a648c7afac4085c93cd1ba4a75dfe8818"><div class="ttname"><a href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a></div><div class="ttdeci">BEGIN_PROLOG TPC</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d22/sbnd__flashalgo_8fcl_source.html#l00014">sbnd_flashalgo.fcl:14</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_a02c06159006b35ce2913102d3c862e32"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#a02c06159006b35ce2913102d3c862e32">geo::TPCGeo::Width</a></div><div class="ttdeci">double Width() const </div><div class="ttdoc">Width is associated with x coordinate [cm]. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00109">TPCGeo.h:109</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_a69e909a83e35d91c6abffca531d07d06"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#a69e909a83e35d91c6abffca531d07d06">geo::TPCGeo::Height</a></div><div class="ttdeci">double Height() const </div><div class="ttdoc">Height is associated with y coordinate [cm]. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00113">TPCGeo.h:113</a></div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_a6f9d364c5e6bc1180ca4b8656a866c07"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#a6f9d364c5e6bc1180ca4b8656a866c07">geo::PlaneGeo::InterWireProjectedDistance</a></div><div class="ttdeci">double InterWireProjectedDistance(WireCoordProjection_t const &amp;projDir) const </div><div class="ttdoc">Returns the distance between wires along the specified direction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd0/PlaneGeo_8cxx_source.html#l00705">PlaneGeo.cxx:705</a></div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_aa54c0f7dfa8911933f0757a9573c7c77"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#aa54c0f7dfa8911933f0757a9573c7c77">geo::PlaneGeo::DriftPoint</a></div><div class="ttdeci">void DriftPoint(geo::Point_t &amp;position, double distance) const </div><div class="ttdoc">Shifts the position of an electron drifted by a distance. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d80/PlaneGeo_8h_source.html#l00643">PlaneGeo.h:643</a></div></div>
<div class="ttc" id="main_8cpp_html_abb11f4d2544da34ecc72c1be4b1796b3"><div class="ttname"><a href="../../df/d0a/main_8cpp.html#abb11f4d2544da34ecc72c1be4b1796b3">nodes</a></div><div class="ttdeci">#define nodes</div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_a0e39141f154428669f715c957d3c5a5e"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#a0e39141f154428669f715c957d3c5a5e">geo::TPCGeo::Length</a></div><div class="ttdeci">double Length() const </div><div class="ttdoc">Length is associated with z coordinate [cm]. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00115">TPCGeo.h:115</a></div></div>
<div class="ttc" id="namespacegeo_html_af365983f9f6d3e62c0462bd312977b92"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#af365983f9f6d3e62c0462bd312977b92">geo::WiresIntersection</a></div><div class="ttdeci">geo::Point_t WiresIntersection(geo::WireGeo const &amp;wireA, geo::WireGeo const &amp;wireB)</div><div class="ttdoc">Returns the point of wireA that is closest to wireB. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/de5/WireGeo_8h_source.html#l00654">WireGeo.h:654</a></div></div>
<div class="ttc" id="make__xml__premcc1_80_8sh_html_a6a381711e6b60dd64d5ecdb1d135c1b8"><div class="ttname"><a href="../../d5/d61/make__xml__premcc1_80_8sh.html#a6a381711e6b60dd64d5ecdb1d135c1b8">local</a></div><div class="ttdeci">then local</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d61/make__xml__premcc1_80_8sh_source.html#l00085">make_xml_premcc1.0.sh:85</a></div></div>
<div class="ttc" id="namespacelar_1_1dump_html_a71d4403edbac4d265176f8677118194f"><div class="ttname"><a href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">lar::dump::vector</a></div><div class="ttdeci">auto vector(Vector const &amp;v)</div><div class="ttdoc">Returns a manipulator which will print the specified array. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/DumpUtils_8h_source.html#l00265">DumpUtils.h:265</a></div></div>
<div class="ttc" id="classgeo_1_1AuxDetGeo_html_a809f7b8d168ee8c5b9abbbae7fa74405"><div class="ttname"><a href="../../db/d4f/classgeo_1_1AuxDetGeo.html#a809f7b8d168ee8c5b9abbbae7fa74405">geo::AuxDetGeo::HalfWidth2</a></div><div class="ttdeci">double HalfWidth2() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d8a/AuxDetGeo_8h_source.html#l00104">AuxDetGeo.h:104</a></div></div>
<div class="ttc" id="classgeo_1_1WireGeo_html_a87b418fce901a25990cecc94055ee1ce"><div class="ttname"><a href="../../de/dce/classgeo_1_1WireGeo.html#a87b418fce901a25990cecc94055ee1ce">geo::WireGeo::GetPositionFromCenter</a></div><div class="ttdeci">Point GetPositionFromCenter(double localz) const </div><div class="ttdoc">Returns the position (world coordinate) of a point on the wire. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/de5/WireGeo_8h_source.html#l00182">WireGeo.h:182</a></div></div>
<div class="ttc" id="classgeo_1_1AuxDetSensitiveGeo_html_a9e05776bc7484ab828433621604ddb8e"><div class="ttname"><a href="../../d5/df8/classgeo_1_1AuxDetSensitiveGeo.html#a9e05776bc7484ab828433621604ddb8e">geo::AuxDetSensitiveGeo::Length</a></div><div class="ttdeci">double Length() const </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d42/AuxDetSensitiveGeo_8h_source.html#l00091">AuxDetSensitiveGeo.h:91</a></div></div>
<div class="ttc" id="GeometryCore_8h_html"><div class="ttname"><a href="../../db/de7/GeometryCore_8h.html">GeometryCore.h</a></div><div class="ttdoc">Access the description of detector geometry. </div></div>
<div class="ttc" id="sparse__vector__test_8cc_html_a39f16bf854ba527dee7eba5bbbd93f3f"><div class="ttname"><a href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a></div><div class="ttdeci">T abs(T value)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d59/sparse__vector__test_8cc_source.html#l00030">sparse_vector_test.cc:30</a></div></div>
<div class="ttc" id="classgeo_1_1AuxDetSensitiveGeo_html_af7917bd36b925dff60bac457504b7b16"><div class="ttname"><a href="../../d5/df8/classgeo_1_1AuxDetSensitiveGeo.html#af7917bd36b925dff60bac457504b7b16">geo::AuxDetSensitiveGeo::HalfHeight</a></div><div class="ttdeci">double HalfHeight() const </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d42/AuxDetSensitiveGeo_8h_source.html#l00096">AuxDetSensitiveGeo.h:96</a></div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_a066c372521b61e61bc86146ea4a9fc66"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#a066c372521b61e61bc86146ea4a9fc66">geo::PlaneGeo::WidthDepthProjection_t</a></div><div class="ttdeci">ROOT::Math::DisplacementVector2D&lt; ROOT::Math::Cartesian2D&lt; double &gt;, WidthDepthReferenceTag &gt; WidthDepthProjection_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d80/PlaneGeo_8h_source.html#l00151">PlaneGeo.h:151</a></div></div>
<div class="ttc" id="classgeo_1_1WireGeo_html_ad9f0c9052fdf23f61440be0c9489943c"><div class="ttname"><a href="../../de/dce/classgeo_1_1WireGeo.html#ad9f0c9052fdf23f61440be0c9489943c">geo::WireGeo::LocalToWorld</a></div><div class="ttdeci">void LocalToWorld(const double *wire, double *world) const </div><div class="ttdoc">Transform point from local wire frame to world frame. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/de5/WireGeo_8h_source.html#l00355">WireGeo.h:355</a></div></div>
<div class="ttc" id="namespacegeo_html_aa466678f5f635eee4a8179671f3aae7eaf7e5e120c91f8fae9de103aefe12b0ca"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#aa466678f5f635eee4a8179671f3aae7eaf7e5e120c91f8fae9de103aefe12b0ca">geo::kHorizontal</a></div><div class="ttdoc">Planes that are in the horizontal plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00140">geo_types.h:140</a></div></div>
<div class="ttc" id="Exceptions_8h_html"><div class="ttname"><a href="../../df/d7c/Exceptions_8h.html">Exceptions.h</a></div><div class="ttdoc">Collection of exceptions for Geometry system. </div></div>
<div class="ttc" id="namespaceraw_html_ac59223371efaecdc5ef8389bc976a20a"><div class="ttname"><a href="../../d9/d63/namespaceraw.html#ac59223371efaecdc5ef8389bc976a20a">raw::InvalidChannelID</a></div><div class="ttdeci">constexpr ChannelID_t InvalidChannelID</div><div class="ttdoc">ID of an invalid channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d38/RawTypes_8h_source.html#l00032">RawTypes.h:32</a></div></div>
<div class="ttc" id="classgeo_1_1WireGeo_html_abe8a2d7e13862adb76df0d12558f088e"><div class="ttname"><a href="../../de/dce/classgeo_1_1WireGeo.html#abe8a2d7e13862adb76df0d12558f088e">geo::WireGeo::IntersectionWith</a></div><div class="ttdeci">Point IntersectionWith(geo::WireGeo const &amp;other) const </div><div class="ttdoc">Returns the point of this wire that is closest to other wire. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/de5/WireGeo_8h_source.html#l00637">WireGeo.h:637</a></div></div>
<div class="ttc" id="classgeo_1_1InvalidWireIDError_html_a8174e289df4013b806bd949975ef70a2"><div class="ttname"><a href="../../d2/d09/classgeo_1_1InvalidWireIDError.html#a8174e289df4013b806bd949975ef70a2">geo::InvalidWireIDError::better_wire_number</a></div><div class="ttdeci">int better_wire_number</div><div class="ttdoc">a suggestion for a good wire number </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d7c/Exceptions_8h_source.html#l00168">Exceptions.h:168</a></div></div>
<div class="ttc" id="DumpUtils_8h_html"><div class="ttname"><a href="../../d4/da9/DumpUtils_8h.html">DumpUtils.h</a></div><div class="ttdoc">Utilities to dump objects into a stream. </div></div>
<div class="ttc" id="namespacelar_1_1util_html_a9c7a66b3fecfd5e9fc64e30f3c54effb"><div class="ttname"><a href="../../d9/d3d/namespacelar_1_1util.html#a9c7a66b3fecfd5e9fc64e30f3c54effb">lar::util::makeVector3DComparison</a></div><div class="ttdeci">auto makeVector3DComparison(RealType threshold)</div><div class="ttdoc">Creates a Vector3DComparison from a RealComparisons object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dbc/RealComparisons_8h_source.html#l00252">RealComparisons.h:252</a></div></div>
<div class="ttc" id="Decomposer_8h_html"><div class="ttname"><a href="../../d8/dc6/Decomposer_8h.html">Decomposer.h</a></div><div class="ttdoc">Classes to project and compose a vector on a plane. </div></div>
<div class="ttc" id="namespacegeo_html_af668c8df9412103e6c6ddb54f23d86e4"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#af668c8df9412103e6c6ddb54f23d86e4">geo::DriftDirection_t</a></div><div class="ttdeci">enum geo::driftdir DriftDirection_t</div><div class="ttdoc">Drift direction: positive or negative. </div></div>
<div class="ttc" id="classgeo_1_1AuxDetGeo_html_af6f18a062143e4467ea430baaf1447a6"><div class="ttname"><a href="../../db/d4f/classgeo_1_1AuxDetGeo.html#af6f18a062143e4467ea430baaf1447a6">geo::AuxDetGeo::HalfHeight</a></div><div class="ttdeci">double HalfHeight() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d8a/AuxDetGeo_8h_source.html#l00105">AuxDetGeo.h:105</a></div></div>
<div class="ttc" id="geo__vectors_8h_html"><div class="ttname"><a href="../../d5/d7d/geo__vectors_8h.html">geo_vectors.h</a></div><div class="ttdoc">Definitions of geometry vector data types. </div></div>
<div class="ttc" id="classgeo_1_1WireGeo_html_a162867ce18b2425721ef51e5ea494485"><div class="ttname"><a href="../../de/dce/classgeo_1_1WireGeo.html#a162867ce18b2425721ef51e5ea494485">geo::WireGeo::RMax</a></div><div class="ttdeci">double RMax() const </div><div class="ttdoc">Returns the outer half-size of the wire [cm]. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d05/WireGeo_8cxx_source.html#l00091">WireGeo.cxx:91</a></div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_a54262556246be9d7cd55b501d860d9c1"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#a54262556246be9d7cd55b501d860d9c1">geo::PlaneGeo::WireCoordProjection_t</a></div><div class="ttdeci">ROOT::Math::DisplacementVector2D&lt; ROOT::Math::Cartesian2D&lt; double &gt;, WireCoordinateReferenceTag &gt; WireCoordProjection_t</div><div class="ttdoc">Type for projections in the wire base representation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d80/PlaneGeo_8h_source.html#l00130">PlaneGeo.h:130</a></div></div>
<div class="ttc" id="namespacegeo_html_a59a0688ea6aaa04f0ffa6451f8083ca1"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#a59a0688ea6aaa04f0ffa6451f8083ca1">geo::SigType_t</a></div><div class="ttdeci">enum geo::_plane_sigtype SigType_t</div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_ad27c155668c5d9f850334cc2e005e7aa"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#ad27c155668c5d9f850334cc2e005e7aa">geo::TPCGeo::ActiveHalfWidth</a></div><div class="ttdeci">double ActiveHalfWidth() const </div><div class="ttdoc">Half width (associated with x coordinate) of active TPC volume [cm]. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00095">TPCGeo.h:95</a></div></div>
<div class="ttc" id="namespacedetsim_html_ac17a92de25bbd84bdd320811fff947c6"><div class="ttname"><a href="../../d2/d1a/namespacedetsim.html#ac17a92de25bbd84bdd320811fff947c6">detsim::MF_LOG_WARNING</a></div><div class="ttdeci">MF_LOG_WARNING(&quot;SimWire&quot;)&lt;&lt; &quot;SimWire is an example module that works for the &quot;&lt;&lt; &quot;MicroBooNE detector. Each experiment should implement &quot;&lt;&lt; &quot;its own version of this module to simulate electronics &quot;&lt;&lt; &quot;response.&quot;</div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_a18b8035717a1111dc0bb899910c0aac0"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#a18b8035717a1111dc0bb899910c0aac0">geo::PlaneGeo::GetCenter</a></div><div class="ttdeci">Point GetCenter() const </div><div class="ttdoc">Returns the centre of the wire plane in world coordinates [cm]. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d80/PlaneGeo_8h_source.html#l00479">PlaneGeo.h:479</a></div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html">geo::PlaneGeo</a></div><div class="ttdoc">Geometry information for a single wire plane.The plane is represented in the geometry by a solid whic...</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d80/PlaneGeo_8h_source.html#l00082">PlaneGeo.h:82</a></div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_a2500e66d8a1a7aa4b40703ed049fa863"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#a2500e66d8a1a7aa4b40703ed049fa863">geo::PlaneGeo::InterWireDistance</a></div><div class="ttdeci">double InterWireDistance(geo::Vector_t const &amp;dir) const </div><div class="ttdoc">Returns the distance between wires along the specified direction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd0/PlaneGeo_8cxx_source.html#l00713">PlaneGeo.cxx:713</a></div></div>
<div class="ttc" id="namespaceicarus_1_1ns_1_1util_html_aac918da84f16d53ad17bab4f817da1c4"><div class="ttname"><a href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">icarus::ns::util::end</a></div><div class="ttdeci">auto end(FixedBins&lt; T, C &gt; const &amp;) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dbd/FixedBins_8h_source.html#l00585">FixedBins.h:585</a></div></div>
<div class="ttc" id="geo__vectors__utils_8h_html"><div class="ttname"><a href="../../d5/d6c/geo__vectors__utils_8h.html">geo_vectors_utils.h</a></div><div class="ttdoc">Utilities to extend the interface of geometry vectors. </div></div>
<div class="ttc" id="classgeo_1_1BoxBoundedGeo_html_a67f01c76c031e29c5bcc610f23a0be85"><div class="ttname"><a href="../../db/d54/classgeo_1_1BoxBoundedGeo.html#a67f01c76c031e29c5bcc610f23a0be85">geo::BoxBoundedGeo::MinZ</a></div><div class="ttdeci">double MinZ() const </div><div class="ttdoc">Returns the world z coordinate of the start of the box. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d92/BoxBoundedGeo_8h_source.html#l00118">BoxBoundedGeo.h:118</a></div></div>
<div class="ttc" id="namespaceraw_html_aa6c206cb6dd1c31d7c15f99806f9da0f"><div class="ttname"><a href="../../d9/d63/namespaceraw.html#aa6c206cb6dd1c31d7c15f99806f9da0f">raw::isValidChannelID</a></div><div class="ttdeci">constexpr bool isValidChannelID(raw::ChannelID_t channel)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d38/RawTypes_8h_source.html#l00037">RawTypes.h:37</a></div></div>
<div class="ttc" id="classgeo_1_1CryostatGeo_html_a2f01042b5618212a40a63bb4ea1ff8f2"><div class="ttname"><a href="../../de/da3/classgeo_1_1CryostatGeo.html#a2f01042b5618212a40a63bb4ea1ff8f2">geo::CryostatGeo::NTPC</a></div><div class="ttdeci">unsigned int NTPC() const </div><div class="ttdoc">Number of TPCs in this cryostat. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d13/CryostatGeo_8h_source.html#l00181">CryostatGeo.h:181</a></div></div>
<div class="ttc" id="namespacegeo_html_a62b751f7b8cee6917a9f3f83566adc0a"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#a62b751f7b8cee6917a9f3f83566adc0a">geo::Xaxis</a></div><div class="ttdeci">constexpr Vector Xaxis()</div><div class="ttdoc">Returns a x axis vector of the specified type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7d/geo__vectors_8h_source.html#l00215">geo_vectors.h:215</a></div></div>
<div class="ttc" id="structgeo_1_1WireIDIntersection_html"><div class="ttname"><a href="../../da/d3d/structgeo_1_1WireIDIntersection.html">geo::WireIDIntersection</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00803">geo_types.h:803</a></div></div>
<div class="ttc" id="classgeo_1_1AuxDetGeo_html_ae78d4eec47d921df33279d7f79bb798c"><div class="ttname"><a href="../../db/d4f/classgeo_1_1AuxDetGeo.html#ae78d4eec47d921df33279d7f79bb798c">geo::AuxDetGeo::NSensitiveVolume</a></div><div class="ttdeci">size_t NSensitiveVolume() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d8a/AuxDetGeo_8h_source.html#l00172">AuxDetGeo.h:172</a></div></div>
<div class="ttc" id="structlar_1_1util_1_1simple__geo_1_1Rectangle_html_a3b3e87af84052f0d3c6bd7c2a4ea12bf"><div class="ttname"><a href="../../d7/de4/structlar_1_1util_1_1simple__geo_1_1Rectangle.html#a3b3e87af84052f0d3c6bd7c2a4ea12bf">lar::util::simple_geo::Rectangle::width</a></div><div class="ttdeci">Range_t width</div><div class="ttdoc">Range along width direction. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d79/SimpleGeo_8h_source.html#l00393">SimpleGeo.h:393</a></div></div>
<div class="ttc" id="classgeo_1_1AuxDetGeo_html_a7a41a663624af1fc12a4690d5f8f4fa4"><div class="ttname"><a href="../../db/d4f/classgeo_1_1AuxDetGeo.html#a7a41a663624af1fc12a4690d5f8f4fa4">geo::AuxDetGeo::GetNormalVector</a></div><div class="ttdeci">geo::Vector_t GetNormalVector() const </div><div class="ttdoc">Returns the unit normal vector to the detector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd5/AuxDetGeo_8cxx_source.html#l00072">AuxDetGeo.cxx:72</a></div></div>
<div class="ttc" id="structgeo_1_1TPCID_html"><div class="ttname"><a href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a></div><div class="ttdoc">The data type to uniquely identify a TPC. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00386">geo_types.h:386</a></div></div>
<div class="ttc" id="structgeo_1_1PlaneID_html_a02c2afa6841ef86ea8ab49478cdf5b29"><div class="ttname"><a href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">geo::PlaneID::Plane</a></div><div class="ttdeci">PlaneID_t Plane</div><div class="ttdoc">Index of the plane within its TPC. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00493">geo_types.h:493</a></div></div>
<div class="ttc" id="classgeo_1_1AuxDetGeo_html"><div class="ttname"><a href="../../db/d4f/classgeo_1_1AuxDetGeo.html">geo::AuxDetGeo</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d8a/AuxDetGeo_8h_source.html#l00038">AuxDetGeo.h:38</a></div></div>
<div class="ttc" id="geo__types_8h_html"><div class="ttname"><a href="../../d8/d48/geo__types_8h.html">geo_types.h</a></div><div class="ttdoc">Definition of data types for geometry description. </div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_a8a67d792308b4298d3c782bd219e508a"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#a8a67d792308b4298d3c782bd219e508a">geo::TPCGeo::Plane0Pitch</a></div><div class="ttdeci">double Plane0Pitch(unsigned int p) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d00/TPCGeo_8cxx_source.html#l00324">TPCGeo.cxx:324</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_a37b4d0a99be8c2324273589fda87b851"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#a37b4d0a99be8c2324273589fda87b851">geo::TPCGeo::DriftDirection</a></div><div class="ttdeci">DriftDirection_t DriftDirection() const </div><div class="ttdoc">Returns an enumerator value describing the drift direction. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00144">TPCGeo.h:144</a></div></div>
<div class="ttc" id="structreadout_1_1ROPID_html"><div class="ttname"><a href="../../dd/d41/structreadout_1_1ROPID.html">readout::ROPID</a></div><div class="ttdoc">Class identifying a set of planes sharing readout channels. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d64/readout__types_8h_source.html#l00168">readout_types.h:168</a></div></div>
<div class="ttc" id="namespacegeo_html_a4234220f2d709cfac66fac07972f6242"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#a4234220f2d709cfac66fac07972f6242">geo::fComputeMass</a></div><div class="ttdeci">fComputeMass(pset.get(&quot;ComputeMass&quot;, true))</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d55/GeometryTestAlg_8cxx_source.html#l00123">GeometryTestAlg.cxx:123</a></div></div>
<div class="ttc" id="namespacegen__crt__frags_html_a8cdc67339147aad209b4122a38d7e246"><div class="ttname"><a href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">gen_crt_frags.w</a></div><div class="ttdeci">tuple w</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d8c/gen__crt__frags_8py_source.html#l01416">gen_crt_frags.py:1416</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_adf14d253e55f0968131f4d59bf218fe9"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#adf14d253e55f0968131f4d59bf218fe9">geo::TPCGeo::ActiveLength</a></div><div class="ttdeci">double ActiveLength() const </div><div class="ttdoc">Length (associated with z coordinate) of active TPC volume [cm]. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00103">TPCGeo.h:103</a></div></div>
<div class="ttc" id="classgeo_1_1WireGeo_html_a3e7aa14d29e74b735f79b176ffd6a1f8"><div class="ttname"><a href="../../de/dce/classgeo_1_1WireGeo.html#a3e7aa14d29e74b735f79b176ffd6a1f8">geo::WireGeo::Direction</a></div><div class="ttdeci">Vector Direction() const </div><div class="ttdef"><b>Definition:</b> <a href="../../da/de5/WireGeo_8h_source.html#l00587">WireGeo.h:587</a></div></div>
<div class="ttc" id="classgeo_1_1BoxBoundedGeo_html_a71626e62af098d6a8c09dd97bbf4812b"><div class="ttname"><a href="../../db/d54/classgeo_1_1BoxBoundedGeo.html#a71626e62af098d6a8c09dd97bbf4812b">geo::BoxBoundedGeo::MaxY</a></div><div class="ttdeci">double MaxY() const </div><div class="ttdoc">Returns the world y coordinate of the end of the box. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d92/BoxBoundedGeo_8h_source.html#l00106">BoxBoundedGeo.h:106</a></div></div>
<div class="ttc" id="namespacedropbox_html_a407b5b895ba9265893768748aaa73825"><div class="ttname"><a href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dropbox.dir</a></div><div class="ttdeci">tuple dir</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d81/dropbox_8py_source.html#l00028">dropbox.py:28</a></div></div>
<div class="ttc" id="AuxDetGeo_8h_html"><div class="ttname"><a href="../../d4/d8a/AuxDetGeo_8h.html">AuxDetGeo.h</a></div><div class="ttdoc">Encapsulate the geometry of an auxiliary detector. </div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_ab096479e47140e77ec1050096d446a23"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#ab096479e47140e77ec1050096d446a23">geo::PlaneGeo::Orientation</a></div><div class="ttdeci">Orient_t Orientation() const </div><div class="ttdoc">What is the orientation of the plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d80/PlaneGeo_8h_source.html#l00187">PlaneGeo.h:187</a></div></div>
<div class="ttc" id="structgeo_1_1TPCID_html_afbbfe0283793584dbbb2f2a8a1079de6"><div class="ttname"><a href="../../d2/d4d/structgeo_1_1TPCID.html#afbbfe0283793584dbbb2f2a8a1079de6">geo::TPCID::asTPCID</a></div><div class="ttdeci">constexpr TPCID const &amp; asTPCID() const </div><div class="ttdoc">Conversion to TPCID (for convenience of notation). </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00446">geo_types.h:446</a></div></div>
<div class="ttc" id="WireGeo_8h_html"><div class="ttname"><a href="../../da/de5/WireGeo_8h.html">WireGeo.h</a></div><div class="ttdoc">Encapsulate the geometry of a wire. </div></div>
<div class="ttc" id="namespaceicarus_1_1ns_1_1util_html_acc1957472e01a8d9ecd245e26338f0b9"><div class="ttname"><a href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#acc1957472e01a8d9ecd245e26338f0b9">icarus::ns::util::begin</a></div><div class="ttdeci">auto begin(FixedBins&lt; T, C &gt; const &amp;) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dbd/FixedBins_8h_source.html#l00573">FixedBins.h:573</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_a3a222b9dc08e40022cba2a0fcd194f30"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#a3a222b9dc08e40022cba2a0fcd194f30">geo::TPCGeo::HalfHeight</a></div><div class="ttdeci">double HalfHeight() const </div><div class="ttdoc">Height is associated with y coordinate [cm]. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00111">TPCGeo.h:111</a></div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_a6751f12e587b8d5c75edb63d751d10d6"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#a6751f12e587b8d5c75edb63d751d10d6">geo::PlaneGeo::DepthDir</a></div><div class="ttdeci">Vector DepthDir() const </div><div class="ttdoc">Return the direction of plane depth. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d80/PlaneGeo_8h_source.html#l00236">PlaneGeo.h:236</a></div></div>
<div class="ttc" id="classgeo_1_1WireGeo_html_a9e88c4815131ef71cf08acc7328e0624"><div class="ttname"><a href="../../de/dce/classgeo_1_1WireGeo.html#a9e88c4815131ef71cf08acc7328e0624">geo::WireGeo::HalfL</a></div><div class="ttdeci">double HalfL() const </div><div class="ttdoc">Returns half the length of the wire [cm]. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/de5/WireGeo_8h_source.html#l00128">WireGeo.h:128</a></div></div>
<div class="ttc" id="classgeo_1_1CryostatGeo_html_adbdb77e96709880e40d5d3f3a46cd2a0"><div class="ttname"><a href="../../de/da3/classgeo_1_1CryostatGeo.html#adbdb77e96709880e40d5d3f3a46cd2a0">geo::CryostatGeo::FindTPCAtPosition</a></div><div class="ttdeci">geo::TPCID::TPCID_t FindTPCAtPosition(double const worldLoc[3], double const wiggle) const </div><div class="ttdoc">Returns the index of the TPC at specified location. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d90/CryostatGeo_8cxx_source.html#l00127">CryostatGeo.cxx:127</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_a9696ac2c61e57bf62799989078d6eb87"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#a9696ac2c61e57bf62799989078d6eb87">geo::TPCGeo::DriftDistance</a></div><div class="ttdeci">double DriftDistance() const </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00155">TPCGeo.h:155</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_ad4db370e69a9f5c8f3623f8c6edfe2b3"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#ad4db370e69a9f5c8f3623f8c6edfe2b3">geo::TPCGeo::HeightDir</a></div><div class="ttdeci">decltype(auto) HeightDir() const </div><div class="ttdoc">Returns the direction Height() is measured on. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00131">TPCGeo.h:131</a></div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_a9d404b4b6c012292bd9492ca3a741d1e"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#a9d404b4b6c012292bd9492ca3a741d1e">geo::PlaneGeo::VectorProjection</a></div><div class="ttdeci">WireCoordProjection_t VectorProjection(geo::Vector_t const &amp;v) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d80/PlaneGeo_8h_source.html#l00963">PlaneGeo.h:963</a></div></div>
<div class="ttc" id="namespacegeo_html_a1b5150a78645f276a21647cc0b48fb69a540355ba5bfe18985f585e362f847483"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#a1b5150a78645f276a21647cc0b48fb69a540355ba5bfe18985f585e362f847483">geo::kPosX</a></div><div class="ttdoc">Drift towards positive X values. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00161">geo_types.h:161</a></div></div>
<div class="ttc" id="PlaneGeo_8h_html"><div class="ttname"><a href="../../d8/d80/PlaneGeo_8h.html">PlaneGeo.h</a></div><div class="ttdoc">Encapsulate the construction of a single detector plane. </div></div>
<div class="ttc" id="classgeo_1_1AuxDetGeo_html_a9b43b5f1c298977f5d4f127e020cd2a8"><div class="ttname"><a href="../../db/d4f/classgeo_1_1AuxDetGeo.html#a9b43b5f1c298977f5d4f127e020cd2a8">geo::AuxDetGeo::Length</a></div><div class="ttdeci">double Length() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d8a/AuxDetGeo_8h_source.html#l00102">AuxDetGeo.h:102</a></div></div>
<div class="ttc" id="classgeo_1_1AuxDetGeo_html_a11c1d1b633eca8ab4d49d307b3fd50fc"><div class="ttname"><a href="../../db/d4f/classgeo_1_1AuxDetGeo.html#a11c1d1b633eca8ab4d49d307b3fd50fc">geo::AuxDetGeo::Name</a></div><div class="ttdeci">std::string Name() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d8a/AuxDetGeo_8h_source.html#l00154">AuxDetGeo.h:154</a></div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_abeb00fea35a1d0fd24d5b71de6e56686"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#abeb00fea35a1d0fd24d5b71de6e56686">geo::PlaneGeo::PrintPlaneInfo</a></div><div class="ttdeci">void PrintPlaneInfo(Stream &amp;&amp;out, std::string indent=&quot;&quot;, unsigned int verbosity=1) const </div><div class="ttdoc">Prints information about this plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d80/PlaneGeo_8h_source.html#l01539">PlaneGeo.h:1539</a></div></div>
<div class="ttc" id="namespacelarg4_html_a3b23adbb58bc71f7c54806914226f1f8"><div class="ttname"><a href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">larg4::dist</a></div><div class="ttdeci">constexpr double dist(const TReal *x, const TReal *y, const unsigned int dimension)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d8a/OpFastScintillation_8hh_source.html#l00563">OpFastScintillation.hh:563</a></div></div>
<div class="ttc" id="classgeo_1_1BoxBoundedGeo_html_aafb8d64fc1f79ef0d7418b3fbebf7394"><div class="ttname"><a href="../../db/d54/classgeo_1_1BoxBoundedGeo.html#aafb8d64fc1f79ef0d7418b3fbebf7394">geo::BoxBoundedGeo::CenterY</a></div><div class="ttdeci">double CenterY() const </div><div class="ttdoc">Returns the world y coordinate of the center of the box. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d92/BoxBoundedGeo_8h_source.html#l00109">BoxBoundedGeo.h:109</a></div></div>
<div class="ttc" id="classgeo_1_1CryostatGeo_html_a15e1909a67a64f7880720a7c9ff80a64"><div class="ttname"><a href="../../de/da3/classgeo_1_1CryostatGeo.html#a15e1909a67a64f7880720a7c9ff80a64">geo::CryostatGeo::TPC</a></div><div class="ttdeci">const TPCGeo &amp; TPC(unsigned int itpc) const </div><div class="ttdoc">Return the itpc&amp;#39;th TPC in the cryostat. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d90/CryostatGeo_8cxx_source.html#l00093">CryostatGeo.cxx:93</a></div></div>
<div class="ttc" id="classgeo_1_1WireGeo_html_a23ad5f4a59ea0abdb4b3161378754b2a"><div class="ttname"><a href="../../de/dce/classgeo_1_1WireGeo.html#a23ad5f4a59ea0abdb4b3161378754b2a">geo::WireGeo::GetEnd</a></div><div class="ttdeci">void GetEnd(double *xyz) const </div><div class="ttdef"><b>Definition:</b> <a href="../../da/de5/WireGeo_8h_source.html#l00163">WireGeo.h:163</a></div></div>
<div class="ttc" id="structgeo_1_1WireIDIntersection_html_a10d38a5448d172ff4c9879e0a349fbc3"><div class="ttname"><a href="../../da/d3d/structgeo_1_1WireIDIntersection.html#a10d38a5448d172ff4c9879e0a349fbc3">geo::WireIDIntersection::y</a></div><div class="ttdeci">double y</div><div class="ttdoc">y position of intersection </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00804">geo_types.h:804</a></div></div>
<div class="ttc" id="classgeo_1_1BoxBoundedGeo_html_aff3c6d62c880e387d35ab093bdbdcffc"><div class="ttname"><a href="../../db/d54/classgeo_1_1BoxBoundedGeo.html#aff3c6d62c880e387d35ab093bdbdcffc">geo::BoxBoundedGeo::MaxZ</a></div><div class="ttdeci">double MaxZ() const </div><div class="ttdoc">Returns the world z coordinate of the end of the box. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d92/BoxBoundedGeo_8h_source.html#l00121">BoxBoundedGeo.h:121</a></div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_a9c059f407b135ec46f78688545f9d095"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#a9c059f407b135ec46f78688545f9d095">geo::PlaneGeo::ID</a></div><div class="ttdeci">geo::PlaneID const &amp; ID() const </div><div class="ttdoc">Returns the identifier of this plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d80/PlaneGeo_8h_source.html#l00203">PlaneGeo.h:203</a></div></div>
<div class="ttc" id="triggersim__eastmodule__icarus_8fcl_html_a6e6fc5a1833d744f7bd6bde59dd95323"><div class="ttname"><a href="../../dd/db4/triggersim__eastmodule__icarus_8fcl.html#a6e6fc5a1833d744f7bd6bde59dd95323">output</a></div><div class="ttdeci">BEGIN_PROLOG sequence::SlidingWindowTriggerPatternsOppositeWindows END_PROLOG simSlidingORM6O6 effSlidingORW output</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/db4/triggersim__eastmodule__icarus_8fcl_source.html#l00134">triggersim_eastmodule_icarus.fcl:134</a></div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_a0aeb7d438b1337c138277335a4e666a1"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#a0aeb7d438b1337c138277335a4e666a1">geo::PlaneGeo::Nwires</a></div><div class="ttdeci">unsigned int Nwires() const </div><div class="ttdoc">Number of wires in this plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d80/PlaneGeo_8h_source.html#l00269">PlaneGeo.h:269</a></div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_a194e03f145090c263964158661ed5c12"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#a194e03f145090c263964158661ed5c12">geo::PlaneGeo::WireIDincreasesWithZ</a></div><div class="ttdeci">bool WireIDincreasesWithZ() const </div><div class="ttdoc">Returns whether the higher z wires have higher wire ID. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd0/PlaneGeo_8cxx_source.html#l00525">PlaneGeo.cxx:525</a></div></div>
<div class="ttc" id="SimpleGeo_8h_html"><div class="ttname"><a href="../../db/d79/SimpleGeo_8h.html">SimpleGeo.h</a></div><div class="ttdoc">Some simple functions to represent geometry entities. </div></div>
<div class="ttc" id="updateVersionList_8sh_html_a067a8c1534d6da9b2c501a6cf4ef89bd"><div class="ttname"><a href="../../d4/dca/updateVersionList_8sh.html#a067a8c1534d6da9b2c501a6cf4ef89bd">e</a></div><div class="ttdeci">do i e</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/updateVersionList_8sh_source.html#l00068">updateVersionList.sh:68</a></div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_a07e3bb39c18911d0f71e45f1c0c0fe0f"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#a07e3bb39c18911d0f71e45f1c0c0fe0f">geo::PlaneGeo::WidthDir</a></div><div class="ttdeci">Vector WidthDir() const </div><div class="ttdoc">Return the direction of plane width. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d80/PlaneGeo_8h_source.html#l00221">PlaneGeo.h:221</a></div></div>
<div class="ttc" id="RangeForWrapper__test_8cc_html_a2a47a7f29f0ddd7ff5d68f8aff63125c"><div class="ttname"><a href="../../d6/dd6/RangeForWrapper__test_8cc.html#a2a47a7f29f0ddd7ff5d68f8aff63125c">copy</a></div><div class="ttdeci">T copy(T const &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd6/RangeForWrapper__test_8cc_source.html#l00098">RangeForWrapper_test.cc:98</a></div></div>
<div class="ttc" id="structgeo_1_1WireID_html_a51daaae3404ddba50f4585a9820e751f"><div class="ttname"><a href="../../de/db1/structgeo_1_1WireID.html#a51daaae3404ddba50f4585a9820e751f">geo::WireID::WireID_t</a></div><div class="ttdeci">unsigned int WireID_t</div><div class="ttdoc">Type for the ID number. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00561">geo_types.h:561</a></div></div>
<div class="ttc" id="trackfinderalgorithms_8fcl_html_abfae2e504dfa44c403614b6cd601f99e"><div class="ttname"><a href="../../d2/dbd/trackfinderalgorithms_8fcl.html#abfae2e504dfa44c403614b6cd601f99e">angle</a></div><div class="ttdeci">finds tracks best matching by angle</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dbd/trackfinderalgorithms_8fcl_source.html#l00064">trackfinderalgorithms.fcl:64</a></div></div>
<div class="ttc" id="classgeo_1_1InvalidWireIDError_html"><div class="ttname"><a href="../../d2/d09/classgeo_1_1InvalidWireIDError.html">geo::InvalidWireIDError</a></div><div class="ttdoc">Exception thrown on invalid wire number (e.g. NearestWireID()) </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d7c/Exceptions_8h_source.html#l00158">Exceptions.h:158</a></div></div>
<div class="ttc" id="namespacegeo_html_aa4f783454188451d17d280826922c2e9"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#aa4f783454188451d17d280826922c2e9">geo::ProjectToBoxEdge</a></div><div class="ttdeci">void ProjectToBoxEdge(const double xyz[], const double dxyz[], double xlo, double xhi, double ylo, double yhi, double zlo, double zhi, double xyzout[])</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/geo_8h_source.html#l00049">geo.h:49</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_a411eea9dd765636914a618ded267558c"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#a411eea9dd765636914a618ded267558c">geo::TPCGeo::Plane</a></div><div class="ttdeci">PlaneGeo const &amp; Plane(geo::View_t view) const </div><div class="ttdoc">Return the plane in the tpc with View_t view. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d00/TPCGeo_8cxx_source.html#l00263">TPCGeo.cxx:263</a></div></div>
<div class="ttc" id="classgeo_1_1AuxDetGeo_html_a3695a57d255e0d43833291e520fb4ecb"><div class="ttname"><a href="../../db/d4f/classgeo_1_1AuxDetGeo.html#a3695a57d255e0d43833291e520fb4ecb">geo::AuxDetGeo::HalfWidth1</a></div><div class="ttdeci">double HalfWidth1() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d8a/AuxDetGeo_8h_source.html#l00103">AuxDetGeo.h:103</a></div></div>
<div class="ttc" id="classgeo_1_1WireGeo_html_a967f3f96296bf6953f8405ac4e5e7427"><div class="ttname"><a href="../../de/dce/classgeo_1_1WireGeo.html#a967f3f96296bf6953f8405ac4e5e7427">geo::WireGeo::GetCenter</a></div><div class="ttdeci">void GetCenter(double *xyz, double localz=0.0) const </div><div class="ttdoc">Fills the world coordinate of a point on the wire. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d05/WireGeo_8cxx_source.html#l00073">WireGeo.cxx:73</a></div></div>
<div class="ttc" id="IntegerRanges__test_8cc_html_abbc7e5f346bfa932ca51b4b07ccef76d"><div class="ttname"><a href="../../db/df5/IntegerRanges__test_8cc.html#abbc7e5f346bfa932ca51b4b07ccef76d">count</a></div><div class="ttdeci">std::size_t count(Cont const &amp;cont)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df5/IntegerRanges__test_8cc_source.html#l00029">IntegerRanges_test.cc:29</a></div></div>
<div class="ttc" id="namespaceraw_html_abfe7badfcad7fe0e9474829fbd1408b2"><div class="ttname"><a href="../../d9/d63/namespaceraw.html#abfe7badfcad7fe0e9474829fbd1408b2">raw::ChannelID_t</a></div><div class="ttdeci">unsigned int ChannelID_t</div><div class="ttdoc">Type representing the ID of a readout channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d38/RawTypes_8h_source.html#l00028">RawTypes.h:28</a></div></div>
<div class="ttc" id="structgeo_1_1TPCID_html_a4a7f86b46d9d48a040b7ef5d65973811"><div class="ttname"><a href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">geo::TPCID::TPC</a></div><div class="ttdeci">TPCID_t TPC</div><div class="ttdoc">Index of the TPC within its cryostat. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00406">geo_types.h:406</a></div></div>
<div class="ttc" id="PhysicalConstants_8h_html"><div class="ttname"><a href="../../dd/d09/PhysicalConstants_8h.html">PhysicalConstants.h</a></div><div class="ttdoc">Collection of Physical constants used in LArSoft. </div></div>
<div class="ttc" id="classgeo_1_1AuxDetSensitiveGeo_html"><div class="ttname"><a href="../../d5/df8/classgeo_1_1AuxDetSensitiveGeo.html">geo::AuxDetSensitiveGeo</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d42/AuxDetSensitiveGeo_8h_source.html#l00034">AuxDetSensitiveGeo.h:34</a></div></div>
<div class="ttc" id="namespacelib_1_1dedx_html_a62b15446ae03a5857d5e03fa30b03fd4"><div class="ttname"><a href="../../d3/d5d/namespacelib_1_1dedx.html#a62b15446ae03a5857d5e03fa30b03fd4">lib.dedx.A</a></div><div class="ttdeci">float A</div><div class="ttdef"><b>Definition:</b> <a href="../../df/df9/dedx_8py_source.html#l00137">dedx.py:137</a></div></div>
<div class="ttc" id="namespacegeo_html_a5a6f22c2aa9d0ccf6ca08bf2773a0541"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#a5a6f22c2aa9d0ccf6ca08bf2773a0541">geo::Point_t</a></div><div class="ttdeci">ROOT::Math::PositionVector3D&lt; ROOT::Math::Cartesian3D&lt; double &gt;, ROOT::Math::GlobalCoordinateSystemTag &gt; Point_t</div><div class="ttdoc">Type for representation of position in physical 3D space. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7d/geo__vectors_8h_source.html#l00184">geo_vectors.h:184</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_a5a41751322380e4a0c33b6bb30489f28"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#a5a41751322380e4a0c33b6bb30489f28">geo::TPCGeo::MaxVerbosity</a></div><div class="ttdeci">static constexpr unsigned int MaxVerbosity</div><div class="ttdoc">Maximum verbosity supported by PrintTPCInfo(). </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00677">TPCGeo.h:677</a></div></div>
<div class="ttc" id="classgeo_1_1BoxBoundedGeo_html_abc0cab4f0fcd826d11aaa8b3dfb2de02"><div class="ttname"><a href="../../db/d54/classgeo_1_1BoxBoundedGeo.html#abc0cab4f0fcd826d11aaa8b3dfb2de02">geo::BoxBoundedGeo::MinY</a></div><div class="ttdeci">double MinY() const </div><div class="ttdoc">Returns the world y coordinate of the start of the box. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d92/BoxBoundedGeo_8h_source.html#l00103">BoxBoundedGeo.h:103</a></div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_a0aeb98121edff8b3db2151baaa2d2ca7"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#a0aeb98121edff8b3db2151baaa2d2ca7">geo::PlaneGeo::ComposeVector</a></div><div class="ttdeci">Vector ComposeVector(WireDecomposedVector_t const &amp;decomp) const </div><div class="ttdoc">Returns the 3D vector from composition of projection and distance. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d80/PlaneGeo_8h_source.html#l00982">PlaneGeo.h:982</a></div></div>
<div class="ttc" id="classlar_1_1example_1_1CheatTrack_html_ad5c74ca7059340da77c10d9ba1b01601"><div class="ttname"><a href="../../df/da7/classlar_1_1example_1_1CheatTrack.html#ad5c74ca7059340da77c10d9ba1b01601">lar::example::CheatTrack::operator&lt;&lt;</a></div><div class="ttdeci">std::ostream &amp; operator&lt;&lt;(std::ostream &amp;out, lar::example::CheatTrack const &amp;track)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d90/CheatTrack_8h_source.html#l00153">CheatTrack.h:153</a></div></div>
<div class="ttc" id="namespaceSortModuleTimes_html_ad3d2eae5365f1777514bf8e73b50a9a2"><div class="ttname"><a href="../../d7/d8e/namespaceSortModuleTimes.html#ad3d2eae5365f1777514bf8e73b50a9a2">SortModuleTimes.nErrors</a></div><div class="ttdeci">int nErrors</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df3/SortModuleTimes_8py_source.html#l00897">SortModuleTimes.py:897</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_a3f663d96f6fe0ad88a84fa7dd0c9fc77"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#a3f663d96f6fe0ad88a84fa7dd0c9fc77">geo::TPCGeo::LocalToWorld</a></div><div class="ttdeci">void LocalToWorld(const double *tpc, double *world) const </div><div class="ttdoc">Transform point from local TPC frame to world frame. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00563">TPCGeo.h:563</a></div></div>
<div class="ttc" id="classgeo_1_1WireGeo_html_a71da85277bdfa6b70894d3b32bb4a179"><div class="ttname"><a href="../../de/dce/classgeo_1_1WireGeo.html#a71da85277bdfa6b70894d3b32bb4a179">geo::WireGeo::RMin</a></div><div class="ttdeci">double RMin() const </div><div class="ttdoc">Returns the inner radius of the wire (usually 0) [cm]. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d05/WireGeo_8cxx_source.html#l00095">WireGeo.cxx:95</a></div></div>
<div class="ttc" id="classgeo_1_1AuxDetSensitiveGeo_html_a4021fd1394c3f5c41288aaf2062530b9"><div class="ttname"><a href="../../d5/df8/classgeo_1_1AuxDetSensitiveGeo.html#a4021fd1394c3f5c41288aaf2062530b9">geo::AuxDetSensitiveGeo::GetCenter</a></div><div class="ttdeci">void GetCenter(double *xyz, double localz=0.0) const </div><div class="ttdoc">Return the center position of an AuxDet. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d2a/AuxDetSensitiveGeo_8cxx_source.html#l00047">AuxDetSensitiveGeo.cxx:47</a></div></div>
<div class="ttc" id="test__associatedgroupswithleft__full_8fcl_html_a4814f2598ed6acdb806473d732f33889"><div class="ttname"><a href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a></div><div class="ttdeci">physics associatedGroupsWithLeft p1</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dab/test__associatedgroupswithleft__full_8fcl_source.html#l00024">test_associatedgroupswithleft_full.fcl:24</a></div></div>
<div class="ttc" id="messageservice_8fcl_html_a6699b4dbd72f548e48d81c88697d35a6"><div class="ttname"><a href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">cout</a></div><div class="ttdeci">BEGIN_PROLOG could also be cout</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/df5/messageservice_8fcl_source.html#l00010">messageservice.fcl:10</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_a7ced3f8c920172d2b77f3d010cec6c1f"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#a7ced3f8c920172d2b77f3d010cec6c1f">geo::TPCGeo::HalfWidth</a></div><div class="ttdeci">double HalfWidth() const </div><div class="ttdoc">Width is associated with x coordinate [cm]. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00107">TPCGeo.h:107</a></div></div>
<div class="ttc" id="runFilesFromSAM_8sh_html_a9cafae22b6225844ee0cdf5ea57176ff"><div class="ttname"><a href="../../d0/d8f/runFilesFromSAM_8sh.html#a9cafae22b6225844ee0cdf5ea57176ff">Stream</a></div><div class="ttdeci">bnb BNB Stream</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8f/runFilesFromSAM_8sh_source.html#l00262">runFilesFromSAM.sh:262</a></div></div>
<div class="ttc" id="namespacegeo_html_a6155d04d62c8bb11135137324ab26b5c"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#a6155d04d62c8bb11135137324ab26b5c">geo::origin</a></div><div class="ttdeci">constexpr Point origin()</div><div class="ttdoc">Returns a origin position with a point of the specified type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7d/geo__vectors_8h_source.html#l00227">geo_vectors.h:227</a></div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_abbb4a8a4b112ec8e24cc970a40e8b592"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#abbb4a8a4b112ec8e24cc970a40e8b592">geo::PlaneGeo::WirePitch</a></div><div class="ttdeci">double WirePitch() const </div><div class="ttdoc">Return the wire pitch (in centimeters). It is assumed constant. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d80/PlaneGeo_8h_source.html#l00411">PlaneGeo.h:411</a></div></div>
<div class="ttc" id="structlar_1_1util_1_1simple__geo_1_1Range_html_a496c1aa1afb42b516a1f615f8f931a22"><div class="ttname"><a href="../../d1/df7/structlar_1_1util_1_1simple__geo_1_1Range.html#a496c1aa1afb42b516a1f615f8f931a22">lar::util::simple_geo::Range::length</a></div><div class="ttdeci">Data_t length() const </div><div class="ttdoc">Returns the distance between upper and lower bounds. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d79/SimpleGeo_8h_source.html#l00341">SimpleGeo.h:341</a></div></div>
<div class="ttc" id="TPCGeo_8h_html"><div class="ttname"><a href="../../df/de9/TPCGeo_8h.html">TPCGeo.h</a></div><div class="ttdoc">Encapsulate the construction of a single detector plane. </div></div>
<div class="ttc" id="structgeo_1_1CryostatID_html"><div class="ttname"><a href="../../d9/d73/structgeo_1_1CryostatID.html">geo::CryostatID</a></div><div class="ttdoc">The data type to uniquely identify a cryostat. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00190">geo_types.h:190</a></div></div>
<div class="ttc" id="classgeo_1_1AuxDetGeo_html_ad07cad0da74717282f501930c0dcdc95"><div class="ttname"><a href="../../db/d4f/classgeo_1_1AuxDetGeo.html#ad07cad0da74717282f501930c0dcdc95">geo::AuxDetGeo::GetCenter</a></div><div class="ttdeci">void GetCenter(double *xyz, double localz=0.0) const </div><div class="ttdoc">Return the center position of an AuxDet. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd5/AuxDetGeo_8cxx_source.html#l00062">AuxDetGeo.cxx:62</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_aa674c11a62557a8aa9fac14c27af6c80"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#aa674c11a62557a8aa9fac14c27af6c80">geo::TPCGeo::WidthDir</a></div><div class="ttdeci">decltype(auto) WidthDir() const </div><div class="ttdoc">Returns the direction Width() is measured on. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00124">TPCGeo.h:124</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
