<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>icarus_tool::BaselineStandard Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="../../hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="../../functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../da/d1c/namespaceicarus__tool.html">icarus_tool</a></li><li class="navelem"><a class="el" href="../../d0/d8e/classicarus__tool_1_1BaselineStandard.html">BaselineStandard</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="../../df/db0/classicarus__tool_1_1BaselineStandard-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">icarus_tool::BaselineStandard Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for icarus_tool::BaselineStandard:</div>
<div class="dyncontent">
 <div class="center">
  <img src="../../d0/d8e/classicarus__tool_1_1BaselineStandard.png" usemap="#icarus_tool::BaselineStandard_map" alt=""/>
  <map id="icarus_tool::BaselineStandard_map" name="icarus_tool::BaselineStandard_map">
<area href="../../d4/d0d/classicarus__tool_1_1IBaseline.html" alt="icarus_tool::IBaseline" shape="rect" coords="0,0,179,24"/>
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a44b2f8b2a2b392eb86a4daee4e04382f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d8e/classicarus__tool_1_1BaselineStandard.html#a44b2f8b2a2b392eb86a4daee4e04382f">BaselineStandard</a> (const fhicl::ParameterSet &amp;pset)</td></tr>
<tr class="separator:a44b2f8b2a2b392eb86a4daee4e04382f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1ff13e9a6fcd5d512b02b70e61b6b45"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d8e/classicarus__tool_1_1BaselineStandard.html#af1ff13e9a6fcd5d512b02b70e61b6b45">~BaselineStandard</a> ()</td></tr>
<tr class="separator:af1ff13e9a6fcd5d512b02b70e61b6b45"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf836abaaf16f5d1e30f5ba2b1fe166e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d8e/classicarus__tool_1_1BaselineStandard.html#acf836abaaf16f5d1e30f5ba2b1fe166e">configure</a> (const fhicl::ParameterSet &amp;pset) override</td></tr>
<tr class="separator:acf836abaaf16f5d1e30f5ba2b1fe166e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4eaf7a37165f00f6d04fd1901c505a97"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d8e/classicarus__tool_1_1BaselineStandard.html#a4eaf7a37165f00f6d04fd1901c505a97">outputHistograms</a> (art::TFileDirectory &amp;) const override</td></tr>
<tr class="separator:a4eaf7a37165f00f6d04fd1901c505a97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4cf61e3271184173256eccab52b722f"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d8e/classicarus__tool_1_1BaselineStandard.html#af4cf61e3271184173256eccab52b722f">GetBaseline</a> (std::vector&lt; float &gt; const &amp;, <a class="el" href="../../d9/d63/namespaceraw.html#abfe7badfcad7fe0e9474829fbd1408b2">raw::ChannelID_t</a>, size_t, size_t) const override</td></tr>
<tr class="separator:af4cf61e3271184173256eccab52b722f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classicarus__tool_1_1IBaseline"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classicarus__tool_1_1IBaseline')"><img src="../../closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="../../d4/d0d/classicarus__tool_1_1IBaseline.html">icarus_tool::IBaseline</a></td></tr>
<tr class="memitem:ac87fefbcbc6b6da6c7c02f5dcbd53d73 inherit pub_methods_classicarus__tool_1_1IBaseline"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d0d/classicarus__tool_1_1IBaseline.html#ac87fefbcbc6b6da6c7c02f5dcbd53d73">~IBaseline</a> () noexcept=<a class="el" href="../../de/d36/crtt0matchingalg__sbnd_8fcl.html#a6c2384a9e3f7a8c21ae6f762a8ee0ece">default</a></td></tr>
<tr class="separator:ac87fefbcbc6b6da6c7c02f5dcbd53d73 inherit pub_methods_classicarus__tool_1_1IBaseline"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a153a60f06be4628299dfec1beaa54287"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d8e/classicarus__tool_1_1BaselineStandard.html#a153a60f06be4628299dfec1beaa54287">fNumBinsToAverage</a></td></tr>
<tr class="separator:a153a60f06be4628299dfec1beaa54287"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3ae1b332dc96477e4cd6abc482aa5b9"><td class="memItemLeft" align="right" valign="top">art::ServiceHandle<br class="typebreak"/>
&lt; <a class="el" href="../../d4/db4/classicarusutil_1_1SignalShapingICARUSService.html">icarusutil::SignalShapingICARUSService</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d8e/classicarus__tool_1_1BaselineStandard.html#ab3ae1b332dc96477e4cd6abc482aa5b9">fSignalShaping</a></td></tr>
<tr class="separator:ab3ae1b332dc96477e4cd6abc482aa5b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="../../d4/dcc/BaselineStandard__tool_8cc_source.html#l00023">23</a> of file <a class="el" href="../../d4/dcc/BaselineStandard__tool_8cc_source.html">BaselineStandard_tool.cc</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a44b2f8b2a2b392eb86a4daee4e04382f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">icarus_tool::BaselineStandard::BaselineStandard </td>
          <td>(</td>
          <td class="paramtype">const fhicl::ParameterSet &amp;&#160;</td>
          <td class="paramname"><em>pset</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/dcc/BaselineStandard__tool_8cc_source.html#l00044">44</a> of file <a class="el" href="../../d4/dcc/BaselineStandard__tool_8cc_source.html">BaselineStandard_tool.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;{</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <a class="code" href="../../d0/d8e/classicarus__tool_1_1BaselineStandard.html#acf836abaaf16f5d1e30f5ba2b1fe166e">configure</a>(pset);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;}</div>
<div class="ttc" id="classicarus__tool_1_1BaselineStandard_html_acf836abaaf16f5d1e30f5ba2b1fe166e"><div class="ttname"><a href="../../d0/d8e/classicarus__tool_1_1BaselineStandard.html#acf836abaaf16f5d1e30f5ba2b1fe166e">icarus_tool::BaselineStandard::configure</a></div><div class="ttdeci">void configure(const fhicl::ParameterSet &amp;pset) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dcc/BaselineStandard__tool_8cc_source.html#l00053">BaselineStandard_tool.cc:53</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af1ff13e9a6fcd5d512b02b70e61b6b45"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">icarus_tool::BaselineStandard::~BaselineStandard </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/dcc/BaselineStandard__tool_8cc_source.html#l00049">49</a> of file <a class="el" href="../../d4/dcc/BaselineStandard__tool_8cc_source.html">BaselineStandard_tool.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;{</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="acf836abaaf16f5d1e30f5ba2b1fe166e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void icarus_tool::BaselineStandard::configure </td>
          <td>(</td>
          <td class="paramtype">const fhicl::ParameterSet &amp;&#160;</td>
          <td class="paramname"><em>pset</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d4/d0d/classicarus__tool_1_1IBaseline.html#aeadb4b89a574809c88477921dbc3b21a">icarus_tool::IBaseline</a>.</p>

<p>Definition at line <a class="el" href="../../d4/dcc/BaselineStandard__tool_8cc_source.html#l00053">53</a> of file <a class="el" href="../../d4/dcc/BaselineStandard__tool_8cc_source.html">BaselineStandard_tool.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;{</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="comment">// Start by recovering the parameters</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="../../d0/d8e/classicarus__tool_1_1BaselineStandard.html#a153a60f06be4628299dfec1beaa54287">fNumBinsToAverage</a> = pset.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NumBinsToAverage&quot;</span>, 20);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">// Get signal shaping service.</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="../../d0/d8e/classicarus__tool_1_1BaselineStandard.html#ab3ae1b332dc96477e4cd6abc482aa5b9">fSignalShaping</a> = art::ServiceHandle&lt;icarusutil::SignalShapingICARUSService&gt;();</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;}</div>
<div class="ttc" id="classicarus__tool_1_1BaselineStandard_html_ab3ae1b332dc96477e4cd6abc482aa5b9"><div class="ttname"><a href="../../d0/d8e/classicarus__tool_1_1BaselineStandard.html#ab3ae1b332dc96477e4cd6abc482aa5b9">icarus_tool::BaselineStandard::fSignalShaping</a></div><div class="ttdeci">art::ServiceHandle&lt; icarusutil::SignalShapingICARUSService &gt; fSignalShaping</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dcc/BaselineStandard__tool_8cc_source.html#l00039">BaselineStandard_tool.cc:39</a></div></div>
<div class="ttc" id="classicarus__tool_1_1BaselineStandard_html_a153a60f06be4628299dfec1beaa54287"><div class="ttname"><a href="../../d0/d8e/classicarus__tool_1_1BaselineStandard.html#a153a60f06be4628299dfec1beaa54287">icarus_tool::BaselineStandard::fNumBinsToAverage</a></div><div class="ttdeci">int fNumBinsToAverage</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dcc/BaselineStandard__tool_8cc_source.html#l00037">BaselineStandard_tool.cc:37</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af4cf61e3271184173256eccab52b722f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float icarus_tool::BaselineStandard::GetBaseline </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; float &gt; const &amp;&#160;</td>
          <td class="paramname"><em>holder</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/d63/namespaceraw.html#abfe7badfcad7fe0e9474829fbd1408b2">raw::ChannelID_t</a>&#160;</td>
          <td class="paramname"><em>channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>roiStart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>roiLen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d4/d0d/classicarus__tool_1_1IBaseline.html#adb86cdd195b8979224b216cd40c96d40">icarus_tool::IBaseline</a>.</p>

<p>Definition at line <a class="el" href="../../d4/dcc/BaselineStandard__tool_8cc_source.html#l00065">65</a> of file <a class="el" href="../../d4/dcc/BaselineStandard__tool_8cc_source.html">BaselineStandard_tool.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;{</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordtype">float</span> base=0;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">//1. Check Baseline match?</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">// If not, include next ROI(if none, go to the end of signal)</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">// If yes, proceed</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordtype">size_t</span> nBinsToAve(<a class="code" href="../../d0/d8e/classicarus__tool_1_1BaselineStandard.html#a153a60f06be4628299dfec1beaa54287">fNumBinsToAverage</a>);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordtype">size_t</span> roiStop(roiStart + roiLen);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordtype">size_t</span> newRoiStart(roiStart);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordtype">size_t</span> newRoiStop(roiStop);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordtype">size_t</span> nTries(4);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// Calculate baslines from the very front of the deconvolution buffer and from the end</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordtype">float</span>  basePre  = std::accumulate(holder.begin() + roiStart, holder.begin() + roiStart + nBinsToAve, 0.) / float(nBinsToAve);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordtype">float</span>  basePost = std::accumulate(holder.begin() + roiStop - nBinsToAve, holder.begin() + roiStop,   0.) / float(nBinsToAve);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">// emulate method for refining baseline from original version of CalWireROI</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordtype">float</span> deconNoise = 1.26491 * <a class="code" href="../../d0/d8e/classicarus__tool_1_1BaselineStandard.html#ab3ae1b332dc96477e4cd6abc482aa5b9">fSignalShaping</a>-&gt;GetDeconNoise(channel);    <span class="comment">// 4./sqrt(10) * noise</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">// If the estimated baseline from the front of the roi does not agree well with that from the end</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">// of the roi then we&#39;ll extend the roi hoping for good agreement</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordflow">while</span>(!(fabs(basePre - basePost) &lt; deconNoise) &amp;&amp; nTries++ &lt; 3)</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="keywordtype">size_t</span> nBinsToAdd(10);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordflow">if</span> (newRoiStart &lt; nBinsToAdd)                newRoiStart  = 0;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="keywordflow">else</span>                                         newRoiStart -= nBinsToAdd;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordflow">if</span> (newRoiStop + nBinsToAdd &gt; holder.size()) newRoiStop   = holder.size();</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="keywordflow">else</span>                                         newRoiStop  += nBinsToAdd;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        basePre  = std::accumulate(holder.begin() + newRoiStart, holder.begin() + newRoiStart + nBinsToAve, 0.) / float(nBinsToAve);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        basePost = std::accumulate(holder.begin() + newRoiStop - nBinsToAve, holder.begin() + newRoiStop,   0.) / float(nBinsToAve);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    }</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment">// get spread in &quot;pre&quot; baseline</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keywordtype">float</span> maxPre = *std::max_element(holder.begin() + roiStart, holder.begin() + roiStart + nBinsToAve);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordtype">float</span> minPre = *std::min_element(holder.begin() + roiStart, holder.begin() + roiStart + nBinsToAve);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">// Basically, we are hoping for a relatively smooth &quot;front porch&quot; for the waveform</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordflow">if</span> ((maxPre - minPre) &lt; 4.) base = basePre;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="comment">// No success... see if the &quot;back porch&quot; is smooth</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keywordtype">size_t</span> roiStop = roiStart + roiLen;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="keywordtype">float</span> maxPost = *std::max_element(holder.begin() + roiStop - nBinsToAve, holder.begin() + roiStop);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordtype">float</span> minPost = *std::min_element(holder.begin() + roiStop - nBinsToAve, holder.begin() + roiStop);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="keywordflow">if</span> ((maxPost - minPost) &lt; 4.) base = basePost;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="comment">// Starting to get desparate...</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((maxPre  - minPre)  &lt; 8. &amp;&amp; std::fabs(basePre)  &lt; std::fabs(basePost)) base = basePre;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((maxPost - minPost) &lt; 8. &amp;&amp; std::fabs(basePost) &lt; std::fabs(basePre))  base = basePost;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="comment">// Ok, apply brute force</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        {</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            <span class="keywordtype">float</span> min = *std::min_element(holder.begin()+roiStart,holder.begin()+roiStart+roiLen);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">max</a> = *std::max_element(holder.begin()+roiStart,holder.begin()+roiStart+roiLen);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            <span class="keywordtype">int</span> nbin = std::ceil(max - min);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            <span class="keywordflow">if</span> (nbin &gt; 0){</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                TH1F *h1 = <span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;h1&quot;</span>,<span class="stringliteral">&quot;h1&quot;</span>,nbin,min,max);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#a512aa20fb28b8c00f3d290ba176b40e1">bin</a> = roiStart; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#a512aa20fb28b8c00f3d290ba176b40e1">bin</a> &lt; roiStart+roiLen; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#a512aa20fb28b8c00f3d290ba176b40e1">bin</a>++){</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                    h1-&gt;Fill(holder[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#a512aa20fb28b8c00f3d290ba176b40e1">bin</a>]);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                }</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                <span class="keywordtype">int</span>   pedBin = h1-&gt;GetMaximumBin();</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                <span class="keywordtype">float</span> ped    = h1-&gt;GetBinCenter(pedBin);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                <span class="keywordtype">float</span> ave=0,ncount = 0;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#a512aa20fb28b8c00f3d290ba176b40e1">bin</a> = roiStart; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#a512aa20fb28b8c00f3d290ba176b40e1">bin</a> &lt; roiStart+roiLen; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#a512aa20fb28b8c00f3d290ba176b40e1">bin</a>++){</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                    <span class="keywordflow">if</span> (fabs(holder[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#a512aa20fb28b8c00f3d290ba176b40e1">bin</a>]-ped)&lt;2){</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                        ave +=holder[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#a512aa20fb28b8c00f3d290ba176b40e1">bin</a>];</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                        ncount ++;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                    }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                }</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                <span class="keywordflow">if</span> (ncount==0) ncount=1;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                ave = ave/ncount;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                h1-&gt;Delete();</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                base = ave;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        }</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    }</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordflow">return</span> base;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;}</div>
<div class="ttc" id="pmttriggerproducer_8fcl_html_a527d89be40c3c20ca8162df059180fd9"><div class="ttname"><a href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">max</a></div><div class="ttdeci">BEGIN_PROLOG pmt_uncoated ideal single PE test page of manual option are OR or AND window for pmt trigger time start window for pmt trigger time end etc then what events all hists are saved for max</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5a/pmttriggerproducer_8fcl_source.html#l00023">pmttriggerproducer.fcl:23</a></div></div>
<div class="ttc" id="namespaceicarus_1_1ns_1_1util_html_a512aa20fb28b8c00f3d290ba176b40e1"><div class="ttname"><a href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#a512aa20fb28b8c00f3d290ba176b40e1">icarus::ns::util::bin</a></div><div class="ttdeci">constexpr details::BinObj&lt; T &gt; bin(T value)</div><div class="ttdoc">Returns a wrapper to print the specified data in binary format. </div></div>
<div class="ttc" id="classicarus__tool_1_1BaselineStandard_html_ab3ae1b332dc96477e4cd6abc482aa5b9"><div class="ttname"><a href="../../d0/d8e/classicarus__tool_1_1BaselineStandard.html#ab3ae1b332dc96477e4cd6abc482aa5b9">icarus_tool::BaselineStandard::fSignalShaping</a></div><div class="ttdeci">art::ServiceHandle&lt; icarusutil::SignalShapingICARUSService &gt; fSignalShaping</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dcc/BaselineStandard__tool_8cc_source.html#l00039">BaselineStandard_tool.cc:39</a></div></div>
<div class="ttc" id="classicarus__tool_1_1BaselineStandard_html_a153a60f06be4628299dfec1beaa54287"><div class="ttname"><a href="../../d0/d8e/classicarus__tool_1_1BaselineStandard.html#a153a60f06be4628299dfec1beaa54287">icarus_tool::BaselineStandard::fNumBinsToAverage</a></div><div class="ttdeci">int fNumBinsToAverage</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dcc/BaselineStandard__tool_8cc_source.html#l00037">BaselineStandard_tool.cc:37</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4eaf7a37165f00f6d04fd1901c505a97"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void icarus_tool::BaselineStandard::outputHistograms </td>
          <td>(</td>
          <td class="paramtype">art::TFileDirectory &amp;&#160;</td>
          <td class="paramname"><em>histDir</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d4/d0d/classicarus__tool_1_1IBaseline.html#a935c241a213ee80ed61cda9088d7d0bf">icarus_tool::IBaseline</a>.</p>

<p>Definition at line <a class="el" href="../../d4/dcc/BaselineStandard__tool_8cc_source.html#l00151">151</a> of file <a class="el" href="../../d4/dcc/BaselineStandard__tool_8cc_source.html">BaselineStandard_tool.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;{</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="comment">// It is assumed that the input TFileDirectory has been set up to group histograms into a common</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="comment">// folder at the calling routine&#39;s level. Here we create one more level of indirection to keep</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="comment">// histograms made by this tool separate.</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">    std::string dirName = &quot;BaselinePlane_&quot; + std::to_string(fPlane);</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">    art::TFileDirectory dir = histDir.mkdir(dirName.c_str());</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">    auto const* detprop      = lar::providerFrom&lt;detinfo::DetectorPropertiesService&gt;();</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">    double      samplingRate = detprop-&gt;SamplingRate();</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">    double      numBins      = fBaselineVec.size();</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">    double      maxFreq      = 500. / samplingRate;</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">    std::string histName     = &quot;BaselinePlane_&quot; + std::to_string(fPlane);</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">    TH1D*       hist         = dir.make&lt;TH1D&gt;(histName.c_str(), &quot;Baseline;Frequency(MHz)&quot;, numBins, 0., maxFreq);</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">    for(int bin = 0; bin &lt; numBins; bin++)</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">        double freq = maxFreq * double(bin + 0.5) / double(numBins);</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">        </span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">        hist-&gt;Fill(freq, fBaselineVec.at(bin).Re());</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a153a60f06be4628299dfec1beaa54287"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int icarus_tool::BaselineStandard::fNumBinsToAverage</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/dcc/BaselineStandard__tool_8cc_source.html#l00037">37</a> of file <a class="el" href="../../d4/dcc/BaselineStandard__tool_8cc_source.html">BaselineStandard_tool.cc</a>.</p>

</div>
</div>
<a class="anchor" id="ab3ae1b332dc96477e4cd6abc482aa5b9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">art::ServiceHandle&lt;<a class="el" href="../../d4/db4/classicarusutil_1_1SignalShapingICARUSService.html">icarusutil::SignalShapingICARUSService</a>&gt; icarus_tool::BaselineStandard::fSignalShaping</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/dcc/BaselineStandard__tool_8cc_source.html#l00039">39</a> of file <a class="el" href="../../d4/dcc/BaselineStandard__tool_8cc_source.html">BaselineStandard_tool.cc</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="../../d4/dcc/BaselineStandard__tool_8cc_source.html">BaselineStandard_tool.cc</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
