<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>icarus::opdet::PMTsimulationAlg Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="../../hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="../../functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../da/d4d/namespaceicarus.html">icarus</a></li><li class="navelem"><a class="el" href="../../dc/df0/namespaceicarus_1_1opdet.html">opdet</a></li><li class="navelem"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html">PMTsimulationAlg</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-static-methods">Static Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a> &#124;
<a href="../../de/dd0/classicarus_1_1opdet_1_1PMTsimulationAlg-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">icarus::opdet::PMTsimulationAlg Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Algorithm class for the full simulation of PMT channels.  
 <a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html">ConfigurationParameters_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Type holding all configuration parameters for this algorithm.  <a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dae/classicarus_1_1opdet_1_1PMTsimulationAlg_1_1GainFluctuator.html">GainFluctuator</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/classicarus_1_1opdet_1_1PMTsimulationAlg_1_1TimeToTickAndSubtickConverter.html">TimeToTickAndSubtickConverter</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Functor to convert tick point into a tick number and a subsample index.  <a href="../../d1/d42/classicarus_1_1opdet_1_1PMTsimulationAlg_1_1TimeToTickAndSubtickConverter.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a3dd3bba935aff36f28108ea50c7a4cfa"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a3dd3bba935aff36f28108ea50c7a4cfa">microseconds</a> = <a class="el" href="../../d3/d63/namespaceutil_1_1quantities.html#ab25cb1eb618bd67516b664f63c2dc1a9">util::quantities::microsecond</a></td></tr>
<tr class="separator:a3dd3bba935aff36f28108ea50c7a4cfa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a4b5a32c44f2517357ca4ac43a1ec59"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1a4b5a32c44f2517357ca4ac43a1ec59">nanoseconds</a> = <a class="el" href="../../d3/d63/namespaceutil_1_1quantities.html#a601d5581a465f2bed2bf3c294178ca8c">util::quantities::nanosecond</a></td></tr>
<tr class="separator:a1a4b5a32c44f2517357ca4ac43a1ec59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ba47fd61d026688fba53d5854013ad5"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0ba47fd61d026688fba53d5854013ad5">hertz</a> = <a class="el" href="../../d3/d63/namespaceutil_1_1quantities.html#a82952b52965c343ff8444892b7f8b263">util::quantities::hertz</a></td></tr>
<tr class="separator:a0ba47fd61d026688fba53d5854013ad5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab2bab02ebb9a95fc0fe9733f2e545a2f"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ab2bab02ebb9a95fc0fe9733f2e545a2f">megahertz</a> = <a class="el" href="../../d3/d63/namespaceutil_1_1quantities.html#a9f8cb70621b1ae1eb03100180fdd562a">util::quantities::megahertz</a></td></tr>
<tr class="separator:ab2bab02ebb9a95fc0fe9733f2e545a2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1c349abcd10ca7cb1cc63505b38f427"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#af1c349abcd10ca7cb1cc63505b38f427">picocoulomb</a> = <a class="el" href="../../d3/d63/namespaceutil_1_1quantities.html#a0116c6fd4a555eb535800721e300f36d">util::quantities::picocoulomb</a></td></tr>
<tr class="separator:af1c349abcd10ca7cb1cc63505b38f427"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac17a9af8a4cec78a3381487ba80cec42"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac17a9af8a4cec78a3381487ba80cec42">tick</a> = <a class="el" href="../../d3/d63/namespaceutil_1_1quantities.html#a1a08bc762b79d6e1d7816c34d3e36f78">util::quantities::tick</a></td></tr>
<tr class="separator:ac17a9af8a4cec78a3381487ba80cec42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad2e0cf8d4a2cb17d1646b87c43d93cdb"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">ADCcount</a> = <a class="el" href="../../db/dce/classicarus_1_1opdet_1_1DiscretePhotoelectronPulse.html#a7edfcf54614813d58feca29d53e7a363">DiscretePhotoelectronPulse::ADCcount</a></td></tr>
<tr class="separator:ad2e0cf8d4a2cb17d1646b87c43d93cdb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5018b83f2da4426565f512d5972312dd"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a5018b83f2da4426565f512d5972312dd">time_interval</a> = <a class="el" href="../../dc/d8b/namespacedetinfo_1_1timescales.html#a30eb38d8abfc08f0ff971933fbaf69f4">detinfo::timescales::time_interval</a></td></tr>
<tr class="separator:a5018b83f2da4426565f512d5972312dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c6c1f9995994044cb8527ba4c978fa4"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a5c6c1f9995994044cb8527ba4c978fa4">optical_tick</a> = <a class="el" href="../../dc/d8b/namespacedetinfo_1_1timescales.html#aafa6c859759c919622c301178d4fe4d6">detinfo::timescales::optical_tick</a></td></tr>
<tr class="separator:a5c6c1f9995994044cb8527ba4c978fa4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ade12a71e902019f988d3f037226e1d8e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ade12a71e902019f988d3f037226e1d8e">PMTsimulationAlg</a> (<a class="el" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html">ConfigurationParameters_t</a> const &amp;config)</td></tr>
<tr class="memdesc:ade12a71e902019f988d3f037226e1d8e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="#ade12a71e902019f988d3f037226e1d8e">More...</a><br/></td></tr>
<tr class="separator:ade12a71e902019f988d3f037226e1d8e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee8aac6f6cbe73d3d8d8d0ece1433a22"><td class="memItemLeft" align="right" valign="top">std::tuple&lt; std::vector<br class="typebreak"/>
&lt; <a class="el" href="../../d0/d29/classraw_1_1OpDetWaveform.html">raw::OpDetWaveform</a> &gt;<br class="typebreak"/>
, std::optional<br class="typebreak"/>
&lt; <a class="el" href="../../d3/dd1/classsim_1_1SimPhotons.html">sim::SimPhotons</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aee8aac6f6cbe73d3d8d8d0ece1433a22">simulate</a> (<a class="el" href="../../d3/dd1/classsim_1_1SimPhotons.html">sim::SimPhotons</a> const &amp;photons)</td></tr>
<tr class="memdesc:aee8aac6f6cbe73d3d8d8d0ece1433a22"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the waveforms originating from simulated photons.  <a href="#aee8aac6f6cbe73d3d8d8d0ece1433a22">More...</a><br/></td></tr>
<tr class="separator:aee8aac6f6cbe73d3d8d8d0ece1433a22"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8445c3557469fcff5c4b8c9a31df0055"><td class="memTemplParams" colspan="2">template&lt;typename Stream &gt; </td></tr>
<tr class="memitem:a8445c3557469fcff5c4b8c9a31df0055"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a8445c3557469fcff5c4b8c9a31df0055">printConfiguration</a> (<a class="el" href="../../d0/d8f/runFilesFromSAM_8sh.html#a9cafae22b6225844ee0cdf5ea57176ff">Stream</a> &amp;&amp;out, std::string indent=&quot;&quot;) const </td></tr>
<tr class="memdesc:a8445c3557469fcff5c4b8c9a31df0055"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints the configuration into the specified output stream.  <a href="#a8445c3557469fcff5c4b8c9a31df0055">More...</a><br/></td></tr>
<tr class="separator:a8445c3557469fcff5c4b8c9a31df0055"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr class="memitem:a483ae1c29f3c72dce79fe70a9bbd19d0"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a483ae1c29f3c72dce79fe70a9bbd19d0">OpDetWaveformMaker_t</a> = <a class="el" href="../../d4/d81/classicarus_1_1opdet_1_1OpDetWaveformMakerClass.html">icarus::opdet::OpDetWaveformMakerClass</a>&lt; <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">ADCcount</a> &gt;</td></tr>
<tr class="separator:a483ae1c29f3c72dce79fe70a9bbd19d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0367bc7919988b14cad97ed96ca83f1a"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> = <a class="el" href="../../d4/d81/classicarus_1_1opdet_1_1OpDetWaveformMakerClass.html#a059010717ef64412260321512e9a0065">OpDetWaveformMaker_t::WaveformData_t</a></td></tr>
<tr class="memdesc:a0367bc7919988b14cad97ed96ca83f1a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Type internally used for storing waveforms.  <a href="#a0367bc7919988b14cad97ed96ca83f1a">More...</a><br/></td></tr>
<tr class="separator:a0367bc7919988b14cad97ed96ca83f1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12abe3b053218a60ad6c171a10a9d44d"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a12abe3b053218a60ad6c171a10a9d44d">WaveformValue_t</a> = <a class="el" href="../../de/d7e/structutil_1_1quantities_1_1concepts_1_1Quantity.html#a9af2f90e67ec6e3b65593a418d5d5c99">ADCcount::value_t</a></td></tr>
<tr class="memdesc:a12abe3b053218a60ad6c171a10a9d44d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Numeric type in waveforms.  <a href="#a12abe3b053218a60ad6c171a10a9d44d">More...</a><br/></td></tr>
<tr class="separator:a12abe3b053218a60ad6c171a10a9d44d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a954b0fdcf7649c843f9d268e39edd383"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a954b0fdcf7649c843f9d268e39edd383">PulseSampling_t</a> = <a class="el" href="../../db/dce/classicarus_1_1opdet_1_1DiscretePhotoelectronPulse.html#a7d104b068a745bd0ecbc2c65fd6b84c9">DiscretePhotoelectronPulse::Subsample_t</a></td></tr>
<tr class="memdesc:a954b0fdcf7649c843f9d268e39edd383"><td class="mdescLeft">&#160;</td><td class="mdescRight">Type of sampled pulse shape: sequence of samples, one per tick.  <a href="#a954b0fdcf7649c843f9d268e39edd383">More...</a><br/></td></tr>
<tr class="separator:a954b0fdcf7649c843f9d268e39edd383"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26c22ab687a22533ff3b202efd05a6a7"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a26c22ab687a22533ff3b202efd05a6a7">NoiseAdderFunc_t</a> = void(PMTsimulationAlg::*)(<a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> &amp;) const</td></tr>
<tr class="memdesc:a26c22ab687a22533ff3b202efd05a6a7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Type of member function to add electronics noise.  <a href="#a26c22ab687a22533ff3b202efd05a6a7">More...</a><br/></td></tr>
<tr class="separator:a26c22ab687a22533ff3b202efd05a6a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:aaf1e896492de61f7c4a0ac898bf206a4"><td class="memItemLeft" align="right" valign="top">auto&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aaf1e896492de61f7c4a0ac898bf206a4">makeGainFluctuator</a> () const </td></tr>
<tr class="memdesc:aaf1e896492de61f7c4a0ac898bf206a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns a configured gain fluctuator object.  <a href="#aaf1e896492de61f7c4a0ac898bf206a4">More...</a><br/></td></tr>
<tr class="separator:aaf1e896492de61f7c4a0ac898bf206a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adfc2a89d72e18b0b3df4375fb06dc023"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#adfc2a89d72e18b0b3df4375fb06dc023">CreateFullWaveform</a> (<a class="el" href="../../d3/dd1/classsim_1_1SimPhotons.html">sim::SimPhotons</a> const &amp;photons, std::optional&lt; <a class="el" href="../../d3/dd1/classsim_1_1SimPhotons.html">sim::SimPhotons</a> &gt; &amp;photons_used) const </td></tr>
<tr class="memdesc:adfc2a89d72e18b0b3df4375fb06dc023"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates <code><a class="el" href="../../d0/d29/classraw_1_1OpDetWaveform.html">raw::OpDetWaveform</a></code> objects from simulated photoelectrons.  <a href="#adfc2a89d72e18b0b3df4375fb06dc023">More...</a><br/></td></tr>
<tr class="separator:adfc2a89d72e18b0b3df4375fb06dc023"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62ac2002e5d89c6823141d90869bbab7"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="../../d0/d29/classraw_1_1OpDetWaveform.html">raw::OpDetWaveform</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a62ac2002e5d89c6823141d90869bbab7">CreateFixedSizeOpDetWaveforms</a> (<a class="el" href="../../d9/d63/namespaceraw.html#ab3db8feaa51f2c564eb00582c3d72590">raw::Channel_t</a> opChannel, <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> const &amp;waveform) const </td></tr>
<tr class="memdesc:a62ac2002e5d89c6823141d90869bbab7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates <code><a class="el" href="../../d0/d29/classraw_1_1OpDetWaveform.html">raw::OpDetWaveform</a></code> objects from a waveform data.  <a href="#a62ac2002e5d89c6823141d90869bbab7">More...</a><br/></td></tr>
<tr class="separator:a62ac2002e5d89c6823141d90869bbab7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2d381df812b9bb055fe4ef4f5e82c98"><td class="memTemplParams" colspan="2">template&lt;typename Combine &gt; </td></tr>
<tr class="memitem:af2d381df812b9bb055fe4ef4f5e82c98"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#af2d381df812b9bb055fe4ef4f5e82c98">AddPulseShape</a> (<a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a954b0fdcf7649c843f9d268e39edd383">PulseSampling_t</a> const &amp;pulse, <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> &amp;wave, <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac17a9af8a4cec78a3381487ba80cec42">tick</a> const time_bin, Combine combination) const </td></tr>
<tr class="memdesc:af2d381df812b9bb055fe4ef4f5e82c98"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a pulse to a waveform, starting at a given tick.  <a href="#af2d381df812b9bb055fe4ef4f5e82c98">More...</a><br/></td></tr>
<tr class="separator:af2d381df812b9bb055fe4ef4f5e82c98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb930cd5f6dc4abe57cf291da9843103"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#afb930cd5f6dc4abe57cf291da9843103">AddPhotoelectrons</a> (<a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a954b0fdcf7649c843f9d268e39edd383">PulseSampling_t</a> const &amp;pulse, <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> &amp;wave, <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac17a9af8a4cec78a3381487ba80cec42">tick</a> const time_bin, <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a12abe3b053218a60ad6c171a10a9d44d">WaveformValue_t</a> const <a class="el" href="../../d0/d99/find__fhicl_8sh.html#a1bfbd78e0d8a2bc06df6cee466cca51a">n</a>) const </td></tr>
<tr class="memdesc:afb930cd5f6dc4abe57cf291da9843103"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a number of pulses to a waveform, starting at a given tick.  <a href="#afb930cd5f6dc4abe57cf291da9843103">More...</a><br/></td></tr>
<tr class="separator:afb930cd5f6dc4abe57cf291da9843103"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6d7b198cc479276c88d3b483dccec4d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac6d7b198cc479276c88d3b483dccec4d">AddNoise</a> (<a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> &amp;wave) const </td></tr>
<tr class="separator:ac6d7b198cc479276c88d3b483dccec4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a691370223b9ee6837cf4a5e4d3e4843e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a691370223b9ee6837cf4a5e4d3e4843e">AddNoise_faster</a> (<a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> &amp;wave) const </td></tr>
<tr class="memdesc:a691370223b9ee6837cf4a5e4d3e4843e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Same as <code><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac6d7b198cc479276c88d3b483dccec4d">AddNoise()</a></code> but using an alternative generator.  <a href="#a691370223b9ee6837cf4a5e4d3e4843e">More...</a><br/></td></tr>
<tr class="separator:a691370223b9ee6837cf4a5e4d3e4843e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0838785fc5665c18df7c0ca7497aa1a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac0838785fc5665c18df7c0ca7497aa1a">AddDarkNoise</a> (<a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> &amp;wave) const </td></tr>
<tr class="separator:ac0838785fc5665c18df7c0ca7497aa1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6224483efa2ef00a01f342155bceec40"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a5c6c1f9995994044cb8527ba4c978fa4">optical_tick</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a6224483efa2ef00a01f342155bceec40">FindTriggers</a> (<a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> const &amp;wvfm) const </td></tr>
<tr class="memdesc:a6224483efa2ef00a01f342155bceec40"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ticks in the specified waveform where some signal activity starts.  <a href="#a6224483efa2ef00a01f342155bceec40">More...</a><br/></td></tr>
<tr class="separator:a6224483efa2ef00a01f342155bceec40"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed3ee1aca2df9768fe265bdb9cb8445d"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a5c6c1f9995994044cb8527ba4c978fa4">optical_tick</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aed3ee1aca2df9768fe265bdb9cb8445d">CreateBeamGateTriggers</a> () const </td></tr>
<tr class="memdesc:aed3ee1aca2df9768fe265bdb9cb8445d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generate periodic interest points regardless the actual activity.  <a href="#aed3ee1aca2df9768fe265bdb9cb8445d">More...</a><br/></td></tr>
<tr class="separator:aed3ee1aca2df9768fe265bdb9cb8445d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32114c48520a448cf2ffb296acd45fe7"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a32114c48520a448cf2ffb296acd45fe7">KicksPhotoelectron</a> () const </td></tr>
<tr class="memdesc:a32114c48520a448cf2ffb296acd45fe7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns a random response whether a photon generates a photoelectron.  <a href="#a32114c48520a448cf2ffb296acd45fe7">More...</a><br/></td></tr>
<tr class="separator:a32114c48520a448cf2ffb296acd45fe7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66a3549968d1767268dbfe90f41e774e"><td class="memItemLeft" align="right" valign="top">std::pair&lt; <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">ADCcount</a>, <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">ADCcount</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a66a3549968d1767268dbfe90f41e774e">saturationRange</a> () const </td></tr>
<tr class="memdesc:a66a3549968d1767268dbfe90f41e774e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the ADC range allowed for photoelectron saturation.  <a href="#a66a3549968d1767268dbfe90f41e774e">More...</a><br/></td></tr>
<tr class="separator:a66a3549968d1767268dbfe90f41e774e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25afa671a2eb775f7bdc2ac926043af1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a25afa671a2eb775f7bdc2ac926043af1">ApplySaturation</a> (<a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> &amp;waveform, std::pair&lt; <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">ADCcount</a>, <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">ADCcount</a> &gt; const &amp;range) const </td></tr>
<tr class="separator:a25afa671a2eb775f7bdc2ac926043af1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2859193987b27cd34cc9f36da28eac9b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a2859193987b27cd34cc9f36da28eac9b">ApplySaturation</a> (<a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> &amp;waveform) const </td></tr>
<tr class="memdesc:a2859193987b27cd34cc9f36da28eac9b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Applies the configured photoelectron saturation on the <code>waveform</code>.  <a href="#a2859193987b27cd34cc9f36da28eac9b">More...</a><br/></td></tr>
<tr class="separator:a2859193987b27cd34cc9f36da28eac9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-methods"></a>
Static Private Member Functions</h2></td></tr>
<tr class="memitem:a691d908788045d83e9b9ea10f6e8edd3"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a691d908788045d83e9b9ea10f6e8edd3">ClipWaveform</a> (<a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> &amp;waveform, <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">ADCcount</a> min, <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">ADCcount</a> <a class="el" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">max</a>)</td></tr>
<tr class="memdesc:a691d908788045d83e9b9ea10f6e8edd3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Forces <code>waveform</code> ADC within the <code>min</code> to <code>max</code> range (<code>max</code> included).  <a href="#a691d908788045d83e9b9ea10f6e8edd3">More...</a><br/></td></tr>
<tr class="separator:a691d908788045d83e9b9ea10f6e8edd3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a1021a841e3d7a47a2ff8458c982675ae"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html">ConfigurationParameters_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a></td></tr>
<tr class="memdesc:a1021a841e3d7a47a2ff8458c982675ae"><td class="mdescLeft">&#160;</td><td class="mdescRight">Complete algorithm configuration.  <a href="#a1021a841e3d7a47a2ff8458c982675ae">More...</a><br/></td></tr>
<tr class="separator:a1021a841e3d7a47a2ff8458c982675ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8992f7d6a13f5fa86f0e0a8a68f6b6b"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#af8992f7d6a13f5fa86f0e0a8a68f6b6b">fQE</a></td></tr>
<tr class="memdesc:af8992f7d6a13f5fa86f0e0a8a68f6b6b"><td class="mdescLeft">&#160;</td><td class="mdescRight">PMT quantum efficiency.  <a href="#af8992f7d6a13f5fa86f0e0a8a68f6b6b">More...</a><br/></td></tr>
<tr class="separator:af8992f7d6a13f5fa86f0e0a8a68f6b6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a065984ccb1859a6400c2d9f3262eb082"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ab2bab02ebb9a95fc0fe9733f2e545a2f">megahertz</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a065984ccb1859a6400c2d9f3262eb082">fSampling</a></td></tr>
<tr class="memdesc:a065984ccb1859a6400c2d9f3262eb082"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wave sampling frequency [MHz].  <a href="#a065984ccb1859a6400c2d9f3262eb082">More...</a><br/></td></tr>
<tr class="separator:a065984ccb1859a6400c2d9f3262eb082"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc9b79707c1b8f5afc175fdc8cd51eb0"><td class="memItemLeft" align="right" valign="top">std::size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#abc9b79707c1b8f5afc175fdc8cd51eb0">fNsamples</a></td></tr>
<tr class="memdesc:abc9b79707c1b8f5afc175fdc8cd51eb0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Samples per waveform.  <a href="#abc9b79707c1b8f5afc175fdc8cd51eb0">More...</a><br/></td></tr>
<tr class="separator:abc9b79707c1b8f5afc175fdc8cd51eb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa822578c863e4bdcac980b9186f33ec1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/dce/classicarus_1_1opdet_1_1DiscretePhotoelectronPulse.html">DiscretePhotoelectronPulse</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aa822578c863e4bdcac980b9186f33ec1">wsp</a></td></tr>
<tr class="separator:aa822578c863e4bdcac980b9186f33ec1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8432cac07280ac459e297f75fe5001e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a26c22ab687a22533ff3b202efd05a6a7">NoiseAdderFunc_t</a> const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aa8432cac07280ac459e297f75fe5001e">fNoiseAdder</a></td></tr>
<tr class="memdesc:aa8432cac07280ac459e297f75fe5001e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Single photon pulse (sampled).  <a href="#aa8432cac07280ac459e297f75fe5001e">More...</a><br/></td></tr>
<tr class="separator:aa8432cac07280ac459e297f75fe5001e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr class="memitem:a4b68f81701dc84bf91a37f7038306b2a"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="../../d4/d3b/classutil_1_1FastAndPoorGauss.html">util::FastAndPoorGauss</a>&lt; 32768U, float &gt; const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a4b68f81701dc84bf91a37f7038306b2a">fFastGauss</a></td></tr>
<tr class="separator:a4b68f81701dc84bf91a37f7038306b2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Algorithm class for the full simulation of PMT channels. </p>
<p>The algorithm creates simulated PMT waveforms as read out by ICARUS, including the generation of trigger primitives. Contributions to the waveforms include:</p>
<ul>
<li>physical photons</li>
<li>dark noise</li>
<li>electronics noise</li>
</ul>
<p>The algorithm processes an optical channel at a time, independently and uncorrelated from the other channels. For each channel, multiple waveforms may be generated according to the readout parameters.</p>
<h1>Activity sources </h1>
<h2>Physical photons </h2>
<p>Photons are read from <code><a class="el" href="../../d3/dd1/classsim_1_1SimPhotons.html" title="Collection of photons which recorded on one channel. ">sim::SimPhotons</a></code> data objects, each one pertaining a single optical detector channel. Each photon on the channel is assumed to have successfully reached the external surface of the photocathode, with the wavelength shifter. Depending on the upstream simulation, and in particular on the photon visibility library settings, the photon might have also already passed the wavelength shifting and even triggered the conversion to a detectable photoelectron.</p>
<p>Quantum efficiency is simulated to determine if each photon converts into a photoelectron on the internal side of the photocathode. The target quantum efficiency is specified via the <code>QE</code> configuration parameter. It is assumed that some level of quantum efficiency has already been simulated upstream: more precisely, that the quantum efficiency already applied is in the amount returned by <code><a class="el" href="../../dc/d37/classdetinfo_1_1LArProperties.html#a769f632bb0d68ed3bec2ee18e9e8a2a8">detinfo::LArProperties::ScintPreScale()</a></code>. Therefore:</p>
<ol type="1">
<li>the quantum efficiency applied here is only the residual one to go from <code><a class="el" href="../../dc/d37/classdetinfo_1_1LArProperties.html#a769f632bb0d68ed3bec2ee18e9e8a2a8">detinfo::LArProperties::ScintPreScale()</a></code> to the value in <code>QE</code></li>
<li>there is no implement here to <em>increase</em> quantum efficiency, i.e. <code>QE</code> must not exceed <code><a class="el" href="../../dc/d37/classdetinfo_1_1LArProperties.html#a769f632bb0d68ed3bec2ee18e9e8a2a8">detinfo::LArProperties::ScintPreScale()</a></code></li>
<li>if the configuration specifies a target quantum efficiency <code>QE</code> larger than the one applied upstream (<code><a class="el" href="../../dc/d37/classdetinfo_1_1LArProperties.html#a769f632bb0d68ed3bec2ee18e9e8a2a8">detinfo::LArProperties::ScintPreScale()</a></code>), a warning message is printed, and no change to quantum efficiency is performed</li>
</ol>
<p>Note that if the upstream code has not applied any quantum efficiency, the configuration should give a <code><a class="el" href="../../dc/d37/classdetinfo_1_1LArProperties.html#a769f632bb0d68ed3bec2ee18e9e8a2a8">detinfo::LArProperties::ScintPreScale()</a></code> of 1.0.</p>
<dl class="section note"><dt>Note</dt><dd>If the photon visibility library already includes the probability of the photon converting to a photoelectron, the quantum efficiency check here should be skipped by setting the efficiency to 1.</dd></dl>
<p>For each converting photon, a photoelectron is added to the channel by placing a template waveform shape into the channel waveform.</p>
<p>The timestamp of each waveform is based on the same scale as the trigger time, as defined by <code>detinfo::DetectorClocks::TriggerTime()</code>. On that scale, the timestamp pins down the time of the first sample of the waveform. Note that this is typically earlier than when the actual signal starts. More precisely, the signal is defined to start at an interest point (see <code><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a6224483efa2ef00a01f342155bceec40" title="Ticks in the specified waveform where some signal activity starts. ">FindTriggers()</a></code> for their definition), and the waveform starts (at tick #0) earlier than that by a fraction <code>PreTrigFraction</code> of the readout window size <code>ReadoutWindowSize</code> (both are configuration parameters of the algorithm), allowing for that amount of pre-trigger data.</p>
<p>The configuration parameter <code>TriggerOffsetPMT</code> describes how much earlier than the trigger time the optical readout has started. Note that if an interest point (see above) happens early after optical readout has started, there might be not enough data to fill the pre-trigger data. In such case, the interest point will just be located earlier than usual within the final waveform. This situation may be caused for example by asynchronous physics events like scintillation light from cosmic rays or radioactive decay of the detector materials, or from a fluctuation of the noise.</p>
<h2>Photoelectrons </h2>
<p>The response of the PMT to a single photoelectron is passed to the algorithm as a full blown function of type <code>SinglePhotonResponseFunc_t</code>. The function needs to be valid for the lifetime of the algorithm, since the algorithm refers to without owning it, and it is expected not to change during that time. See <code><a class="el" href="../../d1/dd5/classicarus_1_1opdet_1_1SimPMTIcarus.html" title="Simulates the digitization of ICARUS PMT response and trigger. ">icarus::opdet::SimPMTIcarus</a></code></p>
<p>To account for gain fluctuations, that shape is considered to correspond to a nominal gain (<code>PMTspecs.gain</code> configuration parameter), which is then fluctuated to obtain the effective gain. This feature can be disabled by setting configuration parameter <code>FluctuateGain</code> to <code>false</code>. The approximation used here is that the fluctuation is entirely due to the first stage of multiplication. The gain on the first stage is described as a random variable with Poisson distribution around the mean gain. The gain on a single photoelectron at the first stage is, in fact, an integral number in each case. The time spread of the signal may be increased by the difference in time of the different branches of the multiplication avalanche. Therefore, increasing or decreasing the number of branches, as it is done by changing the gain of the first stage, the time evolution of the signal will also be likewise affected. At this time we do not take this aspect into account in the simulation. For the nominal settings of a Hamamatsu 5912 photomultiplier (gain 10 ^7^, high multiplication on the first stage) the gain at the first stage is around 20, causing a fluctuation of about 20%. If the multiplication were equally distributed across the stages, that fluctuation would be almost 45%.</p>
<p>The first stage gain is computed by <code><a class="el" href="../../de/d19/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_1_1PMTspecs__t.html#aaae76610db283137cb8e4ecbe9457b5b" title="Returns the gain of the specified multiplication stage. ">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::PMTspecs_t::multiplicationStageGain()</a></code>.</p>
<h2>Dark noise </h2>
<p>Dark noise, i.e. the noise originating by "spontaneous" emission of a photoelectron in the photocathode without any external stimulation, is simulated by randomly extracting the time such emission happens. Each emission causes a photoelectron template waveform to be added at the extracted time. The rate of dark noise emission is set by configuration with <code>DarkNoiseRate</code> parameter.</p>
<h2>Electronics noise </h2>
<p>Electronics noise is described by Gaussian fluctuations of a given standard deviation, controlled by the configuration parameter <code>AmpNoise</code>. No noise correlation is simulated neither in time nor in space.</p>
<h1>Configuration </h1>
<h2>PMT specifications </h2>
<p>PMT specifications are used to evaluate the variance of the gain. The details of the calculation are documented in <code><a class="el" href="../../de/d19/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_1_1PMTspecs__t.html#aaae76610db283137cb8e4ecbe9457b5b" title="Returns the gain of the specified multiplication stage. ">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::PMTspecs_t::multiplicationStageGain()</a></code>.</p>
<p>The available parameters include:</p>
<ul>
<li><code>gain</code> (default: <code>1e7</code>): the nominal gain of the PMT; this is just a reference value.</li>
<li><code>voltageDistribution</code> is a sequence of values, one for each stage of the multiplication chain of the PMT. Each number represents the relative size of the resistance that determines the fall of the potential on that stage. Only the stages that contribute to the gain need to be included. The absolute value of each element is inconsequential. For example, a 10-stage PMT with the first stage having twice the resistance of all the other would be represented by the setting <code>[ 2, 1, 1, 1, 1, 1, 1, 1, 1, 1 ]</code>.</li>
<li><code>dynodeK</code> (default: <code>0.75</code>) represents the dependence of the gain of a stage on the potential drop: <img class="formulaInl" alt="$ \mu_{i} \propto (\Delta V_{i})^{k} $" src="../../form_12.png"/> (with <img class="formulaInl" alt="$ \mu_{i} $" src="../../form_13.png"/> the gain for stage <img class="formulaInl" alt="$ i $" src="../../form_14.png"/>, <img class="formulaInl" alt="$ \Delta V_{i} $" src="../../form_15.png"/> the drop of potential of that stage and <img class="formulaInl" alt="$ k $" src="../../form_16.png"/> the parameter set by <code>dynodeK</code>.</li>
</ul>
<h2>Random number generators </h2>
<p><a class="anchor" id="ICARUS_PMTSimulationAlg_RandomEngines"></a> Three independent random engines are currently used in the simulation:</p>
<ul>
<li>"main" random engine:<ul>
<li>residual quantum efficiency;</li>
<li>gain fluctuations;</li>
</ul>
</li>
<li>"dark noise" engine: dark current noise only;</li>
<li>"electronics noise" engine: electronics noise only.</li>
</ul>
<h1>Structure of the algorithm </h1>
<p><em>This section needs completion.</em></p>
<p>The algorithm is serviceable immediately after construction. Construction relies on a custom parameter data structure.</p>
<p>An utility, <code><a class="el" href="../../d1/d89/classicarus_1_1opdet_1_1PMTsimulationAlgMaker.html" title="Returns a new PMTsimulationAlg with an updated configuration. ">PMTsimulationAlgMaker</a></code>, splits the set up in two parts:</p>
<ol type="1">
<li>configuration, where the full set of parameters is learned;</li>
<li>set up, where service providers, random number engines and the external single photon response function are acquired.</li>
</ol>
<p>This is supposed to make the creation of the filling of parameter structure and the creation of the algorithm easier. At that point, a single <code><a class="el" href="../../d3/dd1/classsim_1_1SimPhotons.html" title="Collection of photons which recorded on one channel. ">sim::SimPhotons</a></code> can be processed (<code><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aee8aac6f6cbe73d3d8d8d0ece1433a22" title="Returns the waveforms originating from simulated photons. ">simulate()</a></code>) at a time, or multiple at the same time (see the multithreading notes below).</p>
<p>The function used to describe the single particle response is customizable and it must in fact be specified by the caller, since there is no default form. The function must implement the <code>PulseFunction_t</code> interface.</p>
<h2>Multithreading notes </h2>
<p>The algorithm processes one channel at a time, and it does not depend on event-level information; therefore, the same algorithm object can be used to process many events in sequence. On the other hand, multithreading is impaired by the random number generation, in the sense that multithreading will break reproducibility if the random engine is not magically thread-resistant.</p>
<p>If the set up is event-dependent, then this object can't be used for multiple events at the same time. There is no global state, so at least different instances of the algorithm can be run at the same time. In fact, the creation of an algorithm is expected to take negligible time compared to its run time on a single event, and it is conceivable to create a new algorithm instance for each event. </p>

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00340">340</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a class="anchor" id="ad2e0cf8d4a2cb17d1646b87c43d93cdb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">icarus::opdet::PMTsimulationAlg::ADCcount</a> =  <a class="el" href="../../db/dce/classicarus_1_1opdet_1_1DiscretePhotoelectronPulse.html#a7edfcf54614813d58feca29d53e7a363">DiscretePhotoelectronPulse::ADCcount</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00349">349</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a0ba47fd61d026688fba53d5854013ad5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0ba47fd61d026688fba53d5854013ad5">icarus::opdet::PMTsimulationAlg::hertz</a> =  <a class="el" href="../../d3/d63/namespaceutil_1_1quantities.html#a82952b52965c343ff8444892b7f8b263">util::quantities::hertz</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00345">345</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab2bab02ebb9a95fc0fe9733f2e545a2f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ab2bab02ebb9a95fc0fe9733f2e545a2f">icarus::opdet::PMTsimulationAlg::megahertz</a> =  <a class="el" href="../../d3/d63/namespaceutil_1_1quantities.html#a9f8cb70621b1ae1eb03100180fdd562a">util::quantities::megahertz</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00346">346</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a3dd3bba935aff36f28108ea50c7a4cfa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a3dd3bba935aff36f28108ea50c7a4cfa">icarus::opdet::PMTsimulationAlg::microseconds</a> =  <a class="el" href="../../d3/d63/namespaceutil_1_1quantities.html#ab25cb1eb618bd67516b664f63c2dc1a9">util::quantities::microsecond</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00343">343</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a1a4b5a32c44f2517357ca4ac43a1ec59"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1a4b5a32c44f2517357ca4ac43a1ec59">icarus::opdet::PMTsimulationAlg::nanoseconds</a> =  <a class="el" href="../../d3/d63/namespaceutil_1_1quantities.html#a601d5581a465f2bed2bf3c294178ca8c">util::quantities::nanosecond</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00344">344</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a26c22ab687a22533ff3b202efd05a6a7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a26c22ab687a22533ff3b202efd05a6a7">icarus::opdet::PMTsimulationAlg::NoiseAdderFunc_t</a> =  void (PMTsimulationAlg::*)(<a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a>&amp;) const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Type of member function to add electronics noise. </p>

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00529">529</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a483ae1c29f3c72dce79fe70a9bbd19d0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a483ae1c29f3c72dce79fe70a9bbd19d0">icarus::opdet::PMTsimulationAlg::OpDetWaveformMaker_t</a> =  <a class="el" href="../../d4/d81/classicarus_1_1opdet_1_1OpDetWaveformMakerClass.html">icarus::opdet::OpDetWaveformMakerClass</a>&lt;<a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">ADCcount</a>&gt;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00519">519</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a5c6c1f9995994044cb8527ba4c978fa4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a5c6c1f9995994044cb8527ba4c978fa4">icarus::opdet::PMTsimulationAlg::optical_tick</a> =  <a class="el" href="../../dc/d8b/namespacedetinfo_1_1timescales.html#aafa6c859759c919622c301178d4fe4d6">detinfo::timescales::optical_tick</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00352">352</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="af1c349abcd10ca7cb1cc63505b38f427"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#af1c349abcd10ca7cb1cc63505b38f427">icarus::opdet::PMTsimulationAlg::picocoulomb</a> =  <a class="el" href="../../d3/d63/namespaceutil_1_1quantities.html#a0116c6fd4a555eb535800721e300f36d">util::quantities::picocoulomb</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00347">347</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a954b0fdcf7649c843f9d268e39edd383"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a954b0fdcf7649c843f9d268e39edd383">icarus::opdet::PMTsimulationAlg::PulseSampling_t</a> =  <a class="el" href="../../db/dce/classicarus_1_1opdet_1_1DiscretePhotoelectronPulse.html#a7d104b068a745bd0ecbc2c65fd6b84c9">DiscretePhotoelectronPulse::Subsample_t</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Type of sampled pulse shape: sequence of samples, one per tick. </p>

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00526">526</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="ac17a9af8a4cec78a3381487ba80cec42"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac17a9af8a4cec78a3381487ba80cec42">icarus::opdet::PMTsimulationAlg::tick</a> =  <a class="el" href="../../d3/d63/namespaceutil_1_1quantities.html#a1a08bc762b79d6e1d7816c34d3e36f78">util::quantities::tick</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00348">348</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a5018b83f2da4426565f512d5972312dd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a5018b83f2da4426565f512d5972312dd">icarus::opdet::PMTsimulationAlg::time_interval</a> =  <a class="el" href="../../dc/d8b/namespacedetinfo_1_1timescales.html#a30eb38d8abfc08f0ff971933fbaf69f4">detinfo::timescales::time_interval</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00351">351</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a0367bc7919988b14cad97ed96ca83f1a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">icarus::opdet::PMTsimulationAlg::Waveform_t</a> =  <a class="el" href="../../d4/d81/classicarus_1_1opdet_1_1OpDetWaveformMakerClass.html#a059010717ef64412260321512e9a0065">OpDetWaveformMaker_t::WaveformData_t</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Type internally used for storing waveforms. </p>

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00522">522</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a12abe3b053218a60ad6c171a10a9d44d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a12abe3b053218a60ad6c171a10a9d44d">icarus::opdet::PMTsimulationAlg::WaveformValue_t</a> =  <a class="el" href="../../de/d7e/structutil_1_1quantities_1_1concepts_1_1Quantity.html#a9af2f90e67ec6e3b65593a418d5d5c99">ADCcount::value_t</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Numeric type in waveforms. </p>

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00523">523</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ade12a71e902019f988d3f037226e1d8e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">icarus::opdet::PMTsimulationAlg::PMTsimulationAlg </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html">ConfigurationParameters_t</a> const &amp;&#160;</td>
          <td class="paramname"><em>config</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor. </p>

<p>Definition at line <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00102">102</a> of file <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html">PMTsimulationAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  : <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>(config)</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  , <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#af8992f7d6a13f5fa86f0e0a8a68f6b6b">fQE</a>(<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a8e0a1bfaac3a8395d52641aff56918b3">QEbase</a> / <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a722a428a96b4aeb957f5bcde1e5941bf">larProp</a>-&gt;<a class="code" href="../../dc/d37/classdetinfo_1_1LArProperties.html#a769f632bb0d68ed3bec2ee18e9e8a2a8">ScintPreScale</a>())</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  , <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a065984ccb1859a6400c2d9f3262eb082">fSampling</a>(<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a8ec7dc1deeb6c93abbb033199247d5f7">clockData</a>-&gt;<a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html#a2a9cc42c56118ccdf655a1b0312243f9">OpticalClock</a>().<a class="code" href="../../d0/d00/classdetinfo_1_1ElecClock.html#a8cc9f01b364bb33bd48866131086c4ec">Frequency</a>())</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  , <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#abc9b79707c1b8f5afc175fdc8cd51eb0">fNsamples</a>(<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#af69895d00bb9925a1920418ca52a5e50">readoutEnablePeriod</a> * <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a065984ccb1859a6400c2d9f3262eb082">fSampling</a>) <span class="comment">// us * MHz cancels out</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  , <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aa822578c863e4bdcac980b9186f33ec1">wsp</a>( <span class="comment">// NOTE: wsp amplitude already includes sign from polarity</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    *(<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a1ded604bafa62d4933ec9cad802e2ce1">pulseFunction</a>),</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a065984ccb1859a6400c2d9f3262eb082">fSampling</a>,</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#aa872eb438ce0fe89a6246a8168e27103">pulseSubsamples</a>, <span class="comment">// tick subsampling</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    1.0e-4_ADCf <span class="comment">// stop sampling when ADC counts are below this value</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    )</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  , <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aa8432cac07280ac459e297f75fe5001e">fNoiseAdder</a>(<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a0021a9143de57aa30fb7b200e73dd913">useFastElectronicsNoise</a></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      ? &amp;<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a691370223b9ee6837cf4a5e4d3e4843e">icarus::opdet::PMTsimulationAlg::AddNoise_faster</a></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      : &amp;<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac6d7b198cc479276c88d3b483dccec4d">icarus::opdet::PMTsimulationAlg::AddNoise</a></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    )</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;{</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="keyword">using namespace </span>util::quantities::electronics_literals;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="comment">//  mf::LogDebug(&quot;PMTsimulationAlg&quot;) &lt;&lt; &quot;Sampling = &quot; &lt;&lt; fSampling &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="comment">// shape of single pulse</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="comment">// Correction due to scalling factor applied during simulation if any</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  mf::LogDebug(<span class="stringliteral">&quot;PMTsimulationAlg&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;PMT corrected efficiency = &quot;</span> &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#af8992f7d6a13f5fa86f0e0a8a68f6b6b">fQE</a>;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#af8992f7d6a13f5fa86f0e0a8a68f6b6b">fQE</a> &gt;= 1.0001) {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    mf::LogWarning(<span class="stringliteral">&quot;PMTsimulationAlg&quot;</span>)</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;WARNING: Quantum efficiency set in the configuration (QE=&quot;</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a8e0a1bfaac3a8395d52641aff56918b3">QEbase</a> &lt;&lt; <span class="stringliteral">&quot;) seems to be too large!&quot;</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      <span class="stringliteral">&quot;\nThe photon visibility library is assumed to already include a&quot;</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <span class="stringliteral">&quot; quantum efficiency of &quot;</span> &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a722a428a96b4aeb957f5bcde1e5941bf">larProp</a>-&gt;<a class="code" href="../../dc/d37/classdetinfo_1_1LArProperties.html#a769f632bb0d68ed3bec2ee18e9e8a2a8">ScintPreScale</a>() &lt;&lt;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="stringliteral">&quot; (`ScintPreScale` setting of `LArProperties` service)&quot;</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="stringliteral">&quot; and here we are requesting a higher one.&quot;</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="stringliteral">&quot;\nThis configuration is not supported by `PMTsimulationAlg`,&quot;</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="stringliteral">&quot; and this simulation will effectively apply a quantum efficiency of &quot;</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a722a428a96b4aeb957f5bcde1e5941bf">larProp</a>-&gt;<a class="code" href="../../dc/d37/classdetinfo_1_1LArProperties.html#a769f632bb0d68ed3bec2ee18e9e8a2a8">ScintPreScale</a>();</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      ;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  }</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="comment">// check that the sampled waveform has a sufficiently large range, so that</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="comment">// tails are below 10^-3 ADC counts (absolute value);</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="comment">// if this test fails, it&#39;s better to reduce the threshold in wsp constructor</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aa822578c863e4bdcac980b9186f33ec1">wsp</a>.<a class="code" href="../../db/dce/classicarus_1_1opdet_1_1DiscretePhotoelectronPulse.html#a8f7918fda3df50c8fc4f672a7da13747">checkRange</a>(1.0<a class="code" href="../../d4/dca/updateVersionList_8sh.html#a067a8c1534d6da9b2c501a6cf4ef89bd">e</a>-3_ADCf, <span class="stringliteral">&quot;PMTsimulationAlg&quot;</span>);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;} <span class="comment">// icarus::opdet::PMTsimulationAlg::PMTsimulationAlg()</span></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_aa872eb438ce0fe89a6246a8168e27103"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#aa872eb438ce0fe89a6246a8168e27103">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::pulseSubsamples</a></div><div class="ttdeci">unsigned int pulseSubsamples</div><div class="ttdoc">Number of tick subsamples. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00432">PMTsimulationAlg.h:432</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a8e0a1bfaac3a8395d52641aff56918b3"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a8e0a1bfaac3a8395d52641aff56918b3">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::QEbase</a></div><div class="ttdeci">double QEbase</div><div class="ttdoc">Uncorrected PMT quantum efficiency. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00418">PMTsimulationAlg.h:418</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a0021a9143de57aa30fb7b200e73dd913"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a0021a9143de57aa30fb7b200e73dd913">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::useFastElectronicsNoise</a></div><div class="ttdeci">bool useFastElectronicsNoise</div><div class="ttdoc">Whether to use fast generator for electronics noise. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00437">PMTsimulationAlg.h:437</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_aa822578c863e4bdcac980b9186f33ec1"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aa822578c863e4bdcac980b9186f33ec1">icarus::opdet::PMTsimulationAlg::wsp</a></div><div class="ttdeci">DiscretePhotoelectronPulse wsp</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00582">PMTsimulationAlg.h:582</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_abc9b79707c1b8f5afc175fdc8cd51eb0"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#abc9b79707c1b8f5afc175fdc8cd51eb0">icarus::opdet::PMTsimulationAlg::fNsamples</a></div><div class="ttdeci">std::size_t fNsamples</div><div class="ttdoc">Samples per waveform. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00580">PMTsimulationAlg.h:580</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a1ded604bafa62d4933ec9cad802e2ce1"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a1ded604bafa62d4933ec9cad802e2ce1">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::pulseFunction</a></div><div class="ttdeci">SinglePhotonResponseFunc_t const * pulseFunction</div><div class="ttdoc">Single photon response function. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00453">PMTsimulationAlg.h:453</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1DiscretePhotoelectronPulse_html_a8f7918fda3df50c8fc4f672a7da13747"><div class="ttname"><a href="../../db/dce/classicarus_1_1opdet_1_1DiscretePhotoelectronPulse.html#a8f7918fda3df50c8fc4f672a7da13747">icarus::opdet::DiscretePhotoelectronPulse::checkRange</a></div><div class="ttdeci">bool checkRange(ADCcount limit, std::string const &amp;outputCat) const </div><div class="ttdoc">Checks that the waveform tails not sampled are negligible. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/def/DiscretePhotoelectronPulse_8cxx_source.html#l00084">DiscretePhotoelectronPulse.cxx:84</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_af69895d00bb9925a1920418ca52a5e50"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#af69895d00bb9925a1920418ca52a5e50">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::readoutEnablePeriod</a></div><div class="ttdeci">microseconds readoutEnablePeriod</div><div class="ttdoc">Time (us) for which pmt readout is enabled. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00426">PMTsimulationAlg.h:426</a></div></div>
<div class="ttc" id="classdetinfo_1_1DetectorClocksData_html_a2a9cc42c56118ccdf655a1b0312243f9"><div class="ttname"><a href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html#a2a9cc42c56118ccdf655a1b0312243f9">detinfo::DetectorClocksData::OpticalClock</a></div><div class="ttdeci">ElecClock const &amp; OpticalClock() const noexcept</div><div class="ttdoc">Borrow a const Optical clock with time set to Trigger time [us]. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d5b/DetectorClocksData_8h_source.html#l00404">DetectorClocksData.h:404</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a1021a841e3d7a47a2ff8458c982675ae"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">icarus::opdet::PMTsimulationAlg::fParams</a></div><div class="ttdeci">ConfigurationParameters_t fParams</div><div class="ttdoc">Complete algorithm configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00576">PMTsimulationAlg.h:576</a></div></div>
<div class="ttc" id="classdetinfo_1_1LArProperties_html_a769f632bb0d68ed3bec2ee18e9e8a2a8"><div class="ttname"><a href="../../dc/d37/classdetinfo_1_1LArProperties.html#a769f632bb0d68ed3bec2ee18e9e8a2a8">detinfo::LArProperties::ScintPreScale</a></div><div class="ttdeci">virtual double ScintPreScale(bool prescale=true) const =0</div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a065984ccb1859a6400c2d9f3262eb082"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a065984ccb1859a6400c2d9f3262eb082">icarus::opdet::PMTsimulationAlg::fSampling</a></div><div class="ttdeci">megahertz fSampling</div><div class="ttdoc">Wave sampling frequency [MHz]. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00579">PMTsimulationAlg.h:579</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_af8992f7d6a13f5fa86f0e0a8a68f6b6b"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#af8992f7d6a13f5fa86f0e0a8a68f6b6b">icarus::opdet::PMTsimulationAlg::fQE</a></div><div class="ttdeci">double fQE</div><div class="ttdoc">PMT quantum efficiency. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00578">PMTsimulationAlg.h:578</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_aa8432cac07280ac459e297f75fe5001e"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aa8432cac07280ac459e297f75fe5001e">icarus::opdet::PMTsimulationAlg::fNoiseAdder</a></div><div class="ttdeci">NoiseAdderFunc_t const fNoiseAdder</div><div class="ttdoc">Single photon pulse (sampled). </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00584">PMTsimulationAlg.h:584</a></div></div>
<div class="ttc" id="updateVersionList_8sh_html_a067a8c1534d6da9b2c501a6cf4ef89bd"><div class="ttname"><a href="../../d4/dca/updateVersionList_8sh.html#a067a8c1534d6da9b2c501a6cf4ef89bd">e</a></div><div class="ttdeci">do i e</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/updateVersionList_8sh_source.html#l00068">updateVersionList.sh:68</a></div></div>
<div class="ttc" id="classdetinfo_1_1ElecClock_html_a8cc9f01b364bb33bd48866131086c4ec"><div class="ttname"><a href="../../d0/d00/classdetinfo_1_1ElecClock.html#a8cc9f01b364bb33bd48866131086c4ec">detinfo::ElecClock::Frequency</a></div><div class="ttdeci">constexpr double Frequency() const </div><div class="ttdoc">Frequency in MHz. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d60/ElecClock_8h_source.html#l00191">ElecClock.h:191</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a722a428a96b4aeb957f5bcde1e5941bf"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a722a428a96b4aeb957f5bcde1e5941bf">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::larProp</a></div><div class="ttdeci">detinfo::LArProperties const * larProp</div><div class="ttdoc">LarProperties service provider. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00448">PMTsimulationAlg.h:448</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_ac6d7b198cc479276c88d3b483dccec4d"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac6d7b198cc479276c88d3b483dccec4d">icarus::opdet::PMTsimulationAlg::AddNoise</a></div><div class="ttdeci">void AddNoise(Waveform_t &amp;wave) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00526">PMTsimulationAlg.cxx:526</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a691370223b9ee6837cf4a5e4d3e4843e"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a691370223b9ee6837cf4a5e4d3e4843e">icarus::opdet::PMTsimulationAlg::AddNoise_faster</a></div><div class="ttdeci">void AddNoise_faster(Waveform_t &amp;wave) const </div><div class="ttdoc">Same as AddNoise() but using an alternative generator. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00539">PMTsimulationAlg.cxx:539</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a8ec7dc1deeb6c93abbb033199247d5f7"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a8ec7dc1deeb6c93abbb033199247d5f7">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::clockData</a></div><div class="ttdeci">detinfo::DetectorClocksData const * clockData</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00450">PMTsimulationAlg.h:450</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="ac0838785fc5665c18df7c0ca7497aa1a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void icarus::opdet::PMTsimulationAlg::AddDarkNoise </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> &amp;&#160;</td>
          <td class="paramname"><em>wave</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00563">563</a> of file <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html">PMTsimulationAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                                                                     {</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">   * We assume leakage current (&quot;dark noise&quot;) is completely stochastic and</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">   * distributed uniformly in time with a fixed and known rate.</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">   * In these condition, the time between two consecutive events follows an</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment">   * exponential distribution with as decay constant the same rate.</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment">   * We extact all the leakage events (including the first one) according to</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">   * that distribution.</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment">   * We follow the &quot;standard&quot; approach of subsampling of tick as for the</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment">   * photoelectron.</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">   *</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <span class="keyword">using namespace </span>util::quantities::frequency_literals;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a1e586e7a1864579cf5cb01d064bc4bb2">darkNoiseRate</a> &lt;= 0.0_Hz) <span class="keywordflow">return</span>; <span class="comment">// no dark noise</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="comment">// CLHEP random objects do not understand quantities, so we use scalars;</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="comment">// we choose to work with nanosecond</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  CLHEP::RandExponential random(*(<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#acd6b208af8f729f9a99191c0531c390c">darkNoiseRandomEngine</a>),</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    (1.0 / <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a1e586e7a1864579cf5cb01d064bc4bb2">darkNoiseRate</a>).convertInto&lt;<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1a4b5a32c44f2517357ca4ac43a1ec59">nanoseconds</a>&gt;().<a class="code" href="../../de/d7e/structutil_1_1quantities_1_1concepts_1_1Quantity.html#a8e5644f85ca8d28abcb85c3a4a47cf47">value</a>());</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="comment">// time to stop at: full duration of the waveform</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1a4b5a32c44f2517357ca4ac43a1ec59">nanoseconds</a> <span class="keyword">const</span> maxTime = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(wave.size()) / <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a065984ccb1859a6400c2d9f3262eb082">fSampling</a>;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  <span class="comment">// the time of first leakage event:</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1a4b5a32c44f2517357ca4ac43a1ec59">nanoseconds</a> darkNoiseTime { random.fire() };</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  TimeToTickAndSubtickConverter <span class="keyword">const</span> toTickAndSubtick(<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aa822578c863e4bdcac980b9186f33ec1">wsp</a>.<a class="code" href="../../db/dce/classicarus_1_1opdet_1_1DiscretePhotoelectronPulse.html#a684b11f646cb1142e4c015b45561b37c">nSubsamples</a>());</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  <span class="keyword">auto</span> gainFluctuation = <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aaf1e896492de61f7c4a0ac898bf206a4">makeGainFluctuator</a>();</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  MF_LOG_TRACE(<span class="stringliteral">&quot;PMTsimulationAlg&quot;</span>)</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;Adding dark noise (&quot;</span> &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a1e586e7a1864579cf5cb01d064bc4bb2">darkNoiseRate</a> &lt;&lt; <span class="stringliteral">&quot;) up to &quot;</span> &lt;&lt; maxTime;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <span class="keywordflow">while</span> (darkNoiseTime &lt; maxTime) {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="keyword">auto</span> <span class="keyword">const</span> [ <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac17a9af8a4cec78a3381487ba80cec42">tick</a>, subtick ] = toTickAndSubtick(darkNoiseTime * <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a065984ccb1859a6400c2d9f3262eb082">fSampling</a>);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordtype">double</span> <span class="keyword">const</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> = gainFluctuation(1.0); <span class="comment">// leakage is one photoelectron</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    MF_LOG_TRACE(<span class="stringliteral">&quot;PMTsimulationAlg&quot;</span>)</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      &lt;&lt; <span class="stringliteral">&quot; * at &quot;</span> &lt;&lt; darkNoiseTime &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac17a9af8a4cec78a3381487ba80cec42">tick</a> &lt;&lt; <span class="stringliteral">&quot;, subsample &quot;</span> &lt;&lt; subtick</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;) x&quot;</span> &lt;&lt; <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#afb930cd5f6dc4abe57cf291da9843103">AddPhotoelectrons</a></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      (<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aa822578c863e4bdcac980b9186f33ec1">wsp</a>.<a class="code" href="../../db/dce/classicarus_1_1opdet_1_1DiscretePhotoelectronPulse.html#af1639c366182633e4ed0e668f4322dd4">subsample</a>(subtick), wave, <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac17a9af8a4cec78a3381487ba80cec42">tick</a>, <span class="keyword">static_cast&lt;</span><a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a12abe3b053218a60ad6c171a10a9d44d">WaveformValue_t</a><span class="keyword">&gt;</span>(<a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>));</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="comment">// time of the next leakage event:</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    darkNoiseTime += <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1a4b5a32c44f2517357ca4ac43a1ec59">nanoseconds</a>{ random.fire() };</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  } <span class="comment">// while</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;} <span class="comment">// icarus::opdet::PMTsimulationAlg::AddDarkNoise()</span></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a1a4b5a32c44f2517357ca4ac43a1ec59"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1a4b5a32c44f2517357ca4ac43a1ec59">icarus::opdet::PMTsimulationAlg::nanoseconds</a></div><div class="ttdeci">util::quantities::nanosecond nanoseconds</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00344">PMTsimulationAlg.h:344</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_afb930cd5f6dc4abe57cf291da9843103"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#afb930cd5f6dc4abe57cf291da9843103">icarus::opdet::PMTsimulationAlg::AddPhotoelectrons</a></div><div class="ttdeci">void AddPhotoelectrons(PulseSampling_t const &amp;pulse, Waveform_t &amp;wave, tick const time_bin, WaveformValue_t const n) const </div><div class="ttdoc">Adds a number of pulses to a waveform, starting at a given tick. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00485">PMTsimulationAlg.cxx:485</a></div></div>
<div class="ttc" id="structutil_1_1quantities_1_1concepts_1_1Quantity_html_a8e5644f85ca8d28abcb85c3a4a47cf47"><div class="ttname"><a href="../../de/d7e/structutil_1_1quantities_1_1concepts_1_1Quantity.html#a8e5644f85ca8d28abcb85c3a4a47cf47">util::quantities::concepts::Quantity::value</a></div><div class="ttdeci">constexpr value_t value() const </div><div class="ttdoc">Returns the value of the quantity. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8e/quantities_8h_source.html#l00609">quantities.h:609</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_aa822578c863e4bdcac980b9186f33ec1"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aa822578c863e4bdcac980b9186f33ec1">icarus::opdet::PMTsimulationAlg::wsp</a></div><div class="ttdeci">DiscretePhotoelectronPulse wsp</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00582">PMTsimulationAlg.h:582</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_ac17a9af8a4cec78a3381487ba80cec42"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac17a9af8a4cec78a3381487ba80cec42">icarus::opdet::PMTsimulationAlg::tick</a></div><div class="ttdeci">util::quantities::tick tick</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00348">PMTsimulationAlg.h:348</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a12abe3b053218a60ad6c171a10a9d44d"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a12abe3b053218a60ad6c171a10a9d44d">icarus::opdet::PMTsimulationAlg::WaveformValue_t</a></div><div class="ttdeci">ADCcount::value_t WaveformValue_t</div><div class="ttdoc">Numeric type in waveforms. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00523">PMTsimulationAlg.h:523</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_acd6b208af8f729f9a99191c0531c390c"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#acd6b208af8f729f9a99191c0531c390c">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::darkNoiseRandomEngine</a></div><div class="ttdeci">CLHEP::HepRandomEngine * darkNoiseRandomEngine</div><div class="ttdoc">Dark noise random stream engine. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00462">PMTsimulationAlg.h:462</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a1021a841e3d7a47a2ff8458c982675ae"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">icarus::opdet::PMTsimulationAlg::fParams</a></div><div class="ttdeci">ConfigurationParameters_t fParams</div><div class="ttdoc">Complete algorithm configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00576">PMTsimulationAlg.h:576</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_aaf1e896492de61f7c4a0ac898bf206a4"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aaf1e896492de61f7c4a0ac898bf206a4">icarus::opdet::PMTsimulationAlg::makeGainFluctuator</a></div><div class="ttdeci">auto makeGainFluctuator() const </div><div class="ttdoc">Returns a configured gain fluctuator object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00166">PMTsimulationAlg.cxx:166</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1DiscretePhotoelectronPulse_html_a684b11f646cb1142e4c015b45561b37c"><div class="ttname"><a href="../../db/dce/classicarus_1_1opdet_1_1DiscretePhotoelectronPulse.html#a684b11f646cb1142e4c015b45561b37c">icarus::opdet::DiscretePhotoelectronPulse::nSubsamples</a></div><div class="ttdeci">SubsampleIndex_t nSubsamples() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/DiscretePhotoelectronPulse_8h_source.html#l00147">DiscretePhotoelectronPulse.h:147</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a1e586e7a1864579cf5cb01d064bc4bb2"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a1e586e7a1864579cf5cb01d064bc4bb2">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::darkNoiseRate</a></div><div class="ttdeci">hertz darkNoiseRate</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00438">PMTsimulationAlg.h:438</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a065984ccb1859a6400c2d9f3262eb082"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a065984ccb1859a6400c2d9f3262eb082">icarus::opdet::PMTsimulationAlg::fSampling</a></div><div class="ttdeci">megahertz fSampling</div><div class="ttdoc">Wave sampling frequency [MHz]. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00579">PMTsimulationAlg.h:579</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1DiscretePhotoelectronPulse_html_af1639c366182633e4ed0e668f4322dd4"><div class="ttname"><a href="../../db/dce/classicarus_1_1opdet_1_1DiscretePhotoelectronPulse.html#af1639c366182633e4ed0e668f4322dd4">icarus::opdet::DiscretePhotoelectronPulse::subsample</a></div><div class="ttdeci">decltype(auto) subsample(SubsampleIndex_t i) const </div><div class="ttdoc">Returns the subsample specified by index i, undefined if invalid. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/DiscretePhotoelectronPulse_8h_source.html#l00139">DiscretePhotoelectronPulse.h:139</a></div></div>
<div class="ttc" id="namespacechannelDBConverter_html_ab6cfbbcbb53c275375289d47dec67f46"><div class="ttname"><a href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">channelDBConverter.n</a></div><div class="ttdeci">int n</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d11/channelDBConverter_8py_source.html#l00249">channelDBConverter.py:249</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac6d7b198cc479276c88d3b483dccec4d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void icarus::opdet::PMTsimulationAlg::AddNoise </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> &amp;&#160;</td>
          <td class="paramname"><em>wave</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00526">526</a> of file <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html">PMTsimulationAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                                                                 {</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  CLHEP::RandGaussQ random</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    (*<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a11a9f35155aae7d239b7e5c25730e728">elecNoiseRandomEngine</a>, 0.0, <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a4c1862485da0052550e01a6ad150f88d">ampNoise</a>.<a class="code" href="../../de/d7e/structutil_1_1quantities_1_1concepts_1_1Quantity.html#a8e5644f85ca8d28abcb85c3a4a47cf47">value</a>());</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; sample: wave) {</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">ADCcount</a> <span class="keyword">const</span> noise { <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(random.fire()) }; <span class="comment">// Gaussian noise</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    sample += noise;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  } <span class="comment">// for sample</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;} <span class="comment">// PMTsimulationAlg::AddNoise()</span></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a4c1862485da0052550e01a6ad150f88d"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a4c1862485da0052550e01a6ad150f88d">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::ampNoise</a></div><div class="ttdeci">ADCcount ampNoise</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00436">PMTsimulationAlg.h:436</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_ad2e0cf8d4a2cb17d1646b87c43d93cdb"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">icarus::opdet::PMTsimulationAlg::ADCcount</a></div><div class="ttdeci">DiscretePhotoelectronPulse::ADCcount ADCcount</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00349">PMTsimulationAlg.h:349</a></div></div>
<div class="ttc" id="structutil_1_1quantities_1_1concepts_1_1Quantity_html_a8e5644f85ca8d28abcb85c3a4a47cf47"><div class="ttname"><a href="../../de/d7e/structutil_1_1quantities_1_1concepts_1_1Quantity.html#a8e5644f85ca8d28abcb85c3a4a47cf47">util::quantities::concepts::Quantity::value</a></div><div class="ttdeci">constexpr value_t value() const </div><div class="ttdoc">Returns the value of the quantity. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8e/quantities_8h_source.html#l00609">quantities.h:609</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a1021a841e3d7a47a2ff8458c982675ae"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">icarus::opdet::PMTsimulationAlg::fParams</a></div><div class="ttdeci">ConfigurationParameters_t fParams</div><div class="ttdoc">Complete algorithm configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00576">PMTsimulationAlg.h:576</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a11a9f35155aae7d239b7e5c25730e728"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a11a9f35155aae7d239b7e5c25730e728">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::elecNoiseRandomEngine</a></div><div class="ttdeci">CLHEP::HepRandomEngine * elecNoiseRandomEngine</div><div class="ttdoc">Electronics noise random stream engine. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00465">PMTsimulationAlg.h:465</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a691370223b9ee6837cf4a5e4d3e4843e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void icarus::opdet::PMTsimulationAlg::AddNoise_faster </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> &amp;&#160;</td>
          <td class="paramname"><em>wave</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Same as <code><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac6d7b198cc479276c88d3b483dccec4d">AddNoise()</a></code> but using an alternative generator. </p>

<p>Definition at line <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00539">539</a> of file <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html">PMTsimulationAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                                                                        {</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">    * Compared to AddNoise(), we use a somehow faster random generator;</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">    * to squeeze the CPU cycles, we avoid the CLHEP interface as much as</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">    * possible; the random number from the engine is immediately converted</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment">    * to single precision, and the rest of the math happens in there as well.</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">    * No virtual interfaces nor indirection is involved within this function</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">    * (except for CLHEP random engine). We generate a normal variable _z_</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">    * (standard deviation 1, mean 0) and we just scale it to the desired</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">    * standard deviation, not bothering to add the mean offset of 0.</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment">    * Note that unless the random engine is multi-thread safe, this function</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">    * won&#39;t gain anything from multi-threading.</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <span class="keyword">auto</span>&amp; engine = *<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a11a9f35155aae7d239b7e5c25730e728">elecNoiseRandomEngine</a>;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; sample: wave) {</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    sample += <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a4c1862485da0052550e01a6ad150f88d">ampNoise</a> * <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a4b68f81701dc84bf91a37f7038306b2a">fFastGauss</a>(engine.flat()); <span class="comment">// Gaussian noise</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  } <span class="comment">// for sample</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;} <span class="comment">// PMTsimulationAlg::AddNoise_faster()</span></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a4c1862485da0052550e01a6ad150f88d"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a4c1862485da0052550e01a6ad150f88d">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::ampNoise</a></div><div class="ttdeci">ADCcount ampNoise</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00436">PMTsimulationAlg.h:436</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a1021a841e3d7a47a2ff8458c982675ae"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">icarus::opdet::PMTsimulationAlg::fParams</a></div><div class="ttdeci">ConfigurationParameters_t fParams</div><div class="ttdoc">Complete algorithm configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00576">PMTsimulationAlg.h:576</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a11a9f35155aae7d239b7e5c25730e728"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a11a9f35155aae7d239b7e5c25730e728">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::elecNoiseRandomEngine</a></div><div class="ttdeci">CLHEP::HepRandomEngine * elecNoiseRandomEngine</div><div class="ttdoc">Electronics noise random stream engine. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00465">PMTsimulationAlg.h:465</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a4b68f81701dc84bf91a37f7038306b2a"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a4b68f81701dc84bf91a37f7038306b2a">icarus::opdet::PMTsimulationAlg::fFastGauss</a></div><div class="ttdeci">static util::FastAndPoorGauss&lt; 32768U, float &gt; const fFastGauss</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00587">PMTsimulationAlg.h:587</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afb930cd5f6dc4abe57cf291da9843103"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void icarus::opdet::PMTsimulationAlg::AddPhotoelectrons </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a954b0fdcf7649c843f9d268e39edd383">PulseSampling_t</a> const &amp;&#160;</td>
          <td class="paramname"><em>pulse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> &amp;&#160;</td>
          <td class="paramname"><em>wave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac17a9af8a4cec78a3381487ba80cec42">tick</a> const&#160;</td>
          <td class="paramname"><em>time_bin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a12abe3b053218a60ad6c171a10a9d44d">WaveformValue_t</a> const&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Adds a number of pulses to a waveform, starting at a given tick. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pulse</td><td>the sampling to add, scaled, to the waveform </td></tr>
    <tr><td class="paramname">wave</td><td>the waveform the pulses will be added to </td></tr>
    <tr><td class="paramname">time_bin</td><td>the tick of the waveform where the pulses start being added </td></tr>
    <tr><td class="paramname">n</td><td>the number of pulses added (it may be fractional)</td></tr>
  </table>
  </dd>
</dl>
<p>All the samples of <code>pulse</code> are scaled by the factor <code>n</code> and then <em>added</em> to the sampling waveform <code>wave</code>, starting from the <code>time_bin</code> sample of this waveform.</p>
<p>The <code>pulse</code> samples are a sequence of ADC counts describing the single photoelectron pulse shape. The waveform is also a sequence of samples representing a optical detector channel digitized waveform, starting at tick #0. </p>

<p>Definition at line <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00485">485</a> of file <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html">PMTsimulationAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        {</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> == 0.0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> == 1.0) {</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="comment">// simple addition</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#af2d381df812b9bb055fe4ef4f5e82c98">AddPulseShape</a>(pulse, wave, time_bin, std::plus&lt;ADCcount&gt;());</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  }</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="comment">// multiply each `pulse` sample by `n`:</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#af2d381df812b9bb055fe4ef4f5e82c98">AddPulseShape</a>(pulse, wave, time_bin, [<a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>](<span class="keyword">auto</span> <a class="code" href="../../d0/d8f/decode__signalprocess__icarus_8fcl.html#a2a105cb669129f9c63eb7a4c15bf2d9b">a</a>, <span class="keyword">auto</span> b) { <span class="keywordflow">return</span> <a class="code" href="../../d0/d8f/decode__signalprocess__icarus_8fcl.html#a2a105cb669129f9c63eb7a4c15bf2d9b">a</a>+<a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>*b; });</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  }</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;} <span class="comment">// icarus::opdet::PMTsimulationAlg::AddPhotoelectrons()</span></div>
<div class="ttc" id="decode__signalprocess__icarus_8fcl_html_a2a105cb669129f9c63eb7a4c15bf2d9b"><div class="ttname"><a href="../../d0/d8f/decode__signalprocess__icarus_8fcl.html#a2a105cb669129f9c63eb7a4c15bf2d9b">a</a></div><div class="ttdeci">process_name gaushit a</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8f/decode__signalprocess__icarus_8fcl_source.html#l00037">decode_signalprocess_icarus.fcl:37</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_af2d381df812b9bb055fe4ef4f5e82c98"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#af2d381df812b9bb055fe4ef4f5e82c98">icarus::opdet::PMTsimulationAlg::AddPulseShape</a></div><div class="ttdeci">void AddPulseShape(PulseSampling_t const &amp;pulse, Waveform_t &amp;wave, tick const time_bin, Combine combination) const </div><div class="ttdoc">Adds a pulse to a waveform, starting at a given tick. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00506">PMTsimulationAlg.cxx:506</a></div></div>
<div class="ttc" id="namespacechannelDBConverter_html_ab6cfbbcbb53c275375289d47dec67f46"><div class="ttname"><a href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">channelDBConverter.n</a></div><div class="ttdeci">int n</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d11/channelDBConverter_8py_source.html#l00249">channelDBConverter.py:249</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af2d381df812b9bb055fe4ef4f5e82c98"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Combine &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void icarus::opdet::PMTsimulationAlg::AddPulseShape </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a954b0fdcf7649c843f9d268e39edd383">PulseSampling_t</a> const &amp;&#160;</td>
          <td class="paramname"><em>pulse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> &amp;&#160;</td>
          <td class="paramname"><em>wave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac17a9af8a4cec78a3381487ba80cec42">tick</a> const&#160;</td>
          <td class="paramname"><em>time_bin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Combine&#160;</td>
          <td class="paramname"><em>combination</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Adds a pulse to a waveform, starting at a given tick. </p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">Combine</td><td>binary operation combining two ADC counts into one </td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pulse</td><td>the sampling to add to the waveform </td></tr>
    <tr><td class="paramname">wave</td><td>the waveform the pulse will be added to </td></tr>
    <tr><td class="paramname">time_bin</td><td>the tick of the waveform where the pulse starts </td></tr>
    <tr><td class="paramname">combination</td><td>how to combine the pulse and the waveform</td></tr>
  </table>
  </dd>
</dl>
<p>This is the internal implementation of <code><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#afb930cd5f6dc4abe57cf291da9843103" title="Adds a number of pulses to a waveform, starting at a given tick. ">AddPhotoelectrons()</a></code>.</p>
<p>The <code>combination</code> functor behaves as a binary function taking the existing <code>wave</code> sample and the sample from the <code>pulse</code> at the same time and returning their combination as a new sample value. </p>

<p>Definition at line <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00506">506</a> of file <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html">PMTsimulationAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;{</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  std::size_t <span class="keyword">const</span> min = time_bin.value();</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  std::size_t <span class="keyword">const</span> <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">max</a> = std::min(min + pulse.size(), <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#abc9b79707c1b8f5afc175fdc8cd51eb0">fNsamples</a>);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="keywordflow">if</span> (min &gt;= max) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <a class="code" href="../../d5/d45/namespaceicarus_1_1waveform__operations_1_1details.html#ae295d3f6cb2f9181dccdf0e3492d44e0">std::transform</a>(</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    wave.begin() + min, wave.begin() + <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">max</a>,</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    pulse.begin(),</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    wave.begin() + min,</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    combination</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    );</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;} <span class="comment">// icarus::opdet::PMTsimulationAlg::AddPulseShape()</span></div>
<div class="ttc" id="namespaceicarus_1_1waveform__operations_1_1details_html_ae295d3f6cb2f9181dccdf0e3492d44e0"><div class="ttname"><a href="../../d5/d45/namespaceicarus_1_1waveform__operations_1_1details.html#ae295d3f6cb2f9181dccdf0e3492d44e0">icarus::waveform_operations::details::transform</a></div><div class="ttdeci">static constexpr Sample_t transform(Sample_t sample)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d8e/WaveformOperations_8h_source.html#l00145">WaveformOperations.h:145</a></div></div>
<div class="ttc" id="pmttriggerproducer_8fcl_html_a527d89be40c3c20ca8162df059180fd9"><div class="ttname"><a href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">max</a></div><div class="ttdeci">BEGIN_PROLOG pmt_uncoated ideal single PE test page of manual option are OR or AND window for pmt trigger time start window for pmt trigger time end etc then what events all hists are saved for max</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5a/pmttriggerproducer_8fcl_source.html#l00023">pmttriggerproducer.fcl:23</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_abc9b79707c1b8f5afc175fdc8cd51eb0"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#abc9b79707c1b8f5afc175fdc8cd51eb0">icarus::opdet::PMTsimulationAlg::fNsamples</a></div><div class="ttdeci">std::size_t fNsamples</div><div class="ttdoc">Samples per waveform. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00580">PMTsimulationAlg.h:580</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a25afa671a2eb775f7bdc2ac926043af1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void icarus::opdet::PMTsimulationAlg::ApplySaturation </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> &amp;&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::pair&lt; <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">ADCcount</a>, <a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">ADCcount</a> &gt; const &amp;&#160;</td>
          <td class="paramname"><em>range</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Applies the configured photoelectron saturation on the <code>waveform</code>, only if the saturation is cutting into the digitisation range. </p>

<p>Definition at line <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00650">650</a> of file <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html">PMTsimulationAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;{</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="comment">// simple sharp capping/cupping of ADC values</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <span class="keyword">auto</span> <span class="keyword">const</span> boundaries = <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a66a3549968d1767268dbfe90f41e774e">saturationRange</a>();</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  </div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="comment">// saturation is out of boundaries: do not apply it.</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  <span class="keywordflow">if</span> ((boundaries.first &lt;= range.first) &amp;&amp; (boundaries.second &gt;= range.second))</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  </div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a691d908788045d83e9b9ea10f6e8edd3">ClipWaveform</a>(waveform, boundaries.first, boundaries.second);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  </div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;} <span class="comment">// icarus::opdet::PMTsimulationAlg::ApplySaturation(range)</span></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a66a3549968d1767268dbfe90f41e774e"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a66a3549968d1767268dbfe90f41e774e">icarus::opdet::PMTsimulationAlg::saturationRange</a></div><div class="ttdeci">std::pair&lt; ADCcount, ADCcount &gt; saturationRange() const </div><div class="ttdoc">Returns the ADC range allowed for photoelectron saturation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00621">PMTsimulationAlg.cxx:621</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a691d908788045d83e9b9ea10f6e8edd3"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a691d908788045d83e9b9ea10f6e8edd3">icarus::opdet::PMTsimulationAlg::ClipWaveform</a></div><div class="ttdeci">static void ClipWaveform(Waveform_t &amp;waveform, ADCcount min, ADCcount max)</div><div class="ttdoc">Forces waveform ADC within the min to max range (max included). </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00669">PMTsimulationAlg.cxx:669</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2859193987b27cd34cc9f36da28eac9b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void icarus::opdet::PMTsimulationAlg::ApplySaturation </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> &amp;&#160;</td>
          <td class="paramname"><em>waveform</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Applies the configured photoelectron saturation on the <code>waveform</code>. </p>

<p>Definition at line <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00637">637</a> of file <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html">PMTsimulationAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;{</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <span class="comment">// simple sharp capping/cupping of ADC values</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  <span class="keyword">auto</span> <span class="keyword">const</span> boundaries = <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a66a3549968d1767268dbfe90f41e774e">saturationRange</a>();</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a691d908788045d83e9b9ea10f6e8edd3">ClipWaveform</a>(waveform, boundaries.first, boundaries.second);</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  </div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;} <span class="comment">// icarus::opdet::PMTsimulationAlg::ApplySaturation()</span></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a66a3549968d1767268dbfe90f41e774e"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a66a3549968d1767268dbfe90f41e774e">icarus::opdet::PMTsimulationAlg::saturationRange</a></div><div class="ttdeci">std::pair&lt; ADCcount, ADCcount &gt; saturationRange() const </div><div class="ttdoc">Returns the ADC range allowed for photoelectron saturation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00621">PMTsimulationAlg.cxx:621</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a691d908788045d83e9b9ea10f6e8edd3"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a691d908788045d83e9b9ea10f6e8edd3">icarus::opdet::PMTsimulationAlg::ClipWaveform</a></div><div class="ttdeci">static void ClipWaveform(Waveform_t &amp;waveform, ADCcount min, ADCcount max)</div><div class="ttdoc">Forces waveform ADC within the min to max range (max included). </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00669">PMTsimulationAlg.cxx:669</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a691d908788045d83e9b9ea10f6e8edd3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void icarus::opdet::PMTsimulationAlg::ClipWaveform </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> &amp;&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">ADCcount</a>&#160;</td>
          <td class="paramname"><em>min</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">ADCcount</a>&#160;</td>
          <td class="paramname"><em>max</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Forces <code>waveform</code> ADC within the <code>min</code> to <code>max</code> range (<code>max</code> included). </p>

<p>Definition at line <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00669">669</a> of file <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html">PMTsimulationAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;{</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <span class="keyword">using</span> ClamperFunc_t = std::function&lt;ADCcount(ADCcount)&gt;;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  ClamperFunc_t <span class="keyword">const</span> clamper =</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    (min == std::numeric_limits&lt;ADCcount&gt;::min())</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      ? ((<a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">max</a> == <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::numeric_limits&lt;ADCcount&gt;::max</a>())</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        ? ClamperFunc_t{ [](<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">ADCcount</a> <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>){ <span class="keywordflow">return</span> <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>; } }</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        : ClamperFunc_t{ [<a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">max</a>](<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">ADCcount</a> <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>){ <span class="keywordflow">return</span> std::min(<a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>, <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">max</a>); } }</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        )</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      : ((<a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">max</a> == <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::numeric_limits&lt;ADCcount&gt;::max</a>())</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        ? ClamperFunc_t{ [min](<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">ADCcount</a> <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>){ <span class="keywordflow">return</span> <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::max</a>(<a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>, min); } }</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        : ClamperFunc_t{ [min,<a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">max</a>](<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">ADCcount</a> <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>){ <span class="keywordflow">return</span> std::clamp(<a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>, min, <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">max</a>); } }</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        )</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      ;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  </div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <a class="code" href="../../d5/d45/namespaceicarus_1_1waveform__operations_1_1details.html#ae295d3f6cb2f9181dccdf0e3492d44e0">std::transform</a>(waveform.cbegin(), waveform.cend(), waveform.begin(), clamper);</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  </div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;} <span class="comment">// icarus::opdet::PMTsimulationAlg::ClipWaveform()</span></div>
<div class="ttc" id="namespaceicarus_1_1waveform__operations_1_1details_html_ae295d3f6cb2f9181dccdf0e3492d44e0"><div class="ttname"><a href="../../d5/d45/namespaceicarus_1_1waveform__operations_1_1details.html#ae295d3f6cb2f9181dccdf0e3492d44e0">icarus::waveform_operations::details::transform</a></div><div class="ttdeci">static constexpr Sample_t transform(Sample_t sample)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d8e/WaveformOperations_8h_source.html#l00145">WaveformOperations.h:145</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_ad2e0cf8d4a2cb17d1646b87c43d93cdb"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">icarus::opdet::PMTsimulationAlg::ADCcount</a></div><div class="ttdeci">DiscretePhotoelectronPulse::ADCcount ADCcount</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00349">PMTsimulationAlg.h:349</a></div></div>
<div class="ttc" id="pmttriggerproducer_8fcl_html_a527d89be40c3c20ca8162df059180fd9"><div class="ttname"><a href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">max</a></div><div class="ttdeci">BEGIN_PROLOG pmt_uncoated ideal single PE test page of manual option are OR or AND window for pmt trigger time start window for pmt trigger time end etc then what events all hists are saved for max</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5a/pmttriggerproducer_8fcl_source.html#l00023">pmttriggerproducer.fcl:23</a></div></div>
<div class="ttc" id="file__to__url_8sh_html_a096ad3d3698082826189c839d7a6e46f"><div class="ttname"><a href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a></div><div class="ttdeci">then echo File list $list not found else cat $list while read file do echo $file sed s</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dea/file__to__url_8sh_source.html#l00060">file_to_url.sh:60</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aed3ee1aca2df9768fe265bdb9cb8445d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">auto icarus::opdet::PMTsimulationAlg::CreateBeamGateTriggers </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generate periodic interest points regardless the actual activity. </p>
<dl class="section return"><dt>Returns</dt><dd>a collection of ticks where we pretend interesting activity to be </dd></dl>
<dl class="section see"><dt>See Also</dt><dd><code><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a6224483efa2ef00a01f342155bceec40" title="Ticks in the specified waveform where some signal activity starts. ">FindTriggers()</a></code></dd></dl>
<p>This methods emits a list of interest points according to the algorithm configuration. More precisely, if <code>CreateBeamGateTriggers</code> is configured <code>true</code>, <code>BeamGateTriggerNReps</code> interest points are generated at <code>BeamGateTriggerRepPeriod</code> intervals, starting from the beam gate time as defined by <code>detinfo::DetectorClocks::BeamGateTime()</code>.</p>
<p>See <code><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a6224483efa2ef00a01f342155bceec40" title="Ticks in the specified waveform where some signal activity starts. ">FindTriggers()</a></code> for the meaning of "interest point".</p>
<dl class="section note"><dt>Note</dt><dd>It is assumed that tick <code>0</code> happens at a time defined by <code>triggerOffsetPMT</code> configuration parameter <em>after</em> the trigger (but since the value of that parameter is expected to be negative, tick <code>0</code> effectively happens <em>before</em> the trigger). </dd></dl>

<p>Definition at line <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00309">309</a> of file <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html">PMTsimulationAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  {</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keyword">using namespace </span>util::quantities::time_literals;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keyword">using</span> <a class="code" href="../../dc/d8b/namespacedetinfo_1_1timescales.html#a2b8928419b3d7ef5fbf3bb593e8d244f">detinfo::timescales::trigger_time</a>;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <a class="code" href="../../de/d0f/classdetinfo_1_1DetectorTimings.html">detinfo::DetectorTimings</a> <span class="keyword">const</span>&amp; timings</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      = <a class="code" href="../../d7/d8a/namespacedetinfo.html#a2ef927ca9aaa32d366a9a0d26e7e14e7">detinfo::makeDetectorTimings</a>(<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a8ec7dc1deeb6c93abbb033199247d5f7">clockData</a>);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    std::vector&lt;optical_tick&gt; trigger_locations;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    trigger_locations.reserve(<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#acb01a00c1f6b20164ef776951a043cfe">beamGateTriggerNReps</a>);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <a class="code" href="../../dc/d8b/namespacedetinfo_1_1timescales.html#a2b8928419b3d7ef5fbf3bb593e8d244f">trigger_time</a> <span class="keyword">const</span> beamTime = timings.toTriggerTime(timings.BeamGateTime());</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i_trig=0; i_trig&lt;<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#acb01a00c1f6b20164ef776951a043cfe">beamGateTriggerNReps</a>; ++i_trig) {</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <a class="code" href="../../dc/d8b/namespacedetinfo_1_1timescales.html#a2b8928419b3d7ef5fbf3bb593e8d244f">trigger_time</a> <span class="keyword">const</span> trig_time</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        = beamTime</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        + i_trig * <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a8c1b77820129a67f0b98a97f0aafff63">beamGateTriggerRepPeriod</a></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        - <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#ac48e6f6eace5142a577b090497187d6b">triggerOffsetPMT</a></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        ;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      <span class="keywordflow">if</span> (trig_time &lt; 0_us) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <span class="keywordflow">if</span> (trig_time &gt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#af69895d00bb9925a1920418ca52a5e50">readoutEnablePeriod</a>) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      trigger_locations.push_back</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        (optical_tick::castFrom(trig_time.quantity()*<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a065984ccb1859a6400c2d9f3262eb082">fSampling</a>));</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    }</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keywordflow">return</span> trigger_locations;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  }</div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_acb01a00c1f6b20164ef776951a043cfe"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#acb01a00c1f6b20164ef776951a043cfe">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::beamGateTriggerNReps</a></div><div class="ttdeci">size_t beamGateTriggerNReps</div><div class="ttdoc">Number of beamgate trigger reps to produce. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00430">PMTsimulationAlg.h:430</a></div></div>
<div class="ttc" id="namespacedetinfo_1_1timescales_html_a2b8928419b3d7ef5fbf3bb593e8d244f"><div class="ttname"><a href="../../dc/d8b/namespacedetinfo_1_1timescales.html#a2b8928419b3d7ef5fbf3bb593e8d244f">detinfo::timescales::trigger_time</a></div><div class="ttdeci">timescale_traits&lt; TriggerTimeCategory &gt;::time_point_t trigger_time</div><div class="ttdoc">A point in time on the trigger time scale. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/daf/DetectorTimingTypes_8h_source.html#l00355">DetectorTimingTypes.h:355</a></div></div>
<div class="ttc" id="namespacedetinfo_html_a2ef927ca9aaa32d366a9a0d26e7e14e7"><div class="ttname"><a href="../../d7/d8a/namespacedetinfo.html#a2ef927ca9aaa32d366a9a0d26e7e14e7">detinfo::makeDetectorTimings</a></div><div class="ttdeci">detinfo::DetectorTimings makeDetectorTimings(detinfo::DetectorClocksData const &amp;detClocks)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd2/DetectorTimings_8h_source.html#l00698">DetectorTimings.h:698</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_af69895d00bb9925a1920418ca52a5e50"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#af69895d00bb9925a1920418ca52a5e50">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::readoutEnablePeriod</a></div><div class="ttdeci">microseconds readoutEnablePeriod</div><div class="ttdoc">Time (us) for which pmt readout is enabled. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00426">PMTsimulationAlg.h:426</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_ac48e6f6eace5142a577b090497187d6b"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#ac48e6f6eace5142a577b090497187d6b">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::triggerOffsetPMT</a></div><div class="ttdeci">microseconds triggerOffsetPMT</div><div class="ttdoc">Time relative to trigger when PMT readout starts TODO make it a trigger_time point. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00424">PMTsimulationAlg.h:424</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a1021a841e3d7a47a2ff8458c982675ae"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">icarus::opdet::PMTsimulationAlg::fParams</a></div><div class="ttdeci">ConfigurationParameters_t fParams</div><div class="ttdoc">Complete algorithm configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00576">PMTsimulationAlg.h:576</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a065984ccb1859a6400c2d9f3262eb082"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a065984ccb1859a6400c2d9f3262eb082">icarus::opdet::PMTsimulationAlg::fSampling</a></div><div class="ttdeci">megahertz fSampling</div><div class="ttdoc">Wave sampling frequency [MHz]. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00579">PMTsimulationAlg.h:579</a></div></div>
<div class="ttc" id="classdetinfo_1_1DetectorTimings_html"><div class="ttname"><a href="../../de/d0f/classdetinfo_1_1DetectorTimings.html">detinfo::DetectorTimings</a></div><div class="ttdoc">A class exposing an upgraded interface of detinfo::DetectorClocksData. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd2/DetectorTimings_8h_source.html#l00249">DetectorTimings.h:249</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a8c1b77820129a67f0b98a97f0aafff63"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a8c1b77820129a67f0b98a97f0aafff63">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::beamGateTriggerRepPeriod</a></div><div class="ttdeci">microseconds beamGateTriggerRepPeriod</div><div class="ttdoc">Repetition Period (us) for BeamGateTriggers TODO make this a time_interval. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00429">PMTsimulationAlg.h:429</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a8ec7dc1deeb6c93abbb033199247d5f7"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a8ec7dc1deeb6c93abbb033199247d5f7">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::clockData</a></div><div class="ttdeci">detinfo::DetectorClocksData const * clockData</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00450">PMTsimulationAlg.h:450</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a62ac2002e5d89c6823141d90869bbab7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; <a class="el" href="../../d0/d29/classraw_1_1OpDetWaveform.html">raw::OpDetWaveform</a> &gt; icarus::opdet::PMTsimulationAlg::CreateFixedSizeOpDetWaveforms </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d63/namespaceraw.html#ab3db8feaa51f2c564eb00582c3d72590">raw::Channel_t</a>&#160;</td>
          <td class="paramname"><em>opChannel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> const &amp;&#160;</td>
          <td class="paramname"><em>waveform</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Creates <code><a class="el" href="../../d0/d29/classraw_1_1OpDetWaveform.html">raw::OpDetWaveform</a></code> objects from a waveform data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">opChannel</td><td>number of optical detector channel the data belongs to </td></tr>
    <tr><td class="paramname">waveform</td><td>the waveform data </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a collection of <code><a class="el" href="../../d0/d29/classraw_1_1OpDetWaveform.html">raw::OpDetWaveform</a></code></dd></dl>
<p>The waveform data is a sequence of samples on the optical detector channel, starting at the beginning of the optical time clock, that is set by the algorithm configuration as the global hardware trigger time (configured in <code><a class="el" href="../../d5/dd8/classdetinfo_1_1DetectorClocks.html" title="Class used for the conversion of times between different formats and references. ">detinfo::DetectorClocks</a></code>) and an offset. It may be obtained from <code><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#adfc2a89d72e18b0b3df4375fb06dc023" title="Creates raw::OpDetWaveform objects from simulated photoelectrons. ">CreateFullWaveform()</a></code>.</p>
<p>Multiple waveforms may be returned for a single channel, since a form of zero suppression is applied by the simulated hardware. The waveforms are guaranteed to be non-overlapping, non-contiguous and sorted with increasing timestamp.</p>
<p>The procedure attempts to mimic the working mode of CAEN V1730B boards as described on page 32 of the manual "UM2792_V1730_V1725_rev2.pdf" in SBN DocDB 15024.</p>
<h2>Algorithm details </h2>
<p>In the board readout language, the "trigger" is the per-channel information that the signal on the channel has passed the threshold.</p>
<p>It is critical to understand the details of the generation of the triggers. At the time of writing, the algorithm in <code><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a6224483efa2ef00a01f342155bceec40" title="Ticks in the specified waveform where some signal activity starts. ">FindTriggers()</a></code> emits a trigger every time the signal passes from under threshold to beyond threshold. Assuming that the threshold is at less than one photoelectron, this kind of behavior implies that every scintillation photons arriving on the tail of the first (large?) signal will add a new waveform in tail. It is not clear what happens if <em>two</em> more triggers happen while the window from the first trigger is still open.</p>
<p>The assumptions in the code include:</p>
<ol type="1">
<li>overlapped triggers are not discarded (p. 32);</li>
<li>board is set for self-trigger (p. 38);</li>
<li>each waveform has a fixed duration (except the ones overlapping the previous one);</li>
<li>when a trigger starts the recording window on a channel, only the last trigger happening during that window ("overlapping"), if any, is kept.</li>
<li>at decoding time, contiguous buffers are merged in a single waveform</li>
</ol>
<p>The fixed duration of the waveform if the sum of pre- and post-trigger window length. If during this window another trigger is emitted, a new window will follow the current one and it will be long enough to contain all the post-trigger data. </p>

<p>Definition at line <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00377">377</a> of file <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html">PMTsimulationAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;{</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">   * Plan:</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">   * </span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">   * 1. set up</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">   * 2. get the trigger points of the waveform</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">   * 3. define the size of data around each trigger to commit to waveforms</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">   *    (also merge contiguous and overlapping intervals)</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">   * 4. create the actual `raw::OpDetWaveform` objects</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">   * </span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="comment">// parameters check and setup</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <span class="comment">// not a big deal if this assertion fails, but a bit more care needs to be</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="comment">// taken in comparisons and subtractions</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  static_assert(</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    std::is_signed_v&lt;optical_tick::value_t&gt;,</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="stringliteral">&quot;This algorithm requires tick type to be signed.&quot;</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    );</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="keyword">using namespace </span>detinfo::timescales; <span class="comment">// electronics_time, time_interval, ...</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="keyword">auto</span> <span class="keyword">const</span> pretrigSize = optical_time_ticks::castFrom(<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#ae6361658d570219f4d2e28f76f59293b">pretrigSize</a>());</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <span class="keyword">auto</span> <span class="keyword">const</span> posttrigSize = optical_time_ticks::castFrom(<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a3995f8c4c0616c4b6ba58d0fb46c3887">posttrigSize</a>());</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <a class="code" href="../../de/d0f/classdetinfo_1_1DetectorTimings.html">detinfo::DetectorTimings</a> <span class="keyword">const</span>&amp; timings</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    = <a class="code" href="../../d7/d8a/namespacedetinfo.html#a2ef927ca9aaa32d366a9a0d26e7e14e7">detinfo::makeDetectorTimings</a>(<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a8ec7dc1deeb6c93abbb033199247d5f7">clockData</a>);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="comment">// first viable tick number: since this is the item index in `wvfm`, it&#39;s 0</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <a class="code" href="../../dc/d8b/namespacedetinfo_1_1timescales.html#aafa6c859759c919622c301178d4fe4d6">optical_tick</a> <span class="keyword">const</span> firstTick { 0 };</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="comment">// use hardware trigger time plus the configured offset as waveform start time</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a483ae1c29f3c72dce79fe70a9bbd19d0">OpDetWaveformMaker_t</a> createOpDetWaveform {</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    waveform,</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    timings.TriggerTime() + <a class="code" href="../../d2/dc6/structutil_1_1quantities_1_1concepts_1_1Interval.html">time_interval</a>{ <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#ac48e6f6eace5142a577b090497187d6b">triggerOffsetPMT</a> },</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    1.0 / <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a065984ccb1859a6400c2d9f3262eb082">fSampling</a></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    };</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="comment">// get the PMT channel triggers to consider</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="comment">// prepare the set of triggers</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  std::vector&lt;optical_tick&gt; <span class="keyword">const</span> trigger_locations = <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a6224483efa2ef00a01f342155bceec40">FindTriggers</a>(waveform);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="keyword">auto</span> <span class="keyword">const</span> tend = trigger_locations.end();</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="comment">// find the first viable trigger</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <span class="keyword">auto</span> tooEarlyTrigger = [earliest = firstTick + pretrigSize](<a class="code" href="../../dc/d8b/namespacedetinfo_1_1timescales.html#aafa6c859759c919622c301178d4fe4d6">optical_tick</a> t)</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    { <span class="keywordflow">return</span> t &lt; earliest; };</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <span class="keyword">auto</span> iNextTrigger</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    = std::find_if_not(trigger_locations.begin(), tend, tooEarlyTrigger);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  </div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="comment">// collect all buffer ranges and merge them</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <span class="keyword">using</span> BufferRange_t = <a class="code" href="../../d4/d81/classicarus_1_1opdet_1_1OpDetWaveformMakerClass.html#a761b84c7c0bfdff3e310abb918e7daf5">OpDetWaveformMaker_t::BufferRange_t</a>;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keyword">auto</span> makeBuffer</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    = [pretrigSize, posttrigSize](<a class="code" href="../../dc/d8b/namespacedetinfo_1_1timescales.html#aafa6c859759c919622c301178d4fe4d6">optical_tick</a> triggerTime) -&gt; BufferRange_t</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    { <span class="keywordflow">return</span> { triggerTime - pretrigSize, triggerTime + posttrigSize }; }</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    ;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  std::vector&lt;BufferRange_t&gt; buffers;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  buffers.reserve(std::distance(iNextTrigger, tend)); <span class="comment">// worst case</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keyword">auto</span> earliestBufferStart { firstTick };</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="keywordflow">while</span> (iNextTrigger != tend) {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    BufferRange_t <span class="keyword">const</span> buffer = makeBuffer(*iNextTrigger);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">if</span> (buffer.first &lt; earliestBufferStart) { <span class="comment">// extend the previous buffer</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      assert(!buffers.empty()); <span class="comment">// guaranteed because we skipped early triggers</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      buffers.back().second = buffer.second;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    }</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="keywordflow">else</span> buffers.emplace_back(buffer);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    </div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    earliestBufferStart = buffer.second;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    </div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    ++iNextTrigger;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  } <span class="comment">// while</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="comment">// turn each buffer into a waveform</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  MF_LOG_TRACE(<span class="stringliteral">&quot;PMTsimulationAlg&quot;</span>)</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    &lt;&lt; <span class="stringliteral">&quot;Channel #&quot;</span> &lt;&lt; opChannel &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; buffers.size() &lt;&lt; <span class="stringliteral">&quot; waveforms for &quot;</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    &lt;&lt; trigger_locations.size() &lt;&lt; <span class="stringliteral">&quot; triggers&quot;</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    ;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  std::vector&lt;raw::OpDetWaveform&gt; output_opdets;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="keywordflow">for</span> (BufferRange_t <span class="keyword">const</span>&amp; buffer: buffers) {</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    output_opdets.push_back(createOpDetWaveform(opChannel, buffer));</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  } <span class="comment">// for buffers</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="keywordflow">return</span> output_opdets;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;} <span class="comment">// icarus::opdet::PMTsimulationAlg::CreateFixedSizeOpDetWaveforms()</span></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a483ae1c29f3c72dce79fe70a9bbd19d0"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a483ae1c29f3c72dce79fe70a9bbd19d0">icarus::opdet::PMTsimulationAlg::OpDetWaveformMaker_t</a></div><div class="ttdeci">icarus::opdet::OpDetWaveformMakerClass&lt; ADCcount &gt; OpDetWaveformMaker_t</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00519">PMTsimulationAlg.h:519</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_ae6361658d570219f4d2e28f76f59293b"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#ae6361658d570219f4d2e28f76f59293b">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::pretrigSize</a></div><div class="ttdeci">std::size_t pretrigSize() const </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00475">PMTsimulationAlg.h:475</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a6224483efa2ef00a01f342155bceec40"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a6224483efa2ef00a01f342155bceec40">icarus::opdet::PMTsimulationAlg::FindTriggers</a></div><div class="ttdeci">std::vector&lt; optical_tick &gt; FindTriggers(Waveform_t const &amp;wvfm) const </div><div class="ttdoc">Ticks in the specified waveform where some signal activity starts. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00336">PMTsimulationAlg.cxx:336</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a3995f8c4c0616c4b6ba58d0fb46c3887"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a3995f8c4c0616c4b6ba58d0fb46c3887">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::posttrigSize</a></div><div class="ttdeci">std::size_t posttrigSize() const </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00476">PMTsimulationAlg.h:476</a></div></div>
<div class="ttc" id="namespacedetinfo_html_a2ef927ca9aaa32d366a9a0d26e7e14e7"><div class="ttname"><a href="../../d7/d8a/namespacedetinfo.html#a2ef927ca9aaa32d366a9a0d26e7e14e7">detinfo::makeDetectorTimings</a></div><div class="ttdeci">detinfo::DetectorTimings makeDetectorTimings(detinfo::DetectorClocksData const &amp;detClocks)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd2/DetectorTimings_8h_source.html#l00698">DetectorTimings.h:698</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_ac48e6f6eace5142a577b090497187d6b"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#ac48e6f6eace5142a577b090497187d6b">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::triggerOffsetPMT</a></div><div class="ttdeci">microseconds triggerOffsetPMT</div><div class="ttdoc">Time relative to trigger when PMT readout starts TODO make it a trigger_time point. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00424">PMTsimulationAlg.h:424</a></div></div>
<div class="ttc" id="structutil_1_1quantities_1_1concepts_1_1Interval_html"><div class="ttname"><a href="../../d2/dc6/structutil_1_1quantities_1_1concepts_1_1Interval.html">util::quantities::concepts::Interval</a></div><div class="ttdoc">An interval (duration, length, distance) between two quantity points. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d02/intervals_8h_source.html#l00114">intervals.h:114</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a1021a841e3d7a47a2ff8458c982675ae"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">icarus::opdet::PMTsimulationAlg::fParams</a></div><div class="ttdeci">ConfigurationParameters_t fParams</div><div class="ttdoc">Complete algorithm configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00576">PMTsimulationAlg.h:576</a></div></div>
<div class="ttc" id="namespacedetinfo_1_1timescales_html_aafa6c859759c919622c301178d4fe4d6"><div class="ttname"><a href="../../dc/d8b/namespacedetinfo_1_1timescales.html#aafa6c859759c919622c301178d4fe4d6">detinfo::timescales::optical_tick</a></div><div class="ttdeci">timescale_traits&lt; OpticalTimeCategory &gt;::tick_t optical_tick</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/daf/DetectorTimingTypes_8h_source.html#l00422">DetectorTimingTypes.h:422</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a065984ccb1859a6400c2d9f3262eb082"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a065984ccb1859a6400c2d9f3262eb082">icarus::opdet::PMTsimulationAlg::fSampling</a></div><div class="ttdeci">megahertz fSampling</div><div class="ttdoc">Wave sampling frequency [MHz]. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00579">PMTsimulationAlg.h:579</a></div></div>
<div class="ttc" id="classdetinfo_1_1DetectorTimings_html"><div class="ttname"><a href="../../de/d0f/classdetinfo_1_1DetectorTimings.html">detinfo::DetectorTimings</a></div><div class="ttdoc">A class exposing an upgraded interface of detinfo::DetectorClocksData. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd2/DetectorTimings_8h_source.html#l00249">DetectorTimings.h:249</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1OpDetWaveformMakerClass_html_a761b84c7c0bfdff3e310abb918e7daf5"><div class="ttname"><a href="../../d4/d81/classicarus_1_1opdet_1_1OpDetWaveformMakerClass.html#a761b84c7c0bfdff3e310abb918e7daf5">icarus::opdet::OpDetWaveformMakerClass::BufferRange_t</a></div><div class="ttdeci">std::pair&lt; detinfo::timescales::optical_tick, detinfo::timescales::optical_tick &gt; BufferRange_t</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00090">PMTsimulationAlg.h:90</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a8ec7dc1deeb6c93abbb033199247d5f7"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a8ec7dc1deeb6c93abbb033199247d5f7">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::clockData</a></div><div class="ttdeci">detinfo::DetectorClocksData const * clockData</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00450">PMTsimulationAlg.h:450</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adfc2a89d72e18b0b3df4375fb06dc023"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">auto icarus::opdet::PMTsimulationAlg::CreateFullWaveform </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d3/dd1/classsim_1_1SimPhotons.html">sim::SimPhotons</a> const &amp;&#160;</td>
          <td class="paramname"><em>photons</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::optional&lt; <a class="el" href="../../d3/dd1/classsim_1_1SimPhotons.html">sim::SimPhotons</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>photons_used</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Creates <code><a class="el" href="../../d0/d29/classraw_1_1OpDetWaveform.html">raw::OpDetWaveform</a></code> objects from simulated photoelectrons. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">photons</td><td>the simulated list of photoelectrons </td></tr>
    <tr><td class="paramname">photons_used</td><td>(<em>output</em>) list of used photoelectrons </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a collection of digitised <code><a class="el" href="../../d0/d29/classraw_1_1OpDetWaveform.html">raw::OpDetWaveform</a></code> objects</dd></dl>
<p>This function performs the digitization of a optical detector channel which is collecting the photoelectrons in the <code>photons</code> list.</p>
<p>The photoelectrons are already screened for quantum efficiency: all of them are considered for use. It is still possible, if a reduction of the quantum efficiency is requested, that some of them are discarded.</p>
<p>The <code>photons_used</code> output argument is constructed and filled only if the configuration of the algorithm requires the creation of a list of used photons. </p>

<p>Definition at line <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00182">182</a> of file <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html">PMTsimulationAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;{</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keyword">using namespace </span>util::quantities::time_literals;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keyword">using namespace </span>util::quantities::frequency_literals;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keyword">using namespace </span>util::quantities::electronics_literals;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keyword">using namespace </span>detinfo::timescales;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <a class="code" href="../../de/d0f/classdetinfo_1_1DetectorTimings.html">detinfo::DetectorTimings</a> <span class="keyword">const</span>&amp; timings</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      = <a class="code" href="../../d7/d8a/namespacedetinfo.html#a2ef927ca9aaa32d366a9a0d26e7e14e7">detinfo::makeDetectorTimings</a>(<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a8ec7dc1deeb6c93abbb033199247d5f7">clockData</a>);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac17a9af8a4cec78a3381487ba80cec42">tick</a> <span class="keyword">const</span> endSample = <a class="code" href="../../de/d7e/structutil_1_1quantities_1_1concepts_1_1Quantity.html#aba5e94aee1f80a1599a87a0b247a96f3">tick::castFrom</a>(<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#abc9b79707c1b8f5afc175fdc8cd51eb0">fNsamples</a>);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">// collect the amount of photoelectrons arriving at each subtick;</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">// the waveform is split in groups of photons at the same relative subtick</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="comment">// (i.e. first all the photons on the first subtick of a tick, then</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">// all the photons on the second subtick of a tick, and so on);</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">// storage is by subtick group (vector index is the subtick), then by</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="comment">// tick (unordered map index is the tick number).</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    std::vector&lt;std::unordered_map&lt;tick, unsigned int&gt;&gt; peMaps</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      (<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aa822578c863e4bdcac980b9186f33ec1">wsp</a>.<a class="code" href="../../db/dce/classicarus_1_1opdet_1_1DiscretePhotoelectronPulse.html#a684b11f646cb1142e4c015b45561b37c">nSubsamples</a>());</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">// returns tick and relative subtick number</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    TimeToTickAndSubtickConverter <span class="keyword">const</span> toTickAndSubtick(peMaps.size());</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">//     auto start = std::chrono::high_resolution_clock::now();</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">if</span> (photons_used) {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      photons_used-&gt;clear();</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      photons_used-&gt;SetChannel(photons.OpChannel());</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    }</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span> <span class="keyword">const</span>&amp; ph : photons) {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a32114c48520a448cf2ffb296acd45fe7">KicksPhotoelectron</a>()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      <span class="keywordflow">if</span> (photons_used) photons_used-&gt;push_back(ph); <span class="comment">// copy</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <a class="code" href="../../dc/d8b/namespacedetinfo_1_1timescales.html#a69d987209c5d72bfc279043d7ad6ee5e">simulation_time</a> <span class="keyword">const</span> photonTime { ph.Time };</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <a class="code" href="../../dc/d8b/namespacedetinfo_1_1timescales.html#a2b8928419b3d7ef5fbf3bb593e8d244f">trigger_time</a> <span class="keyword">const</span> mytime</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        = timings.toTriggerTime(photonTime)</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        - <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#ac48e6f6eace5142a577b090497187d6b">triggerOffsetPMT</a></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        ;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      <span class="keywordflow">if</span> ((mytime &lt; 0.0_us) || (mytime &gt;= <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#af69895d00bb9925a1920418ca52a5e50">readoutEnablePeriod</a>)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span> [ <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac17a9af8a4cec78a3381487ba80cec42">tick</a>, subtick ]</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        = toTickAndSubtick(mytime.quantity() * <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a065984ccb1859a6400c2d9f3262eb082">fSampling</a>);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      <span class="comment">/*</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">      mf::LogTrace(&quot;PMTsimulationAlg&quot;)</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">        &lt;&lt; &quot;Photon at &quot; &lt;&lt; photonTime &lt;&lt; &quot;, optical time &quot; &lt;&lt; mytime</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">        &lt;&lt; &quot; =&gt; tick &quot; &lt;&lt; tick_d</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">        &lt;&lt; &quot; =&gt; sample &quot; &lt;&lt; tick &lt;&lt; &quot; subsample &quot; &lt;&lt; subtick</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">        ;</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">      */</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac17a9af8a4cec78a3381487ba80cec42">tick</a> &gt;= endSample) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      ++peMaps[subtick][<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac17a9af8a4cec78a3381487ba80cec42">tick</a>];</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    } <span class="comment">// for photons</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">//     auto end = std::chrono::high_resolution_clock::now();</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">//     std::chrono::duration&lt;double&gt; diff = end-start;</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">//     std::cout &lt;&lt; &quot;\tcollected pes... &quot; &lt;&lt; photons.OpChannel() &lt;&lt; &quot; &quot; &lt;&lt; diff.count() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">//     start=std::chrono::high_resolution_clock::now();</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="comment">// add the collected photoelectrons to the waveform</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> waveform(<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#abc9b79707c1b8f5afc175fdc8cd51eb0">fNsamples</a>, <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a4788bd3928ca55a45fb9651f454d0ac8">baseline</a>);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    </div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nTotalPE [[gnu::unused]] = 0U; <span class="comment">// unused if not in `debug` mode</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordtype">double</span> nTotalEffectivePE [[gnu::unused]] = 0U; <span class="comment">// unused if not in `debug` mode</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keyword">auto</span> gainFluctuation = <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aaf1e896492de61f7c4a0ac898bf206a4">makeGainFluctuator</a>();</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="comment">// go though all subsamples (starting each at a fraction of a tick)</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; [ iSubsample, peMap ]: <a class="code" href="../../d6/d72/namespaceutil.html#af0615b7538ff948ea65d5206a23c84f2">util::enumerate</a>(peMaps)) {</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <span class="comment">// this is the waveform sampling for the selected subsample:</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span>&amp; subsample = <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aa822578c863e4bdcac980b9186f33ec1">wsp</a>.<a class="code" href="../../db/dce/classicarus_1_1opdet_1_1DiscretePhotoelectronPulse.html#af1639c366182633e4ed0e668f4322dd4">subsample</a>(iSubsample);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; [ startTick, nPE ]: peMap) {</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        nTotalPE += nPE;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordtype">double</span> <span class="keyword">const</span> nEffectivePE = gainFluctuation(nPE);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        nTotalEffectivePE += nEffectivePE;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#afb930cd5f6dc4abe57cf291da9843103">AddPhotoelectrons</a>(</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;          subsample, waveform, startTick,</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;          static_cast&lt;WaveformValue_t&gt;(nEffectivePE)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;          );</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      } <span class="comment">// for sample</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    } <span class="comment">// for subsamples</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    MF_LOG_TRACE(<span class="stringliteral">&quot;PMTsimulationAlg&quot;</span>)</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      &lt;&lt; nTotalPE &lt;&lt; <span class="stringliteral">&quot; photoelectrons at &quot;</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      &lt;&lt; std::accumulate(</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;           peMaps.begin(), peMaps.end(), 0U,</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;           [](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>, <span class="keyword">auto</span> <span class="keyword">const</span>&amp; map){ <span class="keywordflow">return</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> + map.size(); }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;         )</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      &lt;&lt; <span class="stringliteral">&quot; times in channel &quot;</span> &lt;&lt; photons.OpChannel()</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      ;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">//       end=std::chrono::high_resolution_clock::now(); diff = end-start;</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">//       std::cout &lt;&lt; &quot;\tadded pes... &quot; &lt;&lt; photons.OpChannel() &lt;&lt; &quot; &quot; &lt;&lt; diff.count() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">//       start=std::chrono::high_resolution_clock::now();</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a4c1862485da0052550e01a6ad150f88d">ampNoise</a> &gt; 0.0_ADCf) (this-&gt;*<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aa8432cac07280ac459e297f75fe5001e">fNoiseAdder</a>)(waveform);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a1e586e7a1864579cf5cb01d064bc4bb2">darkNoiseRate</a> &gt; 0.0_Hz) <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac0838785fc5665c18df7c0ca7497aa1a">AddDarkNoise</a>(waveform);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">//       end=std::chrono::high_resolution_clock::now(); diff = end-start;</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">//       std::cout &lt;&lt; &quot;\tadded noise... &quot; &lt;&lt; photons.OpChannel() &lt;&lt; &quot; &quot; &lt;&lt; diff.count() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">//       start=std::chrono::high_resolution_clock::now();</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="comment">// saturation in terms of photoelectrons (sharp);</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keyword">auto</span> <span class="keyword">const</span> ADCrange = <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a29097e347c0948ba89f71eb6610d8ec3">ADCrange</a>();</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a25afa671a2eb775f7bdc2ac926043af1">ApplySaturation</a>(waveform, ADCrange);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="comment">// clip to the ADC range, 0 -- 2</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a691d908788045d83e9b9ea10f6e8edd3">ClipWaveform</a>(waveform, ADCrange.first, ADCrange.second);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">//       end=std::chrono::high_resolution_clock::now(); diff = end-start;</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">//       std::cout &lt;&lt; &quot;\tadded saturation... &quot; &lt;&lt; photons.OpChannel() &lt;&lt; &quot; &quot; &lt;&lt; diff.count() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordflow">return</span> waveform;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  } <span class="comment">// CreateFullWaveform()</span></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_afb930cd5f6dc4abe57cf291da9843103"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#afb930cd5f6dc4abe57cf291da9843103">icarus::opdet::PMTsimulationAlg::AddPhotoelectrons</a></div><div class="ttdeci">void AddPhotoelectrons(PulseSampling_t const &amp;pulse, Waveform_t &amp;wave, tick const time_bin, WaveformValue_t const n) const </div><div class="ttdoc">Adds a number of pulses to a waveform, starting at a given tick. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00485">PMTsimulationAlg.cxx:485</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a4c1862485da0052550e01a6ad150f88d"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a4c1862485da0052550e01a6ad150f88d">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::ampNoise</a></div><div class="ttdeci">ADCcount ampNoise</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00436">PMTsimulationAlg.h:436</a></div></div>
<div class="ttc" id="structutil_1_1quantities_1_1concepts_1_1Quantity_html_aba5e94aee1f80a1599a87a0b247a96f3"><div class="ttname"><a href="../../de/d7e/structutil_1_1quantities_1_1concepts_1_1Quantity.html#aba5e94aee1f80a1599a87a0b247a96f3">util::quantities::concepts::Quantity::castFrom</a></div><div class="ttdeci">static constexpr quantity_t castFrom(U value)</div><div class="ttdoc">Returns a new quantity initialized with the specified value. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8e/quantities_8h_source.html#l00825">quantities.h:825</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_aa822578c863e4bdcac980b9186f33ec1"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aa822578c863e4bdcac980b9186f33ec1">icarus::opdet::PMTsimulationAlg::wsp</a></div><div class="ttdeci">DiscretePhotoelectronPulse wsp</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00582">PMTsimulationAlg.h:582</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_ac17a9af8a4cec78a3381487ba80cec42"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac17a9af8a4cec78a3381487ba80cec42">icarus::opdet::PMTsimulationAlg::tick</a></div><div class="ttdeci">util::quantities::tick tick</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00348">PMTsimulationAlg.h:348</a></div></div>
<div class="ttc" id="namespaceutil_html_af0615b7538ff948ea65d5206a23c84f2"><div class="ttname"><a href="../../d6/d72/namespaceutil.html#af0615b7538ff948ea65d5206a23c84f2">util::enumerate</a></div><div class="ttdeci">auto enumerate(Iterables &amp;&amp;...iterables)</div><div class="ttdoc">Range-for loop helper tracking the number of iteration. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d85/enumerate_8h_source.html#l00069">enumerate.h:69</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_abc9b79707c1b8f5afc175fdc8cd51eb0"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#abc9b79707c1b8f5afc175fdc8cd51eb0">icarus::opdet::PMTsimulationAlg::fNsamples</a></div><div class="ttdeci">std::size_t fNsamples</div><div class="ttdoc">Samples per waveform. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00580">PMTsimulationAlg.h:580</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a0367bc7919988b14cad97ed96ca83f1a"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">icarus::opdet::PMTsimulationAlg::Waveform_t</a></div><div class="ttdeci">OpDetWaveformMaker_t::WaveformData_t Waveform_t</div><div class="ttdoc">Type internally used for storing waveforms. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00522">PMTsimulationAlg.h:522</a></div></div>
<div class="ttc" id="namespacedetinfo_1_1timescales_html_a2b8928419b3d7ef5fbf3bb593e8d244f"><div class="ttname"><a href="../../dc/d8b/namespacedetinfo_1_1timescales.html#a2b8928419b3d7ef5fbf3bb593e8d244f">detinfo::timescales::trigger_time</a></div><div class="ttdeci">timescale_traits&lt; TriggerTimeCategory &gt;::time_point_t trigger_time</div><div class="ttdoc">A point in time on the trigger time scale. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/daf/DetectorTimingTypes_8h_source.html#l00355">DetectorTimingTypes.h:355</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a25afa671a2eb775f7bdc2ac926043af1"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a25afa671a2eb775f7bdc2ac926043af1">icarus::opdet::PMTsimulationAlg::ApplySaturation</a></div><div class="ttdeci">void ApplySaturation(Waveform_t &amp;waveform, std::pair&lt; ADCcount, ADCcount &gt; const &amp;range) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00650">PMTsimulationAlg.cxx:650</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_ac0838785fc5665c18df7c0ca7497aa1a"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ac0838785fc5665c18df7c0ca7497aa1a">icarus::opdet::PMTsimulationAlg::AddDarkNoise</a></div><div class="ttdeci">void AddDarkNoise(Waveform_t &amp;wave) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00563">PMTsimulationAlg.cxx:563</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a32114c48520a448cf2ffb296acd45fe7"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a32114c48520a448cf2ffb296acd45fe7">icarus::opdet::PMTsimulationAlg::KicksPhotoelectron</a></div><div class="ttdeci">bool KicksPhotoelectron() const </div><div class="ttdoc">Returns a random response whether a photon generates a photoelectron. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00480">PMTsimulationAlg.cxx:480</a></div></div>
<div class="ttc" id="namespacedetinfo_1_1timescales_html_a69d987209c5d72bfc279043d7ad6ee5e"><div class="ttname"><a href="../../dc/d8b/namespacedetinfo_1_1timescales.html#a69d987209c5d72bfc279043d7ad6ee5e">detinfo::timescales::simulation_time</a></div><div class="ttdeci">timescale_traits&lt; SimulationTimeCategory &gt;::time_point_t simulation_time</div><div class="ttdoc">A point in time on the simulation time scale. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/daf/DetectorTimingTypes_8h_source.html#l00369">DetectorTimingTypes.h:369</a></div></div>
<div class="ttc" id="namespacedetinfo_html_a2ef927ca9aaa32d366a9a0d26e7e14e7"><div class="ttname"><a href="../../d7/d8a/namespacedetinfo.html#a2ef927ca9aaa32d366a9a0d26e7e14e7">detinfo::makeDetectorTimings</a></div><div class="ttdeci">detinfo::DetectorTimings makeDetectorTimings(detinfo::DetectorClocksData const &amp;detClocks)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd2/DetectorTimings_8h_source.html#l00698">DetectorTimings.h:698</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_af69895d00bb9925a1920418ca52a5e50"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#af69895d00bb9925a1920418ca52a5e50">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::readoutEnablePeriod</a></div><div class="ttdeci">microseconds readoutEnablePeriod</div><div class="ttdoc">Time (us) for which pmt readout is enabled. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00426">PMTsimulationAlg.h:426</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_ac48e6f6eace5142a577b090497187d6b"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#ac48e6f6eace5142a577b090497187d6b">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::triggerOffsetPMT</a></div><div class="ttdeci">microseconds triggerOffsetPMT</div><div class="ttdoc">Time relative to trigger when PMT readout starts TODO make it a trigger_time point. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00424">PMTsimulationAlg.h:424</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a4788bd3928ca55a45fb9651f454d0ac8"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a4788bd3928ca55a45fb9651f454d0ac8">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::baseline</a></div><div class="ttdeci">ADCcount baseline</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00435">PMTsimulationAlg.h:435</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a1021a841e3d7a47a2ff8458c982675ae"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">icarus::opdet::PMTsimulationAlg::fParams</a></div><div class="ttdeci">ConfigurationParameters_t fParams</div><div class="ttdoc">Complete algorithm configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00576">PMTsimulationAlg.h:576</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_aaf1e896492de61f7c4a0ac898bf206a4"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aaf1e896492de61f7c4a0ac898bf206a4">icarus::opdet::PMTsimulationAlg::makeGainFluctuator</a></div><div class="ttdeci">auto makeGainFluctuator() const </div><div class="ttdoc">Returns a configured gain fluctuator object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00166">PMTsimulationAlg.cxx:166</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1DiscretePhotoelectronPulse_html_a684b11f646cb1142e4c015b45561b37c"><div class="ttname"><a href="../../db/dce/classicarus_1_1opdet_1_1DiscretePhotoelectronPulse.html#a684b11f646cb1142e4c015b45561b37c">icarus::opdet::DiscretePhotoelectronPulse::nSubsamples</a></div><div class="ttdeci">SubsampleIndex_t nSubsamples() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/DiscretePhotoelectronPulse_8h_source.html#l00147">DiscretePhotoelectronPulse.h:147</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a1e586e7a1864579cf5cb01d064bc4bb2"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a1e586e7a1864579cf5cb01d064bc4bb2">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::darkNoiseRate</a></div><div class="ttdeci">hertz darkNoiseRate</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00438">PMTsimulationAlg.h:438</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a29097e347c0948ba89f71eb6610d8ec3"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a29097e347c0948ba89f71eb6610d8ec3">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::ADCrange</a></div><div class="ttdeci">std::pair&lt; ADCcount, ADCcount &gt; ADCrange() const </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00480">PMTsimulationAlg.h:480</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a691d908788045d83e9b9ea10f6e8edd3"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a691d908788045d83e9b9ea10f6e8edd3">icarus::opdet::PMTsimulationAlg::ClipWaveform</a></div><div class="ttdeci">static void ClipWaveform(Waveform_t &amp;waveform, ADCcount min, ADCcount max)</div><div class="ttdoc">Forces waveform ADC within the min to max range (max included). </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00669">PMTsimulationAlg.cxx:669</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a065984ccb1859a6400c2d9f3262eb082"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a065984ccb1859a6400c2d9f3262eb082">icarus::opdet::PMTsimulationAlg::fSampling</a></div><div class="ttdeci">megahertz fSampling</div><div class="ttdoc">Wave sampling frequency [MHz]. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00579">PMTsimulationAlg.h:579</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_aa8432cac07280ac459e297f75fe5001e"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aa8432cac07280ac459e297f75fe5001e">icarus::opdet::PMTsimulationAlg::fNoiseAdder</a></div><div class="ttdeci">NoiseAdderFunc_t const fNoiseAdder</div><div class="ttdoc">Single photon pulse (sampled). </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00584">PMTsimulationAlg.h:584</a></div></div>
<div class="ttc" id="classdetinfo_1_1DetectorTimings_html"><div class="ttname"><a href="../../de/d0f/classdetinfo_1_1DetectorTimings.html">detinfo::DetectorTimings</a></div><div class="ttdoc">A class exposing an upgraded interface of detinfo::DetectorClocksData. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd2/DetectorTimings_8h_source.html#l00249">DetectorTimings.h:249</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1DiscretePhotoelectronPulse_html_af1639c366182633e4ed0e668f4322dd4"><div class="ttname"><a href="../../db/dce/classicarus_1_1opdet_1_1DiscretePhotoelectronPulse.html#af1639c366182633e4ed0e668f4322dd4">icarus::opdet::DiscretePhotoelectronPulse::subsample</a></div><div class="ttdeci">decltype(auto) subsample(SubsampleIndex_t i) const </div><div class="ttdoc">Returns the subsample specified by index i, undefined if invalid. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/DiscretePhotoelectronPulse_8h_source.html#l00139">DiscretePhotoelectronPulse.h:139</a></div></div>
<div class="ttc" id="namespacechannelDBConverter_html_ab6cfbbcbb53c275375289d47dec67f46"><div class="ttname"><a href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">channelDBConverter.n</a></div><div class="ttdeci">int n</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d11/channelDBConverter_8py_source.html#l00249">channelDBConverter.py:249</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a8ec7dc1deeb6c93abbb033199247d5f7"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a8ec7dc1deeb6c93abbb033199247d5f7">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::clockData</a></div><div class="ttdeci">detinfo::DetectorClocksData const * clockData</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00450">PMTsimulationAlg.h:450</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6224483efa2ef00a01f342155bceec40"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">auto icarus::opdet::PMTsimulationAlg::FindTriggers </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> const &amp;&#160;</td>
          <td class="paramname"><em>wvfm</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Ticks in the specified waveform where some signal activity starts. </p>
<dl class="section return"><dt>Returns</dt><dd>a collection of ticks with interesting activity, sorted </dd></dl>
<dl class="section see"><dt>See Also</dt><dd><code><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aed3ee1aca2df9768fe265bdb9cb8445d" title="Generate periodic interest points regardless the actual activity. ">CreateBeamGateTriggers()</a></code></dd></dl>
<p>We define an "interest point" a time when some activity in the waveform is considered interesting enough to be recorded. This method returns a list of interest points, in the form of the index they are located at in the waveform <code>wvfm</code>.</p>
<p>In general (but with the exception noted below), a time becomes an interest point if the sample recorded at that time is above the threshold set by the configuration parameter <code>ThresholdADC</code>.</p>
<p>These interest points are local readout triggers that drive zero suppression on the optical readout channel and that are not necessarily causing any level of event trigger.</p>
<p>This method also adds the mandatory beam gate interest points as explained in <code><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aed3ee1aca2df9768fe265bdb9cb8445d" title="Generate periodic interest points regardless the actual activity. ">CreateBeamGateTriggers()</a></code> documentation. These are additional interest points that are added independently of whether there is actual interesting activity in there. </p>

<p>Definition at line <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00336">336</a> of file <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html">PMTsimulationAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  {</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    std::vector&lt;optical_tick&gt; trigger_locations;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="comment">// find all ticks at which we would trigger readout</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordtype">bool</span> above_thresh=<span class="keyword">false</span>;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i_t=0; i_t&lt;wvfm.size(); ++i_t){</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <span class="keyword">auto</span> <span class="keyword">const</span> val { <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a53971037d15a2d8c5be02c466af19eec">pulsePolarity</a>* (wvfm[i_t]-<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a4788bd3928ca55a45fb9651f454d0ac8">baseline</a>) };</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <span class="keywordflow">if</span>(!above_thresh &amp;&amp; val&gt;=<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a8bfa48be61488368fd1da91ac1a967aa">thresholdADC</a>){</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        above_thresh=<span class="keyword">true</span>;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        trigger_locations.push_back(optical_tick::castFrom(i_t));</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      }</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(above_thresh &amp;&amp; val&lt;<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a8bfa48be61488368fd1da91ac1a967aa">thresholdADC</a>){</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        above_thresh=<span class="keyword">false</span>;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      }</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    }<span class="comment">//end loop over waveform</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="comment">// next, add the triggers injected at beam gate time</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#adfb0518c9315e7aed3ad38163067b9c8">createBeamGateTriggers</a>) {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="keyword">auto</span> beamGateTriggers = <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aed3ee1aca2df9768fe265bdb9cb8445d">CreateBeamGateTriggers</a>();</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <span class="comment">// insert the new triggers and sort them</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      trigger_locations.insert(trigger_locations.end(),</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        beamGateTriggers.begin(), beamGateTriggers.end());</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      std::inplace_merge(</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        trigger_locations.begin(),</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        trigger_locations.end() - beamGateTriggers.size(),</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        trigger_locations.end()</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        );</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    }</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keywordflow">return</span> trigger_locations;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  }</div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_adfb0518c9315e7aed3ad38163067b9c8"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#adfb0518c9315e7aed3ad38163067b9c8">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::createBeamGateTriggers</a></div><div class="ttdeci">bool createBeamGateTriggers</div><div class="ttdoc">Option to create unbiased readout around beam spill. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00428">PMTsimulationAlg.h:428</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a8bfa48be61488368fd1da91ac1a967aa"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a8bfa48be61488368fd1da91ac1a967aa">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::thresholdADC</a></div><div class="ttdeci">ADCcount thresholdADC</div><div class="ttdoc">ADC Threshold for self-triggered readout. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00422">PMTsimulationAlg.h:422</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_aed3ee1aca2df9768fe265bdb9cb8445d"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aed3ee1aca2df9768fe265bdb9cb8445d">icarus::opdet::PMTsimulationAlg::CreateBeamGateTriggers</a></div><div class="ttdeci">std::vector&lt; optical_tick &gt; CreateBeamGateTriggers() const </div><div class="ttdoc">Generate periodic interest points regardless the actual activity. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00309">PMTsimulationAlg.cxx:309</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a4788bd3928ca55a45fb9651f454d0ac8"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a4788bd3928ca55a45fb9651f454d0ac8">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::baseline</a></div><div class="ttdeci">ADCcount baseline</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00435">PMTsimulationAlg.h:435</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a1021a841e3d7a47a2ff8458c982675ae"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">icarus::opdet::PMTsimulationAlg::fParams</a></div><div class="ttdeci">ConfigurationParameters_t fParams</div><div class="ttdoc">Complete algorithm configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00576">PMTsimulationAlg.h:576</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a53971037d15a2d8c5be02c466af19eec"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a53971037d15a2d8c5be02c466af19eec">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::pulsePolarity</a></div><div class="ttdeci">int pulsePolarity</div><div class="ttdoc">Pulse polarity (=1 for positive, =-1 for negative) </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00423">PMTsimulationAlg.h:423</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a32114c48520a448cf2ffb296acd45fe7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool icarus::opdet::PMTsimulationAlg::KicksPhotoelectron </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns a random response whether a photon generates a photoelectron. </p>

<p>Definition at line <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00480">480</a> of file <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html">PMTsimulationAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  { <span class="keywordflow">return</span> CLHEP::RandFlat::shoot(<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#ae844111da6ae8b1f1a4d6c1e35204972">randomEngine</a>) &lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#af8992f7d6a13f5fa86f0e0a8a68f6b6b">fQE</a>; }</div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a1021a841e3d7a47a2ff8458c982675ae"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">icarus::opdet::PMTsimulationAlg::fParams</a></div><div class="ttdeci">ConfigurationParameters_t fParams</div><div class="ttdoc">Complete algorithm configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00576">PMTsimulationAlg.h:576</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_ae844111da6ae8b1f1a4d6c1e35204972"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#ae844111da6ae8b1f1a4d6c1e35204972">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::randomEngine</a></div><div class="ttdeci">CLHEP::HepRandomEngine * randomEngine</div><div class="ttdoc">Main random stream engine. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00456">PMTsimulationAlg.h:456</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_af8992f7d6a13f5fa86f0e0a8a68f6b6b"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#af8992f7d6a13f5fa86f0e0a8a68f6b6b">icarus::opdet::PMTsimulationAlg::fQE</a></div><div class="ttdeci">double fQE</div><div class="ttdoc">PMT quantum efficiency. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00578">PMTsimulationAlg.h:578</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aaf1e896492de61f7c4a0ac898bf206a4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">auto icarus::opdet::PMTsimulationAlg::makeGainFluctuator </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns a configured gain fluctuator object. </p>

<p>Definition at line <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00166">166</a> of file <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html">PMTsimulationAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                                                           {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keyword">using</span> Fluctuator_t = GainFluctuator&lt;CLHEP::RandPoisson&gt;;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a88f92abec387c5a3ac343aa1dc10f264">doGainFluctuations</a>) {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordtype">double</span> <span class="keyword">const</span> refGain = <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#ad8874c1f4488b8fc24e77bfb7f7a8ca7">PMTspecs</a>.<a class="code" href="../../de/d19/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_1_1PMTspecs__t.html#a77aeb77dc475637e1bb96278f001765e">firstStageGain</a>();</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">return</span> Fluctuator_t</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      { refGain, CLHEP::RandPoisson{ *<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a277eb6ba32a0175aeaa007121f5b1fb4">gainRandomEngine</a>, refGain } };</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  }</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">return</span> Fluctuator_t{}; <span class="comment">// default-constructed does not fluctuate anything</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;} <span class="comment">// icarus::opdet::PMTsimulationAlg::makeGainFluctuator()</span></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_ad8874c1f4488b8fc24e77bfb7f7a8ca7"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#ad8874c1f4488b8fc24e77bfb7f7a8ca7">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::PMTspecs</a></div><div class="ttdeci">PMTspecs_t PMTspecs</div><div class="ttdoc">PMT specifications. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00440">PMTsimulationAlg.h:440</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a277eb6ba32a0175aeaa007121f5b1fb4"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a277eb6ba32a0175aeaa007121f5b1fb4">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::gainRandomEngine</a></div><div class="ttdeci">CLHEP::HepRandomEngine * gainRandomEngine</div><div class="ttdoc">Random stream engine for gain fluctuations. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00459">PMTsimulationAlg.h:459</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a88f92abec387c5a3ac343aa1dc10f264"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a88f92abec387c5a3ac343aa1dc10f264">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::doGainFluctuations</a></div><div class="ttdeci">bool doGainFluctuations</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00441">PMTsimulationAlg.h:441</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a1021a841e3d7a47a2ff8458c982675ae"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">icarus::opdet::PMTsimulationAlg::fParams</a></div><div class="ttdeci">ConfigurationParameters_t fParams</div><div class="ttdoc">Complete algorithm configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00576">PMTsimulationAlg.h:576</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_1_1PMTspecs__t_html_a77aeb77dc475637e1bb96278f001765e"><div class="ttname"><a href="../../de/d19/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_1_1PMTspecs__t.html#a77aeb77dc475637e1bb96278f001765e">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::PMTspecs_t::firstStageGain</a></div><div class="ttdeci">double firstStageGain() const </div><div class="ttdoc">Returns the gain from the first stage of PMT multiplication. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00402">PMTsimulationAlg.h:402</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8445c3557469fcff5c4b8c9a31df0055"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Stream &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void icarus::opdet::PMTsimulationAlg::printConfiguration </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d8f/runFilesFromSAM_8sh.html#a9cafae22b6225844ee0cdf5ea57176ff">Stream</a> &amp;&amp;&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>indent</em> = <code>&quot;&quot;</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prints the configuration into the specified output stream. </p>

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l01062">1062</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>
<div class="fragment"><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;{</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  <span class="keyword">using namespace </span>util::quantities::electronics_literals;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  out</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;            &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;ADC bits:            &quot;</span> &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a186ecdda9f14a4fb33116ec1b247526a">ADCbits</a></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a29097e347c0948ba89f71eb6610d8ec3">ADCrange</a>().first &lt;&lt; <span class="stringliteral">&quot; -- &quot;</span> &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a29097e347c0948ba89f71eb6610d8ec3">ADCrange</a>().second</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;Baseline:            &quot;</span> &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a4788bd3928ca55a45fb9651f454d0ac8">baseline</a></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;ReadoutWindowSize:   &quot;</span> &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a5739aacdb2a73a47f5c5b48544c4129a">readoutWindowSize</a> &lt;&lt; <span class="stringliteral">&quot; ticks&quot;</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;PreTrigFraction:     &quot;</span> &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a2cff2339bce85a8f128cb09f0d5b609a">pretrigFraction</a></div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;ThresholdADC:        &quot;</span> &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a8bfa48be61488368fd1da91ac1a967aa">thresholdADC</a></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;Saturation:          &quot;</span> &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a2316678c07c63d6a65cdb84e56c02249">saturation</a> &lt;&lt; <span class="stringliteral">&quot; p.e.&quot;</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;doGainFluctuations:  &quot;</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;      &lt;&lt; std::boolalpha &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a88f92abec387c5a3ac343aa1dc10f264">doGainFluctuations</a></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;PulsePolarity:       &quot;</span> &lt;&lt; ((<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a53971037d15a2d8c5be02c466af19eec">pulsePolarity</a> == 1)? <span class="stringliteral">&quot;positive&quot;</span>: <span class="stringliteral">&quot;negative&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; (=&quot;</span> &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a53971037d15a2d8c5be02c466af19eec">pulsePolarity</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;Sampling:            &quot;</span> &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a065984ccb1859a6400c2d9f3262eb082">fSampling</a>;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#aa872eb438ce0fe89a6246a8168e27103">pulseSubsamples</a> &gt; 1U)</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    out &lt;&lt; <span class="stringliteral">&quot; (subsampling: x&quot;</span> &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#aa872eb438ce0fe89a6246a8168e27103">pulseSubsamples</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  out</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;Samples/waveform:    &quot;</span> &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#abc9b79707c1b8f5afc175fdc8cd51eb0">fNsamples</a> &lt;&lt; <span class="stringliteral">&quot; ticks&quot;</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;Gain at first stage: &quot;</span> &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#ad8874c1f4488b8fc24e77bfb7f7a8ca7">PMTspecs</a>.<a class="code" href="../../de/d19/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_1_1PMTspecs__t.html#a77aeb77dc475637e1bb96278f001765e">firstStageGain</a>()</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    ;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  out &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;Electronics noise:   &quot;</span>;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a4c1862485da0052550e01a6ad150f88d">ampNoise</a> &gt; 0_ADCf) {</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    out &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a4c1862485da0052550e01a6ad150f88d">ampNoise</a> &lt;&lt; <span class="stringliteral">&quot; RMS (&quot;</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;      &lt;&lt; (<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a0021a9143de57aa30fb7b200e73dd913">useFastElectronicsNoise</a>? <span class="stringliteral">&quot;faster&quot;</span>: <span class="stringliteral">&quot;slower&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; algorithm)&quot;</span>;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  }</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  <span class="keywordflow">else</span> out &lt;&lt; <span class="stringliteral">&quot;none&quot;</span>;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#adfb0518c9315e7aed3ad38163067b9c8">createBeamGateTriggers</a>) {</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    out &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;Create &quot;</span> &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#acb01a00c1f6b20164ef776951a043cfe">beamGateTriggerNReps</a></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;      &lt;&lt; <span class="stringliteral">&quot; beam gate triggers, one every &quot;</span> &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a8c1b77820129a67f0b98a97f0aafff63">beamGateTriggerRepPeriod</a> &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  }</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  <span class="keywordflow">else</span> out &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;Do not create beam gate triggers.&quot;</span>;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  out &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;... and more.&quot;</span>;</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  out &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;Template photoelectron waveform settings:&quot;</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aa822578c863e4bdcac980b9186f33ec1">wsp</a>.<a class="code" href="../../db/dce/classicarus_1_1opdet_1_1DiscretePhotoelectronPulse.html#ad71944b78b0d54b38a3214725d873ca5">dump</a>(std::forward&lt;Stream&gt;(out), indent + <span class="stringliteral">&quot;  &quot;</span>);</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  </div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;  out &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; indent &lt;&lt; <span class="stringliteral">&quot;Track used photons:  &quot;</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    &lt;&lt; std::boolalpha &lt;&lt; <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a10a59a08c2e1c31232f905ac394dd803">trackSelectedPhotons</a></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;} <span class="comment">// icarus::opdet::PMTsimulationAlg::printConfiguration()</span></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_ad8874c1f4488b8fc24e77bfb7f7a8ca7"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#ad8874c1f4488b8fc24e77bfb7f7a8ca7">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::PMTspecs</a></div><div class="ttdeci">PMTspecs_t PMTspecs</div><div class="ttdoc">PMT specifications. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00440">PMTsimulationAlg.h:440</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_aa872eb438ce0fe89a6246a8168e27103"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#aa872eb438ce0fe89a6246a8168e27103">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::pulseSubsamples</a></div><div class="ttdeci">unsigned int pulseSubsamples</div><div class="ttdoc">Number of tick subsamples. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00432">PMTsimulationAlg.h:432</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_acb01a00c1f6b20164ef776951a043cfe"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#acb01a00c1f6b20164ef776951a043cfe">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::beamGateTriggerNReps</a></div><div class="ttdeci">size_t beamGateTriggerNReps</div><div class="ttdoc">Number of beamgate trigger reps to produce. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00430">PMTsimulationAlg.h:430</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a2cff2339bce85a8f128cb09f0d5b609a"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a2cff2339bce85a8f128cb09f0d5b609a">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::pretrigFraction</a></div><div class="ttdeci">float pretrigFraction</div><div class="ttdoc">Fraction of window size to be before &amp;quot;trigger&amp;quot;. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00421">PMTsimulationAlg.h:421</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a4c1862485da0052550e01a6ad150f88d"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a4c1862485da0052550e01a6ad150f88d">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::ampNoise</a></div><div class="ttdeci">ADCcount ampNoise</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00436">PMTsimulationAlg.h:436</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1DiscretePhotoelectronPulse_html_ad71944b78b0d54b38a3214725d873ca5"><div class="ttname"><a href="../../db/dce/classicarus_1_1opdet_1_1DiscretePhotoelectronPulse.html#ad71944b78b0d54b38a3214725d873ca5">icarus::opdet::DiscretePhotoelectronPulse::dump</a></div><div class="ttdeci">void dump(Stream &amp;&amp;out, std::string const &amp;indent, std::string const &amp;firstIndent) const </div><div class="ttdoc">Prints on stream the parameters of this shape. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/DiscretePhotoelectronPulse_8h_source.html#l00251">DiscretePhotoelectronPulse.h:251</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a0021a9143de57aa30fb7b200e73dd913"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a0021a9143de57aa30fb7b200e73dd913">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::useFastElectronicsNoise</a></div><div class="ttdeci">bool useFastElectronicsNoise</div><div class="ttdoc">Whether to use fast generator for electronics noise. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00437">PMTsimulationAlg.h:437</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_adfb0518c9315e7aed3ad38163067b9c8"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#adfb0518c9315e7aed3ad38163067b9c8">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::createBeamGateTriggers</a></div><div class="ttdeci">bool createBeamGateTriggers</div><div class="ttdoc">Option to create unbiased readout around beam spill. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00428">PMTsimulationAlg.h:428</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_aa822578c863e4bdcac980b9186f33ec1"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aa822578c863e4bdcac980b9186f33ec1">icarus::opdet::PMTsimulationAlg::wsp</a></div><div class="ttdeci">DiscretePhotoelectronPulse wsp</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00582">PMTsimulationAlg.h:582</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a8bfa48be61488368fd1da91ac1a967aa"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a8bfa48be61488368fd1da91ac1a967aa">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::thresholdADC</a></div><div class="ttdeci">ADCcount thresholdADC</div><div class="ttdoc">ADC Threshold for self-triggered readout. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00422">PMTsimulationAlg.h:422</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_abc9b79707c1b8f5afc175fdc8cd51eb0"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#abc9b79707c1b8f5afc175fdc8cd51eb0">icarus::opdet::PMTsimulationAlg::fNsamples</a></div><div class="ttdeci">std::size_t fNsamples</div><div class="ttdoc">Samples per waveform. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00580">PMTsimulationAlg.h:580</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a5739aacdb2a73a47f5c5b48544c4129a"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a5739aacdb2a73a47f5c5b48544c4129a">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::readoutWindowSize</a></div><div class="ttdeci">size_t readoutWindowSize</div><div class="ttdoc">ReadoutWindowSize in samples. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00420">PMTsimulationAlg.h:420</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a186ecdda9f14a4fb33116ec1b247526a"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a186ecdda9f14a4fb33116ec1b247526a">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::ADCbits</a></div><div class="ttdeci">unsigned int ADCbits</div><div class="ttdoc">Number of bits of the digitizer. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00434">PMTsimulationAlg.h:434</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a88f92abec387c5a3ac343aa1dc10f264"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a88f92abec387c5a3ac343aa1dc10f264">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::doGainFluctuations</a></div><div class="ttdeci">bool doGainFluctuations</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00441">PMTsimulationAlg.h:441</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a4788bd3928ca55a45fb9651f454d0ac8"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a4788bd3928ca55a45fb9651f454d0ac8">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::baseline</a></div><div class="ttdeci">ADCcount baseline</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00435">PMTsimulationAlg.h:435</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a1021a841e3d7a47a2ff8458c982675ae"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">icarus::opdet::PMTsimulationAlg::fParams</a></div><div class="ttdeci">ConfigurationParameters_t fParams</div><div class="ttdoc">Complete algorithm configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00576">PMTsimulationAlg.h:576</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a2316678c07c63d6a65cdb84e56c02249"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a2316678c07c63d6a65cdb84e56c02249">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::saturation</a></div><div class="ttdeci">float saturation</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00439">PMTsimulationAlg.h:439</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a29097e347c0948ba89f71eb6610d8ec3"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a29097e347c0948ba89f71eb6610d8ec3">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::ADCrange</a></div><div class="ttdeci">std::pair&lt; ADCcount, ADCcount &gt; ADCrange() const </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00480">PMTsimulationAlg.h:480</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a53971037d15a2d8c5be02c466af19eec"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a53971037d15a2d8c5be02c466af19eec">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::pulsePolarity</a></div><div class="ttdeci">int pulsePolarity</div><div class="ttdoc">Pulse polarity (=1 for positive, =-1 for negative) </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00423">PMTsimulationAlg.h:423</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a065984ccb1859a6400c2d9f3262eb082"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a065984ccb1859a6400c2d9f3262eb082">icarus::opdet::PMTsimulationAlg::fSampling</a></div><div class="ttdeci">megahertz fSampling</div><div class="ttdoc">Wave sampling frequency [MHz]. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00579">PMTsimulationAlg.h:579</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a10a59a08c2e1c31232f905ac394dd803"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a10a59a08c2e1c31232f905ac394dd803">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::trackSelectedPhotons</a></div><div class="ttdeci">bool trackSelectedPhotons</div><div class="ttdoc">Whether to track the scintillation photons used. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00468">PMTsimulationAlg.h:468</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a8c1b77820129a67f0b98a97f0aafff63"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a8c1b77820129a67f0b98a97f0aafff63">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::beamGateTriggerRepPeriod</a></div><div class="ttdeci">microseconds beamGateTriggerRepPeriod</div><div class="ttdoc">Repetition Period (us) for BeamGateTriggers TODO make this a time_interval. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00429">PMTsimulationAlg.h:429</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_1_1PMTspecs__t_html_a77aeb77dc475637e1bb96278f001765e"><div class="ttname"><a href="../../de/d19/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_1_1PMTspecs__t.html#a77aeb77dc475637e1bb96278f001765e">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::PMTspecs_t::firstStageGain</a></div><div class="ttdeci">double firstStageGain() const </div><div class="ttdoc">Returns the gain from the first stage of PMT multiplication. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00402">PMTsimulationAlg.h:402</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a66a3549968d1767268dbfe90f41e774e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">auto icarus::opdet::PMTsimulationAlg::saturationRange </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the ADC range allowed for photoelectron saturation. </p>

<p>Definition at line <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00621">621</a> of file <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html">PMTsimulationAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;{</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">ADCcount</a> <span class="keyword">const</span> saturationLevel</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    = <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a4788bd3928ca55a45fb9651f454d0ac8">baseline</a> + <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a2316678c07c63d6a65cdb84e56c02249">saturation</a>*<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aa822578c863e4bdcac980b9186f33ec1">wsp</a>.<a class="code" href="../../db/dce/classicarus_1_1opdet_1_1DiscretePhotoelectronPulse.html#afee25331e0941c60e5a8b488b7388039">peakAmplitude</a>();</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="keywordflow">return</span> std::make_pair(</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    ((<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a53971037d15a2d8c5be02c466af19eec">pulsePolarity</a> &gt; 0)</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      ? std::numeric_limits&lt;ADCcount&gt;::min(): saturationLevel),</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    ((<a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">fParams</a>.<a class="code" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a53971037d15a2d8c5be02c466af19eec">pulsePolarity</a> &gt; 0)</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      ? saturationLevel: <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::numeric_limits&lt;ADCcount&gt;::max</a>())</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    );</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;} <span class="comment">// icarus::opdet::PMTsimulationAlg::saturationRange()</span></div>
<div class="ttc" id="classicarus_1_1opdet_1_1DiscretePhotoelectronPulse_html_afee25331e0941c60e5a8b488b7388039"><div class="ttname"><a href="../../db/dce/classicarus_1_1opdet_1_1DiscretePhotoelectronPulse.html#afee25331e0941c60e5a8b488b7388039">icarus::opdet::DiscretePhotoelectronPulse::peakAmplitude</a></div><div class="ttdeci">ADCcount peakAmplitude() const </div><div class="ttdoc">Returns the peak amplitude in ADC counts. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/DiscretePhotoelectronPulse_8h_source.html#l00159">DiscretePhotoelectronPulse.h:159</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_ad2e0cf8d4a2cb17d1646b87c43d93cdb"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ad2e0cf8d4a2cb17d1646b87c43d93cdb">icarus::opdet::PMTsimulationAlg::ADCcount</a></div><div class="ttdeci">DiscretePhotoelectronPulse::ADCcount ADCcount</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00349">PMTsimulationAlg.h:349</a></div></div>
<div class="ttc" id="pmttriggerproducer_8fcl_html_a527d89be40c3c20ca8162df059180fd9"><div class="ttname"><a href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">max</a></div><div class="ttdeci">BEGIN_PROLOG pmt_uncoated ideal single PE test page of manual option are OR or AND window for pmt trigger time start window for pmt trigger time end etc then what events all hists are saved for max</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5a/pmttriggerproducer_8fcl_source.html#l00023">pmttriggerproducer.fcl:23</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_aa822578c863e4bdcac980b9186f33ec1"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#aa822578c863e4bdcac980b9186f33ec1">icarus::opdet::PMTsimulationAlg::wsp</a></div><div class="ttdeci">DiscretePhotoelectronPulse wsp</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00582">PMTsimulationAlg.h:582</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a4788bd3928ca55a45fb9651f454d0ac8"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a4788bd3928ca55a45fb9651f454d0ac8">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::baseline</a></div><div class="ttdeci">ADCcount baseline</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00435">PMTsimulationAlg.h:435</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a1021a841e3d7a47a2ff8458c982675ae"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a1021a841e3d7a47a2ff8458c982675ae">icarus::opdet::PMTsimulationAlg::fParams</a></div><div class="ttdeci">ConfigurationParameters_t fParams</div><div class="ttdoc">Complete algorithm configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00576">PMTsimulationAlg.h:576</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a2316678c07c63d6a65cdb84e56c02249"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a2316678c07c63d6a65cdb84e56c02249">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::saturation</a></div><div class="ttdeci">float saturation</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00439">PMTsimulationAlg.h:439</a></div></div>
<div class="ttc" id="structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t_html_a53971037d15a2d8c5be02c466af19eec"><div class="ttname"><a href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html#a53971037d15a2d8c5be02c466af19eec">icarus::opdet::PMTsimulationAlg::ConfigurationParameters_t::pulsePolarity</a></div><div class="ttdeci">int pulsePolarity</div><div class="ttdoc">Pulse polarity (=1 for positive, =-1 for negative) </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00423">PMTsimulationAlg.h:423</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aee8aac6f6cbe73d3d8d8d0ece1433a22"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::tuple&lt; std::vector&lt; <a class="el" href="../../d0/d29/classraw_1_1OpDetWaveform.html">raw::OpDetWaveform</a> &gt;, std::optional&lt; <a class="el" href="../../d3/dd1/classsim_1_1SimPhotons.html">sim::SimPhotons</a> &gt; &gt; icarus::opdet::PMTsimulationAlg::simulate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d3/dd1/classsim_1_1SimPhotons.html">sim::SimPhotons</a> const &amp;&#160;</td>
          <td class="paramname"><em>photons</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the waveforms originating from simulated photons. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">photons</td><td>all the photons simulated to land on the channel </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a list of optical waveforms, response to those photons, and which photons were used (if requested)</dd></dl>
<p>Due to threshold readout, a single channel may result in multiple waveforms, which are all on the same channel but disjunct in time.</p>
<p>The second element of the return value is optional and filled only if the <code>trackSelectedPhotons</code> configuration parameter is set to <code>true</code>. In that case, the returned <code><a class="el" href="../../d3/dd1/classsim_1_1SimPhotons.html" title="Collection of photons which recorded on one channel. ">sim::SimPhotons</a></code> contains a copy of each of the <code>photons</code> contributing to any of the waveforms. </p>

<p>Definition at line <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00151">151</a> of file <a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html">PMTsimulationAlg.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;{</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  std::optional&lt;sim::SimPhotons&gt; photons_used;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">Waveform_t</a> <span class="keyword">const</span> waveform = <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#adfc2a89d72e18b0b3df4375fb06dc023">CreateFullWaveform</a>(photons, photons_used);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="keywordflow">return</span> {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <a class="code" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a62ac2002e5d89c6823141d90869bbab7">CreateFixedSizeOpDetWaveforms</a>(photons.OpChannel(), waveform),</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    std::move(photons_used)</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    };</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;} <span class="comment">// icarus::opdet::PMTsimulationAlg::simulate()</span></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a62ac2002e5d89c6823141d90869bbab7"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a62ac2002e5d89c6823141d90869bbab7">icarus::opdet::PMTsimulationAlg::CreateFixedSizeOpDetWaveforms</a></div><div class="ttdeci">std::vector&lt; raw::OpDetWaveform &gt; CreateFixedSizeOpDetWaveforms(raw::Channel_t opChannel, Waveform_t const &amp;waveform) const </div><div class="ttdoc">Creates raw::OpDetWaveform objects from a waveform data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00377">PMTsimulationAlg.cxx:377</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_a0367bc7919988b14cad97ed96ca83f1a"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a0367bc7919988b14cad97ed96ca83f1a">icarus::opdet::PMTsimulationAlg::Waveform_t</a></div><div class="ttdeci">OpDetWaveformMaker_t::WaveformData_t Waveform_t</div><div class="ttdoc">Type internally used for storing waveforms. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00522">PMTsimulationAlg.h:522</a></div></div>
<div class="ttc" id="classicarus_1_1opdet_1_1PMTsimulationAlg_html_adfc2a89d72e18b0b3df4375fb06dc023"><div class="ttname"><a href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#adfc2a89d72e18b0b3df4375fb06dc023">icarus::opdet::PMTsimulationAlg::CreateFullWaveform</a></div><div class="ttdeci">Waveform_t CreateFullWaveform(sim::SimPhotons const &amp;photons, std::optional&lt; sim::SimPhotons &gt; &amp;photons_used) const </div><div class="ttdoc">Creates raw::OpDetWaveform objects from simulated photoelectrons. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/PMTsimulationAlg_8cxx_source.html#l00182">PMTsimulationAlg.cxx:182</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a4b68f81701dc84bf91a37f7038306b2a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/d3b/classutil_1_1FastAndPoorGauss.html">util::FastAndPoorGauss</a>&lt; 32768U, float &gt; const icarus::opdet::PMTsimulationAlg::fFastGauss</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00587">587</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="aa8432cac07280ac459e297f75fe5001e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#a26c22ab687a22533ff3b202efd05a6a7">NoiseAdderFunc_t</a> const icarus::opdet::PMTsimulationAlg::fNoiseAdder</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Single photon pulse (sampled). </p>
<p>Selected electronics noise method. Transformation uniform to Gaussian for electronics noise. </p>

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00584">584</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="abc9b79707c1b8f5afc175fdc8cd51eb0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::size_t icarus::opdet::PMTsimulationAlg::fNsamples</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Samples per waveform. </p>

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00580">580</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a1021a841e3d7a47a2ff8458c982675ae"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d6/daa/structicarus_1_1opdet_1_1PMTsimulationAlg_1_1ConfigurationParameters__t.html">ConfigurationParameters_t</a> icarus::opdet::PMTsimulationAlg::fParams</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Complete algorithm configuration. </p>

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00576">576</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="af8992f7d6a13f5fa86f0e0a8a68f6b6b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double icarus::opdet::PMTsimulationAlg::fQE</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>PMT quantum efficiency. </p>

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00578">578</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="a065984ccb1859a6400c2d9f3262eb082"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dc/d9a/classicarus_1_1opdet_1_1PMTsimulationAlg.html#ab2bab02ebb9a95fc0fe9733f2e545a2f">megahertz</a> icarus::opdet::PMTsimulationAlg::fSampling</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Wave sampling frequency [MHz]. </p>

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00579">579</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>

</div>
</div>
<a class="anchor" id="aa822578c863e4bdcac980b9186f33ec1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/dce/classicarus_1_1opdet_1_1DiscretePhotoelectronPulse.html">DiscretePhotoelectronPulse</a> icarus::opdet::PMTsimulationAlg::wsp</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html#l00582">582</a> of file <a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="../../dd/d06/PMTsimulationAlg_8h_source.html">PMTsimulationAlg.h</a></li>
<li><a class="el" href="../../d4/da9/PMTsimulationAlg_8cxx_source.html">PMTsimulationAlg.cxx</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
