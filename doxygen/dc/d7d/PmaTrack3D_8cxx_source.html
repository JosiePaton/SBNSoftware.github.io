<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>PmaTrack3D.cxx Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_b73b02d482d1c4a3db20c3d9ad52d395.html">srcs</a></li><li class="navelem"><a class="el" href="../../dir_f58b2474d7db671760af109c057c9f12.html">larreco</a></li><li class="navelem"><a class="el" href="../../dir_bfd42686fcf7bc0e8145fd17787a17cd.html">larreco</a></li><li class="navelem"><a class="el" href="../../dir_a92975983e87729a773cfa3b8109c8c3.html">RecoAlg</a></li><li class="navelem"><a class="el" href="../../dir_0aab76a386dead74cde85023d4c80743.html">PMAlg</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">PmaTrack3D.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../dc/d7d/PmaTrack3D_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *  @file   PmaTrack3D.cxx</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *  @author D.Stefan and R.Sulej</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *  @brief  Implementation of the Projection Matching Algorithm</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *          Build 3D segments and whole tracks by simultaneous matching hits in 2D projections.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *          See PmaTrack3D.h file for details.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d67/PmaTrack3D_8h.html">larreco/RecoAlg/PMAlg/PmaTrack3D.h</a>&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/d22/PmaSegment3D_8h.html">larreco/RecoAlg/PMAlg/PmaSegment3D.h</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/de4/larreco_2larreco_2RecoAlg_2PMAlg_2Utilities_8h.html">larreco/RecoAlg/PMAlg/Utilities.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d8b/Geometry_8h.html">larcore/Geometry/Geometry.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/dba/DetectorClocksService_8h.html">lardata/DetectorInfoServices/DetectorClocksService.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/df8/DetectorPropertiesService_8h.html">lardata/DetectorInfoServices/DetectorPropertiesService.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;art/Framework/Services/Registry/ServiceHandle.h&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;messagefacility/MessageLogger/MessageLogger.h&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;array&gt;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;range/v3/algorithm.hpp&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;range/v3/view.hpp&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a7d8189a5f23f9bc1c6cb87698708c978">pma::Track3D::Track3D</a>() = <span class="keywordflow">default</span>;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a12a7b578cff4d6852c50ef503eeba4b6">   30</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a7d8189a5f23f9bc1c6cb87698708c978">pma::Track3D::Track3D</a>(<span class="keyword">const</span> <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">Track3D</a>&amp; src)</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  : fMaxHitsPerSeg(src.fMaxHitsPerSeg)</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  , fPenaltyFactor(src.fPenaltyFactor)</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  , fMaxSegStopFactor(src.fMaxSegStopFactor)</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  , fSegStopValue(src.fSegStopValue)</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  , fMinSegStop(src.fMinSegStop)</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  , fMaxSegStop(src.fMaxSegStop)</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  , fSegStopFactor(src.fSegStopFactor)</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  , fPenaltyValue(src.fPenaltyValue)</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  , fEndSegWeight(src.fEndSegWeight)</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  , fHitsRadius(src.fHitsRadius)</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  , <a class="code" href="../../d4/d4d/namespaceevgen.html#a354af7140af9e222ae73503ce23ad680">fT0</a>(src.<a class="code" href="../../d4/d4d/namespaceevgen.html#a354af7140af9e222ae73503ce23ad680">fT0</a>)</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  , fT0Flag(src.fT0Flag)</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  , fTag(src.fTag)</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;{</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a6b17a32f3402243525a2ec3576920ddf">fHits</a>.reserve(src.<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a6b17a32f3402243525a2ec3576920ddf">fHits</a>.size());</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>* <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : src.<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a6b17a32f3402243525a2ec3576920ddf">fHits</a>) {</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* h3d = <span class="keyword">new</span> <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>(*<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    h3d-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a8ae6c786ab52cfa3e1e1962c5fba06af">fParent</a> = <span class="keyword">this</span>;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a6b17a32f3402243525a2ec3576920ddf">fHits</a>.push_back(h3d);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  }</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac962a4b11d64492799b447aa9c40837d">fNodes</a>.reserve(src.<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac962a4b11d64492799b447aa9c40837d">fNodes</a>.size());</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>* node : src.<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac962a4b11d64492799b447aa9c40837d">fNodes</a>)</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac962a4b11d64492799b447aa9c40837d">fNodes</a>.push_back(<span class="keyword">new</span> <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>(*node));</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>* point : src.<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ab983fc03bf11450de6bcd439d995608b">fAssignedPoints</a>)</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ab983fc03bf11450de6bcd439d995608b">fAssignedPoints</a>.push_back(<span class="keyword">new</span> TVector3(*point));</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a90f8b897da30b12f54b974020d52e9f3">RebuildSegments</a>();</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a6aeea6b76f0be4ed9101fd90a91b264f">MakeProjection</a>();</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;}</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a159eb6a45d8f0b68345659ab60d2392d">   63</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a159eb6a45d8f0b68345659ab60d2392d">pma::Track3D::~Track3D</a>()</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;{</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; fHits.size(); i++)</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keyword">delete</span> fHits[i];</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; fAssignedPoints.size(); i++)</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keyword">delete</span> fAssignedPoints[i];</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; fSegments.size(); i++)</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keyword">delete</span> fSegments[i];</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; fNodes.size(); i++)</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">if</span> (!fNodes[i]-&gt;NextCount() &amp;&amp; !fNodes[i]-&gt;Prev()) <span class="keyword">delete</span> fNodes[i];</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;}</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a994fecd95666f46cf371ecafa003fe20">   77</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a994fecd95666f46cf371ecafa003fe20">pma::Track3D::Initialize</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>, <span class="keywordtype">float</span> initEndSegW)</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;{</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keywordflow">if</span> (!HasTwoViews(2)) {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Need min. 2 hits per view, at least two views.&quot;</span>;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  }</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="keyword">auto</span> cryos = Cryos();</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordflow">if</span> (cryos.size() &gt; 1) {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Only one cryostat for now, please.&quot;</span>;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  }</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keywordtype">int</span> cryo = cryos.front();</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keyword">auto</span> tpcs = <a class="code" href="../../db/d23/opt0finder__sbnd_8fcl.html#aaaa93cd86c9f63d1f138578f4d28c1c0">TPCs</a>();</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keywordflow">if</span> (tpcs.size() &gt; 1) {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Only one TPC, please.&quot;</span>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  }</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="comment">// single tpc, many tpc&#39;s are ok, but need to be handled from ProjectionMatchingAlg::buildMultiTPCTrack()</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordtype">int</span> tpc = tpcs.front();</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="keywordflow">if</span> (InitFromRefPoints(detProp, tpc, cryo))</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Track initialized with 3D reference points.&quot;</span>;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (InitFromHits(detProp, tpc, cryo, initEndSegW))</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Track initialized with hit positions.&quot;</span>;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    InitFromMiddle(detProp, tpc, cryo);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Track initialized in the module center.&quot;</span>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  }</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  UpdateHitsRadius();</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;}</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#af6ca7ff5ce08fcc4334fece1b74e3e53">  113</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#af6ca7ff5ce08fcc4334fece1b74e3e53">pma::Track3D::ClearNodes</a>()</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;{</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; fNodes.size(); i++)</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keyword">delete</span> fNodes[i];</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  fNodes.clear();</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;}</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a835316cee2286ca4f8b7e2201ca3e945">  121</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a835316cee2286ca4f8b7e2201ca3e945">pma::Track3D::InitFromHits</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                           <span class="keywordtype">int</span> tpc,</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                           <span class="keywordtype">int</span> cryo,</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                           <span class="keywordtype">float</span> initEndSegW)</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;{</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  art::ServiceHandle&lt;geo::Geometry const&gt; geom;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="keywordtype">float</span> wtmp = fEndSegWeight;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  fEndSegWeight = initEndSegW;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="comment">// endpoints for the first combination:</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  TVector3 v3d_1(0., 0., 0.), v3d_2(0., 0., 0.);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  assert(!fHits.empty());</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* hit0_a = fHits.front();</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* hit1_a = fHits.front();</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keywordtype">float</span> minX = detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a8e4b4b8d755ffded5a9f956ae7c9c1ec">ConvertTicksToX</a>(hit0_a-&gt;PeakTime(), hit0_a-&gt;View2D(), tpc, cryo);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="keywordtype">float</span> maxX = detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a8e4b4b8d755ffded5a9f956ae7c9c1ec">ConvertTicksToX</a>(hit1_a-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aaa10befa83bf11f7bb6a65541befd332">PeakTime</a>(), hit1_a-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>(), tpc, cryo);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : fHits) {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordtype">double</span> <span class="keyword">const</span> <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a> = detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a8e4b4b8d755ffded5a9f956ae7c9c1ec">ConvertTicksToX</a>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;PeakTime(), <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;View2D(), tpc, cryo);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">if</span> (x &lt; minX) {</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      minX = <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a>;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      hit0_a = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    }</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">if</span> (x &gt; maxX) {</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      maxX = <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a>;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      hit1_a = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* hit0_b = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* hit1_b = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keywordtype">float</span> minDiff0 = 5000, minDiff1 = 5000;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : fHits) {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordtype">double</span> <span class="keyword">const</span> <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a> = detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a8e4b4b8d755ffded5a9f956ae7c9c1ec">ConvertTicksToX</a>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;PeakTime(), <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;View2D(), tpc, cryo);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordtype">double</span> diff = fabs(x - minX);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">if</span> ((diff &lt; minDiff0) &amp;&amp; (<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;View2D() != hit0_a-&gt;View2D())) {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      minDiff0 = diff;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      hit0_b = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    }</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    diff = fabs(x - maxX);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">if</span> ((diff &lt; minDiff1) &amp;&amp; (<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;View2D() != hit1_a-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>())) {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      minDiff1 = diff;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      hit1_b = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    }</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  }</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keywordflow">if</span> (hit0_a &amp;&amp; hit0_b &amp;&amp; hit1_a &amp;&amp; hit1_b) {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a> = 0.5 * (detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a8e4b4b8d755ffded5a9f956ae7c9c1ec">ConvertTicksToX</a>(hit0_a-&gt;PeakTime(), hit0_a-&gt;View2D(), tpc, cryo) +</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                      detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a8e4b4b8d755ffded5a9f956ae7c9c1ec">ConvertTicksToX</a>(hit0_b-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aaa10befa83bf11f7bb6a65541befd332">PeakTime</a>(), hit0_b-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>(), tpc, cryo));</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a1e5aaaf25e8609a835e8c7c6fda71456">y</a>, <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#ae40184b0245025a43c56daa3261d5e3c">z</a>;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    geom-&gt;IntersectionPoint(</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      hit0_a-&gt;Wire(), hit0_b-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aa293ec05456935fc468dcc355d52102a">Wire</a>(), hit0_a-&gt;View2D(), hit0_b-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>(), cryo, tpc, <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a1e5aaaf25e8609a835e8c7c6fda71456">y</a>, <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#ae40184b0245025a43c56daa3261d5e3c">z</a>);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    v3d_1.SetXYZ(x, y, z);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    x = 0.5 * (detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a8e4b4b8d755ffded5a9f956ae7c9c1ec">ConvertTicksToX</a>(hit1_a-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aaa10befa83bf11f7bb6a65541befd332">PeakTime</a>(), hit1_a-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>(), tpc, cryo) +</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;               detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a8e4b4b8d755ffded5a9f956ae7c9c1ec">ConvertTicksToX</a>(hit1_b-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aaa10befa83bf11f7bb6a65541befd332">PeakTime</a>(), hit1_b-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>(), tpc, cryo));</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    geom-&gt;IntersectionPoint(</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      hit1_a-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aa293ec05456935fc468dcc355d52102a">Wire</a>(), hit1_b-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aa293ec05456935fc468dcc355d52102a">Wire</a>(), hit1_a-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>(), hit1_b-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>(), cryo, tpc, <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a1e5aaaf25e8609a835e8c7c6fda71456">y</a>, <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#ae40184b0245025a43c56daa3261d5e3c">z</a>);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    v3d_2.SetXYZ(x, y, z);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    ClearNodes();</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    AddNode(detProp, v3d_1, tpc, cryo);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    AddNode(detProp, v3d_2, tpc, cryo);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    MakeProjection();</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    UpdateHitsRadius();</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    Optimize(detProp, 0, 0.01<a class="code" href="../../d4/daf/sbnana_2sbnana_2CAFAna_2Analysis_2Surface_8cxx.html#a2c3bf28add4b70497e6fd9070cd7dfc9">F</a>, <span class="keyword">false</span>, <span class="keyword">true</span>, 100);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    SelectAllHits();</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  }</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Good hits not found.&quot;</span>;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    fEndSegWeight = wtmp;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  }</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d8/d4a/namespacepma.html#a6533238e57afc147ba9155b759521d20">pma::Dist2</a>(fNodes.front()-&gt;Point3D(), fNodes.back()-&gt;Point3D()) &lt; (0.3 * 0.3)) {</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Short initial segment.&quot;</span>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    fEndSegWeight = wtmp;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  fEndSegWeight = wtmp;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;}</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l00211"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a07b802dc845765de7edf0ecec48a3fe3">  211</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a07b802dc845765de7edf0ecec48a3fe3">pma::Track3D::InitFromRefPoints</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>, <span class="keywordtype">int</span> tpc, <span class="keywordtype">int</span> cryo)</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;{</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordflow">if</span> (fAssignedPoints.size() &lt; 2) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  ClearNodes();</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  TVector3 <a class="code" href="../../da/dc9/namespacepmtana.html#afea8da0c88fccc3252529b6a49284b4a">mean</a>(0., 0., 0.), stdev(0., 0., 0.), <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>(0., 0., 0.);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; fAssignedPoints.size(); i++) {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    p = *(fAssignedPoints[i]);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <a class="code" href="../../da/dc9/namespacepmtana.html#afea8da0c88fccc3252529b6a49284b4a">mean</a> += <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    p.SetXYZ(p.X() * p.X(), p.Y() * p.Y(), p.Z() * p.Z());</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    stdev += <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  }</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  stdev *= 1.0 / fAssignedPoints.size();</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <a class="code" href="../../da/dc9/namespacepmtana.html#afea8da0c88fccc3252529b6a49284b4a">mean</a> *= 1.0 / fAssignedPoints.size();</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  p = <a class="code" href="../../da/dc9/namespacepmtana.html#afea8da0c88fccc3252529b6a49284b4a">mean</a>;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  p.SetXYZ(p.X() * p.X(), p.Y() * p.Y(), p.Z() * p.Z());</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  stdev -= <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="keywordtype">double</span> sx = stdev.X(), sy = stdev.Y(), sz = stdev.Z();</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordflow">if</span> (sx &gt;= 0.0)</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    sx = sqrt(sx);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    sx = 0.0;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keywordflow">if</span> (sy &gt;= 0.0)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    sy = sqrt(sy);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    sy = 0.0;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keywordflow">if</span> (sz &gt;= 0.0)</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    sz = sqrt(sz);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    sz = 0.0;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  stdev.SetXYZ(sx, sy, sz);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordtype">double</span> scale = 2.0 * stdev.Mag();</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="keywordtype">double</span> iscale = 1.0 / scale;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="keywordtype">size_t</span> max_index = 0;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordtype">double</span> norm2, max_norm2 = 0.0;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  std::vector&lt;TVector3&gt; data;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; fAssignedPoints.size(); i++) {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    p = *(fAssignedPoints[i]);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    p -= <a class="code" href="../../da/dc9/namespacepmtana.html#afea8da0c88fccc3252529b6a49284b4a">mean</a>;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    p *= iscale;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    norm2 = p.Mag2();</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">if</span> (norm2 &gt; max_norm2) {</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      max_norm2 = norm2;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      max_index = i;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    }</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    data.push_back(p);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  }</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a1e5aaaf25e8609a835e8c7c6fda71456">y</a> = 0.0, kappa = 1.0, prev_kappa, kchg = 1.0;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  TVector3 <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">w</a>(data[max_index]);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keywordflow">while</span> (kchg &gt; 0.0001)</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; data.size(); i++) {</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      y = (data[i] * <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">w</a>);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      w += (y / kappa) * (data[i] - y * w);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      prev_kappa = kappa;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      kappa += y * <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a1e5aaaf25e8609a835e8c7c6fda71456">y</a>;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      kchg = fabs((kappa - prev_kappa) / prev_kappa);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    }</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  w *= 1.0 / w.Mag();</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  TVector3 v1(w), v2(w);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  v1 *= scale;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  v1 += <a class="code" href="../../da/dc9/namespacepmtana.html#afea8da0c88fccc3252529b6a49284b4a">mean</a>;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  v2 *= -scale;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  v2 += <a class="code" href="../../da/dc9/namespacepmtana.html#afea8da0c88fccc3252529b6a49284b4a">mean</a>;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  std::sort(fAssignedPoints.begin(), fAssignedPoints.end(), <a class="code" href="../../d2/d44/classpma_1_1bSegmentProjLess.html">pma::bSegmentProjLess</a>(v1, v2));</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; fAssignedPoints.size(); i++) {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    AddNode(detProp, *(fAssignedPoints[i]), tpc, cryo);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  RebuildSegments();</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  MakeProjection();</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>()) UpdateHitsRadius();</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  Optimize(detProp, 0, 0.01<a class="code" href="../../d4/daf/sbnana_2sbnana_2CAFAna_2Analysis_2Surface_8cxx.html#a2c3bf28add4b70497e6fd9070cd7dfc9">F</a>, <span class="keyword">false</span>, <span class="keyword">true</span>, 100);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  SelectAllHits();</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;}</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00299"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a630e8a4c7f28f79d4a689e6c2035df42">  299</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a630e8a4c7f28f79d4a689e6c2035df42">pma::Track3D::InitFromMiddle</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>, <span class="keywordtype">int</span> tpc, <span class="keywordtype">int</span> cryo)</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;{</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  art::ServiceHandle&lt;geo::Geometry const&gt; geom;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; tpcGeo = geom-&gt;TPC(tpc, cryo);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keywordtype">double</span> minX = tpcGeo.MinX(), maxX = tpcGeo.MaxX();</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keywordtype">double</span> minY = tpcGeo.MinY(), maxY = tpcGeo.MaxY();</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="keywordtype">double</span> minZ = tpcGeo.MinZ(), maxZ = tpcGeo.MaxZ();</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  TVector3 v3d_1(0.5 * (minX + maxX), 0.5 * (minY + maxY), 0.5 * (minZ + maxZ));</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  TVector3 v3d_2(v3d_1);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  TVector3 <a class="code" href="../../db/ddd/fcl__checks_8sh.html#ab3c44a76dd678c93affe68a1f8a980ab">shift</a>(5.0, 5.0, 5.0);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  v3d_1 += <a class="code" href="../../db/ddd/fcl__checks_8sh.html#ab3c44a76dd678c93affe68a1f8a980ab">shift</a>;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  v3d_2 -= <a class="code" href="../../db/ddd/fcl__checks_8sh.html#ab3c44a76dd678c93affe68a1f8a980ab">shift</a>;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  ClearNodes();</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  AddNode(detProp, v3d_1, tpc, cryo);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  AddNode(detProp, v3d_2, tpc, cryo);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  MakeProjection();</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  UpdateHitsRadius();</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  Optimize(detProp, 0, 0.01<a class="code" href="../../d4/daf/sbnana_2sbnana_2CAFAna_2Analysis_2Surface_8cxx.html#a2c3bf28add4b70497e6fd9070cd7dfc9">F</a>);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;}</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l00327"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a33feafc2c789f4e68a2b3457532e9945">  327</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1ebcf6ec250cd859b1f577dd6245c328">pma::Track3D::index_of</a>(<span class="keyword">const</span> <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; fNodes.size(); ++i)</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">if</span> (fNodes[i] == n) <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)i;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;}</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l00335"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a1ebcf6ec250cd859b1f577dd6245c328">  335</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1ebcf6ec250cd859b1f577dd6245c328">pma::Track3D::index_of</a>(<span class="keyword">const</span> <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>(); i++)</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">if</span> (fHits[i] == hit) <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)i;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;}</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>*</div>
<div class="line"><a name="l00343"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a5c89f8f5decd2a9873956d225f9cee6f">  343</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a5c89f8f5decd2a9873956d225f9cee6f">pma::Track3D::release_at</a>(<span class="keywordtype">size_t</span> index)</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;{</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* h3d = fHits[index];</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  fHits.erase(fHits.begin() + index);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="keywordflow">return</span> h3d;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;}</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l00351"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a291117cde20ec3683e598cebf4cdc2a9">  351</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a9e34c6cc001b39a9ad184972ce42d094">pma::Track3D::push_back</a>(<span class="keyword">const</span> <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                        <span class="keyword">const</span> art::Ptr&lt;recob::Hit&gt;&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>)</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;{</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; trk_hit : fHits) {</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">if</span> (trk_hit-&gt;fHit == hit) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  }</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* h3d = <span class="keyword">new</span> <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>(detProp, hit);</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  h3d-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a8ae6c786ab52cfa3e1e1962c5fba06af">fParent</a> = <span class="keyword">this</span>;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  fHits.<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a9e34c6cc001b39a9ad184972ce42d094">push_back</a>(h3d);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;}</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l00364"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#af5d763add9d35685d01a29c4cea6d6b9">  364</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#af5d763add9d35685d01a29c4cea6d6b9">pma::Track3D::erase</a>(<span class="keyword">const</span> art::Ptr&lt;recob::Hit&gt;&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>)</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;{</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>(); i++) {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">if</span> (hit == fHits[i]-&gt;fHit) {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* h3d = fHits[i];</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      fHits.erase(fHits.begin() + i);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      <span class="keyword">delete</span> h3d;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  }</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;}</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<a class="code" href="../../d8/d4a/namespacepma.html#a3770c6a1a7dc99a26ddab01e5cec6cf5">pma::Vector3D</a></div>
<div class="line"><a name="l00378"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#adc4aeb1524832cdc48e6f43dbfed5f55">  378</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#adc4aeb1524832cdc48e6f43dbfed5f55">pma::Track3D::GetDirection3D</a>(<span class="keywordtype">size_t</span> index)<span class="keyword"> const</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a> = fHits[index];</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> : fSegments) {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>-&gt;HasHit(h)) <span class="keywordflow">return</span> <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>-&gt;GetDirection3D();</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> : fNodes) {</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>-&gt;HasHit(h)) <span class="keywordflow">return</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>-&gt;GetDirection3D();</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keyword">auto</span> pe = GetNearestElement(h-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a63647e230c7fe8690d1b526d9f5b248f">Point2D</a>(), h-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>(), h-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aa598af0b3191db78c37f98fc99e5bb0e">TPC</a>());</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="keywordflow">if</span> (pe) {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    mf::LogWarning(<span class="stringliteral">&quot;pma::Track3D&quot;</span>)</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;GetDirection3D(): had to update hit assignment to segment/node.&quot;</span>;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    pe-&gt;AddHit(h);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordflow">return</span> pe-&gt;GetDirection3D();</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  }</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;GetDirection3D(): direction of a not assigned hit &quot;</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                                         &lt;&lt; index &lt;&lt; <span class="stringliteral">&quot; (size: &quot;</span> &lt;&lt; fHits.size() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  }</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;}</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00403"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#ad2e2ce04eb39cad0ca47ef676306c1cb">  403</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ad2e2ce04eb39cad0ca47ef676306c1cb">pma::Track3D::AddHits</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                      <span class="keyword">const</span> <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&amp; hits)</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;{</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  fHits.reserve(fHits.size() + hits.size());</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : hits)</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    push_back(detProp, <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>);</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;}</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00412"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#ad8a3bf5b35a8e37f4b0ef8463e3fec7f">  412</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ad8a3bf5b35a8e37f4b0ef8463e3fec7f">pma::Track3D::RemoveHits</a>(<span class="keyword">const</span> <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&amp; hits)</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;{</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> = 0;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : hits) {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">if</span> (erase(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>)) n++;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  }</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="keywordflow">if</span> (n) MakeProjection();</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;}</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span></div>
<div class="line"><a name="l00422"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a406e522e831ec16eb527f4057e0dc216">  422</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a406e522e831ec16eb527f4057e0dc216">pma::Track3D::NHits</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> view)<span class="keyword"> const</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> = 0;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : fHits) {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;View2D() == view) n++;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  }</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;}</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span></div>
<div class="line"><a name="l00432"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a60281b4c714aa99c93773f3608cadc13">  432</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a60281b4c714aa99c93773f3608cadc13">pma::Track3D::NEnabledHits</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> view)<span class="keyword"> const</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> = 0;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : fHits) {</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;IsEnabled() &amp;&amp; ((view == <a class="code" href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486ae329b0f520125896d02940bec370fca7">geo::kUnknown</a>) || (view == <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;View2D()))) n++;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  }</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;}</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l00442"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a39c3984b0f5f5ac48187ade44578df94">  442</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a39c3984b0f5f5ac48187ade44578df94">pma::Track3D::HasTwoViews</a>(<span class="keywordtype">size_t</span> <span class="keyword">const</span> nmin)<span class="keyword"> const</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nviews = 0;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keywordflow">if</span> (NHits(<a class="code" href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486ae2842cacc3d7d281d01b4316380b8d5b">geo::kU</a>) &gt;= nmin) nviews++;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="keywordflow">if</span> (NHits(<a class="code" href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486aea23122caaaed75b787c745a188871f6">geo::kV</a>) &gt;= nmin) nviews++;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <span class="keywordflow">if</span> (NHits(<a class="code" href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486a29e198ce46b2c8fc4a31422f42f77c64">geo::kZ</a>) &gt;= nmin) nviews++;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <span class="keywordflow">return</span> nviews &gt; 1;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;}</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;std::vector&lt;unsigned int&gt;</div>
<div class="line"><a name="l00452"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a654256f331ce57a9579086acae964efd">  452</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a654256f331ce57a9579086acae964efd">pma::Track3D::TPCs</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  std::vector&lt;unsigned int&gt; tpc_idxs;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : fHits) {</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tpc = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;TPC();</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="keyword">const</span> tpc_idx : tpc_idxs)</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      <span class="keywordflow">if</span> (tpc_idx == tpc) {</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        found = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      }</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordflow">if</span> (!found) tpc_idxs.push_back(tpc);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  }</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keywordflow">return</span> tpc_idxs;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;}</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;std::vector&lt;unsigned int&gt;</div>
<div class="line"><a name="l00471"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a4fa852d2bb7eb83f6d96c0f00da3d518">  471</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a4fa852d2bb7eb83f6d96c0f00da3d518">pma::Track3D::Cryos</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  std::vector&lt;unsigned int&gt; cryo_idxs;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : fHits) {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cryo = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;Cryo();</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; cryo_idxs.size(); j++)</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      <span class="keywordflow">if</span> (cryo_idxs[j] == cryo) {</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        found = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      }</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keywordflow">if</span> (!found) cryo_idxs.push_back(cryo);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  }</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="keywordflow">return</span> cryo_idxs;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;}</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;std::pair&lt;TVector2, TVector2&gt;</div>
<div class="line"><a name="l00490"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#ac011feb5eade195cdb3d4bf4f0458d63">  490</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac011feb5eade195cdb3d4bf4f0458d63">pma::Track3D::WireDriftRange</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> view,</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tpc,</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cryo)<span class="keyword"> const</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  std::pair&lt;TVector2, TVector2&gt; range(TVector2(0., 0.), TVector2(0., 0.));</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="keywordtype">size_t</span> n0 = 0;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="keywordflow">while</span> ((n0 &lt; fNodes.size()) &amp;&amp; (fNodes[n0]-&gt;<a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>() != (int)tpc))</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    n0++;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="keywordflow">if</span> (n0 &lt; fNodes.size()) {</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keywordtype">size_t</span> n1 = n0;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordflow">while</span> ((n1 &lt; fNodes.size()) &amp;&amp; (fNodes[n1]-&gt;<a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>() == (int)tpc))</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      n1++;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keywordflow">if</span> (n0 &gt; 0) n0--;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordflow">if</span> (n1 == fNodes.size()) n1--;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    TVector2 p0 = fNodes[n0]-&gt;Projection2D(view);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    p0 = <a class="code" href="../../d8/d4a/namespacepma.html#ad1b103cd1dc1bf59c3dd46f5a418af15">pma::CmToWireDrift</a>(detProp, p0.X(), p0.Y(), view, tpc, cryo);</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    TVector2 <a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a> = fNodes[n1]-&gt;Projection2D(view);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    p1 = <a class="code" href="../../d8/d4a/namespacepma.html#ad1b103cd1dc1bf59c3dd46f5a418af15">pma::CmToWireDrift</a>(detProp, p1.X(), p1.Y(), view, tpc, cryo);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">if</span> (p0.X() &gt; p1.X()) {</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <span class="keywordtype">double</span> tmp = p0.X();</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      p0.Set(p1.X(), p0.Y());</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      p1.Set(tmp, p1.Y());</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    }</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordflow">if</span> (p0.Y() &gt; p1.Y()) {</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      <span class="keywordtype">double</span> tmp = p0.Y();</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      p0.Set(p0.X(), p1.Y());</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      p1.Set(p1.X(), tmp);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    }</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    range.first = p0;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    range.second = <a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a>;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  }</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="keywordflow">return</span> range;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;}</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l00533"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a17c2878ac4a702eac76038d5c9d1e542">  533</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a30292e2ba0d04fa9fedd7ec4af2dd5b5">pma::Track3D::Flip</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                   std::vector&lt;pma::Track3D*&gt;&amp; allTracks)</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;{</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <span class="keywordflow">if</span> (fNodes.size() &lt; 2) { <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  std::vector&lt;pma::Track3D*&gt; toSort;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> = fNodes.front();</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <span class="keywordflow">if</span> (n-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>()) {</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(n-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>());</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* t = s-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>();</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a5f2a5070e3202fd89448a4c441ab3791">NextSegment</a>(n)) <span class="comment">// starts from middle of another track: need to break that one first</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    {</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keywordtype">int</span> idx = t-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1ebcf6ec250cd859b1f577dd6245c328">index_of</a>(n);</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      <span class="keywordflow">if</span> (idx &gt;= 0) {</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* u = t-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#aab8302ffd36cff08d508bbae460f9254">Split</a>(detProp, idx, <span class="keyword">false</span>); <span class="comment">// u is in front of t</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <span class="keywordflow">if</span> (u) {</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;          allTracks.push_back(u);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;          <span class="keywordflow">if</span> (u-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a17c2878ac4a702eac76038d5c9d1e542">Flip</a>(detProp, allTracks)) {</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            InternalFlip(toSort);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            toSort.push_back(<span class="keyword">this</span>);</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;          }</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;          <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            mf::LogWarning(<span class="stringliteral">&quot;pma::Track3D&quot;</span>)</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;Flip(): Could not flip after split (but new track is preserved!!).&quot;</span>;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;          }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        }</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        } <span class="comment">// could not flip/break associated tracks, so give up on this one</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      }</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Node not found.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      }</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    }</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keywordflow">else</span> <span class="comment">// flip root</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a17c2878ac4a702eac76038d5c9d1e542">Flip</a>(detProp, allTracks)) <span class="comment">// all ok, so can flip this track</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      {</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        InternalFlip(toSort);</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        toSort.push_back(<span class="keyword">this</span>);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      }</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      } <span class="comment">// could not flip/break associated tracks, so give up on this one</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    }</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  }</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="keywordflow">else</span> <span class="comment">// simply flip</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  {</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    InternalFlip(toSort);</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    toSort.push_back(<span class="keyword">this</span>);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  }</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> t = 0; t &lt; toSort.size(); t++) {</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordtype">bool</span> sorted = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> u = 0; u &lt; t; u++)</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      <span class="keywordflow">if</span> (toSort[u] == toSort[t]) {</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        sorted = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      }</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keywordflow">if</span> (!sorted) {</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      toSort[t]-&gt;MakeProjection();</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      toSort[t]-&gt;SortHits();</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    }</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  }</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;}</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00604"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#af1b0be21f94a7d5972e7b50fcc830596">  604</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#af1b0be21f94a7d5972e7b50fcc830596">pma::Track3D::InternalFlip</a>(std::vector&lt;pma::Track3D*&gt;&amp; toSort)</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;{</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; fNodes.size() - 1; i++)</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordflow">if</span> (fNodes[i]-&gt;NextCount() &gt; 1) {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; fNodes[i]-&gt;NextCount(); j++) {</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(fNodes[i]-&gt;Next(j));</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>() != <span class="keyword">this</span>) toSort.push_back(s-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>());</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      }</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    }</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  <span class="keywordflow">if</span> (fNodes.back()-&gt;NextCount())</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; fNodes.back()-&gt;NextCount(); j++) {</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(fNodes.back()-&gt;Next(j));</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      toSort.push_back(s-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>());</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    }</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="keywordflow">if</span> (fNodes.front()-&gt;Prev()) {</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(fNodes.front()-&gt;Prev());</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    toSort.push_back(s-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>());</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    s-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>()-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#af1b0be21f94a7d5972e7b50fcc830596">InternalFlip</a>(toSort);</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  }</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  std::reverse(fNodes.begin(), fNodes.end());</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  toSort.push_back(<span class="keyword">this</span>);</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  RebuildSegments();</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;}</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00632"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a30292e2ba0d04fa9fedd7ec4af2dd5b5">  632</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a30292e2ba0d04fa9fedd7ec4af2dd5b5">pma::Track3D::Flip</a>()</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;{</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  std::vector&lt;pma::Track3D*&gt; toSort;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  InternalFlip(toSort);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  toSort.push_back(<span class="keyword">this</span>);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> t = 0; t &lt; toSort.size(); t++) {</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keywordtype">bool</span> sorted = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> u = 0; u &lt; t; u++)</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <span class="keywordflow">if</span> (toSort[u] == toSort[t]) {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        sorted = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      }</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="keywordflow">if</span> (!sorted) {</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      toSort[t]-&gt;MakeProjection();</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      toSort[t]-&gt;SortHits();</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    }</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  }</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;}</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l00653"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a952f9da40b18b2a95d0da005d22c117b">  653</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a952f9da40b18b2a95d0da005d22c117b">pma::Track3D::CanFlip</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <span class="keywordflow">if</span> (!fNodes.size()) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> = fNodes.front();</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  <span class="keywordflow">if</span> (n-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>()) {</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(n-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>());</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* t = s-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>();</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a5f2a5070e3202fd89448a4c441ab3791">NextSegment</a>(n)) { <span class="keywordflow">return</span> <span class="keyword">false</span>; } <span class="comment">// cannot flip if starts from middle of another track</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      <span class="keywordflow">return</span> t-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a952f9da40b18b2a95d0da005d22c117b">CanFlip</a>();</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    } <span class="comment">// check root</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  }</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  }</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;}</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00672"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#ab80632e865e56cf31c7645543f5f6c83">  672</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ab80632e865e56cf31c7645543f5f6c83">pma::Track3D::AutoFlip</a>(<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1f6428b89518e48188e293c2c67743dd">pma::Track3D::EDirection</a> <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>, <span class="keywordtype">double</span> thr, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>)</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;{</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nViews = 3;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <a class="code" href="../../d8/d4a/namespacepma.html#af467dbe2a7cc1be08144c157a06676f7">pma::dedx_map</a> dedxInViews[3];</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; nViews; i++) {</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    GetRawdEdxSequence(dedxInViews[i], i, 1);</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  }</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bestView = 2;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <span class="keywordflow">if</span> (dedxInViews[0].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() &gt; 2 * dedxInViews[2].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>()) bestView = 0;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  <span class="keywordflow">if</span> (dedxInViews[1].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() &gt; 2 * dedxInViews[2].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>()) bestView = 1;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  std::vector&lt;std::vector&lt;double&gt;&gt; dedx;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>(); i++) {</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keyword">auto</span> it = dedxInViews[bestView].find(i);</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="keywordflow">if</span> (it != dedxInViews[bestView].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>()) { dedx.push_back(it-&gt;second); }</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  }</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <span class="keywordflow">if</span> (!dedx.empty()) dedx.pop_back();</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <span class="keywordtype">float</span> dEdxStart = 0.0F, dEdxStop = 0.0F;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  <span class="keywordtype">float</span> dEStart = 0.0F, dxStart = 0.0F;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <span class="keywordtype">float</span> dEStop = 0.0F, dxStop = 0.0F;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <span class="keywordflow">if</span> (dedx.size() &gt; 4) {</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="keywordflow">if</span> (!n) <span class="comment">// use default options</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    {</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      <span class="keywordflow">if</span> (dedx.size() &gt; 30)</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        n = 12;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dedx.size() &gt; 20)</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        n = 8;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dedx.size() &gt; 10)</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        n = 4;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        n = 3;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    }</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a122a7b8666811f02fba2c0fcdc485d17">k</a> = (dedx.size() - 2) &gt;&gt; 1;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="keywordflow">if</span> (n &gt; k) n = <a class="code" href="../../d9/dd2/selectors_8fcl.html#a122a7b8666811f02fba2c0fcdc485d17">k</a>;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 1, j = 0; j &lt; <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>; i++, j++) {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      dEStart += dedx[i][5];</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      dxStart += dedx[i][6];</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    }</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="keywordflow">if</span> (dxStart &gt; 0.0<a class="code" href="../../d4/daf/sbnana_2sbnana_2CAFAna_2Analysis_2Surface_8cxx.html#a2c3bf28add4b70497e6fd9070cd7dfc9">F</a>) dEdxStart = dEStart / dxStart;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = dedx.size() - 2, j = 0; j &lt; <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>; i--, j++) {</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      dEStop += dedx[i][5];</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      dxStop += dedx[i][6];</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    }</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="keywordflow">if</span> (dxStop &gt; 0.0<a class="code" href="../../d4/daf/sbnana_2sbnana_2CAFAna_2Analysis_2Surface_8cxx.html#a2c3bf28add4b70497e6fd9070cd7dfc9">F</a>) dEdxStop = dEStop / dxStop;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dedx.size() == 4) {</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    dEStart = dedx[0][5] + dedx[1][5];</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    dxStart = dedx[0][6] + dedx[1][6];</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    dEStop = dedx[2][5] + dedx[3][5];</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    dxStop = dedx[2][6] + dedx[3][6];</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <span class="keywordflow">if</span> (dxStart &gt; 0.0<a class="code" href="../../d4/daf/sbnana_2sbnana_2CAFAna_2Analysis_2Surface_8cxx.html#a2c3bf28add4b70497e6fd9070cd7dfc9">F</a>) dEdxStart = dEStart / dxStart;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="keywordflow">if</span> (dxStop &gt; 0.0<a class="code" href="../../d4/daf/sbnana_2sbnana_2CAFAna_2Analysis_2Surface_8cxx.html#a2c3bf28add4b70497e6fd9070cd7dfc9">F</a>) dEdxStop = dEStop / dxStop;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  }</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dedx.size() &gt; 1) {</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">if</span> (dedx.front()[2] &gt; 0.0F) dEdxStart = dedx.front()[5] / dedx.front()[6];</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keywordflow">if</span> (dedx.back()[2] &gt; 0.0F) dEdxStop = dedx.back()[5] / dedx.back()[6];</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  }</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <span class="keywordflow">if</span> ((dir == <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1f6428b89518e48188e293c2c67743ddaa703023c9fcc4055af46588f20785bfd">pma::Track3D::kForward</a>) &amp;&amp; ((1.0 + thr) * dEdxStop &lt; dEdxStart)) {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>)</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Auto-flip fired (1), thr: &quot;</span> &lt;&lt; (1.0 + thr) &lt;&lt; <span class="stringliteral">&quot;, value: &quot;</span> &lt;&lt; dEdxStart / dEdxStop;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    Flip(); <span class="comment">// particle stops at the end of the track</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  }</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  <span class="keywordflow">if</span> ((dir == <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1f6428b89518e48188e293c2c67743dda5935c997afe0c7204f83eaf7d5b9075c">pma::Track3D::kBackward</a>) &amp;&amp; (dEdxStop &gt; (1.0 + thr) * dEdxStart)) {</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>)</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Auto-flip fired (2), thr: &quot;</span> &lt;&lt; (1.0 + thr) &lt;&lt; <span class="stringliteral">&quot;, value: &quot;</span> &lt;&lt; dEdxStop / dEdxStart;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    Flip(); <span class="comment">// particle stops at the front of the track</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  }</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;}</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l00749"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a7fe3338fa838aa517422c8e335a27a7d">  749</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ab80632e865e56cf31c7645543f5f6c83">pma::Track3D::AutoFlip</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                       std::vector&lt;pma::Track3D*&gt;&amp; allTracks,</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                       <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1f6428b89518e48188e293c2c67743dd">pma::Track3D::EDirection</a> <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>,</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                       <span class="keywordtype">double</span> thr,</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>)</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;{</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nViews = 3;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  <a class="code" href="../../d8/d4a/namespacepma.html#af467dbe2a7cc1be08144c157a06676f7">pma::dedx_map</a> dedxInViews[3];</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; nViews; i++) {</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    GetRawdEdxSequence(dedxInViews[i], i, 1);</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  }</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bestView = 2;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  <span class="keywordflow">if</span> (dedxInViews[0].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() &gt; 2 * dedxInViews[2].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>()) bestView = 0;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  <span class="keywordflow">if</span> (dedxInViews[1].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() &gt; 2 * dedxInViews[2].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>()) bestView = 1;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  std::vector&lt;std::vector&lt;double&gt;&gt; dedx;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>(); i++) {</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="keyword">auto</span> it = dedxInViews[bestView].find(i);</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordflow">if</span> (it != dedxInViews[bestView].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>()) { dedx.push_back(it-&gt;second); }</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  }</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  <span class="keywordflow">if</span> (!dedx.empty()) dedx.pop_back();</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <span class="keywordtype">float</span> dEdxStart = 0.0F, dEdxStop = 0.0F;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  <span class="keywordtype">float</span> dEStart = 0.0F, dxStart = 0.0F;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="keywordtype">float</span> dEStop = 0.0F, dxStop = 0.0F;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <span class="keywordflow">if</span> (dedx.size() &gt; 4) {</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="keywordflow">if</span> (!n) <span class="comment">// use default options</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    {</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      <span class="keywordflow">if</span> (dedx.size() &gt; 30)</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        n = 12;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dedx.size() &gt; 20)</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        n = 8;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dedx.size() &gt; 10)</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        n = 4;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        n = 3;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    }</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a122a7b8666811f02fba2c0fcdc485d17">k</a> = (dedx.size() - 2) &gt;&gt; 1;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordflow">if</span> (n &gt; k) n = <a class="code" href="../../d9/dd2/selectors_8fcl.html#a122a7b8666811f02fba2c0fcdc485d17">k</a>;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 1, j = 0; j &lt; <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>; i++, j++) {</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      dEStart += dedx[i][5];</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;      dxStart += dedx[i][6];</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    }</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keywordflow">if</span> (dxStart &gt; 0.0<a class="code" href="../../d4/daf/sbnana_2sbnana_2CAFAna_2Analysis_2Surface_8cxx.html#a2c3bf28add4b70497e6fd9070cd7dfc9">F</a>) dEdxStart = dEStart / dxStart;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = dedx.size() - 2, j = 0; j &lt; <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>; i--, j++) {</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      dEStop += dedx[i][5];</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;      dxStop += dedx[i][6];</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    }</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="keywordflow">if</span> (dxStop &gt; 0.0<a class="code" href="../../d4/daf/sbnana_2sbnana_2CAFAna_2Analysis_2Surface_8cxx.html#a2c3bf28add4b70497e6fd9070cd7dfc9">F</a>) dEdxStop = dEStop / dxStop;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  }</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dedx.size() == 4) {</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    dEStart = dedx[0][5] + dedx[1][5];</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    dxStart = dedx[0][6] + dedx[1][6];</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    dEStop = dedx[2][5] + dedx[3][5];</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    dxStop = dedx[2][6] + dedx[3][6];</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keywordflow">if</span> (dxStart &gt; 0.0<a class="code" href="../../d4/daf/sbnana_2sbnana_2CAFAna_2Analysis_2Surface_8cxx.html#a2c3bf28add4b70497e6fd9070cd7dfc9">F</a>) dEdxStart = dEStart / dxStart;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordflow">if</span> (dxStop &gt; 0.0<a class="code" href="../../d4/daf/sbnana_2sbnana_2CAFAna_2Analysis_2Surface_8cxx.html#a2c3bf28add4b70497e6fd9070cd7dfc9">F</a>) dEdxStop = dEStop / dxStop;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  }</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dedx.size() &gt; 1) {</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="keywordflow">if</span> (dedx.front()[2] &gt; 0.0F) dEdxStart = dedx.front()[5] / dedx.front()[6];</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordflow">if</span> (dedx.back()[2] &gt; 0.0F) dEdxStop = dedx.back()[5] / dedx.back()[6];</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  }</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <span class="keywordtype">bool</span> done = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  <span class="keywordflow">if</span> ((dir == <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1f6428b89518e48188e293c2c67743ddaa703023c9fcc4055af46588f20785bfd">pma::Track3D::kForward</a>) &amp;&amp; ((1.0 + thr) * dEdxStop &lt; dEdxStart)) {</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>)</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Auto-flip fired (1), thr: &quot;</span> &lt;&lt; (1.0 + thr) &lt;&lt; <span class="stringliteral">&quot;, value: &quot;</span> &lt;&lt; dEdxStart / dEdxStop;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    done = Flip(detProp, allTracks); <span class="comment">// particle stops at the end of the track</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  }</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  <span class="keywordflow">if</span> ((dir == <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1f6428b89518e48188e293c2c67743dda5935c997afe0c7204f83eaf7d5b9075c">pma::Track3D::kBackward</a>) &amp;&amp; (dEdxStop &gt; (1.0 + thr) * dEdxStart)) {</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>)</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Auto-flip fired (2), thr: &quot;</span> &lt;&lt; (1.0 + thr) &lt;&lt; <span class="stringliteral">&quot;, value: &quot;</span> &lt;&lt; dEdxStop / dEdxStart;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    done = Flip(detProp, allTracks); <span class="comment">// particle stops at the front of the track</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  }</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <span class="keywordflow">return</span> done;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;}</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="keywordtype">double</span></div>
<div class="line"><a name="l00832"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#ac6e6d5433e77f3aa7d2ed75d2357d337">  832</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac6e6d5433e77f3aa7d2ed75d2357d337">pma::Track3D::TestHitsMse</a>(<span class="keyword">const</span> <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                          <span class="keyword">const</span> <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&amp; hits,</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;                          <span class="keywordtype">bool</span> normalized)<span class="keyword"> const</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  <span class="keywordflow">if</span> (hits.empty()) {</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    mf::LogWarning(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;TestHitsMse(): Empty cluster.&quot;</span>;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="keywordflow">return</span> -1.0;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  }</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  <span class="keywordtype">double</span> mse = 0.0;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a> : hits) {</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cryo = <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>-&gt;WireID().Cryostat;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tpc = <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>-&gt;WireID().TPC;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> view = <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>-&gt;WireID().Plane;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wire = <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>-&gt;WireID().Wire;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <span class="keywordtype">float</span> drift = <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>-&gt;PeakTime();</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    mse += <a class="code" href="../../d8/d4a/namespacepma.html#a6533238e57afc147ba9155b759521d20">Dist2</a>(<a class="code" href="../../d8/d4a/namespacepma.html#ac06691f19da7b76a3a27c7287e3b2ff1">pma::WireDriftToCm</a>(detProp, wire, drift, view, tpc, cryo), view, tpc, cryo);</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  }</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <span class="keywordflow">if</span> (normalized)</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="keywordflow">return</span> mse / hits.size();</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="keywordflow">return</span> mse;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;}</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span></div>
<div class="line"><a name="l00858"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#aa647dbb3591dbb9d3b4f015f25bf7760">  858</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#aa647dbb3591dbb9d3b4f015f25bf7760">pma::Track3D::TestHits</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                       <span class="keyword">const</span> <a class="code" href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">std::vector</a>&lt;art::Ptr&lt;recob::Hit&gt;&gt;&amp; hits,</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                       <span class="keywordtype">double</span> <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <span class="keywordflow">if</span> (hits.empty()) {</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    mf::LogWarning(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;TestHits(): Empty cluster.&quot;</span>;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  }</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  TVector3 p3d;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="keywordtype">double</span> tst, d2 = dist * <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nhits = 0;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a> : hits)</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="keywordflow">if</span> (GetUnconstrainedProj3D(detProp, <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>, p3d, tst) &amp;&amp; tst &lt; d2) ++nhits;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  <span class="keywordflow">return</span> nhits;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;}</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="keywordtype">double</span></div>
<div class="line"><a name="l00877"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#af779c3713907c5daa9d7ef08f2140798">  877</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a954863fd516227e21a88c0228a0227f4">pma::Track3D::Length</a>(<span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> stop, <span class="keywordtype">size_t</span> step)<span class="keyword"> const</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <span class="keyword">auto</span> <span class="keyword">const</span> nHits = <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>();</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="keywordflow">if</span> (nHits &lt; 2) <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <span class="keywordflow">if</span> (start &gt; stop) {</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <span class="keywordtype">size_t</span> tmp = stop;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    stop = start;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    start = tmp;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  }</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <span class="keywordflow">if</span> (start &gt;= nHits - 1) <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="keywordflow">if</span> (stop &gt;= nHits) stop = nHits - 1;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  <span class="keywordtype">double</span> result = 0.0;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a> *h1 = <span class="keyword">nullptr</span>, *h0 = fHits[start];</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  <span class="keywordflow">if</span> (!step) step = 1;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <span class="keywordtype">size_t</span> i = start + step;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  <span class="keywordflow">while</span> (i &lt;= stop) {</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    h1 = fHits[i];</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    result += sqrt(<a class="code" href="../../d8/d4a/namespacepma.html#a6533238e57afc147ba9155b759521d20">pma::Dist2</a>(h1-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ac3fbfcb7dedfe1063f001c832bc64998">Point3D</a>(), h0-&gt;Point3D()));</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    h0 = h1;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    i += step;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  }</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <span class="keywordflow">if</span> (i - step &lt; stop) <span class="comment">// last step jumped beyond the stop point</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  {                    <span class="comment">// so need to add the last short segment</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    result += sqrt(<a class="code" href="../../d8/d4a/namespacepma.html#a6533238e57afc147ba9155b759521d20">pma::Dist2</a>(h0-&gt;Point3D(), back()-&gt;Point3D()));</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  }</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;}</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l00909"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a64946aa8973080f604abc9eb798e9761">  909</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a64946aa8973080f604abc9eb798e9761">pma::Track3D::NextHit</a>(<span class="keywordtype">int</span> index, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> view, <span class="keywordtype">bool</span> inclDisabled)<span class="keyword"> const</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="keywordflow">if</span> (index &lt; -1) index = -1;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="keywordflow">while</span> (++index &lt; (<span class="keywordtype">int</span>)<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>()) <span class="comment">// look for the next index of hit from the view</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  {</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    hit = fHits[index];</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="keywordflow">if</span> (hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>() == view) {</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      <span class="keywordflow">if</span> (inclDisabled)</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ab628d7feecc85a8172f17aef5f4778da">IsEnabled</a>())</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    }</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  }</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  <span class="keywordflow">return</span> index;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;}</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l00927"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a1a99bfa79d240ff8cfbc6e9fe74374b3">  927</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1a99bfa79d240ff8cfbc6e9fe74374b3">pma::Track3D::PrevHit</a>(<span class="keywordtype">int</span> index, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> view, <span class="keywordtype">bool</span> inclDisabled)<span class="keyword"> const</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  <span class="keywordflow">if</span> (index &gt; (<span class="keywordtype">int</span>)<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>()) index = (int)<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>();</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  <span class="keywordflow">while</span> (--index &gt;= 0) <span class="comment">// look for the prev index of hit from the view</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  {</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    hit = fHits[index];</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="keywordflow">if</span> (hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>() == view) {</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      <span class="keywordflow">if</span> (inclDisabled)</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ab628d7feecc85a8172f17aef5f4778da">IsEnabled</a>())</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    }</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  }</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <span class="keywordflow">return</span> index;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;}</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="keywordtype">double</span></div>
<div class="line"><a name="l00945"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#ad9a738c45d2f33f276a6ee1cd6a20fec">  945</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a36905110212cd6c526ab8280afca9ae7">pma::Track3D::HitDxByView</a>(<span class="keywordtype">size_t</span> index,</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;                          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> view,</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                          <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1f6428b89518e48188e293c2c67743dd">pma::Track3D::EDirection</a> <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>,</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;                          <span class="keywordtype">bool</span> secondDir)<span class="keyword"> const</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* nexthit = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = fHits[index];</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  <span class="keywordflow">if</span> (hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>() != view) {</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    mf::LogWarning(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Function used with the hit not matching specified view.&quot;</span>;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  }</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="keywordtype">double</span> dx = 0.0; <span class="comment">// [cm]</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  <span class="keywordtype">bool</span> hitFound = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  <span class="keywordtype">int</span> i = index;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  <span class="keywordflow">switch</span> (dir) {</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1f6428b89518e48188e293c2c67743ddaa703023c9fcc4055af46588f20785bfd">pma::Track3D::kForward</a>:</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="keywordflow">while</span> (!hitFound &amp;&amp; (++i &lt; (<span class="keywordtype">int</span>)<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>())) {</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;      nexthit = fHits[i];</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      dx += sqrt(<a class="code" href="../../d8/d4a/namespacepma.html#a6533238e57afc147ba9155b759521d20">pma::Dist2</a>(hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ac3fbfcb7dedfe1063f001c832bc64998">Point3D</a>(), nexthit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ac3fbfcb7dedfe1063f001c832bc64998">Point3D</a>()));</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;      <span class="keywordflow">if</span> (nexthit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>() == view)</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        hitFound = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        hitFound = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;      hit = nexthit;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    }</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="keywordflow">if</span> (!hitFound) {</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      <span class="keywordflow">if</span> (!secondDir)</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        dx = 0.5 * HitDxByView(index, view, <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1f6428b89518e48188e293c2c67743dda5935c997afe0c7204f83eaf7d5b9075c">pma::Track3D::kBackward</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        dx = <a class="code" href="../../de/d0f/namespacetca.html#a4f3087743ae6823cd5b6e9ff1a344843">Length</a>();</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        mf::LogWarning(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Single hit in this view.&quot;</span>;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      }</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    }</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1f6428b89518e48188e293c2c67743dda5935c997afe0c7204f83eaf7d5b9075c">pma::Track3D::kBackward</a>:</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="keywordflow">while</span> (!hitFound &amp;&amp; (--i &gt;= 0)) {</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      nexthit = fHits[i];</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;      dx += sqrt(<a class="code" href="../../d8/d4a/namespacepma.html#a6533238e57afc147ba9155b759521d20">pma::Dist2</a>(hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ac3fbfcb7dedfe1063f001c832bc64998">Point3D</a>(), nexthit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ac3fbfcb7dedfe1063f001c832bc64998">Point3D</a>()));</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;      <span class="keywordflow">if</span> (nexthit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>() == view)</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        hitFound = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        hitFound = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;      hit = nexthit;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    }</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="keywordflow">if</span> (!hitFound) {</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      <span class="keywordflow">if</span> (!secondDir)</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        dx = 0.5 * HitDxByView(index, view, <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1f6428b89518e48188e293c2c67743ddaa703023c9fcc4055af46588f20785bfd">pma::Track3D::kForward</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;        dx = <a class="code" href="../../de/d0f/namespacetca.html#a4f3087743ae6823cd5b6e9ff1a344843">Length</a>();</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        mf::LogWarning(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Single hit in this view.&quot;</span>;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      }</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    }</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <span class="keywordflow">default</span>: mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Direction undefined.&quot;</span>; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  }</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <span class="keywordflow">return</span> dx;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;}</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="keywordtype">double</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a36905110212cd6c526ab8280afca9ae7"> 1011</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a36905110212cd6c526ab8280afca9ae7">pma::Track3D::HitDxByView</a>(<span class="keywordtype">size_t</span> index, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> view)<span class="keyword"> const</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="keywordflow">if</span> (index &lt; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>()) {</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <span class="keywordflow">return</span> 0.5 * (HitDxByView(index, view, <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1f6428b89518e48188e293c2c67743ddaa703023c9fcc4055af46588f20785bfd">pma::Track3D::kForward</a>) +</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                  HitDxByView(index, view, <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1f6428b89518e48188e293c2c67743dda5935c997afe0c7204f83eaf7d5b9075c">pma::Track3D::kBackward</a>));</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;  }</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Hit index out of range.&quot;</span>;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  }</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;}</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*</div>
<div class="line"><a name="l01024"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a5f2a5070e3202fd89448a4c441ab3791"> 1024</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a5f2a5070e3202fd89448a4c441ab3791">pma::Track3D::NextSegment</a>(<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx)<span class="keyword"> const</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;  <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* seg = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nCount = vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">NextCount</a>();</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a122a7b8666811f02fba2c0fcdc485d17">k</a> = 0;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  <span class="keywordflow">while</span> (k &lt; nCount) {</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    seg = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#aa05348c187c1f5e1e2cb9334f15e101a">Next</a>(k));</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    <span class="keywordflow">if</span> (seg &amp;&amp; (seg-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>() == <span class="keyword">this</span>)) <span class="keywordflow">return</span> seg;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    k++;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  }</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;}</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*</div>
<div class="line"><a name="l01038"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#adaeb0e035627641bf5ba5a8d145fda05"> 1038</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#adaeb0e035627641bf5ba5a8d145fda05">pma::Track3D::PrevSegment</a>(<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx)<span class="keyword"> const</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  <span class="keywordflow">if</span> (vtx-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>()) {</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    <span class="keyword">auto</span> seg = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(vtx-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>());</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <span class="keywordflow">if</span> (seg-&gt;Parent() == <span class="keyword">this</span>) <span class="keywordflow">return</span> seg;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  }</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;}</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="keywordtype">double</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a167928193032c5ec208742c45f7706a9"> 1048</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a167928193032c5ec208742c45f7706a9">pma::Track3D::GetRawdEdxSequence</a>(std::map&lt;<span class="keywordtype">size_t</span>, std::vector&lt;double&gt;&gt;&amp; dedx,</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> view,</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> skip,</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                                 <span class="keywordtype">bool</span> inclDisabled)<span class="keyword"> const</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  dedx.clear();</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>()) <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  <span class="keywordtype">size_t</span> step = 1;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  <span class="keywordtype">double</span> rv, dr, dR, dq, dEq, qSkipped = 0.0;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  <span class="keywordtype">size_t</span> j = NextHit(-1, view, inclDisabled), <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> = skip;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  <span class="keywordflow">if</span> (j &gt;= <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>()) <span class="keywordflow">return</span> 0.0F; <span class="comment">// no charged hits at all</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  <span class="keywordflow">while</span> (j &lt; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>())            <span class="comment">// look for the first hit index</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  {</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    hit = fHits[j];</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    dq = hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a428de59f1b3bfc6ed4134a4f174859c0">SummedADC</a>();</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>) {</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      qSkipped += dq;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;      <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>--;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    }</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    j = NextHit(j, view, inclDisabled);</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  }</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  <span class="keywordtype">size_t</span> jmax = PrevHit(<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>(), view, inclDisabled);</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  std::vector&lt;size_t&gt; indexes;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;  TVector3 p0(0., 0., 0.), <a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a>(0., 0., 0.);</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  TVector2 c0(0., 0.), c1(0., 0.);</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  <span class="keywordflow">while</span> (j &lt;= jmax) {</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    indexes.clear(); <span class="comment">// prepare to collect hit indexes used for this dE/dx entry</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    indexes.push_back(j);</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    hit = fHits[j];</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    p0 = hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ac3fbfcb7dedfe1063f001c832bc64998">Point3D</a>();</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    p1 = hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ac3fbfcb7dedfe1063f001c832bc64998">Point3D</a>();</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    c0.Set(hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aa293ec05456935fc468dcc355d52102a">Wire</a>(), hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aaa10befa83bf11f7bb6a65541befd332">PeakTime</a>());</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    c1.Set(hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aa293ec05456935fc468dcc355d52102a">Wire</a>(), hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aaa10befa83bf11f7bb6a65541befd332">PeakTime</a>());</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    dEq = hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a428de59f1b3bfc6ed4134a4f174859c0">SummedADC</a>(); <span class="comment">// [now it is ADC sum]</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    dr = HitDxByView(j,</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                     view,</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                     <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1f6428b89518e48188e293c2c67743ddaa703023c9fcc4055af46588f20785bfd">pma::Track3D::kForward</a>); <span class="comment">// protection against hits on the same position</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    rv = HitDxByView(j, view);                <span class="comment">// dx seen by j-th hit</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    fHits[j]-&gt;fDx = rv;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    dR = rv;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a> = 1; <span class="comment">// number of hits with charge &gt; 0</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <span class="keywordflow">while</span> (((m &lt; step) || (dR &lt; 0.1) || (dr == 0.0)) &amp;&amp; (j &lt;= jmax)) {</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;      j = NextHit(j, view); <span class="comment">// just next, even if tagged as outlier</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      <span class="keywordflow">if</span> (j &gt; jmax) <span class="keywordflow">break</span>;  <span class="comment">// no more hits in this view</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      hit = fHits[j];</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      <span class="keywordflow">if</span> (!inclDisabled &amp;&amp; !hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ab628d7feecc85a8172f17aef5f4778da">IsEnabled</a>()) {</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        <span class="keywordflow">if</span> (dr == 0.0)</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      }</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;      indexes.push_back(j);</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;      p1 = hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ac3fbfcb7dedfe1063f001c832bc64998">Point3D</a>();</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;      c1.Set(hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aa293ec05456935fc468dcc355d52102a">Wire</a>(), hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aaa10befa83bf11f7bb6a65541befd332">PeakTime</a>());</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;      dq = hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a428de59f1b3bfc6ed4134a4f174859c0">SummedADC</a>();</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;      dEq += dq;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;      dr = HitDxByView(j, view, <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1f6428b89518e48188e293c2c67743ddaa703023c9fcc4055af46588f20785bfd">pma::Track3D::kForward</a>);</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      rv = HitDxByView(j, view);</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      fHits[j]-&gt;fDx = rv;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;      dR += rv;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;      m++;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    }</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    p0 += <a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a>;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    p0 *= 0.5;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    c0 += c1;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    c0 *= 0.5;</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <span class="keywordtype">double</span> range = <a class="code" href="../../de/d0f/namespacetca.html#a4f3087743ae6823cd5b6e9ff1a344843">Length</a>(0, j);</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    std::vector&lt;double&gt; trk_section;</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    trk_section.push_back(c0.X());</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    trk_section.push_back(c0.Y());</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    trk_section.push_back(p0.X());</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    trk_section.push_back(p0.Y());</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    trk_section.push_back(p0.Z());</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    trk_section.push_back(dEq);</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    trk_section.push_back(dR);</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    trk_section.push_back(range);</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span> idx : indexes)</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;      dedx[idx] = trk_section;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    j = NextHit(j, view, inclDisabled);</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;  }</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  <span class="keywordflow">return</span> qSkipped;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;}</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;std::vector&lt;float&gt;</div>
<div class="line"><a name="l01160"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#ae82f448cd9326d24a59e18383b7b7a85"> 1160</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ae82f448cd9326d24a59e18383b7b7a85">pma::Track3D::DriftsOfWireIntersection</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;                                       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wire,</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;                                       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> view)<span class="keyword"> const</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  std::vector&lt;float&gt; drifts;</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; fNodes.size() - 1; i++) {</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <span class="keywordtype">int</span> tpc = fNodes[i]-&gt;TPC(), cryo = fNodes[i]-&gt;Cryo();</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="keywordflow">if</span> ((tpc != fNodes[i + 1]-&gt;<a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>()) || (cryo != fNodes[i + 1]-&gt;Cryo())) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    TVector2 p0 = <a class="code" href="../../d8/d4a/namespacepma.html#ad1b103cd1dc1bf59c3dd46f5a418af15">pma::CmToWireDrift</a>(detProp,</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;                                     fNodes[i]-&gt;Projection2D(view).<a class="code" href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a>(),</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;                                     fNodes[i]-&gt;Projection2D(view).Y(),</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;                                     view,</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;                                     fNodes[i]-&gt;<a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>(),</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;                                     fNodes[i]-&gt;Cryo());</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    TVector2 <a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a> = <a class="code" href="../../d8/d4a/namespacepma.html#ad1b103cd1dc1bf59c3dd46f5a418af15">pma::CmToWireDrift</a>(detProp,</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;                                     fNodes[i + 1]-&gt;Projection2D(view).<a class="code" href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a>(),</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;                                     fNodes[i + 1]-&gt;Projection2D(view).Y(),</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;                                     view,</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;                                     fNodes[i + 1]-&gt;<a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>(),</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;                                     fNodes[i + 1]-&gt;Cryo());</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <span class="keywordflow">if</span> ((p0.X() - wire) * (p1.X() - wire) &lt;= 0.0) {</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;      <span class="keywordtype">double</span> frac_w = (wire - p0.X()) / (p1.X() - p0.X());</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;      <span class="keywordtype">double</span> d = p0.Y() + frac_w * (p1.Y() - p0.Y());</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;      drifts.push_back((<span class="keywordtype">float</span>)d);</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    }</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  }</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  <span class="keywordflow">return</span> drifts;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;}</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="keywordtype">size_t</span></div>
<div class="line"><a name="l01192"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a2e9e7d6ebebf8732281d38693c1bb7de"> 1192</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a2e9e7d6ebebf8732281d38693c1bb7de">pma::Track3D::CompleteMissingWires</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;                                   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> view)</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;{</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  <span class="keywordtype">int</span> dPrev, dw, <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">w</a>, wx, wPrev, i = NextHit(-1, view);</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* hitPrev = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  std::vector&lt;pma::Hit3D*&gt; missHits;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  <span class="keywordflow">while</span> (i &lt; (<span class="keywordtype">int</span>)<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>()) {</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    hitPrev = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>;</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    hit = fHits[i];</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    <span class="keywordflow">if</span> (hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>() == view) {</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;      w = hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aa293ec05456935fc468dcc355d52102a">Wire</a>();</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;      <span class="keywordflow">if</span> (hitPrev) {</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        wPrev = hitPrev-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aa293ec05456935fc468dcc355d52102a">Wire</a>();</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        dPrev = (int)hitPrev-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aaa10befa83bf11f7bb6a65541befd332">PeakTime</a>();</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a>(w - wPrev) &gt; 1) {</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;          <span class="keywordflow">if</span> (w &gt; wPrev)</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;            dw = 1;</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;            dw = -1;</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;          wx = wPrev + dw;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;          <span class="keywordtype">int</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a122a7b8666811f02fba2c0fcdc485d17">k</a> = 1;</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;          <span class="keywordflow">while</span> (wx != w) {</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;            <span class="keywordtype">int</span> peakTime = 0;</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iWire = wx;</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;            std::vector&lt;float&gt; drifts = DriftsOfWireIntersection(detProp, wx, view);</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;            <span class="keywordflow">if</span> (drifts.size()) {</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;              peakTime = drifts[0];</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;              <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> d = 1; d &lt; drifts.size(); d++)</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;                <span class="keywordflow">if</span> (fabs(drifts[d] - dPrev) &lt; fabs(peakTime - dPrev)) peakTime = drifts[d];</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;            }</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;            <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;              mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Track does not intersect with the wire &quot;</span> &lt;&lt; wx;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;            }</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;            <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* hmiss =</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;              <span class="keyword">new</span> <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>(detProp, iWire, view, hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aa598af0b3191db78c37f98fc99e5bb0e">TPC</a>(), hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a9ebb325be5c4a09468679377b618313d">Cryo</a>(), peakTime, 1.0, 1.0);</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;            missHits.push_back(hmiss);</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;            wx += dw;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;            k++;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;          }</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;        }</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;      }</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    }</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;      hit = hitPrev;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    i = NextHit(i, view, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    <span class="keywordflow">while</span> ((i &lt; (<span class="keywordtype">int</span>)<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>()) &amp;&amp; (hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aa598af0b3191db78c37f98fc99e5bb0e">TPC</a>() != fHits[i]-&gt;TPC())) {</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;      hitPrev = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;      hit = fHits[i];</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;      i = NextHit(i, view, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    }</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;  }</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;  <span class="keywordflow">if</span> (missHits.size()) {</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> hi = 0; hi &lt; missHits.size(); hi++) {</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;      push_back(missHits[hi]);</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    }</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    MakeProjection();</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    <a class="code" href="../../d2/d40/PCAnglePlaneMaker__module_8cc.html#a87218e5b4cafa52fddfafeb4d9ce0be3">SortHits</a>();</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  }</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  <span class="keywordflow">return</span> missHits.size();</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;}</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l01264"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a48acf1401880b32e71d59b6cd674b83d"> 1264</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a48acf1401880b32e71d59b6cd674b83d">pma::Track3D::AddNode</a>(<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* node)</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;{</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;  fNodes.push_back(node);</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  <span class="keywordflow">if</span> (fNodes.size() &gt; 1) RebuildSegments();</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;}</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a8848299e6da8fb6fb1fc3b30879f7d69"> 1271</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a48acf1401880b32e71d59b6cd674b83d">pma::Track3D::AddNode</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>)</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;{</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* seg;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* maxSeg = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;  <span class="keywordtype">size_t</span> si = 0;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;  <span class="keywordflow">while</span> (si &lt; fSegments.size()) {</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    <span class="keywordflow">if</span> (!fSegments[si]-&gt;IsFrozen()) {</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;      maxSeg = fSegments[si];</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    }</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;      si++;</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  }</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  <span class="keywordflow">if</span> (!maxSeg) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nHitsByView[3];</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nHits, maxHits = 0;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vIndex = 0, segHits, maxSegHits = 0;</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;  <span class="keywordtype">float</span> segLength, maxLength = maxSeg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#ab07ba8c1da53d63756a6105a828d24be">Length</a>();</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = si + 1; i &lt; fNodes.size(); i++) {</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    seg = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(fNodes[i]-&gt;Prev());</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <span class="keywordflow">if</span> (seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a04a6da5b5d95942da64d6675674ac927">IsFrozen</a>()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    nHitsByView[0] = seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a812264b079959b83c74c49736940f4cb">NEnabledHits</a>(<a class="code" href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486ae2842cacc3d7d281d01b4316380b8d5b">geo::kU</a>);</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    nHitsByView[1] = seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a812264b079959b83c74c49736940f4cb">NEnabledHits</a>(<a class="code" href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486aea23122caaaed75b787c745a188871f6">geo::kV</a>);</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    nHitsByView[2] = seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a812264b079959b83c74c49736940f4cb">NEnabledHits</a>(<a class="code" href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486a29e198ce46b2c8fc4a31422f42f77c64">geo::kZ</a>);</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    segHits = nHitsByView[0] + nHitsByView[1] + nHitsByView[2];</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <span class="keywordflow">if</span> (segHits &lt; 15) {</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;      <span class="keywordflow">if</span> ((nHitsByView[0] == 0) &amp;&amp; ((nHitsByView[1] &lt; 4) || (nHitsByView[2] &lt; 4))) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;      <span class="keywordflow">if</span> ((nHitsByView[1] == 0) &amp;&amp; ((nHitsByView[0] &lt; 4) || (nHitsByView[2] &lt; 4))) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;      <span class="keywordflow">if</span> ((nHitsByView[2] == 0) &amp;&amp; ((nHitsByView[0] &lt; 4) || (nHitsByView[1] &lt; 4))) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    }</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    nHits = fNodes[i]-&gt;NEnabledHits() + seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a812264b079959b83c74c49736940f4cb">NEnabledHits</a>() + fNodes[i - 1]-&gt;NEnabledHits();</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    <span class="keywordflow">if</span> (nHits &gt; maxHits) {</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;      maxHits = nHits;</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;      maxLength = seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#ab07ba8c1da53d63756a6105a828d24be">Length</a>();</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;      maxSegHits = segHits;</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;      maxSeg = seg;</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;      vIndex = i;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    }</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nHits == maxHits) {</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;      segLength = seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#ab07ba8c1da53d63756a6105a828d24be">Length</a>();</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;      <span class="keywordflow">if</span> (segLength &gt; maxLength) {</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;        maxLength = segLength;</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        maxSegHits = segHits;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;        maxSeg = seg;</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;        vIndex = i;</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;      }</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    }</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;  }</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  <span class="keywordflow">if</span> (maxSegHits &gt; 1) {</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    maxSeg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#affc19b2cc81fb0408b0ea8df648e5d98">SortHits</a>();</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    nHitsByView[0] = maxSeg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a812264b079959b83c74c49736940f4cb">NEnabledHits</a>(<a class="code" href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486ae2842cacc3d7d281d01b4316380b8d5b">geo::kU</a>);</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    nHitsByView[1] = maxSeg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a812264b079959b83c74c49736940f4cb">NEnabledHits</a>(<a class="code" href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486aea23122caaaed75b787c745a188871f6">geo::kV</a>);</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    nHitsByView[2] = maxSeg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a812264b079959b83c74c49736940f4cb">NEnabledHits</a>(<a class="code" href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486a29e198ce46b2c8fc4a31422f42f77c64">geo::kZ</a>);</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxViewIdx = 2, midViewIdx = 2;</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    <span class="keywordflow">if</span> ((nHitsByView[2] &gt;= nHitsByView[1]) &amp;&amp; (nHitsByView[1] &gt;= nHitsByView[0])) {</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;      maxViewIdx = 2;</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;      midViewIdx = 1;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    }</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((nHitsByView[1] &gt;= nHitsByView[2]) &amp;&amp; (nHitsByView[2] &gt;= nHitsByView[0])) {</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;      maxViewIdx = 1;</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;      midViewIdx = 2;</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    }</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((nHitsByView[0] &gt;= nHitsByView[2]) &amp;&amp; (nHitsByView[2] &gt;= nHitsByView[1])) {</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;      maxViewIdx = 0;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;      midViewIdx = 2;</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    }</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((nHitsByView[2] &gt;= nHitsByView[0]) &amp;&amp; (nHitsByView[0] &gt;= nHitsByView[1])) {</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;      maxViewIdx = 2;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;      midViewIdx = 0;</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    }</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((nHitsByView[0] &gt;= nHitsByView[1]) &amp;&amp; (nHitsByView[1] &gt;= nHitsByView[2])) {</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;      maxViewIdx = 0;</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;      midViewIdx = 1;</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    }</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((nHitsByView[1] &gt;= nHitsByView[0]) &amp;&amp; (nHitsByView[0] &gt;= nHitsByView[2])) {</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;      maxViewIdx = 1;</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;      midViewIdx = 0;</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    }</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    <span class="keywordflow">if</span> (nHitsByView[midViewIdx] &lt; 2) midViewIdx = maxViewIdx;</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    <span class="keywordflow">if</span> (nHitsByView[midViewIdx] &lt; 2) {</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;AddNode(): too few hits.&quot;</span>;</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    }</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mHits[3] = {0, 0, 0};</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> halfIndex = (nHitsByView[midViewIdx] &gt;&gt; 1) - 1;</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> = 0, i = 0, i0 = 0, i1 = 0;</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    <span class="keywordflow">while</span> (i &lt; maxSeg-&gt;NHits() - 1) {</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;      <span class="keywordflow">if</span> (maxSeg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ab628d7feecc85a8172f17aef5f4778da">IsEnabled</a>()) {</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;        mHits[maxSeg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>()]++;</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;        <span class="keywordflow">if</span> (maxSeg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>() == midViewIdx) {</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;          <span class="keywordflow">if</span> (n == halfIndex) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;          n++;</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;        }</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;      }</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;      i++;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    }</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    i0 = i;</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    i++;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    <span class="keywordflow">while</span> ((i &lt; maxSeg-&gt;NHits()) &amp;&amp;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;           !((maxSeg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>() == midViewIdx) &amp;&amp; maxSeg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ab628d7feecc85a8172f17aef5f4778da">IsEnabled</a>())) {</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;      i++;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    }</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    i1 = i;</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    <span class="keywordflow">if</span> (!nHitsByView[0]) {</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;      <span class="keywordflow">if</span> (nHitsByView[1] &amp;&amp; (mHits[1] &lt; 2)) {</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;        mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;AddNode(): low Ind2 hits.&quot;</span>;</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;      }</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;      <span class="keywordflow">if</span> (nHitsByView[2] &amp;&amp; (mHits[2] &lt; 2)) {</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;        mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;AddNode(): low Coll hits.&quot;</span>;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;      }</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    }</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    maxSeg-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a221efc5507cbd810dfb18f944163b111">SetProjection</a>(maxSeg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i0));</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    maxSeg-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a221efc5507cbd810dfb18f944163b111">SetProjection</a>(maxSeg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i1));</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tpc = maxSeg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i0).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aa598af0b3191db78c37f98fc99e5bb0e">TPC</a>();</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cryo = maxSeg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i0).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a9ebb325be5c4a09468679377b618313d">Cryo</a>();</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> = <span class="keyword">new</span> <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>(detProp,</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;                                     (maxSeg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i0).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ac3fbfcb7dedfe1063f001c832bc64998">Point3D</a>() + maxSeg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i1).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ac3fbfcb7dedfe1063f001c832bc64998">Point3D</a>()) * 0.5,</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;                                     tpc,</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;                                     cryo,</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;                                     <span class="keyword">false</span>,</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;                                     fNodes[vIndex]-&gt;GetDriftShift());</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    fNodes.insert(fNodes.begin() + vIndex, <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>);</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    maxSeg-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a5f13409ee2a7deff853ec4bc919fe12e">AddNext</a>(fNodes[vIndex]);</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    seg = <span class="keyword">new</span> <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>(<span class="keyword">this</span>, fNodes[vIndex], fNodes[vIndex + 1]);</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    fSegments.insert(fSegments.begin() + vIndex, seg);</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;  }</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;}</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l01425"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#aec9ecfd023917e3989d972707d91faa3"> 1425</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#aec9ecfd023917e3989d972707d91faa3">pma::Track3D::InsertNode</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;                         TVector3 <span class="keyword">const</span>&amp; p3d,</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;                         <span class="keywordtype">size_t</span> at_idx,</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tpc,</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cryo)</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;{</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;  <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx =</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <span class="keyword">new</span> <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>(detProp, p3d, tpc, cryo, <span class="keyword">false</span>, fNodes[at_idx]-&gt;GetDriftShift());</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;  fNodes.insert(fNodes.begin() + at_idx, vtx);</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;  <span class="keywordflow">if</span> (fNodes.size() &gt; 1) RebuildSegments();</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;}</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#aeb28329b16854103de1b1e72ac8d7473"> 1439</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#aeb28329b16854103de1b1e72ac8d7473">pma::Track3D::RemoveNode</a>(<span class="keywordtype">size_t</span> idx)</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;{</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  <span class="keywordflow">if</span> ((fNodes.size() &gt; 1) &amp;&amp; (idx &lt; fNodes.size())) {</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx = fNodes[idx];</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    fNodes.erase(fNodes.begin() + idx);</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    RebuildSegments();</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    <span class="keywordflow">if</span> (!vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">NextCount</a>() &amp;&amp; !vtx-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>()) { <span class="keyword">delete</span> vtx; }</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  }</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;}</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>*</div>
<div class="line"><a name="l01455"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#aab8302ffd36cff08d508bbae460f9254"> 1455</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#aab8302ffd36cff08d508bbae460f9254">pma::Track3D::Split</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;                    <span class="keywordtype">size_t</span> idx,</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;                    <span class="keywordtype">bool</span> try_start_at_idx)</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;{</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;  <span class="keywordflow">if</span> (!idx || (idx + 1 &gt;= fNodes.size())) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;  <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* <a class="code" href="../../d6/d11/namespacemake__calib__df.html#a2b8237bac57d5c373c623869ad4513c8">t0</a> = <span class="keyword">new</span> <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>();</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;  t0-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a96d7f563c77db26789ed457ed306aee8">fT0</a> = <a class="code" href="../../d4/d4d/namespaceevgen.html#a354af7140af9e222ae73503ce23ad680">fT0</a>;</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;  t0-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ae84e246cdeaa38bbdd39eed91a8f339e">fT0Flag</a> = fT0Flag;</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;  t0-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a7768f0469586655a68c9814621c37477">fTag</a> = fTag;</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; idx; ++i) {</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    n = fNodes.front();</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    n-&gt;<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html#ad62919a0303b7fd2e3d079812f24f2ab">ClearAssigned</a>();</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(n-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>());</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    <span class="keywordflow">if</span> (s &amp;&amp; (s-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>() == <span class="keyword">this</span>)) s-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#ad38e1edbd1c79e633fb7c4a20ffa3a54">RemoveNext</a>(n);</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a122a7b8666811f02fba2c0fcdc485d17">k</a> = 0;</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <span class="keywordflow">while</span> (k &lt; n-&gt;NextCount()) {</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;      s = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(n-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#aa05348c187c1f5e1e2cb9334f15e101a">Next</a>(k));</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;      <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>() == <span class="keyword">this</span>)</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;        n-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a2492c663412fe4592a19354826c33664">RemoveNext</a>(s);</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;        k++;</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    }</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    fNodes.erase(fNodes.begin());</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    t0-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac962a4b11d64492799b447aa9c40837d">fNodes</a>.push_back(n);</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;  }</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;  n = fNodes.front();</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;  t0-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac962a4b11d64492799b447aa9c40837d">fNodes</a>.push_back(</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    <span class="keyword">new</span> <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>(detProp, n-&gt;<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html#a1b0c986525d9adf738d59c7942f2a506">Point3D</a>(), n-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a0e4d7a26f6bac4987353833d21097993">TPC</a>(), n-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a479cba70e2320a1afe991d3f2df3b2ab">Cryo</a>(), <span class="keyword">false</span>, n-&gt;<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html#abdcc4de592387b4625a6f7fba30c3fc5">GetDriftShift</a>()));</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;  t0-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a90f8b897da30b12f54b974020d52e9f3">RebuildSegments</a>();</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;  RebuildSegments();</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a> = 0;</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;  <span class="keywordflow">while</span> (h &lt; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>()) {</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* h3d = fHits[<a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>];</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> view = h3d-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>(), tpc = h3d-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aa598af0b3191db78c37f98fc99e5bb0e">TPC</a>(), cryo = h3d-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a9ebb325be5c4a09468679377b618313d">Cryo</a>();</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    <span class="keywordtype">double</span> dist2D_old = <a class="code" href="../../d8/d4a/namespacepma.html#a6533238e57afc147ba9155b759521d20">Dist2</a>(h3d-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a63647e230c7fe8690d1b526d9f5b248f">Point2D</a>(), view, tpc, cryo);</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    <span class="keywordtype">double</span> dist2D_new = t0-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a506e25c139891a49e29d88bab67f60c3">Dist2</a>(h3d-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a63647e230c7fe8690d1b526d9f5b248f">Point2D</a>(), view, tpc, cryo);</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    <span class="keywordflow">if</span> ((dist2D_new &lt; dist2D_old) &amp;&amp; t0-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a8b0b99c71acc3a2842bc5bd975035975">HasTPC</a>(tpc))</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;      t0-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a9e34c6cc001b39a9ad184972ce42d094">push_back</a>(release_at(h));</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!HasTPC(tpc) &amp;&amp; t0-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a8b0b99c71acc3a2842bc5bd975035975">HasTPC</a>(tpc))</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;      t0-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a9e34c6cc001b39a9ad184972ce42d094">push_back</a>(release_at(h));</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;      h++;</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;  }</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;  <span class="keywordtype">bool</span> passed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;  <span class="keywordflow">if</span> (HasTwoViews() &amp;&amp; t0-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a39c3984b0f5f5ac48187ade44578df94">HasTwoViews</a>()) {</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    <span class="keywordflow">if</span> (try_start_at_idx &amp;&amp; t0-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a952f9da40b18b2a95d0da005d22c117b">CanFlip</a>()) {</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;  attach new t0 and this trk to a common start node&quot;</span>;</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;      t0-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a17c2878ac4a702eac76038d5c9d1e542">Flip</a>();</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;      passed = t0-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a3b9d7bcb3f95eadddfacc8044557b874">AttachTo</a>(fNodes.front());</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    }</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;  attach this trk to the new t0 end node&quot;</span>;</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;      passed = AttachTo(t0-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac962a4b11d64492799b447aa9c40837d">fNodes</a>.back());</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;    }</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;  }</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;  single-view track&quot;</span>;</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    passed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;  }</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;  <span class="keywordflow">if</span> (!passed) {</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;  undo split&quot;</span>;</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    <span class="keywordflow">while</span> (t0-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a61676c8fb2963a14f6497d47b490296e">size</a>())</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;      push_back(t0-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a5c89f8f5decd2a9873956d225f9cee6f">release_at</a>(0));</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; idx; ++i) {</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;      fNodes.insert(fNodes.begin() + i, t0-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac962a4b11d64492799b447aa9c40837d">fNodes</a>.front());</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;      t0-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac962a4b11d64492799b447aa9c40837d">fNodes</a>.erase(t0-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac962a4b11d64492799b447aa9c40837d">fNodes</a>.begin());</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    }</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;    RebuildSegments();</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    <span class="keyword">delete</span> <a class="code" href="../../d6/d11/namespacemake__calib__df.html#a2b8237bac57d5c373c623869ad4513c8">t0</a>;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    t0 = 0;</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  }</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d6/d11/namespacemake__calib__df.html#a2b8237bac57d5c373c623869ad4513c8">t0</a>;</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;}</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l01544"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a3b9d7bcb3f95eadddfacc8044557b874"> 1544</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a3b9d7bcb3f95eadddfacc8044557b874">pma::Track3D::AttachTo</a>(<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vStart, <span class="keywordtype">bool</span> noFlip)</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;{</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;  <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx = fNodes.front();</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;  <span class="keywordflow">if</span> (vtx == vStart) <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// already connected!</span></div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;  <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* rootThis = GetRoot();</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;  <span class="keywordflow">if</span> (vStart-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>()) {</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* rootPrev = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(vStart-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>())-&gt;Parent()-&gt;GetRoot();</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    <span class="keywordflow">if</span> (rootPrev-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#aebacf4ea6bdd89c09f76276a0481edaf">IsAttachedTo</a>(rootThis)) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;  }</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vStart-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">NextCount</a>()) {</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* rootNext = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(vStart-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#aa05348c187c1f5e1e2cb9334f15e101a">Next</a>(0))-&gt;Parent()-&gt;GetRoot();</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    <span class="keywordflow">if</span> (rootNext-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#aebacf4ea6bdd89c09f76276a0481edaf">IsAttachedTo</a>(rootThis)) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;  }</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  }</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> : fNodes)</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> == vStart) {</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;      mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Don&#39;t create loops!&quot;</span>;</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    }</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;  <span class="keywordflow">if</span> (!noFlip &amp;&amp; CanFlip() &amp;&amp; (vStart-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a0e4d7a26f6bac4987353833d21097993">TPC</a>() == fNodes.back()-&gt;TPC()) &amp;&amp;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;      (<a class="code" href="../../d8/d4a/namespacepma.html#a6533238e57afc147ba9155b759521d20">pma::Dist2</a>(vtx-&gt;<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html#a1b0c986525d9adf738d59c7942f2a506">Point3D</a>(), vStart-&gt;<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html#a1b0c986525d9adf738d59c7942f2a506">Point3D</a>()) &gt;</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;       <a class="code" href="../../d8/d4a/namespacepma.html#a6533238e57afc147ba9155b759521d20">pma::Dist2</a>(fNodes.back()-&gt;Point3D(), vStart-&gt;<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html#a1b0c986525d9adf738d59c7942f2a506">Point3D</a>())) &amp;&amp;</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;      (fNodes.back()-&gt;NextCount() == 0)) {</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Flip, endpoint closer to vStart.&quot;</span>;</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    Flip();</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;  }</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;  <span class="keywordflow">if</span> (vStart-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a0e4d7a26f6bac4987353833d21097993">TPC</a>() == vtx-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a0e4d7a26f6bac4987353833d21097993">TPC</a>())</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    <span class="keywordflow">return</span> AttachToSameTPC(vStart);</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    <span class="keywordflow">return</span> AttachToOtherTPC(vStart);</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;}</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l01584"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a23593e0e21f26acc62eeaeba7f56cfe7"> 1584</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a23593e0e21f26acc62eeaeba7f56cfe7">pma::Track3D::AttachToOtherTPC</a>(<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vStart)</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;{</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;  <span class="keywordflow">if</span> (fNodes.front()-&gt;Prev()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;  mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Attach to track in another TPC.&quot;</span>;</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;  fNodes.insert(fNodes.begin(), vStart);</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;  fSegments.insert(fSegments.begin(), <span class="keyword">new</span> <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>(<span class="keyword">this</span>, fNodes[0], fNodes[1]));</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;}</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l01598"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a4f2ceb5674e7c28d4ef26f8b64173e13"> 1598</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a4f2ceb5674e7c28d4ef26f8b64173e13">pma::Track3D::AttachToSameTPC</a>(<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vStart)</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;{</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;  <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx = fNodes.front();</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;  <span class="keywordflow">if</span> (vtx-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>()) {</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;    <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* segPrev = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(vtx-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>());</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* tpPrev = segPrev-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>();</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    <span class="keywordflow">if</span> (tpPrev-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a5f2a5070e3202fd89448a4c441ab3791">NextSegment</a>(vtx)) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tpPrev-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a952f9da40b18b2a95d0da005d22c117b">CanFlip</a>()) {</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;      tpPrev-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a17c2878ac4a702eac76038d5c9d1e542">Flip</a>();</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    } <span class="comment">// flip in local vtx, no problem</span></div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;      <span class="keywordflow">if</span> (vStart-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>()) {</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;        <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* segNew = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(vStart-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>());</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;        <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* tpNew = segNew-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>();</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;        <span class="keywordflow">if</span> (tpNew-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a5f2a5070e3202fd89448a4c441ab3791">NextSegment</a>(vStart)) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tpNew-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a952f9da40b18b2a95d0da005d22c117b">CanFlip</a>()) <span class="comment">// flip in remote vStart, no problem</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;        {</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;          tpNew-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a17c2878ac4a702eac76038d5c9d1e542">Flip</a>();</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;          mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Reconnect prev to vStart.&quot;</span>;</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;          tpPrev-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac962a4b11d64492799b447aa9c40837d">fNodes</a>[tpPrev-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac962a4b11d64492799b447aa9c40837d">fNodes</a>.size() - 1] = vStart;</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;          segPrev-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a5f13409ee2a7deff853ec4bc919fe12e">AddNext</a>(vStart);</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;        }</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;          mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Flips in vtx and vStart not possible, cannot attach.&quot;</span>;</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;        }</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;      }</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;        mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Reconnect prev to vStart.&quot;</span>;</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;        tpPrev-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac962a4b11d64492799b447aa9c40837d">fNodes</a>[tpPrev-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac962a4b11d64492799b447aa9c40837d">fNodes</a>.size() - 1] = vStart;</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;        segPrev-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a5f13409ee2a7deff853ec4bc919fe12e">AddNext</a>(vStart);</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;      }</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    }</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;  }</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;  <span class="keywordflow">while</span> (vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">NextCount</a>()) <span class="comment">// reconnect nexts to vStart</span></div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;  {</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;    <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* seg = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#aa05348c187c1f5e1e2cb9334f15e101a">Next</a>(0));</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* trk = seg-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>();</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a2492c663412fe4592a19354826c33664">RemoveNext</a>(seg);</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    trk-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac962a4b11d64492799b447aa9c40837d">fNodes</a>[0] = vStart;</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    vStart-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a1fb075f00b734019e664241fe1774db0">AddNext</a>(seg);</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;  }</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;  <span class="keywordflow">if</span> (vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">NextCount</a>() || vtx-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>()) <span class="comment">// better throw here</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;  {</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;    <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Something is still using disconnected vertex.&quot;</span>;</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;  }</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    <span class="keyword">delete</span> vtx; <span class="comment">// ok</span></div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;}</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l01655"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#aed906671558e08b757d748cd9e3b3a1d"> 1655</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#aed906671558e08b757d748cd9e3b3a1d">pma::Track3D::AttachBackTo</a>(<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vStart)</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;{</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;  <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx = fNodes.back();</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;  <span class="keywordflow">if</span> (vtx == vStart) <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// already connected!</span></div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;  <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* rootThis = GetRoot();</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;  <span class="keywordflow">if</span> (vStart-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>()) {</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;    <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* rootPrev = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(vStart-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>())-&gt;Parent()-&gt;GetRoot();</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;    <span class="keywordflow">if</span> (rootPrev-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#aebacf4ea6bdd89c09f76276a0481edaf">IsAttachedTo</a>(rootThis)) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;  }</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vStart-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">NextCount</a>()) {</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;    <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* rootNext = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(vStart-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#aa05348c187c1f5e1e2cb9334f15e101a">Next</a>(0))-&gt;Parent()-&gt;GetRoot();</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    <span class="keywordflow">if</span> (rootNext-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#aebacf4ea6bdd89c09f76276a0481edaf">IsAttachedTo</a>(rootThis)) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;  }</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;  }</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> : fNodes)</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> == vStart) {</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;      mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Don&#39;t create loops!&quot;</span>;</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;    }</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;  <span class="keywordflow">if</span> (vStart-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a0e4d7a26f6bac4987353833d21097993">TPC</a>() == vtx-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a0e4d7a26f6bac4987353833d21097993">TPC</a>())</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;    <span class="keywordflow">return</span> AttachBackToSameTPC(vStart);</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    <span class="keywordflow">return</span> AttachBackToOtherTPC(vStart);</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;}</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l01687"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a5e9e3b6d7263bc159be22ad793a33099"> 1687</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a5e9e3b6d7263bc159be22ad793a33099">pma::Track3D::AttachBackToOtherTPC</a>(<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vStart)</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;{</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;  <span class="keywordflow">if</span> (vStart-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;  mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Attach to track in another TPC.&quot;</span>;</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;  fNodes.push_back(vStart);</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;  <span class="keywordtype">size_t</span> idx = fNodes.size() - 1;</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;  fSegments.push_back(<span class="keyword">new</span> <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>(<span class="keyword">this</span>, fNodes[idx - 1], fNodes[idx]));</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;}</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l01702"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#add5c67561c87d89dd05fc217036836f9"> 1702</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#add5c67561c87d89dd05fc217036836f9">pma::Track3D::AttachBackToSameTPC</a>(<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vStart)</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;{</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;  <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx = fNodes.back();</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;  <span class="keywordflow">if</span> (vStart-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>()) {</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* seg = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(vStart-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>());</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* tp = seg-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>();</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    <span class="keywordflow">if</span> (tp-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a5f2a5070e3202fd89448a4c441ab3791">NextSegment</a>(vStart)) {</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;      mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Cannot attach back to inner node of other track.&quot;</span>;</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    }</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    <span class="keywordflow">if</span> (tp-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a952f9da40b18b2a95d0da005d22c117b">CanFlip</a>())</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;      tp-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a17c2878ac4a702eac76038d5c9d1e542">Flip</a>(); <span class="comment">// flip in remote vStart, no problem</span></div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;      mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Flip not possible, cannot attach.&quot;</span>;</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    }</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;  }</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;  fNodes[fNodes.size() - 1] = vStart;</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;  fSegments[fSegments.size() - 1]-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a1fb075f00b734019e664241fe1774db0">AddNext</a>(vStart);</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;  <span class="keywordflow">while</span> (vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">NextCount</a>()) <span class="comment">// reconnect nexts to vStart</span></div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;  {</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* seg = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#aa05348c187c1f5e1e2cb9334f15e101a">Next</a>(0));</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;    <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* trk = seg-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>();</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a2492c663412fe4592a19354826c33664">RemoveNext</a>(seg);</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;    trk-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac962a4b11d64492799b447aa9c40837d">fNodes</a>[0] = vStart;</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;    vStart-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a1fb075f00b734019e664241fe1774db0">AddNext</a>(seg);</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;  }</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;  <span class="keywordflow">if</span> (vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">NextCount</a>() || vtx-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>()) {</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;pma::Track3D&quot;</span>)</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Something is still using disconnected vertex.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;  }</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;    <span class="keyword">delete</span> vtx; <span class="comment">// ok</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;}</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l01745"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a5f2ae3ecdfdcd6327ac0047b5e07c4a3"> 1745</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a5f2ae3ecdfdcd6327ac0047b5e07c4a3">pma::Track3D::ExtendWith</a>(<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* src)</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;{</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;  <span class="keywordflow">if</span> (src-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac962a4b11d64492799b447aa9c40837d">fNodes</a>.front()-&gt;Prev()) {</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;    <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;pma::Track3D&quot;</span>)</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Cant extend with a track being a daughter of another track.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;  }</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;  src-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ad533a00b8bd295bc021a281e47a1207a">DeleteSegments</a>(); <span class="comment">// disconnect from vertices and delete</span></div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; src-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac962a4b11d64492799b447aa9c40837d">fNodes</a>.size(); ++i) {</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    fNodes.push_back(src-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac962a4b11d64492799b447aa9c40837d">fNodes</a>[i]);</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    <span class="keywordtype">size_t</span> idx = fNodes.size() - 1;</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    fSegments.push_back(<span class="keyword">new</span> <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>(<span class="keyword">this</span>, fNodes[idx - 1], fNodes[idx]));</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;  }</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;  src-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac962a4b11d64492799b447aa9c40837d">fNodes</a>.clear(); <span class="comment">// just empty the node collection</span></div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;  <span class="keywordflow">while</span> (src-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a61676c8fb2963a14f6497d47b490296e">size</a>()) {</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    push_back(src-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a5c89f8f5decd2a9873956d225f9cee6f">release_at</a>(0));</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;  } <span class="comment">// move hits</span></div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> : src-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ab983fc03bf11450de6bcd439d995608b">fAssignedPoints</a>) {</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    fAssignedPoints.push_back(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>);</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;  } <span class="comment">// move 3D reference points</span></div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;  src-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ab983fc03bf11450de6bcd439d995608b">fAssignedPoints</a>.clear();</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;  MakeProjection();</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;  <a class="code" href="../../d2/d40/PCAnglePlaneMaker__module_8cc.html#a87218e5b4cafa52fddfafeb4d9ce0be3">SortHits</a>();</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;  <span class="keyword">delete</span> src;</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;}</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>*</div>
<div class="line"><a name="l01777"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a70b3858c5fa7121682902b4f208ae6ab"> 1777</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a70b3858c5fa7121682902b4f208ae6ab">pma::Track3D::GetRoot</a>()</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;{</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;  <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* trk = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;  <span class="keywordflow">if</span> (fNodes.size()) {</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* seg = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(fNodes.front()-&gt;Prev());</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;    <span class="keywordflow">if</span> (seg) trk = seg-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>()-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a70b3858c5fa7121682902b4f208ae6ab">GetRoot</a>();</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    <span class="keywordflow">if</span> (!trk) trk = <span class="keyword">this</span>;</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;  }</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;    <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Broken track, no nodes.&quot;</span>;</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;  <span class="keywordflow">return</span> trk;</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;}</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l01793"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a1d5f036e74692df5fe88a1434eb01ef9"> 1793</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1d5f036e74692df5fe88a1434eb01ef9">pma::Track3D::GetBranches</a>(std::vector&lt;pma::Track3D const*&gt;&amp; branches, <span class="keywordtype">bool</span> skipFirst)<span class="keyword"> const</span></div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> trk : branches)</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    <span class="keywordflow">if</span> (trk == <span class="keyword">this</span>) { <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Track tree has loop.&quot;</span>; }</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;  branches.push_back(<span class="keyword">this</span>);</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;  <span class="keywordtype">size_t</span> i0 = 0;</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;  <span class="keywordflow">if</span> (skipFirst) i0 = 1;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = i0; i &lt; fNodes.size(); ++i)</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> = 0; <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> &lt; fNodes[i]-&gt;NextCount(); <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>++) {</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;      <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* seg = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(fNodes[i]-&gt;Next(<a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>));</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;      <span class="keywordflow">if</span> (seg &amp;&amp; (seg-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>() != <span class="keyword">this</span>)) seg-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>()-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1d5f036e74692df5fe88a1434eb01ef9">GetBranches</a>(branches, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;    }</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;}</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l01813"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#aebacf4ea6bdd89c09f76276a0481edaf"> 1813</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#aebacf4ea6bdd89c09f76276a0481edaf">pma::Track3D::IsAttachedTo</a>(<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a> <span class="keyword">const</span>* trk)<span class="keyword"> const</span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;  <span class="keywordflow">if</span> (trk == <span class="keyword">this</span>) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;  std::vector&lt;pma::Track3D const*&gt; branchesThis, branchesTrk;</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;  <span class="keywordflow">if</span> (!trk-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a1d5f036e74692df5fe88a1434eb01ef9">GetBranches</a>(branchesTrk)) <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// has loop - better check the reason</span></div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;  <span class="keywordflow">if</span> (!GetBranches(branchesThis)) <span class="keywordflow">return</span> <span class="keyword">true</span>;     <span class="comment">// has loop - better check the reason</span></div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> bThis : branchesThis)</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> bTrk : branchesTrk)</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;      <span class="keywordflow">if</span> (bThis == bTrk) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;}</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l01829"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#aa5a5d450a0cdc2394aa19ec04b14a527"> 1829</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#aa5a5d450a0cdc2394aa19ec04b14a527">pma::Track3D::HasRefPoint</a>(TVector3* <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> point : fAssignedPoints)</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    <span class="keywordflow">if</span> (point == p) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;}</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;<span class="keywordtype">double</span></div>
<div class="line"><a name="l01837"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#ad29667659ab4c835d8b77ed476d4a282"> 1837</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ad29667659ab4c835d8b77ed476d4a282">pma::Track3D::GetMse</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> view)<span class="keyword"> const</span></div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;  <span class="keywordtype">double</span> sumMse = 0.0;</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nEnabledHits = 0;</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> : fNodes) {</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    sumMse += <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>-&gt;SumDist2(view);</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    nEnabledHits += <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>-&gt;NEnabledHits(view);</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;  }</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> : fSegments) {</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;    sumMse += <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>-&gt;SumDist2(view);</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    nEnabledHits += <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>-&gt;NEnabledHits(view);</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;  }</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;  <span class="keywordflow">if</span> (nEnabledHits)</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;    <span class="keywordflow">return</span> sumMse / nEnabledHits;</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;    <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;}</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;<span class="keywordtype">double</span></div>
<div class="line"><a name="l01857"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a53af9d408564ba26f2367c85f5afca51"> 1857</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a53af9d408564ba26f2367c85f5afca51">pma::Track3D::GetObjFunction</a>(<span class="keywordtype">float</span> penaltyFactor)<span class="keyword"> const</span></div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;  <span class="keywordtype">double</span> sum = 0.0;</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;  <span class="keywordtype">float</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> = penaltyFactor * fPenaltyValue;</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; fNodes.size(); i++) {</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    sum += fNodes[i]-&gt;GetObjFunction(p, fEndSegWeight);</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;  }</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;  <span class="keywordflow">return</span> sum / fNodes.size();</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;}</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;<span class="keywordtype">double</span></div>
<div class="line"><a name="l01868"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#ac9d585195653d02380cd7cf59c77904a"> 1868</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ac9d585195653d02380cd7cf59c77904a">pma::Track3D::Optimize</a>(<span class="keyword">const</span> <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;                       <span class="keywordtype">int</span> nNodes,</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;                       <span class="keywordtype">double</span> eps,</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;                       <span class="keywordtype">bool</span> selAllHits,</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;                       <span class="keywordtype">bool</span> setAllNodes,</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;                       <span class="keywordtype">size_t</span> selSegHits,</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;                       <span class="keywordtype">size_t</span> selVtxHits)</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;{</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;  <span class="keywordflow">if</span> (!fNodes.size()) {</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;    mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Track not initialized.&quot;</span>;</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;  }</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;  <span class="keywordflow">if</span> (!UpdateParams()) {</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Track empty.&quot;</span>;</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    <span class="keywordflow">return</span> 1.0e10;</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;  }</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;  <span class="keywordtype">double</span> g0 = GetObjFunction(), g1 = 0.0;</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;  <span class="keywordflow">if</span> (g0 == 0.0) <span class="keywordflow">return</span> g0;</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;  <span class="comment">// set branching flag only at the beginning, optimization is not changing</span></div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;  <span class="comment">// that and new nodes are not branching</span></div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> : fNodes)</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;    <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>-&gt;SetVertexToBranching(setAllNodes);</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;  <span class="keywordtype">bool</span> stop = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;  fMinSegStop = fSegments.size();</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;  fMaxSegStop = (int)(<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() / fMaxSegStopFactor) + 1;</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;  <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;    <span class="keywordflow">if</span> (selSegHits || selVtxHits) SelectRndHits(selSegHits, selVtxHits);</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;    <span class="keywordtype">bool</span> stepDone = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stepIter = 0;</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;      <span class="keywordtype">double</span> gstep = 1.0;</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iter = 0;</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;      <span class="keywordflow">while</span> ((gstep &gt; eps) &amp;&amp; (iter &lt; 1000)) {</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;        <span class="keywordflow">if</span> ((fNodes.size() &lt; 4) || (iter % 10 == 0))</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;          MakeProjection();</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;          MakeFastProjection();</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;        <span class="keywordflow">if</span> (!UpdateParams()) {</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;          mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Track empty.&quot;</span>;</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;          <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;        }</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> : fNodes)</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;          <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>-&gt;Optimize(fPenaltyValue, fEndSegWeight);</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;        g1 = g0;</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;        g0 = GetObjFunction();</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;        <span class="keywordflow">if</span> (g0 == 0.0<a class="code" href="../../d4/daf/sbnana_2sbnana_2CAFAna_2Analysis_2Surface_8cxx.html#a2c3bf28add4b70497e6fd9070cd7dfc9">F</a>) {</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;          MakeProjection();</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;        }</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;        gstep = fabs(g0 - g1) / g0;</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;        iter++;</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;      }</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;      stepIter++;</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;      <span class="keywordflow">if</span> (fNodes.size() &gt; 2) {</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;        stepDone = !(CheckEndSegment(<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ae22793674e59927b9261f53332014891aac2bd804cd68c9a674776905a09de97a">pma::Track3D::kEnd</a>) || CheckEndSegment(<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ae22793674e59927b9261f53332014891a1cae3b3ee031fb0bc7e852b04fe6b9e1">pma::Track3D::kBegin</a>));</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;      }</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    } <span class="keywordflow">while</span> (!stepDone &amp;&amp; (stepIter &lt; 5));</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;    <span class="keywordflow">if</span> (selAllHits) {</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;      selAllHits = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;      selSegHits = 0;</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;      selVtxHits = 0;</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;      <span class="keywordflow">if</span> (SelectAllHits()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;    }</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;    <span class="keywordflow">switch</span> (nNodes) {</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;    <span class="keywordflow">case</span> 0: stop = <span class="keyword">true</span>; <span class="keywordflow">break</span>; <span class="comment">// just optimize existing vertices</span></div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;    <span class="keywordflow">case</span> -1: <span class="comment">// grow and optimize until automatic stop condition</span></div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;optimized segments: &quot;</span> &lt;&lt; fSegments.size();</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;      <span class="keywordflow">if</span> ((fSegments.size() &gt;= fSegStopValue) || (fSegments.size() &gt;= fMaxSegStop)) { stop = <span class="keyword">true</span>; }</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;        <span class="keywordflow">if</span> (!AddNode(detProp)) stop = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;      }</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;    <span class="keywordflow">default</span>: <span class="comment">// grow and optimize until fixed number of vertices is added</span></div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;      <span class="keywordflow">if</span> (nNodes &gt; 12) {</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;        <span class="keywordflow">if</span> (AddNode(detProp)) {</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;          MakeProjection();</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;          nNodes--;</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;        }</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;          mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;stop (3)&quot;</span>;</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;          stop = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;        }</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;        <span class="keywordflow">if</span> (AddNode(detProp)) {</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;          MakeProjection();</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;          nNodes--;</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;          <span class="keywordflow">if</span> (AddNode(detProp)) nNodes--;</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;        }</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;      }</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nNodes &gt; 4) {</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;        <span class="keywordflow">if</span> (AddNode(detProp)) {</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;          MakeProjection();</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;          nNodes--;</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;        }</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;          mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;stop (2)&quot;</span>;</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;          stop = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;        }</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;        <span class="keywordflow">if</span> (AddNode(detProp)) nNodes--;</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;      }</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;        <span class="keywordflow">if</span> (AddNode(detProp)) { nNodes--; }</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;          mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;stop (1)&quot;</span>;</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;          stop = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;        }</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;      }</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;    }</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;  } <span class="keywordflow">while</span> (!stop);</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;  MakeProjection();</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;  <span class="keywordflow">return</span> GetObjFunction();</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;}</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l02002"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#ad5292138531640a408421e7f93aab26f"> 2002</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ad5292138531640a408421e7f93aab26f">pma::Track3D::UpdateParamsInTree</a>(<span class="keywordtype">bool</span> skipFirst, <span class="keywordtype">size_t</span>&amp; depth)</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;{</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;  constexpr <span class="keywordtype">size_t</span> maxTreeDepth = 100; <span class="comment">// really big tree...</span></div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;  <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx = fNodes.front();</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;  <span class="keywordflow">if</span> (skipFirst) {</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> segThis = NextSegment(vtx)) vtx = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(segThis-&gt;Next());</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    <span class="keywordflow">if</span> (++depth &gt; maxTreeDepth) { mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Tree depth above allowed max.&quot;</span>; }</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;  }</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;  <span class="keywordtype">bool</span> isOK = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;  <span class="keywordflow">while</span> (vtx) {</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;    <span class="keyword">auto</span> segThis = NextSegment(vtx);</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">NextCount</a>(); i++) {</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;      <span class="keyword">auto</span> seg = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#aa05348c187c1f5e1e2cb9334f15e101a">Next</a>(i));</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;      <span class="keywordflow">if</span> (seg != segThis) { isOK &amp;= seg-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>()-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ad5292138531640a408421e7f93aab26f">UpdateParamsInTree</a>(<span class="keyword">true</span>, depth); }</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;    }</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    <span class="keywordflow">if</span> (segThis)</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;      vtx = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(segThis-&gt;Next());</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;  }</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;  <span class="keywordflow">if</span> (!UpdateParams()) {</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;    mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Track empty.&quot;</span>;</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;    isOK = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;  }</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;  --depth;</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;  <span class="keywordflow">return</span> isOK;</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;}</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;<span class="keywordtype">double</span></div>
<div class="line"><a name="l02041"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#aa90896eda86a4722e81928a53751593f"> 2041</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#aa90896eda86a4722e81928a53751593f">pma::Track3D::TuneSinglePass</a>(<span class="keywordtype">bool</span> skipFirst)</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;{</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;  <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx = fNodes.front();</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;  <span class="keywordflow">if</span> (skipFirst) {</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> segThis = NextSegment(vtx)) vtx = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(segThis-&gt;Next());</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;  }</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../d5/d79/decoderTools__icarus_8fcl.html#a86703f8a44dd6742852257943d5a25c6">g</a> = 0.0;</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;  <span class="keywordflow">while</span> (vtx) {</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;    vtx-&gt;<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html#acace42bb146c559b533a5e282e9748c4">Optimize</a>(fPenaltyValue, fEndSegWeight);</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;    <span class="keyword">auto</span> segThis = NextSegment(vtx);</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">NextCount</a>(); i++) {</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;      <span class="keyword">auto</span> seg = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#aa05348c187c1f5e1e2cb9334f15e101a">Next</a>(i));</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;      <span class="keywordflow">if</span> (seg != segThis) g += seg-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>()-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#aa90896eda86a4722e81928a53751593f">TuneSinglePass</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;    }</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;    <span class="keywordflow">if</span> (segThis)</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;      vtx = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(segThis-&gt;Next());</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;  }</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;  <span class="keywordflow">return</span> g + GetObjFunction();</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;}</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>*</div>
<div class="line"><a name="l02069"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a4df12e6e87a58737d573fe1846dfd842"> 2069</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a4df12e6e87a58737d573fe1846dfd842">pma::Track3D::GetNearestTrkInTree</a>(<span class="keyword">const</span> TVector3&amp; p3d_cm, <span class="keywordtype">double</span>&amp; <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>, <span class="keywordtype">bool</span> skipFirst)</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;{</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;  <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx = fNodes.front();</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;  <span class="keywordflow">if</span> (skipFirst) {</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> segThis = NextSegment(vtx)) vtx = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(segThis-&gt;Next());</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;  }</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;  <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* result = <span class="keyword">this</span>;</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;  dist = sqrt(<a class="code" href="../../d8/d4a/namespacepma.html#a6533238e57afc147ba9155b759521d20">Dist2</a>(p3d_cm));</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;  <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* candidate = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;  <span class="keywordflow">while</span> (vtx) {</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;    <span class="keyword">auto</span> segThis = NextSegment(vtx);</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;    <span class="keywordtype">double</span> d;</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">NextCount</a>(); i++) {</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;      <span class="keyword">auto</span> seg = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#aa05348c187c1f5e1e2cb9334f15e101a">Next</a>(i));</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;      <span class="keywordflow">if</span> (seg != segThis) {</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;        candidate = seg-&gt;Parent()-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a4df12e6e87a58737d573fe1846dfd842">GetNearestTrkInTree</a>(p3d_cm, d, <span class="keyword">true</span>);</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;        <span class="keywordflow">if</span> (d &lt; dist) {</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;          dist = d;</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;          result = candidate;</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;        }</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;      }</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;    }</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;    <span class="keywordflow">if</span> (segThis)</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;      vtx = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(segThis-&gt;Next());</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;  }</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;}</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>*</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a4df12e6e87a58737d573fe1846dfd842">pma::Track3D::GetNearestTrkInTree</a>(<span class="keyword">const</span> TVector2&amp; p2d_cm,</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;                                  <span class="keywordtype">unsigned</span> view,</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;                                  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tpc,</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;                                  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cryo,</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;                                  <span class="keywordtype">double</span>&amp; <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>,</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;                                  <span class="keywordtype">bool</span> skipFirst)</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;{</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;  <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx = fNodes.front();</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;  <span class="keywordflow">if</span> (skipFirst) {</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> segThis = NextSegment(vtx)) vtx = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(segThis-&gt;Next());</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;  }</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;  <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* result = <span class="keyword">this</span>;</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;  dist = <a class="code" href="../../d8/d4a/namespacepma.html#a6533238e57afc147ba9155b759521d20">Dist2</a>(p2d_cm, view, tpc, cryo);</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;  <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* candidate = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;  <span class="keywordflow">while</span> (vtx) {</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;    <span class="keyword">auto</span> segThis = NextSegment(vtx);</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;    <span class="keywordtype">double</span> d;</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">NextCount</a>(); i++) {</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;      <span class="keyword">auto</span> seg = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#aa05348c187c1f5e1e2cb9334f15e101a">Next</a>(i));</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;      <span class="keywordflow">if</span> (seg != segThis) {</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;        candidate = seg-&gt;Parent()-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a4df12e6e87a58737d573fe1846dfd842">GetNearestTrkInTree</a>(p2d_cm, view, tpc, cryo, d, <span class="keyword">true</span>);</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;        <span class="keywordflow">if</span> (d &lt; dist) {</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;          dist = d;</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;          result = candidate;</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;        }</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;      }</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;    }</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;    <span class="keywordflow">if</span> (segThis)</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;      vtx = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(segThis-&gt;Next());</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;  }</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;  dist = sqrt(dist);</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;}</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02149"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a16384141e11a2a7f3cd6c0c91f7b887c"> 2149</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a16384141e11a2a7f3cd6c0c91f7b887c">pma::Track3D::ReassignHitsInTree</a>(<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* trkRoot)</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;{</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;  <span class="keywordtype">bool</span> skipFirst;</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;  <span class="keywordflow">if</span> (trkRoot)</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;    skipFirst = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;    trkRoot = <span class="keyword">this</span>;</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;    skipFirst = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;  }</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;  <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx = fNodes.front();</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;  <span class="keywordflow">if</span> (skipFirst) {</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> segThis = NextSegment(vtx)) vtx = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(segThis-&gt;Next());</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;  }</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;  <span class="keywordflow">while</span> (vtx) {</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;    <span class="keyword">auto</span> segThis = NextSegment(vtx);</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">NextCount</a>(); i++) {</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;      <span class="keyword">auto</span> seg = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#aa05348c187c1f5e1e2cb9334f15e101a">Next</a>(i));</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;      <span class="keywordflow">if</span> (seg != segThis) seg-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>()-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a16384141e11a2a7f3cd6c0c91f7b887c">ReassignHitsInTree</a>(trkRoot);</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;    }</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;    <span class="keywordflow">if</span> (segThis)</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;      vtx = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(segThis-&gt;Next());</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;  }</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;  <span class="keywordtype">double</span> d0, dmin;</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;  <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;  <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a>* nearestTrk = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;  <span class="keywordtype">size_t</span> i = 0;</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;  <span class="keywordflow">while</span> (HasTwoViews(2) &amp;&amp; (i &lt; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>())) {</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;    hit = fHits[i];</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;    d0 = hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a7cf8ff8585ff0d5ec43eab8c43aaa77c">GetDistToProj</a>();</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;    nearestTrk = GetNearestTrkInTree(hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a63647e230c7fe8690d1b526d9f5b248f">Point2D</a>(), hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>(), hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#aa598af0b3191db78c37f98fc99e5bb0e">TPC</a>(), hit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a9ebb325be5c4a09468679377b618313d">Cryo</a>(), dmin);</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;    <span class="keywordflow">if</span> ((nearestTrk != <span class="keyword">this</span>) &amp;&amp; (dmin &lt; 0.5 * d0)) {</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;      nearestTrk-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a9e34c6cc001b39a9ad184972ce42d094">push_back</a>(release_at(i));</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;*** hit moved to another track ***&quot;</span>;</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;    }</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;      i++;</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;  }</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>()) { mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;ALL hits moved to other tracks.&quot;</span>; }</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;}</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02199"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#ab2f11f6321db119fec99113cfbfbb889"> 2199</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ab2f11f6321db119fec99113cfbfbb889">pma::Track3D::MakeProjectionInTree</a>(<span class="keywordtype">bool</span> skipFirst)</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;{</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;  <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx = fNodes.front();</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;  <span class="keywordflow">if</span> (skipFirst) {</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> segThis = NextSegment(vtx)) vtx = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(segThis-&gt;Next());</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;  }</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;  <span class="keywordflow">while</span> (vtx) {</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;    <span class="keyword">auto</span> segThis = NextSegment(vtx);</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">NextCount</a>(); i++) {</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;      <span class="keyword">auto</span> seg = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#aa05348c187c1f5e1e2cb9334f15e101a">Next</a>(i));</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;      <span class="keywordflow">if</span> (seg != segThis) seg-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>()-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ab2f11f6321db119fec99113cfbfbb889">MakeProjectionInTree</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;    }</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;    <span class="keywordflow">if</span> (segThis)</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;      vtx = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(segThis-&gt;Next());</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;  }</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;  MakeProjection();</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;}</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02225"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a30a23bf18b8eb72ee290c93d53e39b23"> 2225</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a30a23bf18b8eb72ee290c93d53e39b23">pma::Track3D::SortHitsInTree</a>(<span class="keywordtype">bool</span> skipFirst)</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;{</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;  <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx = fNodes.front();</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;  <span class="keywordflow">if</span> (skipFirst) {</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> segThis = NextSegment(vtx)) vtx = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(segThis-&gt;Next());</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;  }</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;  <span class="keywordflow">while</span> (vtx) {</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;    <span class="keyword">auto</span> segThis = NextSegment(vtx);</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">NextCount</a>(); i++) {</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;      <span class="keyword">auto</span> seg = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#aa05348c187c1f5e1e2cb9334f15e101a">Next</a>(i));</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;      <span class="keywordflow">if</span> (seg != segThis) seg-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>()-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a30a23bf18b8eb72ee290c93d53e39b23">SortHitsInTree</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;    }</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;    <span class="keywordflow">if</span> (segThis)</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;      vtx = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(segThis-&gt;Next());</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;  }</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;  <a class="code" href="../../d2/d40/PCAnglePlaneMaker__module_8cc.html#a87218e5b4cafa52fddfafeb4d9ce0be3">SortHits</a>();</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;}</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;<span class="keywordtype">double</span></div>
<div class="line"><a name="l02251"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a20904e6f05c74e59da141c3a42c08561"> 2251</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a20904e6f05c74e59da141c3a42c08561">pma::Track3D::GetObjFnInTree</a>(<span class="keywordtype">bool</span> skipFirst)</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;{</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;  <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx = fNodes.front();</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;  <span class="keywordflow">if</span> (skipFirst) {</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> segThis = NextSegment(vtx)) vtx = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(segThis-&gt;Next());</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;  }</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../d5/d79/decoderTools__icarus_8fcl.html#a86703f8a44dd6742852257943d5a25c6">g</a> = 0.0;</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;  <span class="keywordflow">while</span> (vtx) {</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;    <span class="keyword">auto</span> segThis = NextSegment(vtx);</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">NextCount</a>(); i++) {</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;      <span class="keyword">auto</span> seg = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#aa05348c187c1f5e1e2cb9334f15e101a">Next</a>(i));</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;      <span class="keywordflow">if</span> (seg != segThis) g += seg-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>()-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a20904e6f05c74e59da141c3a42c08561">GetObjFnInTree</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;    }</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;    <span class="keywordflow">if</span> (segThis)</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;      vtx = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(segThis-&gt;Next());</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;  }</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;  <span class="keywordflow">return</span> g + GetObjFunction();</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;}</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;<span class="keywordtype">double</span></div>
<div class="line"><a name="l02278"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a5cd3fe36995a6f5d022437b7fc53fc0e"> 2278</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a5cd3fe36995a6f5d022437b7fc53fc0e">pma::Track3D::TuneFullTree</a>(<span class="keywordtype">double</span> eps, <span class="keywordtype">double</span> gmax)</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;{</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;  <span class="keywordflow">if</span> (<span class="keywordtype">size_t</span> depth = 1; !UpdateParamsInTree(<span class="keyword">false</span>, depth)) {</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;    mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;TuneFullTree failed.&quot;</span>;</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;    <span class="keywordflow">return</span> -2; <span class="comment">// negetive to tag destroyed tree</span></div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;  }</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;  <span class="keywordtype">double</span> g0 = GetObjFnInTree(), g1 = 0.0;</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a2b86f9ce3fb9b46f603782288e918bdf">std::isfinite</a>(g0)) {</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;    mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Infinifte value of g.&quot;</span>;</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;    <span class="keywordflow">return</span> -2; <span class="comment">// negetive to tag destroyed tree</span></div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;  }</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;  <span class="keywordflow">if</span> (g0 &gt; gmax) {</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;    mf::LogWarning(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Too high value of g: &quot;</span> &lt;&lt; g0;</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;    <span class="keywordflow">return</span> -1; <span class="comment">// negetive to tag bad tree</span></div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;  }</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;  <span class="keywordflow">if</span> (g0 == 0.0) <span class="keywordflow">return</span> g0;</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;  mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Tune tree, g = &quot;</span> &lt;&lt; g0;</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stepIter = 0;</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;  <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;    <span class="keywordtype">double</span> gstep = 1.0;</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iter = 0;</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;    <span class="keywordflow">while</span> ((gstep &gt; eps) &amp;&amp; (iter &lt; 60)) {</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;      g1 = g0;</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;      g0 = TuneSinglePass();</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;      MakeProjectionInTree();</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;      <span class="keywordflow">if</span> (<span class="keywordtype">size_t</span> depth = 1; !UpdateParamsInTree(<span class="keyword">false</span>, depth)) {</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;        g0 = -2;</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;      } <span class="comment">// negetive to tag destroyed tree</span></div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;      <span class="keywordflow">if</span> (g0 == 0.0<a class="code" href="../../d4/daf/sbnana_2sbnana_2CAFAna_2Analysis_2Surface_8cxx.html#a2c3bf28add4b70497e6fd9070cd7dfc9">F</a>) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;      gstep = fabs(g0 - g1) / g0;</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;      iter++;</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;    }</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;    stepIter++;</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;  } <span class="keywordflow">while</span> (stepIter &lt; 5);</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;  MakeProjectionInTree();</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;  SortHitsInTree();</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;  <span class="keywordflow">if</span> (g0 &gt;= 0) { mf::LogVerbatim(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;  done, g = &quot;</span> &lt;&lt; g0; }</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;    mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;TuneFullTree failed.&quot;</span>;</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;  }</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;  <span class="keywordflow">return</span> g0;</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;}</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02333"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a02da2f970d3f7ad5a44dce1b235f8977"> 2333</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a02da2f970d3f7ad5a44dce1b235f8977">pma::Track3D::ApplyDriftShiftInTree</a>(<span class="keyword">const</span> <a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html">detinfo::DetectorClocksData</a>&amp; clockData,</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;                                    <span class="keyword">const</span> <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;                                    <span class="keywordtype">double</span> dx,</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;                                    <span class="keywordtype">bool</span> skipFirst)</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;{</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;  <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* node = fNodes.front();</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;  <span class="keywordflow">if</span> (skipFirst) {</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> segThis = NextSegment(node)) node = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(segThis-&gt;Next());</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;  }</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;  <span class="keywordflow">while</span> (node) {</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;    node-&gt;<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html#af58e12d4349374fc924958c31bcd48d7">ApplyDriftShift</a>(dx);</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;    <span class="keyword">auto</span> segThis = NextSegment(node);</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; node-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">NextCount</a>(); i++) {</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;      <span class="keyword">auto</span> seg = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(node-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#aa05348c187c1f5e1e2cb9334f15e101a">Next</a>(i));</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;      <span class="keywordflow">if</span> (seg != segThis) seg-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">Parent</a>()-&gt;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a02da2f970d3f7ad5a44dce1b235f8977">ApplyDriftShiftInTree</a>(clockData, detProp, dx, <span class="keyword">true</span>);</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;    }</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;    <span class="keywordflow">if</span> (segThis)</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;      node = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(segThis-&gt;Next());</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;  }</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a> : fHits) {</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;    <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>-&gt;fPoint3D[0] += dx;</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;  }</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> : fAssignedPoints) {</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;    (*p)[0] += dx;</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;  }</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;  <span class="comment">// For T0 we need to make sure we use the total shift, not just this current</span></div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;  <span class="comment">// one in case of multiple shifts</span></div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;  <span class="keywordtype">double</span> newdx = fNodes.front()-&gt;GetDriftShift();</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;  <span class="comment">// Now convert this newdx into T0 and store in fT0</span></div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;  SetT0FromDx(clockData, detProp, newdx);</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;}</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02376"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a6f10a9c69a25e9c2b1f7c274a8cf1559"> 2376</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a6f10a9c69a25e9c2b1f7c274a8cf1559">pma::Track3D::SetT0FromDx</a>(<a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html">detinfo::DetectorClocksData</a> <span class="keyword">const</span>&amp; clockData,</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;                          <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;                          <span class="keywordtype">double</span> dx)</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;{</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;  <span class="keyword">auto</span> <span class="keyword">const</span>* geom = lar::providerFrom&lt;geo::Geometry&gt;();</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html">geo::TPCGeo</a>&amp; tpcGeo = geom-&gt;TPC(fNodes.front()-&gt;TPC(), fNodes.front()-&gt;Cryo());</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;  <span class="comment">// GetXTicksCoefficient has a sign that we don&#39;t care about. We need to decide</span></div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;  <span class="comment">// the sign for ourselves based on the drift direction of the TPC</span></div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;  <span class="keywordtype">double</span> correctedSign = 0;</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;  <span class="keywordflow">if</span> (tpcGeo.DetectDriftDirection() &gt; 0) {</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;    <span class="keywordflow">if</span> (dx &gt; 0) { correctedSign = 1.0; }</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;      correctedSign = -1.0;</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;    }</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;  }</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;    <span class="keywordflow">if</span> (dx &gt; 0) { correctedSign = -1.0; }</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;      correctedSign = 1.0;</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;    }</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;  }</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;  <span class="comment">// The magnitude of x in ticks is fine</span></div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;  <span class="keywordtype">double</span> dxInTicks = fabs(dx / detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#adf888c29bd661e0b03973b96f03b9bd9">GetXTicksCoefficient</a>());</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;  <span class="comment">// Now correct the sign</span></div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;  dxInTicks = dxInTicks * correctedSign;</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;  <span class="comment">// At this stage, we have xInTicks relative to the trigger time</span></div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;  <span class="keywordtype">double</span> dxInTime = dxInTicks * clockData.<a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html#a389055d7957e62c8d83b0ac23cb605b6">TPCClock</a>().<a class="code" href="../../d0/d00/classdetinfo_1_1ElecClock.html#affdf2e345f26f00dc1ca4b144158b90c">TickPeriod</a>();</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;  <span class="comment">// Reconstructed times are relative to the trigger (t=0), so this is our T0</span></div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;  <a class="code" href="../../d4/d4d/namespaceevgen.html#a354af7140af9e222ae73503ce23ad680">fT0</a> = dxInTime;</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;  mf::LogDebug(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; dx &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dxInTicks &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; correctedSign &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code" href="../../d4/d4d/namespaceevgen.html#a354af7140af9e222ae73503ce23ad680">fT0</a></div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;                               &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; tpcGeo.DetectDriftDirection()</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;                               &lt;&lt; <span class="stringliteral">&quot; :: &quot;</span> &lt;&lt; clockData.<a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html#a97752c751ce6873c94d29ece8fcc215f">TriggerTime</a>() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;                               &lt;&lt; clockData.<a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html#add8243f0f26e55d68bdfe3b36545994f">TriggerOffsetTPC</a>() &lt;&lt; std::endl;</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;  <span class="comment">// Mark this track as having a measured T0</span></div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;  fT0Flag = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;}</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02418"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#ad533a00b8bd295bc021a281e47a1207a"> 2418</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ad533a00b8bd295bc021a281e47a1207a">pma::Track3D::DeleteSegments</a>()</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;{</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; fSegments.size(); i++)</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;    <span class="keyword">delete</span> fSegments[i];</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;  fSegments.clear();</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;}</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02426"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a90f8b897da30b12f54b974020d52e9f3"> 2426</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a90f8b897da30b12f54b974020d52e9f3">pma::Track3D::RebuildSegments</a>()</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;{</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;  DeleteSegments();</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;  fSegments.reserve(fNodes.size() - 1);</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 1; i &lt; fNodes.size(); i++) {</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;    fSegments.push_back(<span class="keyword">new</span> <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>(<span class="keyword">this</span>, fNodes[i - 1], fNodes[i]));</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;  }</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;}</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02437"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a87e518fd64bf15a01367c7e8fe068ded"> 2437</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a87e518fd64bf15a01367c7e8fe068ded">pma::Track3D::CleanupTails</a>()</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;{</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nhits = 0;</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;  <span class="keywordflow">while</span> (!nhits &amp;&amp; (fNodes.size() &gt; 2) &amp;&amp; !fNodes.front()-&gt;IsBranching()) {</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;    <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx = fNodes.front();</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;    nhits = vtx-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#abbfea4ff7cf1ced43172ee047440496c">NHits</a>();</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;    <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* seg = NextSegment(vtx);</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;    nhits += seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#abbfea4ff7cf1ced43172ee047440496c">NHits</a>();</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;    <span class="keywordflow">if</span> (!nhits) {</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;      <span class="keywordflow">if</span> (vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">NextCount</a>() &lt; 2) <span class="keyword">delete</span> vtx;</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;      fNodes.erase(fNodes.begin());</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;      <span class="keyword">delete</span> seg;</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;      fSegments.erase(fSegments.begin());</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;      MakeProjection();</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;    }</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;  }</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;  nhits = 0;</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;  <span class="keywordflow">while</span> (!nhits &amp;&amp; (fNodes.size() &gt; 2) &amp;&amp; !fNodes.back()-&gt;IsBranching()) {</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;    <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx = fNodes.back();</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;    nhits = vtx-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#abbfea4ff7cf1ced43172ee047440496c">NHits</a>();</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;    <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* seg = PrevSegment(vtx);</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;    nhits += seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#abbfea4ff7cf1ced43172ee047440496c">NHits</a>();</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;    <span class="keywordflow">if</span> (!nhits) {</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;      <span class="keywordflow">if</span> (vtx-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">NextCount</a>() &lt; 1) <span class="keyword">delete</span> fNodes.back();</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;      fNodes.pop_back();</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;      <span class="keyword">delete</span> seg;</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;      fSegments.pop_back();</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;      MakeProjection();</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;    }</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;  }</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;}</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l02479"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a86f8c831349f06279e0711ed3c1b884a"> 2479</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a86f8c831349f06279e0711ed3c1b884a">pma::Track3D::ShiftEndsToHits</a>()</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;{</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;  <a class="code" href="../../d0/dcf/classpma_1_1Element3D.html">pma::Element3D</a>* el;</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;  <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx;</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;  <span class="keywordflow">if</span> (!(fNodes.front()-&gt;Prev())) {</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;    el = GetNearestElement(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a2602587bf9a1efd1e11d4fdeb2da110a">front</a>()-&gt;<a class="code" href="../../d1/d4e/namespacelar_1_1fhicl_1_1geo.html#aff5db21a0b87718dbf7debb3cd62dbd0">Point3D</a>());</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;    vtx = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(el);</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;    <span class="keywordflow">if</span> (vtx) {</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;      <span class="keywordflow">if</span> (vtx == fNodes.front())</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;        fNodes.front()-&gt;<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html#a66a88d156275f1389b1fa81f552c6e2d">SetPoint3D</a>(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a2602587bf9a1efd1e11d4fdeb2da110a">front</a>()-&gt;<a class="code" href="../../d1/d4e/namespacelar_1_1fhicl_1_1geo.html#aff5db21a0b87718dbf7debb3cd62dbd0">Point3D</a>());</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;        mf::LogWarning(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;First hit is projected to inner node.&quot;</span>;</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;      }</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;    }</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;      <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* seg = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(el);</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;      <span class="keywordflow">if</span> (seg) {</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;        <span class="keywordflow">if</span> (seg-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>() == fNodes.front()) {</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;          <span class="keywordtype">double</span> l0 = seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#ab07ba8c1da53d63756a6105a828d24be">Length</a>();</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;          fNodes.front()-&gt;SetPoint3D(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a2602587bf9a1efd1e11d4fdeb2da110a">front</a>()-&gt;<a class="code" href="../../d1/d4e/namespacelar_1_1fhicl_1_1geo.html#aff5db21a0b87718dbf7debb3cd62dbd0">Point3D</a>());</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;          <span class="keywordflow">if</span> ((seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#ab07ba8c1da53d63756a6105a828d24be">Length</a>() &lt; 0.2 * l0) &amp;&amp; (fNodes.size() &gt; 2)) {</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;            <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* toRemove = fNodes[1];</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;            <span class="keywordflow">if</span> (toRemove-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">NextCount</a>() == 1) {</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;              mf::LogWarning(<span class="stringliteral">&quot;pma::Track3D&quot;</span>)</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;ShiftEndsToHits(): Short start segment, node removed.&quot;</span>;</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;              fNodes.erase(fNodes.begin() + 1);</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;              RebuildSegments();</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;              MakeProjection();</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;              <span class="keyword">delete</span> toRemove;</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;            }</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;            <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;              mf::LogWarning(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Branching node, not removed.&quot;</span>;</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;              <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;            }</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;          }</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;        }</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;          mf::LogWarning(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;First hit is projected to inner segment.&quot;</span>;</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;        }</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;      }</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;    }</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;  }</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;  <span class="keywordflow">if</span> (!(fNodes.back()-&gt;NextCount())) {</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;    el = GetNearestElement(back()-&gt;<a class="code" href="../../d1/d4e/namespacelar_1_1fhicl_1_1geo.html#aff5db21a0b87718dbf7debb3cd62dbd0">Point3D</a>());</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;    vtx = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(el);</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;    <span class="keywordflow">if</span> (vtx) {</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;      <span class="keywordflow">if</span> (vtx == fNodes.back())</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;        fNodes.back()-&gt;<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html#a66a88d156275f1389b1fa81f552c6e2d">SetPoint3D</a>(back()-&gt;<a class="code" href="../../d1/d4e/namespacelar_1_1fhicl_1_1geo.html#aff5db21a0b87718dbf7debb3cd62dbd0">Point3D</a>());</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;        mf::LogWarning(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;First hit is projected to inner node.&quot;</span>;</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;      }</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;    }</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;      <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* seg = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>*<span class="keyword">&gt;</span>(el);</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;      <span class="keywordflow">if</span> (seg) {</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;        <span class="keywordflow">if</span> (seg-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#aa3a1a440fb324fe0aa37211705f9c8eb">Next</a>() == fNodes.back()) {</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;          <span class="keywordtype">double</span> l0 = seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#ab07ba8c1da53d63756a6105a828d24be">Length</a>();</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;          fNodes.back()-&gt;SetPoint3D(back()-&gt;<a class="code" href="../../d1/d4e/namespacelar_1_1fhicl_1_1geo.html#aff5db21a0b87718dbf7debb3cd62dbd0">Point3D</a>());</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;          <span class="keywordflow">if</span> ((seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#ab07ba8c1da53d63756a6105a828d24be">Length</a>() &lt; 0.2 * l0) &amp;&amp; (fNodes.size() &gt; 2)) {</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;            <span class="keywordtype">size_t</span> idx = fNodes.size() - 2;</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;            <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* toRemove = fNodes[idx];</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;            <span class="keywordflow">if</span> (toRemove-&gt;<a class="code" href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">NextCount</a>() == 1) {</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;              mf::LogWarning(<span class="stringliteral">&quot;pma::Track3D&quot;</span>)</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;ShiftEndsToHits(): Short end segment, node removed.&quot;</span>;</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;              fNodes.erase(fNodes.begin() + idx);</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;              RebuildSegments();</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;              MakeProjection();</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;              <span class="keyword">delete</span> toRemove;</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;            }</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;            <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;              mf::LogWarning(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Branching node, not removed.&quot;</span>;</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;              <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;            }</div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;          }</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;        }</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;          mf::LogWarning(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;First hit is projected to inner segment.&quot;</span>;</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;        }</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;      }</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;    }</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;  }</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;}</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;<span class="keywordtype">double</span></div>
<div class="line"><a name="l02575"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a506e25c139891a49e29d88bab67f60c3"> 2575</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a506e25c139891a49e29d88bab67f60c3">pma::Track3D::Dist2</a>(<span class="keyword">const</span> TVector2&amp; p2d,</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> view,</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tpc,</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cryo)<span class="keyword"> const</span></div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>, min_dist = 1.0e12;</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;  <span class="keywordtype">int</span> t = (int)tpc, c = (<span class="keywordtype">int</span>)cryo;</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;  <span class="keyword">auto</span> n0 = fNodes.front();</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;  <span class="keywordflow">if</span> ((n0-&gt;TPC() == t) &amp;&amp; (n0-&gt;Cryo() == c)) {</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;    dist = n0-&gt;GetDistance2To(p2d, view);</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;    <span class="keywordflow">if</span> (dist &lt; min_dist) min_dist = <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>;</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;  }</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;  <span class="keyword">auto</span> n1 = fNodes.back();</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;  <span class="keywordflow">if</span> ((n1-&gt;TPC() == t) &amp;&amp; (n1-&gt;Cryo() == c)) {</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;    dist = n1-&gt;GetDistance2To(p2d, view);</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;    <span class="keywordflow">if</span> (dist &lt; min_dist) min_dist = <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>;</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;  }</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> : fSegments)</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>-&gt;TPC() == t) &amp;&amp; (<a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>-&gt;Cryo() == c)) {</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;      dist = <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>-&gt;GetDistance2To(p2d, view);</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;      <span class="keywordflow">if</span> (dist &lt; min_dist) min_dist = <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>;</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;    }</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;  <span class="keywordflow">return</span> min_dist;</div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;}</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;<span class="keywordtype">double</span></div>
<div class="line"><a name="l02603"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a50eddc2d382c23178406df435d816c1f"> 2603</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a506e25c139891a49e29d88bab67f60c3">pma::Track3D::Dist2</a>(<span class="keyword">const</span> TVector3&amp; p3d)<span class="keyword"> const</span></div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;  <span class="keyword">using namespace </span>ranges;</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;  <span class="keyword">auto</span> to_distance2 = [&amp;p3d](<span class="keyword">auto</span> seg) { <span class="keywordflow">return</span> seg-&gt;GetDistance2To(p3d); };</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;  <span class="keywordflow">return</span> min(fSegments | <a class="code" href="../../d5/d45/namespaceicarus_1_1waveform__operations_1_1details.html#ae295d3f6cb2f9181dccdf0e3492d44e0">views::transform</a>(to_distance2));</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;}</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html">pma::Element3D</a>*</div>
<div class="line"><a name="l02611"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a0f0aef67408b038fb28a735ebf75b080"> 2611</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a0f0aef67408b038fb28a735ebf75b080">pma::Track3D::GetNearestElement</a>(<span class="keyword">const</span> TVector2&amp; p2d,</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;                                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> view,</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;                                <span class="keywordtype">int</span> tpc,</div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;                                <span class="keywordtype">bool</span> skipFrontVtx,</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;                                <span class="keywordtype">bool</span> skipBackVtx)<span class="keyword"> const</span></div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;  <span class="keywordflow">if</span> (fSegments.front()-&gt;TPC() &lt; 0) skipFrontVtx = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;  <span class="keywordflow">if</span> (fSegments.back()-&gt;TPC() &lt; 0) skipBackVtx = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;  <span class="keywordflow">if</span> (skipFrontVtx &amp;&amp; skipBackVtx &amp;&amp; (fSegments.size() == 1))</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;    <span class="keywordflow">return</span> fSegments.front(); <span class="comment">// no need for searching...</span></div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;  <span class="keywordtype">size_t</span> v0 = 0, v1 = fNodes.size();</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;  <span class="keywordflow">if</span> (skipFrontVtx) v0 = 1;</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;  <span class="keywordflow">if</span> (skipBackVtx) --v1;</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;  <a class="code" href="../../d0/dcf/classpma_1_1Element3D.html">pma::Element3D</a>* pe_min = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;  <span class="keyword">auto</span> min_dist = std::numeric_limits&lt;double&gt;::max();</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = v0; i &lt; v1; i++)</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;    <span class="keywordflow">if</span> (fNodes[i]-&gt;<a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>() == tpc) {</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;      <span class="keywordtype">double</span> dist = fNodes[i]-&gt;GetDistance2To(p2d, view);</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;      <span class="keywordflow">if</span> (dist &lt; min_dist) {</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;        min_dist = <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>;</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;        pe_min = fNodes[i];</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;      }</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;    }</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> segment : fSegments)</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;    <span class="keywordflow">if</span> (segment-&gt;TPC() == tpc) {</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;      <span class="keywordflow">if</span> (segment-&gt;TPC() &lt; 0) <span class="keywordflow">continue</span>; <span class="comment">// segment between TPC&#39;s</span></div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> dist = segment-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#afb0a4d564bbc8fa37963d266d389797b">GetDistance2To</a>(p2d, view);</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;      <span class="keywordflow">if</span> (dist &lt; min_dist) {</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;        min_dist = <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>;</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;        pe_min = segment;</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;      }</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;    }</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;  <span class="keywordflow">if</span> (!pe_min) <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Nearest element not found.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;  <span class="keywordflow">return</span> pe_min;</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;}</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html">pma::Element3D</a>*</div>
<div class="line"><a name="l02652"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a9f3f139fadf0eb298406065aa6315575"> 2652</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a0f0aef67408b038fb28a735ebf75b080">pma::Track3D::GetNearestElement</a>(<span class="keyword">const</span> TVector3&amp; p3d)<span class="keyword"> const</span></div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;  <a class="code" href="../../d0/dcf/classpma_1_1Element3D.html">pma::Element3D</a>* pe_min = fNodes.front();</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>, min_dist = pe_min-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#afb0a4d564bbc8fa37963d266d389797b">GetDistance2To</a>(p3d);</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 1; i &lt; fNodes.size(); i++) {</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;    dist = fNodes[i]-&gt;GetDistance2To(p3d);</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;    <span class="keywordflow">if</span> (dist &lt; min_dist) {</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;      min_dist = <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>;</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;      pe_min = fNodes[i];</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;    }</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;  }</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; fSegments.size(); i++) {</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;    dist = fSegments[i]-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#afb0a4d564bbc8fa37963d266d389797b">GetDistance2To</a>(p3d);</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;    <span class="keywordflow">if</span> (dist &lt; min_dist) {</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;      min_dist = <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>;</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;      pe_min = fSegments[i];</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;    }</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;  }</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;  <span class="keywordflow">return</span> pe_min;</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;}</div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l02674"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#acd4ed93e64df733122b3072ffcd4f458"> 2674</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#acd4ed93e64df733122b3072ffcd4f458">pma::Track3D::GetUnconstrainedProj3D</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;                                     art::Ptr&lt;recob::Hit&gt; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>,</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;                                     TVector3&amp; p3d,</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;                                     <span class="keywordtype">double</span>&amp; dist2)<span class="keyword"> const</span></div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;  TVector2 p2d = <a class="code" href="../../d8/d4a/namespacepma.html#ac06691f19da7b76a3a27c7287e3b2ff1">pma::WireDriftToCm</a>(detProp,</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;                                    hit-&gt;WireID().Wire,</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;                                    hit-&gt;PeakTime(),</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;                                    hit-&gt;WireID().Plane,</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;                                    hit-&gt;WireID().TPC,</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;                                    hit-&gt;WireID().Cryostat);</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;  <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* seg = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;  <span class="keywordtype">double</span> d2, min_d2 = 1.0e100;</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;  <span class="keywordtype">int</span> tpc = (int)hit-&gt;WireID().<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a0e4d7a26f6bac4987353833d21097993">TPC</a>;</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;  <span class="keywordtype">int</span> view = hit-&gt;WireID().Plane;</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; fSegments.size(); i++) {</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;    <span class="keywordflow">if</span> (fSegments[i]-&gt;<a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>() != tpc) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;    d2 = fSegments[i]-&gt;GetDistance2To(p2d, view);</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;    <span class="keywordflow">if</span> (d2 &lt; min_d2) {</div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;      min_d2 = d2;</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;      seg = fSegments[i];</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;    }</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;  }</div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;  <span class="keywordflow">if</span> (seg) {</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;    p3d = seg-&gt;GetUnconstrainedProj3D(p2d, view);</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;    dist2 = min_d2;</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;    <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* prev = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(seg-&gt;Prev());</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;    <span class="keywordflow">return</span> prev-&gt;<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html#a2ec9b7dc0c2adbb1cc253c43483dde9c">SameTPC</a>(p3d); <span class="comment">// 3D can be beyond the segment endpoints =&gt; in other TPC</span></div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;  }</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;}</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;</div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02711"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a249124592b3305e473fc3428ebf4803e"> 2711</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a249124592b3305e473fc3428ebf4803e">pma::Track3D::SortHits</a>()</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;{</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;  std::vector&lt;pma::Hit3D*&gt; hits_tmp;</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;  hits_tmp.reserve(<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>());</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;  <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx = fNodes.front();</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;  <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* seg = NextSegment(vtx);</div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;  <span class="keywordflow">while</span> (vtx) {</div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;    vtx-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#affc19b2cc81fb0408b0ea8df648e5d98">SortHits</a>();</div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; vtx-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#abbfea4ff7cf1ced43172ee047440496c">NHits</a>(); i++) {</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;      <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* h3d = &amp;(vtx-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i));</div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;      <span class="keywordflow">if</span> (h3d-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a8ae6c786ab52cfa3e1e1962c5fba06af">fParent</a> == <span class="keyword">this</span>) hits_tmp.push_back(h3d);</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;    }</div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;    <span class="keywordflow">if</span> (seg) {</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;      seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#affc19b2cc81fb0408b0ea8df648e5d98">SortHits</a>();</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#abbfea4ff7cf1ced43172ee047440496c">NHits</a>(); i++) {</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;        <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* h3d = &amp;(seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i));</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;        <span class="keywordflow">if</span> (h3d-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a8ae6c786ab52cfa3e1e1962c5fba06af">fParent</a> == <span class="keyword">this</span>) hits_tmp.push_back(h3d);</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;      }</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;      vtx = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(seg-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#aa3a1a440fb324fe0aa37211705f9c8eb">Next</a>());</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;      seg = NextSegment(vtx);</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;    }</div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;  }</div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>() == hits_tmp.size()) {</div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>(); i++) {</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;      fHits[i] = hits_tmp[i];</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;    }</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;  }</div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;    mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Hit sorting problem.&quot;</span>;</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;}</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span></div>
<div class="line"><a name="l02749"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a654c963a50f1bb2bb467369a11430edf"> 2749</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a654c963a50f1bb2bb467369a11430edf">pma::Track3D::DisableSingleViewEnds</a>()</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;{</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;  <a class="code" href="../../d2/d40/PCAnglePlaneMaker__module_8cc.html#a87218e5b4cafa52fddfafeb4d9ce0be3">SortHits</a>();</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nDisabled = 0;</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;  std::array&lt;int, 4&gt; hasHits{{}};</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;  <a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a>* nextHit = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;  <span class="keywordtype">int</span> hitIndex = -1;</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;  <span class="keywordtype">bool</span> rebuild = <span class="keyword">false</span>, stop = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;  <span class="keywordtype">int</span> nViews = 0;</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;  <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;    <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx = fNodes.front();</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;    <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* seg = NextSegment(vtx);</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;    <span class="keywordflow">if</span> (!seg) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;</div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;    <span class="keywordflow">if</span> (vtx-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a8361c65046325e46d4f2cc4f72db23e4">NPoints</a>() + seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a8361c65046325e46d4f2cc4f72db23e4">NPoints</a>() &gt; 0) hasHits[3] = 1;</div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; vtx-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#abbfea4ff7cf1ced43172ee047440496c">NHits</a>(); i++) {</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;      hitIndex = index_of(&amp;(vtx-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i)));</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;      <span class="keywordflow">if</span> ((hitIndex &gt;= 0) &amp;&amp; (hitIndex + 1 &lt; (<span class="keywordtype">int</span>)<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>()))</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;        nextHit = fHits[hitIndex + 1];</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;        nextHit = 0;</div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;      <span class="keywordflow">if</span> (vtx-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ab628d7feecc85a8172f17aef5f4778da">IsEnabled</a>()) hasHits[vtx-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>()] = 1;</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;      <span class="keywordflow">if</span> (nextHit &amp;&amp; nextHit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ab628d7feecc85a8172f17aef5f4778da">IsEnabled</a>()) hasHits[nextHit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>()] = 1;</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;      nViews = hasHits[0] + hasHits[1] + hasHits[2] + hasHits[3];</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;      <span class="keywordflow">if</span> (nViews &lt; 2) {</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;        <span class="keywordflow">if</span> (vtx-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ab628d7feecc85a8172f17aef5f4778da">IsEnabled</a>()) {</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;          vtx-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a082de271e852f62f4f7809f93c83edf4">SetEnabled</a>(<span class="keyword">false</span>);</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;          nDisabled++;</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;        }</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;      }</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;    }</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#abbfea4ff7cf1ced43172ee047440496c">NHits</a>(); i++) {</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;      hitIndex = index_of(&amp;(seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i)));</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;      <span class="keywordflow">if</span> ((hitIndex &gt;= 0) &amp;&amp; (hitIndex + 1 &lt; (<span class="keywordtype">int</span>)<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>()))</div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;        nextHit = fHits[hitIndex + 1];</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;        nextHit = 0;</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;      <span class="keywordflow">if</span> (seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ab628d7feecc85a8172f17aef5f4778da">IsEnabled</a>()) hasHits[seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>()] = 1;</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;      <span class="keywordflow">if</span> (nextHit &amp;&amp; nextHit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ab628d7feecc85a8172f17aef5f4778da">IsEnabled</a>()) hasHits[nextHit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>()] = 1;</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;      nViews = hasHits[0] + hasHits[1] + hasHits[2] + hasHits[3];</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;      <span class="keywordflow">if</span> (nViews &lt; 2) {</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;        <span class="keywordflow">if</span> (seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ab628d7feecc85a8172f17aef5f4778da">IsEnabled</a>()) {</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;          seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a082de271e852f62f4f7809f93c83edf4">SetEnabled</a>(<span class="keyword">false</span>);</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;          nDisabled++;</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;        }</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;      }</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;    }</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;    <span class="keywordflow">if</span> (fNodes.size() &lt; 3) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;    nViews = hasHits[1] + hasHits[2] + hasHits[3];</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;    <span class="keywordflow">if</span> (hasHits[0] || (nViews &gt; 1))</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;      stop = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!fNodes.front()-&gt;IsBranching()) {</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;      <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx_front = fNodes.front();</div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;      fNodes.erase(fNodes.begin());</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;      <span class="keyword">delete</span> vtx_front;</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;      rebuild = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;    }</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;  } <span class="keywordflow">while</span> (!stop);</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;  stop = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;  nViews = 0;</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;  hasHits.fill(0);</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;  <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;    <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx = fNodes.back();</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;    <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* seg = PrevSegment(vtx);</div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;    <span class="keywordflow">if</span> (!seg) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;    <span class="keywordflow">if</span> (vtx-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a8361c65046325e46d4f2cc4f72db23e4">NPoints</a>() || seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a8361c65046325e46d4f2cc4f72db23e4">NPoints</a>()) hasHits[3] = 1;</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;</div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = vtx-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#abbfea4ff7cf1ced43172ee047440496c">NHits</a>() - 1; i &gt;= 0; i--) {</div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;      hitIndex = index_of(&amp;(vtx-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i)));</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;      <span class="keywordflow">if</span> ((hitIndex &gt;= 0) &amp;&amp; (hitIndex - 1 &gt;= 0))</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;        nextHit = fHits[hitIndex - 1];</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;        nextHit = 0;</div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;      <span class="keywordflow">if</span> (vtx-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ab628d7feecc85a8172f17aef5f4778da">IsEnabled</a>()) hasHits[vtx-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>()] = 1;</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;      <span class="keywordflow">if</span> (nextHit &amp;&amp; nextHit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ab628d7feecc85a8172f17aef5f4778da">IsEnabled</a>()) hasHits[nextHit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>()] = 1;</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;      nViews = hasHits[0] + hasHits[1] + hasHits[2] + hasHits[3];</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;      <span class="keywordflow">if</span> (nViews &lt; 2) {</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;        <span class="keywordflow">if</span> (vtx-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ab628d7feecc85a8172f17aef5f4778da">IsEnabled</a>()) {</div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;          vtx-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a082de271e852f62f4f7809f93c83edf4">SetEnabled</a>(<span class="keyword">false</span>);</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;          nDisabled++;</div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;        }</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;      }</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;    }</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#abbfea4ff7cf1ced43172ee047440496c">NHits</a>() - 1; i &gt;= 0; i--) {</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;      hitIndex = index_of(&amp;(seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i)));</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;      <span class="keywordflow">if</span> ((hitIndex &gt;= 0) &amp;&amp; (hitIndex - 1 &gt;= 0))</div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;        nextHit = fHits[hitIndex - 1];</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;        nextHit = 0;</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;</div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;      <span class="keywordflow">if</span> (seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ab628d7feecc85a8172f17aef5f4778da">IsEnabled</a>()) hasHits[seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>()] = 1;</div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;      <span class="keywordflow">if</span> (nextHit &amp;&amp; nextHit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ab628d7feecc85a8172f17aef5f4778da">IsEnabled</a>()) hasHits[nextHit-&gt;<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">View2D</a>()] = 1;</div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;      nViews = hasHits[0] + hasHits[1] + hasHits[2] + hasHits[3];</div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;      <span class="keywordflow">if</span> (nViews &lt; 2) {</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;        <span class="keywordflow">if</span> (seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#ab628d7feecc85a8172f17aef5f4778da">IsEnabled</a>()) {</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;          seg-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">Hit</a>(i).<a class="code" href="../../d5/d5f/classpma_1_1Hit3D.html#a082de271e852f62f4f7809f93c83edf4">SetEnabled</a>(<span class="keyword">false</span>);</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;          nDisabled++;</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;        }</div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;      }</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;    }</div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;    <span class="keywordflow">if</span> (fNodes.size() &lt; 3) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;    nViews = hasHits[1] + hasHits[2] + hasHits[3];</div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;    <span class="keywordflow">if</span> (hasHits[0] || (nViews &gt; 1))</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;      stop = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!fNodes.back()-&gt;IsBranching()) {</div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;      <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtx_back = fNodes.back();</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;      fNodes.pop_back();</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;      <span class="keyword">delete</span> vtx_back;</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;      rebuild = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;    }</div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;  } <span class="keywordflow">while</span> (!stop);</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;  <span class="keywordflow">if</span> (rebuild) {</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;    RebuildSegments();</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;    MakeProjection();</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;  }</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;  <span class="keywordflow">return</span> nDisabled;</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;}</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;</div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l02888"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a6043faf9597d37bddad7860cef8a1219"> 2888</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a6043faf9597d37bddad7860cef8a1219">pma::Track3D::SelectHits</a>(<span class="keywordtype">float</span> fraction)</div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;{</div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;  <span class="keywordflow">if</span> (fraction &lt; 0.0<a class="code" href="../../d4/daf/sbnana_2sbnana_2CAFAna_2Analysis_2Surface_8cxx.html#a2c3bf28add4b70497e6fd9070cd7dfc9">F</a>) fraction = 0.0F;</div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;  <span class="keywordflow">if</span> (fraction &gt; 1.0<a class="code" href="../../d4/daf/sbnana_2sbnana_2CAFAna_2Analysis_2Surface_8cxx.html#a2c3bf28add4b70497e6fd9070cd7dfc9">F</a>) fraction = 1.0F;</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;  <span class="keywordflow">if</span> (fraction &lt; 1.0<a class="code" href="../../d4/daf/sbnana_2sbnana_2CAFAna_2Analysis_2Surface_8cxx.html#a2c3bf28add4b70497e6fd9070cd7dfc9">F</a>) std::sort(fHits.begin(), fHits.end(), <a class="code" href="../../df/d56/structpma_1_1bTrajectory3DDistLess.html">pma::bTrajectory3DDistLess</a>());</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;  <span class="keywordtype">size_t</span> nHitsColl = (size_t)(fraction * NHits(<a class="code" href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486a29e198ce46b2c8fc4a31422f42f77c64">geo::kZ</a>));</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;  <span class="keywordtype">size_t</span> nHitsInd2 = (size_t)(fraction * NHits(<a class="code" href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486aea23122caaaed75b787c745a188871f6">geo::kV</a>));</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;  <span class="keywordtype">size_t</span> nHitsInd1 = (size_t)(fraction * NHits(<a class="code" href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486ae2842cacc3d7d281d01b4316380b8d5b">geo::kU</a>));</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;  <span class="keywordtype">size_t</span> coll = 0, ind2 = 0, ind1 = 0;</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;  <span class="keywordtype">bool</span> b, changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a> : fHits) {</div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;    b = <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>-&gt;IsEnabled();</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;    <span class="keywordflow">if</span> (fraction &lt; 1.0<a class="code" href="../../d4/daf/sbnana_2sbnana_2CAFAna_2Analysis_2Surface_8cxx.html#a2c3bf28add4b70497e6fd9070cd7dfc9">F</a>) {</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;      <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>-&gt;SetEnabled(<span class="keyword">false</span>);</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;      <span class="keywordflow">switch</span> (<a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>-&gt;View2D()) {</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486a29e198ce46b2c8fc4a31422f42f77c64">geo::kZ</a>:</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;        <span class="keywordflow">if</span> (coll++ &lt; nHitsColl) <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>-&gt;SetEnabled(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486aea23122caaaed75b787c745a188871f6">geo::kV</a>:</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;        <span class="keywordflow">if</span> (ind2++ &lt; nHitsInd2) <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>-&gt;SetEnabled(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486ae2842cacc3d7d281d01b4316380b8d5b">geo::kU</a>:</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;        <span class="keywordflow">if</span> (ind1++ &lt; nHitsInd1) <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>-&gt;SetEnabled(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;      }</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;    }</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;      <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>-&gt;SetEnabled(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;    changed |= (b != <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>-&gt;IsEnabled());</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;  }</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;</div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;  <span class="keywordflow">if</span> (fraction &lt; 1.0<a class="code" href="../../d4/daf/sbnana_2sbnana_2CAFAna_2Analysis_2Surface_8cxx.html#a2c3bf28add4b70497e6fd9070cd7dfc9">F</a>) {</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;    FirstElement()-&gt;SelectAllHits();</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;    LastElement()-&gt;SelectAllHits();</div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;  }</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;  <span class="keywordflow">return</span> changed;</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;}</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l02930"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#ade58f28ec215a83815b0c4f559c0200b"> 2930</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ade58f28ec215a83815b0c4f559c0200b">pma::Track3D::SelectRndHits</a>(<span class="keywordtype">size_t</span> segmax, <span class="keywordtype">size_t</span> vtxmax)</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;{</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;  <span class="keywordtype">bool</span> changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> : fNodes)</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;    changed |= <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>-&gt;SelectRndHits(vtxmax);</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> : fSegments)</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;    changed |= <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>-&gt;SelectRndHits(segmax);</div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;  <span class="keywordflow">return</span> changed;</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;}</div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;</div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l02941"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#aa24c27416bcb2b7c95850af62bcfab68"> 2941</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#aa24c27416bcb2b7c95850af62bcfab68">pma::Track3D::SelectAllHits</a>()</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;{</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;  <span class="keywordtype">bool</span> changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a> : fHits) {</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;    changed |= !(<a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>-&gt;IsEnabled());</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;    <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>-&gt;SetEnabled(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;  }</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;  <span class="keywordflow">return</span> changed;</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;}</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02952"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a6aeea6b76f0be4ed9101fd90a91b264f"> 2952</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a6aeea6b76f0be4ed9101fd90a91b264f">pma::Track3D::MakeProjection</a>()</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;{</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> : fNodes)</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;    <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>-&gt;ClearAssigned(<span class="keyword">this</span>);</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> : fSegments)</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;    <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>-&gt;ClearAssigned(<span class="keyword">this</span>);</div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;</div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;  <a class="code" href="../../d0/dcf/classpma_1_1Element3D.html">pma::Element3D</a>* pe = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;</div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;  <span class="keywordtype">bool</span> skipFrontVtx = <span class="keyword">false</span>, skipBackVtx = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;  <span class="comment">// skip outermost vertices if not branching</span></div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;  <span class="keywordflow">if</span> (!(fNodes.front()-&gt;IsFrozen()) &amp;&amp; !(fNodes.front()-&gt;Prev()) &amp;&amp;</div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;      (fNodes.front()-&gt;NextCount() == 1)) {</div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;    skipFrontVtx = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;  }</div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;  <span class="keywordflow">if</span> (!(fNodes.front()-&gt;IsFrozen()) &amp;&amp; (fNodes.back()-&gt;NextCount() == 0)) { skipBackVtx = <span class="keyword">true</span>; }</div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a> : fHits) <span class="comment">// assign hits to nodes/segments</span></div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;  {</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;    pe = GetNearestElement(<a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>-&gt;Point2D(), <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>-&gt;View2D(), <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>-&gt;TPC(), skipFrontVtx, skipBackVtx);</div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;    pe-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a91f0c950cdf5a8be87974940313bf8fd">AddHit</a>(<a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>);</div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;  }</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;</div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> : fAssignedPoints) <span class="comment">// assign ref points to nodes/segments</span></div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;  {</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;    pe = GetNearestElement(*<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>);</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;    pe-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a93b33366a51ccec00fbf3b3b13e01fb6">AddPoint</a>(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>);</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;  }</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;</div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> : fNodes)</div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;    <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>-&gt;UpdateHitParams();</div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> : fSegments)</div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;    <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>-&gt;UpdateHitParams();</div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;}</div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;</div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l02989"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#af5881cf8e096f8ccfe1f307cfc0366e7"> 2989</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#af5881cf8e096f8ccfe1f307cfc0366e7">pma::Track3D::MakeFastProjection</a>()</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;{</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;  std::vector&lt;std::pair&lt;pma::Hit3D*, pma::Element3D*&gt;&gt; assignments;</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;  assignments.reserve(fHits.size());</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> hi : fHits) {</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;    <a class="code" href="../../d0/dcf/classpma_1_1Element3D.html">pma::Element3D</a>* pe = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> : fSegments) {</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>-&gt;NHits(); ++j)</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;        <span class="keywordflow">if</span> (hi == <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>-&gt;Hits()[j]) <span class="comment">// look at next/prev vtx,seg,vtx</span></div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;        {</div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;          pe = <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>;</div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;          <span class="keywordtype">double</span> min_d2 = <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>-&gt;GetDistance2To(hi-&gt;Point2D(), hi-&gt;View2D());</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;          <span class="keywordtype">int</span> <span class="keyword">const</span> tpc = hi-&gt;TPC();</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;          <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* nnext = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(<a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>-&gt;Next());</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;          <span class="keywordflow">if</span> (nnext-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a0e4d7a26f6bac4987353833d21097993">TPC</a>() == tpc) {</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;            <span class="keywordtype">double</span> <span class="keyword">const</span> d2 = nnext-&gt;<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html#a737403c9f686e0cd699e0f81135d65c8">GetDistance2To</a>(hi-&gt;Point2D(), hi-&gt;View2D());</div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;            <span class="keywordflow">if</span> (d2 &lt; min_d2) {</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;              min_d2 = d2;</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;              pe = nnext;</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;            }</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;            <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* snext = NextSegment(nnext);</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;            <span class="keywordflow">if</span> (snext &amp;&amp; (snext-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a0e4d7a26f6bac4987353833d21097993">TPC</a>() == tpc)) {</div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;              <span class="keywordtype">double</span> <span class="keyword">const</span> d2 = snext-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a33aa4442b2453c85fe621734df1afa4b">GetDistance2To</a>(hi-&gt;Point2D(), hi-&gt;View2D());</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;              <span class="keywordflow">if</span> (d2 &lt; min_d2) {</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;                min_d2 = d2;</div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;                pe = snext;</div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;              }</div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;              nnext = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(snext-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#aa3a1a440fb324fe0aa37211705f9c8eb">Next</a>());</div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;              <span class="keywordflow">if</span> (nnext-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a0e4d7a26f6bac4987353833d21097993">TPC</a>() == tpc) {</div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;                <span class="keywordtype">double</span> <span class="keyword">const</span> d2 = nnext-&gt;<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html#a737403c9f686e0cd699e0f81135d65c8">GetDistance2To</a>(hi-&gt;Point2D(), hi-&gt;View2D());</div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;                <span class="keywordflow">if</span> (d2 &lt; min_d2) {</div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;                  min_d2 = d2;</div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;                  pe = nnext;</div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;                }</div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;              }</div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;            }</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;          }</div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;          <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* nprev = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(<a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>-&gt;Prev());</div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;          <span class="keywordflow">if</span> (nprev-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a0e4d7a26f6bac4987353833d21097993">TPC</a>() == tpc) {</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;            <span class="keywordtype">double</span> <span class="keyword">const</span> d2 = nprev-&gt;<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html#a737403c9f686e0cd699e0f81135d65c8">GetDistance2To</a>(hi-&gt;Point2D(), hi-&gt;View2D());</div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;            <span class="keywordflow">if</span> (d2 &lt; min_d2) {</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;              min_d2 = d2;</div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;              pe = nprev;</div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;            }</div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;            <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* sprev = PrevSegment(nprev);</div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;            <span class="keywordflow">if</span> (sprev &amp;&amp; (sprev-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a0e4d7a26f6bac4987353833d21097993">TPC</a>() == tpc)) {</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;              <span class="keywordtype">double</span> <span class="keyword">const</span> d2 = sprev-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a33aa4442b2453c85fe621734df1afa4b">GetDistance2To</a>(hi-&gt;Point2D(), hi-&gt;View2D());</div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;              <span class="keywordflow">if</span> (d2 &lt; min_d2) {</div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;                min_d2 = d2;</div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;                pe = sprev;</div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;              }</div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;</div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;              nprev = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(sprev-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>());</div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;              <span class="keywordflow">if</span> (nprev-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a0e4d7a26f6bac4987353833d21097993">TPC</a>() == tpc) {</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;                <span class="keywordtype">double</span> <span class="keyword">const</span> d2 = nprev-&gt;<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html#a737403c9f686e0cd699e0f81135d65c8">GetDistance2To</a>(hi-&gt;Point2D(), hi-&gt;View2D());</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;                <span class="keywordflow">if</span> (d2 &lt; min_d2) {</div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;                  min_d2 = d2;</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;                  pe = nprev;</div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;                }</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;              }</div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;            }</div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;          }</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;          <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>-&gt;RemoveHitAt(j);</div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;        }</div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;      <span class="keywordflow">if</span> (pe) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;    }</div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;    <span class="keywordflow">if</span> (!pe)</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> : fNodes) {</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>-&gt;NHits(); ++j)</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;          <span class="keywordflow">if</span> (hi == <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>-&gt;Hits()[j]) <span class="comment">// look at next/prev seg,vtx,seg</span></div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;          {</div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;            pe = <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>;</div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;            <span class="keywordtype">double</span> d2, min_d2 = <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>-&gt;GetDistance2To(hi-&gt;Point2D(), hi-&gt;View2D());</div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;            <span class="keywordtype">int</span> tpc = hi-&gt;TPC();</div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;</div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;            <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* snext = NextSegment(<a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>);</div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;            <span class="keywordflow">if</span> (snext &amp;&amp; (snext-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a0e4d7a26f6bac4987353833d21097993">TPC</a>() == tpc)) {</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;              d2 = snext-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a33aa4442b2453c85fe621734df1afa4b">GetDistance2To</a>(hi-&gt;Point2D(), hi-&gt;View2D());</div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;              <span class="keywordflow">if</span> (d2 &lt; min_d2) {</div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;                min_d2 = d2;</div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;                pe = snext;</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;              }</div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;</div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;              <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* nnext = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(snext-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#aa3a1a440fb324fe0aa37211705f9c8eb">Next</a>());</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;              <span class="keywordflow">if</span> (nnext-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a0e4d7a26f6bac4987353833d21097993">TPC</a>() == tpc) {</div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;                d2 = nnext-&gt;<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html#a737403c9f686e0cd699e0f81135d65c8">GetDistance2To</a>(hi-&gt;Point2D(), hi-&gt;View2D());</div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;                <span class="keywordflow">if</span> (d2 &lt; min_d2) {</div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;                  min_d2 = d2;</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;                  pe = nnext;</div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;                }</div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;</div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;                snext = NextSegment(nnext);</div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;                <span class="keywordflow">if</span> (snext &amp;&amp; (snext-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a0e4d7a26f6bac4987353833d21097993">TPC</a>() == tpc)) {</div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;                  d2 = snext-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a33aa4442b2453c85fe621734df1afa4b">GetDistance2To</a>(hi-&gt;Point2D(), hi-&gt;View2D());</div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;                  <span class="keywordflow">if</span> (d2 &lt; min_d2) {</div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;                    min_d2 = d2;</div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;                    pe = snext;</div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;                  }</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;                }</div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;              }</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;            }</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;</div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;            <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* sprev = PrevSegment(<a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>);</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;            <span class="keywordflow">if</span> (sprev &amp;&amp; (sprev-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a0e4d7a26f6bac4987353833d21097993">TPC</a>() == tpc)) {</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;              d2 = sprev-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a33aa4442b2453c85fe621734df1afa4b">GetDistance2To</a>(hi-&gt;Point2D(), hi-&gt;View2D());</div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;              <span class="keywordflow">if</span> (d2 &lt; min_d2) {</div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;                min_d2 = d2;</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;                pe = sprev;</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;              }</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;              <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* nprev = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>*<span class="keyword">&gt;</span>(sprev-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">Prev</a>());</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;              <span class="keywordflow">if</span> (nprev-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a0e4d7a26f6bac4987353833d21097993">TPC</a>() == tpc) {</div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;                d2 = nprev-&gt;<a class="code" href="../../d3/dfc/classpma_1_1Node3D.html#a737403c9f686e0cd699e0f81135d65c8">GetDistance2To</a>(hi-&gt;Point2D(), hi-&gt;View2D());</div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;                <span class="keywordflow">if</span> (d2 &lt; min_d2) {</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;                  min_d2 = d2;</div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;                  pe = nprev;</div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;                }</div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;                sprev = PrevSegment(nprev);</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;                <span class="keywordflow">if</span> (sprev &amp;&amp; (sprev-&gt;<a class="code" href="../../d0/dcf/classpma_1_1Element3D.html#a0e4d7a26f6bac4987353833d21097993">TPC</a>() == tpc)) {</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;                  d2 = sprev-&gt;<a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html#a33aa4442b2453c85fe621734df1afa4b">GetDistance2To</a>(hi-&gt;Point2D(), hi-&gt;View2D());</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;                  <span class="keywordflow">if</span> (d2 &lt; min_d2) {</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;                    min_d2 = d2;</div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;                    pe = sprev;</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;                  }</div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;                }</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;              }</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;            }</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;</div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;            <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>-&gt;RemoveHitAt(j);</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;          }</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;        <span class="keywordflow">if</span> (pe) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;      }</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;    <span class="keywordflow">if</span> (pe)</div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;      assignments.emplace_back(hi, pe);</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;      mf::LogWarning(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Hit was not assigned to any element.&quot;</span>;</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;  }</div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;</div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code" href="../../d0/d8f/decode__signalprocess__icarus_8fcl.html#a2a105cb669129f9c63eb7a4c15bf2d9b">a</a> : assignments)</div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;    <a class="code" href="../../d0/d8f/decode__signalprocess__icarus_8fcl.html#a2a105cb669129f9c63eb7a4c15bf2d9b">a</a>.second-&gt;AddHit(<a class="code" href="../../d0/d8f/decode__signalprocess__icarus_8fcl.html#a2a105cb669129f9c63eb7a4c15bf2d9b">a</a>.first);</div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> : fNodes)</div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;    <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>-&gt;UpdateHitParams();</div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> : fSegments)</div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;    <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>-&gt;UpdateHitParams();</div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;}</div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l03150"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#abac8bf3e3f086346de03b9416f49f943"> 3150</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#abac8bf3e3f086346de03b9416f49f943">pma::Track3D::UpdateProjection</a>()</div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;{</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> : fNodes)</div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;    <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>-&gt;UpdateProjection();</div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> : fSegments)</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;    <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>-&gt;UpdateProjection();</div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;}</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;</div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;<span class="keywordtype">double</span></div>
<div class="line"><a name="l03159"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#aef4cccbe9bda3ffd6f07d89d3d01cc5b"> 3159</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#aef4cccbe9bda3ffd6f07d89d3d01cc5b">pma::Track3D::AverageDist2</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;  <span class="keywordtype">double</span> sum = 0.0;</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../db/df5/IntegerRanges__test_8cc.html#abbc7e5f346bfa932ca51b4b07ccef76d">count</a> = 0;</div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> : fNodes) {</div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;    sum += <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>-&gt;SumDist2();</div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;    count += <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a>-&gt;NEnabledHits();</div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;  }</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;</div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> : fSegments) {</div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;    sum += <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>-&gt;SumDist2();</div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;    count += <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>-&gt;NEnabledHits();</div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;  }</div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;  <span class="keywordflow">if</span> (count) { <span class="keywordflow">return</span> sum / <a class="code" href="../../db/df5/IntegerRanges__test_8cc.html#abbc7e5f346bfa932ca51b4b07ccef76d">count</a>; }</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;    mf::LogError(<span class="stringliteral">&quot;pma::Track3D&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;0 enabled hits in AverageDist2 calculation.&quot;</span>;</div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;  }</div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;}</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;</div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l03182"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#ae4d1a97fb871c2883ae51402a7f76b51"> 3182</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ae4d1a97fb871c2883ae51402a7f76b51">pma::Track3D::UpdateParams</a>()</div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;{</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">n</a> = <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">size</a>();</div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;  <span class="keywordflow">if</span> (n == 0) {</div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;    fPenaltyValue = 1;</div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;    fSegStopValue = 1;</div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;  }</div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;</div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;  <span class="keywordtype">float</span> nCubeRoot = pow((<span class="keywordtype">double</span>)n, 1.0 / 3.0);</div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;  <span class="keywordtype">float</span> avgDist2Root = sqrt(AverageDist2());</div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;  <span class="keywordflow">if</span> (avgDist2Root &gt; 0) {</div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;    fPenaltyValue = fPenaltyFactor * pow((<span class="keywordtype">double</span>)fSegments.size(), 1.8) * avgDist2Root /</div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;                    (fHitsRadius * nCubeRoot);</div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;    fSegStopValue = (int)(fSegStopFactor * nCubeRoot * fHitsRadius / avgDist2Root);</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;    <span class="keywordflow">if</span> (fSegStopValue &lt; fMinSegStop) fSegStopValue = fMinSegStop;</div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;  }</div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;    fPenaltyValue = 1;</div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;    fSegStopValue = 1;</div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;  }</div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;}</div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;</div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l03209"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#ae49013df6fb3ab3bb805ec28e8b450fb"> 3209</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ae49013df6fb3ab3bb805ec28e8b450fb">pma::Track3D::SwapVertices</a>(<span class="keywordtype">size_t</span> v0, <span class="keywordtype">size_t</span> v1)</div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;{</div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;  <span class="keywordflow">if</span> (v0 == v1) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;</div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;  <span class="keywordflow">if</span> (v0 &gt; v1) {</div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;    <span class="keywordtype">size_t</span> vx = v0;</div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;    v0 = v1;</div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;    v1 = vx;</div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;  }</div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;</div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;  <a class="code" href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a>* vtmp;</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;  <span class="keywordflow">if</span> (v1 - v0 == 1) {</div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;    <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* midSeg = NextSegment(fNodes[v0]);</div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;    <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* prevSeg = PrevSegment(fNodes[v0]);</div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;    <a class="code" href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a>* nextSeg = NextSegment(fNodes[v1]);</div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;</div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;    fNodes[v1]-&gt;RemoveNext(nextSeg);</div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;    midSeg-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a44bcf174aa7ead5e3fe41c9097b1a828">Disconnect</a>();</div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;</div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;    vtmp = fNodes[v0];</div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;    fNodes[v0] = fNodes[v1];</div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;    fNodes[v1] = vtmp;</div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;</div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;    <span class="keywordflow">if</span> (prevSeg) prevSeg-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a5f13409ee2a7deff853ec4bc919fe12e">AddNext</a>(fNodes[v0]);</div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;    fNodes[v0]-&gt;AddNext(midSeg);</div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;    midSeg-&gt;<a class="code" href="../../df/d44/classpma_1_1SortedObjectBase.html#a5f13409ee2a7deff853ec4bc919fe12e">AddNext</a>(fNodes[v1]);</div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;    <span class="keywordflow">if</span> (nextSeg) fNodes[v1]-&gt;AddNext(nextSeg);</div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;</div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;  }</div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;    vtmp = fNodes[v0];</div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;    fNodes[v0] = fNodes[v1];</div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;    fNodes[v1] = vtmp;</div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;  }</div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;}</div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;</div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l03248"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#abed580b812f0d4c9e9df91bd7fae7e4e"> 3248</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#abed580b812f0d4c9e9df91bd7fae7e4e">pma::Track3D::CheckEndSegment</a>(<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ae22793674e59927b9261f53332014891">pma::Track3D::ETrackEnd</a> endCode)</div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;{</div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v1, v2;</div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;  <span class="keywordflow">switch</span> (endCode) {</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ae22793674e59927b9261f53332014891a1cae3b3ee031fb0bc7e852b04fe6b9e1">pma::Track3D::kBegin</a>:</div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;    <span class="keywordflow">if</span> (fSegments.front()-&gt;IsFrozen()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;    <span class="keywordflow">if</span> (fNodes.front()-&gt;NextCount() &gt; 1) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;    v1 = 0;</div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;    v2 = 1;</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#ae22793674e59927b9261f53332014891aac2bd804cd68c9a674776905a09de97a">pma::Track3D::kEnd</a>:</div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;    <span class="keywordflow">if</span> (fSegments.back()-&gt;IsFrozen()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;    <span class="keywordflow">if</span> (fNodes.back()-&gt;NextCount() &gt; 1) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;    v1 = fNodes.size() - 1;</div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;    v2 = fNodes.size() - 2;</div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;  <span class="keywordflow">default</span>: <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;  }</div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;  <span class="keywordflow">if</span> (fNodes[v1]-&gt;<a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>() != fNodes[v2]-&gt;<a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a>()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;</div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;  <span class="keywordtype">double</span> g1, g0 = GetObjFunction();</div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;</div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;  <span class="keywordflow">if</span> (SwapVertices(v1, v2)) RebuildSegments();</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;  MakeProjection();</div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;  g1 = GetObjFunction();</div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;</div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;  <span class="keywordflow">if</span> (g1 &gt;= g0) {</div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;    <span class="keywordflow">if</span> (SwapVertices(v1, v2)) RebuildSegments();</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;    MakeProjection();</div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;  }</div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;}</div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;</div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l03284"></a><span class="lineno"><a class="line" href="../../d6/d8e/classpma_1_1Track3D.html#a280382fd48b925a54e6693dca11a7b97"> 3284</a></span>&#160;<a class="code" href="../../d6/d8e/classpma_1_1Track3D.html#a280382fd48b925a54e6693dca11a7b97">pma::Track3D::UpdateHitsRadius</a>()</div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;{</div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;  std::vector&lt;pma::Hit3D*&gt; hitsColl, hitsInd1, hitsInd2;</div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> : fHits) {</div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;View2D()) {</div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486a29e198ce46b2c8fc4a31422f42f77c64">geo::kZ</a>: hitsColl.push_back(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486aea23122caaaed75b787c745a188871f6">geo::kV</a>: hitsInd2.push_back(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486ae2842cacc3d7d281d01b4316380b8d5b">geo::kU</a>: hitsInd1.push_back(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;    }</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;  }</div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;  fHitsRadius = std::max({<a class="code" href="../../d8/d4a/namespacepma.html#aaef23eabe95250da3c2e6434fe4887e2">pma::GetHitsRadius2D</a>(hitsColl, <span class="keyword">true</span>),</div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;                          <a class="code" href="../../d8/d4a/namespacepma.html#aaef23eabe95250da3c2e6434fe4887e2">pma::GetHitsRadius2D</a>(hitsInd2, <span class="keyword">true</span>),</div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;                          <a class="code" href="../../d8/d4a/namespacepma.html#aaef23eabe95250da3c2e6434fe4887e2">pma::GetHitsRadius2D</a>(hitsInd1, <span class="keyword">true</span>)});</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;}</div>
<div class="ttc" id="classpma_1_1Track3D_html_a6aeea6b76f0be4ed9101fd90a91b264f"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a6aeea6b76f0be4ed9101fd90a91b264f">pma::Track3D::MakeProjection</a></div><div class="ttdeci">void MakeProjection()</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02952">PmaTrack3D.cxx:2952</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a6043faf9597d37bddad7860cef8a1219"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a6043faf9597d37bddad7860cef8a1219">pma::Track3D::SelectHits</a></div><div class="ttdeci">bool SelectHits(float fraction=1.0F)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02888">PmaTrack3D.cxx:2888</a></div></div>
<div class="ttc" id="classpma_1_1Node3D_html_af58e12d4349374fc924958c31bcd48d7"><div class="ttname"><a href="../../d3/dfc/classpma_1_1Node3D.html#af58e12d4349374fc924958c31bcd48d7">pma::Node3D::ApplyDriftShift</a></div><div class="ttdeci">void ApplyDriftShift(double dx)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/PmaNode3D_8h_source.html#l00138">PmaNode3D.h:138</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html">pma::Track3D</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/PmaTrack3D_8h_source.html#l00037">PmaTrack3D.h:37</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_ad2e2ce04eb39cad0ca47ef676306c1cb"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#ad2e2ce04eb39cad0ca47ef676306c1cb">pma::Track3D::AddHits</a></div><div class="ttdeci">void AddHits(detinfo::DetectorPropertiesData const &amp;detProp, const std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; &amp;hits)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00403">PmaTrack3D.cxx:403</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_af5881cf8e096f8ccfe1f307cfc0366e7"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#af5881cf8e096f8ccfe1f307cfc0366e7">pma::Track3D::MakeFastProjection</a></div><div class="ttdeci">void MakeFastProjection()</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02989">PmaTrack3D.cxx:2989</a></div></div>
<div class="ttc" id="run__opflash__electron_8fcl_html_ae40184b0245025a43c56daa3261d5e3c"><div class="ttname"><a href="../../d0/d84/run__opflash__electron_8fcl.html#ae40184b0245025a43c56daa3261d5e3c">z</a></div><div class="ttdeci">process_name opflash particleana ie ie ie z</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d84/run__opflash__electron_8fcl_source.html#l00092">run_opflash_electron.fcl:92</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a7d8189a5f23f9bc1c6cb87698708c978"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a7d8189a5f23f9bc1c6cb87698708c978">pma::Track3D::Track3D</a></div><div class="ttdeci">Track3D()</div></div>
<div class="ttc" id="classpma_1_1Node3D_html_a1b0c986525d9adf738d59c7942f2a506"><div class="ttname"><a href="../../d3/dfc/classpma_1_1Node3D.html#a1b0c986525d9adf738d59c7942f2a506">pma::Node3D::Point3D</a></div><div class="ttdeci">TVector3 const &amp; Point3D() const </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/PmaNode3D_8h_source.html#l00045">PmaNode3D.h:45</a></div></div>
<div class="ttc" id="namespacetca_html_a4f3087743ae6823cd5b6e9ff1a344843"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a4f3087743ae6823cd5b6e9ff1a344843">tca::Length</a></div><div class="ttdeci">float Length(const PFPStruct &amp;pfp)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l03303">PFPUtils.cxx:3303</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_ab80632e865e56cf31c7645543f5f6c83"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#ab80632e865e56cf31c7645543f5f6c83">pma::Track3D::AutoFlip</a></div><div class="ttdeci">void AutoFlip(pma::Track3D::EDirection dir, double thr=0.0, unsigned int n=0)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00672">PmaTrack3D.cxx:672</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a8b0b99c71acc3a2842bc5bd975035975"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a8b0b99c71acc3a2842bc5bd975035975">pma::Track3D::HasTPC</a></div><div class="ttdeci">bool HasTPC(int tpc) const </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/PmaTrack3D_8h_source.html#l00167">PmaTrack3D.h:167</a></div></div>
<div class="ttc" id="classpma_1_1SortedBranchBase_html_a1fb075f00b734019e664241fe1774db0"><div class="ttname"><a href="../../db/d5f/classpma_1_1SortedBranchBase.html#a1fb075f00b734019e664241fe1774db0">pma::SortedBranchBase::AddNext</a></div><div class="ttdeci">virtual bool AddNext(pma::SortedObjectBase *nextElement)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d2a/SortedObjects_8cxx_source.html#l00070">SortedObjects.cxx:70</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_ad29667659ab4c835d8b77ed476d4a282"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#ad29667659ab4c835d8b77ed476d4a282">pma::Track3D::GetMse</a></div><div class="ttdeci">double GetMse(unsigned int view=geo::kUnknown) const </div><div class="ttdoc">MSE of hits weighted with hit amplidudes and wire plane coefficients. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01837">PmaTrack3D.cxx:1837</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_ae22793674e59927b9261f53332014891a1cae3b3ee031fb0bc7e852b04fe6b9e1"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#ae22793674e59927b9261f53332014891a1cae3b3ee031fb0bc7e852b04fe6b9e1">pma::Track3D::kBegin</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/PmaTrack3D_8h_source.html#l00039">PmaTrack3D.h:39</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a30a23bf18b8eb72ee290c93d53e39b23"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a30a23bf18b8eb72ee290c93d53e39b23">pma::Track3D::SortHitsInTree</a></div><div class="ttdeci">void SortHitsInTree(bool skipFirst=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02225">PmaTrack3D.cxx:2225</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a3b9d7bcb3f95eadddfacc8044557b874"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a3b9d7bcb3f95eadddfacc8044557b874">pma::Track3D::AttachTo</a></div><div class="ttdeci">bool AttachTo(pma::Node3D *vStart, bool noFlip=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01544">PmaTrack3D.cxx:1544</a></div></div>
<div class="ttc" id="namespacepma_html_aaef23eabe95250da3c2e6434fe4887e2"><div class="ttname"><a href="../../d8/d4a/namespacepma.html#aaef23eabe95250da3c2e6434fe4887e2">pma::GetHitsRadius2D</a></div><div class="ttdeci">double GetHitsRadius2D(const std::vector&lt; pma::Hit3D * &gt; &amp;hits, bool exact=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d95/larreco_2larreco_2RecoAlg_2PMAlg_2Utilities_8cxx_source.html#l00098">larreco/larreco/RecoAlg/PMAlg/Utilities.cxx:98</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_ae84e246cdeaa38bbdd39eed91a8f339e"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#ae84e246cdeaa38bbdd39eed91a8f339e">pma::Track3D::fT0Flag</a></div><div class="ttdeci">bool fT0Flag</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/PmaTrack3D_8h_source.html#l00510">PmaTrack3D.h:510</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a159eb6a45d8f0b68345659ab60d2392d"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a159eb6a45d8f0b68345659ab60d2392d">pma::Track3D::~Track3D</a></div><div class="ttdeci">~Track3D()</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00063">PmaTrack3D.cxx:63</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a506e25c139891a49e29d88bab67f60c3"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a506e25c139891a49e29d88bab67f60c3">pma::Track3D::Dist2</a></div><div class="ttdeci">double Dist2(const TVector2 &amp;p2d, unsigned int view, unsigned int tpc, unsigned int cryo) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02575">PmaTrack3D.cxx:2575</a></div></div>
<div class="ttc" id="namespaceicarus_1_1waveform__operations_1_1details_html_ae295d3f6cb2f9181dccdf0e3492d44e0"><div class="ttname"><a href="../../d5/d45/namespaceicarus_1_1waveform__operations_1_1details.html#ae295d3f6cb2f9181dccdf0e3492d44e0">icarus::waveform_operations::details::transform</a></div><div class="ttdeci">static constexpr Sample_t transform(Sample_t sample)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d8e/WaveformOperations_8h_source.html#l00145">WaveformOperations.h:145</a></div></div>
<div class="ttc" id="sbnana_2sbnana_2CAFAna_2Analysis_2Surface_8cxx_html_a2c3bf28add4b70497e6fd9070cd7dfc9"><div class="ttname"><a href="../../d4/daf/sbnana_2sbnana_2CAFAna_2Analysis_2Surface_8cxx.html#a2c3bf28add4b70497e6fd9070cd7dfc9">F</a></div><div class="ttdeci">#define F(v)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daf/sbnana_2sbnana_2CAFAna_2Analysis_2Surface_8cxx_source.html#l00280">sbnana/sbnana/CAFAna/Analysis/Surface.cxx:280</a></div></div>
<div class="ttc" id="PmaTrack3D_8h_html"><div class="ttname"><a href="../../df/d67/PmaTrack3D_8h.html">PmaTrack3D.h</a></div><div class="ttdoc">Implementation of the Projection Matching Algorithm. </div></div>
<div class="ttc" id="classpma_1_1Track3D_html_ae22793674e59927b9261f53332014891"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#ae22793674e59927b9261f53332014891">pma::Track3D::ETrackEnd</a></div><div class="ttdeci">ETrackEnd</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/PmaTrack3D_8h_source.html#l00039">PmaTrack3D.h:39</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_aebacf4ea6bdd89c09f76276a0481edaf"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#aebacf4ea6bdd89c09f76276a0481edaf">pma::Track3D::IsAttachedTo</a></div><div class="ttdeci">bool IsAttachedTo(pma::Track3D const *trk) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01813">PmaTrack3D.cxx:1813</a></div></div>
<div class="ttc" id="run__opflash__electron_8fcl_html_a6673f03521899f7844189bcfd8ee5941"><div class="ttname"><a href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a></div><div class="ttdeci">process_name opflash particleana ie x</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d84/run__opflash__electron_8fcl_source.html#l00090">run_opflash_electron.fcl:90</a></div></div>
<div class="ttc" id="namespaceevgen_html_a354af7140af9e222ae73503ce23ad680"><div class="ttname"><a href="../../d4/d4d/namespaceevgen.html#a354af7140af9e222ae73503ce23ad680">evgen::fT0</a></div><div class="ttdeci">createEngine fT0</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/db7/GaisserParam__module_8cc_source.html#l00183">GaisserParam_module.cc:183</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_aa24c27416bcb2b7c95850af62bcfab68"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#aa24c27416bcb2b7c95850af62bcfab68">pma::Track3D::SelectAllHits</a></div><div class="ttdeci">bool SelectAllHits()</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02941">PmaTrack3D.cxx:2941</a></div></div>
<div class="ttc" id="classpma_1_1Hit3D_html_a8ae6c786ab52cfa3e1e1962c5fba06af"><div class="ttname"><a href="../../d5/d5f/classpma_1_1Hit3D.html#a8ae6c786ab52cfa3e1e1962c5fba06af">pma::Hit3D::fParent</a></div><div class="ttdeci">pma::Track3D * fParent</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dea/PmaHit3D_8h_source.html#l00199">PmaHit3D.h:199</a></div></div>
<div class="ttc" id="namespacepma_html_a6533238e57afc147ba9155b759521d20"><div class="ttname"><a href="../../d8/d4a/namespacepma.html#a6533238e57afc147ba9155b759521d20">pma::Dist2</a></div><div class="ttdeci">double Dist2(const TVector2 &amp;v1, const TVector2 &amp;v2)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d95/larreco_2larreco_2RecoAlg_2PMAlg_2Utilities_8cxx_source.html#l00037">larreco/larreco/RecoAlg/PMAlg/Utilities.cxx:37</a></div></div>
<div class="ttc" id="classdetinfo_1_1DetectorClocksData_html_a389055d7957e62c8d83b0ac23cb605b6"><div class="ttname"><a href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html#a389055d7957e62c8d83b0ac23cb605b6">detinfo::DetectorClocksData::TPCClock</a></div><div class="ttdeci">ElecClock const &amp; TPCClock() const noexcept</div><div class="ttdoc">Borrow a const TPC clock with time set to Trigger time [us]. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d5b/DetectorClocksData_8h_source.html#l00394">DetectorClocksData.h:394</a></div></div>
<div class="ttc" id="classpma_1_1Segment3D_html_a33aa4442b2453c85fe621734df1afa4b"><div class="ttname"><a href="../../d6/dd5/classpma_1_1Segment3D.html#a33aa4442b2453c85fe621734df1afa4b">pma::Segment3D::GetDistance2To</a></div><div class="ttdeci">double GetDistance2To(const TVector3 &amp;p3d) const override</div><div class="ttdoc">Distance [cm] from the 3D segment to the point 3D. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d04/PmaSegment3D_8cxx_source.html#l00028">PmaSegment3D.cxx:28</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_af6ca7ff5ce08fcc4334fece1b74e3e53"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#af6ca7ff5ce08fcc4334fece1b74e3e53">pma::Track3D::ClearNodes</a></div><div class="ttdeci">void ClearNodes()</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00113">PmaTrack3D.cxx:113</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a1a99bfa79d240ff8cfbc6e9fe74374b3"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a1a99bfa79d240ff8cfbc6e9fe74374b3">pma::Track3D::PrevHit</a></div><div class="ttdeci">int PrevHit(int index, unsigned int view=geo::kZ, bool inclDisabled=false) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00927">PmaTrack3D.cxx:927</a></div></div>
<div class="ttc" id="classdetinfo_1_1DetectorPropertiesData_html_adf888c29bd661e0b03973b96f03b9bd9"><div class="ttname"><a href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#adf888c29bd661e0b03973b96f03b9bd9">detinfo::DetectorPropertiesData::GetXTicksCoefficient</a></div><div class="ttdeci">double GetXTicksCoefficient(int t, int c) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d64/DetectorPropertiesData_8cc_source.html#l00160">DetectorPropertiesData.cc:160</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a30292e2ba0d04fa9fedd7ec4af2dd5b5"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a30292e2ba0d04fa9fedd7ec4af2dd5b5">pma::Track3D::Flip</a></div><div class="ttdeci">void Flip()</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00632">PmaTrack3D.cxx:632</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a02da2f970d3f7ad5a44dce1b235f8977"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a02da2f970d3f7ad5a44dce1b235f8977">pma::Track3D::ApplyDriftShiftInTree</a></div><div class="ttdeci">void ApplyDriftShiftInTree(const detinfo::DetectorClocksData &amp;clockData, detinfo::DetectorPropertiesData const &amp;detProp, double dx, bool skipFirst=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02333">PmaTrack3D.cxx:2333</a></div></div>
<div class="ttc" id="namespacegeo_html_aca2efd2e6b858cf0a9c12384c3b2f486aea23122caaaed75b787c745a188871f6"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486aea23122caaaed75b787c745a188871f6">geo::kV</a></div><div class="ttdoc">Planes which measure V. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00130">geo_types.h:130</a></div></div>
<div class="ttc" id="namespacegeo_html_aca2efd2e6b858cf0a9c12384c3b2f486ae329b0f520125896d02940bec370fca7"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486ae329b0f520125896d02940bec370fca7">geo::kUnknown</a></div><div class="ttdoc">Unknown view. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00136">geo_types.h:136</a></div></div>
<div class="ttc" id="classpma_1_1Hit3D_html_aaa10befa83bf11f7bb6a65541befd332"><div class="ttname"><a href="../../d5/d5f/classpma_1_1Hit3D.html#aaa10befa83bf11f7bb6a65541befd332">pma::Hit3D::PeakTime</a></div><div class="ttdeci">float PeakTime() const noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dea/PmaHit3D_8h_source.html#l00103">PmaHit3D.h:103</a></div></div>
<div class="ttc" id="classpma_1_1Node3D_html_ad62919a0303b7fd2e3d079812f24f2ab"><div class="ttname"><a href="../../d3/dfc/classpma_1_1Node3D.html#ad62919a0303b7fd2e3d079812f24f2ab">pma::Node3D::ClearAssigned</a></div><div class="ttdeci">void ClearAssigned(pma::Track3D *trk=0) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da8/PmaNode3D_8cxx_source.html#l00853">PmaNode3D.cxx:853</a></div></div>
<div class="ttc" id="classpma_1_1Element3D_html_a93b33366a51ccec00fbf3b3b13e01fb6"><div class="ttname"><a href="../../d0/dcf/classpma_1_1Element3D.html#a93b33366a51ccec00fbf3b3b13e01fb6">pma::Element3D::AddPoint</a></div><div class="ttdeci">void AddPoint(TVector3 *p)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dec/PmaElement3D_8h_source.html#l00080">PmaElement3D.h:80</a></div></div>
<div class="ttc" id="classpma_1_1SortedBranchBase_html_a2492c663412fe4592a19354826c33664"><div class="ttname"><a href="../../db/d5f/classpma_1_1SortedBranchBase.html#a2492c663412fe4592a19354826c33664">pma::SortedBranchBase::RemoveNext</a></div><div class="ttdeci">virtual int RemoveNext(pma::SortedObjectBase *nextElement)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d2a/SortedObjects_8cxx_source.html#l00106">SortedObjects.cxx:106</a></div></div>
<div class="ttc" id="classdetinfo_1_1DetectorPropertiesData_html"><div class="ttname"><a href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7a/DetectorPropertiesData_8h_source.html#l00011">DetectorPropertiesData.h:11</a></div></div>
<div class="ttc" id="PmaSegment3D_8h_html"><div class="ttname"><a href="../../d2/d22/PmaSegment3D_8h.html">PmaSegment3D.h</a></div><div class="ttdoc">Implementation of the Projection Matching Algorithm. </div></div>
<div class="ttc" id="classpma_1_1Track3D_html_aa647dbb3591dbb9d3b4f015f25bf7760"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#aa647dbb3591dbb9d3b4f015f25bf7760">pma::Track3D::TestHits</a></div><div class="ttdeci">unsigned int TestHits(detinfo::DetectorPropertiesData const &amp;detProp, const std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; &amp;hits, double dist=0.4) const </div><div class="ttdoc">Count close 2D hits. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00858">PmaTrack3D.cxx:858</a></div></div>
<div class="ttc" id="namespacelar_1_1fhicl_1_1geo_html_aff5db21a0b87718dbf7debb3cd62dbd0"><div class="ttname"><a href="../../d1/d4e/namespacelar_1_1fhicl_1_1geo.html#aff5db21a0b87718dbf7debb3cd62dbd0">lar::fhicl::geo::Point3D</a></div><div class="ttdeci">::fhicl::TupleAs&lt; Point(::geo::Length_t,::geo::Length_t,::geo::Length_t)&gt; Point3D</div><div class="ttdoc">Atom object for reading a 3D point or vector (centimeters). </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0b/geo__vectors__fhicl_8h_source.html#l00038">geo_vectors_fhicl.h:38</a></div></div>
<div class="ttc" id="selectors_8fcl_html_a24c8335057af14a9b508d5ac18999ce5"><div class="ttname"><a href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a></div><div class="ttdeci">pdgs p</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd2/selectors_8fcl_source.html#l00022">selectors.fcl:22</a></div></div>
<div class="ttc" id="opt0finder__sbnd_8fcl_html_aaaa93cd86c9f63d1f138578f4d28c1c0"><div class="ttname"><a href="../../db/d23/opt0finder__sbnd_8fcl.html#aaaa93cd86c9f63d1f138578f4d28c1c0">TPCs</a></div><div class="ttdeci">BEGIN_PROLOG opflashtpc1 TPCs</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d23/opt0finder__sbnd_8fcl_source.html#l00009">opt0finder_sbnd.fcl:9</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html">geo::TPCGeo</a></div><div class="ttdoc">Geometry information for a single TPC. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00038">TPCGeo.h:38</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a16384141e11a2a7f3cd6c0c91f7b887c"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a16384141e11a2a7f3cd6c0c91f7b887c">pma::Track3D::ReassignHitsInTree</a></div><div class="ttdeci">void ReassignHitsInTree(pma::Track3D *plRoot=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02149">PmaTrack3D.cxx:2149</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a1ebcf6ec250cd859b1f577dd6245c328"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a1ebcf6ec250cd859b1f577dd6245c328">pma::Track3D::index_of</a></div><div class="ttdeci">int index_of(const pma::Hit3D *hit) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00335">PmaTrack3D.cxx:335</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a90f8b897da30b12f54b974020d52e9f3"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a90f8b897da30b12f54b974020d52e9f3">pma::Track3D::RebuildSegments</a></div><div class="ttdeci">void RebuildSegments()</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02426">PmaTrack3D.cxx:2426</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_add5c67561c87d89dd05fc217036836f9"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#add5c67561c87d89dd05fc217036836f9">pma::Track3D::AttachBackToSameTPC</a></div><div class="ttdeci">bool AttachBackToSameTPC(pma::Node3D *vStart)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01702">PmaTrack3D.cxx:1702</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a1d5f036e74692df5fe88a1434eb01ef9"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a1d5f036e74692df5fe88a1434eb01ef9">pma::Track3D::GetBranches</a></div><div class="ttdeci">bool GetBranches(std::vector&lt; pma::Track3D const * &gt; &amp;branches, bool skipFirst=false) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01793">PmaTrack3D.cxx:1793</a></div></div>
<div class="ttc" id="classpma_1_1SortedBranchBase_html_a758a2fc0443e4b721c84a70f9a424878"><div class="ttname"><a href="../../db/d5f/classpma_1_1SortedBranchBase.html#a758a2fc0443e4b721c84a70f9a424878">pma::SortedBranchBase::NextCount</a></div><div class="ttdeci">virtual unsigned int NextCount(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d13/SortedObjects_8h_source.html#l00084">SortedObjects.h:84</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a23593e0e21f26acc62eeaeba7f56cfe7"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a23593e0e21f26acc62eeaeba7f56cfe7">pma::Track3D::AttachToOtherTPC</a></div><div class="ttdeci">bool AttachToOtherTPC(pma::Node3D *vStart)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01584">PmaTrack3D.cxx:1584</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_abed580b812f0d4c9e9df91bd7fae7e4e"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#abed580b812f0d4c9e9df91bd7fae7e4e">pma::Track3D::CheckEndSegment</a></div><div class="ttdeci">bool CheckEndSegment(pma::Track3D::ETrackEnd endCode)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l03248">PmaTrack3D.cxx:3248</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a835316cee2286ca4f8b7e2201ca3e945"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a835316cee2286ca4f8b7e2201ca3e945">pma::Track3D::InitFromHits</a></div><div class="ttdeci">bool InitFromHits(detinfo::DetectorPropertiesData const &amp;detProp, int tpc, int cryo, float initEndSegW=0.05F)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00121">PmaTrack3D.cxx:121</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a53af9d408564ba26f2367c85f5afca51"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a53af9d408564ba26f2367c85f5afca51">pma::Track3D::GetObjFunction</a></div><div class="ttdeci">double GetObjFunction(float penaltyFactor=1.0F) const </div><div class="ttdoc">Objective function optimized in track reconstruction. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01857">PmaTrack3D.cxx:1857</a></div></div>
<div class="ttc" id="classdetinfo_1_1DetectorClocksData_html_add8243f0f26e55d68bdfe3b36545994f"><div class="ttname"><a href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html#add8243f0f26e55d68bdfe3b36545994f">detinfo::DetectorClocksData::TriggerOffsetTPC</a></div><div class="ttdeci">double TriggerOffsetTPC() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d5b/DetectorClocksData_8h_source.html#l00350">DetectorClocksData.h:350</a></div></div>
<div class="ttc" id="classpma_1_1Hit3D_html_ac3fbfcb7dedfe1063f001c832bc64998"><div class="ttname"><a href="../../d5/d5f/classpma_1_1Hit3D.html#ac3fbfcb7dedfe1063f001c832bc64998">pma::Hit3D::Point3D</a></div><div class="ttdeci">TVector3 const &amp; Point3D() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dea/PmaHit3D_8h_source.html#l00055">PmaHit3D.h:55</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a994fecd95666f46cf371ecafa003fe20"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a994fecd95666f46cf371ecafa003fe20">pma::Track3D::Initialize</a></div><div class="ttdeci">bool Initialize(detinfo::DetectorPropertiesData const &amp;detProp, float initEndSegW=0.05F)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00077">PmaTrack3D.cxx:77</a></div></div>
<div class="ttc" id="namespaceicarus_1_1ns_1_1util_html_aaae74cf315284bc0f44c2e050c119781"><div class="ttname"><a href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aaae74cf315284bc0f44c2e050c119781">icarus::ns::util::size</a></div><div class="ttdeci">std::size_t size(FixedBins&lt; T, C &gt; const &amp;) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dbd/FixedBins_8h_source.html#l00561">FixedBins.h:561</a></div></div>
<div class="ttc" id="classpma_1_1Node3D_html_acace42bb146c559b533a5e282e9748c4"><div class="ttname"><a href="../../d3/dfc/classpma_1_1Node3D.html#acace42bb146c559b533a5e282e9748c4">pma::Node3D::Optimize</a></div><div class="ttdeci">void Optimize(float penaltyValue, float endSegWeight)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da8/PmaNode3D_8cxx_source.html#l00843">PmaNode3D.cxx:843</a></div></div>
<div class="ttc" id="namespacegeo_html_aca2efd2e6b858cf0a9c12384c3b2f486a29e198ce46b2c8fc4a31422f42f77c64"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486a29e198ce46b2c8fc4a31422f42f77c64">geo::kZ</a></div><div class="ttdoc">Planes which measure Z direction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00132">geo_types.h:132</a></div></div>
<div class="ttc" id="namespacepma_html_ac06691f19da7b76a3a27c7287e3b2ff1"><div class="ttname"><a href="../../d8/d4a/namespacepma.html#ac06691f19da7b76a3a27c7287e3b2ff1">pma::WireDriftToCm</a></div><div class="ttdeci">TVector2 WireDriftToCm(detinfo::DetectorPropertiesData const &amp;detProp, unsigned int wire, float drift, unsigned int plane, unsigned int tpc, unsigned int cryo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d95/larreco_2larreco_2RecoAlg_2PMAlg_2Utilities_8cxx_source.html#l00294">larreco/larreco/RecoAlg/PMAlg/Utilities.cxx:294</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a654256f331ce57a9579086acae964efd"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a654256f331ce57a9579086acae964efd">pma::Track3D::TPCs</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; TPCs() const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00452">PmaTrack3D.cxx:452</a></div></div>
<div class="ttc" id="classpma_1_1Element3D_html"><div class="ttname"><a href="../../d0/dcf/classpma_1_1Element3D.html">pma::Element3D</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dec/PmaElement3D_8h_source.html#l00030">PmaElement3D.h:30</a></div></div>
<div class="ttc" id="classpma_1_1Segment3D_html"><div class="ttname"><a href="../../d6/dd5/classpma_1_1Segment3D.html">pma::Segment3D</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d22/PmaSegment3D_8h_source.html#l00028">PmaSegment3D.h:28</a></div></div>
<div class="ttc" id="cheaterreco_8fcl_html_abf2e819dbf4c327e098bebd4b2dc0597"><div class="ttname"><a href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a></div><div class="ttdeci">process_name hit</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d36/cheaterreco_8fcl_source.html#l00051">cheaterreco.fcl:51</a></div></div>
<div class="ttc" id="find__global__symbol_8sh_html_ae2fcd9af85e9525dadab1ac2cb45a22d"><div class="ttname"><a href="../../d5/df9/find__global__symbol_8sh.html#ae2fcd9af85e9525dadab1ac2cb45a22d">X</a></div><div class="ttdeci">then echo echo For and will not be changed by echo further linking echo echo B echo The symbol is in the uninitialized data multiple common symbols may appear with the echo same name If the symbol is defined the common echo symbols are treated as undefined references For more echo details on common see the discussion of warn common echo in *Note Linker see the discussion of warn common echo in *Note Linker such as a global int variable echo as opposed to a large global array echo echo I echo The symbol is an indirect reference to another symbol This echo is a GNU extension to the a out object file format which is echo rarely used echo echo N echo The symbol is a debugging symbol echo echo R echo The symbol is in a read only data section echo echo S echo The symbol is in an uninitialized data section for small echo objects echo echo T echo The symbol is in the the normal defined echo symbol is used with no error When a weak undefined symbol echo is linked and the symbol is not the value of the echo weak symbol becomes zero with no error echo echo W echo The symbol is a weak symbol that has not been specifically echo tagged as a weak object symbol When a weak defined symbol echo is linked with a normal defined the normal defined echo symbol is used with no error When a weak undefined symbol echo is linked and the symbol is not the value of the echo weak symbol becomes zero with no error echo echo echo The symbol is a stabs symbol in an a out object file In echo this the next values printed are the stabs other echo the stabs desc and the stab type Stabs symbols are echo used to hold debugging information For more echo see *Note or object file format specific echo echo For Mac OS X</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/df9/find__global__symbol_8sh_source.html#l00107">find_global_symbol.sh:107</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a5e9e3b6d7263bc159be22ad793a33099"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a5e9e3b6d7263bc159be22ad793a33099">pma::Track3D::AttachBackToOtherTPC</a></div><div class="ttdeci">bool AttachBackToOtherTPC(pma::Node3D *vStart)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01687">PmaTrack3D.cxx:1687</a></div></div>
<div class="ttc" id="decoderTools__icarus_8fcl_html_a86703f8a44dd6742852257943d5a25c6"><div class="ttname"><a href="../../d5/d79/decoderTools__icarus_8fcl.html#a86703f8a44dd6742852257943d5a25c6">g</a></div><div class="ttdeci">BEGIN_PROLOG g</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d79/decoderTools__icarus_8fcl_source.html#l00007">decoderTools_icarus.fcl:7</a></div></div>
<div class="ttc" id="fcl__checks_8sh_html_ab3c44a76dd678c93affe68a1f8a980ab"><div class="ttname"><a href="../../db/ddd/fcl__checks_8sh.html#ab3c44a76dd678c93affe68a1f8a980ab">shift</a></div><div class="ttdeci">shift</div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddd/fcl__checks_8sh_source.html#l00026">fcl_checks.sh:26</a></div></div>
<div class="ttc" id="namespacepma_html_a3770c6a1a7dc99a26ddab01e5cec6cf5"><div class="ttname"><a href="../../d8/d4a/namespacepma.html#a3770c6a1a7dc99a26ddab01e5cec6cf5">pma::Vector3D</a></div><div class="ttdeci">recob::tracking::Vector_t Vector3D</div><div class="ttdef"><b>Definition:</b> <a href="../../de/de4/larreco_2larreco_2RecoAlg_2PMAlg_2Utilities_8h_source.html#l00031">larreco/larreco/RecoAlg/PMAlg/Utilities.h:31</a></div></div>
<div class="ttc" id="namespacegen__crt__frags_html_a55a56854d78e363691470c7297fde77c"><div class="ttname"><a href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">gen_crt_frags.m</a></div><div class="ttdeci">tuple m</div><div class="ttdoc">now if test mode generate materials, CRT shell, world, gdml header else just generate CRT shell for u...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d8c/gen__crt__frags_8py_source.html#l01347">gen_crt_frags.py:1347</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a5cd3fe36995a6f5d022437b7fc53fc0e"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a5cd3fe36995a6f5d022437b7fc53fc0e">pma::Track3D::TuneFullTree</a></div><div class="ttdeci">double TuneFullTree(double eps=0.001, double gmax=50.0)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02278">PmaTrack3D.cxx:2278</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_adc4aeb1524832cdc48e6f43dbfed5f55"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#adc4aeb1524832cdc48e6f43dbfed5f55">pma::Track3D::GetDirection3D</a></div><div class="ttdeci">pma::Vector3D GetDirection3D(size_t index) const </div><div class="ttdoc">Get trajectory direction at given hit index. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00378">PmaTrack3D.cxx:378</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_ac9d585195653d02380cd7cf59c77904a"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#ac9d585195653d02380cd7cf59c77904a">pma::Track3D::Optimize</a></div><div class="ttdeci">double Optimize(const detinfo::DetectorPropertiesData &amp;detProp, int nNodes=-1, double eps=0.01, bool selAllHits=true, bool setAllNodes=true, size_t selSegHits=0, size_t selVtxHits=0)</div><div class="ttdoc">Main optimization method. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01868">PmaTrack3D.cxx:1868</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_aa90896eda86a4722e81928a53751593f"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#aa90896eda86a4722e81928a53751593f">pma::Track3D::TuneSinglePass</a></div><div class="ttdeci">double TuneSinglePass(bool skipFirst=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02041">PmaTrack3D.cxx:2041</a></div></div>
<div class="ttc" id="sbnd__flashalgo_8fcl_html_a648c7afac4085c93cd1ba4a75dfe8818"><div class="ttname"><a href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a></div><div class="ttdeci">BEGIN_PROLOG TPC</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d22/sbnd__flashalgo_8fcl_source.html#l00014">sbnd_flashalgo.fcl:14</a></div></div>
<div class="ttc" id="structpma_1_1bTrajectory3DDistLess_html"><div class="ttname"><a href="../../df/d56/structpma_1_1bTrajectory3DDistLess.html">pma::bTrajectory3DDistLess</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/de4/larreco_2larreco_2RecoAlg_2PMAlg_2Utilities_8h_source.html#l00100">larreco/larreco/RecoAlg/PMAlg/Utilities.h:100</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a60281b4c714aa99c93773f3608cadc13"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a60281b4c714aa99c93773f3608cadc13">pma::Track3D::NEnabledHits</a></div><div class="ttdeci">unsigned int NEnabledHits(unsigned int view=geo::kUnknown) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00432">PmaTrack3D.cxx:432</a></div></div>
<div class="ttc" id="decode__signalprocess__icarus_8fcl_html_a2a105cb669129f9c63eb7a4c15bf2d9b"><div class="ttname"><a href="../../d0/d8f/decode__signalprocess__icarus_8fcl.html#a2a105cb669129f9c63eb7a4c15bf2d9b">a</a></div><div class="ttdeci">process_name gaushit a</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8f/decode__signalprocess__icarus_8fcl_source.html#l00037">decode_signalprocess_icarus.fcl:37</a></div></div>
<div class="ttc" id="classpma_1_1Element3D_html_a0e4d7a26f6bac4987353833d21097993"><div class="ttname"><a href="../../d0/dcf/classpma_1_1Element3D.html#a0e4d7a26f6bac4987353833d21097993">pma::Element3D::TPC</a></div><div class="ttdeci">int TPC(void) const </div><div class="ttdoc">TPC index or -1 if out of any TPC. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dec/PmaElement3D_8h_source.html#l00034">PmaElement3D.h:34</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a4fa852d2bb7eb83f6d96c0f00da3d518"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a4fa852d2bb7eb83f6d96c0f00da3d518">pma::Track3D::Cryos</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; Cryos() const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00471">PmaTrack3D.cxx:471</a></div></div>
<div class="ttc" id="classdetinfo_1_1ElecClock_html_affdf2e345f26f00dc1ca4b144158b90c"><div class="ttname"><a href="../../d0/d00/classdetinfo_1_1ElecClock.html#affdf2e345f26f00dc1ca4b144158b90c">detinfo::ElecClock::TickPeriod</a></div><div class="ttdeci">constexpr double TickPeriod() const noexcept</div><div class="ttdoc">A single tick period in microseconds. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d60/ElecClock_8h_source.html#l00352">ElecClock.h:352</a></div></div>
<div class="ttc" id="getStatistics_8sh_html_a04d4c2131ccb24cc78386597e8a21c5b"><div class="ttname"><a href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a></div><div class="ttdeci">while getopts h</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/de2/getStatistics_8sh_source.html#l00013">getStatistics.sh:13</a></div></div>
<div class="ttc" id="DetectorPropertiesService_8h_html"><div class="ttname"><a href="../../de/df8/DetectorPropertiesService_8h.html">DetectorPropertiesService.h</a></div></div>
<div class="ttc" id="namespacelar_1_1dump_html_a71d4403edbac4d265176f8677118194f"><div class="ttname"><a href="../../db/dfa/namespacelar_1_1dump.html#a71d4403edbac4d265176f8677118194f">lar::dump::vector</a></div><div class="ttdeci">auto vector(Vector const &amp;v)</div><div class="ttdoc">Returns a manipulator which will print the specified array. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da9/DumpUtils_8h_source.html#l00265">DumpUtils.h:265</a></div></div>
<div class="ttc" id="namespacemake__calib__df_html_a2b8237bac57d5c373c623869ad4513c8"><div class="ttname"><a href="../../d6/d11/namespacemake__calib__df.html#a2b8237bac57d5c373c623869ad4513c8">make_calib_df.t0</a></div><div class="ttdeci">int t0</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d0e/make__calib__df_8py_source.html#l00042">make_calib_df.py:42</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_aab8302ffd36cff08d508bbae460f9254"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#aab8302ffd36cff08d508bbae460f9254">pma::Track3D::Split</a></div><div class="ttdeci">pma::Track3D * Split(detinfo::DetectorPropertiesData const &amp;detProp, size_t idx, bool try_start_at_idx=true)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01455">PmaTrack3D.cxx:1455</a></div></div>
<div class="ttc" id="sparse__vector__test_8cc_html_a39f16bf854ba527dee7eba5bbbd93f3f"><div class="ttname"><a href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a></div><div class="ttdeci">T abs(T value)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d59/sparse__vector__test_8cc_source.html#l00030">sparse_vector_test.cc:30</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_ac6e6d5433e77f3aa7d2ed75d2357d337"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#ac6e6d5433e77f3aa7d2ed75d2357d337">pma::Track3D::TestHitsMse</a></div><div class="ttdeci">double TestHitsMse(detinfo::DetectorPropertiesData const &amp;detProp, const std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; &amp;hits, bool normalized=true) const </div><div class="ttdoc">MSE of 2D hits. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00832">PmaTrack3D.cxx:832</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_ad5292138531640a408421e7f93aab26f"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#ad5292138531640a408421e7f93aab26f">pma::Track3D::UpdateParamsInTree</a></div><div class="ttdeci">bool UpdateParamsInTree(bool skipFirst, size_t &amp;depth)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02002">PmaTrack3D.cxx:2002</a></div></div>
<div class="ttc" id="selectors_8fcl_html_a2602587bf9a1efd1e11d4fdeb2da110a"><div class="ttname"><a href="../../d9/dd2/selectors_8fcl.html#a2602587bf9a1efd1e11d4fdeb2da110a">front</a></div><div class="ttdeci">walls no front</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd2/selectors_8fcl_source.html#l00105">selectors.fcl:105</a></div></div>
<div class="ttc" id="namespacegeo_html_aca2efd2e6b858cf0a9c12384c3b2f486ae2842cacc3d7d281d01b4316380b8d5b"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#aca2efd2e6b858cf0a9c12384c3b2f486ae2842cacc3d7d281d01b4316380b8d5b">geo::kU</a></div><div class="ttdoc">Planes which measure U. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00129">geo_types.h:129</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a952f9da40b18b2a95d0da005d22c117b"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a952f9da40b18b2a95d0da005d22c117b">pma::Track3D::CanFlip</a></div><div class="ttdeci">bool CanFlip() const </div><div class="ttdoc">Check if the track can be flipped without breaking any other track. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00653">PmaTrack3D.cxx:653</a></div></div>
<div class="ttc" id="classpma_1_1Element3D_html_a8361c65046325e46d4f2cc4f72db23e4"><div class="ttname"><a href="../../d0/dcf/classpma_1_1Element3D.html#a8361c65046325e46d4f2cc4f72db23e4">pma::Element3D::NPoints</a></div><div class="ttdeci">size_t NPoints(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dec/PmaElement3D_8h_source.html#l00079">PmaElement3D.h:79</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a5f2ae3ecdfdcd6327ac0047b5e07c4a3"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a5f2ae3ecdfdcd6327ac0047b5e07c4a3">pma::Track3D::ExtendWith</a></div><div class="ttdeci">void ExtendWith(pma::Track3D *src)</div><div class="ttdoc">Extend the track with everything from src, delete the src;. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01745">PmaTrack3D.cxx:1745</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a48acf1401880b32e71d59b6cd674b83d"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a48acf1401880b32e71d59b6cd674b83d">pma::Track3D::AddNode</a></div><div class="ttdeci">void AddNode(pma::Node3D *node)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01264">PmaTrack3D.cxx:1264</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a5c89f8f5decd2a9873956d225f9cee6f"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a5c89f8f5decd2a9873956d225f9cee6f">pma::Track3D::release_at</a></div><div class="ttdeci">pma::Hit3D * release_at(size_t index)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00343">PmaTrack3D.cxx:343</a></div></div>
<div class="ttc" id="namespacegeo_1_1vect_html_a2b86f9ce3fb9b46f603782288e918bdf"><div class="ttname"><a href="../../d0/d8e/namespacegeo_1_1vect.html#a2b86f9ce3fb9b46f603782288e918bdf">geo::vect::isfinite</a></div><div class="ttdeci">bool isfinite(Vector const &amp;v)</div><div class="ttdoc">Returns whether all components of the vector are finite. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d6c/geo__vectors__utils_8h_source.html#l02135">geo_vectors_utils.h:2135</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a406e522e831ec16eb527f4057e0dc216"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a406e522e831ec16eb527f4057e0dc216">pma::Track3D::NHits</a></div><div class="ttdeci">unsigned int NHits(unsigned int view) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00422">PmaTrack3D.cxx:422</a></div></div>
<div class="ttc" id="run__opflash__electron_8fcl_html_a1e5aaaf25e8609a835e8c7c6fda71456"><div class="ttname"><a href="../../d0/d84/run__opflash__electron_8fcl.html#a1e5aaaf25e8609a835e8c7c6fda71456">y</a></div><div class="ttdeci">process_name opflash particleana ie ie y</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d84/run__opflash__electron_8fcl_source.html#l00091">run_opflash_electron.fcl:91</a></div></div>
<div class="ttc" id="classpma_1_1Element3D_html_afb0a4d564bbc8fa37963d266d389797b"><div class="ttname"><a href="../../d0/dcf/classpma_1_1Element3D.html#afb0a4d564bbc8fa37963d266d389797b">pma::Element3D::GetDistance2To</a></div><div class="ttdeci">virtual double GetDistance2To(const TVector3 &amp;p3d) const =0</div><div class="ttdoc">Distance [cm] from the 3D point to the object 3D. </div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a70b3858c5fa7121682902b4f208ae6ab"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a70b3858c5fa7121682902b4f208ae6ab">pma::Track3D::GetRoot</a></div><div class="ttdeci">pma::Track3D * GetRoot()</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01777">PmaTrack3D.cxx:1777</a></div></div>
<div class="ttc" id="classpma_1_1SortedObjectBase_html_ad38e1edbd1c79e633fb7c4a20ffa3a54"><div class="ttname"><a href="../../df/d44/classpma_1_1SortedObjectBase.html#ad38e1edbd1c79e633fb7c4a20ffa3a54">pma::SortedObjectBase::RemoveNext</a></div><div class="ttdeci">virtual int RemoveNext(pma::SortedObjectBase *nextElement)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d2a/SortedObjects_8cxx_source.html#l00046">SortedObjects.cxx:46</a></div></div>
<div class="ttc" id="classpma_1_1Hit3D_html_a17c7e679774a3b252e1fe31290d9f9ba"><div class="ttname"><a href="../../d5/d5f/classpma_1_1Hit3D.html#a17c7e679774a3b252e1fe31290d9f9ba">pma::Hit3D::View2D</a></div><div class="ttdeci">unsigned int View2D() const noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dea/PmaHit3D_8h_source.html#l00093">PmaHit3D.h:93</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a96d7f563c77db26789ed457ed306aee8"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a96d7f563c77db26789ed457ed306aee8">pma::Track3D::fT0</a></div><div class="ttdeci">double fT0</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/PmaTrack3D_8h_source.html#l00509">PmaTrack3D.h:509</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_ae22793674e59927b9261f53332014891aac2bd804cd68c9a674776905a09de97a"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#ae22793674e59927b9261f53332014891aac2bd804cd68c9a674776905a09de97a">pma::Track3D::kEnd</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/PmaTrack3D_8h_source.html#l00039">PmaTrack3D.h:39</a></div></div>
<div class="ttc" id="classpma_1_1Segment3D_html_a221efc5507cbd810dfb18f944163b111"><div class="ttname"><a href="../../d6/dd5/classpma_1_1Segment3D.html#a221efc5507cbd810dfb18f944163b111">pma::Segment3D::SetProjection</a></div><div class="ttdeci">void SetProjection(pma::Hit3D &amp;h) const override</div><div class="ttdoc">Set hit 3D position and its 2D projection to the vertex. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d04/PmaSegment3D_8cxx_source.html#l00153">PmaSegment3D.cxx:153</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_acd4ed93e64df733122b3072ffcd4f458"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#acd4ed93e64df733122b3072ffcd4f458">pma::Track3D::GetUnconstrainedProj3D</a></div><div class="ttdeci">bool GetUnconstrainedProj3D(detinfo::DetectorPropertiesData const &amp;detProp, art::Ptr&lt; recob::Hit &gt; hit, TVector3 &amp;p3d, double &amp;dist2) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02674">PmaTrack3D.cxx:2674</a></div></div>
<div class="ttc" id="classpma_1_1Hit3D_html_aa598af0b3191db78c37f98fc99e5bb0e"><div class="ttname"><a href="../../d5/d5f/classpma_1_1Hit3D.html#aa598af0b3191db78c37f98fc99e5bb0e">pma::Hit3D::TPC</a></div><div class="ttdeci">unsigned int TPC() const noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dea/PmaHit3D_8h_source.html#l00088">PmaHit3D.h:88</a></div></div>
<div class="ttc" id="classpma_1_1Node3D_html_abdcc4de592387b4625a6f7fba30c3fc5"><div class="ttname"><a href="../../d3/dfc/classpma_1_1Node3D.html#abdcc4de592387b4625a6f7fba30c3fc5">pma::Node3D::GetDriftShift</a></div><div class="ttdeci">double GetDriftShift() const </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/PmaNode3D_8h_source.html#l00144">PmaNode3D.h:144</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_aa5a5d450a0cdc2394aa19ec04b14a527"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#aa5a5d450a0cdc2394aa19ec04b14a527">pma::Track3D::HasRefPoint</a></div><div class="ttdeci">bool HasRefPoint(TVector3 *p) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01829">PmaTrack3D.cxx:1829</a></div></div>
<div class="ttc" id="namespaceicarus_1_1ns_1_1util_html_aac918da84f16d53ad17bab4f817da1c4"><div class="ttname"><a href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">icarus::ns::util::end</a></div><div class="ttdeci">auto end(FixedBins&lt; T, C &gt; const &amp;) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dbd/FixedBins_8h_source.html#l00585">FixedBins.h:585</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a07b802dc845765de7edf0ecec48a3fe3"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a07b802dc845765de7edf0ecec48a3fe3">pma::Track3D::InitFromRefPoints</a></div><div class="ttdeci">bool InitFromRefPoints(detinfo::DetectorPropertiesData const &amp;detProp, int tpc, int cryo)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00211">PmaTrack3D.cxx:211</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_ae82f448cd9326d24a59e18383b7b7a85"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#ae82f448cd9326d24a59e18383b7b7a85">pma::Track3D::DriftsOfWireIntersection</a></div><div class="ttdeci">std::vector&lt; float &gt; DriftsOfWireIntersection(detinfo::DetectorPropertiesData const &amp;detProp, unsigned int wire, unsigned int view) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01160">PmaTrack3D.cxx:1160</a></div></div>
<div class="ttc" id="classpma_1_1Node3D_html_a66a88d156275f1389b1fa81f552c6e2d"><div class="ttname"><a href="../../d3/dfc/classpma_1_1Node3D.html#a66a88d156275f1389b1fa81f552c6e2d">pma::Node3D::SetPoint3D</a></div><div class="ttdeci">bool SetPoint3D(const TVector3 &amp;p3d)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da8/PmaNode3D_8cxx_source.html#l00167">PmaNode3D.cxx:167</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a6f10a9c69a25e9c2b1f7c274a8cf1559"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a6f10a9c69a25e9c2b1f7c274a8cf1559">pma::Track3D::SetT0FromDx</a></div><div class="ttdeci">void SetT0FromDx(const detinfo::DetectorClocksData &amp;clockData, detinfo::DetectorPropertiesData const &amp;detProp, double dx)</div><div class="ttdoc">Function to convert dx into dT0. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02376">PmaTrack3D.cxx:2376</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a7768f0469586655a68c9814621c37477"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a7768f0469586655a68c9814621c37477">pma::Track3D::fTag</a></div><div class="ttdeci">ETag fTag</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/PmaTrack3D_8h_source.html#l00512">PmaTrack3D.h:512</a></div></div>
<div class="ttc" id="classpma_1_1Element3D_html_a16bed58584a1f876c7e7418dd6845a56"><div class="ttname"><a href="../../d0/dcf/classpma_1_1Element3D.html#a16bed58584a1f876c7e7418dd6845a56">pma::Element3D::Hit</a></div><div class="ttdeci">pma::Hit3D &amp; Hit(size_t index)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dec/PmaElement3D_8h_source.html#l00062">PmaElement3D.h:62</a></div></div>
<div class="ttc" id="classpma_1_1Hit3D_html_a082de271e852f62f4f7809f93c83edf4"><div class="ttname"><a href="../../d5/d5f/classpma_1_1Hit3D.html#a082de271e852f62f4f7809f93c83edf4">pma::Hit3D::SetEnabled</a></div><div class="ttdeci">void SetEnabled(bool state) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dea/PmaHit3D_8h_source.html#l00166">PmaHit3D.h:166</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_ad8a3bf5b35a8e37f4b0ef8463e3fec7f"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#ad8a3bf5b35a8e37f4b0ef8463e3fec7f">pma::Track3D::RemoveHits</a></div><div class="ttdeci">void RemoveHits(const std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; &amp;hits)</div><div class="ttdoc">Remove hits; removes also hit-&amp;gt;node/seg assignments. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00412">PmaTrack3D.cxx:412</a></div></div>
<div class="ttc" id="PCAnglePlaneMaker__module_8cc_html_a87218e5b4cafa52fddfafeb4d9ce0be3"><div class="ttname"><a href="../../d2/d40/PCAnglePlaneMaker__module_8cc.html#a87218e5b4cafa52fddfafeb4d9ce0be3">SortHits</a></div><div class="ttdeci">std::array&lt; std::vector&lt; art::Ptr&lt; recob::Hit &gt; &gt;, 3 &gt; SortHits(const std::array&lt; std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt;, 3 &gt; &amp;hits, const recob::Vertex &amp;start, const geo::GeometryCore *geo, const detinfo::DetectorPropertiesData &amp;dprop)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d40/PCAnglePlaneMaker__module_8cc_source.html#l00084">PCAnglePlaneMaker_module.cc:84</a></div></div>
<div class="ttc" id="classpma_1_1Node3D_html_a2ec9b7dc0c2adbb1cc253c43483dde9c"><div class="ttname"><a href="../../d3/dfc/classpma_1_1Node3D.html#a2ec9b7dc0c2adbb1cc253c43483dde9c">pma::Node3D::SameTPC</a></div><div class="ttdeci">bool SameTPC(const TVector3 &amp;p3d, float margin=0.0F) const </div><div class="ttdoc">Check if p3d is in the same TPC as the node. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da8/PmaNode3D_8cxx_source.html#l00102">PmaNode3D.cxx:102</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a20904e6f05c74e59da141c3a42c08561"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a20904e6f05c74e59da141c3a42c08561">pma::Track3D::GetObjFnInTree</a></div><div class="ttdeci">double GetObjFnInTree(bool skipFirst=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02251">PmaTrack3D.cxx:2251</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_af1b0be21f94a7d5972e7b50fcc830596"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#af1b0be21f94a7d5972e7b50fcc830596">pma::Track3D::InternalFlip</a></div><div class="ttdeci">void InternalFlip(std::vector&lt; pma::Track3D * &gt; &amp;toSort)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00604">PmaTrack3D.cxx:604</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_af5d763add9d35685d01a29c4cea6d6b9"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#af5d763add9d35685d01a29c4cea6d6b9">pma::Track3D::erase</a></div><div class="ttdeci">bool erase(const art::Ptr&lt; recob::Hit &gt; &amp;hit)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00364">PmaTrack3D.cxx:364</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a280382fd48b925a54e6693dca11a7b97"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a280382fd48b925a54e6693dca11a7b97">pma::Track3D::UpdateHitsRadius</a></div><div class="ttdeci">void UpdateHitsRadius()</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l03284">PmaTrack3D.cxx:3284</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a654c963a50f1bb2bb467369a11430edf"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a654c963a50f1bb2bb467369a11430edf">pma::Track3D::DisableSingleViewEnds</a></div><div class="ttdeci">unsigned int DisableSingleViewEnds()</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02749">PmaTrack3D.cxx:2749</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a1f6428b89518e48188e293c2c67743ddaa703023c9fcc4055af46588f20785bfd"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a1f6428b89518e48188e293c2c67743ddaa703023c9fcc4055af46588f20785bfd">pma::Track3D::kForward</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/PmaTrack3D_8h_source.html#l00040">PmaTrack3D.h:40</a></div></div>
<div class="ttc" id="classpma_1_1Node3D_html_a737403c9f686e0cd699e0f81135d65c8"><div class="ttname"><a href="../../d3/dfc/classpma_1_1Node3D.html#a737403c9f686e0cd699e0f81135d65c8">pma::Node3D::GetDistance2To</a></div><div class="ttdeci">double GetDistance2To(const TVector3 &amp;p3d) const override</div><div class="ttdoc">Distance [cm] from the 3D point to the point 3D. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da8/PmaNode3D_8cxx_source.html#l00178">PmaNode3D.cxx:178</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a4f2ceb5674e7c28d4ef26f8b64173e13"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a4f2ceb5674e7c28d4ef26f8b64173e13">pma::Track3D::AttachToSameTPC</a></div><div class="ttdeci">bool AttachToSameTPC(pma::Node3D *vStart)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01598">PmaTrack3D.cxx:1598</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_aec9ecfd023917e3989d972707d91faa3"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#aec9ecfd023917e3989d972707d91faa3">pma::Track3D::InsertNode</a></div><div class="ttdeci">void InsertNode(detinfo::DetectorPropertiesData const &amp;detProp, TVector3 const &amp;p3d, size_t at_idx, unsigned int tpc, unsigned int cryo)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01425">PmaTrack3D.cxx:1425</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a249124592b3305e473fc3428ebf4803e"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a249124592b3305e473fc3428ebf4803e">pma::Track3D::SortHits</a></div><div class="ttdeci">void SortHits()</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02711">PmaTrack3D.cxx:2711</a></div></div>
<div class="ttc" id="classdetinfo_1_1DetectorClocksData_html_a97752c751ce6873c94d29ece8fcc215f"><div class="ttname"><a href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html#a97752c751ce6873c94d29ece8fcc215f">detinfo::DetectorClocksData::TriggerTime</a></div><div class="ttdeci">double TriggerTime() const </div><div class="ttdoc">Trigger electronics clock time in [us]. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d5b/DetectorClocksData_8h_source.html#l00377">DetectorClocksData.h:377</a></div></div>
<div class="ttc" id="namespacegen__crt__frags_html_a8cdc67339147aad209b4122a38d7e246"><div class="ttname"><a href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">gen_crt_frags.w</a></div><div class="ttdeci">tuple w</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d8c/gen__crt__frags_8py_source.html#l01416">gen_crt_frags.py:1416</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_ac962a4b11d64492799b447aa9c40837d"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#ac962a4b11d64492799b447aa9c40837d">pma::Track3D::fNodes</a></div><div class="ttdeci">std::vector&lt; pma::Node3D * &gt; fNodes</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/PmaTrack3D_8h_source.html#l00493">PmaTrack3D.h:493</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_ade58f28ec215a83815b0c4f559c0200b"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#ade58f28ec215a83815b0c4f559c0200b">pma::Track3D::SelectRndHits</a></div><div class="ttdeci">bool SelectRndHits(size_t segmax, size_t vtxmax)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02930">PmaTrack3D.cxx:2930</a></div></div>
<div class="ttc" id="namespacedropbox_html_a407b5b895ba9265893768748aaa73825"><div class="ttname"><a href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dropbox.dir</a></div><div class="ttdeci">tuple dir</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d81/dropbox_8py_source.html#l00028">dropbox.py:28</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a2e9e7d6ebebf8732281d38693c1bb7de"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a2e9e7d6ebebf8732281d38693c1bb7de">pma::Track3D::CompleteMissingWires</a></div><div class="ttdeci">size_t CompleteMissingWires(detinfo::DetectorPropertiesData const &amp;detProp, unsigned int view)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01192">PmaTrack3D.cxx:1192</a></div></div>
<div class="ttc" id="classdetinfo_1_1DetectorPropertiesData_html_a8e4b4b8d755ffded5a9f956ae7c9c1ec"><div class="ttname"><a href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a8e4b4b8d755ffded5a9f956ae7c9c1ec">detinfo::DetectorPropertiesData::ConvertTicksToX</a></div><div class="ttdeci">double ConvertTicksToX(double ticks, int p, int t, int c) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d64/DetectorPropertiesData_8cc_source.html#l00115">DetectorPropertiesData.cc:115</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a630e8a4c7f28f79d4a689e6c2035df42"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a630e8a4c7f28f79d4a689e6c2035df42">pma::Track3D::InitFromMiddle</a></div><div class="ttdeci">void InitFromMiddle(detinfo::DetectorPropertiesData const &amp;detProp, int tpc, int cryo)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00299">PmaTrack3D.cxx:299</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_ad533a00b8bd295bc021a281e47a1207a"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#ad533a00b8bd295bc021a281e47a1207a">pma::Track3D::DeleteSegments</a></div><div class="ttdeci">void DeleteSegments()</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02418">PmaTrack3D.cxx:2418</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a9e34c6cc001b39a9ad184972ce42d094"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a9e34c6cc001b39a9ad184972ce42d094">pma::Track3D::push_back</a></div><div class="ttdeci">void push_back(pma::Hit3D *hit)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/PmaTrack3D_8h_source.html#l00087">PmaTrack3D.h:87</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_ae4d1a97fb871c2883ae51402a7f76b51"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#ae4d1a97fb871c2883ae51402a7f76b51">pma::Track3D::UpdateParams</a></div><div class="ttdeci">bool UpdateParams()</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l03182">PmaTrack3D.cxx:3182</a></div></div>
<div class="ttc" id="classpma_1_1Hit3D_html_a63647e230c7fe8690d1b526d9f5b248f"><div class="ttname"><a href="../../d5/d5f/classpma_1_1Hit3D.html#a63647e230c7fe8690d1b526d9f5b248f">pma::Hit3D::Point2D</a></div><div class="ttdeci">TVector2 const &amp; Point2D() const noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dea/PmaHit3D_8h_source.html#l00072">PmaHit3D.h:72</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a1f6428b89518e48188e293c2c67743dd"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a1f6428b89518e48188e293c2c67743dd">pma::Track3D::EDirection</a></div><div class="ttdeci">EDirection</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/PmaTrack3D_8h_source.html#l00040">PmaTrack3D.h:40</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_aef4cccbe9bda3ffd6f07d89d3d01cc5b"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#aef4cccbe9bda3ffd6f07d89d3d01cc5b">pma::Track3D::AverageDist2</a></div><div class="ttdeci">double AverageDist2() const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l03159">PmaTrack3D.cxx:3159</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a39c3984b0f5f5ac48187ade44578df94"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a39c3984b0f5f5ac48187ade44578df94">pma::Track3D::HasTwoViews</a></div><div class="ttdeci">bool HasTwoViews(size_t nmin=1) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00442">PmaTrack3D.cxx:442</a></div></div>
<div class="ttc" id="classpma_1_1Element3D_html_a479cba70e2320a1afe991d3f2df3b2ab"><div class="ttname"><a href="../../d0/dcf/classpma_1_1Element3D.html#a479cba70e2320a1afe991d3f2df3b2ab">pma::Element3D::Cryo</a></div><div class="ttdeci">int Cryo(void) const </div><div class="ttdoc">Cryostat index or -1 if out of any cryostat. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dec/PmaElement3D_8h_source.html#l00036">PmaElement3D.h:36</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a87e518fd64bf15a01367c7e8fe068ded"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a87e518fd64bf15a01367c7e8fe068ded">pma::Track3D::CleanupTails</a></div><div class="ttdeci">void CleanupTails()</div><div class="ttdoc">Cut out tails with no hits assigned. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02437">PmaTrack3D.cxx:2437</a></div></div>
<div class="ttc" id="namespacepmtana_html_afea8da0c88fccc3252529b6a49284b4a"><div class="ttname"><a href="../../da/dc9/namespacepmtana.html#afea8da0c88fccc3252529b6a49284b4a">pmtana::mean</a></div><div class="ttdeci">double mean(const std::vector&lt; short &gt; &amp;wf, size_t start, size_t nsample)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/de4/UtilFunc_8cxx_source.html#l00013">UtilFunc.cxx:13</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_ab2f11f6321db119fec99113cfbfbb889"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#ab2f11f6321db119fec99113cfbfbb889">pma::Track3D::MakeProjectionInTree</a></div><div class="ttdeci">void MakeProjectionInTree(bool skipFirst=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02199">PmaTrack3D.cxx:2199</a></div></div>
<div class="ttc" id="namespacepma_html_af467dbe2a7cc1be08144c157a06676f7"><div class="ttname"><a href="../../d8/d4a/namespacepma.html#af467dbe2a7cc1be08144c157a06676f7">pma::dedx_map</a></div><div class="ttdeci">std::map&lt; size_t, std::vector&lt; double &gt; &gt; dedx_map</div><div class="ttdef"><b>Definition:</b> <a href="../../de/de4/larreco_2larreco_2RecoAlg_2PMAlg_2Utilities_8h_source.html#l00033">larreco/larreco/RecoAlg/PMAlg/Utilities.h:33</a></div></div>
<div class="ttc" id="classpma_1_1Element3D_html_affc19b2cc81fb0408b0ea8df648e5d98"><div class="ttname"><a href="../../d0/dcf/classpma_1_1Element3D.html#affc19b2cc81fb0408b0ea8df648e5d98">pma::Element3D::SortHits</a></div><div class="ttdeci">void SortHits(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/db2/PmaElement3D_8cxx_source.html#l00045">PmaElement3D.cxx:45</a></div></div>
<div class="ttc" id="classpma_1_1Hit3D_html_a9ebb325be5c4a09468679377b618313d"><div class="ttname"><a href="../../d5/d5f/classpma_1_1Hit3D.html#a9ebb325be5c4a09468679377b618313d">pma::Hit3D::Cryo</a></div><div class="ttdeci">unsigned int Cryo() const noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dea/PmaHit3D_8h_source.html#l00083">PmaHit3D.h:83</a></div></div>
<div class="ttc" id="classpma_1_1SortedBranchBase_html_aa05348c187c1f5e1e2cb9334f15e101a"><div class="ttname"><a href="../../db/d5f/classpma_1_1SortedBranchBase.html#aa05348c187c1f5e1e2cb9334f15e101a">pma::SortedBranchBase::Next</a></div><div class="ttdeci">virtual pma::SortedObjectBase * Next(unsigned int index=0) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d13/SortedObjects_8h_source.html#l00079">SortedObjects.h:79</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a954863fd516227e21a88c0228a0227f4"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a954863fd516227e21a88c0228a0227f4">pma::Track3D::Length</a></div><div class="ttdeci">double Length(size_t step=1) const </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/PmaTrack3D_8h_source.html#l00117">PmaTrack3D.h:117</a></div></div>
<div class="ttc" id="classpma_1_1Element3D_html_a04a6da5b5d95942da64d6675674ac927"><div class="ttname"><a href="../../d0/dcf/classpma_1_1Element3D.html#a04a6da5b5d95942da64d6675674ac927">pma::Element3D::IsFrozen</a></div><div class="ttdeci">bool IsFrozen(void) const </div><div class="ttdoc">Check if the vertex 3D position is fixed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dec/PmaElement3D_8h_source.html#l00099">PmaElement3D.h:99</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a167928193032c5ec208742c45f7706a9"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a167928193032c5ec208742c45f7706a9">pma::Track3D::GetRawdEdxSequence</a></div><div class="ttdeci">double GetRawdEdxSequence(std::map&lt; size_t, std::vector&lt; double &gt;&gt; &amp;dedx, unsigned int view=geo::kZ, unsigned int skip=0, bool inclDisabled=false) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01048">PmaTrack3D.cxx:1048</a></div></div>
<div class="ttc" id="classdetinfo_1_1DetectorClocksData_html"><div class="ttname"><a href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html">detinfo::DetectorClocksData</a></div><div class="ttdoc">Contains all timing reference information for the detector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d5b/DetectorClocksData_8h_source.html#l00283">DetectorClocksData.h:283</a></div></div>
<div class="ttc" id="namespacelarg4_html_a3b23adbb58bc71f7c54806914226f1f8"><div class="ttname"><a href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">larg4::dist</a></div><div class="ttdeci">constexpr double dist(const TReal *x, const TReal *y, const unsigned int dimension)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d8a/OpFastScintillation_8hh_source.html#l00563">OpFastScintillation.hh:563</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_ab983fc03bf11450de6bcd439d995608b"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#ab983fc03bf11450de6bcd439d995608b">pma::Track3D::fAssignedPoints</a></div><div class="ttdeci">std::vector&lt; TVector3 * &gt; fAssignedPoints</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/PmaTrack3D_8h_source.html#l00484">PmaTrack3D.h:484</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_adaeb0e035627641bf5ba5a8d145fda05"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#adaeb0e035627641bf5ba5a8d145fda05">pma::Track3D::PrevSegment</a></div><div class="ttdeci">pma::Segment3D * PrevSegment(pma::Node3D *vtx) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01038">PmaTrack3D.cxx:1038</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_aeb28329b16854103de1b1e72ac8d7473"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#aeb28329b16854103de1b1e72ac8d7473">pma::Track3D::RemoveNode</a></div><div class="ttdeci">bool RemoveNode(size_t idx)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01439">PmaTrack3D.cxx:1439</a></div></div>
<div class="ttc" id="file__to__url_8sh_html_a096ad3d3698082826189c839d7a6e46f"><div class="ttname"><a href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a></div><div class="ttdeci">then echo File list $list not found else cat $list while read file do echo $file sed s</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dea/file__to__url_8sh_source.html#l00060">file_to_url.sh:60</a></div></div>
<div class="ttc" id="classpma_1_1Hit3D_html_a7cf8ff8585ff0d5ec43eab8c43aaa77c"><div class="ttname"><a href="../../d5/d5f/classpma_1_1Hit3D.html#a7cf8ff8585ff0d5ec43eab8c43aaa77c">pma::Hit3D::GetDistToProj</a></div><div class="ttdeci">double GetDistToProj() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dea/PmaHit3D_8h_source.html#l00136">PmaHit3D.h:136</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a64946aa8973080f604abc9eb798e9761"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a64946aa8973080f604abc9eb798e9761">pma::Track3D::NextHit</a></div><div class="ttdeci">int NextHit(int index, unsigned int view=geo::kZ, bool inclDisabled=false) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00909">PmaTrack3D.cxx:909</a></div></div>
<div class="ttc" id="DetectorClocksService_8h_html"><div class="ttname"><a href="../../d3/dba/DetectorClocksService_8h.html">DetectorClocksService.h</a></div></div>
<div class="ttc" id="namespacepma_html_ad1b103cd1dc1bf59c3dd46f5a418af15"><div class="ttname"><a href="../../d8/d4a/namespacepma.html#ad1b103cd1dc1bf59c3dd46f5a418af15">pma::CmToWireDrift</a></div><div class="ttdeci">TVector2 CmToWireDrift(detinfo::DetectorPropertiesData const &amp;detProp, float xw, float yd, unsigned int plane, unsigned int tpc, unsigned int cryo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d95/larreco_2larreco_2RecoAlg_2PMAlg_2Utilities_8cxx_source.html#l00307">larreco/larreco/RecoAlg/PMAlg/Utilities.cxx:307</a></div></div>
<div class="ttc" id="classpma_1_1bSegmentProjLess_html"><div class="ttname"><a href="../../d2/d44/classpma_1_1bSegmentProjLess.html">pma::bSegmentProjLess</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/de4/larreco_2larreco_2RecoAlg_2PMAlg_2Utilities_8h_source.html#l00109">larreco/larreco/RecoAlg/PMAlg/Utilities.h:109</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a36905110212cd6c526ab8280afca9ae7"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a36905110212cd6c526ab8280afca9ae7">pma::Track3D::HitDxByView</a></div><div class="ttdeci">double HitDxByView(size_t index, unsigned int view) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01011">PmaTrack3D.cxx:1011</a></div></div>
<div class="ttc" id="classpma_1_1Hit3D_html_ab628d7feecc85a8172f17aef5f4778da"><div class="ttname"><a href="../../d5/d5f/classpma_1_1Hit3D.html#ab628d7feecc85a8172f17aef5f4778da">pma::Hit3D::IsEnabled</a></div><div class="ttdeci">bool IsEnabled() const noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dea/PmaHit3D_8h_source.html#l00161">PmaHit3D.h:161</a></div></div>
<div class="ttc" id="classpma_1_1Element3D_html_a91f0c950cdf5a8be87974940313bf8fd"><div class="ttname"><a href="../../d0/dcf/classpma_1_1Element3D.html#a91f0c950cdf5a8be87974940313bf8fd">pma::Element3D::AddHit</a></div><div class="ttdeci">void AddHit(pma::Hit3D *h)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dec/PmaElement3D_8h_source.html#l00068">PmaElement3D.h:68</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_ae49013df6fb3ab3bb805ec28e8b450fb"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#ae49013df6fb3ab3bb805ec28e8b450fb">pma::Track3D::SwapVertices</a></div><div class="ttdeci">bool SwapVertices(size_t v0, size_t v1)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l03209">PmaTrack3D.cxx:3209</a></div></div>
<div class="ttc" id="classpma_1_1SortedObjectBase_html_a44bcf174aa7ead5e3fe41c9097b1a828"><div class="ttname"><a href="../../df/d44/classpma_1_1SortedObjectBase.html#a44bcf174aa7ead5e3fe41c9097b1a828">pma::SortedObjectBase::Disconnect</a></div><div class="ttdeci">virtual void Disconnect(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d2a/SortedObjects_8cxx_source.html#l00025">SortedObjects.cxx:25</a></div></div>
<div class="ttc" id="classpma_1_1Hit3D_html_aa293ec05456935fc468dcc355d52102a"><div class="ttname"><a href="../../d5/d5f/classpma_1_1Hit3D.html#aa293ec05456935fc468dcc355d52102a">pma::Hit3D::Wire</a></div><div class="ttdeci">unsigned int Wire() const noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dea/PmaHit3D_8h_source.html#l00098">PmaHit3D.h:98</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a4df12e6e87a58737d573fe1846dfd842"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a4df12e6e87a58737d573fe1846dfd842">pma::Track3D::GetNearestTrkInTree</a></div><div class="ttdeci">pma::Track3D * GetNearestTrkInTree(const TVector3 &amp;p3d_cm, double &amp;dist, bool skipFirst=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02069">PmaTrack3D.cxx:2069</a></div></div>
<div class="ttc" id="classpma_1_1SortedObjectBase_html_a5f13409ee2a7deff853ec4bc919fe12e"><div class="ttname"><a href="../../df/d44/classpma_1_1SortedObjectBase.html#a5f13409ee2a7deff853ec4bc919fe12e">pma::SortedObjectBase::AddNext</a></div><div class="ttdeci">virtual bool AddNext(pma::SortedObjectBase *nextElement)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d2a/SortedObjects_8cxx_source.html#l00031">SortedObjects.cxx:31</a></div></div>
<div class="ttc" id="selectors_8fcl_html_a122a7b8666811f02fba2c0fcdc485d17"><div class="ttname"><a href="../../d9/dd2/selectors_8fcl.html#a122a7b8666811f02fba2c0fcdc485d17">k</a></div><div class="ttdeci">pdgs k</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd2/selectors_8fcl_source.html#l00022">selectors.fcl:22</a></div></div>
<div class="ttc" id="IntegerRanges__test_8cc_html_abbc7e5f346bfa932ca51b4b07ccef76d"><div class="ttname"><a href="../../db/df5/IntegerRanges__test_8cc.html#abbc7e5f346bfa932ca51b4b07ccef76d">count</a></div><div class="ttdeci">std::size_t count(Cont const &amp;cont)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df5/IntegerRanges__test_8cc_source.html#l00029">IntegerRanges_test.cc:29</a></div></div>
<div class="ttc" id="classpma_1_1SortedObjectBase_html_a76382d987dd22c027aec690b9cbfdd58"><div class="ttname"><a href="../../df/d44/classpma_1_1SortedObjectBase.html#a76382d987dd22c027aec690b9cbfdd58">pma::SortedObjectBase::Prev</a></div><div class="ttdeci">virtual pma::SortedObjectBase * Prev(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d13/SortedObjects_8h_source.html#l00044">SortedObjects.h:44</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a17c2878ac4a702eac76038d5c9d1e542"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a17c2878ac4a702eac76038d5c9d1e542">pma::Track3D::Flip</a></div><div class="ttdeci">bool Flip(const detinfo::DetectorPropertiesData &amp;detProp, std::vector&lt; pma::Track3D * &gt; &amp;allTracks)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00533">PmaTrack3D.cxx:533</a></div></div>
<div class="ttc" id="classpma_1_1Node3D_html"><div class="ttname"><a href="../../d3/dfc/classpma_1_1Node3D.html">pma::Node3D</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd8/PmaNode3D_8h_source.html#l00034">PmaNode3D.h:34</a></div></div>
<div class="ttc" id="classpma_1_1Hit3D_html"><div class="ttname"><a href="../../d5/d5f/classpma_1_1Hit3D.html">pma::Hit3D</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dea/PmaHit3D_8h_source.html#l00031">PmaHit3D.h:31</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a61676c8fb2963a14f6497d47b490296e"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a61676c8fb2963a14f6497d47b490296e">pma::Track3D::size</a></div><div class="ttdeci">size_t size() const </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/PmaTrack3D_8h_source.html#l00108">PmaTrack3D.h:108</a></div></div>
<div class="ttc" id="classpma_1_1Segment3D_html_a3bd0b0f1c326f91ad1a0b8fcea6483de"><div class="ttname"><a href="../../d6/dd5/classpma_1_1Segment3D.html#a3bd0b0f1c326f91ad1a0b8fcea6483de">pma::Segment3D::Parent</a></div><div class="ttdeci">pma::Track3D * Parent(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d22/PmaSegment3D_8h_source.html#l00068">PmaSegment3D.h:68</a></div></div>
<div class="ttc" id="classpma_1_1Element3D_html_abbfea4ff7cf1ced43172ee047440496c"><div class="ttname"><a href="../../d0/dcf/classpma_1_1Element3D.html#abbfea4ff7cf1ced43172ee047440496c">pma::Element3D::NHits</a></div><div class="ttdeci">size_t NHits(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dec/PmaElement3D_8h_source.html#l00074">PmaElement3D.h:74</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a86f8c831349f06279e0711ed3c1b884a"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a86f8c831349f06279e0711ed3c1b884a">pma::Track3D::ShiftEndsToHits</a></div><div class="ttdeci">bool ShiftEndsToHits()</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02479">PmaTrack3D.cxx:2479</a></div></div>
<div class="ttc" id="classpma_1_1SortedObjectBase_html_aa3a1a440fb324fe0aa37211705f9c8eb"><div class="ttname"><a href="../../df/d44/classpma_1_1SortedObjectBase.html#aa3a1a440fb324fe0aa37211705f9c8eb">pma::SortedObjectBase::Next</a></div><div class="ttdeci">virtual pma::SortedObjectBase * Next(unsigned int index=0) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d13/SortedObjects_8h_source.html#l00045">SortedObjects.h:45</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_aed906671558e08b757d748cd9e3b3a1d"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#aed906671558e08b757d748cd9e3b3a1d">pma::Track3D::AttachBackTo</a></div><div class="ttdeci">bool AttachBackTo(pma::Node3D *vStart)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01655">PmaTrack3D.cxx:1655</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a1f6428b89518e48188e293c2c67743dda5935c997afe0c7204f83eaf7d5b9075c"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a1f6428b89518e48188e293c2c67743dda5935c997afe0c7204f83eaf7d5b9075c">pma::Track3D::kBackward</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/PmaTrack3D_8h_source.html#l00040">PmaTrack3D.h:40</a></div></div>
<div class="ttc" id="namespacechannelDBConverter_html_ab6cfbbcbb53c275375289d47dec67f46"><div class="ttname"><a href="../../d4/d43/namespacechannelDBConverter.html#ab6cfbbcbb53c275375289d47dec67f46">channelDBConverter.n</a></div><div class="ttdeci">int n</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d11/channelDBConverter_8py_source.html#l00249">channelDBConverter.py:249</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a0f0aef67408b038fb28a735ebf75b080"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a0f0aef67408b038fb28a735ebf75b080">pma::Track3D::GetNearestElement</a></div><div class="ttdeci">pma::Element3D * GetNearestElement(const TVector2 &amp;p2d, unsigned int view, int tpc=-1, bool skipFrontVtx=false, bool skipBackVtx=false) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l02611">PmaTrack3D.cxx:2611</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a5f2a5070e3202fd89448a4c441ab3791"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a5f2a5070e3202fd89448a4c441ab3791">pma::Track3D::NextSegment</a></div><div class="ttdeci">pma::Segment3D * NextSegment(pma::Node3D *vtx) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l01024">PmaTrack3D.cxx:1024</a></div></div>
<div class="ttc" id="larreco_2larreco_2RecoAlg_2PMAlg_2Utilities_8h_html"><div class="ttname"><a href="../../de/de4/larreco_2larreco_2RecoAlg_2PMAlg_2Utilities_8h.html">Utilities.h</a></div></div>
<div class="ttc" id="classpma_1_1Element3D_html_ab07ba8c1da53d63756a6105a828d24be"><div class="ttname"><a href="../../d0/dcf/classpma_1_1Element3D.html#ab07ba8c1da53d63756a6105a828d24be">pma::Element3D::Length</a></div><div class="ttdeci">double Length(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dec/PmaElement3D_8h_source.html#l00052">PmaElement3D.h:52</a></div></div>
<div class="ttc" id="test__associatedgroupswithleft__full_8fcl_html_a4814f2598ed6acdb806473d732f33889"><div class="ttname"><a href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a></div><div class="ttdeci">physics associatedGroupsWithLeft p1</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dab/test__associatedgroupswithleft__full_8fcl_source.html#l00024">test_associatedgroupswithleft_full.fcl:24</a></div></div>
<div class="ttc" id="Geometry_8h_html"><div class="ttname"><a href="../../d3/d8b/Geometry_8h.html">Geometry.h</a></div><div class="ttdoc">art framework interface to geometry description </div></div>
<div class="ttc" id="namespacedetsim_html_a560adbb3abf95a23d45a53ed25d8c0c7"><div class="ttname"><a href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detsim::detProp</a></div><div class="ttdeci">auto const detProp</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/SimWire__module_8cc_source.html#l00154">SimWire_module.cc:154</a></div></div>
<div class="ttc" id="classpma_1_1Element3D_html_a812264b079959b83c74c49736940f4cb"><div class="ttname"><a href="../../d0/dcf/classpma_1_1Element3D.html#a812264b079959b83c74c49736940f4cb">pma::Element3D::NEnabledHits</a></div><div class="ttdeci">size_t NEnabledHits(unsigned int view=geo::kUnknown) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/db2/PmaElement3D_8cxx_source.html#l00036">PmaElement3D.cxx:36</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_ac011feb5eade195cdb3d4bf4f0458d63"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#ac011feb5eade195cdb3d4bf4f0458d63">pma::Track3D::WireDriftRange</a></div><div class="ttdeci">std::pair&lt; TVector2, TVector2 &gt; WireDriftRange(detinfo::DetectorPropertiesData const &amp;detProp, unsigned int view, unsigned int tpc, unsigned int cryo) const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l00490">PmaTrack3D.cxx:490</a></div></div>
<div class="ttc" id="classpma_1_1Hit3D_html_a428de59f1b3bfc6ed4134a4f174859c0"><div class="ttname"><a href="../../d5/d5f/classpma_1_1Hit3D.html#a428de59f1b3bfc6ed4134a4f174859c0">pma::Hit3D::SummedADC</a></div><div class="ttdeci">float SummedADC() const noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dea/PmaHit3D_8h_source.html#l00109">PmaHit3D.h:109</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_a6b17a32f3402243525a2ec3576920ddf"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#a6b17a32f3402243525a2ec3576920ddf">pma::Track3D::fHits</a></div><div class="ttdeci">std::vector&lt; pma::Hit3D * &gt; fHits</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/PmaTrack3D_8h_source.html#l00482">PmaTrack3D.h:482</a></div></div>
<div class="ttc" id="classpma_1_1Track3D_html_abac8bf3e3f086346de03b9416f49f943"><div class="ttname"><a href="../../d6/d8e/classpma_1_1Track3D.html#abac8bf3e3f086346de03b9416f49f943">pma::Track3D::UpdateProjection</a></div><div class="ttdeci">void UpdateProjection()</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/PmaTrack3D_8cxx_source.html#l03150">PmaTrack3D.cxx:3150</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
