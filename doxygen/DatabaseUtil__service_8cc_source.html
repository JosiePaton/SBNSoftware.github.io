<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>lardata/lardata/Utilities/DatabaseUtil_service.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_3c7faea33e00effae039ea7ff8ba6292.html">lardata</a></li><li class="navelem"><a class="el" href="dir_dffa0420082ce0990c4d8da6e1fb41bb.html">lardata</a></li><li class="navelem"><a class="el" href="dir_9207c9e143f3e8ffef359f1f7c5440ed.html">Utilities</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">DatabaseUtil_service.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="DatabaseUtil__service_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"></span><span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//  DatabaseUtil_plugin</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span><span class="comment"></span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"></span><span class="comment">// Framework includes</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// C++ language includes</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//#include &lt;libpq-fe.h&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// LArSoft includes</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DatabaseUtil_8h.html">lardata/Utilities/DatabaseUtil.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;art/Framework/Services/Registry/ServiceDefinitionMacros.h&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;messagefacility/MessageLogger/MessageLogger.h&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;cetlib_except/exception.h&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//-----------------------------------------------</span></div>
<div class="line"><a name="l00020"></a><span class="lineno"><a class="line" href="classutil_1_1DatabaseUtil.html#ade644b5e80eaa24557b31b694b8fa4c0">   20</a></span>&#160;<a class="code" href="classutil_1_1DatabaseUtil.html#ade644b5e80eaa24557b31b694b8fa4c0">util::DatabaseUtil::DatabaseUtil</a>(fhicl::ParameterSet <span class="keyword">const</span>&amp; pset)</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;{</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  <a class="code" href="classutil_1_1DatabaseUtil.html#aabaf1d52648342641d4670d4bd22fb16">conn</a> = NULL;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  this-&gt;<a class="code" href="classutil_1_1DatabaseUtil.html#a2dd2a357e7d49f3ed26ca303aa79ba1b">reconfigure</a>(pset);</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <a class="code" href="classutil_1_1DatabaseUtil.html#afc92bcd2ed0306d8afd69412863f205e">fChannelMap</a>.clear();</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <a class="code" href="classutil_1_1DatabaseUtil.html#a28ad29857dc258067ed0f471d48e1c67">fChannelReverseMap</a>.clear();</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;}</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">//----------------------------------------------</span></div>
<div class="line"><a name="l00029"></a><span class="lineno"><a class="line" href="classutil_1_1DatabaseUtil.html#a496875220259db67789b3cace64143c1">   29</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classutil_1_1DatabaseUtil.html#a496875220259db67789b3cace64143c1">util::DatabaseUtil::Connect</a>(<span class="keywordtype">int</span> conn_wait)</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;{</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="keywordflow">if</span>(!fShouldConnect)</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordflow">if</span>(conn_wait)</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    sleep(conn_wait);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <a class="code" href="namespacechannelDBConverter.html#a04bc3c278bbe16398deff10225d24c2f">conn</a> = PQconnectdb(connection_str);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keywordflow">if</span> (PQstatus(<a class="code" href="namespacechannelDBConverter.html#a04bc3c278bbe16398deff10225d24c2f">conn</a>) == CONNECTION_BAD) {</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    mf::LogWarning(<span class="stringliteral">&quot;DatabaseUtil&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Connection to database failed, &quot;</span>&lt;&lt;PQerrorMessage(<a class="code" href="namespacechannelDBConverter.html#a04bc3c278bbe16398deff10225d24c2f">conn</a>)&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keywordflow">if</span>( ( strstr(PQerrorMessage(<a class="code" href="namespacechannelDBConverter.html#a04bc3c278bbe16398deff10225d24c2f">conn</a>),<span class="stringliteral">&quot;remaining connection slots are reserved&quot;</span>)!=NULL ||</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;          strstr(PQerrorMessage(<a class="code" href="namespacechannelDBConverter.html#a04bc3c278bbe16398deff10225d24c2f">conn</a>),<span class="stringliteral">&quot;sorry, too many clients already&quot;</span>)!=NULL )</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        &amp;&amp; conn_wait&lt;20 ) {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;      conn_wait+=2;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      mf::LogWarning(<span class="stringliteral">&quot;DatabaseUtil&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;retrying connection after &quot;</span> &lt;&lt; conn_wait &lt;&lt; <span class="stringliteral">&quot; seconds \n&quot;</span>;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      <span class="keywordflow">return</span> this-&gt;Connect(conn_wait);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    }</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordflow">if</span>(fToughErrorTreatment)</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      <span class="keywordflow">throw</span> cet::exception(<span class="stringliteral">&quot;DataBaseUtil&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; DB connection failed\n&quot;</span>;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    MF_LOG_DEBUG(<span class="stringliteral">&quot;DatabaseUtil&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;Connected OK\n&quot;</span>;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  }</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;}</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="classutil_1_1DatabaseUtil.html#a4a0de563faf8c09918e02b9fa4e156cc">   58</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classutil_1_1DatabaseUtil.html#a4a0de563faf8c09918e02b9fa4e156cc">util::DatabaseUtil::DisConnect</a>()</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;{</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keywordflow">if</span>(!fShouldConnect)</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="comment">//close connection</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  MF_LOG_DEBUG(<span class="stringliteral">&quot;DatabaseUtil&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;Closing Connection \n&quot;</span>;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  PQfinish(<a class="code" href="namespacechannelDBConverter.html#a04bc3c278bbe16398deff10225d24c2f">conn</a>);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;}</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">//------------------------------------------------</span></div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="classutil_1_1DatabaseUtil.html#a2dd2a357e7d49f3ed26ca303aa79ba1b">   71</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classutil_1_1DatabaseUtil.html#a2dd2a357e7d49f3ed26ca303aa79ba1b">util::DatabaseUtil::reconfigure</a>(fhicl::ParameterSet <span class="keyword">const</span>&amp; pset)</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;{</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  fDBHostName            = pset.get&lt; std::string &gt;(<span class="stringliteral">&quot;DBHostName&quot;</span>          );</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  fDBName                = pset.get&lt; std::string &gt;(<span class="stringliteral">&quot;DBName&quot;</span>     );</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  fDBUser                = pset.get&lt; std::string &gt;(<span class="stringliteral">&quot;DBUser&quot;</span>);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  fTableName             = pset.get&lt; std::string &gt;(<span class="stringliteral">&quot;TableName&quot;</span>);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  fPort                  = pset.get&lt; <span class="keywordtype">int</span> &gt;(<span class="stringliteral">&quot;Port&quot;</span>     );</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  fPassword              = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  fToughErrorTreatment   = pset.get&lt; <span class="keywordtype">bool</span> &gt;(<span class="stringliteral">&quot;ToughErrorTreatment&quot;</span>);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  fShouldConnect         = pset.get&lt; <span class="keywordtype">bool</span> &gt;(<span class="stringliteral">&quot;ShouldConnect&quot;</span>);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="comment">// constructor decides if initialized value is a path or an environment variable</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  std::string passfname;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  cet::search_path sp(<span class="stringliteral">&quot;FW_SEARCH_PATH&quot;</span>);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  sp.find_file(pset.get&lt; std::string &gt;(<span class="stringliteral">&quot;PassFileName&quot;</span>), passfname);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordflow">if</span> (!passfname.empty()) {</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    std::ifstream <a class="code" href="quiet__Math__Functor__test_8sh.html#adfac98fbd1e85554d2cf0454cdcbc717">in</a>(passfname.c_str());</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="quiet__Math__Functor__test_8sh.html#adfac98fbd1e85554d2cf0454cdcbc717">in</a>) {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <span class="keywordflow">throw</span> art::Exception(art::errors::NotFound)</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Database password file &#39;&quot;</span> &lt;&lt; passfname</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;&#39; not found in FW_SEARCH_PATH; using an empty password.\n&quot;</span>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    }</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    std::getline(<a class="code" href="quiet__Math__Functor__test_8sh.html#adfac98fbd1e85554d2cf0454cdcbc717">in</a>, fPassword);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <a class="code" href="quiet__Math__Functor__test_8sh.html#adfac98fbd1e85554d2cf0454cdcbc717">in</a>.close();</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  }</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fShouldConnect){</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordflow">throw</span> art::Exception(art::errors::NotFound)</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Database password file &#39;&quot;</span> &lt;&lt; pset.get&lt; std::string &gt;(<span class="stringliteral">&quot;PassFileName&quot;</span>)</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;&#39; not found in FW_SEARCH_PATH; using an empty password.\n&quot;</span>;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  }</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  sprintf(connection_str,<span class="stringliteral">&quot;host=%s dbname=%s user=%s port=%d password=%s &quot;</span>,fDBHostName.c_str(),fDBName.c_str(),fDBUser.c_str(),fPort,fPassword.c_str());</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;}</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="classutil_1_1DatabaseUtil.html#a3d278b1b8c1e7f305cf6453a16fca7b8">  111</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classutil_1_1DatabaseUtil.html#a3d278b1b8c1e7f305cf6453a16fca7b8">util::DatabaseUtil::SelectSingleFieldByQuery</a>(std::vector&lt;std::string&gt; &amp;<a class="code" href="pmtsimulation__icarus_8fcl.html#a9fc569190f32b40862f18ac3c03a8e49">value</a>,<span class="keyword">const</span> <span class="keywordtype">char</span> * query)</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;{</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  PGresult *result;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="keywordtype">char</span> * string_val;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keywordflow">if</span>(this-&gt;Connect()==-1)  {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordflow">if</span>(fShouldConnect)</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      mf::LogWarning(<span class="stringliteral">&quot;DatabaseUtil&quot;</span>)&lt;&lt; <span class="stringliteral">&quot;DB Connection error \n&quot;</span>;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      mf::LogInfo(<span class="stringliteral">&quot;DatabaseUtil&quot;</span>)&lt;&lt; <span class="stringliteral">&quot;Not connecting to DB by choice. \n&quot;</span>;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  }</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  result = PQexec(<a class="code" href="namespacechannelDBConverter.html#a04bc3c278bbe16398deff10225d24c2f">conn</a>, query);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="keywordflow">if</span> (!result) {</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    mf::LogInfo(<span class="stringliteral">&quot;DatabaseUtil&quot;</span>)&lt;&lt; <span class="stringliteral">&quot;PQexec command failed, no error code\n&quot;</span>;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  }</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(PQresultStatus(result)!=PGRES_TUPLES_OK) {</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordflow">if</span>(PQresultStatus(result)==PGRES_COMMAND_OK)</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      MF_LOG_DEBUG(<span class="stringliteral">&quot;DatabaseUtil&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;Command executed OK, &quot;</span>&lt;&lt; PQcmdTuples(result) &lt;&lt;<span class="stringliteral">&quot; rows affected\n&quot;</span>;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      mf::LogWarning(<span class="stringliteral">&quot;DatabaseUtil&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;Command failed with code &quot;</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                                    &lt;&lt;PQresStatus(PQresultStatus(result)) &lt;&lt;<span class="stringliteral">&quot;, error message &quot;</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                                    &lt;&lt;PQresultErrorMessage(result)&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    PQclear(result);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    this-&gt;DisConnect();</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">//  mf::LogInfo(&quot;DatabaseUtil&quot;)&lt;&lt;&quot;Query may have returned data\n&quot;;</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="comment">//  mf::LogInfo(&quot;DatabaseUtil&quot;)&lt;&lt;&quot;Number of rows returned: &quot;&lt;&lt;PQntuples(result)</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">//   &lt;&lt;&quot;, fields: &quot;&lt;&lt;PQnfields(result)&lt;&lt;&quot; \n&quot;;</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">if</span>(PQntuples(result)&gt;=1){</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;PQntuples(result);i++)</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;          string_val=PQgetvalue(result,i,0);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;          value.push_back(string_val);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;          MF_LOG_DEBUG(<span class="stringliteral">&quot;DatabaseUtil&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; extracted value: &quot;</span>&lt;&lt;value[i] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        }</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      PQclear(result);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      this-&gt;DisConnect();</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      mf::LogWarning(<span class="stringliteral">&quot;DatabaseUtil&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;wrong number of rows returned:&quot;</span>&lt;&lt;PQntuples(result)&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      PQclear(result);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      this-&gt;DisConnect();</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    }</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;}</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div>
<div class="line"><a name="l00171"></a><span class="lineno"><a class="line" href="classutil_1_1DatabaseUtil.html#ab81ecce8b3ab64db68889cc1b938c8a7">  171</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classutil_1_1DatabaseUtil.html#ab81ecce8b3ab64db68889cc1b938c8a7">util::DatabaseUtil::GetTemperatureFromDB</a>(<span class="keywordtype">int</span> run,<span class="keywordtype">double</span> &amp;temp_real)</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;{</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  std::vector&lt;std::string&gt; retvalue;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keywordtype">char</span> cond[30];</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  sprintf(cond,<span class="stringliteral">&quot;run = %d&quot;</span>,run);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespaceevd.html#a911fe581afad27a720ee200bd61362a6">err</a>=SelectFieldByName(retvalue,<span class="stringliteral">&quot;temp&quot;</span>,cond,fTableName.c_str());</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="keywordflow">if</span>(err!=-1 &amp;&amp; retvalue.size()==1){</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordtype">char</span> * endstr;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    temp_real=std::strtod(retvalue[0].c_str(),&amp;endstr);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  }</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;}</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno"><a class="line" href="classutil_1_1DatabaseUtil.html#a367d8e2f96ae331769c996355b019597">  192</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classutil_1_1DatabaseUtil.html#a367d8e2f96ae331769c996355b019597">util::DatabaseUtil::GetEfieldValuesFromDB</a>(<span class="keywordtype">int</span> run,std::vector&lt;double&gt; &amp;efield)</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;{</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  std::vector&lt;std::string&gt; retvalue;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="keywordtype">char</span> query[200];</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  sprintf(query,<span class="stringliteral">&quot;SELECT EFbet FROM EField,%s WHERE Efield.FID = %s.FID AND run = %d ORDER BY planegap&quot;</span>,fTableName.c_str(),fTableName.c_str(),run);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespaceevd.html#a911fe581afad27a720ee200bd61362a6">err</a>=SelectSingleFieldByQuery(retvalue,query);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="keywordflow">if</span>(err!=-1 &amp;&amp; retvalue.size()&gt;=1){</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    efield.clear();    <span class="comment">//clear value before setting new values</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0;i&lt;retvalue.size();i++) {</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <span class="keywordtype">char</span> * endstr;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      efield.push_back(std::strtod(retvalue[i].c_str(),&amp;endstr));</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;}</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno"><a class="line" href="classutil_1_1DatabaseUtil.html#acc5e5ef8a9137fcb568acb2f5e9a4bb7">  216</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classutil_1_1DatabaseUtil.html#acc5e5ef8a9137fcb568acb2f5e9a4bb7">util::DatabaseUtil::SelectFieldByName</a>(std::vector&lt;std::string&gt; &amp;<a class="code" href="pmtsimulation__icarus_8fcl.html#a9fc569190f32b40862f18ac3c03a8e49">value</a>,</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                                          <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="find__global__symbol_8sh.html#acdadef1d07e090344b4ce37a603cff53">field</a>,</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                                          <span class="keyword">const</span> <span class="keywordtype">char</span> * condition,</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                                          <span class="keyword">const</span> <span class="keywordtype">char</span> * table)   {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keywordtype">char</span> query[100];</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  sprintf(query,<span class="stringliteral">&quot;SELECT %s FROM %s WHERE %s&quot;</span>,field, table, condition);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="keywordflow">return</span> SelectSingleFieldByQuery(value,query);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;}</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div>
<div class="line"><a name="l00235"></a><span class="lineno"><a class="line" href="classutil_1_1DatabaseUtil.html#ac505d447f271632587bb07d6cdc081a1">  235</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classutil_1_1DatabaseUtil.html#ac505d447f271632587bb07d6cdc081a1">util::DatabaseUtil::GetLifetimeFromDB</a>(<span class="keywordtype">int</span> run,<span class="keywordtype">double</span> &amp;lftime_real) {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="comment">//  char query[100];</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="comment">//  sprintf(query,&quot;SELECT tau FROM argoneut_test WHERE run = %d&quot;,run);</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  std::vector&lt;std::string&gt; retvalue;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="keywordtype">char</span> cond[30];</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  sprintf(cond,<span class="stringliteral">&quot;run = %d&quot;</span>,run);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespaceevd.html#a911fe581afad27a720ee200bd61362a6">err</a>=SelectFieldByName(retvalue,<span class="stringliteral">&quot;tau&quot;</span>,cond,fTableName.c_str());</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordflow">if</span>(err!=-1 &amp;&amp; retvalue.size()==1){</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keywordtype">char</span> * endstr;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    lftime_real=std::strtod(retvalue[0].c_str(),&amp;endstr);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  }</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;}</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div>
<div class="line"><a name="l00256"></a><span class="lineno"><a class="line" href="classutil_1_1DatabaseUtil.html#a9a92934a55b1c4f8ad63706eb24df0a6">  256</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classutil_1_1DatabaseUtil.html#a9a92934a55b1c4f8ad63706eb24df0a6">util::DatabaseUtil::GetTriggerOffsetFromDB</a>(<span class="keywordtype">int</span> run,<span class="keywordtype">double</span> &amp;T0_real) {</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="comment">//  char query[100];</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="comment">//  sprintf(query,&quot;SELECT tau FROM argoneut_test WHERE run = %d&quot;,run);</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  std::vector&lt;std::string&gt; retvalue;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordtype">char</span> cond[30];</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  sprintf(cond,<span class="stringliteral">&quot;run = %d&quot;</span>,run);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespaceevd.html#a911fe581afad27a720ee200bd61362a6">err</a>=SelectFieldByName(retvalue,<span class="stringliteral">&quot;T0&quot;</span>,cond,fTableName.c_str());</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keywordflow">if</span>(err!=-1 &amp;&amp; retvalue.size()==1){</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordtype">char</span> * endstr;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    T0_real=std::strtod(retvalue[0].c_str(),&amp;endstr);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  }</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;}</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div>
<div class="line"><a name="l00278"></a><span class="lineno"><a class="line" href="classutil_1_1DatabaseUtil.html#ab5e495835f5fe47e0f270d5f2632c4be">  278</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classutil_1_1DatabaseUtil.html#ab5e495835f5fe47e0f270d5f2632c4be">util::DatabaseUtil::GetPOTFromDB</a>(<span class="keywordtype">int</span> run,<span class="keywordtype">long</span> <span class="keywordtype">double</span> &amp;<a class="code" href="PAC2020_2SBND_2helper_8h.html#a06f8f2157a91856986e2a76badd6fd3d">POT</a>) {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="comment">//  char query[100];</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="comment">//  sprintf(query,&quot;SELECT tau FROM argoneut_test WHERE run = %d&quot;,run);</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  std::vector&lt;std::string&gt; retvalue;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keywordtype">char</span> cond[30];</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  sprintf(cond,<span class="stringliteral">&quot;run = %d&quot;</span>,run);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespaceevd.html#a911fe581afad27a720ee200bd61362a6">err</a>=SelectFieldByName(retvalue,<span class="stringliteral">&quot;pot&quot;</span>,cond,fTableName.c_str());</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="keywordflow">if</span>(err!=-1 &amp;&amp; retvalue.size()==1){</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordtype">char</span> * endstr;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    POT=std::strtold(retvalue[0].c_str(),&amp;endstr);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  }</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;}</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="keyword">namespace </span>util {</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div>
<div class="line"><a name="l00301"></a><span class="lineno"><a class="line" href="classutil_1_1DatabaseUtil.html#a2cd249540e0401cf805ebdd3478ade72">  301</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classutil_1_1DatabaseUtil.html#a2cd249540e0401cf805ebdd3478ade72">DatabaseUtil::LoadUBChannelMap</a>( <span class="keywordtype">int</span> data_taking_timestamp, <span class="keywordtype">int</span>  swizzling_timestamp) {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">if</span> ( fChannelMap.size()&gt;0 ) {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <span class="comment">// Use prevously grabbed data to avoid repeated call to database.</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="comment">// Also this avoids inglorious segfault.</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    }</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="namespacechannelDBConverter.html#a04bc3c278bbe16398deff10225d24c2f">conn</a>==NULL )</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      Connect( 0 );</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordflow">if</span>(PQstatus(<a class="code" href="namespacechannelDBConverter.html#a04bc3c278bbe16398deff10225d24c2f">conn</a>)!=CONNECTION_OK) {</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      mf::LogError(<span class="stringliteral">&quot;&quot;</span>) &lt;&lt; __PRETTY_FUNCTION__ &lt;&lt; <span class="stringliteral">&quot;: Couldn&#39;t open connection to postgresql interface&quot;</span>  &lt;&lt; PQdb(<a class="code" href="namespacechannelDBConverter.html#a04bc3c278bbe16398deff10225d24c2f">conn</a>) &lt;&lt;<span class="stringliteral">&quot;:&quot;</span>&lt;&lt;PQhost(<a class="code" href="namespacechannelDBConverter.html#a04bc3c278bbe16398deff10225d24c2f">conn</a>);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      PQfinish(<a class="code" href="namespacechannelDBConverter.html#a04bc3c278bbe16398deff10225d24c2f">conn</a>);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      <span class="keywordflow">throw</span> art::Exception( art::errors::FileReadError )</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;Failed to get channel map from DB.&quot;</span>&lt;&lt; std::endl;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    }</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    fChannelMap.clear();</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    fChannelReverseMap.clear();</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    PGresult *res  = PQexec(<a class="code" href="namespacechannelDBConverter.html#a04bc3c278bbe16398deff10225d24c2f">conn</a>, <span class="stringliteral">&quot;BEGIN&quot;</span>);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">if</span> (PQresultStatus(res) != PGRES_COMMAND_OK) {</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      mf::LogError(<span class="stringliteral">&quot;&quot;</span>)&lt;&lt; <span class="stringliteral">&quot;postgresql BEGIN failed&quot;</span>;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      PQclear(res);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      PQfinish(<a class="code" href="namespacechannelDBConverter.html#a04bc3c278bbe16398deff10225d24c2f">conn</a>);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      <span class="keywordflow">throw</span> art::Exception( art::errors::FileReadError )</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;postgresql BEGIN failed.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    }</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="comment">// Jason St. John&#39;s updated call to versioned database.</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">// get_map_double_sec (data_taking_timestamp int DEFAULT now() ,</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="comment">//                     swizzling_timestamp   int DEFAULT now() )</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="comment">// Returns rows of: crate, slot, fem_channel, larsoft_channel</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="comment">// Both arguments are optional, or can be passed their default of now(), or can be passed an explicit timestamp:</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="comment">// Example: &quot;SELECT get_map_double_sec(1438430400);&quot;</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    PQclear(res);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordtype">char</span> dbquery[200];</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    sprintf(dbquery, <span class="stringliteral">&quot;SELECT get_map_double_sec(%i,%i);&quot;</span>, data_taking_timestamp, swizzling_timestamp);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    res = PQexec(<a class="code" href="namespacechannelDBConverter.html#a04bc3c278bbe16398deff10225d24c2f">conn</a>, dbquery);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">if</span> ((!res) || (PQresultStatus(res) != PGRES_TUPLES_OK) || (PQntuples(res) &lt; 1))</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      {</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        mf::LogError(<span class="stringliteral">&quot;&quot;</span>)&lt;&lt; <span class="stringliteral">&quot;SELECT command did not return tuples properly. \n&quot;</span> &lt;&lt; PQresultErrorMessage(res) &lt;&lt; <span class="stringliteral">&quot;Number rows: &quot;</span>&lt;&lt; PQntuples(res);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        PQclear(res);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        PQfinish(<a class="code" href="namespacechannelDBConverter.html#a04bc3c278bbe16398deff10225d24c2f">conn</a>);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="keywordflow">throw</span> art::Exception( art::errors::FileReadError )</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;postgresql SELECT failed.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordtype">int</span> num_records=PQntuples(res);            <span class="comment">//One record per channel, ideally.</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;num_records;i++) {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      std::string tup = PQgetvalue(res, i, 0); <span class="comment">// (crate,slot,FEMch,larsoft_chan) format</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      tup = tup.substr(1,tup.length()-2);      <span class="comment">// Strip initial &amp; final parentheses.</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      std::vector&lt;std::string&gt; fields;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      split(tup, <span class="charliteral">&#39;,&#39;</span>, fields);                 <span class="comment">// Explode substrings into vector with comma delimiters.</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="keywordtype">int</span> crate_id     = atoi( fields[0].c_str() );</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="keywordtype">int</span> slot         = atoi( fields[1].c_str() );</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <span class="keywordtype">int</span> boardChan    = atoi( fields[2].c_str() );</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      <span class="keywordtype">int</span> larsoft_chan = atoi( fields[3].c_str() );</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      <a class="code" href="classutil_1_1UBDaqID.html">UBDaqID</a> daq_id(crate_id,slot,boardChan);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      std::pair&lt;UBDaqID, UBLArSoftCh_t&gt; <a class="code" href="selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>(daq_id,larsoft_chan);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="keywordflow">if</span> ( fChannelMap.find(daq_id) != fChannelMap.end() ){</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <a class="code" href="messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; __PRETTY_FUNCTION__ &lt;&lt; <span class="stringliteral">&quot;: &quot;</span>;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <a class="code" href="messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Multiple entries!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        mf::LogWarning(<span class="stringliteral">&quot;&quot;</span>)&lt;&lt; <span class="stringliteral">&quot;Multiple DB entries for same (crate,card,channel). &quot;</span>&lt;&lt;std::endl</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                          &lt;&lt; <span class="stringliteral">&quot;Redefining (crate,card,channel)=&gt;id link (&quot;</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                          &lt;&lt; daq_id.<a class="code" href="classutil_1_1UBDaqID.html#a0fc54181f72306e8dd14fd6b5bef175a">crate</a>&lt;&lt;<span class="stringliteral">&quot;, &quot;</span>&lt;&lt; daq_id.<a class="code" href="classutil_1_1UBDaqID.html#a075ee2f66329bce898a4a0e4eba4ee0c">card</a>&lt;&lt;<span class="stringliteral">&quot;, &quot;</span>&lt;&lt; daq_id.<a class="code" href="classutil_1_1UBDaqID.html#a4fb33219ecaed4943097c8a00e21dc82">channel</a>&lt;&lt;<span class="stringliteral">&quot;)=&gt;&quot;</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                          &lt;&lt; fChannelMap.find(daq_id)-&gt;second;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      }</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      fChannelMap.insert( p );</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      fChannelReverseMap.insert( std::pair&lt; UBLArSoftCh_t, UBDaqID &gt;( larsoft_chan, daq_id ) );</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    this-&gt;DisConnect();</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  }<span class="comment">// end of LoadUBChannelMap</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div>
<div class="line"><a name="l00382"></a><span class="lineno"><a class="line" href="classutil_1_1DatabaseUtil.html#a0548d61e7fe30672f291ca4c28f42fa8">  382</a></span>&#160;  <a class="code" href="namespaceutil.html#a097740c1c11a734156bf86e85b210e1b">UBChannelMap_t</a> <a class="code" href="classutil_1_1DatabaseUtil.html#a0548d61e7fe30672f291ca4c28f42fa8">DatabaseUtil::GetUBChannelMap</a>( <span class="keywordtype">int</span> data_taking_timestamp, <span class="keywordtype">int</span> swizzling_timestamp ) {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    LoadUBChannelMap( data_taking_timestamp, swizzling_timestamp );</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordflow">return</span> fChannelMap;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  }</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div>
<div class="line"><a name="l00387"></a><span class="lineno"><a class="line" href="classutil_1_1DatabaseUtil.html#a8c7d2cd159683eb48c220e899cad126f">  387</a></span>&#160;  <a class="code" href="namespaceutil.html#a212740e3c13bae3ed850ef0310bbb62e">UBChannelReverseMap_t</a> <a class="code" href="classutil_1_1DatabaseUtil.html#a8c7d2cd159683eb48c220e899cad126f">DatabaseUtil::GetUBChannelReverseMap</a>( <span class="keywordtype">int</span> data_taking_timestamp, <span class="keywordtype">int</span> swizzling_timestamp ) {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    LoadUBChannelMap( data_taking_timestamp, swizzling_timestamp );</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="keywordflow">return</span> fChannelReverseMap;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  }</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="comment">// Handy, typical string-splitting-to-vector function.</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="comment">// I hate C++ strong typing and string handling so very, very much.</span></div>
<div class="line"><a name="l00394"></a><span class="lineno"><a class="line" href="classutil_1_1DatabaseUtil.html#a674f0c2f98c0871cb313ee16e7f0ff96">  394</a></span>&#160;  std::vector&lt;std::string&gt; &amp; <a class="code" href="classutil_1_1DatabaseUtil.html#a674f0c2f98c0871cb313ee16e7f0ff96">DatabaseUtil::split</a>(<span class="keyword">const</span> std::string &amp;<a class="code" href="file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>, <span class="keywordtype">char</span> delim, std::vector&lt;std::string&gt; &amp;elems) {</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    std::stringstream ss(s);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    std::string item;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordflow">while</span> (std::getline(ss, item, delim)) {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      elems.push_back(item);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    }</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordflow">return</span> elems;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;}</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="keyword">namespace </span>util{</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  DEFINE_ART_SERVICE(DatabaseUtil)</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;} <span class="comment">// namespace util</span></div>
<div class="ttc" id="classutil_1_1DatabaseUtil_html_a9a92934a55b1c4f8ad63706eb24df0a6"><div class="ttname"><a href="classutil_1_1DatabaseUtil.html#a9a92934a55b1c4f8ad63706eb24df0a6">util::DatabaseUtil::GetTriggerOffsetFromDB</a></div><div class="ttdeci">int GetTriggerOffsetFromDB(int run, double &amp;T0_real)</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil__service_8cc_source.html#l00256">DatabaseUtil_service.cc:256</a></div></div>
<div class="ttc" id="classutil_1_1DatabaseUtil_html_a367d8e2f96ae331769c996355b019597"><div class="ttname"><a href="classutil_1_1DatabaseUtil.html#a367d8e2f96ae331769c996355b019597">util::DatabaseUtil::GetEfieldValuesFromDB</a></div><div class="ttdeci">int GetEfieldValuesFromDB(int run, std::vector&lt; double &gt; &amp;efield)</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil__service_8cc_source.html#l00192">DatabaseUtil_service.cc:192</a></div></div>
<div class="ttc" id="namespaceevd_html_a911fe581afad27a720ee200bd61362a6"><div class="ttname"><a href="namespaceevd.html#a911fe581afad27a720ee200bd61362a6">evd::err</a></div><div class="ttdeci">EResult err(const char *call)</div><div class="ttdef"><b>Definition:</b> <a href="WebEVDServer_8cxx_source.html#l00138">WebEVDServer.cxx:138</a></div></div>
<div class="ttc" id="PAC2020_2SBND_2helper_8h_html_a06f8f2157a91856986e2a76badd6fd3d"><div class="ttname"><a href="PAC2020_2SBND_2helper_8h.html#a06f8f2157a91856986e2a76badd6fd3d">POT</a></div><div class="ttdeci">double POT</div><div class="ttdef"><b>Definition:</b> <a href="PAC2020_2SBND_2helper_8h_source.html#l00062">helper.h:62</a></div></div>
<div class="ttc" id="selectors_8fcl_html_a24c8335057af14a9b508d5ac18999ce5"><div class="ttname"><a href="selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a></div><div class="ttdeci">pdgs p</div><div class="ttdef"><b>Definition:</b> <a href="selectors_8fcl_source.html#l00022">selectors.fcl:22</a></div></div>
<div class="ttc" id="classutil_1_1UBDaqID_html_a075ee2f66329bce898a4a0e4eba4ee0c"><div class="ttname"><a href="classutil_1_1UBDaqID.html#a075ee2f66329bce898a4a0e4eba4ee0c">util::UBDaqID::card</a></div><div class="ttdeci">int card</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil_8h_source.html#l00029">DatabaseUtil.h:29</a></div></div>
<div class="ttc" id="classutil_1_1DatabaseUtil_html_a4a0de563faf8c09918e02b9fa4e156cc"><div class="ttname"><a href="classutil_1_1DatabaseUtil.html#a4a0de563faf8c09918e02b9fa4e156cc">util::DatabaseUtil::DisConnect</a></div><div class="ttdeci">int DisConnect()</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil__service_8cc_source.html#l00058">DatabaseUtil_service.cc:58</a></div></div>
<div class="ttc" id="classutil_1_1DatabaseUtil_html_a0548d61e7fe30672f291ca4c28f42fa8"><div class="ttname"><a href="classutil_1_1DatabaseUtil.html#a0548d61e7fe30672f291ca4c28f42fa8">util::DatabaseUtil::GetUBChannelMap</a></div><div class="ttdeci">UBChannelMap_t GetUBChannelMap(int data_taking_timestamp=-1, int swizzling_timestamp=-1)</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil__service_8cc_source.html#l00382">DatabaseUtil_service.cc:382</a></div></div>
<div class="ttc" id="DatabaseUtil_8h_html"><div class="ttname"><a href="DatabaseUtil_8h.html">DatabaseUtil.h</a></div></div>
<div class="ttc" id="classutil_1_1UBDaqID_html_a4fb33219ecaed4943097c8a00e21dc82"><div class="ttname"><a href="classutil_1_1UBDaqID.html#a4fb33219ecaed4943097c8a00e21dc82">util::UBDaqID::channel</a></div><div class="ttdeci">int channel</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil_8h_source.html#l00030">DatabaseUtil.h:30</a></div></div>
<div class="ttc" id="namespacechannelDBConverter_html_a04bc3c278bbe16398deff10225d24c2f"><div class="ttname"><a href="namespacechannelDBConverter.html#a04bc3c278bbe16398deff10225d24c2f">channelDBConverter.conn</a></div><div class="ttdeci">tuple conn</div><div class="ttdef"><b>Definition:</b> <a href="channelDBConverter_8py_source.html#l00106">channelDBConverter.py:106</a></div></div>
<div class="ttc" id="classutil_1_1DatabaseUtil_html_a8c7d2cd159683eb48c220e899cad126f"><div class="ttname"><a href="classutil_1_1DatabaseUtil.html#a8c7d2cd159683eb48c220e899cad126f">util::DatabaseUtil::GetUBChannelReverseMap</a></div><div class="ttdeci">UBChannelReverseMap_t GetUBChannelReverseMap(int data_taking_timestamp=-1, int swizzling_timestamp=-1)</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil__service_8cc_source.html#l00387">DatabaseUtil_service.cc:387</a></div></div>
<div class="ttc" id="classutil_1_1DatabaseUtil_html_a3d278b1b8c1e7f305cf6453a16fca7b8"><div class="ttname"><a href="classutil_1_1DatabaseUtil.html#a3d278b1b8c1e7f305cf6453a16fca7b8">util::DatabaseUtil::SelectSingleFieldByQuery</a></div><div class="ttdeci">int SelectSingleFieldByQuery(std::vector&lt; std::string &gt; &amp;value, const char *query)</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil__service_8cc_source.html#l00111">DatabaseUtil_service.cc:111</a></div></div>
<div class="ttc" id="classutil_1_1DatabaseUtil_html_aabaf1d52648342641d4670d4bd22fb16"><div class="ttname"><a href="classutil_1_1DatabaseUtil.html#aabaf1d52648342641d4670d4bd22fb16">util::DatabaseUtil::conn</a></div><div class="ttdeci">PGconn * conn</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil_8h_source.html#l00079">DatabaseUtil.h:79</a></div></div>
<div class="ttc" id="classutil_1_1UBDaqID_html"><div class="ttname"><a href="classutil_1_1UBDaqID.html">util::UBDaqID</a></div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil_8h_source.html#l00021">DatabaseUtil.h:21</a></div></div>
<div class="ttc" id="classutil_1_1DatabaseUtil_html_ab5e495835f5fe47e0f270d5f2632c4be"><div class="ttname"><a href="classutil_1_1DatabaseUtil.html#ab5e495835f5fe47e0f270d5f2632c4be">util::DatabaseUtil::GetPOTFromDB</a></div><div class="ttdeci">int GetPOTFromDB(int run, long double &amp;POT)</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil__service_8cc_source.html#l00278">DatabaseUtil_service.cc:278</a></div></div>
<div class="ttc" id="find__global__symbol_8sh_html_acdadef1d07e090344b4ce37a603cff53"><div class="ttname"><a href="find__global__symbol_8sh.html#acdadef1d07e090344b4ce37a603cff53">field</a></div><div class="ttdeci">then echo echo For and will not be changed by echo further linking echo echo B echo The symbol is in the uninitialized data multiple common symbols may appear with the echo same name If the symbol is defined the common echo symbols are treated as undefined references For more echo details on common see the discussion of warn common echo in *Note Linker see the discussion of warn common echo in *Note Linker such as a global int variable echo as opposed to a large global array echo echo I echo The symbol is an indirect reference to another symbol This echo is a GNU extension to the a out object file format which is echo rarely used echo echo N echo The symbol is a debugging symbol echo echo R echo The symbol is in a read only data section echo echo S echo The symbol is in an uninitialized data section for small echo objects echo echo T echo The symbol is in the the normal defined echo symbol is used with no error When a weak undefined symbol echo is linked and the symbol is not the value of the echo weak symbol becomes zero with no error echo echo W echo The symbol is a weak symbol that has not been specifically echo tagged as a weak object symbol When a weak defined symbol echo is linked with a normal defined the normal defined echo symbol is used with no error When a weak undefined symbol echo is linked and the symbol is not the value of the echo weak symbol becomes zero with no error echo echo echo The symbol is a stabs symbol in an a out object file In echo this the next values printed are the stabs other field</div><div class="ttdef"><b>Definition:</b> <a href="find__global__symbol_8sh_source.html#l00107">find_global_symbol.sh:107</a></div></div>
<div class="ttc" id="classutil_1_1DatabaseUtil_html_ac505d447f271632587bb07d6cdc081a1"><div class="ttname"><a href="classutil_1_1DatabaseUtil.html#ac505d447f271632587bb07d6cdc081a1">util::DatabaseUtil::GetLifetimeFromDB</a></div><div class="ttdeci">int GetLifetimeFromDB(int run, double &amp;lftime_real)</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil__service_8cc_source.html#l00235">DatabaseUtil_service.cc:235</a></div></div>
<div class="ttc" id="classutil_1_1DatabaseUtil_html_ade644b5e80eaa24557b31b694b8fa4c0"><div class="ttname"><a href="classutil_1_1DatabaseUtil.html#ade644b5e80eaa24557b31b694b8fa4c0">util::DatabaseUtil::DatabaseUtil</a></div><div class="ttdeci">DatabaseUtil(fhicl::ParameterSet const &amp;pset)</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil__service_8cc_source.html#l00020">DatabaseUtil_service.cc:20</a></div></div>
<div class="ttc" id="classutil_1_1DatabaseUtil_html_a2dd2a357e7d49f3ed26ca303aa79ba1b"><div class="ttname"><a href="classutil_1_1DatabaseUtil.html#a2dd2a357e7d49f3ed26ca303aa79ba1b">util::DatabaseUtil::reconfigure</a></div><div class="ttdeci">void reconfigure(fhicl::ParameterSet const &amp;pset)</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil__service_8cc_source.html#l00071">DatabaseUtil_service.cc:71</a></div></div>
<div class="ttc" id="classutil_1_1DatabaseUtil_html_a2cd249540e0401cf805ebdd3478ade72"><div class="ttname"><a href="classutil_1_1DatabaseUtil.html#a2cd249540e0401cf805ebdd3478ade72">util::DatabaseUtil::LoadUBChannelMap</a></div><div class="ttdeci">void LoadUBChannelMap(int data_taking_timestamp=-1, int swizzling_timestamp=-1)</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil__service_8cc_source.html#l00301">DatabaseUtil_service.cc:301</a></div></div>
<div class="ttc" id="classutil_1_1DatabaseUtil_html_acc5e5ef8a9137fcb568acb2f5e9a4bb7"><div class="ttname"><a href="classutil_1_1DatabaseUtil.html#acc5e5ef8a9137fcb568acb2f5e9a4bb7">util::DatabaseUtil::SelectFieldByName</a></div><div class="ttdeci">int SelectFieldByName(std::vector&lt; std::string &gt; &amp;value, const char *field, const char *condition, const char *table)</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil__service_8cc_source.html#l00216">DatabaseUtil_service.cc:216</a></div></div>
<div class="ttc" id="classutil_1_1UBDaqID_html_a0fc54181f72306e8dd14fd6b5bef175a"><div class="ttname"><a href="classutil_1_1UBDaqID.html#a0fc54181f72306e8dd14fd6b5bef175a">util::UBDaqID::crate</a></div><div class="ttdeci">int crate</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil_8h_source.html#l00026">DatabaseUtil.h:26</a></div></div>
<div class="ttc" id="quiet__Math__Functor__test_8sh_html_adfac98fbd1e85554d2cf0454cdcbc717"><div class="ttname"><a href="quiet__Math__Functor__test_8sh.html#adfac98fbd1e85554d2cf0454cdcbc717">in</a></div><div class="ttdeci">if &amp;&amp;[-z&quot;$BASH_VERSION&quot;] then echo Attempting to switch to bash bash shellSwitch exit fi &amp;&amp;[&quot;$1&quot;= 'shellSwitch'] shift declare a IncludeDirectives for Dir in</div><div class="ttdef"><b>Definition:</b> <a href="quiet__Math__Functor__test_8sh_source.html#l00023">quiet_Math_Functor_test.sh:23</a></div></div>
<div class="ttc" id="namespaceutil_html_a097740c1c11a734156bf86e85b210e1b"><div class="ttname"><a href="namespaceutil.html#a097740c1c11a734156bf86e85b210e1b">util::UBChannelMap_t</a></div><div class="ttdeci">std::map&lt; UBDaqID, UBLArSoftCh_t &gt; UBChannelMap_t</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil_8h_source.html#l00048">DatabaseUtil.h:48</a></div></div>
<div class="ttc" id="file__to__url_8sh_html_a096ad3d3698082826189c839d7a6e46f"><div class="ttname"><a href="file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a></div><div class="ttdeci">then echo File list $list not found else cat $list while read file do echo $file sed s</div><div class="ttdef"><b>Definition:</b> <a href="file__to__url_8sh_source.html#l00060">file_to_url.sh:60</a></div></div>
<div class="ttc" id="classutil_1_1DatabaseUtil_html_a496875220259db67789b3cace64143c1"><div class="ttname"><a href="classutil_1_1DatabaseUtil.html#a496875220259db67789b3cace64143c1">util::DatabaseUtil::Connect</a></div><div class="ttdeci">int Connect(int conn_wait=0)</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil__service_8cc_source.html#l00029">DatabaseUtil_service.cc:29</a></div></div>
<div class="ttc" id="classutil_1_1DatabaseUtil_html_a674f0c2f98c0871cb313ee16e7f0ff96"><div class="ttname"><a href="classutil_1_1DatabaseUtil.html#a674f0c2f98c0871cb313ee16e7f0ff96">util::DatabaseUtil::split</a></div><div class="ttdeci">std::vector&lt; std::string &gt; &amp; split(const std::string &amp;s, char delim, std::vector&lt; std::string &gt; &amp;elems)</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil__service_8cc_source.html#l00394">DatabaseUtil_service.cc:394</a></div></div>
<div class="ttc" id="pmtsimulation__icarus_8fcl_html_a9fc569190f32b40862f18ac3c03a8e49"><div class="ttname"><a href="pmtsimulation__icarus_8fcl.html#a9fc569190f32b40862f18ac3c03a8e49">value</a></div><div class="ttdeci">temporary value</div><div class="ttdef"><b>Definition:</b> <a href="pmtsimulation__icarus_8fcl_source.html#l00158">pmtsimulation_icarus.fcl:158</a></div></div>
<div class="ttc" id="namespaceutil_html_a212740e3c13bae3ed850ef0310bbb62e"><div class="ttname"><a href="namespaceutil.html#a212740e3c13bae3ed850ef0310bbb62e">util::UBChannelReverseMap_t</a></div><div class="ttdeci">std::map&lt; UBLArSoftCh_t, UBDaqID &gt; UBChannelReverseMap_t</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil_8h_source.html#l00049">DatabaseUtil.h:49</a></div></div>
<div class="ttc" id="messageservice_8fcl_html_a6699b4dbd72f548e48d81c88697d35a6"><div class="ttname"><a href="messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">cout</a></div><div class="ttdeci">BEGIN_PROLOG could also be cout</div><div class="ttdef"><b>Definition:</b> <a href="messageservice_8fcl_source.html#l00010">messageservice.fcl:10</a></div></div>
<div class="ttc" id="classutil_1_1DatabaseUtil_html_a28ad29857dc258067ed0f471d48e1c67"><div class="ttname"><a href="classutil_1_1DatabaseUtil.html#a28ad29857dc258067ed0f471d48e1c67">util::DatabaseUtil::fChannelReverseMap</a></div><div class="ttdeci">UBChannelReverseMap_t fChannelReverseMap</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil_8h_source.html#l00090">DatabaseUtil.h:90</a></div></div>
<div class="ttc" id="classutil_1_1DatabaseUtil_html_ab81ecce8b3ab64db68889cc1b938c8a7"><div class="ttname"><a href="classutil_1_1DatabaseUtil.html#ab81ecce8b3ab64db68889cc1b938c8a7">util::DatabaseUtil::GetTemperatureFromDB</a></div><div class="ttdeci">int GetTemperatureFromDB(int run, double &amp;temp_real)</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil__service_8cc_source.html#l00171">DatabaseUtil_service.cc:171</a></div></div>
<div class="ttc" id="classutil_1_1DatabaseUtil_html_afc92bcd2ed0306d8afd69412863f205e"><div class="ttname"><a href="classutil_1_1DatabaseUtil.html#afc92bcd2ed0306d8afd69412863f205e">util::DatabaseUtil::fChannelMap</a></div><div class="ttdeci">UBChannelMap_t fChannelMap</div><div class="ttdef"><b>Definition:</b> <a href="DatabaseUtil_8h_source.html#l00089">DatabaseUtil.h:89</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
