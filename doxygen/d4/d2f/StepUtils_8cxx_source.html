<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>StepUtils.cxx Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_b73b02d482d1c4a3db20c3d9ad52d395.html">srcs</a></li><li class="navelem"><a class="el" href="../../dir_f58b2474d7db671760af109c057c9f12.html">larreco</a></li><li class="navelem"><a class="el" href="../../dir_bfd42686fcf7bc0e8145fd17787a17cd.html">larreco</a></li><li class="navelem"><a class="el" href="../../dir_a92975983e87729a773cfa3b8109c8c3.html">RecoAlg</a></li><li class="navelem"><a class="el" href="../../dir_97d1557fbe068d828f11bc325c855899.html">TCAlg</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">StepUtils.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d4/d2f/StepUtils_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/df0/StepUtils_8h.html">larreco/RecoAlg/TCAlg/StepUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;limits.h&gt;</span>                                        <span class="comment">// for USHRT_MAX</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span>                                        <span class="comment">// for abs, size_t</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span>                                           <span class="comment">// for sqrt, atan</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span>                                       <span class="comment">// for find, max</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;array&gt;</span>                                           <span class="comment">// for array, arr...</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;bitset&gt;</span>                                          <span class="comment">// for bitset&lt;&gt;::...</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;iomanip&gt;</span>                                         <span class="comment">// for operator&lt;&lt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span>                                        <span class="comment">// for cout</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/d38/RawTypes_8h.html">larcoreobj/SimpleTypesAndConstants/RawTypes.h</a>&quot;</span>   <span class="comment">// for TDCtick_t</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d48/geo__types_8h.html">larcoreobj/SimpleTypesAndConstants/geo_types.h</a>&quot;</span>  <span class="comment">// for PlaneID</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/d26/Hit_8h.html">lardataobj/RecoBase/Hit.h</a>&quot;</span>                       <span class="comment">// for Hit</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/db2/DebugStruct_8h.html">larreco/RecoAlg/TCAlg/DebugStruct.h</a>&quot;</span>             <span class="comment">// for DebugStuff</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d65/TCVertex_8h.html">larreco/RecoAlg/TCAlg/TCVertex.h</a>&quot;</span>                <span class="comment">// for tcc, evt</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d0a/larreco_2larreco_2RecoAlg_2TCAlg_2Utils_8h.html">larreco/RecoAlg/TCAlg/Utils.h</a>&quot;</span>                   <span class="comment">// for SetEndPoints</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;math.h&gt;</span>                                          <span class="comment">// for abs, nearb...</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;numeric&gt;</span>                                         <span class="comment">// for iota</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span>                                          <span class="comment">// for basic_string</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;utility&gt;</span>                                         <span class="comment">// for pair</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span>                                          <span class="comment">// for vector</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;messagefacility/MessageLogger/MessageLogger.h&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">namespace </span>tca {</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">  //////////////////////////////////////////</span></div>
<div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#afc867fb26ea8184ca8285f7f65822b0d">   28</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#afc867fb26ea8184ca8285f7f65822b0d">StepAway</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj)</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  {</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="comment">// Step along the direction specified in the traj vector in steps of size step</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="comment">// (wire spacing equivalents). Find hits between the last trajectory point and</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="comment">// the last trajectory point + step. A new trajectory point is added if hits are</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="comment">// found. Stepping continues until no signal is found for two consecutive steps</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="comment">// or until a wire or time boundary is reached.</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a9ba64d632bc17b16226d212f27dbc0aa">CTP</a>).<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> lastPtWithUsedHits = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1];</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> lastPt = lastPtWithUsedHits;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="comment">// Construct a local TP from the last TP that will be moved on each step.</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment">// Only the Pos and Dir variables will be used</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a> ltp;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a00fdf2d73e4a03e5a7f32411e460ba2e">CTP</a> = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a9ba64d632bc17b16226d212f27dbc0aa">CTP</a>;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a> = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt].Pos;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a> = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt].Dir;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="comment">// A second TP is cloned from the leading TP of tj, updated with hits, fit</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="comment">// parameters,etc and possibly pushed onto tj as the next TP</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a> tp;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// assume it is good from here on</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nMissedSteps = 0;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">// Use MaxChi chisq cut for stiff trajectories</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keywordtype">bool</span> useMaxChiCut = (tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ab2c0db630cd45caff1c041d639c5f253">PDGCode</a> == 13 || !tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bcaea92f268de1c89bd1bdcf4913ca4f84d">kSlowing</a>]);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">// Get the first forecast when there are 6 points with charge</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a1a93908a64cd734cc9f4418d944b14e6">tjfs</a>.resize(1);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a1a93908a64cd734cc9f4418d944b14e6">tjfs</a>[0].nextForecastUpdate = 6;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> step = 1; step &lt; 10000; ++step) {</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> npwc = <a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      <span class="comment">// analyze the Tj when there are 6 points to see if we should stop</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      <span class="keywordflow">if</span>(npwc == 6 &amp;&amp; <a class="code" href="../../de/d0f/namespacetca.html#a1dfe0638dfd5cd170a8740b585e9202d">StopShort</a>(slc, tj, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>)) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      <span class="comment">// Get a forecast of what is ahead.</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aa7618b0b19909f24d6f92e03793cb10f">doForecast</a> &amp;&amp; !tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">kRvPrp</a>] &amp;&amp; npwc == <a class="code" href="../../de/d0f/namespacetca.html#a1a93908a64cd734cc9f4418d944b14e6">tjfs</a>[<a class="code" href="../../de/d0f/namespacetca.html#a1a93908a64cd734cc9f4418d944b14e6">tjfs</a>.size() - 1].nextForecastUpdate) {</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#acdd7ac022c72d9b8095ffa3bad46add7">Forecast</a>(slc, tj);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#a48a06244eed9c28efa59c26d724ce296">SetStrategy</a>(slc, tj);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#a93d437bed41640ef1d53f01e465d1778">SetPDGCode</a>(slc, tj);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      }</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      <span class="comment">// make a copy of the previous TP</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      lastPt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() - 1;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      tp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt];</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      ++tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ab27d5353e9075152365d91cc0f0d0864">Step</a>;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      <span class="keywordtype">double</span> stepSize = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a0b39677cc3d897476deca9722674981e">VLAStepSize</a>;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <span class="keywordflow">if</span>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#af4135bac344253d4fecaca6369722c0a">AngleCode</a> &lt; 2) stepSize = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(1/ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0]);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      <span class="comment">// move the local TP position by one step in the right direction</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> iwt = 0; iwt &lt; 2; ++iwt) ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[iwt] += ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[iwt] * stepSize;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      <span class="comment">// copy this position into tp</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a> = ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a> = ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        myprt&lt;&lt;<span class="stringliteral">&quot;StepAway &quot;</span>&lt;&lt;step&lt;&lt;<span class="stringliteral">&quot; Pos &quot;</span>&lt;&lt;tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0]&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1]&lt;&lt;<span class="stringliteral">&quot; Dir &quot;</span>&lt;&lt;tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0]&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[1]&lt;&lt;<span class="stringliteral">&quot; stepSize &quot;</span>&lt;&lt;stepSize&lt;&lt;<span class="stringliteral">&quot; AngCode &quot;</span>&lt;&lt;tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#af4135bac344253d4fecaca6369722c0a">AngleCode</a>&lt;&lt;<span class="stringliteral">&quot; Strategy&quot;</span>;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ibt = 0; ibt &lt; <a class="code" href="../../de/d0f/namespacetca.html#af74e4c6958ff843062a35c3e14420822">StrategyBitNames</a>.size(); ++ibt) {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;          <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[ibt]) myprt&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#af74e4c6958ff843062a35c3e14420822">StrategyBitNames</a>[ibt];</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        } <span class="comment">// ib</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      } <span class="comment">// tcc.dbgStp</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <span class="comment">// hit the boundary of the TPC?</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      <span class="keywordflow">if</span>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] &lt; 0 || tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] &gt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a0e1b21e405c44f25011980f0130c5444">maxPos0</a>[plane] ||</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;         tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1] &lt; 0 || tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1] &gt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#afabba7c8b331f67ab8698bdb154b6f3c">maxPos1</a>[plane]) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <span class="comment">// remove the old hits and other stuff</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.clear();</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>.reset();</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a> = 0; tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a> = 0;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a4ea82b67f2bc6ffc158950e8a51095e4">Environment</a>.reset();</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wire = std::nearbyint(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0]);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#a08d6f9aad54acbd12cfcc44e77e6e29d">goodWire</a>[plane][wire]) tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a4ea82b67f2bc6ffc158950e8a51095e4">Environment</a>[<a class="code" href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525a6ed9c1ffc232022aa71db806f25ab10d">kEnvNotGoodWire</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      <span class="comment">// append to the trajectory</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.push_back(tp);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      <span class="comment">// update the index of the last TP</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      lastPt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() - 1;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      <span class="comment">// look for hits</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      <span class="keywordtype">bool</span> sigOK = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#aa0294becb454d8cc7d38fe341641cfbf">AddHits</a>(slc, tj, lastPt, sigOK);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      <span class="comment">// Check the stop flag</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afa6980f5646e419795cdc43499a55104">EndFlag</a>[1][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aad2a088fe0e3ebe65f881c0403c3f336f">kAtTj</a>]) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      <span class="comment">// If successfull, AddHits has defined UseHit for this TP,</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      <span class="comment">// set the trajectory endpoints, and define HitPos.</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt].Hits.empty() &amp;&amp; !tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt].Environment[<a class="code" href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525a0d1d499b20081267ac554e515103dbe7">kEnvNearSrcHit</a>]) {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <span class="comment">// Require three points with charge on adjacent wires for small angle</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="comment">// stepping.</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt].AngleCode == 0 &amp;&amp; lastPt == 2) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="comment">// No close hits added.</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        ++nMissedSteps;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="comment">// First check for no signal in the vicinity. AddHits checks the hit collection for</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="comment">// the current slice. This version of SignalAtTp checks the allHits collection.</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        sigOK = <a class="code" href="../../de/d0f/namespacetca.html#af522808f94ccf75807e228fad5f2b5dd">SignalAtTp</a>(ltp);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="keywordflow">if</span>(lastPt &gt; 0) {</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;          <span class="comment">// break if this is a reverse propagate activity and there was no signal (not on a dead wire)</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;          <span class="keywordflow">if</span>(!sigOK &amp;&amp; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">kRvPrp</a>]) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;          <span class="comment">// Ensure that there is a signal here after missing a number of steps on a LA trajectory</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;          <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt].AngleCode &gt; 0 &amp;&amp; nMissedSteps &gt; 4 &amp;&amp; !sigOK) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;          <span class="comment">// the last point with hits (used or not) is the previous point</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> lastPtWithHits = lastPt - 1;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;          <span class="keywordtype">float</span> tps = <a class="code" href="../../de/d0f/namespacetca.html#a147ffd18bc86e618807de788da237640">TrajPointSeparation</a>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPtWithHits], ltp);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;          <span class="keywordtype">float</span> dwc = <a class="code" href="../../de/d0f/namespacetca.html#a757156ec709046f601b18c87c62742f8">DeadWireCount</a>(slc, ltp, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPtWithHits]);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;          <span class="keywordtype">float</span> nMissedWires = tps * <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0]) - dwc;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;          <span class="keywordtype">float</span> maxWireSkip = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aae03d6a71d412978f5c8934c779254b1">maxWireSkipNoSignal</a>;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;          <span class="keywordflow">if</span>(sigOK) maxWireSkip = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aac4b30d557f3cf516046494167515a75">maxWireSkipWithSignal</a>;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; StepAway: no hits found at ltp &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, ltp)</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;              &lt;&lt;<span class="stringliteral">&quot; nMissedWires &quot;</span>&lt;&lt;std::fixed&lt;&lt;std::setprecision(1)&lt;&lt;nMissedWires</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;              &lt;&lt;<span class="stringliteral">&quot; dead wire count &quot;</span>&lt;&lt;dwc&lt;&lt;<span class="stringliteral">&quot; maxWireSkip &quot;</span>&lt;&lt;maxWireSkip&lt;&lt;<span class="stringliteral">&quot; tj.PDGCode &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ab2c0db630cd45caff1c041d639c5f253">PDGCode</a>;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;          <span class="keywordflow">if</span>(nMissedWires &gt; maxWireSkip) {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            <span class="comment">// We passed a number of wires without adding hits and are ready to quit.</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            <span class="comment">// First see if there is one good unused hit on the end TP and if so use it</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            <span class="comment">// lastPtWithHits + 1 == lastPt &amp;&amp; tj.Pts[lastPtWithHits].Chg == 0 &amp;&amp; tj.Pts[lastPtWithHits].Hits.size() == 1</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() - 1 &amp;&amp; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]+1].Hits.size() == 1) {</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;              <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> lastLonelyPoint = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] + 1;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;              <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastLonelyPoint].Hits[0];</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;              <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj == 0 &amp;&amp; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastLonelyPoint].Delta &lt; 3 * tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastLonelyPoint].DeltaRMS) {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastLonelyPoint].UseHit[0] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                <a class="code" href="../../de/d0f/namespacetca.html#adcfb1da7e005bcdbdd61dc5baf815be1">DefineHitPos</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastLonelyPoint]);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                  mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; Added a Last Lonely Hit before breaking &quot;</span>;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                  <a class="code" href="../../de/d0f/namespacetca.html#a1224974e5441b11c2d315fe5912feb75">PrintTP</a>(<span class="stringliteral">&quot;LLH&quot;</span>, slc, lastPt, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a3d0690a80fbffcedf93b202d1c7bd0cd">StepDir</a>, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a77b3a6b92ddd696b3dec9d7581f6503e">Pass</a>, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastLonelyPoint]);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                }</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;              }</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;          }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        } <span class="comment">// lastPt &gt; 0</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="comment">// no sense keeping this TP on tj if no hits were added</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.pop_back();</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      } <span class="comment">// tj.Pts[lastPt].Hits.empty()</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      <span class="comment">// ensure that we actually moved</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      <span class="keywordflow">if</span>(lastPt &gt; 0 &amp;&amp; <a class="code" href="../../de/d0f/namespacetca.html#a1c2bea68a634d09340f7921072d5acda">PosSep2</a>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt].Pos, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt-1].Pos) &lt; 0.1) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <span class="comment">// Found hits at this location so reset the missed steps counter</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      nMissedSteps = 0;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <span class="comment">// Update the last point fit, etc using the just added hit(s)</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#af86f6315648e0dbb5e400f35ea97e72c">UpdateTraj</a>(slc, tj);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      <span class="comment">// a failure occurred</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f57aca44660b87327393e6a4694e570">NeedsUpdate</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt].Chg == 0) {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="comment">// There are points on the trajectory by none used in the last step. See</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="comment">// how long this has been going on</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="keywordtype">float</span> tps = <a class="code" href="../../de/d0f/namespacetca.html#a147ffd18bc86e618807de788da237640">TrajPointSeparation</a>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]], ltp);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordtype">float</span> dwc = <a class="code" href="../../de/d0f/namespacetca.html#a757156ec709046f601b18c87c62742f8">DeadWireCount</a>(slc, ltp, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]]);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordtype">float</span> nMissedWires = tps * <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0]) - dwc;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>)  mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; Hits exist on the trajectory but are not used. Missed wires &quot;</span>&lt;&lt;std::nearbyint(nMissedWires)&lt;&lt;<span class="stringliteral">&quot; dead wire count &quot;</span>&lt;&lt;(int)dwc;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="comment">// break if this is a reverse propagate activity with no dead wires</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">kRvPrp</a>] &amp;&amp; dwc == 0) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keywordflow">if</span>(nMissedWires &gt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aac4b30d557f3cf516046494167515a75">maxWireSkipWithSignal</a>) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="comment">// try this out</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a61681325bce0b3240611ea1e274c4cc0">MaskedHitsOK</a>(slc, tj)) {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="comment">// check for a series of bad fits and stop stepping</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da083602d3b7924dcd839998951bf8385f">kStopBadFits</a>] &amp;&amp; nMissedWires &gt; 4 &amp;&amp; <a class="code" href="../../de/d0f/namespacetca.html#ac89b171f7383a83708fa8244202b0bab">StopIfBadFits</a>(slc, tj)) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="comment">// Keep stepping</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;          <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">kRvPrp</a>]) {</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            <a class="code" href="../../de/d0f/namespacetca.html#a5005f83120a22b0f059526653af3cb6f">PrintTrajectory</a>(<span class="stringliteral">&quot;RP&quot;</span>, slc, tj, lastPt);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            <a class="code" href="../../de/d0f/namespacetca.html#a5005f83120a22b0f059526653af3cb6f">PrintTrajectory</a>(<span class="stringliteral">&quot;SC&quot;</span>, slc, tj, lastPt);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;          }</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        }</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      } <span class="comment">// tp.Hits.empty()</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() == 3) {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="comment">// ensure that the last hit added is in the same direction as the first two.</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="comment">// This is a simple way of doing it</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="keywordtype">bool</span> badTj = (<a class="code" href="../../de/d0f/namespacetca.html#a1c2bea68a634d09340f7921072d5acda">PosSep2</a>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[0].HitPos, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[2].HitPos) &lt; <a class="code" href="../../de/d0f/namespacetca.html#a1c2bea68a634d09340f7921072d5acda">PosSep2</a>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[0].HitPos, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[1].HitPos));</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="comment">// ensure that this didn&#39;t start as a small angle trajectory and immediately turn</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="comment">// into a large angle one</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="keywordflow">if</span>(!badTj &amp;&amp; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt].AngleCode &gt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a39c851105c2a3331e8f051ccdf86f49e">maxAngleCode</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a77b3a6b92ddd696b3dec9d7581f6503e">Pass</a>]) badTj = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="comment">// check for a large change in angle</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="keywordflow">if</span>(!badTj) {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;          <span class="keywordtype">float</span> dang = <a class="code" href="../../de/d0f/namespacetca.html#a3817156934849ad2042f29fcd347c466">DeltaAngle</a>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[0].Ang, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[2].Ang);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;          <span class="keywordflow">if</span>(dang &gt; 0.5) badTj = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="comment">//check for a wacky delta</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="keywordflow">if</span>(!badTj &amp;&amp; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[2].Delta &gt; 2) badTj = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="keywordflow">if</span>(badTj) {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; Bad Tj found on the third point. Quit stepping.&quot;</span>;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;          tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        }</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      } <span class="comment">// tj.Pts.size() == 3</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <span class="comment">// Update the local TP with the updated position and direction</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a> = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt].Pos;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a> = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt].Dir;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#abca1a7f1413e9b9e5d6fedb638047cda">MaskedLastTP</a>) {</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="comment">// see if TPs have been masked off many times and if the</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="comment">// environment is clean. If so, return and try with next pass</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="comment">// cuts</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a61681325bce0b3240611ea1e274c4cc0">MaskedHitsOK</a>(slc, tj)) {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">kRvPrp</a>]) {</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;              <a class="code" href="../../de/d0f/namespacetca.html#a5005f83120a22b0f059526653af3cb6f">PrintTrajectory</a>(<span class="stringliteral">&quot;RP&quot;</span>, slc, tj, lastPt);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;              <a class="code" href="../../de/d0f/namespacetca.html#a5005f83120a22b0f059526653af3cb6f">PrintTrajectory</a>(<span class="stringliteral">&quot;SC&quot;</span>, slc, tj, lastPt);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;          }</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        }</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;          <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">kRvPrp</a>]) {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            <a class="code" href="../../de/d0f/namespacetca.html#a5005f83120a22b0f059526653af3cb6f">PrintTrajectory</a>(<span class="stringliteral">&quot;RP&quot;</span>, slc, tj, lastPt);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            <a class="code" href="../../de/d0f/namespacetca.html#a5005f83120a22b0f059526653af3cb6f">PrintTrajectory</a>(<span class="stringliteral">&quot;SC&quot;</span>, slc, tj, lastPt);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;          }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        }</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <span class="comment">// We have added a TP with hits</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <span class="comment">// check for a kink. Stop crawling if one is found</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a6a54ab1f3f863b27a59209d44cf402b2">GottaKink</a>(slc, tj, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afa6980f5646e419795cdc43499a55104">EndFlag</a>[1][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa8a209073700148c7515fa38bae5e2873">kAtKink</a>]) {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;   stop at kink&quot;</span>;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      }</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="comment">// See if the Chisq/DOF exceeds the maximum.</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="comment">// UpdateTraj should have reduced the number of points fit</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="comment">// as much as possible for this pass, so this trajectory is in trouble.</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt].FitChi &gt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abd23e3a0f00daade6967bbfef88a6250">maxChi</a> &amp;&amp; useMaxChiCut) {</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;   bad FitChi &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt].FitChi&lt;&lt;<span class="stringliteral">&quot; cut &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abd23e3a0f00daade6967bbfef88a6250">maxChi</a>;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="comment">// remove the last point before quitting</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#a20bf265ff689ff64027c4d072e7ed598">UnsetUsedHits</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt]);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a> = (<a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">true</span>) &gt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a986b7f09cec52728d16e43511d5c4e3f">minPtsFit</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a77b3a6b92ddd696b3dec9d7581f6503e">Pass</a>]);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">kRvPrp</a>]) {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;          <a class="code" href="../../de/d0f/namespacetca.html#a5005f83120a22b0f059526653af3cb6f">PrintTrajectory</a>(<span class="stringliteral">&quot;RP&quot;</span>, slc, tj, lastPt);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;          <a class="code" href="../../de/d0f/namespacetca.html#a5005f83120a22b0f059526653af3cb6f">PrintTrajectory</a>(<span class="stringliteral">&quot;SC&quot;</span>, slc, tj, lastPt);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      } <span class="comment">// tcc.dbgStp</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    } <span class="comment">// step</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a93d437bed41640ef1d53f01e465d1778">SetPDGCode</a>(slc, tj);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;End StepAway with tj size &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size();</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  } <span class="comment">// StepAway</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">//////////////////////////////////////////</span></div>
<div class="line"><a name="l00277"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a1dfe0638dfd5cd170a8740b585e9202d">  277</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="../../de/d0f/namespacetca.html#a1dfe0638dfd5cd170a8740b585e9202d">StopShort</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj, <span class="keywordtype">bool</span> prt)</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="comment">// Analyze the trajectory when it is short (~6 points) to look for a pattern like</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="comment">// this QQQqqq, where Q is a large charge hit and q is a low charge hit. If this</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">// pattern is found, this function removes the last 3 points and returns true.</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="comment">// The calling function (e.g. StepAway) should decide what to do (e.g. stop stepping)</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="comment">// don&#39;t use this function during reverse propagation</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">kRvPrp</a>]) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5dabea8d0fedf7ef540d0f6947b32b90c45">kStopShort</a>]) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> npwc = <a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordflow">if</span>(npwc &gt; 10) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <a class="code" href="../../d0/df5/structtca_1_1ParFit.html">ParFit</a> chgFit;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#ad65fd0c31d447ba7b3731ae451ceb08f">FitPar</a>(slc, tj, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0], npwc, 1, chgFit, 1);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">if</span>(prt) {</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot;StopShort: chgFit at &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0]]);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; ChiDOF &quot;</span>&lt;&lt;chgFit.<a class="code" href="../../d0/df5/structtca_1_1ParFit.html#abf9afd041123dbaa76614a40759c2f23">ChiDOF</a>;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; chg0 &quot;</span>&lt;&lt;chgFit.<a class="code" href="../../d0/df5/structtca_1_1ParFit.html#ac1072247a30ee4ce14d466cf32b709fb">Par0</a>&lt;&lt;<span class="stringliteral">&quot; +/- &quot;</span>&lt;&lt;chgFit.<a class="code" href="../../d0/df5/structtca_1_1ParFit.html#abcd45b84f4ba5d79c9508bbb7214173f">ParErr</a>;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; slp &quot;</span>&lt;&lt;chgFit.<a class="code" href="../../d0/df5/structtca_1_1ParFit.html#a62d0958a63058e8239dc8d5d7d785f59">ParSlp</a>&lt;&lt;<span class="stringliteral">&quot; +/- &quot;</span>&lt;&lt;chgFit.<a class="code" href="../../d0/df5/structtca_1_1ParFit.html#a4dc41844d36f4314f83dc43b5994ce37">ParSlpErr</a>;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    } <span class="comment">// prt</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="comment">// Look for a poor charge fit ChiDOF and a significant negative slope. These cuts</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="comment">// **should** prevent removing a genuine Bragg peak at the start, which should have</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="comment">// a good ChiDOF</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordflow">if</span>(chgFit.<a class="code" href="../../d0/df5/structtca_1_1ParFit.html#abf9afd041123dbaa76614a40759c2f23">ChiDOF</a> &lt; 2) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">if</span>(chgFit.<a class="code" href="../../d0/df5/structtca_1_1ParFit.html#a62d0958a63058e8239dc8d5d7d785f59">ParSlp</a> &gt; -20) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordflow">if</span>(prt) <a class="code" href="../../de/d0f/namespacetca.html#a5005f83120a22b0f059526653af3cb6f">PrintTrajectory</a>(<span class="stringliteral">&quot;SS&quot;</span>, slc, tj, USHRT_MAX);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="comment">// Find the average charge using the first 3 points</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordtype">float</span> cnt = 0;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordtype">float</span> aveChg = 0;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> lastHiPt = 0;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = 0; ipt &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size(); ++ipt) {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="keyword">auto</span>&amp; tp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt];</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="keywordflow">if</span>(tp.Chg &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      aveChg += tp.Chg;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      ++cnt;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      lastHiPt = ipt;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      <span class="keywordflow">if</span>(cnt == 3) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    } <span class="comment">// tp</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">if</span>(cnt &lt; 3) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    aveChg /= cnt;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;  aveChg &quot;</span>&lt;&lt;(int)aveChg&lt;&lt;<span class="stringliteral">&quot; last TP AveChg &quot;</span>&lt;&lt;(<span class="keywordtype">int</span>)tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]].AveChg;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="comment">// Look for a sudden drop in the charge (&lt; 1/2)</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> firstLoPt = lastHiPt + 1;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = lastHiPt + 1; ipt &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size(); ++ipt) {</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <span class="keyword">auto</span>&amp; tp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt];</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="keywordflow">if</span>(tp.Chg &lt;= 0 || tp.Chg &gt; 0.5 * aveChg) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      firstLoPt = ipt;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;    stop tracking at &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[firstLoPt]);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="comment">// Remove everything from the firstLoPt to the end of the trajectory</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = firstLoPt; ipt &lt;= tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]; ++ipt) <a class="code" href="../../de/d0f/namespacetca.html#a20bf265ff689ff64027c4d072e7ed598">UnsetUsedHits</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt]);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a45584aa4b4e3ca2963ed52c7e5a28ff8">UpdateTjChgProperties</a>(<span class="stringliteral">&quot;SS&quot;</span>, slc, tj, prt);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5dabea8d0fedf7ef540d0f6947b32b90c45">kStopShort</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  } <span class="comment">// StopShort</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">//////////////////////////////////////////</span></div>
<div class="line"><a name="l00338"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a48a06244eed9c28efa59c26d724ce296">  338</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#a48a06244eed9c28efa59c26d724ce296">SetStrategy</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj)</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  {</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="comment">// Determine if the tracking strategy is appropriate and make some tweaks if it isn&#39;t</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a1a93908a64cd734cc9f4418d944b14e6">tjfs</a>.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="comment">// analyze the last forecast</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keyword">auto</span>&amp; tjf = <a class="code" href="../../de/d0f/namespacetca.html#a1a93908a64cd734cc9f4418d944b14e6">tjfs</a>[<a class="code" href="../../de/d0f/namespacetca.html#a1a93908a64cd734cc9f4418d944b14e6">tjfs</a>.size() - 1];</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keyword">auto</span>&amp; lastTP = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]];</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="comment">// Stay in Slowing strategy if we are in it and reduce the number of points fit further</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bcaea92f268de1c89bd1bdcf4913ca4f84d">kSlowing</a>]) {</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      lastTP.NTPsFit = 5;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    }</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordtype">float</span> npwc = <a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="comment">// Keep using the StiffMu strategy if the tj is long and MCSMom is high</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bca55868aa9ed90ec1727bec61ae58cae5c">kStiffMu</a>] &amp;&amp; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a> &gt; 800 &amp;&amp; npwc &gt; 200) {</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;SetStrategy: Keep using the StiffMu strategy&quot;</span>;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    }</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordtype">bool</span> tkLike = (tjf.outlook &lt; 1.5);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="comment">// A showering-electron-like trajectory</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordtype">bool</span> chgIncreasing = (tjf.chgSlope &gt; 0);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="comment">// A showering-electron-like trajectory</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keywordtype">bool</span> shLike = (tjf.outlook &gt; 2 &amp;&amp; chgIncreasing);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordflow">if</span>(!shLike) shLike = tjf.showerLikeFraction &gt; 0.5;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordtype">float</span> momRat = 0;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a> &gt; 0) momRat = (float)tjf.MCSMom / (<span class="keywordtype">float</span>)tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a>;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot;SetStrategy: npwc &quot;</span>&lt;&lt;npwc&lt;&lt;<span class="stringliteral">&quot; outlook &quot;</span>&lt;&lt;tjf.outlook;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; tj MCSMom &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a>&lt;&lt;<span class="stringliteral">&quot; forecast MCSMom &quot;</span>&lt;&lt;tjf.MCSMom;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; momRat &quot;</span>&lt;&lt;std::fixed&lt;&lt;std::setprecision(2)&lt;&lt;momRat;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; tkLike? &quot;</span>&lt;&lt;tkLike&lt;&lt;<span class="stringliteral">&quot; shLike? &quot;</span>&lt;&lt;shLike;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; chgIncreasing? &quot;</span>&lt;&lt;chgIncreasing;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; leavesBeforeEnd? &quot;</span>&lt;&lt;tjf.leavesBeforeEnd&lt;&lt;<span class="stringliteral">&quot; endBraggPeak? &quot;</span>&lt;&lt;tjf.endBraggPeak;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; nextForecastUpdate &quot;</span>&lt;&lt;tjf.nextForecastUpdate;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    }</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">if</span>(tjf.outlook &lt; 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="comment">// Look for a long clean muon in the forecast</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordtype">bool</span> stiffMu = (tkLike &amp;&amp; tjf.MCSMom &gt; 600 &amp;&amp; tjf.nextForecastUpdate &gt; 100);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordflow">if</span>(stiffMu) {</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;SetStrategy: High MCSMom, long forecast. Use the StiffMu strategy&quot;</span>;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>.reset();</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bca55868aa9ed90ec1727bec61ae58cae5c">kStiffMu</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    } <span class="comment">// StiffMu</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordtype">bool</span> notStiff = (!tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bca881b9d556e1114d8cce02b75d65120db">kStiffEl</a>] &amp;&amp; !tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bca55868aa9ed90ec1727bec61ae58cae5c">kStiffMu</a>]);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordflow">if</span>(notStiff &amp;&amp; !shLike &amp;&amp; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a> &lt; 100 &amp;&amp; tjf.MCSMom &lt; 100 &amp;&amp; chgIncreasing) {</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;SetStrategy: Low MCSMom. Use the Slowing Tj strategy&quot;</span>;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>.reset();</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bcaea92f268de1c89bd1bdcf4913ca4f84d">kSlowing</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      lastTP.NTPsFit = 5;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    } <span class="comment">// Low MCSMom</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordflow">if</span>(notStiff &amp;&amp; !shLike &amp;&amp; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a> &lt; 200 &amp;&amp; momRat &lt; 0.7 &amp;&amp; chgIncreasing) {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;SetStrategy: Low MCSMom &amp; low momRat. Use the Slowing Tj strategy&quot;</span>;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>.reset();</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bcaea92f268de1c89bd1bdcf4913ca4f84d">kSlowing</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      lastTP.NTPsFit = 5;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    } <span class="comment">// low MCSMom</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordflow">if</span>(!tjf.leavesBeforeEnd &amp;&amp; tjf.endBraggPeak) {</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;SetStrategy: Found a Bragg peak. Use the Slowing Tj strategy&quot;</span>;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>.reset();</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bcaea92f268de1c89bd1bdcf4913ca4f84d">kSlowing</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      lastTP.NTPsFit = 5;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    } <span class="comment">// tracklike with Bragg peak</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="keywordflow">if</span>(tkLike &amp;&amp; tjf.nextForecastUpdate &gt; 100 &amp;&amp; tjf.leavesBeforeEnd &amp;&amp; tjf.MCSMom &lt; 500) {</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      <span class="comment">// A long track-like trajectory that has many points fit and the outlook is track-like and</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      <span class="comment">// it leaves the forecast polygon. Don&#39;t change the strategy but decrease the number of points fit</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      lastTP.NTPsFit /= 2;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;SetStrategy: Long track-like wandered out of forecast envelope. Reduce NTPsFit to &quot;</span>&lt;&lt;lastTP.NTPsFit;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    } <span class="comment">// fairly long and leaves the side</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="comment">// a track-like trajectory that has high MCSMom in the forecast and hits a shower</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordflow">if</span>(tkLike &amp;&amp; tjf.MCSMom &gt; 600 &amp;&amp; (tjf.foundShower || tjf.chgFitChiDOF &gt; 20)) {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;SetStrategy: high MCSMom &quot;</span>&lt;&lt;tjf.MCSMom&lt;&lt;<span class="stringliteral">&quot; and a shower ahead. Use the StiffEl strategy&quot;</span>;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>.reset();</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bca881b9d556e1114d8cce02b75d65120db">kStiffEl</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      <span class="comment">// we think we know the direction (towards the shower) so  startEnd is 0</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a9ed855e5b1c03ac9ec9c6aa09ea91105">StartEnd</a> = 0;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    } <span class="comment">// Stiff electron</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordflow">if</span>(shLike &amp;&amp; !tjf.leavesBeforeEnd) {</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;SetStrategy: Inside a shower. Use the StiffEl strategy&quot;</span>;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>.reset();</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bca881b9d556e1114d8cce02b75d65120db">kStiffEl</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      <span class="comment">// we think we know the direction (towards the shower) so  startEnd is 0</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a9ed855e5b1c03ac9ec9c6aa09ea91105">StartEnd</a> = 0;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    }</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  } <span class="comment">// SetStrategy</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">  //////////////////////////////////////////</span></div>
<div class="line"><a name="l00434"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#acdd7ac022c72d9b8095ffa3bad46add7">  434</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#acdd7ac022c72d9b8095ffa3bad46add7">Forecast</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <span class="keyword">const</span> <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj)</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  {</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="comment">// Extrapolate the last TP of tj by many steps and return a forecast of what is ahead</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="comment">// -1       error or not sure</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="comment">// ~1       track-like with a slight chance of showers</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="comment">// &gt;2       shower-like</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="comment">// nextForecastUpdate is set to the number of points on the trajectory when this function should</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="comment">// be called again</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]].AngleCode == 2) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="comment">// add a new forecast</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a1a93908a64cd734cc9f4418d944b14e6">tjfs</a>.resize(<a class="code" href="../../de/d0f/namespacetca.html#a1a93908a64cd734cc9f4418d944b14e6">tjfs</a>.size() + 1);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="comment">// assume there is insufficient info to make a decision</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keyword">auto</span>&amp; tjf = <a class="code" href="../../de/d0f/namespacetca.html#a1a93908a64cd734cc9f4418d944b14e6">tjfs</a>[<a class="code" href="../../de/d0f/namespacetca.html#a1a93908a64cd734cc9f4418d944b14e6">tjfs</a>.size() - 1];</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    tjf.outlook = -1;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    tjf.nextForecastUpdate = USHRT_MAX;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> npwc = <a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> istp = 0;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nMissed = 0;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keywordtype">bool</span> doPrt = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="comment">// turn off annoying output from DefineHitPos</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">if</span>(doPrt) <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="comment">// find the minimum average TP charge. This will be used to calculate the</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="comment">// &#39;effective number of hits&#39; on a wire = total charge on the wire within the</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="comment">// window / (minimum average TP charge). This is intended to reduce the sensitivity</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="comment">// of this metric to the hit finder configuration</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordtype">float</span> minAveChg = 1E6;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0]; ipt &lt;= tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]; ++ipt) {</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].AveChg &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].AveChg &gt; minAveChg) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      minAveChg = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].AveChg;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordflow">if</span>(minAveChg &lt;= 0 || minAveChg == 1E6) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="comment">// start a forecast Tj comprised of the points in the forecast envelope</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a> fctj;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a9ba64d632bc17b16226d212f27dbc0aa">CTP</a> = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a9ba64d632bc17b16226d212f27dbc0aa">CTP</a>;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a> = <a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ae1a29531c613e9b8c7b5ada6e81e6eb4">WorkID</a>;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="comment">// make a local copy of the last point</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keyword">auto</span> ltp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]];</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="comment">// Use the hits position instead of the fitted position so that a bad</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="comment">// fit doesn&#39;t screw up the forecast.</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordtype">float</span> forecastWin0 = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(ltp.Pos[1] - ltp.HitPos[1]);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">if</span>(forecastWin0 &lt; 1) forecastWin0 = 1;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    ltp.Pos = ltp.HitPos;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordtype">double</span> stepSize = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(1/ltp.Dir[0]);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordtype">float</span> window = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a63d3df2313cd07da049f636942fd878a">showerTag</a>[7] * stepSize;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordflow">if</span>(doPrt) {</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;Forecast T&quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>&lt;&lt;<span class="stringliteral">&quot; PDGCode &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ab2c0db630cd45caff1c041d639c5f253">PDGCode</a>&lt;&lt;<span class="stringliteral">&quot; npwc &quot;</span>&lt;&lt;npwc&lt;&lt;<span class="stringliteral">&quot; minAveChg &quot;</span>&lt;&lt;(int)minAveChg&lt;&lt;<span class="stringliteral">&quot; stepSize &quot;</span>&lt;&lt;std::setprecision(2)&lt;&lt;stepSize&lt;&lt;<span class="stringliteral">&quot; window &quot;</span>&lt;&lt;window;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; stp ___Pos____  nTPH  Chg ChgPull  Delta  DRMS  chgWid nTkLk nShLk&quot;</span>;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    }</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(ltp.CTP).<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordtype">float</span> totHits = 0;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2f4d30c7f42c9fddd3add0b7b793b844">TotChg</a> = 0;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordtype">float</span> maxChg = 0;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> maxChgPt = 0;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> leavesNear = USHRT_MAX;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordtype">bool</span> leavesBeforeEnd = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> showerStartNear = USHRT_MAX;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> showerEndNear = USHRT_MAX;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordtype">float</span> nShLike = 0;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keywordtype">float</span> nTkLike = 0;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> trimPts = 0;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordflow">for</span>(istp = 0; istp &lt; 1000; ++istp) {</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      <span class="comment">// move the local TP position by one step in the right direction</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> iwt = 0; iwt &lt; 2; ++iwt) ltp.Pos[iwt] += ltp.Dir[iwt] * stepSize;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wire = std::nearbyint(ltp.Pos[0]);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      <span class="keywordflow">if</span>(wire &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#afcd03730c21830b602fedb556ac43a16">firstWire</a>[plane]) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      <span class="keywordflow">if</span>(wire &gt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ada1d8593ee7a9de4e04ad01d7772126f">lastWire</a>[plane]-1) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a9a2cd91c50f24261f799582dc9f0a76f">MoveTPToWire</a>(ltp, (<span class="keywordtype">float</span>)wire);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      ++ltp.Step;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a519cf8a3170ec63e0b4d457f1d236109">FindCloseHits</a>(slc, ltp, window, <a class="code" href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3af8476e403cd021d9242196cdcfb127a9">kAllHits</a>)) {</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="comment">// Found hits or the wire is dead</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="comment">// set all hits used so that we can use DefineHitPos. Note that</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="comment">// the hit InTraj is not used or tested in DefineHitPos so this doesn&#39;t</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="comment">// screw up any assns</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="keywordflow">if</span>(!ltp.Environment[<a class="code" href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525a6ed9c1ffc232022aa71db806f25ab10d">kEnvNotGoodWire</a>]) {</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;          nMissed = 0;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;          ltp.UseHit.set();</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;          <a class="code" href="../../de/d0f/namespacetca.html#adcfb1da7e005bcdbdd61dc5baf815be1">DefineHitPos</a>(slc, ltp);</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;          fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2f4d30c7f42c9fddd3add0b7b793b844">TotChg</a> += ltp.Chg;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;          ltp.Delta = <a class="code" href="../../de/d0f/namespacetca.html#a310add1134404b2b548a1a88f652cc04">PointTrajDOCA</a>(slc, ltp.HitPos[0], ltp.HitPos[1], ltp);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;          ltp.DeltaRMS = ltp.Delta / window;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;          ltp.Environment.reset();</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;          totHits += ltp.Hits.size();</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;          <span class="keywordflow">if</span>(ltp.Chg &gt; maxChg) {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            maxChg = ltp.Chg;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            maxChgPt = fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size();</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;          }</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;          <span class="comment">// Note that ChgPull uses the average charge and charge RMS of the</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;          <span class="comment">// trajectory before it entered the forecast envelope</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;          ltp.ChgPull = (ltp.Chg / minAveChg - 1) / tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a0787c3db4bce3ad556211ba704897ab3">ChgRMS</a>;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;          <span class="keywordflow">if</span>((ltp.ChgPull &gt; 3 &amp;&amp; ltp.Hits.size() &gt; 1) || ltp.ChgPull &gt; 10) {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            ++nShLike;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            <span class="comment">// break if it approaches the side of the envelope</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            ltp.Environment[<a class="code" href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525a9f1606595e43084041a6f31fe9ca35d7">kEnvNearShower</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            <span class="comment">// flag a showerlike TP so it isn&#39;t used in the MCSMom calculation</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            ltp.HitPosErr2 = 100;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            ++nTkLike;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            ltp.Environment[<a class="code" href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525a9f1606595e43084041a6f31fe9ca35d7">kEnvNearShower</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;          }</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;          <span class="keywordflow">if</span>(fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() &gt; 10) {</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            <span class="keywordtype">float</span> shFrac = nShLike / (nShLike + nTkLike);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            <span class="keywordflow">if</span>(shFrac &gt; 0.5) {</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;              <span class="keywordflow">if</span>(doPrt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;Getting showerlike - break&quot;</span>;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            }</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;          } <span class="comment">// fctj.Pts.size() &gt; 6</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;          <span class="comment">// break if it approaches the side of the envelope</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;          <span class="keywordflow">if</span>(ltp.DeltaRMS &gt; 0.8) {</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            leavesNear = npwc + fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size();</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            <span class="keywordflow">if</span>(doPrt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;leaves before end - break&quot;</span>;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            leavesBeforeEnd = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;          }</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;          fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.push_back(ltp);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;          <span class="keywordflow">if</span>(doPrt) {</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            myprt&lt;&lt;std::setw(4)&lt;&lt;npwc + fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size()&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, ltp);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            myprt&lt;&lt;std::setw(5)&lt;&lt;ltp.Hits.size();</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            myprt&lt;&lt;std::setw(5)&lt;&lt;(int)ltp.Chg;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            myprt&lt;&lt;std::fixed&lt;&lt;std::setprecision(1);</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            myprt&lt;&lt;std::setw(8)&lt;&lt;ltp.ChgPull;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            myprt&lt;&lt;std::setw(8)&lt;&lt;ltp.Delta;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            myprt&lt;&lt;std::setw(8)&lt;&lt;std::setprecision(2)&lt;&lt;ltp.DeltaRMS;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            myprt&lt;&lt;std::setw(8)&lt;&lt;sqrt(ltp.HitPosErr2);</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            myprt&lt;&lt;std::setw(6)&lt;&lt;(int)nTkLike;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            myprt&lt;&lt;std::setw(6)&lt;&lt;(int)nShLike;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;          } <span class="comment">// doPrt</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        }</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <span class="comment">// no hits found</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        ++nMissed;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <span class="keywordflow">if</span>(nMissed == 10) {</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;          <span class="keywordflow">if</span>(doPrt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;No hits found after 10 steps - break&quot;</span>;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      } <span class="comment">// no hits found</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    } <span class="comment">// istp</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="comment">// not enuf info to make a forecast</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a> = doPrt;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">if</span>(fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() &lt; 3) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="comment">// truncate and re-calculate totChg?</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keywordflow">if</span>(trimPts &gt; 0) {</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      <span class="comment">// truncate the forecast trajectory</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.resize(fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() - trimPts);</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      <span class="comment">// recalculate the total charge</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2f4d30c7f42c9fddd3add0b7b793b844">TotChg</a> = 0;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; tp : fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>) fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2f4d30c7f42c9fddd3add0b7b793b844">TotChg</a> += tp.Chg;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    } <span class="comment">// showerEndNear != USHRT_MAX</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(fctj);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a> = <a class="code" href="../../de/d0f/namespacetca.html#a712fa9841aa560d0298a3bd5fda51bb8">MCSMom</a>(slc, fctj);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    tjf.MCSMom = fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a>;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <a class="code" href="../../d0/df5/structtca_1_1ParFit.html">ParFit</a> chgFit;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordflow">if</span>(maxChgPt &gt; 0.3 * fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() &amp;&amp; maxChg &gt; 3 * tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdb8e6dfd5aba49787dab959fea3ac2c">AveChg</a>) {</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      <span class="comment">// find the charge slope from the beginning to the maxChgPt if it is well away</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="comment">// from the start and it is very large</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#ad65fd0c31d447ba7b3731ae451ceb08f">FitPar</a>(slc, fctj, 0, maxChgPt, 1, chgFit, 1);</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#ad65fd0c31d447ba7b3731ae451ceb08f">FitPar</a>(slc, fctj, 0, fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size(), 1, chgFit, 1);</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    }</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    tjf.chgSlope = chgFit.<a class="code" href="../../d0/df5/structtca_1_1ParFit.html#a62d0958a63058e8239dc8d5d7d785f59">ParSlp</a>;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    tjf.chgSlopeErr = chgFit.<a class="code" href="../../d0/df5/structtca_1_1ParFit.html#a4dc41844d36f4314f83dc43b5994ce37">ParSlpErr</a>;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    tjf.chgFitChiDOF = chgFit.<a class="code" href="../../d0/df5/structtca_1_1ParFit.html#abf9afd041123dbaa76614a40759c2f23">ChiDOF</a>;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a50c2901dd2e4719ff3c853d0340a35b1">ChkStop</a>(slc, fctj);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a45584aa4b4e3ca2963ed52c7e5a28ff8">UpdateTjChgProperties</a>(<span class="stringliteral">&quot;Fc&quot;</span>, slc, fctj, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    tjf.chgRMS = fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a0787c3db4bce3ad556211ba704897ab3">ChgRMS</a>;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    tjf.endBraggPeak = fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afa6980f5646e419795cdc43499a55104">EndFlag</a>[1][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa0a4b8d8fc21482d4679f7eac8f457e70">kBragg</a>];</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="comment">// Set outlook = Estimate of the number of hits per wire</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    tjf.outlook = fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2f4d30c7f42c9fddd3add0b7b793b844">TotChg</a> / (fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() * tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdb8e6dfd5aba49787dab959fea3ac2c">AveChg</a>);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="comment">// assume we got to the end</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    tjf.nextForecastUpdate = npwc + fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size();</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    tjf.leavesBeforeEnd = leavesBeforeEnd;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    tjf.foundShower = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordflow">if</span>(leavesNear &lt; tjf.nextForecastUpdate) {</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="comment">// left the side</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      tjf.nextForecastUpdate = leavesNear;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(showerStartNear &lt; tjf.nextForecastUpdate) {</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      <span class="comment">// found a shower start</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      tjf.nextForecastUpdate = showerStartNear;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      tjf.foundShower = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(showerEndNear &lt; tjf.nextForecastUpdate) {</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      <span class="comment">// found a shower end</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      tjf.nextForecastUpdate = showerEndNear;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    }</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    nShLike = 0;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; tp : fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>) <span class="keywordflow">if</span>(tp.Environment[<a class="code" href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525a9f1606595e43084041a6f31fe9ca35d7">kEnvNearShower</a>]) ++nShLike;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    tjf.showerLikeFraction = (float)nShLike / (<span class="keywordtype">float</span>)fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size();</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="keywordflow">if</span>(doPrt) {</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot;Forecast T&quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>&lt;&lt;<span class="stringliteral">&quot; tj.AveChg &quot;</span>&lt;&lt;(int)tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdb8e6dfd5aba49787dab959fea3ac2c">AveChg</a>;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; start &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]])&lt;&lt;<span class="stringliteral">&quot; cnt &quot;</span>&lt;&lt;fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size()&lt;&lt;<span class="stringliteral">&quot; totChg &quot;</span>&lt;&lt;(int)fctj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2f4d30c7f42c9fddd3add0b7b793b844">TotChg</a>;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; last pos &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, ltp);</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; MCSMom &quot;</span>&lt;&lt;tjf.MCSMom;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; outlook &quot;</span>&lt;&lt;std::fixed&lt;&lt;std::setprecision(2)&lt;&lt;tjf.outlook;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; chgSlope &quot;</span>&lt;&lt;std::setprecision(1)&lt;&lt;tjf.chgSlope&lt;&lt;<span class="stringliteral">&quot; +/- &quot;</span>&lt;&lt;tjf.chgSlopeErr;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; chgRMS &quot;</span>&lt;&lt;std::setprecision(1)&lt;&lt;tjf.chgRMS;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; endBraggPeak &quot;</span>&lt;&lt;tjf.endBraggPeak;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; chiDOF &quot;</span>&lt;&lt;tjf.chgFitChiDOF;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; showerLike fraction &quot;</span>&lt;&lt;tjf.showerLikeFraction;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; nextForecastUpdate &quot;</span>&lt;&lt;tjf.nextForecastUpdate;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; leavesBeforeEnd? &quot;</span>&lt;&lt;tjf.leavesBeforeEnd;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; foundShower? &quot;</span>&lt;&lt;tjf.foundShower;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    }</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  } <span class="comment">// Forecast</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">  //////////////////////////////////////////</span></div>
<div class="line"><a name="l00646"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#ad1e1ad01401a053abc7b63d5c33390a5">  646</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#ad1e1ad01401a053abc7b63d5c33390a5">UpdateStiffEl</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj)</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  {</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="comment">// A different stategy for updating a high energy electron trajectories</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keywordflow">if</span>(!tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bca881b9d556e1114d8cce02b75d65120db">kStiffEl</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a>&amp; lastTP = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]];</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="comment">// Set the lastPT delta before doing the fit</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a011749db067df79503a159672ada3c4d">Delta</a> = <a class="code" href="../../de/d0f/namespacetca.html#a310add1134404b2b548a1a88f652cc04">PointTrajDOCA</a>(slc, lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a4aa62ed88bd15f92ac4de07abcd44375">HitPos</a>[0], lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a4aa62ed88bd15f92ac4de07abcd44375">HitPos</a>[1], lastTP);</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() &lt; 30) lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a> += 1;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#ab9b632aaa6a5285a60a3ac9d7bd1cfc0">FitTraj</a>(slc, tj);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a45584aa4b4e3ca2963ed52c7e5a28ff8">UpdateTjChgProperties</a>(<span class="stringliteral">&quot;UET&quot;</span>, slc, tj, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>);</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a9e375fbdbb04760c844a9f5aeed7290c">UpdateDeltaRMS</a>(slc, tj);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a> = <a class="code" href="../../de/d0f/namespacetca.html#a712fa9841aa560d0298a3bd5fda51bb8">MCSMom</a>(slc, tj);</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;UpdateStiffEl: lastPt &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]&lt;&lt;<span class="stringliteral">&quot; Delta &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a011749db067df79503a159672ada3c4d">Delta</a>&lt;&lt;<span class="stringliteral">&quot; AngleCode &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#af4135bac344253d4fecaca6369722c0a">AngleCode</a>&lt;&lt;<span class="stringliteral">&quot; FitChi &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a>&lt;&lt;<span class="stringliteral">&quot; NTPsFit &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a>&lt;&lt;<span class="stringliteral">&quot; MCSMom &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a>;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    }</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f57aca44660b87327393e6a4694e570">NeedsUpdate</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ab2c0db630cd45caff1c041d639c5f253">PDGCode</a> = 111;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  } <span class="comment">// UpdateStiffTj</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment">  //////////////////////////////////////////</span></div>
<div class="line"><a name="l00667"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#af86f6315648e0dbb5e400f35ea97e72c">  667</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#af86f6315648e0dbb5e400f35ea97e72c">UpdateTraj</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj)</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  {</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="comment">// Updates the last added trajectory point fit, average hit rms, etc.</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f57aca44660b87327393e6a4694e570">NeedsUpdate</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#abca1a7f1413e9b9e5d6fedb638047cda">MaskedLastTP</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] &lt; 1) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bca881b9d556e1114d8cce02b75d65120db">kStiffEl</a>]) {</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#ad1e1ad01401a053abc7b63d5c33390a5">UpdateStiffEl</a>(slc, tj);</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    }</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lastPt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1];</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a>&amp; lastTP = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt];</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="comment">// nothing needs to be done if the last point has no hits but is near a hit in the</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="comment">// srcHit collection</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">if</span>(lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.empty() &amp;&amp; lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a4ea82b67f2bc6ffc158950e8a51095e4">Environment</a>[<a class="code" href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525a0d1d499b20081267ac554e515103dbe7">kEnvNearSrcHit</a>]) {</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f57aca44660b87327393e6a4694e570">NeedsUpdate</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    }</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> npwc = <a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="comment">// find the previous TP that has hits (and was therefore in the fit)</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> prevPtWithHits = USHRT_MAX;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> firstFitPt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0];</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 1; ii &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size(); ++ii) {</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = lastPt - ii;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg &gt; 0) {</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        prevPtWithHits = ipt;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      }</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      <span class="keywordflow">if</span>(ipt == 0) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    } <span class="comment">// ii</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordflow">if</span>(prevPtWithHits == USHRT_MAX) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="comment">// define the FitChi threshold above which something will be done</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="keywordtype">float</span> maxChi = 2;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> minPtsFit = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a986b7f09cec52728d16e43511d5c4e3f">minPtsFit</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a77b3a6b92ddd696b3dec9d7581f6503e">Pass</a>];</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="comment">// just starting out?</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="keywordflow">if</span>(lastPt &lt; 4) minPtsFit = 2;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="keywordtype">bool</span> cleanMuon = (tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ab2c0db630cd45caff1c041d639c5f253">PDGCode</a> == 13 &amp;&amp; <a class="code" href="../../de/d0f/namespacetca.html#a79af94508e47e7adb55c7c50401ef4cb">TrajIsClean</a>(slc, tj, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) &amp;&amp; !tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bcaea92f268de1c89bd1bdcf4913ca4f84d">kSlowing</a>]);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="comment">// was !TrajIsClean...</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="keywordflow">if</span>(cleanMuon) {</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      <span class="comment">// Fitting a clean muon</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;      maxChi = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abd23e3a0f00daade6967bbfef88a6250">maxChi</a>;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;      minPtsFit = lastPt / 3;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    }</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="comment">// Set the lastPT delta before doing the fit</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a011749db067df79503a159672ada3c4d">Delta</a> = <a class="code" href="../../de/d0f/namespacetca.html#a310add1134404b2b548a1a88f652cc04">PointTrajDOCA</a>(slc, lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a4aa62ed88bd15f92ac4de07abcd44375">HitPos</a>[0], lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a4aa62ed88bd15f92ac4de07abcd44375">HitPos</a>[1], lastTP);</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="comment">// update MCSMom. First ensure that nothing bad has happened</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <span class="keywordflow">if</span>(npwc &gt; 3 &amp;&amp; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt].Chg &gt; 0 &amp;&amp; !tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bcaea92f268de1c89bd1bdcf4913ca4f84d">kSlowing</a>]) {</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      <span class="keywordtype">short</span> newMCSMom = <a class="code" href="../../de/d0f/namespacetca.html#a712fa9841aa560d0298a3bd5fda51bb8">MCSMom</a>(slc, tj);</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      <span class="keywordtype">short</span> minMCSMom = 0.5 * tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a>;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      <span class="keywordflow">if</span>(lastPt &gt; 10 &amp;&amp; newMCSMom &lt; minMCSMom) {</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;UT: MCSMom took a nose-dive &quot;</span>&lt;&lt;newMCSMom;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#a20bf265ff689ff64027c4d072e7ed598">UnsetUsedHits</a>(slc, lastTP);</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#adcfb1da7e005bcdbdd61dc5baf815be1">DefineHitPos</a>(slc, lastTP);</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f57aca44660b87327393e6a4694e570">NeedsUpdate</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      }</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a> = newMCSMom;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    } <span class="comment">// npwc &gt; 3</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;UT: lastPt &quot;</span>&lt;&lt;lastPt&lt;&lt;<span class="stringliteral">&quot; lastTP.Delta &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a011749db067df79503a159672ada3c4d">Delta</a>&lt;&lt;<span class="stringliteral">&quot; previous point with hits &quot;</span>&lt;&lt;prevPtWithHits&lt;&lt;<span class="stringliteral">&quot; tj.Pts size &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size()&lt;&lt;<span class="stringliteral">&quot; AngleCode &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#af4135bac344253d4fecaca6369722c0a">AngleCode</a>&lt;&lt;<span class="stringliteral">&quot; PDGCode &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ab2c0db630cd45caff1c041d639c5f253">PDGCode</a>&lt;&lt;<span class="stringliteral">&quot; maxChi &quot;</span>&lt;&lt;maxChi&lt;&lt;<span class="stringliteral">&quot; minPtsFit &quot;</span>&lt;&lt;minPtsFit&lt;&lt;<span class="stringliteral">&quot; MCSMom &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a>;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    }</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a45584aa4b4e3ca2963ed52c7e5a28ff8">UpdateTjChgProperties</a>(<span class="stringliteral">&quot;UT&quot;</span>, slc, tj, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>);</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keywordflow">if</span>(lastPt == 1) {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      <span class="comment">// Handle the second trajectory point. No error calculation. Just update</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      <span class="comment">// the position and direction</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a> = 2;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#ab9b632aaa6a5285a60a3ac9d7bd1cfc0">FitTraj</a>(slc, tj);</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a> = 0.01;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac9596529b582dedfa7a6f9f6b24269d9">AngErr</a> = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[0].AngErr;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;UT: Second traj point pos &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0]&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1]&lt;&lt;<span class="stringliteral">&quot;  dir &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0]&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[1];</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f57aca44660b87327393e6a4694e570">NeedsUpdate</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#adfeb5a1922b44080a785a41b47ef1fc7">SetAngleCode</a>(lastTP);</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    }</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="keywordflow">if</span>(lastPt == 2) {</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      <span class="comment">// Third trajectory point. Keep it simple</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a> = 3;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#ab9b632aaa6a5285a60a3ac9d7bd1cfc0">FitTraj</a>(slc, tj);</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f57aca44660b87327393e6a4694e570">NeedsUpdate</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;UT: Third traj point fit &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a>;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#adfeb5a1922b44080a785a41b47ef1fc7">SetAngleCode</a>(lastTP);</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    }</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <span class="comment">// Fit with &gt; 2 TPs</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="comment">// Keep adding hits until Chi/DOF exceeds 1</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[prevPtWithHits].FitChi &lt; 1 &amp;&amp; !tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bcaea92f268de1c89bd1bdcf4913ca4f84d">kSlowing</a>]) lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a> += 1;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="comment">// Reduce the number of points fit if the trajectory is long and chisq is getting a bit larger</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordflow">if</span>(lastPt &gt; 20 &amp;&amp; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[prevPtWithHits].FitChi &gt; 1.5 &amp;&amp; lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a> &gt; minPtsFit) lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a> -= 2;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="comment">// don&#39;t let long muon fits get too long</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="keywordflow">if</span>(cleanMuon &amp;&amp; lastPt &gt; 200 &amp;&amp; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[prevPtWithHits].FitChi &gt; 1.0) lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a> -= 2;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#ab9b632aaa6a5285a60a3ac9d7bd1cfc0">FitTraj</a>(slc, tj);</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <span class="comment">// don&#39;t get too fancy when we are starting out</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="keywordflow">if</span>(lastPt &lt; 6) {</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f57aca44660b87327393e6a4694e570">NeedsUpdate</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a9e375fbdbb04760c844a9f5aeed7290c">UpdateDeltaRMS</a>(slc, tj);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#adfeb5a1922b44080a785a41b47ef1fc7">SetAngleCode</a>(lastTP);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; Return with lastTP.FitChi &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a>&lt;&lt;<span class="stringliteral">&quot; Chg &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a>;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    }</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="comment">// find the first point that was fit.</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> cnt = 0;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size(); ++ii) {</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = lastPt - ii;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg &gt; 0) {</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        firstFitPt = ipt;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        ++cnt;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      }</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      <span class="keywordflow">if</span>(cnt == lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a>) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;      <span class="keywordflow">if</span>(ipt == 0) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    }</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ndead = <a class="code" href="../../de/d0f/namespacetca.html#a757156ec709046f601b18c87c62742f8">DeadWireCount</a>(slc, lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a4aa62ed88bd15f92ac4de07abcd44375">HitPos</a>[0], tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[firstFitPt].HitPos[0], tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a9ba64d632bc17b16226d212f27dbc0aa">CTP</a>);</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keywordflow">if</span>(lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a> &gt; 1.5 &amp;&amp; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() &gt; 6) {</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;      <span class="comment">// A large chisq jump can occur if we just jumped a large block of dead wires. In</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      <span class="comment">// this case we don&#39;t want to mask off the last TP but reduce the number of fitted points</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      <span class="comment">// This count will be off if there a lot of dead or missing wires...</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;      <span class="comment">// reduce the number of points significantly</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;      <span class="keywordflow">if</span>(ndead &gt; 5 &amp;&amp; !cleanMuon) {</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <span class="keywordflow">if</span>(lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a> &gt; 5) lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a> = 5;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <span class="comment">// Have a longish trajectory and chisq was a bit large.</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <span class="comment">// Was this a sudden occurrence and the fraction of TPs are included</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        <span class="comment">// in the fit? If so, we should mask off this</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        <span class="comment">// TP and keep going. If these conditions aren&#39;t met, we</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        <span class="comment">// should reduce the number of fitted points</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <span class="keywordtype">float</span> chirat = 0;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <span class="keywordflow">if</span>(prevPtWithHits != USHRT_MAX &amp;&amp; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[prevPtWithHits].FitChi &gt; 0) chirat = lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a> / tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[prevPtWithHits].FitChi;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        <span class="comment">// Don&#39;t mask hits when doing RevProp. Reduce NTPSFit instead</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#abca1a7f1413e9b9e5d6fedb638047cda">MaskedLastTP</a> = (chirat &gt; 1.5 &amp;&amp; lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a> &gt; 0.3 * <a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">false</span>) &amp;&amp; !tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">kRvPrp</a>]);</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        <span class="comment">// BB April 19, 2018: Don&#39;t mask TPs on low MCSMom Tjs</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#abca1a7f1413e9b9e5d6fedb638047cda">MaskedLastTP</a> &amp;&amp; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a> &lt; 30) tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#abca1a7f1413e9b9e5d6fedb638047cda">MaskedLastTP</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;          mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; First fit chisq too large &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a>&lt;&lt;<span class="stringliteral">&quot; prevPtWithHits chisq &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[prevPtWithHits].FitChi&lt;&lt;<span class="stringliteral">&quot; chirat &quot;</span>&lt;&lt;chirat&lt;&lt;<span class="stringliteral">&quot; NumPtsWithCharge &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">false</span>)&lt;&lt;<span class="stringliteral">&quot; tj.MaskedLastTP &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#abca1a7f1413e9b9e5d6fedb638047cda">MaskedLastTP</a>;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        }</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        <span class="comment">// we should also mask off the last TP if there aren&#39;t enough hits</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        <span class="comment">// to satisfy the minPtsFit constraint</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        <span class="keywordflow">if</span>(!tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#abca1a7f1413e9b9e5d6fedb638047cda">MaskedLastTP</a> &amp;&amp; <a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">true</span>) &lt; minPtsFit) tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#abca1a7f1413e9b9e5d6fedb638047cda">MaskedLastTP</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      } <span class="comment">// few dead wires</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    } <span class="comment">// lastTP.FitChi &gt; 2 ...</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="comment">// Deal with a really long trajectory that is in trouble (uB cosmic).</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ab2c0db630cd45caff1c041d639c5f253">PDGCode</a> == 13 &amp;&amp; lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a> &gt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abd23e3a0f00daade6967bbfef88a6250">maxChi</a>) {</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      <span class="keywordflow">if</span>(lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a> &gt; 1.3 * <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a196555abfdd354366e2158fba39efc83">muonTag</a>[0]) {</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a> *= 0.8;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; Muon - Reduce NTPsFit &quot;</span>&lt;&lt;lastPt;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#abca1a7f1413e9b9e5d6fedb638047cda">MaskedLastTP</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; Muon - mask last point &quot;</span>&lt;&lt;lastPt;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      }</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    }</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;UT: First fit &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0]&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1]&lt;&lt;<span class="stringliteral">&quot;  dir &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0]&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[1]&lt;&lt;<span class="stringliteral">&quot; FitChi &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a>&lt;&lt;<span class="stringliteral">&quot; NTPsFit &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a>&lt;&lt;<span class="stringliteral">&quot; ndead wires &quot;</span>&lt;&lt;ndead&lt;&lt;<span class="stringliteral">&quot; tj.MaskedLastTP &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#abca1a7f1413e9b9e5d6fedb638047cda">MaskedLastTP</a>;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#abca1a7f1413e9b9e5d6fedb638047cda">MaskedLastTP</a>) {</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#a20bf265ff689ff64027c4d072e7ed598">UnsetUsedHits</a>(slc, lastTP);</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#adcfb1da7e005bcdbdd61dc5baf815be1">DefineHitPos</a>(slc, lastTP);</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        lastPt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1];</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a> -= 1;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#ab9b632aaa6a5285a60a3ac9d7bd1cfc0">FitTraj</a>(slc, tj);</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#a45584aa4b4e3ca2963ed52c7e5a28ff8">UpdateTjChgProperties</a>(<span class="stringliteral">&quot;UT&quot;</span>, slc, tj, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>);</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#adfeb5a1922b44080a785a41b47ef1fc7">SetAngleCode</a>(lastTP);</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;      }  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <span class="comment">// a more gradual change in chisq. Maybe reduce the number of points</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> newNTPSFit = lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a>;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        <span class="comment">// reduce the number of points fit to keep Chisq/DOF &lt; 2 adhering to the pass constraint</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        <span class="comment">// and also a minimum number of points fit requirement for long muons</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        <span class="keywordtype">float</span> prevChi = lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a>;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ntry = 0;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        <span class="keywordtype">float</span> chiCut = 1.5;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bca55868aa9ed90ec1727bec61ae58cae5c">kStiffMu</a>]) chiCut = 5;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        <span class="keywordflow">while</span>(lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a> &gt; chiCut &amp;&amp; lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a> &gt; minPtsFit) {</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;          <span class="keywordflow">if</span>(lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a> &gt; 15) {</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;            newNTPSFit = 0.7 * newNTPSFit;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a> &gt; 4) {</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            newNTPSFit -= 2;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;            newNTPSFit -= 1;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;          }</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;          <span class="keywordflow">if</span>(lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a> &lt; 3) newNTPSFit = 2;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;          <span class="keywordflow">if</span>(newNTPSFit &lt; minPtsFit) newNTPSFit = minPtsFit;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;          lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a> = newNTPSFit;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;          <span class="comment">// BB April 19: try to add a last lonely hit on a low MCSMom tj on the last try</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;          <span class="keywordflow">if</span>(newNTPSFit == minPtsFit &amp;&amp; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a> &lt; 30) chiCut = 2;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;  Bad FitChi &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a>&lt;&lt;<span class="stringliteral">&quot; Reduced NTPsFit to &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a>&lt;&lt;<span class="stringliteral">&quot; Pass &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a77b3a6b92ddd696b3dec9d7581f6503e">Pass</a>&lt;&lt;<span class="stringliteral">&quot; chiCut &quot;</span>&lt;&lt;chiCut;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;          <a class="code" href="../../de/d0f/namespacetca.html#ab9b632aaa6a5285a60a3ac9d7bd1cfc0">FitTraj</a>(slc, tj);</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;          tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f57aca44660b87327393e6a4694e570">NeedsUpdate</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;          <span class="keywordflow">if</span>(lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a> &gt; prevChi) {</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;  Chisq is increasing &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a>&lt;&lt;<span class="stringliteral">&quot;  Try to remove an earlier bad hit&quot;</span>;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;            <a class="code" href="../../de/d0f/namespacetca.html#aa053fbd4d7f33f815c630ab60ddc186c">MaskBadTPs</a>(slc, tj, chiCut);</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            ++ntry;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            <span class="keywordflow">if</span>(ntry == 2) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;          }</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;          prevChi = lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a>;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;          <span class="keywordflow">if</span>(lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a> == minPtsFit) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        } <span class="comment">// lastTP.FitChi &gt; 2 &amp;&amp; lastTP.NTPsFit &gt; 2</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;      }</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;      <span class="comment">// last ditch attempt if things look bad. Drop the last hit</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() &gt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a986b7f09cec52728d16e43511d5c4e3f">minPtsFit</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a77b3a6b92ddd696b3dec9d7581f6503e">Pass</a>] &amp;&amp; lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a> &gt; maxChi) {</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;  Last try. Drop last TP &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a>&lt;&lt;<span class="stringliteral">&quot; NTPsFit &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a>;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#a20bf265ff689ff64027c4d072e7ed598">UnsetUsedHits</a>(slc, lastTP);</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#adcfb1da7e005bcdbdd61dc5baf815be1">DefineHitPos</a>(slc, lastTP);</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        lastPt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1];</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#ab9b632aaa6a5285a60a3ac9d7bd1cfc0">FitTraj</a>(slc, tj);</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#abca1a7f1413e9b9e5d6fedb638047cda">MaskedLastTP</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      }</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f57aca44660b87327393e6a4694e570">NeedsUpdate</a>) <a class="code" href="../../de/d0f/namespacetca.html#a45584aa4b4e3ca2963ed52c7e5a28ff8">UpdateTjChgProperties</a>(<span class="stringliteral">&quot;UT&quot;</span>, slc, tj, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>);</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;  Fit done. Chi &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a>&lt;&lt;<span class="stringliteral">&quot; NTPsFit &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a>;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0] == tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <span class="comment">// Don&#39;t let the angle error get too small too soon. Stepping would stop if the first</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="comment">// few hits on a low momentum wandering track happen to have a very good fit to a straight line.</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="comment">// We will do this by averaging the default starting value of AngErr of the first TP with the current</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <span class="comment">// value from FitTraj.</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    <span class="keywordflow">if</span>(lastPt &lt; 14) {</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      <span class="keywordtype">float</span> defFrac = 1 / (float)(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]);</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac9596529b582dedfa7a6f9f6b24269d9">AngErr</a> = defFrac * tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[0].AngErr + (1 - defFrac) * lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac9596529b582dedfa7a6f9f6b24269d9">AngErr</a>;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    }</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a9e375fbdbb04760c844a9f5aeed7290c">UpdateDeltaRMS</a>(slc, tj);</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#adfeb5a1922b44080a785a41b47ef1fc7">SetAngleCode</a>(lastTP);</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f57aca44660b87327393e6a4694e570">NeedsUpdate</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  } <span class="comment">// UpdateTraj</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00914"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#ad1a2f70a1aa9b22bde034deaaef480a6">  914</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#ad1a2f70a1aa9b22bde034deaaef480a6">CheckStiffEl</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj)</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  {</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="keywordflow">if</span>(!tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bca881b9d556e1114d8cce02b75d65120db">kStiffEl</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;inside CheckStiffTj with NumPtsWithCharge = &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    }</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <span class="comment">// Fill in any gaps with hits that were skipped, most likely delta rays on muon tracks</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#abfbdedb4c496fc0e84e7dec74bbb8a15">FillGaps</a>(slc, tj);</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="comment">// Update the trajectory parameters at the beginning of the trajectory</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a2d2429c036c14fad9706d51025642167">ChkBegin</a>(slc, tj);</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  } <span class="comment">// CheckStiffTj</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00927"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a1180656acd6cfc07d51fb636b50ef4f8">  927</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#a1180656acd6cfc07d51fb636b50ef4f8">CheckTraj</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj)</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  {</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    <span class="comment">// Check the quality of the trajectory and possibly trim it or flag it for deletion</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="keywordflow">if</span>(!tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <span class="comment">// ensure that the end points are defined</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0] == tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bca881b9d556e1114d8cce02b75d65120db">kStiffEl</a>]) {</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#ad1a2f70a1aa9b22bde034deaaef480a6">CheckStiffEl</a>(slc, tj);</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    }</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;inside CheckTraj with NumPtsWithCharge = &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    }</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">false</span>) &lt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a8401e4d37fab8a440de704d2f7c3a9be">minPts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a77b3a6b92ddd696b3dec9d7581f6503e">Pass</a>]) {</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    }</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    <span class="comment">// reduce nPtsFit to the minimum and check for a large angle kink near the ends</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="comment">//    ChkEndKink(slc, tj, tcc.dbgStp);</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="comment">// Look for a charge asymmetry between points on both sides of a high-</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="comment">// charge point and trim points in the vicinity</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a7c81814043da008fb13c8d80d022a203">ChkChgAsymmetry</a>(slc, tj, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>);</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="comment">// flag this tj as a junk Tj (even though it wasn&#39;t created in FindJunkTraj).</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="comment">// Drop it and let FindJunkTraj do it&#39;s job</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#ae881fd705033f5c99a495a09a6bb5e95">TagJunkTj</a>(slc, tj, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>);</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da9b5200eaaed0e097cac019d6643e537e">kJunkTj</a>]) {</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    }</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a> = <a class="code" href="../../de/d0f/namespacetca.html#a712fa9841aa560d0298a3bd5fda51bb8">MCSMom</a>(slc, tj);</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="comment">// See if the points at the stopping end can be included in the Tj</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a36a327d57361f40edfb73d1816ca4ce7">ChkStopEndPts</a>(slc, tj, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>);</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <span class="comment">// remove any points at the end that don&#39;t have charge</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.resize(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] + 1);</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="comment">// Ensure that a hit only appears once in the TJ</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77d214b0ab24a4e88b0330ebb4d8fdf4">HasDuplicateHits</a>(slc, tj, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>)) {</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; HasDuplicateHits &quot;</span>;</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    }</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="comment">// See if this is a ghost trajectory</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a5054f1164beee20fe31f778d536be6b8">IsGhost</a>(slc, tj)) {</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; CT: Ghost trajectory - trimmed hits &quot;</span>;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      <span class="keywordflow">if</span>(!tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    }</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da9b5200eaaed0e097cac019d6643e537e">kJunkTj</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="comment">// checks are different for Very Large Angle trajectories</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <span class="keywordtype">bool</span> isVLA = (tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]].AngleCode == 2);</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.resize(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] + 1);</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="comment">// Fill in any gaps with hits that were skipped, most likely delta rays on muon tracks</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="keywordflow">if</span>(!isVLA) <a class="code" href="../../de/d0f/namespacetca.html#abfbdedb4c496fc0e84e7dec74bbb8a15">FillGaps</a>(slc, tj);</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; CheckTraj MCSMom &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a>&lt;&lt;<span class="stringliteral">&quot; isVLA? &quot;</span>&lt;&lt;isVLA&lt;&lt;<span class="stringliteral">&quot; NumPtsWithCharge &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">false</span>)&lt;&lt;<span class="stringliteral">&quot; Min Req&#39;d &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a8401e4d37fab8a440de704d2f7c3a9be">minPts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a77b3a6b92ddd696b3dec9d7581f6503e">Pass</a>];</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="comment">// Trim the end points until the TJ meets the quality cuts</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a1638b2155753b89b5b7f719446b6f5c8">TrimEndPts</a>(<span class="stringliteral">&quot;CT&quot;</span>, slc, tj, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aebf6b37bd33cbf3434810b788ebb7e82">qualityCuts</a>, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>);</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da28fa0bb663ed246b2fcf12591258c5ac">kKilled</a>]) {</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    }</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a54a189312dc1c61d90002e85e11a33c2">TrimHiChgEndPts</a>(slc, tj, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>);</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    <span class="comment">// Check for a Bragg peak at both ends. This may be used by FixBegin.</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a50c2901dd2e4719ff3c853d0340a35b1">ChkStop</a>(slc, tj);</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="comment">// Update the trajectory parameters at the beginning of the trajectory</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a2d2429c036c14fad9706d51025642167">ChkBegin</a>(slc, tj);</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <span class="comment">// ignore short trajectories</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] &lt; 4) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="comment">// final quality check</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <span class="keywordtype">float</span> npwc = <a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="keywordtype">float</span> npts = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] - tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0] + 1;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="keywordtype">float</span> frac = npwc / npts;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a> = (frac &gt;= <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aebf6b37bd33cbf3434810b788ebb7e82">qualityCuts</a>[0]);</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a> &amp;&amp; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a77b3a6b92ddd696b3dec9d7581f6503e">Pass</a> &lt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ad1829cb796ab00695cd51a6dedc57f71">minMCSMom</a>.size() &amp;&amp; !tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bcaea92f268de1c89bd1bdcf4913ca4f84d">kSlowing</a>]) tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a> = (tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a> &gt;= <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ad1829cb796ab00695cd51a6dedc57f71">minMCSMom</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a77b3a6b92ddd696b3dec9d7581f6503e">Pass</a>]);</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;CheckTraj: fraction of points with charge &quot;</span>&lt;&lt;frac&lt;&lt;<span class="stringliteral">&quot; good traj? &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a>;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    }</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    <span class="keywordflow">if</span>(!tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a> || !slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a2aab614bb8eea5ec2b9a98b0202683dd">isValid</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    <span class="comment">// lop off high multiplicity hits at the end</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a5d59efe83ce0c76a4e68f44e23cc2e18">CheckHiMultEndHits</a>(slc, tj);</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    <span class="comment">// Check for a Bragg peak at both ends. This may be used by FixBegin.</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a50c2901dd2e4719ff3c853d0340a35b1">ChkStop</a>(slc, tj);</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  } <span class="comment">// CheckTraj</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#aa0294becb454d8cc7d38fe341641cfbf"> 1037</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#aa0294becb454d8cc7d38fe341641cfbf">AddHits</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt, <span class="keywordtype">bool</span>&amp; sigOK)</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  {</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    <span class="comment">// Try to add hits to the trajectory point ipt on the supplied</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <span class="comment">// trajectory</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <span class="comment">// assume failure</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    sigOK = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    <span class="keywordflow">if</span>(ipt &gt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() - 1) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <span class="comment">// Call large angle hit finding if the last tp is large angle</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].AngleCode == 2) {</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#aa050fa6f6a815ba15eb84ac539e89414">AddLAHits</a>(slc, tj, ipt, sigOK);</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    }</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a>&amp; tp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt];</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    std::vector&lt;unsigned int&gt; closeHits;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lastPtWithUsedHits = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1];</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a9ba64d632bc17b16226d212f27dbc0aa">CTP</a>).<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wire = std::nearbyint(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0]);</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <span class="keywordflow">if</span>(wire &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#afcd03730c21830b602fedb556ac43a16">firstWire</a>[plane] || wire &gt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ada1d8593ee7a9de4e04ad01d7772126f">lastWire</a>[plane]-1) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    <span class="comment">// Move the TP to this wire</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a9a2cd91c50f24261f799582dc9f0a76f">MoveTPToWire</a>(tp, (<span class="keywordtype">float</span>)wire);</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="comment">// find the projection error to this point. Note that if this is the first</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <span class="comment">// TP, lastPtWithUsedHits = 0, so the projection error is 0</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <span class="keywordtype">float</span> dw = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] - tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPtWithUsedHits].Pos[0];</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="keywordtype">float</span> dt = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1] - tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPtWithUsedHits].Pos[1];</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="keywordtype">float</span> dpos = sqrt(dw * dw + dt * dt);</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="keywordtype">float</span> projErr = dpos * tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPtWithUsedHits].AngErr;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="comment">// Add this to the Delta RMS factor and construct a cut</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    <span class="keywordtype">float</span> deltaCut = 3 * (projErr + tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#af9b51f6eb202342e980fdae234fe06c5">DeltaRMS</a>);</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    <span class="comment">// The delta cut shouldn&#39;t be less than the delta of hits added on the previous step</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="keywordtype">float</span> minDeltaCut = 1.1 * tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPtWithUsedHits].Delta;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="keywordflow">if</span>(deltaCut &lt; minDeltaCut) deltaCut = minDeltaCut;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    deltaCut *= <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abdc5eb0131ea44a8278193e04f488481">projectionErrFactor</a>;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; AddHits: calculated deltaCut &quot;</span>&lt;&lt;deltaCut&lt;&lt;<span class="stringliteral">&quot; dw &quot;</span>&lt;&lt;dw&lt;&lt;<span class="stringliteral">&quot; dpos &quot;</span>&lt;&lt;dpos;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="keywordflow">if</span>(deltaCut &lt; 0.5) deltaCut = 0.5;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <span class="keywordflow">if</span>(deltaCut &gt; 3) deltaCut = 3;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="comment">// TY: open it up for RevProp, since we might be following a stopping track</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">kRvPrp</a>]) deltaCut *= 2;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="comment">// loosen up a bit if we just passed a block of dead wires</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <span class="keywordtype">bool</span> passedDeadWires = (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a>(dw) &gt; 20 &amp;&amp; <a class="code" href="../../de/d0f/namespacetca.html#a757156ec709046f601b18c87c62742f8">DeadWireCount</a>(slc, tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0], tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPtWithUsedHits].Pos[0], tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a9ba64d632bc17b16226d212f27dbc0aa">CTP</a>) &gt; 10);</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    <span class="keywordflow">if</span>(passedDeadWires) deltaCut *= 2;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="comment">// open it up for StiffEl and Slowing strategies</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bca881b9d556e1114d8cce02b75d65120db">kStiffEl</a>] || tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bcaea92f268de1c89bd1bdcf4913ca4f84d">kSlowing</a>]) deltaCut = 3;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="comment">// Create a larger cut to use in case there is nothing close</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <span class="keywordtype">float</span> bigDelta = 2 * deltaCut;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> imBig = UINT_MAX;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a011749db067df79503a159672ada3c4d">Delta</a> = deltaCut;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <span class="comment">// ignore all hits with delta larger than maxDeltaCut</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <span class="keywordtype">float</span> maxDeltaCut = 2 * bigDelta;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <span class="comment">// apply some limits</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <span class="keywordflow">if</span>(!passedDeadWires &amp;&amp; maxDeltaCut &gt; 3) {</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;      maxDeltaCut = 3;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      bigDelta = 1.5;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    }</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <span class="comment">// projected time in ticks for testing the existence of a hit signal</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <a class="code" href="../../d9/d63/namespaceraw.html#abcbf8ba50ca9efdbeb1a6955b040b4fe">raw::TDCtick_t</a> rawProjTick = (float)(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1] / <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a>);</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; AddHits: wire &quot;</span>&lt;&lt;wire&lt;&lt;<span class="stringliteral">&quot; tp.Pos[0] &quot;</span>&lt;&lt;tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0]&lt;&lt;<span class="stringliteral">&quot; projTick &quot;</span>&lt;&lt;rawProjTick&lt;&lt;<span class="stringliteral">&quot; deltaRMS &quot;</span>&lt;&lt;tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#af9b51f6eb202342e980fdae234fe06c5">DeltaRMS</a>&lt;&lt;<span class="stringliteral">&quot; tp.Dir[0] &quot;</span>&lt;&lt;tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0]&lt;&lt;<span class="stringliteral">&quot; deltaCut &quot;</span>&lt;&lt;deltaCut&lt;&lt;<span class="stringliteral">&quot; dpos &quot;</span>&lt;&lt;dpos&lt;&lt;<span class="stringliteral">&quot; projErr &quot;</span>&lt;&lt;projErr&lt;&lt;<span class="stringliteral">&quot; ExpectedHitsRMS &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a8fcdaae008c0c29ae4a6442344c306ee">ExpectedHitsRMS</a>(slc, tp);</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    }</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    std::vector&lt;unsigned int&gt; hitsInMultiplet;</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> planeID = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a9ba64d632bc17b16226d212f27dbc0aa">CTP</a>);</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ipl = planeID.<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>;</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <span class="keywordflow">if</span>(wire &gt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ada1d8593ee7a9de4e04ad01d7772126f">lastWire</a>[ipl]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <span class="comment">// Assume a signal exists on a dead wire</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#a08d6f9aad54acbd12cfcc44e77e6e29d">goodWire</a>[ipl][wire]) sigOK = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a95f7fcb13cb06c827c69fc2fd301f1c0">wireHitRange</a>[ipl][wire].first == UINT_MAX) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> firstHit = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a95f7fcb13cb06c827c69fc2fd301f1c0">wireHitRange</a>[ipl][wire].first;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lastHit = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a95f7fcb13cb06c827c69fc2fd301f1c0">wireHitRange</a>[ipl][wire].second;</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <span class="keywordtype">float</span> fwire = wire;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht = firstHit; iht &lt;= lastHit; ++iht) {</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;      <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj == tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;      <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj == SHRT_MAX) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;      <span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>)[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].allHitsIndex];</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;      <span class="keywordflow">if</span>(rawProjTick &gt; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.StartTick() &amp;&amp; rawProjTick &lt; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.EndTick()) sigOK = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;      <span class="keywordtype">float</span> ftime = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a> * <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.PeakTime();</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;      <span class="keywordtype">float</span> delta = <a class="code" href="../../de/d0f/namespacetca.html#a310add1134404b2b548a1a88f652cc04">PointTrajDOCA</a>(slc, fwire, ftime, tp);</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      <span class="comment">// increase the delta cut if this is a long pulse hit</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      <span class="keywordtype">bool</span> longPulseHit = <a class="code" href="../../de/d0f/namespacetca.html#ac13f24978c3ad09c4181c7d2628df67a">LongPulseHit</a>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>);</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;      <span class="keywordflow">if</span>(longPulseHit) {</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        <span class="keywordflow">if</span>(delta &gt; 3) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;        <span class="keywordflow">if</span>(delta &gt; maxDeltaCut) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;      }</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      <span class="keywordtype">float</span> dt = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(ftime - tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1]);</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a956ff1118d924911210bace923717e57">GetHitMultiplet</a>(slc, iht, hitsInMultiplet, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a> &amp;&amp; delta &lt; 100 &amp;&amp; dt &lt; 100) {</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;        mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        myprt&lt;&lt;<span class="stringliteral">&quot;  iht &quot;</span>&lt;&lt;iht;</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;        myprt&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a6f0a1df60836abcb51565bc85c828f18">PrintHit</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht]);</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;        myprt&lt;&lt;<span class="stringliteral">&quot; delta &quot;</span>&lt;&lt;std::fixed&lt;&lt;std::setprecision(2)&lt;&lt;delta&lt;&lt;<span class="stringliteral">&quot; deltaCut &quot;</span>&lt;&lt;deltaCut&lt;&lt;<span class="stringliteral">&quot; dt &quot;</span>&lt;&lt;dt;</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        myprt&lt;&lt;<span class="stringliteral">&quot; BB Mult &quot;</span>&lt;&lt;hitsInMultiplet.size()&lt;&lt;<span class="stringliteral">&quot; RMS &quot;</span>&lt;&lt;std::setprecision(1)&lt;&lt;<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.RMS();</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        myprt&lt;&lt;<span class="stringliteral">&quot; Chi &quot;</span>&lt;&lt;std::setprecision(1)&lt;&lt;<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.GoodnessOfFit();</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        myprt&lt;&lt;<span class="stringliteral">&quot; InTraj &quot;</span>&lt;&lt;slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj;</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;        myprt&lt;&lt;<span class="stringliteral">&quot; Chg &quot;</span>&lt;&lt;(int)<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.Integral();</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;        myprt&lt;&lt;<span class="stringliteral">&quot; Signal? &quot;</span>&lt;&lt;sigOK;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      }</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;      <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj == 0 &amp;&amp; delta &lt; bigDelta &amp;&amp; hitsInMultiplet.size() &lt; 3 &amp;&amp; !tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">kRvPrp</a>]) {</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        <span class="comment">// An available hit that is just outside the window that is not part of a large multiplet</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        bigDelta = delta;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;        imBig = iht;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      }</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      <span class="keywordflow">if</span>(longPulseHit) {</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;        <span class="keywordflow">if</span>(delta &gt; 3) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;        <span class="keywordflow">if</span>(delta &gt; deltaCut) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;      }</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;      <span class="keywordflow">if</span>(std::find(closeHits.begin(), closeHits.end(), iht) != closeHits.end()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;      closeHits.push_back(iht);</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;      <span class="keywordflow">if</span>(hitsInMultiplet.size() &gt; 1) {</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        <span class="comment">// include all the hits in a multiplet</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; jht : hitsInMultiplet) {</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;          <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[jht].InTraj == tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;          <span class="keywordflow">if</span>(std::find(closeHits.begin(), closeHits.end(), jht) != closeHits.end()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;          closeHits.push_back(jht);</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        } <span class="comment">// jht</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;      } <span class="comment">// multiplicity &gt; 1</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    } <span class="comment">// iht</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;      mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot;closeHits &quot;</span>;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;      <span class="keywordflow">for</span>(<span class="keyword">auto</span> iht : closeHits) myprt&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a6f0a1df60836abcb51565bc85c828f18">PrintHit</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht]);</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      <span class="keywordflow">if</span>(imBig &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>.size()) {</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;        myprt&lt;&lt;<span class="stringliteral">&quot; imBig &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a6f0a1df60836abcb51565bc85c828f18">PrintHit</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[imBig]);</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;        myprt&lt;&lt;<span class="stringliteral">&quot; imBig &quot;</span>&lt;&lt;imBig;</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;      }</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    }</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    <span class="comment">// check the srcHit collection if it is defined. Add the TP to the trajectory if</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <span class="comment">// there is NO hit in the allHits collection but there is a hit in srcHit collection. We</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <span class="comment">// can&#39;t use it for fitting, etc however</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <span class="keywordtype">bool</span> nearSrcHit = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="keywordflow">if</span>(!sigOK) nearSrcHit = <a class="code" href="../../de/d0f/namespacetca.html#ab0e6ecc57d0831d83fda749b054ed7a4">NearbySrcHit</a>(planeID, wire, (<span class="keywordtype">float</span>)rawProjTick, (<span class="keywordtype">float</span>)rawProjTick);</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    sigOK = sigOK || !closeHits.empty() || nearSrcHit;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <span class="keywordflow">if</span>(!sigOK) {</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; no signal on any wire at tp.Pos &quot;</span>&lt;&lt;tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0]&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1]&lt;&lt;<span class="stringliteral">&quot; tick &quot;</span>&lt;&lt;(int)tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1]/<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a>&lt;&lt;<span class="stringliteral">&quot; closeHits size &quot;</span>&lt;&lt;closeHits.size();</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    }</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    <span class="keywordflow">if</span>(imBig &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>.size() &amp;&amp; closeHits.empty()) {</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;      closeHits.push_back(imBig);</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; Added bigDelta hit &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a6f0a1df60836abcb51565bc85c828f18">PrintHit</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[imBig])&lt;&lt;<span class="stringliteral">&quot; w delta = &quot;</span>&lt;&lt;bigDelta;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    }</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    <span class="keywordflow">if</span>(closeHits.size() &gt; 16) closeHits.resize(16);</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    <span class="keywordflow">if</span>(nearSrcHit) tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a4ea82b67f2bc6ffc158950e8a51095e4">Environment</a>[<a class="code" href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525a0d1d499b20081267ac554e515103dbe7">kEnvNearSrcHit</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.insert(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.end(), closeHits.begin(), closeHits.end());</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    <span class="comment">// reset UseHit and assume that none of these hits will be used (yet)</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>.reset();</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;   <span class="comment">// decide which of these hits should be used in the fit. Use a generous maximum delta</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    <span class="comment">// and require a charge check if we&#39;re not just starting out</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    <span class="keywordtype">bool</span> useChg = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bca881b9d556e1114d8cce02b75d65120db">kStiffEl</a>] || tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bcaea92f268de1c89bd1bdcf4913ca4f84d">kSlowing</a>]) useChg = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a81a9901d72f5bcdc7ad45878bac54739">FindUseHits</a>(slc, tj, ipt, 10, useChg);</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#adcfb1da7e005bcdbdd61dc5baf815be1">DefineHitPos</a>(slc, tp);</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; number of close hits &quot;</span>&lt;&lt;closeHits.size()&lt;&lt;<span class="stringliteral">&quot; used hits &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a6b4cf44fa6814acfdf94b7cfba17c131">NumHitsInTP</a>(tp, <a class="code" href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3a592a31ca0b683aeb15197694a71bd108">kUsedHits</a>);</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  } <span class="comment">// AddHits</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#aa050fa6f6a815ba15eb84ac539e89414"> 1214</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#aa050fa6f6a815ba15eb84ac539e89414">AddLAHits</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt, <span class="keywordtype">bool</span>&amp; sigOK)</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  {</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    <span class="comment">// Very Large Angle version of AddHits to be called for the last angle range</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <span class="keywordflow">if</span>(ipt &gt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() - 1) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a>&amp; tp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt];</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.clear();</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>.reset();</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    sigOK = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a9ba64d632bc17b16226d212f27dbc0aa">CTP</a>).<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    <span class="comment">// look at adjacent wires for larger angle trajectories</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="comment">// We will check the most likely wire first</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    std::vector&lt;int&gt; wires(1);</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    wires[0] = std::nearbyint(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0]);</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="keywordflow">if</span>(wires[0] &lt; 0 || wires[0] &gt; (<span class="keywordtype">int</span>)slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ada1d8593ee7a9de4e04ad01d7772126f">lastWire</a>[plane]-1) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    <span class="keywordflow">if</span>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#af4135bac344253d4fecaca6369722c0a">AngleCode</a> != 2) {</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;AddLAHits called with a bad angle code. &quot;</span>&lt;&lt;tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#af4135bac344253d4fecaca6369722c0a">AngleCode</a>&lt;&lt;<span class="stringliteral">&quot; Don&#39;t do this&quot;</span>;</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    }</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    <span class="comment">// and the adjacent wires next in the most likely order only</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    <span class="comment">// after the first two points have been defined</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    <span class="keywordflow">if</span>(ipt &gt; 1) {</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;      <span class="keywordflow">if</span>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0] &gt; 0) {</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        <span class="keywordflow">if</span>(wires[0] &lt; (<span class="keywordtype">int</span>)slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ada1d8593ee7a9de4e04ad01d7772126f">lastWire</a>[plane]-1) wires.push_back(wires[0] + 1);</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;        <span class="keywordflow">if</span>(wires[0] &gt; 0) wires.push_back(wires[0] - 1);</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        <span class="keywordflow">if</span>(wires[0] &gt; 0) wires.push_back(wires[0] - 1);</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;        <span class="keywordflow">if</span>(wires[0] &lt; (<span class="keywordtype">int</span>)slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ada1d8593ee7a9de4e04ad01d7772126f">lastWire</a>[plane]-1) wires.push_back(wires[0] + 1);</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;      }</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    } <span class="comment">// ipt &gt; 0 ...</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;      mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; AddLAHits: Pos &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tp)&lt;&lt;<span class="stringliteral">&quot; tp.AngleCode &quot;</span>&lt;&lt;tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#af4135bac344253d4fecaca6369722c0a">AngleCode</a>&lt;&lt;<span class="stringliteral">&quot; Wires under consideration&quot;</span>;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;      <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; wire : wires) myprt&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;wire;</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    }</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    <span class="comment">// a temporary tp that we can move around</span></div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a> ltp = tp;</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    <span class="comment">// do this while testing</span></div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    sigOK = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.clear();</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    std::array&lt;int, 2&gt; wireWindow;</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    std::array&lt;float, 2&gt; timeWindow;</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    <span class="keywordtype">float</span> pos1Window = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a0b39677cc3d897476deca9722674981e">VLAStepSize</a>/2;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    timeWindow[0] = ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1] - pos1Window;</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    timeWindow[1] = ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1] + pos1Window;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <span class="comment">// Put the existing hits in to a vector so we can ensure that they aren&#39;t added again</span></div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    std::vector&lt;unsigned int&gt; oldHits = <a class="code" href="../../de/d0f/namespacetca.html#a74e10046f4ebc371418d3081bc237ba0">PutTrajHitsInVector</a>(tj, <a class="code" href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3af8476e403cd021d9242196cdcfb127a9">kAllHits</a>);</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; wires.size(); ++ii) {</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;      <span class="keywordtype">int</span> wire = wires[ii];</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;      <span class="keywordflow">if</span>(wire &lt; 0 || wire &gt; (<span class="keywordtype">int</span>)slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ada1d8593ee7a9de4e04ad01d7772126f">lastWire</a>[plane]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;      <span class="comment">// Assume a signal exists on a dead wire</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;      <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a95f7fcb13cb06c827c69fc2fd301f1c0">wireHitRange</a>[plane][wire].first == UINT_MAX) sigOK = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a95f7fcb13cb06c827c69fc2fd301f1c0">wireHitRange</a>[plane][wire].first == UINT_MAX) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;      wireWindow[0] = wire;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      wireWindow[1] = wire;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;      <span class="keywordtype">bool</span> hitsNear;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;      <span class="comment">// Look for hits using the requirement that the timeWindow overlaps with the hit StartTick and EndTick</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;      std::vector&lt;unsigned int&gt; closeHits = <a class="code" href="../../de/d0f/namespacetca.html#a519cf8a3170ec63e0b4d457f1d236109">FindCloseHits</a>(slc, wireWindow, timeWindow, plane, <a class="code" href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3af8476e403cd021d9242196cdcfb127a9">kAllHits</a>, <span class="keyword">true</span>, hitsNear);</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;      <span class="keywordflow">if</span>(hitsNear) sigOK = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;      <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; iht : closeHits) {</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;        <span class="comment">// Ensure that none of these hits are already used by this trajectory</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj == tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;        <span class="comment">// or in another trajectory in any previously added point</span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;        <span class="keywordflow">if</span>(std::find(oldHits.begin(), oldHits.end(), iht) != oldHits.end()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;        tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.push_back(iht);</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      }</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    } <span class="comment">// ii</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;      mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; LAPos &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, ltp)&lt;&lt;<span class="stringliteral">&quot; Tick window &quot;</span>&lt;&lt;(int)(timeWindow[0]/<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a>)&lt;&lt;<span class="stringliteral">&quot; to &quot;</span>&lt;&lt;(int)(timeWindow[1]/<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a>);</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;      <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; iht : tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>) myprt&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a6f0a1df60836abcb51565bc85c828f18">PrintHit</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht]);</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    } <span class="comment">// prt</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    <span class="comment">// no hits found</span></div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    <span class="keywordflow">if</span>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    <span class="keywordflow">if</span>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.size() &gt; 16) tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.resize(16);</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>.reset();</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.size(); ++ii) {</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>[ii];</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;      <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj != 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>[ii] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;      slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>;</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    } <span class="comment">// ii</span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#adcfb1da7e005bcdbdd61dc5baf815be1">DefineHitPos</a>(slc, tp);</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a45584aa4b4e3ca2963ed52c7e5a28ff8">UpdateTjChgProperties</a>(<span class="stringliteral">&quot;ALAH&quot;</span>, slc, tj, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>);</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;  } <span class="comment">// AddLAHits</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="comment">  //////////////////////////////////////////</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#ad7cbf4c6b614a0794141590372874150"> 1314</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#ad7cbf4c6b614a0794141590372874150">ReversePropagate</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj)</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  {</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    <span class="comment">// Reverse the trajectory and step in the opposite direction. The</span></div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <span class="comment">// updated trajectory is returned if this process is successful</span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">kRvPrp</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() &lt; 6) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <span class="comment">// only do this once</span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">kRvPrp</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    <span class="comment">// This code can&#39;t handle VLA trajectories</span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0]].AngleCode == 2) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    <span class="keywordtype">bool</span> prt = (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a> || <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ac24fc2006fb9fdcc2dc745608b6b0f5c">dbgAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">kRvPrp</a>]);</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    <span class="comment">// this function requires the first TP be included in the trajectory.</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0] &gt; 0) {</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.erase(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.begin(), tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.begin() + tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0]);</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    }</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;ReversePropagate: Prepping Tj &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>&lt;&lt;<span class="stringliteral">&quot; incoming StepDir &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a3d0690a80fbffcedf93b202d1c7bd0cd">StepDir</a>;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    <span class="keywordtype">short</span> stepDir = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a3d0690a80fbffcedf93b202d1c7bd0cd">StepDir</a>;</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    <span class="comment">// find the wire on which the first TP resides</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wire0 = std::nearbyint(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[0].Pos[0]);</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nextWire = wire0 - tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a3d0690a80fbffcedf93b202d1c7bd0cd">StepDir</a>;</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    <span class="comment">// check for dead wires</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> planeID = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a9ba64d632bc17b16226d212f27dbc0aa">CTP</a>);</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipl = planeID.<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>;</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <span class="keywordflow">while</span>(nextWire &gt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#afcd03730c21830b602fedb556ac43a16">firstWire</a>[ipl] &amp;&amp; nextWire &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ada1d8593ee7a9de4e04ad01d7772126f">lastWire</a>[ipl]) {</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#a08d6f9aad54acbd12cfcc44e77e6e29d">goodWire</a>[ipl][nextWire]) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;      nextWire -= tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a3d0690a80fbffcedf93b202d1c7bd0cd">StepDir</a>;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    }</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    <span class="keywordflow">if</span>(nextWire == slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ada1d8593ee7a9de4e04ad01d7772126f">lastWire</a>[ipl] - 1) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <span class="comment">// clone the first point</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a> tp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[0];</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <span class="comment">// strip off the hits</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.clear(); tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>.reset();</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    <span class="comment">// move it to the next wire (in the opposite direction of the step direction)</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a9a2cd91c50f24261f799582dc9f0a76f">MoveTPToWire</a>(tp, (<span class="keywordtype">float</span>)nextWire);</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    <span class="comment">// find close unused hits near this position</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    <span class="keywordtype">float</span> maxDelta = 10 * tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]].DeltaRMS;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a519cf8a3170ec63e0b4d457f1d236109">FindCloseHits</a>(slc, tp, maxDelta, <a class="code" href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3acc9a44768cfabff4a2048a41a6e5b9dd">kUnusedHits</a>)) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; nUnused hits &quot;</span>&lt;&lt;tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.size()&lt;&lt;<span class="stringliteral">&quot; at Pos &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tp);</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    <span class="keywordflow">if</span>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    <span class="comment">// There are hits on the next wire. Make a working copy of the trajectory, reverse it and try</span></div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <span class="comment">// to extend it with StepAway</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    <span class="keywordflow">if</span>(prt) {</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;      mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; tp.Hits &quot;</span>;</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;      <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; iht : tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>) myprt&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a6f0a1df60836abcb51565bc85c828f18">PrintHit</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht])&lt;&lt;<span class="stringliteral">&quot;_&quot;</span>&lt;&lt;slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj;</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    } <span class="comment">// tcc.dbgStp</span></div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    <span class="comment">// Make a working copy of tj</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a> tjWork = tj;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    <span class="comment">// So the first shall be last and the last shall be first</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#aeaedd29af9a4f572ed7fcb21e0337949">ReverseTraj</a>(slc, tjWork);</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    <span class="comment">// Flag it to use special cuts in StepAway</span></div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    tjWork.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">kRvPrp</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    <span class="comment">// save the strategy word and set it to normal</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    <span class="keyword">auto</span> saveStrategy = tjWork.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>;</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    tjWork.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>.reset();</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    tjWork.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bcaccee5a6ccf8ebbc0f2489279a8f09bb5">kNormal</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    <span class="comment">// Reduce the number of fitted points to a small number</span></div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> lastPt = tjWork.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() - 1;</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    <span class="keywordflow">if</span>(lastPt &lt; 4) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    <span class="comment">// update the charge</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    <span class="keywordtype">float</span> chg = 0;</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    <span class="keywordtype">float</span> cnt = 0;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; 4; ++ii) {</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = lastPt - ii;</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;      <span class="keywordflow">if</span>(tjWork.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;      chg += tjWork.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg;</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;      ++cnt;</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    } <span class="comment">// ii</span></div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    <span class="keywordflow">if</span>(cnt == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    <span class="keywordflow">if</span>(cnt &gt; 1) tjWork.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt].AveChg = chg / cnt;</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#afc867fb26ea8184ca8285f7f65822b0d">StepAway</a>(slc, tjWork);</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    <span class="keywordflow">if</span>(!tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a>) {</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;      <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; ReversePropagate StepAway failed&quot;</span>;</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    }</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    tjWork.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a> = saveStrategy;</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    <span class="comment">// check the new stopping point</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a36a327d57361f40edfb73d1816ca4ce7">ChkStopEndPts</a>(slc, tjWork, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>);</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <span class="comment">// restore the original direction</span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <span class="keywordflow">if</span>(tjWork.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a3d0690a80fbffcedf93b202d1c7bd0cd">StepDir</a> != stepDir) <a class="code" href="../../de/d0f/namespacetca.html#aeaedd29af9a4f572ed7fcb21e0337949">ReverseTraj</a>(slc, tjWork);</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    tj = tjWork;</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    <span class="comment">// TODO: Maybe UpdateTjChgProperties should be called here</span></div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    <span class="comment">// re-check the ends</span></div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a50c2901dd2e4719ff3c853d0340a35b1">ChkStop</a>(slc, tj);</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  } <span class="comment">// ReversePropagate</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l01413"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a956ff1118d924911210bace923717e57"> 1413</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#a956ff1118d924911210bace923717e57">GetHitMultiplet</a>(<span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> theHit, std::vector&lt;unsigned int&gt;&amp; hitsInMultiplet, <span class="keywordtype">bool</span> useLongPulseHits)</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;  {</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    <span class="comment">// This function attempts to return a list of hits in the current slice that are close to the</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    <span class="comment">// hit specified by theHit and that are similar to it. If theHit is a high-pulseheight hit (aka imTall)</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    <span class="comment">// and has an RMS similar to a hit on a small angle trajectory (aka Narrow) and is embedded in a series of</span></div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    <span class="comment">// nearby low-pulseheight wide hits, the hit multiplet will consist of the single Tall and Narrow hit. On the</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    <span class="comment">// other hand, if theHit references a short and not-narrow hit, all of the hits in the series of nearby</span></div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    <span class="comment">// hits will be returned. The localIndex is the index of theHit in hitsInMultiplet and shouldn&#39;t be</span></div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="comment">// confused with the recob::Hit LocalIndex</span></div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    hitsInMultiplet.clear();</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    <span class="comment">// check for flagrant errors</span></div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <span class="keywordflow">if</span>(theHit &gt;= slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>.size()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[theHit].InTraj == INT_MAX) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[theHit].allHitsIndex &gt;= (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>).size()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    <span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>)[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[theHit].allHitsIndex];</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    <span class="comment">// handle long-pulse hits</span></div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    <span class="keywordflow">if</span>(useLongPulseHits &amp;&amp; <a class="code" href="../../de/d0f/namespacetca.html#ac13f24978c3ad09c4181c7d2628df67a">LongPulseHit</a>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>)) {</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;      <span class="comment">// return everything in the multiplet as defined by the hit finder, but check for errors</span></div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;      <span class="keywordtype">short</span> <span class="keywordtype">int</span> hitMult = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.Multiplicity();</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lIndex = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.LocalIndex();</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> firstHit = 0;</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;      <span class="keywordflow">if</span>(lIndex &lt; theHit) firstHit = theHit - lIndex;</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ii = firstHit; ii &lt; firstHit + hitMult; ++ii) {</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;        <span class="keywordflow">if</span>(ii &gt;= slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>.size()) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        <span class="keyword">auto</span>&amp; tmp = (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>)[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[ii].allHitsIndex];</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        <span class="keywordflow">if</span>(tmp.Multiplicity() == hitMult) hitsInMultiplet.push_back(ii);</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;      } <span class="comment">// ii</span></div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    } <span class="comment">// LongPulseHit</span></div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    hitsInMultiplet.resize(1);</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    hitsInMultiplet[0] = theHit;</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> theWire = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.WireID().Wire;</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipl = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.WireID().Plane;</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    <span class="keywordtype">float</span> theTime = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.PeakTime();</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    <span class="keywordtype">float</span> theRMS = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.RMS();</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    <span class="keywordtype">float</span> narrowHitCut = 1.5 * <a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab14e445cc20674094b37b35830d15fc0">aveHitRMS</a>[ipl];</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    <span class="keywordtype">bool</span> theHitIsNarrow = (theRMS &lt; narrowHitCut);</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    <span class="keywordtype">float</span> maxPeak = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.PeakAmplitude();</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> imTall = theHit;</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nNarrow = 0;</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    <span class="keywordflow">if</span>(theHitIsNarrow) nNarrow = 1;</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    <span class="comment">// look for hits &lt; theTime but within hitSep</span></div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <span class="keywordflow">if</span>(theHit &gt; 0) {</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht = theHit - 1; iht != 0; --iht) {</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;        <span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>)[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].allHitsIndex];</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.WireID().Wire != theWire) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.WireID().Plane != ipl) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;        <span class="keywordtype">float</span> hitSep = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a36ca642953e6e37f4cc989a8c0dc68ea">multHitSep</a> * theRMS;</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        <span class="keywordtype">float</span> rms = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.RMS();</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;        <span class="keywordflow">if</span>(rms &gt; theRMS) {</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;          hitSep = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a36ca642953e6e37f4cc989a8c0dc68ea">multHitSep</a> * rms;</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;          theRMS = rms;</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;        }</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;        <span class="keywordtype">float</span> dTick = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.PeakTime() - theTime);</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;        <span class="keywordflow">if</span>(dTick &gt; hitSep) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;        hitsInMultiplet.push_back(iht);</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;        <span class="keywordflow">if</span>(rms &lt; narrowHitCut) ++nNarrow;</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;        <span class="keywordtype">float</span> peakAmp = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.PeakAmplitude();</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;        <span class="keywordflow">if</span>(peakAmp &gt; maxPeak) {</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;          maxPeak = peakAmp;</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;          imTall = iht;</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;        }</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;        theTime = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.PeakTime();</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;        <span class="keywordflow">if</span>(iht == 0) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;      } <span class="comment">// iht</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    } <span class="comment">// iht &gt; 0</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    <span class="comment">// reverse the order so that hitsInMuliplet will be</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    <span class="comment">// returned in increasing time order</span></div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    <span class="keywordflow">if</span>(hitsInMultiplet.size() &gt; 1) std::reverse(hitsInMultiplet.begin(), hitsInMultiplet.end());</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    <span class="comment">// look for hits &gt; theTime but within hitSep</span></div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    theTime = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.PeakTime();</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    theRMS = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.RMS();</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht = theHit + 1; iht &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>.size(); ++iht) {</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;      <span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>)[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].allHitsIndex];</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.WireID().Wire != theWire) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.WireID().Plane != ipl) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;      <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj == INT_MAX) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;      <span class="keywordtype">float</span> hitSep = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a36ca642953e6e37f4cc989a8c0dc68ea">multHitSep</a> * theRMS;</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;      <span class="keywordtype">float</span> rms = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.RMS();</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;      <span class="keywordflow">if</span>(rms &gt; theRMS) {</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;        hitSep = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a36ca642953e6e37f4cc989a8c0dc68ea">multHitSep</a> * rms;</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;        theRMS = rms;</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;      }</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;      <span class="keywordtype">float</span> dTick = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.PeakTime() - theTime);</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;      <span class="keywordflow">if</span>(dTick &gt; hitSep) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;      hitsInMultiplet.push_back(iht);</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;      <span class="keywordflow">if</span>(rms &lt; narrowHitCut) ++nNarrow;</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;      <span class="keywordtype">float</span> peakAmp = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.PeakAmplitude();</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;      <span class="keywordflow">if</span>(peakAmp &gt; maxPeak) {</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;        maxPeak = peakAmp;</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;        imTall = iht;</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;      }</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;      theTime = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.PeakTime();</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    } <span class="comment">// iht</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    <span class="keywordflow">if</span>(hitsInMultiplet.size() == 1) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    <span class="comment">// Don&#39;t make a multiplet that includes a tall narrow hit with short fat hits</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    <span class="keywordflow">if</span>(nNarrow == hitsInMultiplet.size()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    <span class="keywordflow">if</span>(nNarrow == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    <span class="keywordflow">if</span>(theHitIsNarrow &amp;&amp; theHit == imTall) {</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;      <span class="comment">// theHit is narrow and it is the highest amplitude hit in the multiplet. Ignore any</span></div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;      <span class="comment">// others that are short and fat</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;      <span class="keyword">auto</span> tmp = hitsInMultiplet;</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;      tmp.resize(1);</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;      tmp[0] = theHit;</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;      hitsInMultiplet = tmp;</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;      <span class="comment">// theHit is not narrow and it is not the tallest. Ignore a single hit if it is</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;      <span class="comment">// the tallest and narrow</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;      <span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>)[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[imTall].allHitsIndex];</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.RMS() &lt; narrowHitCut) {</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> killMe = 0;</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; hitsInMultiplet.size(); ++ii) {</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;          <span class="keywordflow">if</span>(hitsInMultiplet[ii] == imTall) {</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;            killMe = ii;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;          }</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;        } <span class="comment">// ii</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;        hitsInMultiplet.erase(hitsInMultiplet.begin() + killMe);</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;      } <span class="comment">// slc.slHits[imTall].RMS &lt; narrowHitCut</span></div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    } <span class="comment">// narrow / tall test</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;  } <span class="comment">// GetHitMultiplet</span></div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;<span class="comment">  //////////////////////////////////////////</span></div>
<div class="line"><a name="l01542"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#ac61b8ecac1d09b0064ae810ed831af4b"> 1542</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">float</span> <a class="code" href="../../de/d0f/namespacetca.html#ac61b8ecac1d09b0064ae810ed831af4b">HitTimeErr</a>(<span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht)</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;  {</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    <span class="keywordflow">if</span>(iht &gt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>.size() - 1) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    <span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>)[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].allHitsIndex];</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.RMS() * <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a> * <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a903d0579491b91696fa8ab2f5b5eb6b3">hitErrFac</a> * <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.Multiplicity();</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;  } <span class="comment">// HitTimeErr</span></div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="comment">  //////////////////////////////////////////</span></div>
<div class="line"><a name="l01550"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#ab6624f8a02ac76e7a9867b3e0024d7e0"> 1550</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">float</span> <a class="code" href="../../de/d0f/namespacetca.html#ab6624f8a02ac76e7a9867b3e0024d7e0">HitsTimeErr2</a>(<span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <span class="keyword">const</span> std::vector&lt;unsigned int&gt;&amp; hitVec)</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;  {</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    <span class="comment">// Estimates the error^2 of the time using all hits in hitVec</span></div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    <span class="keywordflow">if</span>(hitVec.empty()) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="../../da/d2d/namespaceevd.html#a911fe581afad27a720ee200bd61362a6">err</a> = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a903d0579491b91696fa8ab2f5b5eb6b3">hitErrFac</a> * <a class="code" href="../../de/d0f/namespacetca.html#a9f64129d7d33c42c405c8b33d07262de">HitsRMSTime</a>(slc, hitVec, <a class="code" href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3acc9a44768cfabff4a2048a41a6e5b9dd">kUnusedHits</a>);</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    <span class="keywordflow">return</span> err * <a class="code" href="../../da/d2d/namespaceevd.html#a911fe581afad27a720ee200bd61362a6">err</a>;</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;  } <span class="comment">// HitsTimeErr2</span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l01560"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a36a327d57361f40edfb73d1816ca4ce7"> 1560</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#a36a327d57361f40edfb73d1816ca4ce7">ChkStopEndPts</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj, <span class="keywordtype">bool</span> prt)</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  {</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    <span class="comment">// Analyze the end of the Tj after crawling has stopped to see if any of the points</span></div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    <span class="comment">// should be used</span></div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afa6980f5646e419795cdc43499a55104">EndFlag</a>[1][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa8a209073700148c7515fa38bae5e2873">kAtKink</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5dacb4caa0b9c5541c82a2031efb8c69281">kChkStopEP</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da9b5200eaaed0e097cac019d6643e537e">kJunkTj</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bca881b9d556e1114d8cce02b75d65120db">kStiffEl</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> endPt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1];</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;    <span class="comment">// ignore VLA Tjs</span></div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[endPt].AngleCode &gt; 1) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    <span class="comment">// don&#39;t get too carried away with this</span></div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() - endPt &gt; 10) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    <span class="comment">// Get a list of hits a few wires beyond the last point on the Tj</span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> planeID = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a9ba64d632bc17b16226d212f27dbc0aa">CTP</a>);</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = planeID.<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>;</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    <span class="comment">// find the last point that has hits on it</span></div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> lastPt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() - 1;</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;    <span class="keywordflow">for</span>(lastPt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() - 1; lastPt &gt;= tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]; --lastPt) <span class="keywordflow">if</span>(!tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt].Hits.empty()) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    <span class="keyword">auto</span>&amp; lastTP = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt];</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;CSEP: checking &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>&lt;&lt;<span class="stringliteral">&quot; endPt &quot;</span>&lt;&lt;endPt&lt;&lt;<span class="stringliteral">&quot; Pts size &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size()&lt;&lt;<span class="stringliteral">&quot; lastPt Pos &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, lastTP.Pos);</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    }</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a> ltp;</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;    ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a00fdf2d73e4a03e5a7f32411e460ba2e">CTP</a> = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a9ba64d632bc17b16226d212f27dbc0aa">CTP</a>;</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a> = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[endPt].Pos;</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;    ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a> = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[endPt].Dir;</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;    <span class="keywordtype">double</span> stepSize = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(1/ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0]);</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    std::array&lt;int, 2&gt; wireWindow;</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    std::array&lt;float, 2&gt; timeWindow;</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    std::vector&lt;int&gt; closeHits;</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    <span class="keywordtype">bool</span> isClean = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> step = 0; step &lt; 10; ++step) {</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> iwt = 0; iwt &lt; 2; ++iwt) ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[iwt] += ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[iwt] * stepSize;</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;      <span class="keywordtype">int</span> wire = std::nearbyint(ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0]);</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;      wireWindow[0] = wire;</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;      wireWindow[1] = wire;</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;      timeWindow[0] = ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1] - 5;</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;      timeWindow[1] = ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1] + 5;</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;      <span class="keywordtype">bool</span> hitsNear;</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;      <span class="keyword">auto</span> tmp = <a class="code" href="../../de/d0f/namespacetca.html#a519cf8a3170ec63e0b4d457f1d236109">FindCloseHits</a>(slc, wireWindow, timeWindow, plane, <a class="code" href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3af8476e403cd021d9242196cdcfb127a9">kAllHits</a>, <span class="keyword">true</span>, hitsNear);</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;      <span class="comment">// add close hits that are not associated with this tj</span></div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;      <span class="keywordflow">for</span>(<span class="keyword">auto</span> iht : tmp) <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj != tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>) closeHits.push_back(iht);</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;      <span class="keywordtype">float</span> nWiresPast = 0;</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;      <span class="comment">// Check beyond the end of the trajectory to see if there are hits there</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;      <span class="keywordflow">if</span>(ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0] &gt; 0) {</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;        <span class="comment">// stepping +</span></div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;        nWiresPast = ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] - lastTP.Pos[0];</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;      }  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;        <span class="comment">// stepping -</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;        nWiresPast = lastTP.Pos[0] - ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0];</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;      }</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; Found &quot;</span>&lt;&lt;tmp.size()&lt;&lt;<span class="stringliteral">&quot; hits near pos &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, ltp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>)&lt;&lt;<span class="stringliteral">&quot; nWiresPast &quot;</span>&lt;&lt;nWiresPast;</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;      <span class="keywordflow">if</span>(nWiresPast &gt; 0.5) {</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;        <span class="keywordflow">if</span>(!tmp.empty()) isClean = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;        <span class="keywordflow">if</span>(nWiresPast &gt; 1.5) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;      } <span class="comment">// nWiresPast &gt; 0.5</span></div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;    } <span class="comment">// step</span></div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;    <span class="comment">// count the number of available hits</span></div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nAvailable = 0;</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span> iht : closeHits) <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj == 0) ++nAvailable;</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;      mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot;closeHits&quot;</span>;</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;      <span class="keywordflow">for</span>(<span class="keyword">auto</span> iht : closeHits) myprt&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a6f0a1df60836abcb51565bc85c828f18">PrintHit</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht]);</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; nAvailable &quot;</span>&lt;&lt;nAvailable;</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; isClean &quot;</span>&lt;&lt;isClean;</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    } <span class="comment">// prt</span></div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    <span class="keywordflow">if</span>(!isClean || nAvailable != closeHits.size()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> originalEndPt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] + 1;</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    <span class="comment">// looks clean so use all the hits</span></div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = originalEndPt; ipt &lt;= lastPt; ++ipt) {</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;      <span class="keyword">auto</span>&amp; tp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt];</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;      <span class="keywordtype">bool</span> hitsAdded = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tp.Hits.size(); ++ii) {</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;        <span class="comment">// This shouldn&#39;t happen but check anyway</span></div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;        <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[tp.Hits[ii]].InTraj != 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;        tp.UseHit[ii] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;        slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[tp.Hits[ii]].InTraj = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>;</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;        hitsAdded = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;      } <span class="comment">// ii</span></div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;      <span class="keywordflow">if</span>(hitsAdded) <a class="code" href="../../de/d0f/namespacetca.html#adcfb1da7e005bcdbdd61dc5baf815be1">DefineHitPos</a>(slc, tp);</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5dacb4caa0b9c5541c82a2031efb8c69281">kChkStopEP</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    <span class="comment">// Re-fitting the end might be a good idea but it&#39;s probably not necessary. The</span></div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    <span class="comment">// values of Delta should have already been filled</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    <span class="comment">// require a Bragg peak</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a50c2901dd2e4719ff3c853d0340a35b1">ChkStop</a>(slc, tj);</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    <span class="keywordflow">if</span>(!tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afa6980f5646e419795cdc43499a55104">EndFlag</a>[1][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa0a4b8d8fc21482d4679f7eac8f457e70">kBragg</a>]) {</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;      <span class="comment">// restore the original</span></div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = originalEndPt; ipt &lt;= lastPt; ++ipt) <a class="code" href="../../de/d0f/namespacetca.html#a20bf265ff689ff64027c4d072e7ed598">UnsetUsedHits</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt]);</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;    } <span class="comment">// no Bragg Peak</span></div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a45584aa4b4e3ca2963ed52c7e5a28ff8">UpdateTjChgProperties</a>(<span class="stringliteral">&quot;CSEP&quot;</span>, slc, tj, prt);</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;  } <span class="comment">// ChkStopEndPts</span></div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;<span class="comment">  //////////////////////////////////////////</span></div>
<div class="line"><a name="l01670"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#adcfb1da7e005bcdbdd61dc5baf815be1"> 1670</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#adcfb1da7e005bcdbdd61dc5baf815be1">DefineHitPos</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a>&amp; tp)</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;  {</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;    <span class="comment">// defines HitPos, HitPosErr2 and Chg for the used hits in the trajectory point</span></div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;    tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a> = 0;</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    <span class="keywordflow">if</span>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nused = 0;</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht = 0;</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.size(); ++ii) {</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;      <span class="keywordflow">if</span>(!tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>[ii]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;      ++nused;</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;      iht = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>[ii];</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;      <span class="keywordflow">if</span>(iht &gt;= slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>.size()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;      <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].allHitsIndex &gt;= (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>).size()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    }</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;    <span class="keywordflow">if</span>(nused == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    <span class="comment">// don&#39;t bother with rest of this if there is only one hit since it can</span></div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;    <span class="comment">// only reside on one wire</span></div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;    <span class="keywordflow">if</span>(nused == 1) {</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;      <span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>)[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].allHitsIndex];</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a> = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.Integral();</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a4aa62ed88bd15f92ac4de07abcd44375">HitPos</a>[0] = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.WireID().Wire;</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a4aa62ed88bd15f92ac4de07abcd44375">HitPos</a>[1] = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.PeakTime() * <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a>;</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#ac13f24978c3ad09c4181c7d2628df67a">LongPulseHit</a>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>)) {</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;        <span class="comment">// give it a huge error^2 since the position is not well defined</span></div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;        tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aeb58a2acf3a7ce07200166dedddc2de5">HitPosErr2</a> = 100;</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;        <span class="comment">// Normalize to 1 WSE path length</span></div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;        <span class="keywordtype">float</span> pathInv = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0]);</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;        <span class="keywordflow">if</span>(pathInv &lt; 0.05) pathInv = 0.05;</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;        tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a> *= pathInv;</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;        <span class="keywordtype">float</span> wireErr = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[1] * 0.289;</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;        <span class="keywordtype">float</span> timeErr = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0] * <a class="code" href="../../de/d0f/namespacetca.html#ac61b8ecac1d09b0064ae810ed831af4b">HitTimeErr</a>(slc, iht);</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;        tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aeb58a2acf3a7ce07200166dedddc2de5">HitPosErr2</a> = wireErr * wireErr + timeErr * timeErr;</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;      }</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;DefineHitPos: singlet &quot;</span>&lt;&lt;std::fixed&lt;&lt;std::setprecision(1)&lt;&lt;tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a4aa62ed88bd15f92ac4de07abcd44375">HitPos</a>[0]&lt;&lt;<span class="stringliteral">&quot;:&quot;</span>&lt;&lt;(int)(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a4aa62ed88bd15f92ac4de07abcd44375">HitPos</a>[1]/<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a>)&lt;&lt;<span class="stringliteral">&quot; ticks. HitPosErr &quot;</span>&lt;&lt;sqrt(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aeb58a2acf3a7ce07200166dedddc2de5">HitPosErr2</a>);</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    } <span class="comment">// nused == 1</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    <span class="comment">// multiple hits possibly on different wires</span></div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    std::vector&lt;unsigned int&gt; hitVec;</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a> = 0;</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    std::array&lt;float, 2&gt; newpos;</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;    <span class="keywordtype">float</span> chg;</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    newpos[0] = 0;</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    newpos[1] = 0;</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    <span class="comment">// Find the wire range for hits used in the TP</span></div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> loWire = INT_MAX;</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hiWire = 0;</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.size(); ++ii) {</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;      <span class="keywordflow">if</span>(!tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>[ii]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>[ii];</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;      <span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>)[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].allHitsIndex];</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;      chg = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.Integral();</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wire = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.WireID().Wire;</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;      <span class="keywordflow">if</span>(wire &lt; loWire) loWire = wire;</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;      <span class="keywordflow">if</span>(wire &gt; hiWire) hiWire = wire;</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;      newpos[0] += chg * wire;</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;      newpos[1] += chg * <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.PeakTime();</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a> += chg;</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;      hitVec.push_back(iht);</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;    } <span class="comment">// ii</span></div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    <span class="keywordflow">if</span>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a> == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;    tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a4aa62ed88bd15f92ac4de07abcd44375">HitPos</a>[0] = newpos[0] / tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a>;</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;    tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a4aa62ed88bd15f92ac4de07abcd44375">HitPos</a>[1] = newpos[1] * <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a> / tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a>;</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;    <span class="comment">// Normalize to 1 WSE path length</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;    <span class="keywordtype">float</span> pathInv = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0]);</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;    <span class="keywordflow">if</span>(pathInv &lt; 0.05) pathInv = 0.05;</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;    tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a> *= pathInv;</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    <span class="comment">// Error is the wire error (1/sqrt(12))^2 if all hits are on one wire.</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    <span class="comment">// Scale it by the wire range</span></div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    <span class="keywordtype">float</span> dWire = 1 + hiWire - loWire;</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;    <span class="keywordtype">float</span> wireErr = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[1] * dWire * 0.289;</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    <span class="keywordtype">float</span> timeErr2 = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0] * tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0] * <a class="code" href="../../de/d0f/namespacetca.html#ab6624f8a02ac76e7a9867b3e0024d7e0">HitsTimeErr2</a>(slc, hitVec);</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;    tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aeb58a2acf3a7ce07200166dedddc2de5">HitPosErr2</a> = wireErr * wireErr + timeErr2;</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;DefineHitPos: multiplet &quot;</span>&lt;&lt;std::fixed&lt;&lt;std::setprecision(1)&lt;&lt;tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a4aa62ed88bd15f92ac4de07abcd44375">HitPos</a>[0]&lt;&lt;<span class="stringliteral">&quot;:&quot;</span>&lt;&lt;(int)(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a4aa62ed88bd15f92ac4de07abcd44375">HitPos</a>[1]/<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a>)&lt;&lt;<span class="stringliteral">&quot; ticks. HitPosErr &quot;</span>&lt;&lt;sqrt(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aeb58a2acf3a7ce07200166dedddc2de5">HitPosErr2</a>);</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;  } <span class="comment">// DefineHitPos</span></div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;<span class="comment">  //////////////////////////////////////////</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a81a9901d72f5bcdc7ad45878bac54739"> 1755</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#a81a9901d72f5bcdc7ad45878bac54739">FindUseHits</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt, <span class="keywordtype">float</span> maxDelta, <span class="keywordtype">bool</span> useChg)</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;  {</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    <span class="comment">// Hits have been associated with trajectory point ipt but none are used. Here we will</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    <span class="comment">// decide which hits to use.</span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    <span class="keywordflow">if</span>(ipt &gt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() - 1) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a>&amp; tp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt];</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    <span class="keywordflow">if</span>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    <span class="comment">// don&#39;t check charge when starting out</span></div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    <span class="keywordflow">if</span>(ipt &lt; 5) useChg = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    <span class="keywordtype">float</span> chgPullCut = 1000;</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    <span class="keywordflow">if</span>(useChg) chgPullCut = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a3a55337e6b54dd9a9e29ab70da5cd760">chargeCuts</a>[0];</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <span class="comment">// open it up for RevProp, since we might be following a stopping track</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">kRvPrp</a>]) chgPullCut *= 2;</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a> &lt; 30) chgPullCut *= 2;</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;    <span class="keywordtype">bool</span> ignoreLongPulseHits = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> npts = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] - tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0] + 1;</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;    <span class="keywordflow">if</span>(npts &lt; 10 || tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">kRvPrp</a>]) ignoreLongPulseHits = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;    <span class="keywordtype">float</span> expectedHitsRMS = <a class="code" href="../../de/d0f/namespacetca.html#a8fcdaae008c0c29ae4a6442344c306ee">ExpectedHitsRMS</a>(slc, tp);</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;FUH:  maxDelta &quot;</span>&lt;&lt;maxDelta&lt;&lt;<span class="stringliteral">&quot; useChg requested &quot;</span>&lt;&lt;useChg&lt;&lt;<span class="stringliteral">&quot; Norm AveChg &quot;</span>&lt;&lt;(int)tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac7ee47f41dc2e24263c8c9fb9a135dd2">AveChg</a>&lt;&lt;<span class="stringliteral">&quot; tj.ChgRMS &quot;</span>&lt;&lt;std::setprecision(2)&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a0787c3db4bce3ad556211ba704897ab3">ChgRMS</a>&lt;&lt;<span class="stringliteral">&quot; chgPullCut &quot;</span>&lt;&lt;chgPullCut&lt;&lt;<span class="stringliteral">&quot; TPHitsRMS &quot;</span>&lt;&lt;(int)<a class="code" href="../../de/d0f/namespacetca.html#a33eb5964553085dbc29dfc5e8339110e">TPHitsRMSTick</a>(slc, tp, <a class="code" href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3acc9a44768cfabff4a2048a41a6e5b9dd">kUnusedHits</a>)&lt;&lt;<span class="stringliteral">&quot; ExpectedHitsRMS &quot;</span>&lt;&lt;(int)expectedHitsRMS&lt;&lt;<span class="stringliteral">&quot; AngCode &quot;</span>&lt;&lt;tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#af4135bac344253d4fecaca6369722c0a">AngleCode</a>;</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;    }</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;    <span class="comment">// inverse of the path length for normalizing hit charge to 1 WSE unit</span></div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    <span class="keywordtype">float</span> pathInv = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0]);</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    <span class="keywordflow">if</span>(pathInv &lt; 0.05) pathInv = 0.05;</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    <span class="comment">// Find the hit that has the smallest delta and the number of available hits</span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a011749db067df79503a159672ada3c4d">Delta</a> = maxDelta;</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;    <span class="keywordtype">float</span> delta;</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> imbest = USHRT_MAX;</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;    std::vector&lt;float&gt; deltas(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.size(), 100);</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;    <span class="comment">// keep track of the best delta - even if it is used</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    <span class="keywordtype">float</span> bestDelta = maxDelta;</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nAvailable = 0;</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> firstAvailable = USHRT_MAX;</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> lastAvailable = USHRT_MAX;</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> firstUsed = USHRT_MAX;</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> imBadRecoHit = USHRT_MAX;</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    <span class="keywordtype">bool</span> bestHitLongPulse = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.size(); ++ii) {</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>[ii] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>[ii];</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;      <span class="keywordflow">if</span>(iht &gt;= slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>.size()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;      <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].allHitsIndex &gt;= (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>).size()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;      delta = <a class="code" href="../../de/d0f/namespacetca.html#a310add1134404b2b548a1a88f652cc04">PointTrajDOCA</a>(slc, iht, tp);</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;      <span class="keywordflow">if</span>(delta &lt; bestDelta) bestDelta = delta;</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;      <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj &gt; 0) {</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;        <span class="keywordflow">if</span>(firstUsed == USHRT_MAX) firstUsed = ii;</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;      }</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;      <span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>)[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].allHitsIndex];</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;      <span class="keywordflow">if</span>(ignoreLongPulseHits &amp;&amp; <a class="code" href="../../de/d0f/namespacetca.html#ac13f24978c3ad09c4181c7d2628df67a">LongPulseHit</a>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.GoodnessOfFit() &lt; 0 || <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.GoodnessOfFit() &gt; 100) imBadRecoHit = ii;</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;      <span class="keywordflow">if</span>(firstAvailable == USHRT_MAX) firstAvailable = ii;</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;      lastAvailable = ii;</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;      ++nAvailable;</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;        <span class="keywordflow">if</span>(useChg) {</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;  &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a6f0a1df60836abcb51565bc85c828f18">PrintHit</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht])&lt;&lt;<span class="stringliteral">&quot; delta &quot;</span>&lt;&lt;delta&lt;&lt;<span class="stringliteral">&quot; Norm Chg &quot;</span>&lt;&lt;(int)(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.Integral() * pathInv);</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;  &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a6f0a1df60836abcb51565bc85c828f18">PrintHit</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht])&lt;&lt;<span class="stringliteral">&quot; delta &quot;</span>&lt;&lt;delta;</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;        }</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;      } <span class="comment">// tcc.dbgStp</span></div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;      deltas[ii] = delta;</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;      <span class="keywordflow">if</span>(delta &lt; tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a011749db067df79503a159672ada3c4d">Delta</a>) {</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;        tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a011749db067df79503a159672ada3c4d">Delta</a> = delta;</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;        imbest = ii;</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;        bestHitLongPulse = <a class="code" href="../../de/d0f/namespacetca.html#ac13f24978c3ad09c4181c7d2628df67a">LongPulseHit</a>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>);</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;      }</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    } <span class="comment">// ii</span></div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;    <span class="keywordtype">float</span> chgWght = 0.5;</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; firstAvailable &quot;</span>&lt;&lt;firstAvailable&lt;&lt;<span class="stringliteral">&quot; lastAvailable &quot;</span>&lt;&lt;lastAvailable&lt;&lt;<span class="stringliteral">&quot; firstUsed &quot;</span>&lt;&lt;firstUsed&lt;&lt;<span class="stringliteral">&quot; imbest &quot;</span>&lt;&lt;imbest&lt;&lt;<span class="stringliteral">&quot; single hit. tp.Delta &quot;</span>&lt;&lt;std::setprecision(2)&lt;&lt;tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a011749db067df79503a159672ada3c4d">Delta</a>&lt;&lt;<span class="stringliteral">&quot; bestDelta &quot;</span>&lt;&lt;bestDelta&lt;&lt;<span class="stringliteral">&quot; path length &quot;</span>&lt;&lt;1 / pathInv&lt;&lt;<span class="stringliteral">&quot; imBadRecoHit &quot;</span>&lt;&lt;imBadRecoHit;</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    <span class="keywordflow">if</span>(imbest == USHRT_MAX || nAvailable == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bestDeltaHit = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>[imbest];</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;    <span class="comment">// just use the best hit if we are tracking a high energy electron and the best hit is a long pulse hit</span></div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bca881b9d556e1114d8cce02b75d65120db">kStiffEl</a>] &amp;&amp; bestHitLongPulse) {</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>[imbest] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;      slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[bestDeltaHit].InTraj = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>;</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;    }</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    <span class="comment">// Don&#39;t try to use a multiplet if a hit in the middle is in a different trajectory</span></div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    <span class="keywordflow">if</span>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.size() &gt; 2 &amp;&amp; nAvailable &gt; 1 &amp;&amp; firstUsed != USHRT_MAX &amp;&amp; firstAvailable &lt; firstUsed &amp;&amp; lastAvailable &gt; firstUsed) {</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; A hit in the middle of the multiplet is used. Use only the best hit&quot;</span>;</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>[imbest] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;      slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[bestDeltaHit].InTraj = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>;</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;    } <span class="comment">// Used hit inside multiplet</span></div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;    <span class="keywordflow">if</span>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#af4135bac344253d4fecaca6369722c0a">AngleCode</a> == 1) {</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;      <span class="comment">// Get the hits that are in the same multiplet as bestDeltaHit</span></div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;      std::vector&lt;unsigned int&gt; hitsInMultiplet;</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a956ff1118d924911210bace923717e57">GetHitMultiplet</a>(slc, bestDeltaHit, hitsInMultiplet, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;        mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;        myprt&lt;&lt;<span class="stringliteral">&quot; bestDeltaHit &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a6f0a1df60836abcb51565bc85c828f18">PrintHit</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[bestDeltaHit]);</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;        myprt&lt;&lt;<span class="stringliteral">&quot; in multiplet:&quot;</span>;</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;        <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; iht : hitsInMultiplet) myprt&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a6f0a1df60836abcb51565bc85c828f18">PrintHit</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht]);</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;      }</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;      <span class="comment">// Consider the case where a bad reco hit might be better. It is probably wider and</span></div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;      <span class="comment">// has more charge</span></div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;      <span class="keywordflow">if</span>(imBadRecoHit != USHRT_MAX) {</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>[imBadRecoHit];</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;        <span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>)[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].allHitsIndex];</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.RMS() &gt; <a class="code" href="../../de/d0f/namespacetca.html#abaa1e009ae37b34b0d8720c2f21389db">HitsRMSTick</a>(slc, hitsInMultiplet, <a class="code" href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3acc9a44768cfabff4a2048a41a6e5b9dd">kUnusedHits</a>)) {</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; Using imBadRecoHit &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a6f0a1df60836abcb51565bc85c828f18">PrintHit</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht]);</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;          tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>[imBadRecoHit] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;          slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>;</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;        }</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;      } <span class="comment">// bad reco hit</span></div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;      <span class="comment">// Use the hits in the multiplet instead</span></div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.size(); ++ii) {</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>[ii];</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;        <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj &gt; 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;        <span class="keywordflow">if</span>(std::find(hitsInMultiplet.begin(), hitsInMultiplet.end(), iht) == hitsInMultiplet.end()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;        tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>[ii] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;        slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>;</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;      } <span class="comment">// ii</span></div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    } <span class="comment">// isLA</span></div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    <span class="comment">// don&#39;t use the best UNUSED hit if the best delta is for a USED hit and it is much better</span></div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    <span class="comment">// TY: ignore for RevProp</span></div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;    <span class="keywordflow">if</span>(bestDelta &lt; 0.5 * tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a011749db067df79503a159672ada3c4d">Delta</a> &amp;&amp; !tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">kRvPrp</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;    <span class="keywordflow">if</span>(!useChg || (useChg &amp;&amp; (tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdb8e6dfd5aba49787dab959fea3ac2c">AveChg</a> &lt;= 0 || tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a0787c3db4bce3ad556211ba704897ab3">ChgRMS</a> &lt;= 0))) {</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;      <span class="comment">// necessary quantities aren&#39;t available for more careful checking</span></div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; tj.AveChg &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdb8e6dfd5aba49787dab959fea3ac2c">AveChg</a>&lt;&lt;<span class="stringliteral">&quot; or tj.ChgRMS &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a0787c3db4bce3ad556211ba704897ab3">ChgRMS</a>&lt;&lt;<span class="stringliteral">&quot;. Use the best hit&quot;</span>;</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>[imbest] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;      slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[bestDeltaHit].InTraj = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>;</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;    }</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;    <span class="comment">// Don&#39;t try to get fancy if we are tracking a stiff tj</span></div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ab2c0db630cd45caff1c041d639c5f253">PDGCode</a> == 13 &amp;&amp; bestDelta &lt; 0.5) {</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; Tracking muon. Use the best hit&quot;</span>;</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>[imbest] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;      slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[bestDeltaHit].InTraj = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>;</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;    }</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    <span class="comment">// The best hit is the only one available or this is a small angle trajectory</span></div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;    <span class="keywordflow">if</span>(nAvailable == 1 || tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#af4135bac344253d4fecaca6369722c0a">AngleCode</a> == 0) {</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;      <span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>)[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[bestDeltaHit].allHitsIndex];</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;      <span class="keywordtype">float</span> aveChg = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac7ee47f41dc2e24263c8c9fb9a135dd2">AveChg</a>;</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;      <span class="keywordflow">if</span>(aveChg &lt;= 0) aveChg = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdb8e6dfd5aba49787dab959fea3ac2c">AveChg</a>;</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;      <span class="keywordflow">if</span>(aveChg &lt;= 0) aveChg = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.Integral();</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;      <span class="keywordtype">float</span> chgRMS = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a0787c3db4bce3ad556211ba704897ab3">ChgRMS</a>;</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;      <span class="keywordflow">if</span>(chgRMS &lt; 0.2) chgRMS = 0.2;</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;      <span class="keywordtype">float</span> bestDeltaHitChgPull = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.Integral() * pathInv / aveChg - 1) / chgRMS;</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; bestDeltaHitChgPull &quot;</span>&lt;&lt;bestDeltaHitChgPull&lt;&lt;<span class="stringliteral">&quot; chgPullCut &quot;</span>&lt;&lt;chgPullCut;</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;      <span class="keywordflow">if</span>(bestDeltaHitChgPull &lt; chgPullCut || tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a011749db067df79503a159672ada3c4d">Delta</a> &lt; 0.1) {</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;        tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>[imbest] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;        slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[bestDeltaHit].InTraj = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>;</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;      } <span class="comment">// good charge or very good delta</span></div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;    } <span class="comment">// bestDeltaHitMultiplicity == 1</span></div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    <span class="comment">// Find the expected width for the angle of this TP (ticks)</span></div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;    <span class="keywordtype">float</span> expectedWidth = <a class="code" href="../../de/d0f/namespacetca.html#a8fcdaae008c0c29ae4a6442344c306ee">ExpectedHitsRMS</a>(slc, tp);</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;    <span class="comment">// Handle two available hits</span></div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;    <span class="keywordflow">if</span>(nAvailable == 2) {</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;      <span class="comment">// See if these two are in the same multiplet and both are available</span></div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;      std::vector&lt;unsigned int&gt; tHits;</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a956ff1118d924911210bace923717e57">GetHitMultiplet</a>(slc, bestDeltaHit, tHits, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;      <span class="comment">// ombest is the index of the other hit in tp.Hits that is in the same multiplet as bestDeltaHit</span></div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;      <span class="comment">// if we find it</span></div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ombest = USHRT_MAX;</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> otherHit = INT_MAX;</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;      <span class="keywordflow">if</span>(tHits.size() == 2) {</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> localIndex = 0;</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;        <span class="keywordflow">if</span>(tHits[0] == bestDeltaHit) localIndex = 1;</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;        otherHit = tHits[1 - localIndex];</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;        <span class="comment">// get the index of this hit in tp.Hits</span></div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.size(); ++ii) {</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;          <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>[ii]].InTraj &gt; 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;          <span class="keywordflow">if</span>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>[ii] == otherHit) {</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;            ombest = ii;</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;          }</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;        } <span class="comment">// ii</span></div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;      } <span class="comment">// tHits.size() == 2</span></div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;        mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; Doublet: imbest &quot;</span>&lt;&lt;imbest&lt;&lt;<span class="stringliteral">&quot; ombest &quot;</span>&lt;&lt;ombest;</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;      }</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;      <span class="comment">// The other hit exists in the tp and it is available</span></div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;      <span class="keywordflow">if</span>(ombest &lt; tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.size()) {</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;        <span class="comment">// compare the best delta hit and the other hit separately and the doublet as a merged pair</span></div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;        <span class="keywordtype">float</span> bestHitDeltaErr = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[1]) * 0.17 + <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0]) * <a class="code" href="../../de/d0f/namespacetca.html#ac61b8ecac1d09b0064ae810ed831af4b">HitTimeErr</a>(slc, bestDeltaHit);</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;        <span class="comment">// Construct a FOM starting with the delta pull</span></div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;        <span class="keywordtype">float</span> bestDeltaHitFOM = deltas[imbest] /  bestHitDeltaErr;</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;        <span class="keywordflow">if</span>(bestDeltaHitFOM &lt; 0.5) bestDeltaHitFOM = 0.5;</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;        <span class="comment">// multiply by the charge pull if it is significant</span></div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;        <span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>)[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[bestDeltaHit].allHitsIndex];</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;        <span class="keywordtype">float</span> bestDeltaHitChgPull = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.Integral() * pathInv / tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac7ee47f41dc2e24263c8c9fb9a135dd2">AveChg</a> - 1) / tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a0787c3db4bce3ad556211ba704897ab3">ChgRMS</a>;</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;        <span class="keywordflow">if</span>(bestDeltaHitChgPull &gt; 1) bestDeltaHitFOM *= chgWght * bestDeltaHitChgPull;</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;        <span class="comment">// scale by the ratio</span></div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;        <span class="keywordtype">float</span> rmsRat = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.RMS() / expectedWidth;</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;        <span class="keywordflow">if</span>(rmsRat &lt; 1) rmsRat = 1 / rmsRat;</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;        bestDeltaHitFOM *= rmsRat;</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; bestDeltaHit FOM &quot;</span>&lt;&lt;deltas[imbest]/bestHitDeltaErr&lt;&lt;<span class="stringliteral">&quot; bestDeltaHitChgPull &quot;</span>&lt;&lt;bestDeltaHitChgPull&lt;&lt;<span class="stringliteral">&quot; rmsRat &quot;</span>&lt;&lt;rmsRat&lt;&lt;<span class="stringliteral">&quot; bestDeltaHitFOM &quot;</span>&lt;&lt;bestDeltaHitFOM;</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;        <span class="comment">// Now do the same for the other hit</span></div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;        <span class="keywordtype">float</span> otherHitDeltaErr = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[1]) * 0.17 + <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0]) * <a class="code" href="../../de/d0f/namespacetca.html#ac61b8ecac1d09b0064ae810ed831af4b">HitTimeErr</a>(slc, otherHit);</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;        <span class="keywordtype">float</span> otherHitFOM = deltas[ombest] /  otherHitDeltaErr;</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;        <span class="keywordflow">if</span>(otherHitFOM &lt; 0.5) otherHitFOM = 0.5;</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;        <span class="keyword">auto</span>&amp; ohit = (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>)[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[otherHit].allHitsIndex];</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;        <span class="keywordtype">float</span> otherHitChgPull = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(ohit.Integral() * pathInv / tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac7ee47f41dc2e24263c8c9fb9a135dd2">AveChg</a> - 1) / tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a0787c3db4bce3ad556211ba704897ab3">ChgRMS</a>;</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;        <span class="keywordflow">if</span>(otherHitChgPull &gt; 1) otherHitFOM *= chgWght * otherHitChgPull;</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;        rmsRat = ohit.RMS() / expectedWidth;</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;        <span class="keywordflow">if</span>(rmsRat &lt; 1) rmsRat = 1 / rmsRat;</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;        otherHitFOM *= rmsRat;</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; otherHit FOM &quot;</span>&lt;&lt;deltas[ombest]/otherHitDeltaErr&lt;&lt;<span class="stringliteral">&quot; otherHitChgPull &quot;</span>&lt;&lt;otherHitChgPull&lt;&lt;<span class="stringliteral">&quot; rmsRat &quot;</span>&lt;&lt;rmsRat&lt;&lt;<span class="stringliteral">&quot; otherHitFOM &quot;</span>&lt;&lt;otherHitFOM;</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;        <span class="comment">// And for the doublet</span></div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;        <span class="keywordtype">float</span> doubletChg = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.Integral() + ohit.Integral();</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;        <span class="keywordtype">float</span> doubletTime = (<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.Integral() * <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.PeakTime() + ohit.Integral() * ohit.PeakTime()) / doubletChg;</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;        doubletChg *= pathInv;</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;        doubletTime *= <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a>;</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;        <span class="keywordtype">float</span> doubletWidthTick = <a class="code" href="../../de/d0f/namespacetca.html#a33eb5964553085dbc29dfc5e8339110e">TPHitsRMSTick</a>(slc, tp, <a class="code" href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3acc9a44768cfabff4a2048a41a6e5b9dd">kUnusedHits</a>);</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;        <span class="keywordtype">float</span> doubletRMSTimeErr = doubletWidthTick * <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a>;</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; doublet Chg &quot;</span>&lt;&lt;doubletChg&lt;&lt;<span class="stringliteral">&quot; doubletTime &quot;</span>&lt;&lt;doubletTime&lt;&lt;<span class="stringliteral">&quot; doubletRMSTimeErr &quot;</span>&lt;&lt;doubletRMSTimeErr;</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;        <span class="keywordtype">float</span> doubletFOM = <a class="code" href="../../de/d0f/namespacetca.html#a310add1134404b2b548a1a88f652cc04">PointTrajDOCA</a>(slc, tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0], doubletTime, tp) / doubletRMSTimeErr;</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;        <span class="keywordflow">if</span>(doubletFOM &lt; 0.5) doubletFOM = 0.5;</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;        <span class="keywordtype">float</span> doubletChgPull = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(doubletChg * pathInv / tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac7ee47f41dc2e24263c8c9fb9a135dd2">AveChg</a> - 1) / tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a0787c3db4bce3ad556211ba704897ab3">ChgRMS</a>;</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;        <span class="keywordflow">if</span>(doubletChgPull &gt; 1) doubletFOM *= chgWght * doubletChgPull;</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;        rmsRat = doubletWidthTick / expectedWidth;</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;        <span class="keywordflow">if</span>(rmsRat &lt; 1) rmsRat = 1 / rmsRat;</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;        doubletFOM *= rmsRat;</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; doublet FOM &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a310add1134404b2b548a1a88f652cc04">PointTrajDOCA</a>(slc, tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0], doubletTime, tp)/doubletRMSTimeErr&lt;&lt;<span class="stringliteral">&quot; doubletChgPull &quot;</span>&lt;&lt;doubletChgPull&lt;&lt;<span class="stringliteral">&quot; rmsRat &quot;</span>&lt;&lt;rmsRat&lt;&lt;<span class="stringliteral">&quot; doubletFOM &quot;</span>&lt;&lt;doubletFOM;</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;        <span class="keywordflow">if</span>(doubletFOM &lt; bestDeltaHitFOM &amp;&amp; doubletFOM &lt; otherHitFOM) {</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;          tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>[imbest] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;          slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[bestDeltaHit].InTraj = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>;</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;          tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>[ombest] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;          slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[otherHit].InTraj = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>;</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;          <span class="comment">// the doublet is not the best</span></div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;          <span class="keywordflow">if</span>(bestDeltaHitFOM &lt; otherHitFOM) {</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;            tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>[imbest] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;            slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[bestDeltaHit].InTraj = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>;</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;            tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>[ombest] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;            slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[otherHit].InTraj = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>;</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;          } <span class="comment">// otherHit is the best</span></div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;        } <span class="comment">// doublet is not the best</span></div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;        <span class="comment">// the other hit isn&#39;t available. Just use the singlet</span></div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;        tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>[imbest] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;        slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[bestDeltaHit].InTraj = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>;</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;      }</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;    } <span class="comment">// nAvailable == 2</span></div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;    <span class="keywordtype">float</span> hitsWidth = <a class="code" href="../../de/d0f/namespacetca.html#a33eb5964553085dbc29dfc5e8339110e">TPHitsRMSTick</a>(slc, tp, <a class="code" href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3acc9a44768cfabff4a2048a41a6e5b9dd">kUnusedHits</a>);</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;    <span class="keywordtype">float</span> maxTick = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1] / <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a> + 0.6 * expectedWidth;</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;    <span class="keywordtype">float</span> minTick = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1] / <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a> - 0.6 * expectedWidth;</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; Multiplet: hitsWidth &quot;</span>&lt;&lt;hitsWidth&lt;&lt;<span class="stringliteral">&quot; expectedWidth &quot;</span>&lt;&lt;expectedWidth&lt;&lt;<span class="stringliteral">&quot; tick range &quot;</span>&lt;&lt;(int)minTick&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;(<span class="keywordtype">int</span>)maxTick;</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;    <span class="comment">// use all of the hits in the tick window</span></div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.size(); ++ii) {</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>[ii];</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;      <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj &gt; 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;      <span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>)[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].allHitsIndex];</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.PeakTime() &lt; minTick) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.PeakTime() &gt; maxTick) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>[ii] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;      slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>;</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;    }</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;  } <span class="comment">// FindUseHits</span></div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l02031"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#abfbdedb4c496fc0e84e7dec74bbb8a15"> 2031</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#abfbdedb4c496fc0e84e7dec74bbb8a15">FillGaps</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj)</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;  {</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;    <span class="comment">// Fill in any gaps in the trajectory with close hits regardless of charge (well maybe not quite that)</span></div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da949853468d9e1bc8907e7bd6aa1d3546">kFillGaps</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da9b5200eaaed0e097cac019d6643e537e">kJunkTj</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a0787c3db4bce3ad556211ba704897ab3">ChgRMS</a> &lt;= 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> npwc = <a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">false</span>);</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    <span class="keywordflow">if</span>(npwc &lt; 8) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;    <span class="comment">// don&#39;t consider the last few points since they would be trimmed</span></div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> toPt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] - 2;</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    <span class="keywordflow">if</span>(!tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afa6980f5646e419795cdc43499a55104">EndFlag</a>[1][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa0a4b8d8fc21482d4679f7eac8f457e70">kBragg</a>]) {</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;      <span class="comment">// Don&#39;t fill gaps (with high-charge hits) near the end. Find the last point near the</span></div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;      <span class="comment">// end that would have normal charge if all the hit were added</span></div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> cnt = 0;</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] - 2; ipt &gt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0]; --ipt) {</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;        <span class="keyword">auto</span>&amp; tp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt];</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;        <span class="keywordtype">float</span> chg = tp.Chg;</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;        <span class="keywordflow">if</span>(chg == 0) {</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tp.Hits.size(); ++ii) {</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht = tp.Hits[ii];</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;            <span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>)[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].allHitsIndex];</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;            chg += <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.Integral();</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;          }</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;        } <span class="comment">// chg == 0</span></div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;        <span class="keywordtype">float</span> chgPull = (chg / tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdb8e6dfd5aba49787dab959fea3ac2c">AveChg</a> - 1) / tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a0787c3db4bce3ad556211ba704897ab3">ChgRMS</a>;</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;        <span class="keywordflow">if</span>(chgPull &lt; 2) {</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;          toPt = ipt;</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;        }</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        ++cnt;</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;        <span class="keywordflow">if</span>(cnt &gt; 20) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;      } <span class="comment">// ipt</span></div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;    } <span class="comment">// !tj.EndFlag[1][kBragg]</span></div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;FG: Check Tj &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>&lt;&lt;<span class="stringliteral">&quot; from &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0]])&lt;&lt;<span class="stringliteral">&quot; to &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[toPt]);</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;    <span class="comment">// start with the first point that has charge</span></div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;    <span class="keywordtype">short</span> firstPtWithChg = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0];</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#af481fa22253619167bce75a37e10ec34">first</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;    <span class="keywordtype">float</span> maxDelta = 1;</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;    <span class="comment">// don&#39;t let MCSMom suffer too much while filling gaps</span></div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;    <span class="keywordtype">short</span> minMCSMom = 0.7 * tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a>;</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;    <span class="keywordflow">while</span>(firstPtWithChg &lt; toPt) {</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;      <span class="keywordtype">short</span> nextPtWithChg = firstPtWithChg + 1;</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;      <span class="comment">// find the next point with charge</span></div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;      <span class="keywordflow">for</span>(nextPtWithChg = firstPtWithChg + 1; nextPtWithChg &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]; ++nextPtWithChg) {</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;        <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[nextPtWithChg].Chg &gt; 0) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;      } <span class="comment">// nextPtWithChg</span></div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;      <span class="keywordflow">if</span>(nextPtWithChg == firstPtWithChg + 1) {</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;        <span class="comment">// the next point has charge</span></div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;        ++firstPtWithChg;</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;      }</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;      <span class="comment">// Found a gap. Require at least two consecutive points with charge after the gap</span></div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;      <span class="keywordflow">if</span>(nextPtWithChg &lt; (tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] - 1) &amp;&amp; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[nextPtWithChg + 1].Chg == 0) {</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;        firstPtWithChg = nextPtWithChg;</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;      }</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;      <span class="comment">// Make a bare trajectory point at firstPtWithChg that points to nextPtWithChg</span></div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;      <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a> tp;</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a45477c64580773fdd4e4740ce58fa817">MakeBareTrajPoint</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[firstPtWithChg], tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[nextPtWithChg], tp)) {</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;        tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;      }</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;      <span class="comment">// Find the maximum delta between hits and the trajectory Pos for all</span></div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;      <span class="comment">// hits on this trajectory</span></div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;      <span class="keywordflow">if</span>(first) {</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;        maxDelta = 2.5 * <a class="code" href="../../de/d0f/namespacetca.html#aa13d4c4275b33e7fb75b4ef237dfa014">MaxHitDelta</a>(slc, tj);</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;        first = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;      } <span class="comment">// first</span></div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;      <span class="comment">// define a loose charge cut using the average charge at the first point with charge</span></div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;      <span class="keywordtype">float</span> maxChg = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[firstPtWithChg].AveChg * (1 + 2 * <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a3a55337e6b54dd9a9e29ab70da5cd760">chargeCuts</a>[0] * tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a0787c3db4bce3ad556211ba704897ab3">ChgRMS</a>);</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;      <span class="comment">// Eliminate the charge cut altogether if we are close to an end</span></div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() &lt; 10) {</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;        maxChg = 1E6;</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;        <span class="keywordtype">short</span> chgCutPt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0] + 5;</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;        <span class="keywordflow">if</span>(firstPtWithChg &lt; chgCutPt) {</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;          <span class="comment">// gap is near end 0</span></div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;          maxChg = 1E6;</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;          <span class="comment">// check for gap near end 1</span></div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;          chgCutPt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] - 5;</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;          <span class="keywordflow">if</span>(chgCutPt &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0]) chgCutPt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0];</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;          <span class="keywordflow">if</span>(nextPtWithChg &gt; chgCutPt) maxChg = 1E6;</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;        }</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;      }</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;      <span class="comment">// fill in the gap</span></div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> mpt = firstPtWithChg + 1; mpt &lt; nextPtWithChg; ++mpt) {</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;        <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[mpt].Chg &gt; 0) {</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;          mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;FillGaps coding error: firstPtWithChg &quot;</span>&lt;&lt;firstPtWithChg&lt;&lt;<span class="stringliteral">&quot; mpt &quot;</span>&lt;&lt;mpt&lt;&lt;<span class="stringliteral">&quot; nextPtWithChg &quot;</span>&lt;&lt;nextPtWithChg;</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;          slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a2aab614bb8eea5ec2b9a98b0202683dd">isValid</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;        }</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;        <span class="keywordtype">bool</span> filled = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;        <span class="keywordtype">float</span> chg = 0;</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[mpt].Hits.size(); ++ii) {</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[mpt].Hits[ii];</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;          <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj &gt; 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;          <span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>)[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].allHitsIndex];</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;          <span class="keywordtype">float</span> delta = <a class="code" href="../../de/d0f/namespacetca.html#a310add1134404b2b548a1a88f652cc04">PointTrajDOCA</a>(slc, iht, tp);</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; FG: &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc,tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[mpt])&lt;&lt;<span class="stringliteral">&quot; hit &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a6f0a1df60836abcb51565bc85c828f18">PrintHit</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht])&lt;&lt;<span class="stringliteral">&quot; delta &quot;</span>&lt;&lt;delta&lt;&lt;<span class="stringliteral">&quot; maxDelta &quot;</span>&lt;&lt;maxDelta&lt;&lt;<span class="stringliteral">&quot; Chg &quot;</span>&lt;&lt;<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.Integral()&lt;&lt;<span class="stringliteral">&quot; maxChg &quot;</span>&lt;&lt;maxChg;</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;          <span class="keywordflow">if</span>(delta &gt; maxDelta) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;          tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[mpt].UseHit[ii] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;          slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>;</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;          chg += <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.Integral();</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;          filled = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;        } <span class="comment">// ii</span></div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;        <span class="keywordflow">if</span>(chg &gt; maxChg || <a class="code" href="../../de/d0f/namespacetca.html#a712fa9841aa560d0298a3bd5fda51bb8">MCSMom</a>(slc, tj) &lt; minMCSMom) {</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;          <span class="comment">// don&#39;t use these hits after all</span></div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;          <a class="code" href="../../de/d0f/namespacetca.html#a20bf265ff689ff64027c4d072e7ed598">UnsetUsedHits</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[mpt]);</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;          filled = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;        }</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;        <span class="keywordflow">if</span>(filled) {</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;          <a class="code" href="../../de/d0f/namespacetca.html#adcfb1da7e005bcdbdd61dc5baf815be1">DefineHitPos</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[mpt]);</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;          tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da949853468d9e1bc8907e7bd6aa1d3546">kFillGaps</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;            <a class="code" href="../../de/d0f/namespacetca.html#a1224974e5441b11c2d315fe5912feb75">PrintTP</a>(<span class="stringliteral">&quot;FG&quot;</span>, slc, mpt, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a3d0690a80fbffcedf93b202d1c7bd0cd">StepDir</a>, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a77b3a6b92ddd696b3dec9d7581f6503e">Pass</a>, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[mpt]);</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;            mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;Check MCSMom &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a712fa9841aa560d0298a3bd5fda51bb8">MCSMom</a>(slc, tj);</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;          }</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;        } <span class="comment">// filled</span></div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;      } <span class="comment">// mpt</span></div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;      firstPtWithChg = nextPtWithChg;</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;    } <span class="comment">// firstPtWithChg</span></div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da949853468d9e1bc8907e7bd6aa1d3546">kFillGaps</a>]) tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a> = <a class="code" href="../../de/d0f/namespacetca.html#a712fa9841aa560d0298a3bd5fda51bb8">MCSMom</a>(slc, tj);</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;  } <span class="comment">// FillGaps</span></div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l02165"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a045a87be615f131f0e626885f457c228"> 2165</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#a045a87be615f131f0e626885f457c228">CheckHiMultUnusedHits</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj)</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;  {</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;    <span class="comment">// Check for many unused hits in high multiplicity TPs in work and try to use them</span></div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5dae8a519a9179f8581a54a31a230504e2c">kCHMUH</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;    <span class="comment">// This code might do bad things to short trajectories</span></div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">true</span>) &lt; 6) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0] == tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;    <span class="comment">// Angle code 0 tjs shouldn&#39;t have any high multiplicity hits added to them</span></div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]].AngleCode == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;    <span class="comment">// count the number of unused hits multiplicity &gt; 1 hits and decide</span></div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;    <span class="comment">// if the unused hits should be used. This may trigger another</span></div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;    <span class="comment">// call to StepAway</span></div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii, stopPt;</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;    <span class="comment">// Use this to see if the high multiplicity Pts are mostly near</span></div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;    <span class="comment">// the end or further upstream</span></div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> lastMult1Pt = USHRT_MAX;</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;    <span class="comment">// the number of TPs with &gt; 1 hit (HiMult)</span></div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nHiMultPt = 0;</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;    <span class="comment">// the total number of hits associated with HiMult TPs</span></div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nHiMultPtHits = 0;</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;    <span class="comment">// the total number of used hits associated with HiMult TPs</span></div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nHiMultPtUsedHits = 0;</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht;</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;    <span class="comment">// start counting at the leading edge and break if a hit</span></div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;    <span class="comment">// is found that is used in a trajectory</span></div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;    <span class="keywordtype">bool</span> doBreak = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> jj;</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;    <span class="keywordflow">for</span>(ii = 1; ii &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size(); ++ii) {</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;      stopPt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] - ii;</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;      <span class="keywordflow">for</span>(jj = 0; jj &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[stopPt].Hits.size(); ++jj) {</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;        iht = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[stopPt].Hits[jj];</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;        <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj &gt; 0) {</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;          doBreak = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;        }</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;      } <span class="comment">// jj</span></div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;      <span class="keywordflow">if</span>(doBreak) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;      <span class="comment">// require 2 consecutive multiplicity = 1 points</span></div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;      <span class="keywordflow">if</span>(lastMult1Pt == USHRT_MAX &amp;&amp; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[stopPt].Hits.size() == 1 &amp;&amp; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[stopPt-1].Hits.size() == 1) lastMult1Pt = stopPt;</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[stopPt].Hits.size() &gt; 1) {</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;        ++nHiMultPt;</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;        nHiMultPtHits += tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[stopPt].Hits.size();</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;        nHiMultPtUsedHits += <a class="code" href="../../de/d0f/namespacetca.html#a6b4cf44fa6814acfdf94b7cfba17c131">NumHitsInTP</a>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[stopPt], <a class="code" href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3a592a31ca0b683aeb15197694a71bd108">kUsedHits</a>);</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;      } <span class="comment">// high multiplicity TP</span></div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;      <span class="comment">// stop looking when two consecutive single multiplicity TPs are found</span></div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;      <span class="keywordflow">if</span>(lastMult1Pt != USHRT_MAX) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;      <span class="keywordflow">if</span>(stopPt == 1) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;    } <span class="comment">// ii</span></div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;    <span class="comment">// Don&#39;t do this if there aren&#39;t a lot of high multiplicity TPs</span></div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;    <span class="keywordtype">float</span> fracHiMult = (float)nHiMultPt / (<span class="keywordtype">float</span>)ii;</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;    <span class="keywordflow">if</span>(lastMult1Pt != USHRT_MAX) {</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;      <span class="keywordtype">float</span> nchk = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] - lastMult1Pt + 1;</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;      fracHiMult = (float)nHiMultPt / nchk;</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;      fracHiMult = (float)nHiMultPt / (<span class="keywordtype">float</span>)ii;</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;    }</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;    <span class="keywordtype">float</span> fracHitsUsed = 0;</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;    <span class="keywordflow">if</span>(nHiMultPt &gt; 0 &amp;&amp; nHiMultPtHits &gt; 0) fracHitsUsed = (float)nHiMultPtUsedHits / (<span class="keywordtype">float</span>)nHiMultPtHits;</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;    <span class="comment">// Use this to limit the number of points fit for trajectories that</span></div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;    <span class="comment">// are close the LA tracking cut</span></div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;    ii = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1];</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;    <span class="keywordtype">bool</span> sortaLargeAngle = (<a class="code" href="../../de/d0f/namespacetca.html#afd6835e0d895357c41f7dc34db5b7e42">AngleRange</a>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ii]) == 1);</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;CHMUH: First InTraj stopPt &quot;</span>&lt;&lt;stopPt&lt;&lt;<span class="stringliteral">&quot; fracHiMult &quot;</span>&lt;&lt;fracHiMult&lt;&lt;<span class="stringliteral">&quot; fracHitsUsed &quot;</span>&lt;&lt;fracHitsUsed&lt;&lt;<span class="stringliteral">&quot; lastMult1Pt &quot;</span>&lt;&lt;lastMult1Pt&lt;&lt;<span class="stringliteral">&quot; sortaLargeAngle &quot;</span>&lt;&lt;sortaLargeAngle;</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;    <span class="keywordflow">if</span>(fracHiMult &lt; 0.3) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;    <span class="keywordflow">if</span>(fracHitsUsed &gt; 0.98) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;    <span class="keywordtype">float</span> maxDelta = 2.5 * <a class="code" href="../../de/d0f/namespacetca.html#aa13d4c4275b33e7fb75b4ef237dfa014">MaxHitDelta</a>(slc, tj);</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; Pts size &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size()&lt;&lt;<span class="stringliteral">&quot; nHiMultPt &quot;</span>&lt;&lt;nHiMultPt&lt;&lt;<span class="stringliteral">&quot; nHiMultPtHits &quot;</span>&lt;&lt;nHiMultPtHits&lt;&lt;<span class="stringliteral">&quot; nHiMultPtUsedHits &quot;</span>&lt;&lt;nHiMultPtUsedHits&lt;&lt;<span class="stringliteral">&quot; sortaLargeAngle &quot;</span>&lt;&lt;sortaLargeAngle&lt;&lt;<span class="stringliteral">&quot; maxHitDelta &quot;</span>&lt;&lt;maxDelta;</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;    }</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;    <span class="comment">// Use next pass cuts if available</span></div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;    <span class="keywordflow">if</span>(sortaLargeAngle &amp;&amp; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a77b3a6b92ddd696b3dec9d7581f6503e">Pass</a> &lt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a986b7f09cec52728d16e43511d5c4e3f">minPtsFit</a>.size()-1) ++tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a77b3a6b92ddd696b3dec9d7581f6503e">Pass</a>;</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;    <span class="comment">// Make a copy of tj in case something bad happens</span></div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;    <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a> TjCopy = tj;</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;    <span class="comment">// and the list of used hits</span></div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;    <span class="keyword">auto</span> inTrajHits = <a class="code" href="../../de/d0f/namespacetca.html#a74e10046f4ebc371418d3081bc237ba0">PutTrajHitsInVector</a>(tj, <a class="code" href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3a592a31ca0b683aeb15197694a71bd108">kUsedHits</a>);</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt;</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;    <span class="comment">// unset the used hits from stopPt + 1 to the end</span></div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;    <span class="keywordflow">for</span>(ipt = stopPt + 1; ipt &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size(); ++ipt) <a class="code" href="../../de/d0f/namespacetca.html#a20bf265ff689ff64027c4d072e7ed598">UnsetUsedHits</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt]);</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;    <span class="keywordtype">float</span> delta;</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;    <span class="keywordtype">bool</span> added;</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;    <span class="keywordflow">for</span>(ipt = stopPt + 1; ipt &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size(); ++ipt) {</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;      <span class="comment">// add hits that are within maxDelta and re-fit at each point</span></div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;      added = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;      <span class="keywordflow">for</span>(ii = 0; ii &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Hits.size(); ++ii) {</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;        iht = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Hits[ii];</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; ipt &quot;</span>&lt;&lt;ipt&lt;&lt;<span class="stringliteral">&quot; hit &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a6f0a1df60836abcb51565bc85c828f18">PrintHit</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht])&lt;&lt;<span class="stringliteral">&quot; inTraj &quot;</span>&lt;&lt;slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj&lt;&lt;<span class="stringliteral">&quot; delta &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a310add1134404b2b548a1a88f652cc04">PointTrajDOCA</a>(slc, iht, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt]);</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;        <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj != 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;        delta = <a class="code" href="../../de/d0f/namespacetca.html#a310add1134404b2b548a1a88f652cc04">PointTrajDOCA</a>(slc, iht, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt]);</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;        <span class="keywordflow">if</span>(delta &gt; maxDelta) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a6b4cf44fa6814acfdf94b7cfba17c131">NumHitsInTP</a>(TjCopy.Pts[ipt], <a class="code" href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3a592a31ca0b683aeb15197694a71bd108">kUsedHits</a>)||TjCopy.Pts[ipt].UseHit[ii]){</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;          tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].UseHit[ii] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;          slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>;</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;          added = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;        }</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;      } <span class="comment">// ii</span></div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;      <span class="keywordflow">if</span>(added) <a class="code" href="../../de/d0f/namespacetca.html#adcfb1da7e005bcdbdd61dc5baf815be1">DefineHitPos</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt]);</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] = ipt;</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;      <span class="comment">// This will be incremented by one in UpdateTraj</span></div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;      <span class="keywordflow">if</span>(sortaLargeAngle) tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].NTPsFit = 2;</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#af86f6315648e0dbb5e400f35ea97e72c">UpdateTraj</a>(slc, tj);</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f57aca44660b87327393e6a4694e570">NeedsUpdate</a>) {</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;UpdateTraj failed on point &quot;</span>&lt;&lt;ipt;</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;        <span class="comment">// Clobber the used hits from the corrupted points in tj</span></div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> jpt = stopPt + 1; jpt &lt;= ipt; ++jpt) {</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> jj = 0; jj &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[jpt].Hits.size(); ++jj) {</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;            <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[jpt].UseHit[jj]) slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[jpt].Hits[jj]].InTraj = 0;</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;          } <span class="comment">// jj</span></div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;        } <span class="comment">// jpt</span></div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;        <span class="comment">// restore the original trajectory</span></div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;        tj = TjCopy;</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;        <span class="comment">// restore the hits</span></div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> jpt = stopPt + 1; jpt &lt;= ipt; ++jpt) {</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> jj = 0; jj &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[jpt].Hits.size(); ++jj) {</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;            <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[jpt].UseHit[jj]) slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[jpt].Hits[jj]].InTraj = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>;</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;          } <span class="comment">// jj</span></div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;        } <span class="comment">// jpt</span></div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;      }</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a6a54ab1f3f863b27a59209d44cf402b2">GottaKink</a>(slc, tj, <span class="keyword">true</span>);</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) <a class="code" href="../../de/d0f/namespacetca.html#a5005f83120a22b0f059526653af3cb6f">PrintTrajectory</a>(<span class="stringliteral">&quot;CHMUH&quot;</span>, slc, tj, ipt);</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;    <span class="comment">// if we made it here it must be OK</span></div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;    <span class="comment">// Try to extend it, unless there was a kink</span></div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afa6980f5646e419795cdc43499a55104">EndFlag</a>[1][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa8a209073700148c7515fa38bae5e2873">kAtKink</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;    <span class="comment">// trim the end points although this shouldn&#39;t happen</span></div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] != tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() - 1) tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.resize(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] + 1);</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5dae8a519a9179f8581a54a31a230504e2c">kCHMUH</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;  } <span class="comment">// CheckHiMultUnusedHits</span></div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l02307"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a5d59efe83ce0c76a4e68f44e23cc2e18"> 2307</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#a5d59efe83ce0c76a4e68f44e23cc2e18">CheckHiMultEndHits</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj)</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;  {</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;    <span class="comment">// mask off high multiplicity TPs at the end</span></div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da60d0eac61cfc2a727d60c0fe66522ef6">kCHMEH</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afa6980f5646e419795cdc43499a55104">EndFlag</a>[1][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa0a4b8d8fc21482d4679f7eac8f457e70">kBragg</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() &lt; 10) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]].AngleCode == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;    <span class="comment">// find the average multiplicity in the first half</span></div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> aveMult= 0;</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt, nhalf = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() / 2;</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> cnt = 0;</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; tp : tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>) {</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;      <span class="keywordflow">if</span>(tp.Chg == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;      aveMult += tp.Hits.size();</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;      ++cnt;</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;      <span class="keywordflow">if</span>(cnt == nhalf) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;    } <span class="comment">//  pt</span></div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;    <span class="keywordflow">if</span>(cnt == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;    aveMult /= cnt;</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;    <span class="keywordflow">if</span>(aveMult == 0) aveMult = 1;</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;    <span class="comment">// convert this into a cut</span></div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;    aveMult *= 3;</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;    cnt = 0;</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;    <span class="keywordflow">for</span>(ipt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]; ipt &gt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0]; --ipt) {</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Hits.size() &gt; aveMult) {</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#a20bf265ff689ff64027c4d072e7ed598">UnsetUsedHits</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt]);</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;        ++cnt;</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;      }</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;CHMEH multiplicity cut &quot;</span>&lt;&lt;aveMult&lt;&lt;<span class="stringliteral">&quot; number of TPs masked off &quot;</span>&lt;&lt;cnt;</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;    <span class="keywordflow">if</span>(cnt &gt; 0) {</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da60d0eac61cfc2a727d60c0fe66522ef6">kCHMEH</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;    }</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;  } <span class="comment">// CheckHiMultEndHits</span></div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;<span class="comment">  //////////////////////////////////////////</span></div>
<div class="line"><a name="l02347"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a9e375fbdbb04760c844a9f5aeed7290c"> 2347</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#a9e375fbdbb04760c844a9f5aeed7290c">UpdateDeltaRMS</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj)</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;  {</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;    <span class="comment">// Estimate the Delta RMS of the TPs on the end of tj.</span></div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lastPt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1];</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;    <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a>&amp; lastTP = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt];</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;    <span class="keywordflow">if</span>(lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a> == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;    <span class="keywordflow">if</span>(lastPt &lt; 6) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii, ipt, cnt = 0;</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;    <span class="keywordtype">float</span> sum = 0;</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;    <span class="keywordflow">for</span>(ii = 1; ii &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size(); ++ii) {</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;      ipt = lastPt - ii;</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;      <span class="keywordflow">if</span>(ipt &gt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() - 1) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;      sum += <a class="code" href="../../de/d0f/namespacetca.html#a310add1134404b2b548a1a88f652cc04">PointTrajDOCA</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Pos[0], tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Pos[1], lastTP);</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;      ++cnt;</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;      <span class="keywordflow">if</span>(cnt == lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a>) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;      <span class="keywordflow">if</span>(ipt == 0) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;    }</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;    <span class="keywordflow">if</span>(cnt &lt; 3) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;    <span class="comment">// RMS of Gaussian distribution is ~1.2 x the average</span></div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;    <span class="comment">// of a one-sided Gaussian distribution (since Delta is &gt; 0)</span></div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;    lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#af9b51f6eb202342e980fdae234fe06c5">DeltaRMS</a> = 1.2 * sum / (float)cnt;</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;    <span class="keywordflow">if</span>(lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#af9b51f6eb202342e980fdae234fe06c5">DeltaRMS</a> &lt; 0.02) lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#af9b51f6eb202342e980fdae234fe06c5">DeltaRMS</a> = 0.02;</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;  } <span class="comment">// UpdateDeltaRMS</span></div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;<span class="comment">  //////////////////////////////////////////</span></div>
<div class="line"><a name="l02377"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#aa053fbd4d7f33f815c630ab60ddc186c"> 2377</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#aa053fbd4d7f33f815c630ab60ddc186c">MaskBadTPs</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj, <span class="keywordtype">float</span> <span class="keyword">const</span>&amp; maxChi)</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;  {</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;    <span class="comment">// Remove TPs that have the worst values of delta until the fit chisq &lt; maxChi</span></div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da86e7c73e8ff0192c702f778833aa604f">kMaskBadTPs</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;    <span class="comment">//don&#39;t use this function for reverse propagation</span></div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">kRvPrp</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;    <span class="keywordtype">bool</span> prt = (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a> || <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ac24fc2006fb9fdcc2dc745608b6b0f5c">dbgAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da86e7c73e8ff0192c702f778833aa604f">kMaskBadTPs</a>]);</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() &lt; 3) {</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;      <span class="comment">//      mf::LogError(&quot;TC&quot;)&lt;&lt;&quot;MaskBadTPs: Trajectory ID &quot;&lt;&lt;tj.ID&lt;&lt;&quot; too short to mask hits &quot;;</span></div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;    }</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nit = 0;</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;    <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a>&amp; lastTP = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() - 1];</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;    <span class="keywordflow">while</span>(lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a> &gt; maxChi &amp;&amp; nit &lt; 3) {</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;      <span class="keywordtype">float</span> maxDelta = 0;</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> imBad = USHRT_MAX;</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> cnt = 0;</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 1; ii &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size(); ++ii) {</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() - 1 - ii;</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;        <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a>&amp; tp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt];</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;        <span class="keywordflow">if</span>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a> == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;        <span class="keywordflow">if</span>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a011749db067df79503a159672ada3c4d">Delta</a> &gt; maxDelta) {</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;          maxDelta = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a011749db067df79503a159672ada3c4d">Delta</a>;</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;          imBad = ipt;</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;        }</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;        ++cnt;</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;        <span class="keywordflow">if</span>(cnt == tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a>) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;      } <span class="comment">// ii</span></div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;      <span class="keywordflow">if</span>(imBad == USHRT_MAX) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;      <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;MaskBadTPs: lastTP.FitChi &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a>&lt;&lt;<span class="stringliteral">&quot;  Mask point &quot;</span>&lt;&lt;imBad;</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;      <span class="comment">// mask the point</span></div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a20bf265ff689ff64027c4d072e7ed598">UnsetUsedHits</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[imBad]);</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#ab9b632aaa6a5285a60a3ac9d7bd1cfc0">FitTraj</a>(slc, tj);</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;      <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;  after FitTraj &quot;</span>&lt;&lt;lastTP.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">FitChi</a>;</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da86e7c73e8ff0192c702f778833aa604f">kMaskBadTPs</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;      ++nit;</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;    } <span class="comment">// lastTP.FItChi &gt; maxChi &amp;&amp; nit &lt; 3</span></div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;  } <span class="comment">// MaskBadTPs</span></div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l02422"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a61681325bce0b3240611ea1e274c4cc0"> 2422</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="../../de/d0f/namespacetca.html#a61681325bce0b3240611ea1e274c4cc0">MaskedHitsOK</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj)</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;  {</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;    <span class="comment">// The hits in the TP at the end of the trajectory were masked off. Decide whether to continue stepping with the</span></div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;    <span class="comment">// current configuration (true) or whether to stop and possibly try with the next pass settings (false)</span></div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5daea82def44ffd3a71c79c73ae3b0dee7b">kMaskHits</a>]) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> lastPt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() - 1;</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastPt].Chg &gt; 0) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> endPt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1];</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;    <span class="comment">// count the number of points w/o used hits and the number with one unused hit</span></div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nMasked = 0;</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nOneHit = 0;</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nOKChg = 0;</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nOKDelta = 0;</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;    <span class="comment">// number of points with Pos &gt; HitPos</span></div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nPosDelta = 0;</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;    <span class="comment">// number of points with Delta increasing vs ipt</span></div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nDeltaIncreasing = 0;</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;    <span class="comment">// Fake this a bit to simplify comparing the counts</span></div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;    <span class="keywordtype">float</span> prevDelta = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[endPt].Delta;</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;    <span class="keywordtype">float</span> maxOKDelta = 10 * tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[endPt].DeltaRMS;</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;    <span class="keywordtype">float</span> maxOKChg = 0;</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;    <span class="comment">// find the maximum charge point on the trajectory</span></div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0]; ipt &lt;= tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]; ++ipt) <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg &gt; maxOKChg) maxOKChg = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg;</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 1; ii &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size(); ++ii) {</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() - ii;</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;      <span class="keyword">auto</span>&amp; tp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt];</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;      <span class="keywordflow">if</span>(tp.Chg &gt; 0) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nUnusedHits = 0;</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;      <span class="keywordtype">float</span> chg = 0;</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> jj = 0; jj &lt; tp.Hits.size(); ++jj) {</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht = tp.Hits[jj];</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;        <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj != 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;        ++nUnusedHits;</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;        <span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>)[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].allHitsIndex];</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;        chg += <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.Integral();</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;      } <span class="comment">// jj</span></div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;      <span class="keywordflow">if</span>(chg &lt; maxOKChg) ++nOKChg;</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;      <span class="keywordflow">if</span>(nUnusedHits == 1) ++nOneHit;</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;      <span class="keywordflow">if</span>(tp.Delta &lt; maxOKDelta) ++nOKDelta;</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;      <span class="comment">// count the number of points with Pos time &gt; HitPos time</span></div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;      <span class="keywordflow">if</span>(tp.Pos[1] &gt; tp.HitPos[1]) ++nPosDelta;</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;      <span class="comment">// The number of increasing delta points: Note implied absolute value</span></div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;      <span class="keywordflow">if</span>(tp.Delta &lt; prevDelta) ++nDeltaIncreasing;</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;      prevDelta = tp.Delta;</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;      ++nMasked;</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;    } <span class="comment">// ii</span></div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;    <span class="comment">// determine if the hits are wandering away from the trajectory direction. This will result in</span></div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;    <span class="comment">// nPosDelta either being ~0 or ~equal to the number of masked points. nPosDelta should have something</span></div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;    <span class="comment">// in between these two extremes if we are stepping through a messy region</span></div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;    <span class="keywordtype">bool</span> driftingAway = nMasked &gt; 2 &amp;&amp; (nPosDelta == 0 || nPosDelta == nMasked);</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;    <span class="comment">// Note that nDeltaIncreasing is always positive</span></div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;    <span class="keywordflow">if</span>(driftingAway &amp;&amp; nDeltaIncreasing &lt; nMasked - 1) driftingAway = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;MHOK:  nMasked &quot;</span>&lt;&lt;nMasked&lt;&lt;<span class="stringliteral">&quot; nOneHit &quot;</span>&lt;&lt;nOneHit&lt;&lt;<span class="stringliteral">&quot; nOKChg &quot;</span>&lt;&lt;nOKChg&lt;&lt;<span class="stringliteral">&quot; nOKDelta &quot;</span>&lt;&lt;nOKDelta&lt;&lt;<span class="stringliteral">&quot; nPosDelta &quot;</span>&lt;&lt;nPosDelta&lt;&lt;<span class="stringliteral">&quot; nDeltaIncreasing &quot;</span>&lt;&lt;nDeltaIncreasing&lt;&lt;<span class="stringliteral">&quot; driftingAway? &quot;</span>&lt;&lt;driftingAway;</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;    }</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;    <span class="keywordflow">if</span>(!driftingAway) {</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;      <span class="keywordflow">if</span>(nMasked &lt; 8 || nOneHit &lt; 8) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;      <span class="keywordflow">if</span>(nOKDelta != nMasked) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;      <span class="keywordflow">if</span>(nOKChg != nMasked) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;    }</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;    <span class="comment">// we would like to reduce the number of fitted points to a minimum and include</span></div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;    <span class="comment">// the masked hits, but we can only do that if there are enough points</span></div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[endPt].NTPsFit &lt;= <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a986b7f09cec52728d16e43511d5c4e3f">minPtsFit</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a77b3a6b92ddd696b3dec9d7581f6503e">Pass</a>]) {</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;      <span class="comment">// stop stepping if we have masked off more points than are in the fit</span></div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;      <span class="keywordflow">if</span>(nMasked &gt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[endPt].NTPsFit) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;    }</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;    <span class="comment">// Reduce the number of points fit and try to include the points</span></div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> newNTPSFit;</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[endPt].NTPsFit &gt; 2 * <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a986b7f09cec52728d16e43511d5c4e3f">minPtsFit</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a77b3a6b92ddd696b3dec9d7581f6503e">Pass</a>]) {</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;      newNTPSFit = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[endPt].NTPsFit / 2;</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;      newNTPSFit = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a986b7f09cec52728d16e43511d5c4e3f">minPtsFit</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a77b3a6b92ddd696b3dec9d7581f6503e">Pass</a>];</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;    }</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ipt = endPt + 1; ipt &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size(); ++ipt) {</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;      <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a>&amp; tp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt];</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Hits.size(); ++ii) {</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>[ii];</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;        <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj == 0) {</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;          tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>[ii] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;          slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>;</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;        }</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;      } <span class="comment">// ii</span></div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#adcfb1da7e005bcdbdd61dc5baf815be1">DefineHitPos</a>(slc, tp);</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a> = newNTPSFit;</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#ab9b632aaa6a5285a60a3ac9d7bd1cfc0">FitTraj</a>(slc, tj);</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) <a class="code" href="../../de/d0f/namespacetca.html#a5005f83120a22b0f059526653af3cb6f">PrintTrajectory</a>(<span class="stringliteral">&quot;MHOK&quot;</span>, slc, tj, ipt);</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5daea82def44ffd3a71c79c73ae3b0dee7b">kMaskHits</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a45584aa4b4e3ca2963ed52c7e5a28ff8">UpdateTjChgProperties</a>(<span class="stringliteral">&quot;MHOK&quot;</span>, slc, tj, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>);</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;  } <span class="comment">// MaskedHitsOK</span></div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l02527"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#ac89b171f7383a83708fa8244202b0bab"> 2527</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="../../de/d0f/namespacetca.html#ac89b171f7383a83708fa8244202b0bab">StopIfBadFits</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj)</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;  {</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;    <span class="comment">// Returns true if there are a number of Tps that were not used in the trajectory because the fit was poor and the</span></div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;    <span class="comment">// charge pull is not really high. This</span></div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;    <span class="comment">// don&#39;t consider muons</span></div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ab2c0db630cd45caff1c041d639c5f253">PDGCode</a> == 13) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;    <span class="comment">// or long straight Tjs</span></div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() &gt; 40 &amp;&amp; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a> &gt; 200) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nBadFit = 0;</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nHiChg = 0;</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> cnt = 0;</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() - 1; ipt &gt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]; --ipt ) {</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].FitChi &gt; 2) ++nBadFit;</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].ChgPull &gt; 3) ++nHiChg;</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;      ++cnt;</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;      <span class="keywordflow">if</span>(cnt == 5) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;StopIfBadFits: nBadFit &quot;</span>&lt;&lt;nBadFit&lt;&lt;<span class="stringliteral">&quot; nHiChg &quot;</span>&lt;&lt;nHiChg;</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;    <span class="keywordflow">if</span>(nBadFit &gt; 3 &amp;&amp; nHiChg == 0) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;  } <span class="comment">// StopIfBadFits</span></div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;<span class="comment">////////////////////////////////////////////////</span></div>
<div class="line"><a name="l02554"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a6a54ab1f3f863b27a59209d44cf402b2"> 2554</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="../../de/d0f/namespacetca.html#a6a54ab1f3f863b27a59209d44cf402b2">GottaKink</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj, <span class="keywordtype">bool</span> doTrim)</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;  {</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;    <span class="comment">// This function returns true if it detects a kink in the trajectory</span></div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;    <span class="comment">// This function trims the points after a kink if one is found if doTrim is true.</span></div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;    <span class="comment">// tcc.kinkCuts[] fcl configuration</span></div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;    <span class="comment">// 0 = Number of TPs to fit at the end</span></div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;    <span class="comment">// 1 = Min kink significance</span></div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;    <span class="comment">// 2 = Use charge in significance calculation if &gt; 0</span></div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;    <span class="comment">// 3 = 3D kink fit length (cm) - used in PFPUtils/SplitAtKinks</span></div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;    <span class="comment">// don&#39;t look for kinks if this looks a high energy electron</span></div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;    <span class="comment">// BB Jan 2, 2020: Return true if a kink was found but don&#39;t set the</span></div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;    <span class="comment">// stop-at-kink end flag</span></div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bca881b9d556e1114d8cce02b75d65120db">kStiffEl</a>]) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;    <span class="comment">// Need at least 2 * kinkCuts[2] points with charge to find a kink</span></div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> npwc = <a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">false</span>);</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nPtsFit = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ab1be85fd32a002a93e0043ae152d1529">kinkCuts</a>[0];</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;    <span class="comment">// Set nPtsFit for slowing tjs to the last TP NTPsFit</span></div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bcaea92f268de1c89bd1bdcf4913ca4f84d">kSlowing</a>]) nPtsFit = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]].NTPsFit;</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;    <span class="keywordflow">if</span>(npwc &lt; 2 * nPtsFit) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;    <span class="keywordtype">bool</span> useCharge = (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ab1be85fd32a002a93e0043ae152d1529">kinkCuts</a>[2] &gt; 0);</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;    <span class="comment">// find the point where a kink is expected and fit the points after that point</span></div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> fitPt = USHRT_MAX;</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> cnt = 0;</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size(); ++ii) {</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] - ii - 1;</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;      <span class="comment">// stay away from the starting points which may be skewed if this is a</span></div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;      <span class="comment">// stopping track</span></div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;      <span class="keywordflow">if</span>(ipt &lt;= tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0] + 2) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;      ++cnt;</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;      <span class="comment">// Note that the fitPt is not included in the fits in the kink significance so we need</span></div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;      <span class="comment">// one more point</span></div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;      <span class="keywordflow">if</span>(cnt &gt; nPtsFit) {</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;        fitPt = ipt;</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;      }</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;    } <span class="comment">// ii</span></div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;    <span class="keywordflow">if</span>(fitPt == USHRT_MAX) {</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;        mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;        myprt&lt;&lt;<span class="stringliteral">&quot;GKv2 fitPt not valid. Counted &quot;</span>&lt;&lt;cnt&lt;&lt;<span class="stringliteral">&quot; points. Need &quot;</span>&lt;&lt;nPtsFit;</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;      } <span class="comment">// tcc.dbgStp</span></div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;    }</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[fitPt].KinkSig = <a class="code" href="../../de/d0f/namespacetca.html#a6f2f34a55fc01dbc6f34b6f8dfa958b1">KinkSignificance</a>(slc, tj, fitPt, nPtsFit, useCharge, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>);</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;    <span class="keywordtype">bool</span> thisPtHasKink = (tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[fitPt].KinkSig &gt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ab1be85fd32a002a93e0043ae152d1529">kinkCuts</a>[1]);</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;    <span class="keywordtype">bool</span> prevPtHasKink = (tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[fitPt - 1].KinkSig &gt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ab1be85fd32a002a93e0043ae152d1529">kinkCuts</a>[1]);</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;      mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot;GKv2 fitPt &quot;</span>&lt;&lt;fitPt&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[fitPt]);</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;      myprt&lt;&lt;std::fixed&lt;&lt;std::setprecision(5);</div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; KinkSig &quot;</span>&lt;&lt;std::setprecision(5)&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[fitPt].KinkSig;</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; prevPt significance &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[fitPt - 1].KinkSig;</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;      <span class="keywordflow">if</span>(!thisPtHasKink &amp;&amp; !prevPtHasKink) myprt&lt;&lt;<span class="stringliteral">&quot; no kink&quot;</span>;</div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;      <span class="keywordflow">if</span>(thisPtHasKink &amp;&amp; !prevPtHasKink) myprt&lt;&lt;<span class="stringliteral">&quot; -&gt; Start kink region&quot;</span>;</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;      <span class="keywordflow">if</span>(thisPtHasKink &amp;&amp; prevPtHasKink) myprt&lt;&lt;<span class="stringliteral">&quot; -&gt; Inside kink region&quot;</span>;</div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;      <span class="keywordflow">if</span>(!thisPtHasKink &amp;&amp; prevPtHasKink) myprt&lt;&lt;<span class="stringliteral">&quot; -&gt; End kink region&quot;</span>;</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;    } <span class="comment">// dbgStp</span></div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;    <span class="comment">// See if we just passed a series of points having a high kink significance. If so,</span></div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;    <span class="comment">// then find the point with the maximum value and call that the kink point</span></div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;    <span class="comment">// Don&#39;t declare a kink (yet)</span></div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;    <span class="keywordflow">if</span>(thisPtHasKink) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;    <span class="comment">// neither points are kink-like</span></div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;    <span class="keywordflow">if</span>(!prevPtHasKink) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;    <span class="comment">// We have left a kink region. Find the point with the max likelihood and call</span></div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;    <span class="comment">// that the kink point</span></div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;    <span class="keywordtype">float</span> maxSig = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ab1be85fd32a002a93e0043ae152d1529">kinkCuts</a>[1];</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> kinkRegionLength = 0;</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> maxKinkPt = USHRT_MAX;</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = fitPt - 1; ipt &gt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0]; --ipt) {</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;      <span class="keyword">auto</span>&amp; tp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt];</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;      <span class="keywordflow">if</span>(tp.KinkSig &lt; 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;      <span class="keywordflow">if</span>(tp.KinkSig &gt; maxSig) {</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;        <span class="comment">// track the max significance</span></div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;        maxSig = tp.KinkSig;</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;        maxKinkPt = ipt;</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;      } <span class="comment">// tp.KinkSig &gt; maxSig</span></div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;      <span class="comment">// find the start of the kink region</span></div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;      <span class="keywordflow">if</span>(tp.KinkSig &lt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ab1be85fd32a002a93e0043ae152d1529">kinkCuts</a>[1]) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;      ++kinkRegionLength;</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;    <span class="keywordflow">if</span>(maxKinkPt == USHRT_MAX) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;    <span class="comment">// Require that the candidate kink be above the cut threshold for more than one point.</span></div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;    <span class="comment">// Scale the requirement by the number of points in the fit</span></div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> kinkRegionLengthMin = 1 + nPtsFit / 5;</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bca55868aa9ed90ec1727bec61ae58cae5c">kStiffMu</a>]) kinkRegionLengthMin = 1 + nPtsFit / 3;</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;    <span class="keywordflow">if</span>(kinkRegionLength &lt; kinkRegionLengthMin) {</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;GKv2: kink region too short &quot;</span>&lt;&lt;kinkRegionLength&lt;&lt;<span class="stringliteral">&quot; Min &quot;</span>&lt;&lt;kinkRegionLengthMin;</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;    }</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;GKv2:   kink at &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[maxKinkPt])&lt;&lt;std::setprecision(3)&lt;&lt;<span class="stringliteral">&quot; maxSig &quot;</span>&lt;&lt;maxSig&lt;&lt;<span class="stringliteral">&quot; kinkRegionLength &quot;</span>&lt;&lt;kinkRegionLength&lt;&lt;<span class="stringliteral">&quot; Min &quot;</span>&lt;&lt;kinkRegionLengthMin;</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;    <span class="comment">// don&#39;t alter the tj unless doTrim is true</span></div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;    <span class="keywordflow">if</span>(!doTrim) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;    <span class="comment">// trim the points</span></div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = maxKinkPt + 1; ipt &lt;= tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]; ++ipt) <a class="code" href="../../de/d0f/namespacetca.html#a20bf265ff689ff64027c4d072e7ed598">UnsetUsedHits</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt]);</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;    <span class="comment">// trim another point if the charge of the last two points is wildly dissimilar</span></div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;    <span class="keywordtype">float</span> lastChg = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]].Chg;</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;    <span class="keywordtype">float</span> prevChg = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] - 1].Chg;</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;    <span class="keywordtype">float</span> chgAsym = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(lastChg - prevChg) / (lastChg + prevChg);</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;GKv2: last point after trim &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]])&lt;&lt;<span class="stringliteral">&quot; chgAsym &quot;</span>&lt;&lt;chgAsym;</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;    <span class="keywordflow">if</span>(chgAsym &gt; 0.1) {</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a20bf265ff689ff64027c4d072e7ed598">UnsetUsedHits</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]]);</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;    }</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afa6980f5646e419795cdc43499a55104">EndFlag</a>[1][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa8a209073700148c7515fa38bae5e2873">kAtKink</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;  } <span class="comment">// GottaKink</span></div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l02672"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a2d2429c036c14fad9706d51025642167"> 2672</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#a2d2429c036c14fad9706d51025642167">ChkBegin</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj)</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;  {</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;    <span class="comment">// Check the parameters at the start of the trajectory. The first</span></div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;    <span class="comment">// points may not belong to this trajectory since they were added when there was</span></div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;    <span class="comment">// little information. This information may be updated later if ReversePropagate is used</span></div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da193159e2e5bd2c50d2df2c37fc4d0c08">kFixBegin</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da9b5200eaaed0e097cac019d6643e537e">kJunkTj</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;    <span class="comment">// don&#39;t do anything if this tj has been modified by ReversePropagate</span></div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">kRvPrp</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;    <span class="comment">// don&#39;t bother with really short tjs</span></div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() &lt; 3) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> atPt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1];</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> maxPtsFit = 0;</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> firstGoodChgPullPt = USHRT_MAX;</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0]; ipt &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]; ++ipt) {</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;      <span class="keyword">auto</span>&amp; tp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt];</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;      <span class="keywordflow">if</span>(tp.Chg == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;      <span class="keywordflow">if</span>(tp.AveChg &gt; 0 &amp;&amp; firstGoodChgPullPt == USHRT_MAX) {</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(tp.ChgPull) &lt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a3a55337e6b54dd9a9e29ab70da5cd760">chargeCuts</a>[0]) firstGoodChgPullPt = ipt;</div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;      } <span class="comment">// find the first good charge pull point</span></div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;      <span class="keywordflow">if</span>(tp.NTPsFit &gt; maxPtsFit) {</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;        maxPtsFit = tp.NTPsFit;</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;        atPt = ipt;</div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;        <span class="comment">// no reason to continue if there are a good number of points fitted</span></div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;        <span class="keywordflow">if</span>(maxPtsFit &gt; 20) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;      }</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;    <span class="comment">// find the first point that is in this fit</span></div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> firstPtFit = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0];</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> cnt = 0;</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 1; ii &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size(); ++ii) {</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;      <span class="keywordflow">if</span>(ii &gt; atPt) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = atPt - ii;</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;      ++cnt;</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;      <span class="keywordflow">if</span>(cnt == maxPtsFit) {</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;        firstPtFit = ipt;</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;      } <span class="comment">// full count</span></div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;    } <span class="comment">// ii</span></div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;    <span class="keywordtype">bool</span> needsRevProp = firstPtFit &gt; 3;</div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nPtsLeft = <a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">false</span>) - firstPtFit;</div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;    <span class="keywordflow">if</span>(needsRevProp) {</div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;      needsRevProp = (nPtsLeft &gt; 5);</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;    }</div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;      mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot;CB: firstPtFit &quot;</span>&lt;&lt;firstPtFit&lt;&lt;<span class="stringliteral">&quot; at &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[firstPtFit].Pos);</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; atPt &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[atPt].Pos);</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; nPts with charge &quot;</span>&lt;&lt;nPtsLeft;</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; firstGoodChgPullPt &quot;</span>&lt;&lt;firstGoodChgPullPt;</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;      <span class="keywordflow">if</span>(firstGoodChgPullPt != USHRT_MAX) myprt&lt;&lt;<span class="stringliteral">&quot; at &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc,tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[firstGoodChgPullPt]);</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot; needsRevProp? &quot;</span>&lt;&lt;needsRevProp;</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;    }</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;    <span class="keywordflow">if</span>(!needsRevProp &amp;&amp; firstGoodChgPullPt == USHRT_MAX) {</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;      <span class="comment">// check one wire on the other side of EndPt[0] to see if there are hits that are available which could</span></div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;      <span class="comment">// be picked up by reverse propagation</span></div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;      <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a> tp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[0];</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.clear();</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">UseHit</a>.reset();</div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;      <span class="comment">// Move the TP &quot;backwards&quot;</span></div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;      <span class="keywordtype">double</span> stepSize = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a0b39677cc3d897476deca9722674981e">VLAStepSize</a>;</div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;      <span class="keywordflow">if</span>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#af4135bac344253d4fecaca6369722c0a">AngleCode</a> &lt; 2) stepSize = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(1/tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0]);</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] -= tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0] * stepSize * tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a3d0690a80fbffcedf93b202d1c7bd0cd">StepDir</a>;</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1] -= tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[1] * stepSize * tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a3d0690a80fbffcedf93b202d1c7bd0cd">StepDir</a>;</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;      <span class="comment">// launch RevProp if this wire is dead</span></div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wire = std::nearbyint(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0]);</div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a00fdf2d73e4a03e5a7f32411e460ba2e">CTP</a>).<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>;</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;      needsRevProp = (wire &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a2bfd4002c7f6fbe64e1fc1591682870b">nWires</a>[plane] &amp;&amp; !<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#a08d6f9aad54acbd12cfcc44e77e6e29d">goodWire</a>[plane][wire]);</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a> &amp;&amp; needsRevProp) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;CB: Previous wire &quot;</span>&lt;&lt;wire&lt;&lt;<span class="stringliteral">&quot; is dead. Call ReversePropagate&quot;</span>;</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;      <span class="keywordflow">if</span>(!needsRevProp &amp;&amp; firstGoodChgPullPt != USHRT_MAX) {</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;        <span class="comment">// check for hits on a not-dead wire</span></div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;        <span class="comment">// BB May 20, 2019 Do this more carefully</span></div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;        <span class="keywordtype">float</span> maxDelta = 2 * tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#af9b51f6eb202342e980fdae234fe06c5">DeltaRMS</a>;</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a519cf8a3170ec63e0b4d457f1d236109">FindCloseHits</a>(slc, tp, maxDelta, <a class="code" href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3af8476e403cd021d9242196cdcfb127a9">kAllHits</a>) &amp;&amp; !tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.empty()) {</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;          <span class="comment">// count used and unused hits</span></div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nused = 0;</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;          <span class="keywordflow">for</span>(<span class="keyword">auto</span> iht : tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>) <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj &gt; 0) ++nused;</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;          <span class="keywordflow">if</span>(nused == 0) {</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;            needsRevProp = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;              mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;CB: Found &quot;</span>&lt;&lt;tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">Hits</a>.size()-nused&lt;&lt;<span class="stringliteral">&quot; close unused hits found near EndPt[0] &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tp)&lt;&lt;<span class="stringliteral">&quot;. Call ReversePropagate&quot;</span>;</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;            } <span class="comment">// tcc.dbgStp</span></div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;          } <span class="comment">// nused = 0</span></div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;        } <span class="comment">// Close hits exist</span></div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;      } <span class="comment">// !needsRevProp</span></div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;    } <span class="comment">// !needsRevProp</span></div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;CB: maxPtsFit &quot;</span>&lt;&lt;maxPtsFit&lt;&lt;<span class="stringliteral">&quot; at point &quot;</span>&lt;&lt;atPt&lt;&lt;<span class="stringliteral">&quot; firstPtFit &quot;</span>&lt;&lt;firstPtFit&lt;&lt;<span class="stringliteral">&quot; Needs ReversePropagate? &quot;</span>&lt;&lt;needsRevProp;</div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;    }</div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da107643f4f4d32743418793c9ca64b029">kFTBRvProp</a>] &amp;&amp; needsRevProp) {</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;      <span class="comment">// lop off the points before firstPtFit and reverse propagate</span></div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;  clobber TPs &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[0])&lt;&lt;<span class="stringliteral">&quot; to &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[firstPtFit])&lt;&lt;<span class="stringliteral">&quot;. Call TrimEndPts then ReversePropagate &quot;</span>;</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;      <span class="comment">// first save the first TP on this trajectory. We will try to re-use it if</span></div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;      <span class="comment">// it isn&#39;t used during reverse propagation</span></div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#ae43e3da1b2fe6dca15e19b1c78031e36">seeds</a>.push_back(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[0]);</div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = 0; ipt &lt;= firstPtFit; ++ipt) <a class="code" href="../../de/d0f/namespacetca.html#a20bf265ff689ff64027c4d072e7ed598">UnsetUsedHits</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt]);</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da107643f4f4d32743418793c9ca64b029">kFTBRvProp</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;      <span class="comment">// Check for quality and trim if necessary before reverse propagation</span></div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a1638b2155753b89b5b7f719446b6f5c8">TrimEndPts</a>(<span class="stringliteral">&quot;RPi&quot;</span>, slc, tj, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aebf6b37bd33cbf3434810b788ebb7e82">qualityCuts</a>, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>);</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da28fa0bb663ed246b2fcf12591258c5ac">kKilled</a>]) {</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;        tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;      }</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#ad7cbf4c6b614a0794141590372874150">ReversePropagate</a>(slc, tj);</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a36a327d57361f40edfb73d1816ca4ce7">ChkStopEndPts</a>(slc, tj, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>);</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;    }</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;    <span class="keywordflow">if</span>(firstGoodChgPullPt != USHRT_MAX &amp;&amp; firstGoodChgPullPt &gt; atPt) atPt = firstGoodChgPullPt;</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;    <span class="comment">// Update the fit parameters of the first points if no reverse propagation was done</span></div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;    <span class="keywordflow">if</span>(!tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">kRvPrp</a>]) <a class="code" href="../../de/d0f/namespacetca.html#ac6639cff50e581a8ce6ebdb2d8a41f03">FixBegin</a>(slc, tj, atPt);</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;</div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;  } <span class="comment">// ChkBegin</span></div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l02795"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#ac6639cff50e581a8ce6ebdb2d8a41f03"> 2795</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#ac6639cff50e581a8ce6ebdb2d8a41f03">FixBegin</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> atPt)</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;  {</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;    <span class="comment">// Update the parameters at the beginning of the trajectory starting at point atPt</span></div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da193159e2e5bd2c50d2df2c37fc4d0c08">kFixBegin</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;    <span class="comment">// ignore short trajectories</span></div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> npwc = <a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">false</span>);</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;    <span class="keywordflow">if</span>(npwc &lt; 6) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;    <span class="comment">// ignore shower-like trajectories</span></div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ab2c0db630cd45caff1c041d639c5f253">PDGCode</a> == 11) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;    <span class="comment">// ignore junk trajectories</span></div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da9b5200eaaed0e097cac019d6643e537e">kJunkTj</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> firstPt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0];</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;    <span class="keywordflow">if</span>(atPt == tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;    <span class="comment">// Default is to use DeltaRMS of the last point on the Tj</span></div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;    <span class="keywordtype">float</span> maxDelta = 4 * tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]].DeltaRMS;</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;    <span class="comment">// Find the max DeltaRMS of points from atPt to EndPt[1]</span></div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;    <span class="keywordtype">float</span> maxDeltaRMS = 0;</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = atPt; ipt &lt;= tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]; ++ipt) {</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].DeltaRMS &gt; maxDeltaRMS) maxDeltaRMS = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].DeltaRMS;</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;    maxDelta = 3 * maxDeltaRMS;</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;FB: atPt &quot;</span>&lt;&lt;atPt&lt;&lt;<span class="stringliteral">&quot; firstPt &quot;</span>&lt;&lt;firstPt&lt;&lt;<span class="stringliteral">&quot; Stops at end 0? &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a9b6395dde0dd3420f47b066652eba8d7">PrintEndFlag</a>(tj, 0)&lt;&lt;<span class="stringliteral">&quot; start vertex &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a8b51a3dcef1b96ea2884335cd65a57a4">VtxID</a>[0]&lt;&lt;<span class="stringliteral">&quot; maxDelta &quot;</span>&lt;&lt;maxDelta;</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;    }</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;    <span class="comment">// update the trajectory for all the points up to atPt</span></div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;    <span class="comment">// assume that we will use all of these points</span></div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;    <span class="keywordtype">bool</span> maskedPts = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 1; ii &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size(); ++ii) {</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;      <span class="keywordflow">if</span>(ii &gt; atPt) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ipt = atPt - ii;</div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;      <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a>&amp; tp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt];</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a> = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[atPt].Dir;</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a9e92d46c31e4d20aa67d180b7a60605e">Ang</a> = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[atPt].Ang;</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac9596529b582dedfa7a6f9f6b24269d9">AngErr</a> = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[atPt].AngErr;</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;      tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#af4135bac344253d4fecaca6369722c0a">AngleCode</a> = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[atPt].AngleCode;</div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;      <span class="comment">// Correct the projected time to the wire</span></div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;      <span class="keywordtype">float</span> dw = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] - tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[atPt].Pos[0];</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;      <span class="keywordflow">if</span>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0] != 0) tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1] = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[atPt].Pos[1] + dw * tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[1] / tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0];</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Delta = <a class="code" href="../../de/d0f/namespacetca.html#a310add1134404b2b548a1a88f652cc04">PointTrajDOCA</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].HitPos[0], tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].HitPos[1], tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt]);</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].DeltaRMS = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[atPt].DeltaRMS;</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].NTPsFit = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[atPt].NTPsFit;</div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].FitChi = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[atPt].FitChi;</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].AveChg = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[atPt].AveChg;</div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].ChgPull = (tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg / tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdb8e6dfd5aba49787dab959fea3ac2c">AveChg</a> - 1) / tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a0787c3db4bce3ad556211ba704897ab3">ChgRMS</a>;</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;      <span class="keywordtype">bool</span> badChg = (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].ChgPull) &gt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a3a55337e6b54dd9a9e29ab70da5cd760">chargeCuts</a>[0]);</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;      <span class="keywordtype">bool</span> maskThisPt = (tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Delta &gt; maxDelta || badChg);</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;      <span class="keywordflow">if</span>(maskThisPt) {</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#a20bf265ff689ff64027c4d072e7ed598">UnsetUsedHits</a>(slc, tp);</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;        maskedPts = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;      }</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;        mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;        myprt&lt;&lt;<span class="stringliteral">&quot; Point &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Pos)&lt;&lt;<span class="stringliteral">&quot; Delta &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Delta&lt;&lt;<span class="stringliteral">&quot; ChgPull &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].ChgPull&lt;&lt;<span class="stringliteral">&quot; maskThisPt? &quot;</span>&lt;&lt;maskThisPt;</div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;      }</div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;      <span class="keywordflow">if</span>(ipt == 0) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;    } <span class="comment">// ii</span></div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;    <span class="keywordflow">if</span>(maskedPts) <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da193159e2e5bd2c50d2df2c37fc4d0c08">kFixBegin</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;  } <span class="comment">// FixBegin</span></div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l02863"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a5054f1164beee20fe31f778d536be6b8"> 2863</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="../../de/d0f/namespacetca.html#a5054f1164beee20fe31f778d536be6b8">IsGhost</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj)</div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;  {</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;    <span class="comment">// Sees if trajectory tj shares many hits with another trajectory and if so merges them.</span></div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da9e853cb112a21be9cf4a407206bc9449">kUseGhostHits</a>]) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;    <span class="comment">// ensure that tj is not a saved trajectory</span></div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a> &gt; 0) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;    <span class="comment">// or an already killed trajectory</span></div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da28fa0bb663ed246b2fcf12591258c5ac">kKilled</a>]) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() &lt; 3) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bca881b9d556e1114d8cce02b75d65120db">kStiffEl</a>]) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;</div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;    <span class="comment">// vectors of traj IDs, and the occurrence count</span></div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;    std::vector&lt;int&gt; tID;</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;    std::vector&lt;unsigned short&gt; tCnt;</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> hitCnt = 0;</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nAvailable = 0;</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0]; ipt &lt;= tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]; ++ipt) {</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Hits.size(); ++ii) {</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;        <span class="comment">// ignore hits used by this trajectory</span></div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;        <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].UseHit[ii]) {</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;          ++hitCnt;</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;        }</div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Hits[ii];</div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;        <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj &gt; 0 &amp;&amp; (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj &lt;= slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>.size()) {</div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;          <span class="keywordtype">int</span> tjid = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj;</div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> indx;</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;          <span class="keywordflow">for</span>(indx = 0; indx &lt; tID.size(); ++indx) <span class="keywordflow">if</span>(tID[indx] == tjid) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;          <span class="keywordflow">if</span>(indx == tID.size()) {</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;            tID.push_back(tjid);</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;            tCnt.push_back(1);</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;            ++tCnt[indx];</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;          }</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;          ++nAvailable;</div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;        }</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;      } <span class="comment">// ii</span></div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;    <span class="comment">// Call it a ghost if &gt; 1/3 of the hits are used by another trajectory</span></div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;    hitCnt /= 3;</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;    <span class="keywordtype">int</span> oldTjID = INT_MAX;</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;      mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot;IsGhost tj hits size cut &quot;</span>&lt;&lt;hitCnt&lt;&lt;<span class="stringliteral">&quot; tID_tCnt&quot;</span>;</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tCnt.size(); ++ii) myprt&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;tID[ii]&lt;&lt;<span class="stringliteral">&quot;_&quot;</span>&lt;&lt;tCnt[ii];</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot;\nAvailable hits &quot;</span>&lt;&lt;nAvailable;</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;    } <span class="comment">// prt</span></div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tCnt.size(); ++ii) {</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;      <span class="keywordflow">if</span>(tCnt[ii] &gt; hitCnt) {</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;        oldTjID = tID[ii];</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;        hitCnt = tCnt[ii];</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;      }</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;    } <span class="comment">// ii</span></div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;    <span class="keywordflow">if</span>(oldTjID == INT_MAX) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;    <span class="keywordtype">int</span> oldTjIndex = oldTjID - 1;</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;</div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;    <span class="comment">// See if this looks like a short delta-ray on a long muon</span></div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;    <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; oTj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[oldTjIndex];</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;    <span class="keywordflow">if</span>(oTj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ab2c0db630cd45caff1c041d639c5f253">PDGCode</a> == 13 &amp;&amp; hitCnt &lt; 0.1 * oTj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;    <span class="comment">// See if there are gaps in this trajectory indicating that it is really a ghost and not</span></div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;    <span class="comment">// just a crossing trajectory</span></div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;    <span class="comment">// find the range of wires spanned by oTj</span></div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;    <span class="keywordtype">int</span> wire0 = INT_MAX;</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;    <span class="keywordtype">int</span> wire1 = 0;</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; otp : oTj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>) {</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;      <span class="keywordtype">int</span> wire = std::nearbyint(otp.Pos[0]);</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;      <span class="keywordflow">if</span>(wire &lt; wire0) wire0 = wire;</div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;      <span class="keywordflow">if</span>(wire &gt; wire1) wire1 = wire;</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;    } <span class="comment">// tp</span></div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;</div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;    <span class="keywordtype">int</span> nwires = wire1 - wire0 + 1;</div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;    std::vector&lt;float&gt; oTjPos1(nwires, -1);</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nMissedWires = 0;</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = oTj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0]; ipt &lt;= oTj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]; ++ipt) {</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;      <span class="keywordflow">if</span>(oTj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;      <span class="keywordtype">int</span> wire = std::nearbyint(oTj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Pos[0]);</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;      <span class="keywordtype">int</span> indx = wire - wire0;</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;      <span class="keywordflow">if</span>(indx &lt; 0 || indx &gt; nwires - 1) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;      oTjPos1[indx] = oTj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Pos[1];</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;      ++nMissedWires;</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;    <span class="comment">// count the number of ghost TPs</span></div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ngh = 0;</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;    <span class="comment">// and the number with Delta &gt; 0 relative to oTj</span></div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nghPlus = 0;</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;    <span class="comment">// keep track of the first point and last point appearance of oTj</span></div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> firstPtInoTj = USHRT_MAX;</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> lastPtInoTj = 0;</div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;    <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a> tp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0]];</div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0]; ipt &lt;= tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]; ++ipt) {</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg &gt; 0) {</div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;        tp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt];</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;      }</div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;      <span class="keywordtype">int</span> wire = std::nearbyint(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Pos[0]);</div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;      <span class="keywordtype">int</span> indx = wire - wire0;</div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;      <span class="keywordflow">if</span>(indx &lt; 0 || indx &gt; nwires - 1) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;      <span class="keywordflow">if</span>(oTjPos1[indx] &gt; 0) {</div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;        <span class="comment">// ensure that the hits in this tp are used in oTj</span></div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;        <span class="keywordtype">bool</span> HitInoTj = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Hits.size(); ++ii) {</div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Hits[ii];</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;          <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj ==  oldTjID) HitInoTj = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;        } <span class="comment">// ii</span></div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;        <span class="keywordflow">if</span>(HitInoTj) {</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;          ++ngh;</div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;          <a class="code" href="../../de/d0f/namespacetca.html#a9a2cd91c50f24261f799582dc9f0a76f">MoveTPToWire</a>(tp, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Pos[0]);</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;          <span class="keywordflow">if</span>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1] &gt; oTjPos1[indx]) ++nghPlus;</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;          <span class="keywordflow">if</span>(firstPtInoTj == USHRT_MAX) firstPtInoTj = ipt;</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;          lastPtInoTj = ipt;</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;        }</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;      } <span class="comment">// oTjHasChg[indx]</span></div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;</div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; Number of missed wires in oTj gaps &quot;</span>&lt;&lt;nMissedWires&lt;&lt;<span class="stringliteral">&quot; Number of ghost hits in these gaps &quot;</span>&lt;&lt;ngh&lt;&lt;<span class="stringliteral">&quot; nghPlus &quot;</span>&lt;&lt;nghPlus&lt;&lt;<span class="stringliteral">&quot; cut &quot;</span>&lt;&lt;0.2 * nMissedWires;</div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;</div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;    <span class="keywordflow">if</span>(ngh &lt; 0.2 * nMissedWires) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;    <span class="keywordflow">if</span>(firstPtInoTj &gt; lastPtInoTj) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;</div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;    <span class="comment">// require all of the tj TPs to be on either the + or - side of the oTj trajectory</span></div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;    <span class="keywordflow">if</span>(!(nghPlus &gt; 0.8 * ngh || nghPlus &lt; 0.2 * ngh) ) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; Trajectory is a ghost of &quot;</span>&lt;&lt;oldTjID&lt;&lt;<span class="stringliteral">&quot; first point in oTj &quot;</span>&lt;&lt;firstPtInoTj&lt;&lt;<span class="stringliteral">&quot; last point &quot;</span>&lt;&lt;lastPtInoTj;</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;    <span class="comment">// unset all of the shared hits</span></div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = firstPtInoTj; ipt &lt;= lastPtInoTj; ++ipt) {</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a20bf265ff689ff64027c4d072e7ed598">UnsetUsedHits</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt]);</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) <a class="code" href="../../de/d0f/namespacetca.html#a5005f83120a22b0f059526653af3cb6f">PrintTrajectory</a>(<span class="stringliteral">&quot;IG&quot;</span>, slc, tj, ipt);</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;    }</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;    <span class="comment">// see how many points are left at the end</span></div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;    ngh = 0;</div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = lastPtInoTj; ipt &lt;= tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]; ++ipt) {</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg &gt; 0) ++ngh;</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;    <span class="comment">// clobber those too?</span></div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;    <span class="keywordflow">if</span>(ngh &gt; 0 &amp;&amp; ngh &lt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a8401e4d37fab8a440de704d2f7c3a9be">minPts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a77b3a6b92ddd696b3dec9d7581f6503e">Pass</a>]) {</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = lastPtInoTj; ipt &lt;= tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]; ++ipt) {</div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;        <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg &gt; 0) <a class="code" href="../../de/d0f/namespacetca.html#a20bf265ff689ff64027c4d072e7ed598">UnsetUsedHits</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt]);</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;      } <span class="comment">// ipt</span></div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;    }</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.resize(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] + 1);</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;    slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[oldTjIndex].AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da9e853cb112a21be9cf4a407206bc9449">kUseGhostHits</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a1638b2155753b89b5b7f719446b6f5c8">TrimEndPts</a>(<span class="stringliteral">&quot;IG&quot;</span>, slc, tj, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aebf6b37bd33cbf3434810b788ebb7e82">qualityCuts</a>, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>);</div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da28fa0bb663ed246b2fcf12591258c5ac">kKilled</a>]) {</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>)  mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; Failed quality cuts&quot;</span>;</div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;    }</div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">MCSMom</a> = <a class="code" href="../../de/d0f/namespacetca.html#a712fa9841aa560d0298a3bd5fda51bb8">MCSMom</a>(slc, tj);</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>)  mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; New tj size &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size();</div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;</div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;  } <span class="comment">// IsGhost</span></div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l03027"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a7d2ee4dedd0f4389101ca8430d27dbd4"> 3027</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="../../de/d0f/namespacetca.html#a5054f1164beee20fe31f778d536be6b8">IsGhost</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, std::vector&lt;unsigned int&gt;&amp; tHits)</div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;  {</div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;    <span class="comment">// Called by FindJunkTraj to see if the passed hits are close to an existing</span></div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;    <span class="comment">// trajectory and if so, they will be used in that other trajectory</span></div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da9e853cb112a21be9cf4a407206bc9449">kUseGhostHits</a>]) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;    <span class="keywordflow">if</span>(tHits.size() &lt; 2) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;    <span class="keywordtype">bool</span> prt = (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a> || <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ac24fc2006fb9fdcc2dc745608b6b0f5c">dbgAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da9e853cb112a21be9cf4a407206bc9449">kUseGhostHits</a>]);</div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;</div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;    <span class="comment">// find all nearby hits</span></div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;    std::vector&lt;unsigned int&gt; hitsInMuliplet, nearbyHits;</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span> iht : tHits) {</div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a956ff1118d924911210bace923717e57">GetHitMultiplet</a>(slc, iht, hitsInMuliplet, <span class="keyword">false</span>);</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;      <span class="comment">// prevent double counting</span></div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;      <span class="keywordflow">for</span>(<span class="keyword">auto</span> mht : hitsInMuliplet) {</div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;        <span class="keywordflow">if</span>(std::find(nearbyHits.begin(), nearbyHits.end(), mht) == nearbyHits.end()) {</div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;          nearbyHits.push_back(mht);</div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;        }</div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;      } <span class="comment">// mht</span></div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;    } <span class="comment">// iht</span></div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;    <span class="comment">// vectors of traj IDs, and the occurrence count</span></div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;    std::vector&lt;unsigned int&gt; tID, tCnt;</div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span> iht : nearbyHits) {</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;      <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tid = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj;</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> indx = 0;</div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;      <span class="keywordflow">for</span>(indx = 0; indx &lt; tID.size(); ++indx) <span class="keywordflow">if</span>(tID[indx] == tid) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;      <span class="keywordflow">if</span>(indx == tID.size()) {</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;        tID.push_back(tid);</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;        tCnt.push_back(1);</div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;      }  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;        ++tCnt[indx];</div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;      }</div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;    } <span class="comment">// iht</span></div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;    <span class="keywordflow">if</span>(tCnt.empty()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;    <span class="comment">// Call it a ghost if &gt; 50% of the hits are used by another trajectory</span></div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> tCut = 0.5 * tHits.size();</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;    <span class="keywordtype">int</span> tid = INT_MAX;</div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;</div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;    <span class="keywordflow">if</span>(prt) {</div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;      mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot;IsGhost tHits size &quot;</span>&lt;&lt;tHits.size()&lt;&lt;<span class="stringliteral">&quot; cut fraction &quot;</span>&lt;&lt;tCut&lt;&lt;<span class="stringliteral">&quot; tID_tCnt&quot;</span>;</div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tCnt.size(); ++ii) myprt&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;tID[ii]&lt;&lt;<span class="stringliteral">&quot;_&quot;</span>&lt;&lt;tCnt[ii];</div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;    } <span class="comment">// prt</span></div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tCnt.size(); ++ii) {</div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;      <span class="keywordflow">if</span>(tCnt[ii] &gt; tCut) {</div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;        tid = tID[ii];</div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;      }</div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;    } <span class="comment">// ii</span></div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;    <span class="keywordflow">if</span>(tid &gt; (<span class="keywordtype">int</span>)slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>.size()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;</div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;    <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; is ghost of trajectory &quot;</span>&lt;&lt;tid;</div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;</div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;    <span class="comment">// Use all hits in tHits that are found in itj</span></div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; tp : slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tid - 1].Pts) {</div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tp.Hits.size(); ++ii) {</div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht = tp.Hits[ii];</div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;        <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj != 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> jj = 0; jj &lt; tHits.size(); ++jj) {</div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tht = tHits[jj];</div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;          <span class="keywordflow">if</span>(tht != iht) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;          tp.UseHit[ii] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;          slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj = tid;</div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;        } <span class="comment">// jj</span></div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;      } <span class="comment">// ii</span></div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;    } <span class="comment">// tp</span></div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;    slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tid - 1].AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da9e853cb112a21be9cf4a407206bc9449">kUseGhostHits</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;  } <span class="comment">// IsGhost</span></div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l03106"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#af81ddf66c643b53f3f7816131a384bc4"> 3106</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#af81ddf66c643b53f3f7816131a384bc4">LastEndMerge</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../de/d0f/namespacetca.html#a0c55ac735de824c3e089bcbea9addb71">CTP_t</a> inCTP)</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;  {</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;    <span class="comment">// last ditch attempt to merge long straight broken trajectories by averaging</span></div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;    <span class="comment">// all points in the trajectory and applying tight angle and separation cuts.</span></div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;    <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>.size() &lt; 2) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5dad63ad8e4f9eaaaa45309076c0c63725d">kLastEndMerge</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;    <span class="keywordtype">bool</span> prt = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ac24fc2006fb9fdcc2dc745608b6b0f5c">dbgAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5dad63ad8e4f9eaaaa45309076c0c63725d">kLastEndMerge</a>];</div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;</div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;    <span class="comment">// create an averaged TP for each long Trajectory</span></div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;    std::vector&lt;TrajPoint&gt; tjTP;</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; tj : slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>) {</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;      <span class="keywordflow">if</span>(tj.AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da28fa0bb663ed246b2fcf12591258c5ac">kKilled</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;      <span class="keywordflow">if</span>(tj.CTP != inCTP) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;      <span class="keywordflow">if</span>(tj.Pts.size() &lt; 10) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;      <span class="keywordflow">if</span>(tj.MCSMom &lt; 100) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;      <span class="keyword">auto</span> tjtp = <a class="code" href="../../de/d0f/namespacetca.html#a28caa76204a2de8a70ff9188bff92987">CreateTPFromTj</a>(slc, tj);</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;      <span class="keywordflow">if</span>(tjtp.Chg &lt; 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;      tjTP.push_back(tjtp);</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;    } <span class="comment">// tj</span></div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;    <span class="keywordflow">if</span>(tjTP.size() &lt; 2) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;</div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;    <span class="keywordflow">if</span>(prt) {</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;      mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;      myprt&lt;&lt;<span class="stringliteral">&quot;inside LastEndMerge slice &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a0898183aa6813a6ab2cbaede7d31e4d1">slices</a>.size()-1&lt;&lt;<span class="stringliteral">&quot; inCTP &quot;</span>&lt;&lt;inCTP&lt;&lt;<span class="stringliteral">&quot; tjTPs&quot;</span>;</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;      <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; tjtp : tjTP) myprt&lt;&lt;<span class="stringliteral">&quot; T&quot;</span>&lt;&lt;tjtp.Step;</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;    }</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> pt1 = 0; pt1 &lt; tjTP.size() - 1; ++pt1) {</div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;      <span class="keyword">auto</span>&amp; tp1 = tjTP[pt1];</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;      <span class="keyword">auto</span>&amp; tj1 = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tp1.Step - 1];</div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;      <span class="keywordflow">if</span>(tj1.AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da28fa0bb663ed246b2fcf12591258c5ac">kKilled</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> pt2 = pt1 + 1; pt2 &lt; tjTP.size(); ++pt2) {</div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;        <span class="keyword">auto</span>&amp; tp2 = tjTP[pt2];</div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;        <span class="keyword">auto</span>&amp; tj2 = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tp2.Step - 1];</div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;        <span class="keywordflow">if</span>(tj2.AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da28fa0bb663ed246b2fcf12591258c5ac">kKilled</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;        <span class="keywordtype">float</span> dang = <a class="code" href="../../de/d0f/namespacetca.html#a3817156934849ad2042f29fcd347c466">DeltaAngle</a>(tp1.Ang, tp2.Ang);</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;        <span class="comment">// make an angle cut</span></div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;        <span class="keywordflow">if</span>(prt &amp;&amp; dang &lt; 0.5) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; T&quot;</span>&lt;&lt;tj1.ID&lt;&lt;<span class="stringliteral">&quot; T&quot;</span>&lt;&lt;tj2.ID&lt;&lt;<span class="stringliteral">&quot; dang &quot;</span>&lt;&lt;dang;</div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;        <span class="keywordflow">if</span>(dang &gt; 0.2) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;        <span class="comment">// and an impact parameter cut</span></div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt1, ipt2;</div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;        <span class="keywordtype">float</span> ip12 = <a class="code" href="../../de/d0f/namespacetca.html#a310add1134404b2b548a1a88f652cc04">PointTrajDOCA</a>(slc, tp1.Pos[0], tp1.Pos[1], tp2);</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;        <span class="keywordtype">float</span> ip21 = <a class="code" href="../../de/d0f/namespacetca.html#a310add1134404b2b548a1a88f652cc04">PointTrajDOCA</a>(slc, tp2.Pos[0], tp2.Pos[1], tp1);</div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;        <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; ip12 &quot;</span>&lt;&lt;ip12&lt;&lt;<span class="stringliteral">&quot; ip21 &quot;</span>&lt;&lt;ip21;</div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;        <span class="keywordflow">if</span>(ip12 &gt; 15 &amp;&amp; ip21 &gt; 15) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;        <span class="keywordtype">float</span> minSep = 100;</div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;        <span class="comment">// find the separation considering dead wires</span></div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#a7a4d529dd1fccb11252c3ade776f5d4e">TrajTrajDOCA</a>(slc, tj1, tj2, ipt1, ipt2, minSep, <span class="keyword">false</span>);</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;        <span class="keywordflow">if</span>(minSep == 100) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;        <span class="keywordflow">if</span>(ipt1 &gt;= tj1.Pts.size() || ipt2 &gt;= tj2.Pts.size()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;        <span class="keywordtype">float</span> dwc = <a class="code" href="../../de/d0f/namespacetca.html#a757156ec709046f601b18c87c62742f8">DeadWireCount</a>(slc, tj1.Pts[ipt1], tj2.Pts[ipt2]);</div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;        <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; minSep &quot;</span>&lt;&lt;minSep&lt;&lt;<span class="stringliteral">&quot; dwc &quot;</span>&lt;&lt;dwc;</div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;        minSep -= dwc;</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;        <span class="keywordflow">if</span>(minSep &gt; 5) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;        <span class="comment">// finally require that the proximate points are close to the ends</span></div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;        <span class="keywordtype">float</span> sep10 = <a class="code" href="../../de/d0f/namespacetca.html#a2a4c4a32e939554d609ba778be021c6d">PosSep</a>(tj1.Pts[ipt1].Pos, tj1.Pts[tj1.EndPt[0]].Pos);</div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;        <span class="keywordtype">float</span> sep11 = <a class="code" href="../../de/d0f/namespacetca.html#a2a4c4a32e939554d609ba778be021c6d">PosSep</a>(tj1.Pts[ipt1].Pos, tj1.Pts[tj1.EndPt[1]].Pos);</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;        <span class="keywordflow">if</span>(sep10 &gt; 5 &amp;&amp; sep11 &gt; 5) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> end1 = 0;</div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;        <span class="keywordflow">if</span>(sep11 &lt; sep10) end1 = 1;</div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;        <span class="keywordtype">float</span> sep20 = <a class="code" href="../../de/d0f/namespacetca.html#a2a4c4a32e939554d609ba778be021c6d">PosSep</a>(tj2.Pts[ipt2].Pos, tj2.Pts[tj2.EndPt[0]].Pos);</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;        <span class="keywordtype">float</span> sep21 = <a class="code" href="../../de/d0f/namespacetca.html#a2a4c4a32e939554d609ba778be021c6d">PosSep</a>(tj2.Pts[ipt2].Pos, tj2.Pts[tj2.EndPt[1]].Pos);</div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;        <span class="keywordflow">if</span>(sep20 &gt; 5 &amp;&amp; sep21 &gt; 5) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> end2 = 0;</div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;        <span class="keywordflow">if</span>(sep21 &lt; sep20) end2 = 1;</div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;        <span class="comment">// don&#39;t merge if there is a kink</span></div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;        <span class="keywordflow">if</span>(tj1.EndFlag[end1][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa8a209073700148c7515fa38bae5e2873">kAtKink</a>] || tj2.EndFlag[end2][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa8a209073700148c7515fa38bae5e2873">kAtKink</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;        <span class="keywordflow">if</span>(prt) {</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;          mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;          myprt&lt;&lt;<span class="stringliteral">&quot;LEM: T&quot;</span>&lt;&lt;tj1.ID&lt;&lt;<span class="stringliteral">&quot;_&quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tp1);</div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;          <span class="keywordflow">if</span>(tj1.VtxID[end1] &gt; 0) myprt&lt;&lt;<span class="stringliteral">&quot;-&gt;2V&quot;</span>&lt;&lt;tj1.VtxID[end1];</div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;          myprt&lt;&lt;<span class="stringliteral">&quot; T&quot;</span>&lt;&lt;tj2.ID&lt;&lt;<span class="stringliteral">&quot;_&quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tp2);</div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;          <span class="keywordflow">if</span>(tj2.VtxID[end2] &gt; 0) myprt&lt;&lt;<span class="stringliteral">&quot;-&gt;2V&quot;</span>&lt;&lt;tj2.VtxID[end2];</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;          myprt&lt;&lt;<span class="stringliteral">&quot; dang &quot;</span>&lt;&lt;std::setprecision(2)&lt;&lt;dang&lt;&lt;<span class="stringliteral">&quot; ip12 &quot;</span>&lt;&lt;ip12;</div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;          myprt&lt;&lt;<span class="stringliteral">&quot; ip21 &quot;</span>&lt;&lt;ip21;</div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;          myprt&lt;&lt;<span class="stringliteral">&quot; minSep &quot;</span>&lt;&lt;minSep;</div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;          myprt&lt;&lt;<span class="stringliteral">&quot; end sep1 &quot;</span>&lt;&lt;sep10&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;sep11;</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;          myprt&lt;&lt;<span class="stringliteral">&quot; end sep2 &quot;</span>&lt;&lt;sep20&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;sep21;</div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;        } <span class="comment">// prt</span></div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;        <span class="keywordflow">if</span>(tj1.VtxID[end1] &gt; 0) {</div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;          <span class="keyword">auto</span>&amp; vx2 = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad94c65623983dd14ecee8a4166c6e582">vtxs</a>[tj1.VtxID[end1] - 1];</div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;          <a class="code" href="../../de/d0f/namespacetca.html#aba6e9ff2e76ddbc58d971f61b9897ca8">MakeVertexObsolete</a>(<span class="stringliteral">&quot;LEM&quot;</span>, slc, vx2, <span class="keyword">true</span>);</div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;        }</div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;        <span class="keywordflow">if</span>(tj2.VtxID[end2] &gt; 0 &amp;&amp; tj2.VtxID[end2] != tj1.VtxID[end1]) {</div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;          <span class="keyword">auto</span>&amp; vx2 = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad94c65623983dd14ecee8a4166c6e582">vtxs</a>[tj2.VtxID[end2] - 1];</div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;          <a class="code" href="../../de/d0f/namespacetca.html#aba6e9ff2e76ddbc58d971f61b9897ca8">MakeVertexObsolete</a>(<span class="stringliteral">&quot;LEM&quot;</span>, slc, vx2, <span class="keyword">true</span>);</div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;        }</div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;        <span class="comment">// remove Bragg flags</span></div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;        tj1.EndFlag[end1][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa0a4b8d8fc21482d4679f7eac8f457e70">kBragg</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;        tj2.EndFlag[end2][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa0a4b8d8fc21482d4679f7eac8f457e70">kBragg</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> it1 = tj1.ID - 1;</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> it2 = tj2.ID - 1;</div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#ada8c9eaa4e7457bd2a3ffe30bdc5132f">MergeAndStore</a>(slc, it1, it2, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a021e465318628b608b17e9a98525b3e2">dbgMrg</a>)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;        <span class="comment">// set the AlgMod bit</span></div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;        <span class="keyword">auto</span>&amp; ntj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>.size() - 1];</div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;        ntj.AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5dad63ad8e4f9eaaaa45309076c0c63725d">kLastEndMerge</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;        <span class="comment">// create a tp for this tj and add it to the list</span></div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;        <span class="keyword">auto</span> tjtp = <a class="code" href="../../de/d0f/namespacetca.html#a28caa76204a2de8a70ff9188bff92987">CreateTPFromTj</a>(slc, ntj);</div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;        <span class="keywordflow">if</span>(tjtp.Chg &lt; 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;        <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; added T&quot;</span>&lt;&lt;ntj.ID&lt;&lt;<span class="stringliteral">&quot; to the merge list&quot;</span>;</div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;        tjTP.push_back(tjtp);</div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;      } <span class="comment">// pt1</span></div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;    } <span class="comment">// pt1</span></div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;</div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;  } <span class="comment">// LastEndMerge</span></div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l03215"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a28caa76204a2de8a70ff9188bff92987"> 3215</a></span>&#160;<span class="comment"></span>  <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a> <a class="code" href="../../de/d0f/namespacetca.html#a28caa76204a2de8a70ff9188bff92987">CreateTPFromTj</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <span class="keyword">const</span> <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj)</div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;  {</div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;    <span class="comment">// Create a trajectory point by averaging the position and direction of all</span></div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;    <span class="comment">// TPs in the trajectory. This is used in LastEndMerge</span></div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;    <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a> tjtp;</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;    <span class="comment">// set the charge invalid</span></div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;    tjtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a> = -1;</div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da28fa0bb663ed246b2fcf12591258c5ac">kKilled</a>]) <span class="keywordflow">return</span> tjtp;</div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;    <span class="comment">// stash the ID in the Step</span></div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;    tjtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ab27d5353e9075152365d91cc0f0d0864">Step</a> = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>;</div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;    tjtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a00fdf2d73e4a03e5a7f32411e460ba2e">CTP</a> = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a9ba64d632bc17b16226d212f27dbc0aa">CTP</a>;</div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;    tjtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] = 0;</div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;    tjtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1] = 0;</div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;    tjtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0] = 0;</div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;    tjtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[1] = 0;</div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;    <span class="keywordtype">float</span> cnt = 0;</div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0]; ipt &lt;= tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]; ++ipt) {</div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;      <span class="keyword">auto</span>&amp; tp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt];</div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;      <span class="keywordflow">if</span>(tp.Chg &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;      tjtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] += tp.Pos[0];</div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;      tjtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1] += tp.Pos[1];</div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;      tjtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[1] += tp.Dir[1];</div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;      ++cnt;</div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;    tjtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] /= cnt;</div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;    tjtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1] /= cnt;</div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;    tjtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[1] /= cnt;</div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;    <span class="keywordtype">double</span> arg = 1 - tjtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[1] * tjtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[1];</div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;    <span class="keywordflow">if</span>(arg &lt; 0) arg = 0;</div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;    tjtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0] = sqrt(arg);</div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;    tjtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a9e92d46c31e4d20aa67d180b7a60605e">Ang</a> = atan2(tjtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[1], tjtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0]);</div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;    tjtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a> = 1;</div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;    <span class="keywordflow">return</span> tjtp;</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;  } <span class="comment">// CreateTjTP</span></div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l03251"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#acf162951edfc70b922d57ba960905a11"> 3251</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#acf162951edfc70b922d57ba960905a11">EndMerge</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../de/d0f/namespacetca.html#a0c55ac735de824c3e089bcbea9addb71">CTP_t</a> inCTP, <span class="keywordtype">bool</span> lastPass)</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;  {</div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;    <span class="comment">// Merges trajectories end-to-end or makes vertices. Does a more careful check on the last pass</span></div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;</div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;    <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>.size() &lt; 2) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da053042a804ddb01bb1c883c882f05985">kMerge</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;</div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;    <span class="keywordtype">bool</span> prt = (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a021e465318628b608b17e9a98525b3e2">dbgMrg</a> &amp;&amp; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a13a021fd1f351b551124f4b7f8cef937">dbgSlc</a> &amp;&amp; inCTP == <a class="code" href="../../de/d0f/namespacetca.html#ad232469b22f64d38891a7038f0e36ef3">debug</a>.<a class="code" href="../../d8/de4/structtca_1_1DebugStuff.html#abdefd5fc91232162d9ac0eb0d2c79a9d">CTP</a>);</div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;    <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;inside EndMerge slice &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a0898183aa6813a6ab2cbaede7d31e4d1">slices</a>.size()-1&lt;&lt;<span class="stringliteral">&quot; inCTP &quot;</span>&lt;&lt;inCTP&lt;&lt;<span class="stringliteral">&quot; nTjs &quot;</span>&lt;&lt;slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>.size()&lt;&lt;<span class="stringliteral">&quot; lastPass? &quot;</span>&lt;&lt;lastPass;</div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;</div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;    <span class="comment">// Ensure that all tjs are in the same order</span></div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;    <span class="keywordtype">short</span> tccStepDir = 1;</div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a2a72c7c94d8a7b0114b5183a4041ce1f">modes</a>[<a class="code" href="../../de/d0f/namespacetca.html#a70c266df69c86d3389a40a300c75903aa28cc702e4286591d02facc3f8f425a1c">kStepDir</a>]) tccStepDir = -1;</div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; tj : slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>) {</div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;      <span class="keywordflow">if</span>(tj.AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da28fa0bb663ed246b2fcf12591258c5ac">kKilled</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;      <span class="keywordflow">if</span>(tj.CTP != inCTP) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;      <span class="keywordflow">if</span>(tj.StepDir != tccStepDir) <a class="code" href="../../de/d0f/namespacetca.html#aeaedd29af9a4f572ed7fcb21e0337949">ReverseTraj</a>(slc, tj);</div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;    } <span class="comment">// tj</span></div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;</div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> maxShortTjLen = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a83dc3d01465a197a631feb83b8dcbf1a">vtx2DCuts</a>[0];</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;</div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;    <span class="comment">// temp vector for checking the fraction of hits near a merge point</span></div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;    std::vector&lt;int&gt; tjlist(2);</div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;</div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;    <span class="keywordtype">float</span> minChgRMS = 0.5 * (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a3a55337e6b54dd9a9e29ab70da5cd760">chargeCuts</a>[1] + <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a3a55337e6b54dd9a9e29ab70da5cd760">chargeCuts</a>[2]);</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;</div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;    <span class="comment">// iterate whenever a merge occurs since tjs will change. This is not necessary</span></div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;    <span class="comment">// when a vertex is created however.</span></div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;    <span class="keywordtype">bool</span> iterate = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;    <span class="keywordflow">while</span>(iterate) {</div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;      iterate = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> it1 = 0; it1 &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>.size(); ++it1) {</div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;        <span class="keyword">auto</span>&amp; tj1 = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it1];</div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;        <span class="keywordflow">if</span>(tj1.AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da28fa0bb663ed246b2fcf12591258c5ac">kKilled</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;        <span class="keywordflow">if</span>(tj1.CTP != inCTP) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;        <span class="comment">// don&#39;t try to merge high energy electrons</span></div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;        <span class="keywordflow">if</span>(tj1.PDGCode == 111) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> end1 = 0; end1 &lt; 2; ++end1) {</div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;          <span class="comment">// no merge if there is a vertex at the end</span></div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;          <span class="keywordflow">if</span>(tj1.VtxID[end1] &gt; 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;          <span class="comment">// make a copy of tp1 so we can mess with it</span></div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;          <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a> tp1 = tj1.Pts[tj1.EndPt[end1]];</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;          <span class="comment">// do a local fit on the lastpass only using the last 3 points</span></div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;          <span class="keywordflow">if</span>(lastPass &amp;&amp; tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">NTPsFit</a> &gt; 3) {</div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;            <span class="comment">// make a local copy of the tj</span></div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;            <span class="keyword">auto</span> ttj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it1];</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;            <span class="keyword">auto</span>&amp; lastTP = ttj.Pts[ttj.EndPt[end1]];</div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;            <span class="comment">// fit the last 3 points</span></div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;            lastTP.NTPsFit = 3;</div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;            <a class="code" href="../../de/d0f/namespacetca.html#ab9b632aaa6a5285a60a3ac9d7bd1cfc0">FitTraj</a>(slc, ttj);</div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;            tp1 = ttj.Pts[ttj.EndPt[end1]];</div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;          } <span class="comment">// last pass</span></div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;          <span class="keywordtype">bool</span> isVLA = (tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#af4135bac344253d4fecaca6369722c0a">AngleCode</a> == 2);</div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;          <span class="keywordtype">float</span> bestFOM = 5;</div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;          <span class="keywordflow">if</span>(isVLA) bestFOM = 20;</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;          <span class="keywordtype">float</span> bestDOCA;</div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> imbest = UINT_MAX;</div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> it2 = 0; it2 &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>.size(); ++it2) {</div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;            <span class="keywordflow">if</span>(it1 == it2) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;            <span class="keyword">auto</span>&amp; tj2 = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it2];</div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;            <span class="comment">// check for consistent direction</span></div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;            <span class="keywordflow">if</span>(tj1.StepDir != tj2.StepDir) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;            <span class="keywordflow">if</span>(tj2.AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da28fa0bb663ed246b2fcf12591258c5ac">kKilled</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;            <span class="keywordflow">if</span>(tj2.CTP != inCTP) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;            <span class="comment">// don&#39;t try to merge high energy electrons</span></div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;            <span class="keywordflow">if</span>(tj2.PDGCode == 111) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;            <span class="keywordtype">float</span> olf = <a class="code" href="../../de/d0f/namespacetca.html#ad84c94de9ebdd0a1ee32f162f72dd8be">OverlapFraction</a>(slc, tj1, tj2);</div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;            <span class="keywordflow">if</span>(olf &gt; 0.25) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> end2 = 1 - end1;</div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;            <span class="comment">// check for a vertex at this end</span></div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;            <span class="keywordflow">if</span>(tj2.VtxID[end2] &gt; 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;            <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a>&amp; tp2 = tj2.Pts[tj2.EndPt[end2]];</div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;            <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a>&amp; tp2OtherEnd = tj2.Pts[tj2.EndPt[end1]];</div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;            <span class="comment">// ensure that the other end isn&#39;t closer</span></div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(tp2OtherEnd.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] - tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0]) &lt; <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] - tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0])) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;            <span class="comment">// ensure that the order is correct</span></div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;            <span class="keywordflow">if</span>(tj1.StepDir &gt; 0) {</div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;              <span class="keywordflow">if</span>(tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] &lt; tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] - 2) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;              <span class="keywordflow">if</span>(tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] &gt; tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] + 2) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;            }</div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;            <span class="comment">// ensure that there is a signal on most of the wires between these points</span></div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;            <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#abf103406bdfc7b01925a424be481abd4">SignalBetween</a>(slc, tp1, tp2, 0.8)) {</div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;              <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;            }</div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;            <span class="comment">// Find the distance of closest approach for small angle merging</span></div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;            <span class="comment">// Inflate the doca cut if we are bridging a block of dead wires</span></div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;            <span class="keywordtype">float</span> dang = <a class="code" href="../../de/d0f/namespacetca.html#a3817156934849ad2042f29fcd347c466">DeltaAngle</a>(tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a9e92d46c31e4d20aa67d180b7a60605e">Ang</a>, tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a9e92d46c31e4d20aa67d180b7a60605e">Ang</a>);</div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;            <span class="keywordtype">float</span> doca = 15;</div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;            <span class="keywordflow">if</span>(isVLA) {</div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;              <span class="comment">// compare the minimum separation between Large Angle trajectories using a generous cut</span></div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;              <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt1, ipt2;</div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;              <a class="code" href="../../de/d0f/namespacetca.html#a7a4d529dd1fccb11252c3ade776f5d4e">TrajTrajDOCA</a>(slc, tj1, tj2, ipt1, ipt2, doca);</div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;              <span class="comment">//              if(prt) mf::LogVerbatim(&quot;TC&quot;)&lt;&lt;&quot; isVLA check ipt1 &quot;&lt;&lt;ipt1&lt;&lt;&quot; ipt2 &quot;&lt;&lt;ipt2&lt;&lt;&quot; doca &quot;&lt;&lt;doca;</span></div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;              <span class="comment">// small angle</span></div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;              doca = <a class="code" href="../../de/d0f/namespacetca.html#a310add1134404b2b548a1a88f652cc04">PointTrajDOCA</a>(slc, tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0], tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1], tp2);</div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;            }</div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;            <span class="keywordtype">float</span> fom = dang * doca;</div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;            <span class="keywordflow">if</span>(fom &lt; bestFOM) {</div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;              bestFOM = fom;</div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;              bestDOCA = doca;</div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;              imbest = it2;</div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;            }</div>
<div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;          } <span class="comment">// it2</span></div>
<div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;          <span class="comment">// No merge/vertex candidates</span></div>
<div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;          <span class="keywordflow">if</span>(imbest == UINT_MAX) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;</div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;          <span class="comment">// Make angle adjustments to tp1.</span></div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> it2 = imbest;</div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;          <span class="keyword">auto</span>&amp; tj2 = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[imbest];</div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> end2 = 1 - end1;</div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;          <span class="keywordtype">bool</span> loMCSMom = (tj1.MCSMom + tj2.MCSMom) &lt; 150;</div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;          <span class="comment">// Don&#39;t use the angle at the end Pt for high momentum long trajectories in case there is a little kink at the end</span></div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;          <span class="keywordflow">if</span>(tj1.Pts.size() &gt; 50 &amp;&amp; tj1.MCSMom &gt; 100) {</div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;            <span class="keywordflow">if</span>(end1 == 0) {</div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;              tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a9e92d46c31e4d20aa67d180b7a60605e">Ang</a> = tj1.Pts[tj1.EndPt[0] + 2].Ang;</div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;              tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a9e92d46c31e4d20aa67d180b7a60605e">Ang</a> = tj1.Pts[tj1.EndPt[1] - 2].Ang;</div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;            }</div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loMCSMom) {</div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;            <span class="comment">// Low momentum - calculate the angle using the two Pts at the end</span></div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> pt1, pt2;</div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;            <span class="keywordflow">if</span>(end1 == 0) {</div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;              pt1 = tj1.EndPt[0];</div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;              pt2 = pt1 + 1;</div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;              pt2 = tj1.EndPt[1];</div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;              pt1 = pt2 - 1;</div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;            }</div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;            <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a> tpdir;</div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a45477c64580773fdd4e4740ce58fa817">MakeBareTrajPoint</a>(slc, tj1.Pts[pt1], tj1.Pts[pt2], tpdir)) tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a9e92d46c31e4d20aa67d180b7a60605e">Ang</a> = tpdir.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a9e92d46c31e4d20aa67d180b7a60605e">Ang</a>;</div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;          } <span class="comment">// low MCSMom</span></div>
<div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;          <span class="comment">// Now do the same for tj2</span></div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;          <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a> tp2 = tj2.Pts[tj2.EndPt[end2]];</div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;          <span class="keywordflow">if</span>(tj2.Pts.size() &gt; 50 &amp;&amp; tj2.MCSMom &gt; 100) {</div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;            <span class="keywordflow">if</span>(end1 == 0) {</div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;              tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a9e92d46c31e4d20aa67d180b7a60605e">Ang</a> = tj2.Pts[tj2.EndPt[0] + 2].Ang;</div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;              tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a9e92d46c31e4d20aa67d180b7a60605e">Ang</a> = tj2.Pts[tj2.EndPt[1] - 2].Ang;</div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;            }</div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(loMCSMom) {</div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;            <span class="comment">// Low momentum - calculate the angle using the two Pts at the end</span></div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> pt1, pt2;</div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;            <span class="keywordflow">if</span>(end2 == 0) {</div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;              pt1 = tj2.EndPt[0];</div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;              pt2 = pt1 + 1;</div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;              pt2 = tj2.EndPt[1];</div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;              pt1 = pt2 - 1;</div>
<div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;            }</div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;            <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a> tpdir;</div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a45477c64580773fdd4e4740ce58fa817">MakeBareTrajPoint</a>(slc, tj2.Pts[pt1], tj2.Pts[pt2], tpdir)) tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a9e92d46c31e4d20aa67d180b7a60605e">Ang</a> = tpdir.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a9e92d46c31e4d20aa67d180b7a60605e">Ang</a>;</div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;          } <span class="comment">// low MCSMom</span></div>
<div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;</div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;          <span class="keywordflow">if</span>(!isVLA &amp;&amp; !<a class="code" href="../../de/d0f/namespacetca.html#abf103406bdfc7b01925a424be481abd4">SignalBetween</a>(slc, tp1, tp2, 0.99)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;</div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;          <span class="comment">// decide whether to merge or make a vertex</span></div>
<div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;          <span class="comment">// protect against angles &gt; pi/2</span></div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;          <span class="keywordtype">float</span> dang = acos(<a class="code" href="../../de/d0f/namespacetca.html#ac7453ffded371a6c148f116b8c0042c9">DotProd</a>(tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>, tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>));</div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;          <span class="keywordtype">float</span> sep = <a class="code" href="../../de/d0f/namespacetca.html#a2a4c4a32e939554d609ba778be021c6d">PosSep</a>(tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>, tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>);</div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;          <span class="comment">// ignore this pair if the gap between them is much longer than the length of the shortest Tj</span></div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;          <span class="keywordtype">float</span> len1 = <a class="code" href="../../de/d0f/namespacetca.html#a6e2276751d57a99e13a810d6166692a0">TrajLength</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it1]);</div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;          <span class="keywordtype">float</span> len2 = <a class="code" href="../../de/d0f/namespacetca.html#a6e2276751d57a99e13a810d6166692a0">TrajLength</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it2]);</div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;          <span class="keywordflow">if</span>(len1 &lt; len2 &amp;&amp; sep &gt; 3 * len1) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;          <span class="keywordflow">if</span>(len2 &lt; len1 &amp;&amp; sep &gt; 3 * len2) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;</div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;          <span class="comment">// default cuts for locMCSMom condition</span></div>
<div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;          <span class="keywordtype">float</span> dangCut = 1;</div>
<div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;          <span class="keywordtype">float</span> docaCut = 2;</div>
<div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;          <span class="keywordtype">float</span> kinkSig = -1;</div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;          <span class="keywordflow">if</span>(!loMCSMom) {</div>
<div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nPtsFit = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ab1be85fd32a002a93e0043ae152d1529">kinkCuts</a>[0];</div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;            <span class="keywordtype">bool</span> useChg = (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ab1be85fd32a002a93e0043ae152d1529">kinkCuts</a>[2] &gt; 0);</div>
<div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;            kinkSig = <a class="code" href="../../de/d0f/namespacetca.html#a6f2f34a55fc01dbc6f34b6f8dfa958b1">KinkSignificance</a>(slc, tj1, end1, tj2, end2, nPtsFit, useChg, prt);</div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;          }</div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;          docaCut = 1.5;</div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;          <span class="keywordflow">if</span>(isVLA) docaCut = 15;</div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;          <span class="keywordtype">float</span> chgPull = 0;</div>
<div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;          <span class="keywordflow">if</span>(tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac7ee47f41dc2e24263c8c9fb9a135dd2">AveChg</a> &gt; tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac7ee47f41dc2e24263c8c9fb9a135dd2">AveChg</a>) {</div>
<div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;            chgPull = (tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac7ee47f41dc2e24263c8c9fb9a135dd2">AveChg</a> / tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac7ee47f41dc2e24263c8c9fb9a135dd2">AveChg</a> - 1) / minChgRMS;</div>
<div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;            chgPull = (tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac7ee47f41dc2e24263c8c9fb9a135dd2">AveChg</a> / tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac7ee47f41dc2e24263c8c9fb9a135dd2">AveChg</a> - 1) / minChgRMS;</div>
<div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;          }</div>
<div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;          <span class="comment">// open up the cuts on the last pass</span></div>
<div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;          <span class="keywordtype">float</span> chgFracCut = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a83dc3d01465a197a631feb83b8dcbf1a">vtx2DCuts</a>[8];</div>
<div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;          <span class="keywordtype">float</span> chgPullCut = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a3a55337e6b54dd9a9e29ab70da5cd760">chargeCuts</a>[0];</div>
<div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;          <span class="keywordflow">if</span>(lastPass) {</div>
<div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;            docaCut *= 2;</div>
<div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;            chgFracCut *= 0.5;</div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;            chgPullCut *= 1.5;</div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;          }</div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;</div>
<div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;          <span class="comment">// check the merge cuts. Start with doca and dang requirements</span></div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;          <span class="keywordtype">bool</span> doMerge = bestDOCA &lt; docaCut &amp;&amp; dang &lt; dangCut;</div>
<div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;          <span class="keywordtype">bool</span> showerTjs = tj1.PDGCode == 11 || tj2.PDGCode == 11;</div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;          <span class="keywordtype">bool</span> hiMCSMom = tj1.MCSMom &gt; 200 || tj2.MCSMom &gt; 200;</div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;          <span class="comment">// add a charge similarity requirement if not shower-like or low momentum or not LA</span></div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;          <span class="keywordflow">if</span>(doMerge &amp;&amp; !showerTjs &amp;&amp; hiMCSMom &amp;&amp; chgPull &gt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a3a55337e6b54dd9a9e29ab70da5cd760">chargeCuts</a>[0] &amp;&amp; !isVLA) doMerge = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;          <span class="comment">// ignore the charge pull cut if both are high momentum and dang is really small</span></div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;          <span class="keywordflow">if</span>(!doMerge &amp;&amp; tj1.MCSMom &gt; 900 &amp;&amp; tj2.MCSMom &gt; 900 &amp;&amp; dang &lt; 0.1 &amp;&amp; bestDOCA &lt; docaCut) doMerge = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;</div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;          <span class="comment">// do not merge if chgPull is really high</span></div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;          <span class="keywordflow">if</span>(doMerge &amp;&amp; chgPull &gt; 2 * chgPullCut) doMerge = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;          <span class="keywordtype">float</span> dwc = <a class="code" href="../../de/d0f/namespacetca.html#a757156ec709046f601b18c87c62742f8">DeadWireCount</a>(slc, tp1, tp2);</div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;</div>
<div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;          <span class="keywordflow">if</span>(doMerge) {</div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;            <span class="keywordflow">if</span>(lastPass) {</div>
<div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;              <span class="comment">// last pass cuts are looser but ensure that the tj after merging meets the quality cut</span></div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;              <span class="keywordtype">float</span> npwc = <a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj1, <span class="keyword">true</span>) + <a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj2, <span class="keyword">true</span>);</div>
<div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;              <span class="keyword">auto</span>&amp; tp1OtherEnd = tj1.Pts[tj1.EndPt[1 - end1]];</div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;              <span class="keyword">auto</span>&amp; tp2OtherEnd = tj2.Pts[tj2.EndPt[1 - end2]];</div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;              <span class="keywordtype">float</span> nwires = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(tp1OtherEnd.Pos[0] - tp2OtherEnd.Pos[0]);</div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;              <span class="keywordflow">if</span>(nwires == 0) nwires = 1;</div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;              <span class="keywordtype">float</span> hitFrac = npwc / nwires;</div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;              doMerge = (hitFrac &gt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aebf6b37bd33cbf3434810b788ebb7e82">qualityCuts</a>[0]);</div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;              <span class="comment">// don&#39;t merge if the gap between them is longer than the length of the shortest Tj</span></div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;              <span class="keywordflow">if</span>(len1 &lt; len2) {</div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;                <span class="keywordflow">if</span>(sep &gt; len1) doMerge = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;              } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;                <span class="keywordflow">if</span>(sep &gt; len2) doMerge = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;              }</div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;              <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; merge check sep &quot;</span>&lt;&lt;sep&lt;&lt;<span class="stringliteral">&quot; len1 &quot;</span>&lt;&lt;len1&lt;&lt;<span class="stringliteral">&quot; len2 &quot;</span>&lt;&lt;len2&lt;&lt;<span class="stringliteral">&quot; dead wire count &quot;</span>&lt;&lt;dwc&lt;&lt;<span class="stringliteral">&quot; Merge? &quot;</span>&lt;&lt;doMerge;</div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;            } <span class="comment">// not lastPass</span></div>
<div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;          } <span class="comment">// doMerge</span></div>
<div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;</div>
<div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;          <span class="comment">// Require a large charge fraction near a merge point</span></div>
<div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;          tjlist[0] = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it1].ID;</div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;          tjlist[1] = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it2].ID;</div>
<div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;          <span class="keywordtype">float</span> chgFrac = <a class="code" href="../../de/d0f/namespacetca.html#a91b05db73ba97c302cb3368ec72b1dc8">ChgFracNearPos</a>(slc, tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>, tjlist);</div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;          <span class="keywordflow">if</span>(doMerge &amp;&amp; bestDOCA &gt; 1 &amp;&amp; chgFrac &lt; chgFracCut) doMerge = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;</div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;          <span class="comment">// Check the MCSMom asymmetry and don&#39;t merge if it is higher than the user-specified cut</span></div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;          <span class="keywordtype">float</span> momAsym = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(tj1.MCSMom - tj2.MCSMom) / (float)(tj1.MCSMom + tj2.MCSMom);</div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;          <span class="keywordflow">if</span>(doMerge &amp;&amp; momAsym &gt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a83dc3d01465a197a631feb83b8dcbf1a">vtx2DCuts</a>[9]) doMerge = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;          <span class="keywordflow">if</span>(doMerge &amp;&amp; (tj1.EndFlag[end1][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa8a209073700148c7515fa38bae5e2873">kAtKink</a>] || tj2.EndFlag[end2][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa8a209073700148c7515fa38bae5e2873">kAtKink</a>])) {</div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;            <span class="comment">// don&#39;t merge if a kink exists and the tjs are not too long</span></div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;            <span class="keywordflow">if</span>(len1 &lt; 40 &amp;&amp; len2 &lt; 40) doMerge = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;            <span class="comment">// Kink on one + Bragg at other end of the other</span></div>
<div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;            <span class="keywordflow">if</span>(tj1.EndFlag[end1][kAtKink] &amp;&amp; tj2.EndFlag[1-end2][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa0a4b8d8fc21482d4679f7eac8f457e70">kBragg</a>]) doMerge = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;            <span class="keywordflow">if</span>(tj1.EndFlag[1-end1][kBragg] &amp;&amp; tj2.EndFlag[end2][kAtKink]) doMerge = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;          }</div>
<div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;</div>
<div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;          <span class="comment">// decide if we should make a vertex instead</span></div>
<div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;          <span class="keywordtype">bool</span> doVtx = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;          <span class="keywordflow">if</span>(!doMerge) {</div>
<div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;            <span class="comment">// check for a significant kink</span></div>
<div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;            doVtx = (kinkSig &gt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ab1be85fd32a002a93e0043ae152d1529">kinkCuts</a>[1]);</div>
<div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;            <span class="comment">// and a less significant kink but very close separation</span></div>
<div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;            doVtx = (kinkSig &gt; 0.5 * <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ab1be85fd32a002a93e0043ae152d1529">kinkCuts</a>[1] &amp;&amp; sep &lt; 2);</div>
<div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;          } <span class="comment">// !doMerge</span></div>
<div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;</div>
<div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;          <span class="keywordflow">if</span>(prt) {</div>
<div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;            mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;            myprt&lt;&lt;<span class="stringliteral">&quot;  EM: T&quot;</span>&lt;&lt;slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it1].ID&lt;&lt;<span class="stringliteral">&quot;_&quot;</span>&lt;&lt;end1&lt;&lt;<span class="stringliteral">&quot; - T&quot;</span>&lt;&lt;slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it2].ID&lt;&lt;<span class="stringliteral">&quot;_&quot;</span>&lt;&lt;end2&lt;&lt;<span class="stringliteral">&quot; tp1-tp2 &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tp1)&lt;&lt;<span class="stringliteral">&quot;-&quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tp2);</div>
<div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;            myprt&lt;&lt;<span class="stringliteral">&quot; FOM &quot;</span>&lt;&lt;std::fixed&lt;&lt;std::setprecision(2)&lt;&lt;bestFOM;</div>
<div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;            myprt&lt;&lt;<span class="stringliteral">&quot; DOCA &quot;</span>&lt;&lt;std::setprecision(1)&lt;&lt;bestDOCA;</div>
<div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;            myprt&lt;&lt;<span class="stringliteral">&quot; cut &quot;</span>&lt;&lt;docaCut&lt;&lt;<span class="stringliteral">&quot; isVLA? &quot;</span>&lt;&lt;isVLA;</div>
<div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;            myprt&lt;&lt;<span class="stringliteral">&quot; dang &quot;</span>&lt;&lt;std::setprecision(2)&lt;&lt;dang&lt;&lt;<span class="stringliteral">&quot; dangCut &quot;</span>&lt;&lt;dangCut;</div>
<div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;            myprt&lt;&lt;<span class="stringliteral">&quot; chgPull &quot;</span>&lt;&lt;std::setprecision(1)&lt;&lt;chgPull&lt;&lt;<span class="stringliteral">&quot; Cut &quot;</span>&lt;&lt;chgPullCut;</div>
<div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;            myprt&lt;&lt;<span class="stringliteral">&quot; chgFrac &quot;</span>&lt;&lt;std::setprecision(2)&lt;&lt;chgFrac;</div>
<div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;            myprt&lt;&lt;<span class="stringliteral">&quot; momAsym &quot;</span>&lt;&lt;momAsym;</div>
<div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;            myprt&lt;&lt;<span class="stringliteral">&quot; kinkSig &quot;</span>&lt;&lt;std::setprecision(1)&lt;&lt;kinkSig;</div>
<div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;            myprt&lt;&lt;<span class="stringliteral">&quot; doMerge? &quot;</span>&lt;&lt;doMerge;</div>
<div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;            myprt&lt;&lt;<span class="stringliteral">&quot; doVtx? &quot;</span>&lt;&lt;doVtx;</div>
<div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;          }</div>
<div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;</div>
<div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;          <span class="keywordflow">if</span>(bestDOCA &gt; docaCut) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;</div>
<div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;          <span class="keywordflow">if</span>(doMerge) {</div>
<div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;            <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;  Merge &quot;</span>;</div>
<div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;            <span class="keywordtype">bool</span> didMerge = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;            <span class="keywordflow">if</span>(end1 == 1) {</div>
<div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;              didMerge = <a class="code" href="../../de/d0f/namespacetca.html#ada8c9eaa4e7457bd2a3ffe30bdc5132f">MergeAndStore</a>(slc, it1, it2, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a021e465318628b608b17e9a98525b3e2">dbgMrg</a>);</div>
<div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;              didMerge = <a class="code" href="../../de/d0f/namespacetca.html#ada8c9eaa4e7457bd2a3ffe30bdc5132f">MergeAndStore</a>(slc, it2, it1, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a021e465318628b608b17e9a98525b3e2">dbgMrg</a>);</div>
<div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;            }</div>
<div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;            <span class="keywordflow">if</span>(didMerge) {</div>
<div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;              <span class="comment">// Set the end merge flag for the killed trajectories to aid tracing merges</span></div>
<div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;              tj1.AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da053042a804ddb01bb1c883c882f05985">kMerge</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;              tj2.AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da053042a804ddb01bb1c883c882f05985">kMerge</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;              iterate = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;            } <span class="comment">// Merge and store successfull</span></div>
<div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;            <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;              <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;  MergeAndStore failed &quot;</span>;</div>
<div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;            }</div>
<div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(doVtx) {</div>
<div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;            <span class="comment">// create a vertex instead if it passes the vertex cuts</span></div>
<div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;            <a class="code" href="../../dc/d11/structtca_1_1VtxStore.html">VtxStore</a> aVtx;</div>
<div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;            aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#aa2b60fc467a0abb4bb4202da0a603106">CTP</a> = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it1].CTP;</div>
<div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;            aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#a955d49d4351f41da21cb238fc204153b">ID</a> = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad94c65623983dd14ecee8a4166c6e582">vtxs</a>.size() + 1;</div>
<div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;            <span class="comment">// keep it simple if tp1 and tp2 are very close or if the angle between them</span></div>
<div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;            <span class="comment">// is small</span></div>
<div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;            <span class="keywordflow">if</span>(prt) {</div>
<div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;              mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;  candidate 2V&quot;</span>&lt;&lt;aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#a955d49d4351f41da21cb238fc204153b">ID</a>&lt;&lt;<span class="stringliteral">&quot; dang &quot;</span>&lt;&lt;dang&lt;&lt;<span class="stringliteral">&quot; sep &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a2a4c4a32e939554d609ba778be021c6d">PosSep</a>(tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>, tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>);</div>
<div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;            }</div>
<div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;            <span class="keywordtype">bool</span> fix2V = (<a class="code" href="../../de/d0f/namespacetca.html#a2a4c4a32e939554d609ba778be021c6d">PosSep</a>(tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>, tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>) &lt; 3 || dang &lt; 0.1);</div>
<div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;            <span class="keywordflow">if</span>(fix2V) {</div>
<div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;              aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#ae27909f659aa38cca8617e6632e3c70e">Pos</a>[0] = 0.5 * (tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] + tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0]);</div>
<div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;              aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#ae27909f659aa38cca8617e6632e3c70e">Pos</a>[1] = 0.5 * (tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1] + tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1]);</div>
<div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;              aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#a4fcebc08d6a2220c28b5a209063f1ba4">Stat</a>[<a class="code" href="../../de/d0f/namespacetca.html#a4ed5c2d3946e0f39978a054fd92dc52fa7ed6e8ddaa0f5995df900e22acf5ecff">kFixed</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;              aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#a46b27eb885d550b65c1865b0dc679b5c">PosErr</a>[0] = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] - tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0]);</div>
<div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;              aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#a46b27eb885d550b65c1865b0dc679b5c">PosErr</a>[1] = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1] - tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1]);</div>
<div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;              <span class="keywordtype">float</span> sepCut = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a83dc3d01465a197a631feb83b8dcbf1a">vtx2DCuts</a>[1];</div>
<div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;              <span class="keywordtype">bool</span> tj1Short = (slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it1].EndPt[1] - slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it1].EndPt[0] &lt; maxShortTjLen);</div>
<div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;              <span class="keywordtype">bool</span> tj2Short = (slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it2].EndPt[1] - slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it2].EndPt[0] &lt; maxShortTjLen);</div>
<div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;              <span class="keywordflow">if</span>(tj1Short || tj2Short) sepCut = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a83dc3d01465a197a631feb83b8dcbf1a">vtx2DCuts</a>[1];</div>
<div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;              <a class="code" href="../../de/d0f/namespacetca.html#a2c7d3d0a7e1e838e76ad9a43b4411176">TrajIntersection</a>(tp1, tp2, aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#ae27909f659aa38cca8617e6632e3c70e">Pos</a>);</div>
<div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;              <span class="keywordtype">float</span> dw = aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#ae27909f659aa38cca8617e6632e3c70e">Pos</a>[0] - tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0];</div>
<div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;              <span class="keywordflow">if</span>(<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(dw) &gt; sepCut) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;              <span class="keywordtype">float</span> dt = aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#ae27909f659aa38cca8617e6632e3c70e">Pos</a>[1] - tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1];</div>
<div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;              <span class="keywordflow">if</span>(<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(dt) &gt; sepCut) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;              dw = aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#ae27909f659aa38cca8617e6632e3c70e">Pos</a>[0] - tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0];</div>
<div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;              <span class="keywordflow">if</span>(<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(dw) &gt; sepCut) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;              dt = aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#ae27909f659aa38cca8617e6632e3c70e">Pos</a>[1] - tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1];</div>
<div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;              <span class="keywordflow">if</span>(<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(dt) &gt; sepCut) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;              <span class="comment">// ensure that the vertex is not closer to the other end if the tj is short</span></div>
<div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;              <span class="comment">// but not too short</span></div>
<div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;              <span class="keywordflow">if</span>(tj1Short &amp;&amp; len1 &gt; 4) {</div>
<div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;                <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a> otp1 = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it1].Pts[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it1].EndPt[1-end1]];</div>
<div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a1c2bea68a634d09340f7921072d5acda">PosSep2</a>(otp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>, aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#ae27909f659aa38cca8617e6632e3c70e">Pos</a>) &lt; <a class="code" href="../../de/d0f/namespacetca.html#a1c2bea68a634d09340f7921072d5acda">PosSep2</a>(tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>, aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#ae27909f659aa38cca8617e6632e3c70e">Pos</a>)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;              }</div>
<div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;              <span class="keywordflow">if</span>(tj2Short &amp;&amp; len2 &gt; 4) {</div>
<div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;                <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a> otp2 = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it2].Pts[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it2].EndPt[1-end2]];</div>
<div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a1c2bea68a634d09340f7921072d5acda">PosSep2</a>(otp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>, aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#ae27909f659aa38cca8617e6632e3c70e">Pos</a>) &lt; <a class="code" href="../../de/d0f/namespacetca.html#a1c2bea68a634d09340f7921072d5acda">PosSep2</a>(tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>, aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#ae27909f659aa38cca8617e6632e3c70e">Pos</a>)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;              }</div>
<div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;              <span class="comment">// we expect the vertex to be between tp1 and tp2</span></div>
<div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;              <span class="keywordflow">if</span>(aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#ae27909f659aa38cca8617e6632e3c70e">Pos</a>[0] &lt; tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] &amp;&amp; aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#ae27909f659aa38cca8617e6632e3c70e">Pos</a>[0] &lt; tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0]) {</div>
<div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;                aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#ae27909f659aa38cca8617e6632e3c70e">Pos</a>[0] = std::min(tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0], tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0]);</div>
<div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;                aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#a4fcebc08d6a2220c28b5a209063f1ba4">Stat</a>[<a class="code" href="../../de/d0f/namespacetca.html#a4ed5c2d3946e0f39978a054fd92dc52fa7ed6e8ddaa0f5995df900e22acf5ecff">kFixed</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;              }</div>
<div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;              <span class="keywordflow">if</span>(aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#ae27909f659aa38cca8617e6632e3c70e">Pos</a>[0] &gt; tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] &amp;&amp; aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#ae27909f659aa38cca8617e6632e3c70e">Pos</a>[0] &gt; tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0]) {</div>
<div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;                aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#ae27909f659aa38cca8617e6632e3c70e">Pos</a>[0] = <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::max</a>(tp1.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0], tp2.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0]);</div>
<div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;                aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#a4fcebc08d6a2220c28b5a209063f1ba4">Stat</a>[<a class="code" href="../../de/d0f/namespacetca.html#a4ed5c2d3946e0f39978a054fd92dc52fa7ed6e8ddaa0f5995df900e22acf5ecff">kFixed</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;              }</div>
<div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;            } <span class="comment">// Tps not so close</span></div>
<div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;            <span class="comment">// We got this far. Try a vertex fit to ensure that the errors are reasonable</span></div>
<div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;            slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it1].VtxID[end1] = aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#a955d49d4351f41da21cb238fc204153b">ID</a>;</div>
<div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;            slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it2].VtxID[end2] = aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#a955d49d4351f41da21cb238fc204153b">ID</a>;</div>
<div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;            <span class="keywordflow">if</span>(!aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#a4fcebc08d6a2220c28b5a209063f1ba4">Stat</a>[<a class="code" href="../../de/d0f/namespacetca.html#a4ed5c2d3946e0f39978a054fd92dc52fa7ed6e8ddaa0f5995df900e22acf5ecff">kFixed</a>] &amp;&amp; !<a class="code" href="../../de/d0f/namespacetca.html#a7daa44e56122119e4827fe39b2b30132">FitVertex</a>(slc, aVtx, prt)) {</div>
<div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;              <span class="comment">// back out</span></div>
<div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;              slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it1].VtxID[end1] = 0;</div>
<div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;              slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it2].VtxID[end2] = 0;</div>
<div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;              <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; Vertex fit failed &quot;</span>;</div>
<div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;              <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;            }</div>
<div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;            aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#a600294061c9095d64321ddbc93f5f996">NTraj</a> = 2;</div>
<div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;            aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#ac7796fc2887e9c19bd861ce1252b3806">Pass</a> = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it1].Pass;</div>
<div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;            aVtx.<a class="code" href="../../dc/d11/structtca_1_1VtxStore.html#a6ce76a1bfcc54c44ea862bfad958019b">Topo</a> = end1 + end2;</div>
<div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;            tj1.AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da053042a804ddb01bb1c883c882f05985">kMerge</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;            tj2.AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da053042a804ddb01bb1c883c882f05985">kMerge</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;            <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#afde5beaec544c29e198939b30817250e">StoreVertex</a>(slc, aVtx)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;            <a class="code" href="../../de/d0f/namespacetca.html#ab11ddb4ffcebdeb4f43ad594c7d1baeb">SetVx2Score</a>(slc);</div>
<div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;            <span class="keywordflow">if</span>(prt) {</div>
<div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;              <span class="keyword">auto</span>&amp; newVx = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad94c65623983dd14ecee8a4166c6e582">vtxs</a>[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad94c65623983dd14ecee8a4166c6e582">vtxs</a>.size() - 1];</div>
<div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;              mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;  New 2V&quot;</span>&lt;&lt;newVx.ID&lt;&lt;<span class="stringliteral">&quot; at &quot;</span>&lt;&lt;(int)newVx.Pos[0]&lt;&lt;<span class="stringliteral">&quot;:&quot;</span>&lt;&lt;(<span class="keywordtype">int</span>)(newVx.Pos[1]/<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a>)&lt;&lt;<span class="stringliteral">&quot; Score &quot;</span>&lt;&lt;newVx.Score;</div>
<div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;            }</div>
<div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;            <span class="comment">// check the score and kill it if it is below the cut</span></div>
<div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;            <span class="comment">// BB Oct 1, 2019. Don&#39;t kill the vertex in this function since it is</span></div>
<div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;            <span class="comment">// called before short trajectories are reconstructed</span></div>
<div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;            <span class="keyword">auto</span>&amp; newVx2 = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad94c65623983dd14ecee8a4166c6e582">vtxs</a>[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad94c65623983dd14ecee8a4166c6e582">vtxs</a>.size() - 1];</div>
<div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;            <span class="keywordflow">if</span>(newVx2.Score &lt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a83dc3d01465a197a631feb83b8dcbf1a">vtx2DCuts</a>[7] &amp;&amp; <a class="code" href="../../de/d0f/namespacetca.html#a7e9b0ec64528b2a3cdc8b39d3346d4ce">CompatibleMerge</a>(slc, tj1, tj2, prt)) {</div>
<div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;              <span class="keywordflow">if</span>(prt) {</div>
<div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;                mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;                myprt&lt;&lt;<span class="stringliteral">&quot;  Bad vertex: Bad score? &quot;</span>&lt;&lt;(newVx2.Score &lt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a83dc3d01465a197a631feb83b8dcbf1a">vtx2DCuts</a>[7]);</div>
<div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;                myprt&lt;&lt;<span class="stringliteral">&quot; cut &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a83dc3d01465a197a631feb83b8dcbf1a">vtx2DCuts</a>[7];</div>
<div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;                myprt&lt;&lt;<span class="stringliteral">&quot; CompatibleMerge? &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a7e9b0ec64528b2a3cdc8b39d3346d4ce">CompatibleMerge</a>(slc, tj1, tj2, prt);</div>
<div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;              }</div>
<div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;              slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it1].VtxID[end1] = 0;</div>
<div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;              slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[it2].VtxID[end2] = 0;</div>
<div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;              <a class="code" href="../../de/d0f/namespacetca.html#aba6e9ff2e76ddbc58d971f61b9897ca8">MakeVertexObsolete</a>(<span class="stringliteral">&quot;EM&quot;</span>, slc, newVx2, <span class="keyword">true</span>);</div>
<div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;              <span class="keywordtype">bool</span> didMerge = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;              <span class="keywordflow">if</span>(end1 == 1) {</div>
<div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;                didMerge = <a class="code" href="../../de/d0f/namespacetca.html#ada8c9eaa4e7457bd2a3ffe30bdc5132f">MergeAndStore</a>(slc, it1, it2, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a021e465318628b608b17e9a98525b3e2">dbgMrg</a>);</div>
<div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;              } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;                didMerge = <a class="code" href="../../de/d0f/namespacetca.html#ada8c9eaa4e7457bd2a3ffe30bdc5132f">MergeAndStore</a>(slc, it2, it1, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a021e465318628b608b17e9a98525b3e2">dbgMrg</a>);</div>
<div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;              }</div>
<div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;              <span class="keywordflow">if</span>(didMerge) {</div>
<div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;                <span class="comment">// Set the end merge flag for the killed trajectories to aid tracing merges</span></div>
<div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;                tj1.AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da053042a804ddb01bb1c883c882f05985">kMerge</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;                tj1.AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da053042a804ddb01bb1c883c882f05985">kMerge</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;                iterate = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;              } <span class="comment">// Merge and store successfull</span></div>
<div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;              <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;                <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;  MergeAndStore failed &quot;</span>;</div>
<div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;              }</div>
<div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;            } <span class="comment">// OK score</span></div>
<div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;          } <span class="comment">// create a vertex</span></div>
<div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;          <span class="keywordflow">if</span>(tj1.AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da28fa0bb663ed246b2fcf12591258c5ac">kKilled</a>]) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;        } <span class="comment">// end1</span></div>
<div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;      } <span class="comment">// it1</span></div>
<div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;    } <span class="comment">// iterate</span></div>
<div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;</div>
<div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;  } <span class="comment">// EndMerge</span></div>
<div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;<span class="comment">  //////////////////////////////////////////</span></div>
<div class="line"><a name="l03649"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a9ca258cade17b5907d2c9006bf4540d3"> 3649</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#a9ca258cade17b5907d2c9006bf4540d3">MaskTrajEndPoints</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nPts)</div>
<div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;  {</div>
<div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;</div>
<div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;    <span class="comment">// Masks off (sets all hits not-Used) nPts trajectory points at the leading edge of the</span></div>
<div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;    <span class="comment">// trajectory, presumably because the fit including this points is poor. The position, direction</span></div>
<div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;    <span class="comment">// and Delta of the last nPts points is updated as well</span></div>
<div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;</div>
<div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afa6980f5646e419795cdc43499a55104">EndFlag</a>[1][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa8a209073700148c7515fa38bae5e2873">kAtKink</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() &lt; 3) {</div>
<div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;      mf::LogError(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;MaskTrajEndPoints: Trajectory ID &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>&lt;&lt;<span class="stringliteral">&quot; too short to mask hits &quot;</span>;</div>
<div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;    }</div>
<div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;    <span class="keywordflow">if</span>(nPts &gt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() - 2) {</div>
<div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;      mf::LogError(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;MaskTrajEndPoints: Trying to mask too many points &quot;</span>&lt;&lt;nPts&lt;&lt;<span class="stringliteral">&quot; Pts.size &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size();</div>
<div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;    }</div>
<div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;</div>
<div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;    <span class="comment">// find the last good point (with charge)</span></div>
<div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> lastGoodPt = USHRT_MAX ;</div>
<div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;</div>
<div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) {</div>
<div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;MTEP: lastGoodPt &quot;</span>&lt;&lt;lastGoodPt&lt;&lt;<span class="stringliteral">&quot; Pts size &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size()&lt;&lt;<span class="stringliteral">&quot; tj.IsGood &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a>;</div>
<div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;    }</div>
<div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;    <span class="keywordflow">if</span>(lastGoodPt == USHRT_MAX) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] = lastGoodPt;</div>
<div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;</div>
<div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;    <span class="comment">//for(unsigned short ii = 0; ii &lt; nPts; ++ii) {</span></div>
<div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size(); ++ii) {</div>
<div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() - 1 - ii;</div>
<div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;      <span class="keywordflow">if</span> (ipt==lastGoodPt) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a20bf265ff689ff64027c4d072e7ed598">UnsetUsedHits</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt]);</div>
<div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;      <span class="comment">// Reset the position and direction of the masked off points</span></div>
<div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Dir = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastGoodPt].Dir;</div>
<div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;      <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastGoodPt].AngleCode == 2) {</div>
<div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;        <span class="comment">// Very large angle: Move by path length</span></div>
<div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;        <span class="keywordtype">float</span> path = <a class="code" href="../../de/d0f/namespacetca.html#a147ffd18bc86e618807de788da237640">TrajPointSeparation</a>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastGoodPt], tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt]);</div>
<div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;        tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Pos[0] = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastGoodPt].Pos[0] + path * tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Dir[0];</div>
<div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;        tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Pos[1] = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastGoodPt].Pos[1] + path * tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Dir[1];</div>
<div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;        <span class="comment">// Not large angle: Move by wire</span></div>
<div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;        <span class="keywordtype">float</span> dw = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Pos[0] - tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastGoodPt].Pos[0];</div>
<div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;        <span class="comment">// Correct the projected time to the wire</span></div>
<div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;        <span class="keywordtype">float</span> newpos = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastGoodPt].Pos[1] + dw * tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Dir[1] / tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Dir[0];</div>
<div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;MTEP: ipt &quot;</span>&lt;&lt;ipt&lt;&lt;<span class="stringliteral">&quot; Pos[0] &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Pos[0]&lt;&lt;<span class="stringliteral">&quot;. Move Pos[1] from &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Pos[1]&lt;&lt;<span class="stringliteral">&quot; to &quot;</span>&lt;&lt;newpos;</div>
<div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;        tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Pos[1] = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[lastGoodPt].Pos[1] + dw * tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Dir[1] / tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Dir[0];</div>
<div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;      }</div>
<div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Delta = <a class="code" href="../../de/d0f/namespacetca.html#a310add1134404b2b548a1a88f652cc04">PointTrajDOCA</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].HitPos[0], tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].HitPos[1], tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt]);</div>
<div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a>) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; masked ipt &quot;</span>&lt;&lt;ipt&lt;&lt;<span class="stringliteral">&quot; Pos &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt])&lt;&lt;<span class="stringliteral">&quot; Chg &quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg;</div>
<div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;    } <span class="comment">// ii</span></div>
<div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">SetEndPoints</a>(tj);</div>
<div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;</div>
<div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;  } <span class="comment">// MaskTrajEndPoints</span></div>
<div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l03703"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a50c2901dd2e4719ff3c853d0340a35b1"> 3703</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../de/d0f/namespacetca.html#a50c2901dd2e4719ff3c853d0340a35b1">ChkStop</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj)</div>
<div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;  {</div>
<div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;    <span class="comment">// Sets the EndFlag[kBragg] bits on the trajectory by identifying the Bragg peak</span></div>
<div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;    <span class="comment">// at each end. This function checks both ends, finding the point with the highest charge nearest the</span></div>
<div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;    <span class="comment">// end and considering the first (when end = 0) 4 points or last 4 points (when end = 1). The next</span></div>
<div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;    <span class="comment">// 5 - 10 points (fChkStop[0]) are fitted to a line, Q(x - x0) = Qo + (x - x0) * slope where x0 is the</span></div>
<div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;    <span class="comment">// wire position of the highest charge point. A large negative slope indicates that there is a Bragg</span></div>
<div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;    <span class="comment">// peak at the end.</span></div>
<div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;</div>
<div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afa6980f5646e419795cdc43499a55104">EndFlag</a>[0][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa0a4b8d8fc21482d4679f7eac8f457e70">kBragg</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;    tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afa6980f5646e419795cdc43499a55104">EndFlag</a>[1][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa0a4b8d8fc21482d4679f7eac8f457e70">kBragg</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da136e52e6a33b1735cb33e193b5321f15">kChkStop</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a4d43e181bd45ffde8791bcf7e4d16d54">chkStopCuts</a>[0] &lt; 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;</div>
<div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">Strategy</a>[<a class="code" href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bca881b9d556e1114d8cce02b75d65120db">kStiffEl</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;</div>
<div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;    <span class="comment">// ignore trajectories that are very large angle at both ends</span></div>
<div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0]].AngleCode == 2 || tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]].AngleCode == 2) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;</div>
<div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nPtsToCheck = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a4d43e181bd45ffde8791bcf7e4d16d54">chkStopCuts</a>[1];</div>
<div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() &lt; 6) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;</div>
<div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;    <span class="keywordtype">bool</span> prt = (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a> || <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ac24fc2006fb9fdcc2dc745608b6b0f5c">dbgAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da136e52e6a33b1735cb33e193b5321f15">kChkStop</a>]);</div>
<div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;</div>
<div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;    <span class="keywordflow">if</span>(prt) {</div>
<div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;ChkStop: T&quot;</span>&lt;&lt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">ID</a>&lt;&lt;<span class="stringliteral">&quot; requiring &quot;</span>&lt;&lt;nPtsToCheck&lt;&lt;<span class="stringliteral">&quot; points with charge slope &gt; &quot;</span>&lt;&lt;<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a4d43e181bd45ffde8791bcf7e4d16d54">chkStopCuts</a>[0]&lt;&lt;<span class="stringliteral">&quot; Chg/WSEU&quot;</span>;</div>
<div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;    }</div>
<div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;</div>
<div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;    <span class="comment">// find the highest charge hit in the first 3 points at each end</span></div>
<div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> = 0; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> &lt; 2; ++<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>) {</div>
<div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afa6980f5646e419795cdc43499a55104">EndFlag</a>[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa0a4b8d8fc21482d4679f7eac8f457e70">kBragg</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;      <span class="comment">// require that the end point is reasonably clean</span></div>
<div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;      <span class="keyword">auto</span>&amp; endTP = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>]];</div>
<div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;      <span class="keywordflow">if</span>(endTP.Hits.size() &gt; 2) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;      <span class="keywordflow">if</span>(endTP.Environment[<a class="code" href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525a50b927fda7f9c083ec06574d2e57fc15">kEnvUnusedHits</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;      <span class="keywordtype">short</span> <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> = 1 - 2 * <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>;</div>
<div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;      <span class="comment">// find the point with the highest charge considering the first 3 points</span></div>
<div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;      <span class="keywordtype">float</span> big = 0;</div>
<div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> hiPt = 0;</div>
<div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;      <span class="keywordtype">float</span> wire0 = 0;</div>
<div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; 5; ++ii) {</div>
<div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;        <span class="keywordtype">short</span> ipt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>] + ii * <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>;</div>
<div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;        <span class="keywordflow">if</span>(ipt &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0] || ipt &gt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;        <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a>&amp; tp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt];</div>
<div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;        <span class="keywordflow">if</span>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a> &gt; big) {</div>
<div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;          big = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a>;</div>
<div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;          wire0 = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0];</div>
<div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;          hiPt = ipt;</div>
<div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;        }</div>
<div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;      } <span class="comment">// ii</span></div>
<div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;      <span class="comment">// ensure that the high point is closer to the end that is being</span></div>
<div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;      <span class="comment">// considered than to the other end</span></div>
<div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;      <span class="keywordtype">short</span> dpt0 = hiPt - tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0];</div>
<div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;      <span class="keywordtype">short</span> dpt1 = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] - hiPt;</div>
<div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> == 0 &amp;&amp; dpt1 &lt;= dpt0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> == 1 &amp;&amp; dpt0 &lt;= dpt1) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;      <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; end &quot;</span>&lt;&lt;<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>&lt;&lt;<span class="stringliteral">&quot; wire0 &quot;</span>&lt;&lt;wire0&lt;&lt;<span class="stringliteral">&quot; Chg &quot;</span>&lt;&lt;big&lt;&lt;<span class="stringliteral">&quot; hiPt &quot;</span>&lt;&lt;hiPt;</div>
<div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;      <span class="keywordtype">float</span> prevChg = big;</div>
<div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;      <span class="comment">// prepare to do the fit</span></div>
<div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#acae6296d6fba718d82c34c88fefddf52">Point2_t</a> inPt;</div>
<div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#aca0bf062221b71f6317cf149fb53e0c3">Vector2_t</a> outVec, outVecErr;</div>
<div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;      <span class="keywordtype">float</span> chgErr, chiDOF;</div>
<div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;      <span class="comment">// Initialize</span></div>
<div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a3918c9437701eb50d15bfc06d43e9194">Fit2D</a>(0, inPt, chgErr, outVec, outVecErr, chiDOF);</div>
<div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> cnt = 0;</div>
<div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size(); ++ii) {</div>
<div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;        <span class="keywordtype">short</span> ipt = hiPt + ii * <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>;</div>
<div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;        <span class="keywordflow">if</span>(ipt &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0] || ipt &gt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;        <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a>&amp; tp = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt];</div>
<div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;        <span class="keywordflow">if</span>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a> == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;        <span class="comment">// quit if the charge is much larger than the previous charge</span></div>
<div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;        <span class="keywordflow">if</span>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a> &gt; 1.5 * prevChg) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;        prevChg = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a>;</div>
<div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;        <span class="comment">// Accumulate and save points</span></div>
<div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;        inPt[0] = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] - wire0);</div>
<div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;        inPt[1] = tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a>;</div>
<div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;        <span class="comment">// Assume 20% point-to-point charge fluctuations</span></div>
<div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;        chgErr = 0.2 * tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">Chg</a>;</div>
<div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a3918c9437701eb50d15bfc06d43e9194">Fit2D</a>(2, inPt, chgErr, outVec, outVecErr, chiDOF)) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;        ++cnt;</div>
<div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;        <span class="keywordflow">if</span>(cnt == nPtsToCheck) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;      } <span class="comment">// ii</span></div>
<div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;      <span class="keywordflow">if</span>(cnt &lt; nPtsToCheck) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;      <span class="comment">// do the fit and get the results</span></div>
<div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a3918c9437701eb50d15bfc06d43e9194">Fit2D</a>(-1, inPt, chgErr, outVec, outVecErr, chiDOF)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;      <span class="comment">// check for really bad chidof indicating a major failure</span></div>
<div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;      <span class="keywordflow">if</span>(chiDOF &gt; 500) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;      <span class="comment">// The charge slope is negative for a stopping track in the way that the fit was constructed.</span></div>
<div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;      <span class="comment">// Flip the sign so we can make a cut against tcc.chkStopCuts[0] which is positive.</span></div>
<div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;      outVec[1] = -outVec[1];</div>
<div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;      <span class="keywordtype">bool</span> itStops = (outVec[1] &gt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a4d43e181bd45ffde8791bcf7e4d16d54">chkStopCuts</a>[0] &amp;&amp; chiDOF &lt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a4d43e181bd45ffde8791bcf7e4d16d54">chkStopCuts</a>[2] &amp;&amp; outVec[1] &gt; 2.5 * outVecErr[1]);</div>
<div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;      <span class="keywordflow">if</span>(itStops) {</div>
<div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;        tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afa6980f5646e419795cdc43499a55104">EndFlag</a>[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa0a4b8d8fc21482d4679f7eac8f457e70">kBragg</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;        tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da136e52e6a33b1735cb33e193b5321f15">kChkStop</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;        <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ab2c0db630cd45caff1c041d639c5f253">PDGCode</a> == 11) tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ab2c0db630cd45caff1c041d639c5f253">PDGCode</a> = 0;</div>
<div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;        <span class="comment">// Put the charge at the end into tp.AveChg</span></div>
<div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;        tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>]].AveChg = outVec[0];</div>
<div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;        <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; end &quot;</span>&lt;&lt;<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>&lt;&lt;<span class="stringliteral">&quot; fit chidof &quot;</span>&lt;&lt;chiDOF&lt;&lt;<span class="stringliteral">&quot; slope &quot;</span>&lt;&lt;outVec[1]&lt;&lt;<span class="stringliteral">&quot; +/- &quot;</span>&lt;&lt;outVecErr[1]&lt;&lt;<span class="stringliteral">&quot; stopping&quot;</span>;</div>
<div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;        <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; end &quot;</span>&lt;&lt;<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>&lt;&lt;<span class="stringliteral">&quot; fit chidof &quot;</span>&lt;&lt;chiDOF&lt;&lt;<span class="stringliteral">&quot; slope &quot;</span>&lt;&lt;outVec[1]&lt;&lt;<span class="stringliteral">&quot; +/- &quot;</span>&lt;&lt;outVecErr[1]&lt;&lt;<span class="stringliteral">&quot; Not stopping&quot;</span>;</div>
<div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;      }</div>
<div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;    } <span class="comment">// end</span></div>
<div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;</div>
<div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;  } <span class="comment">// ChkStop</span></div>
<div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;<span class="comment">  //////////////////////TY://////////////////////////</span></div>
<div class="line"><a name="l03809"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a40add002a2f38c42d76859b07b223b73"> 3809</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="../../de/d0f/namespacetca.html#a40add002a2f38c42d76859b07b223b73">ChkMichel</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a>&amp; tj, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>&amp; lastGoodPt){</div>
<div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;</div>
<div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da471c05830b1e9389ea0dd8dbf476cd45">kMichel</a>]) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;    <span class="keywordflow">if</span>(tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ab2c0db630cd45caff1c041d639c5f253">PDGCode</a> == 11 || tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#ab2c0db630cd45caff1c041d639c5f253">PDGCode</a> == 111) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;</div>
<div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;    <span class="keywordtype">bool</span> prt = (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">dbgStp</a> || <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ac24fc2006fb9fdcc2dc745608b6b0f5c">dbgAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da471c05830b1e9389ea0dd8dbf476cd45">kMichel</a>]);</div>
<div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;</div>
<div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;    <span class="comment">//find number of hits that are consistent with Michel electron</span></div>
<div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nmichelhits = 0;</div>
<div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;    <span class="comment">//find number of hits that are consistent with Bragg peak</span></div>
<div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nbragghits = 0;</div>
<div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;    <span class="keywordtype">float</span> lastChg = 0;</div>
<div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;</div>
<div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;    <span class="keywordtype">bool</span> isfirsthit = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> braggpeak = 0;</div>
<div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;</div>
<div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size(); ++ii) {</div>
<div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;      <span class="keywordflow">if</span> (ii&gt;tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] - ii;</div>
<div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;      <span class="keywordflow">if</span> (tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg&gt;0){</div>
<div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;        <span class="keywordflow">if</span> (isfirsthit){</div>
<div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;          isfirsthit = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;          <span class="keywordflow">if</span> (tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].ChgPull&lt;0){</div>
<div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;            ++nmichelhits;</div>
<div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;          }</div>
<div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;        }</div>
<div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;          <span class="keywordflow">if</span> (tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].ChgPull&lt;0&amp;&amp;nmichelhits&amp;&amp;!nbragghits){<span class="comment">//still Michel</span></div>
<div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;            ++nmichelhits;</div>
<div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;          }</div>
<div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;          <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;            <span class="keywordflow">if</span> (!nbragghits){</div>
<div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;              ++nbragghits; <span class="comment">//Last Bragg peak hit</span></div>
<div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;              lastChg  = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg;</div>
<div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;              braggpeak = ipt;</div>
<div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;            }</div>
<div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg&lt;lastChg){ <span class="comment">//still Bragg peak</span></div>
<div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;              ++nbragghits;</div>
<div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;              lastChg  = tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ipt].Chg;</div>
<div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;            }</div>
<div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;          }</div>
<div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;        }</div>
<div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;      }</div>
<div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;    }</div>
<div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;    <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;ChkMichel Michel hits: &quot;</span>&lt;&lt;nmichelhits&lt;&lt;<span class="stringliteral">&quot; Bragg peak hits: &quot;</span>&lt;&lt;nbragghits;</div>
<div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;    <span class="keywordflow">if</span> (nmichelhits&gt;0&amp;&amp;nbragghits&gt;2){<span class="comment">//find Michel topology</span></div>
<div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;      lastGoodPt = braggpeak;</div>
<div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;      tj.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da471c05830b1e9389ea0dd8dbf476cd45">kMichel</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;    }</div>
<div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;    }</div>
<div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;  }</div>
<div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;<span class="comment">  //////////////////////////////////////////</span></div>
<div class="line"><a name="l03866"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a267ebb747c095dafa701b815e61d5d01"> 3866</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="../../de/d0f/namespacetca.html#a267ebb747c095dafa701b815e61d5d01">MakeJunkTraj</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, std::vector&lt;unsigned int&gt; tHits)</div>
<div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;  {</div>
<div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da9b5200eaaed0e097cac019d6643e537e">kJunkTj</a>]) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;    <span class="comment">// Make a crummy trajectory using the provided hits</span></div>
<div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;</div>
<div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;    <span class="keywordflow">if</span>(tHits.size() &lt; 2) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;</div>
<div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;    <span class="keywordtype">bool</span> prt = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ac24fc2006fb9fdcc2dc745608b6b0f5c">dbgAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da9b5200eaaed0e097cac019d6643e537e">kJunkTj</a>]) {</div>
<div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tHits.size(); ++ii) {</div>
<div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;        <span class="keywordflow">if</span>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[tHits[ii]].allHitsIndex == <a class="code" href="../../de/d0f/namespacetca.html#ad232469b22f64d38891a7038f0e36ef3">debug</a>.<a class="code" href="../../d8/de4/structtca_1_1DebugStuff.html#a6ff5a38475d1ce288eadab16fd730357">Hit</a>) {</div>
<div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;          prt = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;        }</div>
<div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;      } <span class="comment">// ii</span></div>
<div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;      <span class="keywordflow">if</span>(prt) <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a>&lt;&lt;<span class="stringliteral">&quot;MakeJunkTraj found debug hit\n&quot;</span>;</div>
<div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;    } <span class="comment">// tcc.dbgAlg[kJunkTj]</span></div>
<div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;</div>
<div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;    <span class="comment">// Start the trajectory using the first and last hits to</span></div>
<div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;    <span class="comment">// define a starting direction. Use the last pass settings</span></div>
<div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;    <a class="code" href="../../d7/d46/structtca_1_1Trajectory.html">Trajectory</a> work;</div>
<div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> pass = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a8401e4d37fab8a440de704d2f7c3a9be">minPts</a>.size() - 1;</div>
<div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a1bf2f452f1300b504ec2531eae2dd854">StartTraj</a>(slc, work, tHits[0], tHits[tHits.size()-1], pass)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;    <span class="comment">// make a TP for every hit</span></div>
<div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;    work.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.resize(tHits.size());</div>
<div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;    <span class="comment">// and put a hit into each one</span></div>
<div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tHits.size(); ++ii) {</div>
<div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;      <span class="keyword">auto</span>&amp; tp = work.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[ii];</div>
<div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht = tHits[ii];</div>
<div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;      <span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>)[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].allHitsIndex];</div>
<div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;      tp.CTP = <a class="code" href="../../de/d0f/namespacetca.html#a8806e1c32119afbfe02dff4c21cf3e57">EncodeCTP</a>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.WireID());</div>
<div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;      <span class="keywordflow">if</span>(tp.CTP != work.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a9ba64d632bc17b16226d212f27dbc0aa">CTP</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;      tp.Hits.push_back(iht);</div>
<div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;      tp.UseHit[0] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;      <span class="comment">// don&#39;t use DefineHitPos here because the angle isn&#39;t really known yet. Just</span></div>
<div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;      <span class="comment">// define enough information to do a fit</span></div>
<div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;      tp.HitPos[0] = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.WireID().Wire;</div>
<div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;      tp.HitPos[1] = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.PeakTime() * <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a>;</div>
<div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;      tp.HitPosErr2 = 100;</div>
<div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;      tp.Chg = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.Integral();</div>
<div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;      tp.Step = ii;</div>
<div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;      tp.NTPsFit = tHits.size();</div>
<div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;      <span class="comment">// flag long-pulse hits</span></div>
<div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../de/d0f/namespacetca.html#ac13f24978c3ad09c4181c7d2628df67a">LongPulseHit</a>(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>)) tp.Environment[<a class="code" href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525a50b927fda7f9c083ec06574d2e57fc15">kEnvUnusedHits</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;    } <span class="comment">// ii</span></div>
<div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;    work.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[0] = 0;</div>
<div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;    work.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] = tHits.size() - 1;</div>
<div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;    <span class="comment">// do an initial fit. The fit results are put in the last TP.</span></div>
<div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#ab9b632aaa6a5285a60a3ac9d7bd1cfc0">FitTraj</a>(slc, work);</div>
<div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;    <span class="keyword">auto</span>&amp; lastTP = work.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.back();</div>
<div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;    <span class="comment">// Prepare to sort along the general direction. First find the</span></div>
<div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;    <span class="comment">// along and transverse position (Delta) of each TP and calculate DeltaRMS</span></div>
<div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;    <span class="keywordtype">double</span> sum = 0.;</div>
<div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;    <span class="keywordtype">double</span> sum2 = 0.;</div>
<div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; tp : work.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>) {</div>
<div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#acae6296d6fba718d82c34c88fefddf52">Point2_t</a> at;</div>
<div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a55899e64c6307177d1599f26a0a255a6">FindAlongTrans</a>(lastTP.Pos, lastTP.Dir, tp.HitPos, at);</div>
<div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;      sum += at[1];</div>
<div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;      sum2 += at[1] * at[1];</div>
<div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;      <span class="comment">// store the along distance in AveChg for now</span></div>
<div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;      tp.AveChg = at[0];</div>
<div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;      tp.Delta = at[1];</div>
<div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;      <span class="keywordflow">if</span>(tp.Step != lastTP.Step) {</div>
<div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;        tp.FitChi = lastTP.FitChi;</div>
<div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;        tp.Dir = lastTP.Dir;</div>
<div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;        tp.Ang = lastTP.Ang;</div>
<div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;        tp.Pos[0] = lastTP.Pos[0] + at[0] * lastTP.Dir[0];</div>
<div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;        tp.Pos[1] = lastTP.Pos[1] + at[0] * lastTP.Dir[1];</div>
<div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;      }</div>
<div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;    } <span class="comment">// tp</span></div>
<div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;    <span class="keywordtype">double</span> npts = tHits.size();</div>
<div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;    sum /= npts;</div>
<div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;    <span class="keywordtype">double</span> arg = sum2 - npts * sum * sum;</div>
<div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;    <span class="keywordflow">if</span>(arg &lt;= 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;    <span class="keywordtype">float</span> rms = sqrt(arg) / (npts - 1);</div>
<div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;    <span class="comment">// apply a loose Delta cut</span></div>
<div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;    <span class="keywordtype">float</span> transCut = sum + 3 * rms;</div>
<div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;    std::vector&lt;SortEntry&gt; sortVec;</div>
<div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;    <a class="code" href="../../db/d7d/structtca_1_1SortEntry.html">SortEntry</a> se;</div>
<div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;    work.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2f4d30c7f42c9fddd3add0b7b793b844">TotChg</a> = 0;</div>
<div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;    work.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f57aca44660b87327393e6a4694e570">NeedsUpdate</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; tp : work.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>) {</div>
<div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;      <span class="keywordflow">if</span>(tp.Delta &gt; transCut &amp;&amp; !tp.Environment[<a class="code" href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525a50b927fda7f9c083ec06574d2e57fc15">kEnvUnusedHits</a>]) {</div>
<div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;        work.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f57aca44660b87327393e6a4694e570">NeedsUpdate</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;      }</div>
<div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;      se.<a class="code" href="../../db/d7d/structtca_1_1SortEntry.html#a69837f74a6dc268fde50066fd818b886">index</a> = tp.Step;</div>
<div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;      se.<a class="code" href="../../db/d7d/structtca_1_1SortEntry.html#a3123e86741ba9a186788806f18c0dc1f">val</a> = tp.AveChg;</div>
<div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;      sortVec.push_back(se);</div>
<div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;      tp.DeltaRMS = rms;</div>
<div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;      work.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2f4d30c7f42c9fddd3add0b7b793b844">TotChg</a> += tp.Chg;</div>
<div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;    } <span class="comment">// tp</span></div>
<div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;    <span class="keywordflow">if</span>(sortVec.size() &lt; 3) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;    std::sort(sortVec.begin(), sortVec.end(), <a class="code" href="../../de/d78/Utils_8cxx.html#a5d68a4eb0beaca553c63e29989a63464">valsDecreasing</a>);</div>
<div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;    std::vector&lt;TrajPoint&gt; ntps(sortVec.size());</div>
<div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = 0; ipt &lt; sortVec.size(); ++ipt) ntps[ipt] = work.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>[sortVec[ipt].index];</div>
<div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;    work.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a> = ntps;</div>
<div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;    sum = work.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2f4d30c7f42c9fddd3add0b7b793b844">TotChg</a> / (<span class="keywordtype">double</span>)ntps.size();</div>
<div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;    <span class="keywordflow">if</span>(work.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a6f57aca44660b87327393e6a4694e570">NeedsUpdate</a>) {</div>
<div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;      work.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">EndPt</a>[1] = work.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">Pts</a>.size() - 1;</div>
<div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#af86f6315648e0dbb5e400f35ea97e72c">UpdateTraj</a>(slc, work);</div>
<div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;    } <span class="comment">// needs update</span></div>
<div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;    work.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da9b5200eaaed0e097cac019d6643e537e">kJunkTj</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;    work.<a class="code" href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">IsGood</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;    <span class="keywordflow">if</span>(prt) {</div>
<div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a5005f83120a22b0f059526653af3cb6f">PrintTrajectory</a>(<span class="stringliteral">&quot;MJT&quot;</span>, slc, work, USHRT_MAX);</div>
<div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;    }</div>
<div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;    <span class="comment">// Store it</span></div>
<div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d0f/namespacetca.html#a600e672c966d327de25fc13318997550">StoreTraj</a>(slc, work);</div>
<div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;  } <span class="comment">// MakeJunkTraj</span></div>
<div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;</div>
<div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;} <span class="comment">// namespace tca</span></div>
<div class="ttc" id="structtca_1_1TrajPoint_html_a8e72ed69cda2a420fdf9902dab27db11"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html#a8e72ed69cda2a420fdf9902dab27db11">tca::TrajPoint::UseHit</a></div><div class="ttdeci">std::bitset&lt; 16 &gt; UseHit</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00175">DataStructs.h:175</a></div></div>
<div class="ttc" id="namespacetca_html_acdd7ac022c72d9b8095ffa3bad46add7"><div class="ttname"><a href="../../de/d0f/namespacetca.html#acdd7ac022c72d9b8095ffa3bad46add7">tca::Forecast</a></div><div class="ttdeci">void Forecast(TCSlice &amp;slc, const Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l00434">StepUtils.cxx:434</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html_ac1da6ca699e616d576e3bf10c8752b3a"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">tca::TrajPoint::Dir</a></div><div class="ttdeci">Vector2_t Dir</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00158">DataStructs.h:158</a></div></div>
<div class="ttc" id="structtca_1_1Trajectory_html_afdb8e6dfd5aba49787dab959fea3ac2c"><div class="ttname"><a href="../../d7/d46/structtca_1_1Trajectory.html#afdb8e6dfd5aba49787dab959fea3ac2c">tca::Trajectory::AveChg</a></div><div class="ttdeci">float AveChg</div><div class="ttdoc">Calculated using ALL hits. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00199">DataStructs.h:199</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html_afde15bdbaf154402df2a0572aa425e72"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">tca::TrajPoint::Pos</a></div><div class="ttdeci">Point2_t Pos</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00157">DataStructs.h:157</a></div></div>
<div class="ttc" id="Utils_8cxx_html_a5d68a4eb0beaca553c63e29989a63464"><div class="ttname"><a href="../../de/d78/Utils_8cxx.html#a5d68a4eb0beaca553c63e29989a63464">valsDecreasing</a></div><div class="ttdeci">bool valsDecreasing(const SortEntry &amp;c1, const SortEntry &amp;c2)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l00038">Utils.cxx:38</a></div></div>
<div class="ttc" id="namespacetca_html_a712fa9841aa560d0298a3bd5fda51bb8"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a712fa9841aa560d0298a3bd5fda51bb8">tca::MCSMom</a></div><div class="ttdeci">short MCSMom(const TCSlice &amp;slc, const std::vector&lt; int &gt; &amp;tjIDs)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l03466">Utils.cxx:3466</a></div></div>
<div class="ttc" id="structtca_1_1VtxStore_html_a46b27eb885d550b65c1865b0dc679b5c"><div class="ttname"><a href="../../dc/d11/structtca_1_1VtxStore.html#a46b27eb885d550b65c1865b0dc679b5c">tca::VtxStore::PosErr</a></div><div class="ttdeci">Point2_t PosErr</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00076">DataStructs.h:76</a></div></div>
<div class="ttc" id="structtca_1_1ParFit_html_ac1072247a30ee4ce14d466cf32b709fb"><div class="ttname"><a href="../../d0/df5/structtca_1_1ParFit.html#ac1072247a30ee4ce14d466cf32b709fb">tca::ParFit::Par0</a></div><div class="ttdeci">float Par0</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00182">DataStructs.h:182</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_a60e2156629808a2e1178bd6cc1234c59"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tca::TCSlice::tjs</a></div><div class="ttdeci">std::vector&lt; Trajectory &gt; tjs</div><div class="ttdoc">vector of all trajectories in each plane </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00672">DataStructs.h:672</a></div></div>
<div class="ttc" id="namespacetca_html_afc867fb26ea8184ca8285f7f65822b0d"><div class="ttname"><a href="../../de/d0f/namespacetca.html#afc867fb26ea8184ca8285f7f65822b0d">tca::StepAway</a></div><div class="ttdeci">void StepAway(TCSlice &amp;slc, Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l00028">StepUtils.cxx:28</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5da053042a804ddb01bb1c883c882f05985"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da053042a804ddb01bb1c883c882f05985">tca::kMerge</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00451">DataStructs.h:451</a></div></div>
<div class="ttc" id="namespacetca_html_a61681325bce0b3240611ea1e274c4cc0"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a61681325bce0b3240611ea1e274c4cc0">tca::MaskedHitsOK</a></div><div class="ttdeci">bool MaskedHitsOK(TCSlice &amp;slc, Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l02422">StepUtils.cxx:2422</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5da107643f4f4d32743418793c9ca64b029"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da107643f4f4d32743418793c9ca64b029">tca::kFTBRvProp</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00479">DataStructs.h:479</a></div></div>
<div class="ttc" id="namespacetca_html_a13d61af27b215dd21f7819b5f8e5df91"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a13d61af27b215dd21f7819b5f8e5df91">tca::SetEndPoints</a></div><div class="ttdeci">void SetEndPoints(Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l03411">Utils.cxx:3411</a></div></div>
<div class="ttc" id="namespacetca_html_af86f6315648e0dbb5e400f35ea97e72c"><div class="ttname"><a href="../../de/d0f/namespacetca.html#af86f6315648e0dbb5e400f35ea97e72c">tca::UpdateTraj</a></div><div class="ttdeci">void UpdateTraj(TCSlice &amp;slc, Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l00667">StepUtils.cxx:667</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html_ac9596529b582dedfa7a6f9f6b24269d9"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html#ac9596529b582dedfa7a6f9f6b24269d9">tca::TrajPoint::AngErr</a></div><div class="ttdeci">double AngErr</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00162">DataStructs.h:162</a></div></div>
<div class="ttc" id="namespacetca_html_ad65fd0c31d447ba7b3731ae451ceb08f"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ad65fd0c31d447ba7b3731ae451ceb08f">tca::FitPar</a></div><div class="ttdeci">void FitPar(const TCSlice &amp;slc, const Trajectory &amp;tj, unsigned short originPt, unsigned short npts, short fitDir, ParFit &amp;pFit, unsigned short usePar)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l01217">Utils.cxx:1217</a></div></div>
<div class="ttc" id="namespacetca_html_aba6e9ff2e76ddbc58d971f61b9897ca8"><div class="ttname"><a href="../../de/d0f/namespacetca.html#aba6e9ff2e76ddbc58d971f61b9897ca8">tca::MakeVertexObsolete</a></div><div class="ttdeci">bool MakeVertexObsolete(std::string fcnLabel, TCSlice &amp;slc, VtxStore &amp;vx2, bool forceKill)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dfc/TCVertex_8cxx_source.html#l02740">TCVertex.cxx:2740</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_ab1be85fd32a002a93e0043ae152d1529"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#ab1be85fd32a002a93e0043ae152d1529">tca::TCConfig::kinkCuts</a></div><div class="ttdeci">std::vector&lt; float &gt; kinkCuts</div><div class="ttdoc">kink finder algorithm </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00561">DataStructs.h:561</a></div></div>
<div class="ttc" id="namespacetca_html_a5054f1164beee20fe31f778d536be6b8"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a5054f1164beee20fe31f778d536be6b8">tca::IsGhost</a></div><div class="ttdeci">bool IsGhost(TCSlice &amp;slc, Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l02863">StepUtils.cxx:2863</a></div></div>
<div class="ttc" id="structtca_1_1ParFit_html_a4dc41844d36f4314f83dc43b5994ce37"><div class="ttname"><a href="../../d0/df5/structtca_1_1ParFit.html#a4dc41844d36f4314f83dc43b5994ce37">tca::ParFit::ParSlpErr</a></div><div class="ttdeci">float ParSlpErr</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00186">DataStructs.h:186</a></div></div>
<div class="ttc" id="structtca_1_1VtxStore_html"><div class="ttname"><a href="../../dc/d11/structtca_1_1VtxStore.html">tca::VtxStore</a></div><div class="ttdoc">struct of temporary 2D vertices (end points) </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00074">DataStructs.h:74</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5da60d0eac61cfc2a727d60c0fe66522ef6"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da60d0eac61cfc2a727d60c0fe66522ef6">tca::kCHMEH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00456">DataStructs.h:456</a></div></div>
<div class="ttc" id="namespacetca_html_a74e10046f4ebc371418d3081bc237ba0"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a74e10046f4ebc371418d3081bc237ba0">tca::PutTrajHitsInVector</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; PutTrajHitsInVector(const Trajectory &amp;tj, HitStatus_t hitRequest)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l02752">Utils.cxx:2752</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html_a00fdf2d73e4a03e5a7f32411e460ba2e"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html#a00fdf2d73e4a03e5a7f32411e460ba2e">tca::TrajPoint::CTP</a></div><div class="ttdeci">CTP_t CTP</div><div class="ttdoc">Cryostat, TPC, Plane code. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00155">DataStructs.h:155</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a0e1b21e405c44f25011980f0130c5444"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a0e1b21e405c44f25011980f0130c5444">tca::TCConfig::maxPos0</a></div><div class="ttdeci">std::vector&lt; float &gt; maxPos0</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00574">DataStructs.h:574</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html_aea2d4519b320d42c3c7b6b8504fcf1f2"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html#aea2d4519b320d42c3c7b6b8504fcf1f2">tca::TrajPoint::NTPsFit</a></div><div class="ttdeci">unsigned short NTPsFit</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00171">DataStructs.h:171</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a986b7f09cec52728d16e43511d5c4e3f"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a986b7f09cec52728d16e43511d5c4e3f">tca::TCConfig::minPtsFit</a></div><div class="ttdeci">std::vector&lt; unsigned short &gt; minPtsFit</div><div class="ttdoc">Reconstruct in several passes. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00567">DataStructs.h:567</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5da949853468d9e1bc8907e7bd6aa1d3546"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da949853468d9e1bc8907e7bd6aa1d3546">tca::kFillGaps</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00457">DataStructs.h:457</a></div></div>
<div class="ttc" id="namespacetca_html_af522808f94ccf75807e228fad5f2b5dd"><div class="ttname"><a href="../../de/d0f/namespacetca.html#af522808f94ccf75807e228fad5f2b5dd">tca::SignalAtTp</a></div><div class="ttdeci">bool SignalAtTp(TrajPoint &amp;tp)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l02002">Utils.cxx:2002</a></div></div>
<div class="ttc" id="namespacetca_html_a8c30c9aeaab0a0b4f0f9d1f08fad6c6aad2a088fe0e3ebe65f881c0403c3f336f"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aad2a088fe0e3ebe65f881c0403c3f336f">tca::kAtTj</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00514">DataStructs.h:514</a></div></div>
<div class="ttc" id="namespacetca_html_a7daa44e56122119e4827fe39b2b30132"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a7daa44e56122119e4827fe39b2b30132">tca::FitVertex</a></div><div class="ttdeci">bool FitVertex(TCSlice &amp;slc, VtxStore &amp;vx, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dfc/TCVertex_8cxx_source.html#l01968">TCVertex.cxx:1968</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_aebf6b37bd33cbf3434810b788ebb7e82"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#aebf6b37bd33cbf3434810b788ebb7e82">tca::TCConfig::qualityCuts</a></div><div class="ttdeci">std::vector&lt; float &gt; qualityCuts</div><div class="ttdoc">Min points/wire, min consecutive pts after a gap. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00565">DataStructs.h:565</a></div></div>
<div class="ttc" id="namespacetca_html_a93d437bed41640ef1d53f01e465d1778"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a93d437bed41640ef1d53f01e465d1778">tca::SetPDGCode</a></div><div class="ttdeci">void SetPDGCode(TCSlice &amp;slc, unsigned short itj)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l04348">Utils.cxx:4348</a></div></div>
<div class="ttc" id="structtca_1_1SortEntry_html_a3123e86741ba9a186788806f18c0dc1f"><div class="ttname"><a href="../../db/d7d/structtca_1_1SortEntry.html#a3123e86741ba9a186788806f18c0dc1f">tca::SortEntry::val</a></div><div class="ttdeci">float val</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dfc/TCVertex_8cxx_source.html#l00029">TCVertex.cxx:29</a></div></div>
<div class="ttc" id="namespacetca_html_aa0294becb454d8cc7d38fe341641cfbf"><div class="ttname"><a href="../../de/d0f/namespacetca.html#aa0294becb454d8cc7d38fe341641cfbf">tca::AddHits</a></div><div class="ttdeci">void AddHits(TCSlice &amp;slc, Trajectory &amp;tj, unsigned short ipt, bool &amp;sigOK)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l01037">StepUtils.cxx:1037</a></div></div>
<div class="ttc" id="namespacechannelDBConverter_html_af481fa22253619167bce75a37e10ec34"><div class="ttname"><a href="../../d4/d43/namespacechannelDBConverter.html#af481fa22253619167bce75a37e10ec34">channelDBConverter.first</a></div><div class="ttdeci">first</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d11/channelDBConverter_8py_source.html#l00146">channelDBConverter.py:146</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html_a9e92d46c31e4d20aa67d180b7a60605e"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html#a9e92d46c31e4d20aa67d180b7a60605e">tca::TrajPoint::Ang</a></div><div class="ttdeci">double Ang</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00161">DataStructs.h:161</a></div></div>
<div class="ttc" id="namespacetca_html_a77e8e06b3f8b7cc168c473ad6c7de70a"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tca::tcc</a></div><div class="ttdeci">TCConfig tcc</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/DataStructs_8cxx_source.html#l00008">DataStructs.cxx:8</a></div></div>
<div class="ttc" id="larreco_2larreco_2RecoAlg_2TCAlg_2Utils_8h_html"><div class="ttname"><a href="../../db/d0a/larreco_2larreco_2RecoAlg_2TCAlg_2Utils_8h.html">Utils.h</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html_ab27d5353e9075152365d91cc0f0d0864"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html#ab27d5353e9075152365d91cc0f0d0864">tca::TrajPoint::Step</a></div><div class="ttdeci">unsigned short Step</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00172">DataStructs.h:172</a></div></div>
<div class="ttc" id="namespacetca_html_a4ed5c2d3946e0f39978a054fd92dc52fa7ed6e8ddaa0f5995df900e22acf5ecff"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a4ed5c2d3946e0f39978a054fd92dc52fa7ed6e8ddaa0f5995df900e22acf5ecff">tca::kFixed</a></div><div class="ttdoc">vertex position fixed manually - no fitting done </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00095">DataStructs.h:95</a></div></div>
<div class="ttc" id="Hit_8h_html"><div class="ttname"><a href="../../de/d26/Hit_8h.html">Hit.h</a></div><div class="ttdoc">Declaration of signal hit object. </div></div>
<div class="ttc" id="namespacetca_html_a55899e64c6307177d1599f26a0a255a6"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a55899e64c6307177d1599f26a0a255a6">tca::FindAlongTrans</a></div><div class="ttdeci">void FindAlongTrans(Point3_t pos1, Vector3_t dir1, Point3_t pos2, Point2_t &amp;alongTrans)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l03096">PFPUtils.cxx:3096</a></div></div>
<div class="ttc" id="namespacetca_html_a5005f83120a22b0f059526653af3cb6f"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a5005f83120a22b0f059526653af3cb6f">tca::PrintTrajectory</a></div><div class="ttdeci">void PrintTrajectory(std::string someText, const TCSlice &amp;slc, const Trajectory &amp;tj, unsigned short tPoint)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l06193">Utils.cxx:6193</a></div></div>
<div class="ttc" id="namespaceevd_html_a911fe581afad27a720ee200bd61362a6"><div class="ttname"><a href="../../da/d2d/namespaceevd.html#a911fe581afad27a720ee200bd61362a6">evd::err</a></div><div class="ttdeci">EResult err(const char *call)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2a/WebEVDServer_8cxx_source.html#l00138">WebEVDServer.cxx:138</a></div></div>
<div class="ttc" id="namespacetca_html_a1224974e5441b11c2d315fe5912feb75"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a1224974e5441b11c2d315fe5912feb75">tca::PrintTP</a></div><div class="ttdeci">void PrintTP(std::string someText, const TCSlice &amp;slc, unsigned short ipt, short dir, unsigned short pass, const TrajPoint &amp;tp)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l06294">Utils.cxx:6294</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_a95f7fcb13cb06c827c69fc2fd301f1c0"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#a95f7fcb13cb06c827c69fc2fd301f1c0">tca::TCSlice::wireHitRange</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; std::pair&lt; unsigned int, unsigned int &gt; &gt; &gt; wireHitRange</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00677">DataStructs.h:677</a></div></div>
<div class="ttc" id="namespacetca_html_ac86be2bdca680e7a5c4f920c3e6402bcaccee5a6ccf8ebbc0f2489279a8f09bb5"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bcaccee5a6ccf8ebbc0f2489279a8f09bb5">tca::kNormal</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00502">DataStructs.h:502</a></div></div>
<div class="ttc" id="structgeo_1_1PlaneID_html"><div class="ttname"><a href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a></div><div class="ttdoc">The data type to uniquely identify a Plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00472">geo_types.h:472</a></div></div>
<div class="ttc" id="RawTypes_8h_html"><div class="ttname"><a href="../../d9/d38/RawTypes_8h.html">RawTypes.h</a></div></div>
<div class="ttc" id="namespacetca_html_a20bf265ff689ff64027c4d072e7ed598"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a20bf265ff689ff64027c4d072e7ed598">tca::UnsetUsedHits</a></div><div class="ttdeci">void UnsetUsedHits(TCSlice &amp;slc, TrajPoint &amp;tp)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l01073">Utils.cxx:1073</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html_a5c8dad0af747f32e534848909cbd2a07"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html#a5c8dad0af747f32e534848909cbd2a07">tca::TrajPoint::Hits</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; Hits</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00174">DataStructs.h:174</a></div></div>
<div class="ttc" id="namespacetca_html_a70c266df69c86d3389a40a300c75903aa28cc702e4286591d02facc3f8f425a1c"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a70c266df69c86d3389a40a300c75903aa28cc702e4286591d02facc3f8f425a1c">tca::kStepDir</a></div><div class="ttdoc">step from US -&amp;gt; DS (true) or DS -&amp;gt; US (false) </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00533">DataStructs.h:533</a></div></div>
<div class="ttc" id="namespacetca_html_a9b6395dde0dd3420f47b066652eba8d7"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a9b6395dde0dd3420f47b066652eba8d7">tca::PrintEndFlag</a></div><div class="ttdeci">std::string PrintEndFlag(const PFPStruct &amp;pfp, unsigned short end)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l06461">Utils.cxx:6461</a></div></div>
<div class="ttc" id="namespacetca_html_a1dfe0638dfd5cd170a8740b585e9202d"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a1dfe0638dfd5cd170a8740b585e9202d">tca::StopShort</a></div><div class="ttdeci">bool StopShort(TCSlice &amp;slc, Trajectory &amp;tj, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l00277">StepUtils.cxx:277</a></div></div>
<div class="ttc" id="namespacetca_html_a48a06244eed9c28efa59c26d724ce296"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a48a06244eed9c28efa59c26d724ce296">tca::SetStrategy</a></div><div class="ttdeci">void SetStrategy(TCSlice &amp;slc, Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l00338">StepUtils.cxx:338</a></div></div>
<div class="ttc" id="namespacetca_html_a600e672c966d327de25fc13318997550"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a600e672c966d327de25fc13318997550">tca::StoreTraj</a></div><div class="ttdeci">bool StoreTraj(TCSlice &amp;slc, Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l01087">Utils.cxx:1087</a></div></div>
<div class="ttc" id="structtca_1_1Trajectory_html_a2f4d30c7f42c9fddd3add0b7b793b844"><div class="ttname"><a href="../../d7/d46/structtca_1_1Trajectory.html#a2f4d30c7f42c9fddd3add0b7b793b844">tca::Trajectory::TotChg</a></div><div class="ttdeci">float TotChg</div><div class="ttdoc">Total including an estimate for dead wires. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00200">DataStructs.h:200</a></div></div>
<div class="ttc" id="structtca_1_1Trajectory_html_ae12cc67e0b0a751842e9704ff5e109c9"><div class="ttname"><a href="../../d7/d46/structtca_1_1Trajectory.html#ae12cc67e0b0a751842e9704ff5e109c9">tca::Trajectory::MCSMom</a></div><div class="ttdeci">short MCSMom</div><div class="ttdoc">Normalized RMS using ALL hits. Assume it is 50% to start. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00202">DataStructs.h:202</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5dacb4caa0b9c5541c82a2031efb8c69281"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5dacb4caa0b9c5541c82a2031efb8c69281">tca::kChkStopEP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00477">DataStructs.h:477</a></div></div>
<div class="ttc" id="namespacetca_html_abfbdedb4c496fc0e84e7dec74bbb8a15"><div class="ttname"><a href="../../de/d0f/namespacetca.html#abfbdedb4c496fc0e84e7dec74bbb8a15">tca::FillGaps</a></div><div class="ttdeci">void FillGaps(TCSlice &amp;slc, Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l02031">StepUtils.cxx:2031</a></div></div>
<div class="ttc" id="namespacetca_html_ac61b8ecac1d09b0064ae810ed831af4b"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ac61b8ecac1d09b0064ae810ed831af4b">tca::HitTimeErr</a></div><div class="ttdeci">float HitTimeErr(const TCSlice &amp;slc, unsigned int iht)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l01542">StepUtils.cxx:1542</a></div></div>
<div class="ttc" id="structtca_1_1VtxStore_html_ac7796fc2887e9c19bd861ce1252b3806"><div class="ttname"><a href="../../dc/d11/structtca_1_1VtxStore.html#ac7796fc2887e9c19bd861ce1252b3806">tca::VtxStore::Pass</a></div><div class="ttdeci">unsigned short Pass</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00078">DataStructs.h:78</a></div></div>
<div class="ttc" id="structtca_1_1SortEntry_html_a69837f74a6dc268fde50066fd818b886"><div class="ttname"><a href="../../db/d7d/structtca_1_1SortEntry.html#a69837f74a6dc268fde50066fd818b886">tca::SortEntry::index</a></div><div class="ttdeci">unsigned int index</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dfc/TCVertex_8cxx_source.html#l00028">TCVertex.cxx:28</a></div></div>
<div class="ttc" id="namespacetca_html_a2d2429c036c14fad9706d51025642167"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a2d2429c036c14fad9706d51025642167">tca::ChkBegin</a></div><div class="ttdeci">void ChkBegin(TCSlice &amp;slc, Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l02672">StepUtils.cxx:2672</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_aac4b30d557f3cf516046494167515a75"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#aac4b30d557f3cf516046494167515a75">tca::TCConfig::maxWireSkipWithSignal</a></div><div class="ttdeci">float maxWireSkipWithSignal</div><div class="ttdoc">max number of wires to skip with a signal on them </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00584">DataStructs.h:584</a></div></div>
<div class="ttc" id="pmttriggerproducer_8fcl_html_a527d89be40c3c20ca8162df059180fd9"><div class="ttname"><a href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">max</a></div><div class="ttdeci">BEGIN_PROLOG pmt_uncoated ideal single PE test page of manual option are OR or AND window for pmt trigger time start window for pmt trigger time end etc then what events all hists are saved for max</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5a/pmttriggerproducer_8fcl_source.html#l00023">pmttriggerproducer.fcl:23</a></div></div>
<div class="ttc" id="namespacetca_html_ad2846a0d8353a032d65f633f7c2e0267"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">tca::PrintPos</a></div><div class="ttdeci">std::string PrintPos(const TCSlice &amp;slc, const TrajPoint &amp;tp)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l06524">Utils.cxx:6524</a></div></div>
<div class="ttc" id="namespacetca_html_a81a9901d72f5bcdc7ad45878bac54739"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a81a9901d72f5bcdc7ad45878bac54739">tca::FindUseHits</a></div><div class="ttdeci">void FindUseHits(TCSlice &amp;slc, Trajectory &amp;tj, unsigned short ipt, float maxDelta, bool useChg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l01755">StepUtils.cxx:1755</a></div></div>
<div class="ttc" id="namespacetca_html_a7c81814043da008fb13c8d80d022a203"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a7c81814043da008fb13c8d80d022a203">tca::ChkChgAsymmetry</a></div><div class="ttdeci">void ChkChgAsymmetry(TCSlice &amp;slc, Trajectory &amp;tj, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l01739">Utils.cxx:1739</a></div></div>
<div class="ttc" id="structtca_1_1ParFit_html"><div class="ttname"><a href="../../d0/df5/structtca_1_1ParFit.html">tca::ParFit</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00180">DataStructs.h:180</a></div></div>
<div class="ttc" id="namespacetca_html_a8fcdaae008c0c29ae4a6442344c306ee"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a8fcdaae008c0c29ae4a6442344c306ee">tca::ExpectedHitsRMS</a></div><div class="ttdeci">float ExpectedHitsRMS(TCSlice &amp;slc, const TrajPoint &amp;tp)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l01945">Utils.cxx:1945</a></div></div>
<div class="ttc" id="namespacetca_html_a4675b8edb6a3ac56f993afda9ccac525a6ed9c1ffc232022aa71db806f25ab10d"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525a6ed9c1ffc232022aa71db806f25ab10d">tca::kEnvNotGoodWire</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00522">DataStructs.h:522</a></div></div>
<div class="ttc" id="namespacetca_html_a4675b8edb6a3ac56f993afda9ccac525a9f1606595e43084041a6f31fe9ca35d7"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525a9f1606595e43084041a6f31fe9ca35d7">tca::kEnvNearShower</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00524">DataStructs.h:524</a></div></div>
<div class="ttc" id="namespacetca_html_a4675b8edb6a3ac56f993afda9ccac525a50b927fda7f9c083ec06574d2e57fc15"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525a50b927fda7f9c083ec06574d2e57fc15">tca::kEnvUnusedHits</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00526">DataStructs.h:526</a></div></div>
<div class="ttc" id="namespacetca_html_a147ffd18bc86e618807de788da237640"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a147ffd18bc86e618807de788da237640">tca::TrajPointSeparation</a></div><div class="ttdeci">float TrajPointSeparation(const TrajPoint &amp;tp1, const TrajPoint &amp;tp2)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l02678">Utils.cxx:2678</a></div></div>
<div class="ttc" id="namespacetca_html_adfeb5a1922b44080a785a41b47ef1fc7"><div class="ttname"><a href="../../de/d0f/namespacetca.html#adfeb5a1922b44080a785a41b47ef1fc7">tca::SetAngleCode</a></div><div class="ttdeci">void SetAngleCode(TrajPoint &amp;tp)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l00771">Utils.cxx:771</a></div></div>
<div class="ttc" id="namespacetca_html_a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa8a209073700148c7515fa38bae5e2873"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa8a209073700148c7515fa38bae5e2873">tca::kAtKink</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00511">DataStructs.h:511</a></div></div>
<div class="ttc" id="namespacetca_html_a267ebb747c095dafa701b815e61d5d01"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a267ebb747c095dafa701b815e61d5d01">tca::MakeJunkTraj</a></div><div class="ttdeci">bool MakeJunkTraj(TCSlice &amp;slc, std::vector&lt; unsigned int &gt; tHits)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l03866">StepUtils.cxx:3866</a></div></div>
<div class="ttc" id="namespacetca_html_a310add1134404b2b548a1a88f652cc04"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a310add1134404b2b548a1a88f652cc04">tca::PointTrajDOCA</a></div><div class="ttdeci">float PointTrajDOCA(const TCSlice &amp;slc, unsigned int iht, TrajPoint const &amp;tp)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l02570">Utils.cxx:2570</a></div></div>
<div class="ttc" id="namespacetca_html_a3817156934849ad2042f29fcd347c466"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a3817156934849ad2042f29fcd347c466">tca::DeltaAngle</a></div><div class="ttdeci">double DeltaAngle(const Vector3_t v1, const Vector3_t v2)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02539">PFPUtils.cxx:2539</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a13a021fd1f351b551124f4b7f8cef937"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a13a021fd1f351b551124f4b7f8cef937">tca::TCConfig::dbgSlc</a></div><div class="ttdeci">bool dbgSlc</div><div class="ttdoc">debug only in the user-defined slice? default is all slices </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00592">DataStructs.h:592</a></div></div>
<div class="ttc" id="namespacetca_html_a1bf2f452f1300b504ec2531eae2dd854"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a1bf2f452f1300b504ec2531eae2dd854">tca::StartTraj</a></div><div class="ttdeci">bool StartTraj(TCSlice &amp;slc, Trajectory &amp;tj, unsigned int fromhit, unsigned int tohit, unsigned short pass)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l04999">Utils.cxx:4999</a></div></div>
<div class="ttc" id="cheaterreco_8fcl_html_abf2e819dbf4c327e098bebd4b2dc0597"><div class="ttname"><a href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a></div><div class="ttdeci">process_name hit</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d36/cheaterreco_8fcl_source.html#l00051">cheaterreco.fcl:51</a></div></div>
<div class="ttc" id="namespacetca_html_a45477c64580773fdd4e4740ce58fa817"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a45477c64580773fdd4e4740ce58fa817">tca::MakeBareTrajPoint</a></div><div class="ttdeci">bool MakeBareTrajPoint(const TCSlice &amp;slc, unsigned int fromHit, unsigned int toHit, TrajPoint &amp;tp)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l04108">Utils.cxx:4108</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5da471c05830b1e9389ea0dd8dbf476cd45"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da471c05830b1e9389ea0dd8dbf476cd45">tca::kMichel</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00437">DataStructs.h:437</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_ada1d8593ee7a9de4e04ad01d7772126f"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#ada1d8593ee7a9de4e04ad01d7772126f">tca::TCSlice::lastWire</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; lastWire</div><div class="ttdoc">the last wire with a hit </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00657">DataStructs.h:657</a></div></div>
<div class="ttc" id="namespacetca_html_ac13f24978c3ad09c4181c7d2628df67a"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ac13f24978c3ad09c4181c7d2628df67a">tca::LongPulseHit</a></div><div class="ttdeci">bool LongPulseHit(const recob::Hit &amp;hit)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l04450">Utils.cxx:4450</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_a2aab614bb8eea5ec2b9a98b0202683dd"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#a2aab614bb8eea5ec2b9a98b0202683dd">tca::TCSlice::isValid</a></div><div class="ttdeci">bool isValid</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00685">DataStructs.h:685</a></div></div>
<div class="ttc" id="structtca_1_1Trajectory_html_a584728a5dcd6bab6b72fc7753c7c8830"><div class="ttname"><a href="../../d7/d46/structtca_1_1Trajectory.html#a584728a5dcd6bab6b72fc7753c7c8830">tca::Trajectory::IsGood</a></div><div class="ttdeci">bool IsGood</div><div class="ttdoc">set false if there is a failure or the Tj fails quality cuts </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00217">DataStructs.h:217</a></div></div>
<div class="ttc" id="namespacetca_html_afde5beaec544c29e198939b30817250e"><div class="ttname"><a href="../../de/d0f/namespacetca.html#afde5beaec544c29e198939b30817250e">tca::StoreVertex</a></div><div class="ttdeci">bool StoreVertex(TCSlice &amp;slc, VtxStore &amp;vx)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dfc/TCVertex_8cxx_source.html#l01932">TCVertex.cxx:1932</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_aa7618b0b19909f24d6f92e03793cb10f"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#aa7618b0b19909f24d6f92e03793cb10f">tca::TCConfig::doForecast</a></div><div class="ttdeci">bool doForecast</div><div class="ttdoc">See TCMode_t above. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00610">DataStructs.h:610</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5da136e52e6a33b1735cb33e193b5321f15"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da136e52e6a33b1735cb33e193b5321f15">tca::kChkStop</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00476">DataStructs.h:476</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_abd23e3a0f00daade6967bbfef88a6250"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#abd23e3a0f00daade6967bbfef88a6250">tca::TCConfig::maxChi</a></div><div class="ttdeci">float maxChi</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00577">DataStructs.h:577</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a63d3df2313cd07da049f636942fd878a"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a63d3df2313cd07da049f636942fd878a">tca::TCConfig::showerTag</a></div><div class="ttdeci">std::vector&lt; float &gt; showerTag</div><div class="ttdoc">shower-like trajectory tagging + shower reconstruction </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00560">DataStructs.h:560</a></div></div>
<div class="ttc" id="structtca_1_1Trajectory_html_a77b3a6b92ddd696b3dec9d7581f6503e"><div class="ttname"><a href="../../d7/d46/structtca_1_1Trajectory.html#a77b3a6b92ddd696b3dec9d7581f6503e">tca::Trajectory::Pass</a></div><div class="ttdeci">unsigned short Pass</div><div class="ttdoc">the pass on which it was created </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00211">DataStructs.h:211</a></div></div>
<div class="ttc" id="TCVertex_8h_html"><div class="ttname"><a href="../../d3/d65/TCVertex_8h.html">TCVertex.h</a></div></div>
<div class="ttc" id="namespaceraw_html_abcbf8ba50ca9efdbeb1a6955b040b4fe"><div class="ttname"><a href="../../d9/d63/namespaceraw.html#abcbf8ba50ca9efdbeb1a6955b040b4fe">raw::TDCtick_t</a></div><div class="ttdeci">int TDCtick_t</div><div class="ttdoc">Type representing a TDC tick. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d38/RawTypes_8h_source.html#l00025">RawTypes.h:25</a></div></div>
<div class="ttc" id="namespacetca_html_a28caa76204a2de8a70ff9188bff92987"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a28caa76204a2de8a70ff9188bff92987">tca::CreateTPFromTj</a></div><div class="ttdeci">TrajPoint CreateTPFromTj(TCSlice &amp;slc, const Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l03215">StepUtils.cxx:3215</a></div></div>
<div class="ttc" id="namespacetca_html_a785100ea9d154d7afa06c7092aaf1cd3af8476e403cd021d9242196cdcfb127a9"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3af8476e403cd021d9242196cdcfb127a9">tca::kAllHits</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d0a/larreco_2larreco_2RecoAlg_2TCAlg_2Utils_8h_source.html#l00041">larreco/larreco/RecoAlg/TCAlg/Utils.h:41</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a39c851105c2a3331e8f051ccdf86f49e"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a39c851105c2a3331e8f051ccdf86f49e">tca::TCConfig::maxAngleCode</a></div><div class="ttdeci">std::vector&lt; unsigned short &gt; maxAngleCode</div><div class="ttdoc">max allowed angle code for each pass </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00569">DataStructs.h:569</a></div></div>
<div class="ttc" id="namespacetca_html_ad84c94de9ebdd0a1ee32f162f72dd8be"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ad84c94de9ebdd0a1ee32f162f72dd8be">tca::OverlapFraction</a></div><div class="ttdeci">float OverlapFraction(const TCSlice &amp;slc, const Trajectory &amp;tj1, const Trajectory &amp;tj2)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l00711">Utils.cxx:711</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_abdc5eb0131ea44a8278193e04f488481"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#abdc5eb0131ea44a8278193e04f488481">tca::TCConfig::projectionErrFactor</a></div><div class="ttdeci">float projectionErrFactor</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00585">DataStructs.h:585</a></div></div>
<div class="ttc" id="structtca_1_1Trajectory_html_a0787c3db4bce3ad556211ba704897ab3"><div class="ttname"><a href="../../d7/d46/structtca_1_1Trajectory.html#a0787c3db4bce3ad556211ba704897ab3">tca::Trajectory::ChgRMS</a></div><div class="ttdeci">float ChgRMS</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00201">DataStructs.h:201</a></div></div>
<div class="ttc" id="namespacetca_html_a9f64129d7d33c42c405c8b33d07262de"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a9f64129d7d33c42c405c8b33d07262de">tca::HitsRMSTime</a></div><div class="ttdeci">float HitsRMSTime(const TCSlice &amp;slc, const std::vector&lt; unsigned int &gt; &amp;hitsInMultiplet, HitStatus_t hitRequest)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l04235">Utils.cxx:4235</a></div></div>
<div class="ttc" id="structtca_1_1DebugStuff_html_a6ff5a38475d1ce288eadab16fd730357"><div class="ttname"><a href="../../d8/de4/structtca_1_1DebugStuff.html#a6ff5a38475d1ce288eadab16fd730357">tca::DebugStuff::Hit</a></div><div class="ttdeci">unsigned int Hit</div><div class="ttdoc">set to the hit index in evt.allHits if a Plane:Wire:Tick match is found </div><div class="ttdef"><b>Definition:</b> <a href="../../da/db2/DebugStruct_8h_source.html#l00026">DebugStruct.h:26</a></div></div>
<div class="ttc" id="namespacetca_html_a7e9b0ec64528b2a3cdc8b39d3346d4ce"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a7e9b0ec64528b2a3cdc8b39d3346d4ce">tca::CompatibleMerge</a></div><div class="ttdeci">bool CompatibleMerge(const TCSlice &amp;slc, std::vector&lt; int &gt; &amp;tjIDs, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l00578">Utils.cxx:578</a></div></div>
<div class="ttc" id="sparse__vector__test_8cc_html_a39f16bf854ba527dee7eba5bbbd93f3f"><div class="ttname"><a href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a></div><div class="ttdeci">T abs(T value)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d59/sparse__vector__test_8cc_source.html#l00030">sparse_vector_test.cc:30</a></div></div>
<div class="ttc" id="namespacetca_html_af74e4c6958ff843062a35c3e14420822"><div class="ttname"><a href="../../de/d0f/namespacetca.html#af74e4c6958ff843062a35c3e14420822">tca::StrategyBitNames</a></div><div class="ttdeci">const std::vector&lt; std::string &gt; StrategyBitNames</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/DataStructs_8cxx_source.html#l00108">DataStructs.cxx:108</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html_a011749db067df79503a159672ada3c4d"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html#a011749db067df79503a159672ada3c4d">tca::TrajPoint::Delta</a></div><div class="ttdeci">float Delta</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00167">DataStructs.h:167</a></div></div>
<div class="ttc" id="namespacetca_html_ab6624f8a02ac76e7a9867b3e0024d7e0"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ab6624f8a02ac76e7a9867b3e0024d7e0">tca::HitsTimeErr2</a></div><div class="ttdeci">float HitsTimeErr2(const TCSlice &amp;slc, const std::vector&lt; unsigned int &gt; &amp;hitVec)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l01550">StepUtils.cxx:1550</a></div></div>
<div class="ttc" id="namespacetca_html_abaa1e009ae37b34b0d8720c2f21389db"><div class="ttname"><a href="../../de/d0f/namespacetca.html#abaa1e009ae37b34b0d8720c2f21389db">tca::HitsRMSTick</a></div><div class="ttdeci">float HitsRMSTick(const TCSlice &amp;slc, const std::vector&lt; unsigned int &gt; &amp;hitsInMultiplet, HitStatus_t hitRequest)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l04244">Utils.cxx:4244</a></div></div>
<div class="ttc" id="structtca_1_1TCEvent_html_ae1a29531c613e9b8c7b5ada6e81e6eb4"><div class="ttname"><a href="../../d0/d2f/structtca_1_1TCEvent.html#ae1a29531c613e9b8c7b5ada6e81e6eb4">tca::TCEvent::WorkID</a></div><div class="ttdeci">int WorkID</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00642">DataStructs.h:642</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5da86e7c73e8ff0192c702f778833aa604f"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da86e7c73e8ff0192c702f778833aa604f">tca::kMaskBadTPs</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00436">DataStructs.h:436</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a5858e11357974d2650a733ef9ac8b4c6"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a5858e11357974d2650a733ef9ac8b4c6">tca::TCConfig::dbgStp</a></div><div class="ttdeci">bool dbgStp</div><div class="ttdoc">debug stepping using debug.Cryostat, debug.TPC, etc </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00593">DataStructs.h:593</a></div></div>
<div class="ttc" id="namespacetca_html_acae6296d6fba718d82c34c88fefddf52"><div class="ttname"><a href="../../de/d0f/namespacetca.html#acae6296d6fba718d82c34c88fefddf52">tca::Point2_t</a></div><div class="ttdeci">std::array&lt; float, 2 &gt; Point2_t</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00045">DataStructs.h:45</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_afabba7c8b331f67ab8698bdb154b6f3c"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#afabba7c8b331f67ab8698bdb154b6f3c">tca::TCConfig::maxPos1</a></div><div class="ttdeci">std::vector&lt; float &gt; maxPos1</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00575">DataStructs.h:575</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_abcf147480fa8a9733489751d15046d72"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">tca::TCConfig::unitsPerTick</a></div><div class="ttdeci">float unitsPerTick</div><div class="ttdoc">scale factor from Tick to WSE equivalent units </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00573">DataStructs.h:573</a></div></div>
<div class="ttc" id="namespacetca_html_ac86be2bdca680e7a5c4f920c3e6402bcaea92f268de1c89bd1bdcf4913ca4f84d"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bcaea92f268de1c89bd1bdcf4913ca4f84d">tca::kSlowing</a></div><div class="ttdoc">use the slowing-down strategy </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00505">DataStructs.h:505</a></div></div>
<div class="ttc" id="namespacetca_html_a79af94508e47e7adb55c7c50401ef4cb"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a79af94508e47e7adb55c7c50401ef4cb">tca::TrajIsClean</a></div><div class="ttdeci">bool TrajIsClean(TCSlice &amp;slc, Trajectory &amp;tj, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l03440">Utils.cxx:3440</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_ad1829cb796ab00695cd51a6dedc57f71"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#ad1829cb796ab00695cd51a6dedc57f71">tca::TCConfig::minMCSMom</a></div><div class="ttdeci">std::vector&lt; short &gt; minMCSMom</div><div class="ttdoc">Min MCSMom for each pass. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00570">DataStructs.h:570</a></div></div>
<div class="ttc" id="namespacetca_html_a757156ec709046f601b18c87c62742f8"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a757156ec709046f601b18c87c62742f8">tca::DeadWireCount</a></div><div class="ttdeci">float DeadWireCount(const TCSlice &amp;slc, const TrajPoint &amp;tp1, const TrajPoint &amp;tp2)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l02139">Utils.cxx:2139</a></div></div>
<div class="ttc" id="namespacetca_html_adcfb1da7e005bcdbdd61dc5baf815be1"><div class="ttname"><a href="../../de/d0f/namespacetca.html#adcfb1da7e005bcdbdd61dc5baf815be1">tca::DefineHitPos</a></div><div class="ttdeci">void DefineHitPos(TCSlice &amp;slc, TrajPoint &amp;tp)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l01670">StepUtils.cxx:1670</a></div></div>
<div class="ttc" id="namespacetca_html_ad232469b22f64d38891a7038f0e36ef3"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ad232469b22f64d38891a7038f0e36ef3">tca::debug</a></div><div class="ttdeci">DebugStuff debug</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/da6/DebugStruct_8cxx_source.html#l00004">DebugStruct.cxx:4</a></div></div>
<div class="ttc" id="namespacetca_html_a4675b8edb6a3ac56f993afda9ccac525a0d1d499b20081267ac554e515103dbe7"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525a0d1d499b20081267ac554e515103dbe7">tca::kEnvNearSrcHit</a></div><div class="ttdoc">TP is near a hit in the srcHit collection but no allHit hit exists (DUNE disambiguation error) ...</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00527">DataStructs.h:527</a></div></div>
<div class="ttc" id="structtca_1_1Trajectory_html_a9ba64d632bc17b16226d212f27dbc0aa"><div class="ttname"><a href="../../d7/d46/structtca_1_1Trajectory.html#a9ba64d632bc17b16226d212f27dbc0aa">tca::Trajectory::CTP</a></div><div class="ttdeci">CTP_t CTP</div><div class="ttdoc">Cryostat, TPC, Plane code. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00194">DataStructs.h:194</a></div></div>
<div class="ttc" id="namespacetca_html_ad1a2f70a1aa9b22bde034deaaef480a6"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ad1a2f70a1aa9b22bde034deaaef480a6">tca::CheckStiffEl</a></div><div class="ttdeci">void CheckStiffEl(TCSlice &amp;slc, Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l00914">StepUtils.cxx:914</a></div></div>
<div class="ttc" id="namespacetca_html_a956ff1118d924911210bace923717e57"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a956ff1118d924911210bace923717e57">tca::GetHitMultiplet</a></div><div class="ttdeci">void GetHitMultiplet(const TCSlice &amp;slc, unsigned int theHit, std::vector&lt; unsigned int &gt; &amp;hitsInMultiplet, bool useLongPulseHits)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l01413">StepUtils.cxx:1413</a></div></div>
<div class="ttc" id="structtca_1_1TCEvent_html_ab14e445cc20674094b37b35830d15fc0"><div class="ttname"><a href="../../d0/d2f/structtca_1_1TCEvent.html#ab14e445cc20674094b37b35830d15fc0">tca::TCEvent::aveHitRMS</a></div><div class="ttdeci">std::vector&lt; float &gt; aveHitRMS</div><div class="ttdoc">average RMS of an isolated hit </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00640">DataStructs.h:640</a></div></div>
<div class="ttc" id="structtca_1_1Trajectory_html_a2af7e7e31387e3cfe705e096782b892e"><div class="ttname"><a href="../../d7/d46/structtca_1_1Trajectory.html#a2af7e7e31387e3cfe705e096782b892e">tca::Trajectory::Pts</a></div><div class="ttdeci">std::vector&lt; TrajPoint &gt; Pts</div><div class="ttdoc">Trajectory points. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00193">DataStructs.h:193</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5dad63ad8e4f9eaaaa45309076c0c63725d"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5dad63ad8e4f9eaaaa45309076c0c63725d">tca::kLastEndMerge</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00452">DataStructs.h:452</a></div></div>
<div class="ttc" id="namespacetca_html_a6f2f34a55fc01dbc6f34b6f8dfa958b1"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a6f2f34a55fc01dbc6f34b6f8dfa958b1">tca::KinkSignificance</a></div><div class="ttdeci">float KinkSignificance(TCSlice &amp;slc, Trajectory &amp;tj1, unsigned short end1, Trajectory &amp;tj2, unsigned short end2, unsigned short nPtsFit, bool useChg, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l03054">Utils.cxx:3054</a></div></div>
<div class="ttc" id="structtca_1_1TCEvent_html_a08d6f9aad54acbd12cfcc44e77e6e29d"><div class="ttname"><a href="../../d0/d2f/structtca_1_1TCEvent.html#a08d6f9aad54acbd12cfcc44e77e6e29d">tca::TCEvent::goodWire</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; bool &gt; &gt; goodWire</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00632">DataStructs.h:632</a></div></div>
<div class="ttc" id="namespacetca_html_a91b05db73ba97c302cb3368ec72b1dc8"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a91b05db73ba97c302cb3368ec72b1dc8">tca::ChgFracNearPos</a></div><div class="ttdeci">float ChgFracNearPos(const TCSlice &amp;slc, const Point2_t &amp;pos, const std::vector&lt; int &gt; &amp;tjIDs)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l03234">Utils.cxx:3234</a></div></div>
<div class="ttc" id="namespacetca_html_a519cf8a3170ec63e0b4d457f1d236109"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a519cf8a3170ec63e0b4d457f1d236109">tca::FindCloseHits</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; FindCloseHits(const TCSlice &amp;slc, std::array&lt; int, 2 &gt; const &amp;wireWindow, Point2_t const &amp;timeWindow, const unsigned short plane, HitStatus_t hitRequest, bool usePeakTime, bool &amp;hitsNear)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l02841">Utils.cxx:2841</a></div></div>
<div class="ttc" id="namespaceicarus_1_1ns_1_1util_html_aac918da84f16d53ad17bab4f817da1c4"><div class="ttname"><a href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">icarus::ns::util::end</a></div><div class="ttdeci">auto end(FixedBins&lt; T, C &gt; const &amp;) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dbd/FixedBins_8h_source.html#l00585">FixedBins.h:585</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_ad94c65623983dd14ecee8a4166c6e582"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#ad94c65623983dd14ecee8a4166c6e582">tca::TCSlice::vtxs</a></div><div class="ttdeci">std::vector&lt; VtxStore &gt; vtxs</div><div class="ttdoc">2D vertices </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00678">DataStructs.h:678</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5dabea8d0fedf7ef540d0f6947b32b90c45"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5dabea8d0fedf7ef540d0f6947b32b90c45">tca::kStopShort</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00495">DataStructs.h:495</a></div></div>
<div class="ttc" id="structtca_1_1Trajectory_html_a92f8570fe0ac368483f3ab38f0a8afb0"><div class="ttname"><a href="../../d7/d46/structtca_1_1Trajectory.html#a92f8570fe0ac368483f3ab38f0a8afb0">tca::Trajectory::EndPt</a></div><div class="ttdeci">std::array&lt; unsigned short, 2 &gt; EndPt</div><div class="ttdoc">First and last point in the trajectory that has charge. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00205">DataStructs.h:205</a></div></div>
<div class="ttc" id="structtca_1_1Trajectory_html_ab2c0db630cd45caff1c041d639c5f253"><div class="ttname"><a href="../../d7/d46/structtca_1_1Trajectory.html#ab2c0db630cd45caff1c041d639c5f253">tca::Trajectory::PDGCode</a></div><div class="ttdeci">unsigned short PDGCode</div><div class="ttdoc">shower-like or track-like {default is track-like} </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00210">DataStructs.h:210</a></div></div>
<div class="ttc" id="namespacetca_html_a785100ea9d154d7afa06c7092aaf1cd3a592a31ca0b683aeb15197694a71bd108"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3a592a31ca0b683aeb15197694a71bd108">tca::kUsedHits</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d0a/larreco_2larreco_2RecoAlg_2TCAlg_2Utils_8h_source.html#l00042">larreco/larreco/RecoAlg/TCAlg/Utils.h:42</a></div></div>
<div class="ttc" id="namespacetca_html_ae881fd705033f5c99a495a09a6bb5e95"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ae881fd705033f5c99a495a09a6bb5e95">tca::TagJunkTj</a></div><div class="ttdeci">void TagJunkTj(TCSlice &amp;slc, Trajectory &amp;tj, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l02780">Utils.cxx:2780</a></div></div>
<div class="ttc" id="structtca_1_1Trajectory_html_abca1a7f1413e9b9e5d6fedb638047cda"><div class="ttname"><a href="../../d7/d46/structtca_1_1Trajectory.html#abca1a7f1413e9b9e5d6fedb638047cda">tca::Trajectory::MaskedLastTP</a></div><div class="ttdeci">bool MaskedLastTP</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00218">DataStructs.h:218</a></div></div>
<div class="ttc" id="structtca_1_1Trajectory_html_a9ed855e5b1c03ac9ec9c6aa09ea91105"><div class="ttname"><a href="../../d7/d46/structtca_1_1Trajectory.html#a9ed855e5b1c03ac9ec9c6aa09ea91105">tca::Trajectory::StartEnd</a></div><div class="ttdeci">short StartEnd</div><div class="ttdoc">The starting end (-1 = don&amp;#39;t know) </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00213">DataStructs.h:213</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html_ad22d5c25ee2eaec3570a53dca0b88861"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html#ad22d5c25ee2eaec3570a53dca0b88861">tca::TrajPoint::Chg</a></div><div class="ttdeci">float Chg</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00164">DataStructs.h:164</a></div></div>
<div class="ttc" id="namespacetca_html_a1c2bea68a634d09340f7921072d5acda"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a1c2bea68a634d09340f7921072d5acda">tca::PosSep2</a></div><div class="ttdeci">double PosSep2(const Point3_t &amp;pos1, const Point3_t &amp;pos2)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02571">PFPUtils.cxx:2571</a></div></div>
<div class="ttc" id="namespacetca_html_ab9b632aaa6a5285a60a3ac9d7bd1cfc0"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ab9b632aaa6a5285a60a3ac9d7bd1cfc0">tca::FitTraj</a></div><div class="ttdeci">void FitTraj(TCSlice &amp;slc, Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l00806">Utils.cxx:806</a></div></div>
<div class="ttc" id="namespacetca_html_a6f0a1df60836abcb51565bc85c828f18"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a6f0a1df60836abcb51565bc85c828f18">tca::PrintHit</a></div><div class="ttdeci">std::string PrintHit(const TCHit &amp;tch)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l06514">Utils.cxx:6514</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5dae8a519a9179f8581a54a31a230504e2c"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5dae8a519a9179f8581a54a31a230504e2c">tca::kCHMUH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00441">DataStructs.h:441</a></div></div>
<div class="ttc" id="structtca_1_1VtxStore_html_ae27909f659aa38cca8617e6632e3c70e"><div class="ttname"><a href="../../dc/d11/structtca_1_1VtxStore.html#ae27909f659aa38cca8617e6632e3c70e">tca::VtxStore::Pos</a></div><div class="ttdeci">Point2_t Pos</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00075">DataStructs.h:75</a></div></div>
<div class="ttc" id="structtca_1_1VtxStore_html_aa2b60fc467a0abb4bb4202da0a603106"><div class="ttname"><a href="../../dc/d11/structtca_1_1VtxStore.html#aa2b60fc467a0abb4bb4202da0a603106">tca::VtxStore::CTP</a></div><div class="ttdeci">CTP_t CTP</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00084">DataStructs.h:84</a></div></div>
<div class="ttc" id="namespacetca_html_a3918c9437701eb50d15bfc06d43e9194"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a3918c9437701eb50d15bfc06d43e9194">tca::Fit2D</a></div><div class="ttdeci">bool Fit2D(short mode, Point2_t inPt, float &amp;inPtErr, Vector2_t &amp;outVec, Vector2_t &amp;outVecErr, float &amp;chiDOF)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l05127">Utils.cxx:5127</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a8401e4d37fab8a440de704d2f7c3a9be"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a8401e4d37fab8a440de704d2f7c3a9be">tca::TCConfig::minPts</a></div><div class="ttdeci">std::vector&lt; unsigned short &gt; minPts</div><div class="ttdoc">min number of Pts required to make a trajectory </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00568">DataStructs.h:568</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a903d0579491b91696fa8ab2f5b5eb6b3"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a903d0579491b91696fa8ab2f5b5eb6b3">tca::TCConfig::hitErrFac</a></div><div class="ttdeci">float hitErrFac</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00582">DataStructs.h:582</a></div></div>
<div class="ttc" id="structgeo_1_1PlaneID_html_a02c2afa6841ef86ea8ab49478cdf5b29"><div class="ttname"><a href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">geo::PlaneID::Plane</a></div><div class="ttdeci">PlaneID_t Plane</div><div class="ttdoc">Index of the plane within its TPC. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00493">geo_types.h:493</a></div></div>
<div class="ttc" id="namespacetca_html_ac6639cff50e581a8ce6ebdb2d8a41f03"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ac6639cff50e581a8ce6ebdb2d8a41f03">tca::FixBegin</a></div><div class="ttdeci">void FixBegin(TCSlice &amp;slc, Trajectory &amp;tj, unsigned short atPt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l02795">StepUtils.cxx:2795</a></div></div>
<div class="ttc" id="namespacetca_html_aca0bf062221b71f6317cf149fb53e0c3"><div class="ttname"><a href="../../de/d0f/namespacetca.html#aca0bf062221b71f6317cf149fb53e0c3">tca::Vector2_t</a></div><div class="ttdeci">std::array&lt; double, 2 &gt; Vector2_t</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00046">DataStructs.h:46</a></div></div>
<div class="ttc" id="geo__types_8h_html"><div class="ttname"><a href="../../d8/d48/geo__types_8h.html">geo_types.h</a></div><div class="ttdoc">Definition of data types for geometry description. </div></div>
<div class="ttc" id="namespacetca_html_aeaedd29af9a4f572ed7fcb21e0337949"><div class="ttname"><a href="../../de/d0f/namespacetca.html#aeaedd29af9a4f572ed7fcb21e0337949">tca::ReverseTraj</a></div><div class="ttdeci">void ReverseTraj(TCSlice &amp;slc, Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l03292">Utils.cxx:3292</a></div></div>
<div class="ttc" id="namespacetca_html_a6b4cf44fa6814acfdf94b7cfba17c131"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a6b4cf44fa6814acfdf94b7cfba17c131">tca::NumHitsInTP</a></div><div class="ttdeci">unsigned short NumHitsInTP(const TrajPoint &amp;tp, HitStatus_t hitRequest)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l04326">Utils.cxx:4326</a></div></div>
<div class="ttc" id="namespacetca_html_a1638b2155753b89b5b7f719446b6f5c8"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a1638b2155753b89b5b7f719446b6f5c8">tca::TrimEndPts</a></div><div class="ttdeci">void TrimEndPts(std::string fcnLabel, TCSlice &amp;slc, Trajectory &amp;tj, const std::vector&lt; float &gt; &amp;fQualityCuts, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l01598">Utils.cxx:1598</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_afcd03730c21830b602fedb556ac43a16"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#afcd03730c21830b602fedb556ac43a16">tca::TCSlice::firstWire</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; firstWire</div><div class="ttdoc">the first wire with a hit </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00656">DataStructs.h:656</a></div></div>
<div class="ttc" id="structtca_1_1ParFit_html_abf9afd041123dbaa76614a40759c2f23"><div class="ttname"><a href="../../d0/df5/structtca_1_1ParFit.html#abf9afd041123dbaa76614a40759c2f23">tca::ParFit::ChiDOF</a></div><div class="ttdeci">float ChiDOF</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00187">DataStructs.h:187</a></div></div>
<div class="ttc" id="structtca_1_1Trajectory_html_a6f62eb6daf29b2d9bcb77be8e0ca1c6f"><div class="ttname"><a href="../../d7/d46/structtca_1_1Trajectory.html#a6f62eb6daf29b2d9bcb77be8e0ca1c6f">tca::Trajectory::ID</a></div><div class="ttdeci">int ID</div><div class="ttdoc">ID that is local to one slice. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00207">DataStructs.h:207</a></div></div>
<div class="ttc" id="namespacetca_html_a0898183aa6813a6ab2cbaede7d31e4d1"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a0898183aa6813a6ab2cbaede7d31e4d1">tca::slices</a></div><div class="ttdeci">std::vector&lt; TCSlice &gt; slices</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/DataStructs_8cxx_source.html#l00012">DataStructs.cxx:12</a></div></div>
<div class="ttc" id="structtca_1_1Trajectory_html_a8b51a3dcef1b96ea2884335cd65a57a4"><div class="ttname"><a href="../../d7/d46/structtca_1_1Trajectory.html#a8b51a3dcef1b96ea2884335cd65a57a4">tca::Trajectory::VtxID</a></div><div class="ttdeci">std::array&lt; unsigned short, 2 &gt; VtxID</div><div class="ttdoc">ID of 2D vertex. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00204">DataStructs.h:204</a></div></div>
<div class="ttc" id="namespacetca_html_ad1e1ad01401a053abc7b63d5c33390a5"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ad1e1ad01401a053abc7b63d5c33390a5">tca::UpdateStiffEl</a></div><div class="ttdeci">void UpdateStiffEl(TCSlice &amp;slc, Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l00646">StepUtils.cxx:646</a></div></div>
<div class="ttc" id="namespacetca_html_a50c2901dd2e4719ff3c853d0340a35b1"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a50c2901dd2e4719ff3c853d0340a35b1">tca::ChkStop</a></div><div class="ttdeci">void ChkStop(TCSlice &amp;slc, Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l03703">StepUtils.cxx:3703</a></div></div>
<div class="ttc" id="namespacetca_html_a45584aa4b4e3ca2963ed52c7e5a28ff8"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a45584aa4b4e3ca2963ed52c7e5a28ff8">tca::UpdateTjChgProperties</a></div><div class="ttdeci">void UpdateTjChgProperties(std::string inFcnLabel, TCSlice &amp;slc, Trajectory &amp;tj, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l03671">Utils.cxx:3671</a></div></div>
<div class="ttc" id="namespacedropbox_html_a407b5b895ba9265893768748aaa73825"><div class="ttname"><a href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dropbox.dir</a></div><div class="ttdeci">tuple dir</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d81/dropbox_8py_source.html#l00028">dropbox.py:28</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a2a72c7c94d8a7b0114b5183a4041ce1f"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a2a72c7c94d8a7b0114b5183a4041ce1f">tca::TCConfig::modes</a></div><div class="ttdeci">std::bitset&lt; 16 &gt; modes</div><div class="ttdoc">number of points to find AveChg </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00609">DataStructs.h:609</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_ad3fb3131fc35af76d6086bc9eca8428c"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">tca::TCSlice::slHits</a></div><div class="ttdeci">std::vector&lt; TCHit &gt; slHits</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00671">DataStructs.h:671</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a3a55337e6b54dd9a9e29ab70da5cd760"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a3a55337e6b54dd9a9e29ab70da5cd760">tca::TCConfig::chargeCuts</a></div><div class="ttdeci">std::vector&lt; float &gt; chargeCuts</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00564">DataStructs.h:564</a></div></div>
<div class="ttc" id="namespacetca_html_ac89b171f7383a83708fa8244202b0bab"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ac89b171f7383a83708fa8244202b0bab">tca::StopIfBadFits</a></div><div class="ttdeci">bool StopIfBadFits(TCSlice &amp;slc, Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l02527">StepUtils.cxx:2527</a></div></div>
<div class="ttc" id="namespacetca_html_ada8c9eaa4e7457bd2a3ffe30bdc5132f"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ada8c9eaa4e7457bd2a3ffe30bdc5132f">tca::MergeAndStore</a></div><div class="ttdeci">bool MergeAndStore(TCSlice &amp;slc, unsigned int itj1, unsigned int itj2, bool doPrt)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l04662">Utils.cxx:4662</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da5088de893a91ba72a52b33991cef330d">tca::kRvPrp</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00440">DataStructs.h:440</a></div></div>
<div class="ttc" id="namespacetca_html_aa053fbd4d7f33f815c630ab60ddc186c"><div class="ttname"><a href="../../de/d0f/namespacetca.html#aa053fbd4d7f33f815c630ab60ddc186c">tca::MaskBadTPs</a></div><div class="ttdeci">void MaskBadTPs(TCSlice &amp;slc, Trajectory &amp;tj, float const &amp;maxChi)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l02377">StepUtils.cxx:2377</a></div></div>
<div class="ttc" id="structtca_1_1VtxStore_html_a4fcebc08d6a2220c28b5a209063f1ba4"><div class="ttname"><a href="../../dc/d11/structtca_1_1VtxStore.html#a4fcebc08d6a2220c28b5a209063f1ba4">tca::VtxStore::Stat</a></div><div class="ttdeci">std::bitset&lt; 16 &gt; Stat</div><div class="ttdoc">Vertex status bits using kVtxBit_t. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00090">DataStructs.h:90</a></div></div>
<div class="ttc" id="structtca_1_1VtxStore_html_a955d49d4351f41da21cb238fc204153b"><div class="ttname"><a href="../../dc/d11/structtca_1_1VtxStore.html#a955d49d4351f41da21cb238fc204153b">tca::VtxStore::ID</a></div><div class="ttdeci">int ID</div><div class="ttdoc">set to 0 if killed </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00085">DataStructs.h:85</a></div></div>
<div class="ttc" id="namespacetca_html_ae43e3da1b2fe6dca15e19b1c78031e36"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ae43e3da1b2fe6dca15e19b1c78031e36">tca::seeds</a></div><div class="ttdeci">std::vector&lt; TrajPoint &gt; seeds</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/DataStructs_8cxx_source.html#l00013">DataStructs.cxx:13</a></div></div>
<div class="ttc" id="structtca_1_1ParFit_html_a62d0958a63058e8239dc8d5d7d785f59"><div class="ttname"><a href="../../d0/df5/structtca_1_1ParFit.html#a62d0958a63058e8239dc8d5d7d785f59">tca::ParFit::ParSlp</a></div><div class="ttdeci">float ParSlp</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00185">DataStructs.h:185</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5daea82def44ffd3a71c79c73ae3b0dee7b"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5daea82def44ffd3a71c79c73ae3b0dee7b">tca::kMaskHits</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00435">DataStructs.h:435</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html_af4135bac344253d4fecaca6369722c0a"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html#af4135bac344253d4fecaca6369722c0a">tca::TrajPoint::AngleCode</a></div><div class="ttdeci">unsigned short AngleCode</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00173">DataStructs.h:173</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_aae03d6a71d412978f5c8934c779254b1"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#aae03d6a71d412978f5c8934c779254b1">tca::TCConfig::maxWireSkipNoSignal</a></div><div class="ttdeci">float maxWireSkipNoSignal</div><div class="ttdoc">max number of wires to skip w/o a signal on them </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00583">DataStructs.h:583</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5da083602d3b7924dcd839998951bf8385f"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da083602d3b7924dcd839998951bf8385f">tca::kStopBadFits</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00461">DataStructs.h:461</a></div></div>
<div class="ttc" id="namespacetca_html_a2c7d3d0a7e1e838e76ad9a43b4411176"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a2c7d3d0a7e1e838e76ad9a43b4411176">tca::TrajIntersection</a></div><div class="ttdeci">void TrajIntersection(TrajPoint const &amp;tp1, TrajPoint const &amp;tp2, Point2_t &amp;pos)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l02602">Utils.cxx:2602</a></div></div>
<div class="ttc" id="namespacetca_html_a1180656acd6cfc07d51fb636b50ef4f8"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a1180656acd6cfc07d51fb636b50ef4f8">tca::CheckTraj</a></div><div class="ttdeci">void CheckTraj(TCSlice &amp;slc, Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l00927">StepUtils.cxx:927</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html_ac7ee47f41dc2e24263c8c9fb9a135dd2"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html#ac7ee47f41dc2e24263c8c9fb9a135dd2">tca::TrajPoint::AveChg</a></div><div class="ttdeci">float AveChg</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00165">DataStructs.h:165</a></div></div>
<div class="ttc" id="namespacetca_html_ac7453ffded371a6c148f116b8c0042c9"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ac7453ffded371a6c148f116b8c0042c9">tca::DotProd</a></div><div class="ttdeci">double DotProd(const Vector3_t &amp;v1, const Vector3_t &amp;v2)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d6a/PFPUtils_8h_source.html#l00128">PFPUtils.h:128</a></div></div>
<div class="ttc" id="namespacetca_html_a0c55ac735de824c3e089bcbea9addb71"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a0c55ac735de824c3e089bcbea9addb71">tca::CTP_t</a></div><div class="ttdeci">unsigned int CTP_t</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00049">DataStructs.h:49</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5da9b5200eaaed0e097cac019d6643e537e"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da9b5200eaaed0e097cac019d6643e537e">tca::kJunkTj</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00449">DataStructs.h:449</a></div></div>
<div class="ttc" id="namespacetca_html_a1a93908a64cd734cc9f4418d944b14e6"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a1a93908a64cd734cc9f4418d944b14e6">tca::tjfs</a></div><div class="ttdeci">std::vector&lt; TjForecast &gt; tjfs</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/DataStructs_8cxx_source.html#l00009">DataStructs.cxx:9</a></div></div>
<div class="ttc" id="namespacetca_html_aa050fa6f6a815ba15eb84ac539e89414"><div class="ttname"><a href="../../de/d0f/namespacetca.html#aa050fa6f6a815ba15eb84ac539e89414">tca::AddLAHits</a></div><div class="ttdeci">void AddLAHits(TCSlice &amp;slc, Trajectory &amp;tj, unsigned short ipt, bool &amp;sigOK)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l01214">StepUtils.cxx:1214</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html_af9b51f6eb202342e980fdae234fe06c5"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html#af9b51f6eb202342e980fdae234fe06c5">tca::TrajPoint::DeltaRMS</a></div><div class="ttdeci">float DeltaRMS</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00168">DataStructs.h:168</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_af5730f08df12863fd92ee1573843d61d"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">tca::TCConfig::useAlg</a></div><div class="ttdeci">std::bitset&lt; 128 &gt; useAlg</div><div class="ttdoc">Max hit separation for making junk trajectories. &amp;lt; 0 to turn off. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00588">DataStructs.h:588</a></div></div>
<div class="ttc" id="structtca_1_1VtxStore_html_a6ce76a1bfcc54c44ea862bfad958019b"><div class="ttname"><a href="../../dc/d11/structtca_1_1VtxStore.html#a6ce76a1bfcc54c44ea862bfad958019b">tca::VtxStore::Topo</a></div><div class="ttdeci">short Topo</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00083">DataStructs.h:83</a></div></div>
<div class="ttc" id="namespacetca_html_a045a87be615f131f0e626885f457c228"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a045a87be615f131f0e626885f457c228">tca::CheckHiMultUnusedHits</a></div><div class="ttdeci">void CheckHiMultUnusedHits(TCSlice &amp;slc, Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l02165">StepUtils.cxx:2165</a></div></div>
<div class="ttc" id="structtca_1_1ParFit_html_abcd45b84f4ba5d79c9508bbb7214173f"><div class="ttname"><a href="../../d0/df5/structtca_1_1ParFit.html#abcd45b84f4ba5d79c9508bbb7214173f">tca::ParFit::ParErr</a></div><div class="ttdeci">float ParErr</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00184">DataStructs.h:184</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a0b39677cc3d897476deca9722674981e"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a0b39677cc3d897476deca9722674981e">tca::TCConfig::VLAStepSize</a></div><div class="ttdeci">float VLAStepSize</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00586">DataStructs.h:586</a></div></div>
<div class="ttc" id="structtca_1_1Trajectory_html_a3d0690a80fbffcedf93b202d1c7bd0cd"><div class="ttname"><a href="../../d7/d46/structtca_1_1Trajectory.html#a3d0690a80fbffcedf93b202d1c7bd0cd">tca::Trajectory::StepDir</a></div><div class="ttdeci">short StepDir</div><div class="ttdoc">-1 = going US (-&amp;gt; small wire#), 1 = going DS (-&amp;gt; large wire#) </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00212">DataStructs.h:212</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5da9e853cb112a21be9cf4a407206bc9449"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da9e853cb112a21be9cf4a407206bc9449">tca::kUseGhostHits</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00458">DataStructs.h:458</a></div></div>
<div class="ttc" id="namespacetca_html_aa13d4c4275b33e7fb75b4ef237dfa014"><div class="ttname"><a href="../../de/d0f/namespacetca.html#aa13d4c4275b33e7fb75b4ef237dfa014">tca::MaxHitDelta</a></div><div class="ttdeci">float MaxHitDelta(TCSlice &amp;slc, Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l03274">Utils.cxx:3274</a></div></div>
<div class="ttc" id="namespacetca_html_a6e2276751d57a99e13a810d6166692a0"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a6e2276751d57a99e13a810d6166692a0">tca::TrajLength</a></div><div class="ttdeci">float TrajLength(const Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l02644">Utils.cxx:2644</a></div></div>
<div class="ttc" id="structtca_1_1Trajectory_html_afdce6c640f038135c9caae0b821a3ead"><div class="ttname"><a href="../../d7/d46/structtca_1_1Trajectory.html#afdce6c640f038135c9caae0b821a3ead">tca::Trajectory::AlgMod</a></div><div class="ttdeci">std::bitset&lt; 128 &gt; AlgMod</div><div class="ttdoc">Bit set if algorithm AlgBit_t modifed the trajectory. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00195">DataStructs.h:195</a></div></div>
<div class="ttc" id="namespacetca_html_af81ddf66c643b53f3f7816131a384bc4"><div class="ttname"><a href="../../de/d0f/namespacetca.html#af81ddf66c643b53f3f7816131a384bc4">tca::LastEndMerge</a></div><div class="ttdeci">void LastEndMerge(TCSlice &amp;slc, CTP_t inCTP)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l03106">StepUtils.cxx:3106</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a196555abfdd354366e2158fba39efc83"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a196555abfdd354366e2158fba39efc83">tca::TCConfig::muonTag</a></div><div class="ttdeci">std::vector&lt; short &gt; muonTag</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00557">DataStructs.h:557</a></div></div>
<div class="ttc" id="structtca_1_1VtxStore_html_a600294061c9095d64321ddbc93f5f996"><div class="ttname"><a href="../../dc/d11/structtca_1_1VtxStore.html#a600294061c9095d64321ddbc93f5f996">tca::VtxStore::NTraj</a></div><div class="ttdeci">unsigned short NTraj</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00077">DataStructs.h:77</a></div></div>
<div class="ttc" id="namespacetca_html_adf5449019c33e3acf95de4788f15acec"><div class="ttname"><a href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">tca::DecodeCTP</a></div><div class="ttdeci">geo::PlaneID DecodeCTP(CTP_t CTP)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/DataStructs_8cxx_source.html#l00115">DataStructs.cxx:115</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5da28fa0bb663ed246b2fcf12591258c5ac"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da28fa0bb663ed246b2fcf12591258c5ac">tca::kKilled</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00450">DataStructs.h:450</a></div></div>
<div class="ttc" id="namespacetca_html_a6a54ab1f3f863b27a59209d44cf402b2"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a6a54ab1f3f863b27a59209d44cf402b2">tca::GottaKink</a></div><div class="ttdeci">bool GottaKink(TCSlice &amp;slc, Trajectory &amp;tj, bool doTrim)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l02554">StepUtils.cxx:2554</a></div></div>
<div class="ttc" id="namespacetca_html_a2a4c4a32e939554d609ba778be021c6d"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a2a4c4a32e939554d609ba778be021c6d">tca::PosSep</a></div><div class="ttdeci">double PosSep(const Point3_t &amp;pos1, const Point3_t &amp;pos2)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02564">PFPUtils.cxx:2564</a></div></div>
<div class="ttc" id="namespacetca_html_a54a189312dc1c61d90002e85e11a33c2"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a54a189312dc1c61d90002e85e11a33c2">tca::TrimHiChgEndPts</a></div><div class="ttdeci">void TrimHiChgEndPts(TCSlice &amp;slc, Trajectory &amp;tj, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l01555">Utils.cxx:1555</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_ac24fc2006fb9fdcc2dc745608b6b0f5c"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#ac24fc2006fb9fdcc2dc745608b6b0f5c">tca::TCConfig::dbgAlg</a></div><div class="ttdeci">std::bitset&lt; 128 &gt; dbgAlg</div><div class="ttdoc">Allow user to turn on debug printing in algorithms (that print...) </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00589">DataStructs.h:589</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html_a4ea82b67f2bc6ffc158950e8a51095e4"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html#a4ea82b67f2bc6ffc158950e8a51095e4">tca::TrajPoint::Environment</a></div><div class="ttdeci">std::bitset&lt; 8 &gt; Environment</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00176">DataStructs.h:176</a></div></div>
<div class="ttc" id="structtca_1_1TCEvent_html_ab9f91958d4d40ec9c3733d422736c87e"><div class="ttname"><a href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">tca::TCEvent::allHits</a></div><div class="ttdeci">std::vector&lt; recob::Hit &gt; const * allHits</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00624">DataStructs.h:624</a></div></div>
<div class="ttc" id="namespacetca_html_a8806e1c32119afbfe02dff4c21cf3e57"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a8806e1c32119afbfe02dff4c21cf3e57">tca::EncodeCTP</a></div><div class="ttdeci">CTP_t EncodeCTP(unsigned int cryo, unsigned int tpc, unsigned int plane)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00054">DataStructs.h:54</a></div></div>
<div class="ttc" id="namespacetca_html_a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa0a4b8d8fc21482d4679f7eac8f457e70"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa0a4b8d8fc21482d4679f7eac8f457e70">tca::kBragg</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00513">DataStructs.h:513</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_a2bfd4002c7f6fbe64e1fc1591682870b"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#a2bfd4002c7f6fbe64e1fc1591682870b">tca::TCSlice::nWires</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; nWires</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00655">DataStructs.h:655</a></div></div>
<div class="ttc" id="namespacetca_html_ac86be2bdca680e7a5c4f920c3e6402bca881b9d556e1114d8cce02b75d65120db"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bca881b9d556e1114d8cce02b75d65120db">tca::kStiffEl</a></div><div class="ttdoc">use the stiff electron strategy </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00503">DataStructs.h:503</a></div></div>
<div class="ttc" id="structtca_1_1Trajectory_html_afa6980f5646e419795cdc43499a55104"><div class="ttname"><a href="../../d7/d46/structtca_1_1Trajectory.html#afa6980f5646e419795cdc43499a55104">tca::Trajectory::EndFlag</a></div><div class="ttdeci">std::array&lt; std::bitset&lt; 8 &gt;, 2 &gt; EndFlag</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00214">DataStructs.h:214</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a4d43e181bd45ffde8791bcf7e4d16d54"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a4d43e181bd45ffde8791bcf7e4d16d54">tca::TCConfig::chkStopCuts</a></div><div class="ttdeci">std::vector&lt; float &gt; chkStopCuts</div><div class="ttdoc">Bragg peak finder configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00559">DataStructs.h:559</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5da193159e2e5bd2c50d2df2c37fc4d0c08"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da193159e2e5bd2c50d2df2c37fc4d0c08">tca::kFixBegin</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00462">DataStructs.h:462</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html">tca::TCSlice</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00654">DataStructs.h:654</a></div></div>
<div class="ttc" id="namespacetca_html_acf162951edfc70b922d57ba960905a11"><div class="ttname"><a href="../../de/d0f/namespacetca.html#acf162951edfc70b922d57ba960905a11">tca::EndMerge</a></div><div class="ttdeci">void EndMerge(TCSlice &amp;slc, CTP_t inCTP, bool lastPass)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l03251">StepUtils.cxx:3251</a></div></div>
<div class="ttc" id="namespacetca_html_ab11ddb4ffcebdeb4f43ad594c7d1baeb"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ab11ddb4ffcebdeb4f43ad594c7d1baeb">tca::SetVx2Score</a></div><div class="ttdeci">void SetVx2Score(TCSlice &amp;slc)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dfc/TCVertex_8cxx_source.html#l02278">TCVertex.cxx:2278</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a83dc3d01465a197a631feb83b8dcbf1a"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a83dc3d01465a197a631feb83b8dcbf1a">tca::TCConfig::vtx2DCuts</a></div><div class="ttdeci">std::vector&lt; float &gt; vtx2DCuts</div><div class="ttdoc">Max position pull, max Position error rms. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00552">DataStructs.h:552</a></div></div>
<div class="ttc" id="structtca_1_1Trajectory_html_adfa696789f5e9fa585d28c3383be1156"><div class="ttname"><a href="../../d7/d46/structtca_1_1Trajectory.html#adfa696789f5e9fa585d28c3383be1156">tca::Trajectory::Strategy</a></div><div class="ttdeci">std::bitset&lt; 8 &gt; Strategy</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00215">DataStructs.h:215</a></div></div>
<div class="ttc" id="namespacetca_html_ab0e6ecc57d0831d83fda749b054ed7a4"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ab0e6ecc57d0831d83fda749b054ed7a4">tca::NearbySrcHit</a></div><div class="ttdeci">bool NearbySrcHit(geo::PlaneID plnID, unsigned int wire, float loTick, float hiTick)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l02069">Utils.cxx:2069</a></div></div>
<div class="ttc" id="namespacetca_html_abf103406bdfc7b01925a424be481abd4"><div class="ttname"><a href="../../de/d0f/namespacetca.html#abf103406bdfc7b01925a424be481abd4">tca::SignalBetween</a></div><div class="ttdeci">bool SignalBetween(const TCSlice &amp;slc, const TrajPoint &amp;tp1, const TrajPoint &amp;tp2, const float &amp;MinWireSignalFraction)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l01805">Utils.cxx:1805</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a36ca642953e6e37f4cc989a8c0dc68ea"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a36ca642953e6e37f4cc989a8c0dc68ea">tca::TCConfig::multHitSep</a></div><div class="ttdeci">float multHitSep</div><div class="ttdoc">preferentially &amp;quot;merge&amp;quot; hits with &amp;lt; this separation </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00576">DataStructs.h:576</a></div></div>
<div class="ttc" id="namespacetca_html_a9a2cd91c50f24261f799582dc9f0a76f"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a9a2cd91c50f24261f799582dc9f0a76f">tca::MoveTPToWire</a></div><div class="ttdeci">void MoveTPToWire(TrajPoint &amp;tp, float wire)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l02829">Utils.cxx:2829</a></div></div>
<div class="ttc" id="namespacetca_html_a11f336296780a3459f3b946303a17e2b"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">tca::NumPtsWithCharge</a></div><div class="ttdeci">unsigned short NumPtsWithCharge(const TCSlice &amp;slc, const Trajectory &amp;tj, bool includeDeadWires)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l02114">Utils.cxx:2114</a></div></div>
<div class="ttc" id="namespacetca_html_a3bc30aeace71ea50324b602afa2155f2"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">tca::evt</a></div><div class="ttdeci">TCEvent evt</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/DataStructs_8cxx_source.html#l00007">DataStructs.cxx:7</a></div></div>
<div class="ttc" id="namespacetca_html_a9ca258cade17b5907d2c9006bf4540d3"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a9ca258cade17b5907d2c9006bf4540d3">tca::MaskTrajEndPoints</a></div><div class="ttdeci">void MaskTrajEndPoints(TCSlice &amp;slc, Trajectory &amp;tj, unsigned short nPts)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l03649">StepUtils.cxx:3649</a></div></div>
<div class="ttc" id="namespacetca_html_a9e375fbdbb04760c844a9f5aeed7290c"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a9e375fbdbb04760c844a9f5aeed7290c">tca::UpdateDeltaRMS</a></div><div class="ttdeci">void UpdateDeltaRMS(TCSlice &amp;slc, Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l02347">StepUtils.cxx:2347</a></div></div>
<div class="ttc" id="namespacetca_html_a36a327d57361f40edfb73d1816ca4ce7"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a36a327d57361f40edfb73d1816ca4ce7">tca::ChkStopEndPts</a></div><div class="ttdeci">void ChkStopEndPts(TCSlice &amp;slc, Trajectory &amp;tj, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l01560">StepUtils.cxx:1560</a></div></div>
<div class="ttc" id="namespacetca_html_a7a4d529dd1fccb11252c3ade776f5d4e"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a7a4d529dd1fccb11252c3ade776f5d4e">tca::TrajTrajDOCA</a></div><div class="ttdeci">bool TrajTrajDOCA(const TCSlice &amp;slc, const Trajectory &amp;tj1, const Trajectory &amp;tj2, unsigned short &amp;ipt1, unsigned short &amp;ipt2, float &amp;minSep)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l02458">Utils.cxx:2458</a></div></div>
<div class="ttc" id="namespacetca_html_ad7cbf4c6b614a0794141590372874150"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ad7cbf4c6b614a0794141590372874150">tca::ReversePropagate</a></div><div class="ttdeci">void ReversePropagate(TCSlice &amp;slc, Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l01314">StepUtils.cxx:1314</a></div></div>
<div class="ttc" id="structtca_1_1Trajectory_html_a6f57aca44660b87327393e6a4694e570"><div class="ttname"><a href="../../d7/d46/structtca_1_1Trajectory.html#a6f57aca44660b87327393e6a4694e570">tca::Trajectory::NeedsUpdate</a></div><div class="ttdeci">bool NeedsUpdate</div><div class="ttdoc">Set true when the Tj needs to be updated. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00216">DataStructs.h:216</a></div></div>
<div class="ttc" id="namespacetca_html_a5d59efe83ce0c76a4e68f44e23cc2e18"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a5d59efe83ce0c76a4e68f44e23cc2e18">tca::CheckHiMultEndHits</a></div><div class="ttdeci">void CheckHiMultEndHits(TCSlice &amp;slc, Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l02307">StepUtils.cxx:2307</a></div></div>
<div class="ttc" id="structtca_1_1SortEntry_html"><div class="ttname"><a href="../../db/d7d/structtca_1_1SortEntry.html">tca::SortEntry</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dfc/TCVertex_8cxx_source.html#l00027">TCVertex.cxx:27</a></div></div>
<div class="ttc" id="DebugStruct_8h_html"><div class="ttname"><a href="../../da/db2/DebugStruct_8h.html">DebugStruct.h</a></div></div>
<div class="ttc" id="structtca_1_1Trajectory_html"><div class="ttname"><a href="../../d7/d46/structtca_1_1Trajectory.html">tca::Trajectory</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00192">DataStructs.h:192</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html_a4aa62ed88bd15f92ac4de07abcd44375"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html#a4aa62ed88bd15f92ac4de07abcd44375">tca::TrajPoint::HitPos</a></div><div class="ttdeci">Point2_t HitPos</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00156">DataStructs.h:156</a></div></div>
<div class="ttc" id="namespacetca_html_a33eb5964553085dbc29dfc5e8339110e"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a33eb5964553085dbc29dfc5e8339110e">tca::TPHitsRMSTick</a></div><div class="ttdeci">float TPHitsRMSTick(const TCSlice &amp;slc, const TrajPoint &amp;tp, HitStatus_t hitRequest)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l04207">Utils.cxx:4207</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html_a26204f9e99eab6a2bf9e3cc96b0f7ad0"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html#a26204f9e99eab6a2bf9e3cc96b0f7ad0">tca::TrajPoint::FitChi</a></div><div class="ttdeci">float FitChi</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00169">DataStructs.h:169</a></div></div>
<div class="ttc" id="messageservice_8fcl_html_a6699b4dbd72f548e48d81c88697d35a6"><div class="ttname"><a href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">cout</a></div><div class="ttdeci">BEGIN_PROLOG could also be cout</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/df5/messageservice_8fcl_source.html#l00010">messageservice.fcl:10</a></div></div>
<div class="ttc" id="structtca_1_1DebugStuff_html_abdefd5fc91232162d9ac0eb0d2c79a9d"><div class="ttname"><a href="../../d8/de4/structtca_1_1DebugStuff.html#abdefd5fc91232162d9ac0eb0d2c79a9d">tca::DebugStuff::CTP</a></div><div class="ttdeci">CTP_t CTP</div><div class="ttdoc">set to an invalid CTP </div><div class="ttdef"><b>Definition:</b> <a href="../../da/db2/DebugStruct_8h_source.html#l00023">DebugStruct.h:23</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html_aeb58a2acf3a7ce07200166dedddc2de5"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html#aeb58a2acf3a7ce07200166dedddc2de5">tca::TrajPoint::HitPosErr2</a></div><div class="ttdeci">double HitPosErr2</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00159">DataStructs.h:159</a></div></div>
<div class="ttc" id="namespacetca_html_afd6835e0d895357c41f7dc34db5b7e42"><div class="ttname"><a href="../../de/d0f/namespacetca.html#afd6835e0d895357c41f7dc34db5b7e42">tca::AngleRange</a></div><div class="ttdeci">unsigned short AngleRange(TrajPoint const &amp;tp)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l00764">Utils.cxx:764</a></div></div>
<div class="ttc" id="namespacetca_html_ac86be2bdca680e7a5c4f920c3e6402bca55868aa9ed90ec1727bec61ae58cae5c"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ac86be2bdca680e7a5c4f920c3e6402bca55868aa9ed90ec1727bec61ae58cae5c">tca::kStiffMu</a></div><div class="ttdoc">use the stiff muon strategy </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00504">DataStructs.h:504</a></div></div>
<div class="ttc" id="StepUtils_8h_html"><div class="ttname"><a href="../../df/df0/StepUtils_8h.html">StepUtils.h</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html">tca::TrajPoint</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00154">DataStructs.h:154</a></div></div>
<div class="ttc" id="namespacetca_html_a785100ea9d154d7afa06c7092aaf1cd3acc9a44768cfabff4a2048a41a6e5b9dd"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3acc9a44768cfabff4a2048a41a6e5b9dd">tca::kUnusedHits</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d0a/larreco_2larreco_2RecoAlg_2TCAlg_2Utils_8h_source.html#l00043">larreco/larreco/RecoAlg/TCAlg/Utils.h:43</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a021e465318628b608b17e9a98525b3e2"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a021e465318628b608b17e9a98525b3e2">tca::TCConfig::dbgMrg</a></div><div class="ttdeci">bool dbgMrg</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00594">DataStructs.h:594</a></div></div>
<div class="ttc" id="namespacetca_html_a77d214b0ab24a4e88b0330ebb4d8fdf4"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a77d214b0ab24a4e88b0330ebb4d8fdf4">tca::HasDuplicateHits</a></div><div class="ttdeci">bool HasDuplicateHits(const TCSlice &amp;slc, Trajectory const &amp;tj, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l02810">Utils.cxx:2810</a></div></div>
<div class="ttc" id="namespacetca_html_a40add002a2f38c42d76859b07b223b73"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a40add002a2f38c42d76859b07b223b73">tca::ChkMichel</a></div><div class="ttdeci">bool ChkMichel(TCSlice &amp;slc, Trajectory &amp;tj, unsigned short &amp;lastGoodPt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l03809">StepUtils.cxx:3809</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
