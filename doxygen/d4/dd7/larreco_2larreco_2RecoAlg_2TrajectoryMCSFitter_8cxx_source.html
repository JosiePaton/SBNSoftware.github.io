<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>TrajectoryMCSFitter.cxx Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_b73b02d482d1c4a3db20c3d9ad52d395.html">srcs</a></li><li class="navelem"><a class="el" href="../../dir_f58b2474d7db671760af109c057c9f12.html">larreco</a></li><li class="navelem"><a class="el" href="../../dir_bfd42686fcf7bc0e8145fd17787a17cd.html">larreco</a></li><li class="navelem"><a class="el" href="../../dir_a92975983e87729a773cfa3b8109c8c3.html">RecoAlg</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">larreco/larreco/RecoAlg/TrajectoryMCSFitter.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d4/dd7/larreco_2larreco_2RecoAlg_2TrajectoryMCSFitter_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/db3/larreco_2larreco_2RecoAlg_2TrajectoryMCSFitter_8h.html">TrajectoryMCSFitter.h</a>&quot;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d6c/geo__vectors__utils_8h.html">larcorealg/Geometry/geo_vectors_utils.h</a>&quot;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d8b/Geometry_8h.html">larcore/Geometry/Geometry.h</a>&quot;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/dda/SpaceChargeService_8h.html">larevt/SpaceChargeServices/SpaceChargeService.h</a>&quot;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &quot;TMatrixDSym.h&quot;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;TMatrixDSymEigen.h&quot;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../da/dc9/namespacepmtana.html#a9860e62c78db1dd9c7d635a2832b883a">std</a>;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">using namespace </span>trkf;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">using namespace </span>recob::tracking;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno"><a class="line" href="../../df/d45/classtrkf_1_1TrajectoryMCSFitter.html#ab2bfeba7917d989baac9107760c2f9ea">   12</a></span>&#160;<a class="code" href="../../dd/d39/classrecob_1_1MCSFitResult.html">recob::MCSFitResult</a> TrajectoryMCSFitter::fitMcs(<span class="keyword">const</span> <a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html">recob::TrackTrajectory</a>&amp; traj, <span class="keywordtype">int</span> pid)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  <span class="comment">// Break the trajectory in segments of length approximately equal to segLen_</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  vector&lt;size_t&gt; breakpoints;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  vector&lt;float&gt; segradlengths;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  vector&lt;float&gt; cumseglens;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  breakTrajInSegments(traj, breakpoints, segradlengths, cumseglens);</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  <span class="comment">// Fit segment directions, and get 3D angles between them</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  <span class="keywordflow">if</span> (segradlengths.size()&lt;2) <span class="keywordflow">return</span> <a class="code" href="../../dd/d39/classrecob_1_1MCSFitResult.html">recob::MCSFitResult</a>();</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  vector&lt;float&gt; dtheta;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <a class="code" href="../../d0/da2/namespacetrkf.html#afce448b0c24542e8646ade72b3bd51b3">Vector_t</a> pcdir0;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <a class="code" href="../../d0/da2/namespacetrkf.html#afce448b0c24542e8646ade72b3bd51b3">Vector_t</a> pcdir1;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> = 0; <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>&lt;segradlengths.size(); <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>++) {</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    linearRegression(traj, breakpoints[<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>], breakpoints[p+1], pcdir1);</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keywordflow">if</span> (p&gt;0) {</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;      <span class="keywordflow">if</span> (segradlengths[p]&lt;-100. || segradlengths[p-1]&lt;-100.) {</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        dtheta.push_back(-999.);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> cosval = pcdir0.X()*pcdir1.X()+pcdir0.Y()*pcdir1.Y()+pcdir0.Z()*pcdir1.Z();</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        <span class="comment">//assert(std::abs(cosval)&lt;=1);</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        <span class="comment">//units are mrad</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        <span class="keywordtype">double</span> dt = 1000.*acos(cosval);<span class="comment">//should we try to use expansion for small angles?</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        dtheta.push_back(dt);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;      }</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    }</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    pcdir0 = pcdir1;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  }</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="comment">// Perform likelihood scan in forward and backward directions</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  vector&lt;float&gt; cumLenFwd;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  vector&lt;float&gt; cumLenBwd;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i&lt;cumseglens.size()-2; i++) {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    cumLenFwd.push_back(cumseglens[i]);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    cumLenBwd.push_back(cumseglens.back()-cumseglens[i+2]);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  }</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keywordtype">double</span> detAngResol = DetectorAngularResolution(<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#ae6ee026328118d16658b6094746e7cde">StartDirection</a>().Z()));</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html">ScanResult</a> fwdResult = doLikelihoodScan(dtheta, segradlengths, cumLenFwd, <span class="keyword">true</span> , pid, detAngResol);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html">ScanResult</a> bwdResult = doLikelihoodScan(dtheta, segradlengths, cumLenBwd, <span class="keyword">false</span>, pid, detAngResol);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dd/d39/classrecob_1_1MCSFitResult.html">recob::MCSFitResult</a>(pid,</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                             fwdResult.<a class="code" href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html#a664b011a923b7216b801f30dcea89bce">p</a>,fwdResult.<a class="code" href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html#af86b03fd30254ff31962a17c2bc8fbb2">pUnc</a>,fwdResult.<a class="code" href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html#adcd7fcad263fdc2699826ceba11e141d">logL</a>,</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                             bwdResult.<a class="code" href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html#a664b011a923b7216b801f30dcea89bce">p</a>,bwdResult.<a class="code" href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html#af86b03fd30254ff31962a17c2bc8fbb2">pUnc</a>,bwdResult.<a class="code" href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html#adcd7fcad263fdc2699826ceba11e141d">logL</a>,</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                             segradlengths,dtheta);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;}</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="../../df/d45/classtrkf_1_1TrajectoryMCSFitter.html#acb8f284b1db0edbf62d18f0752ad8363">   61</a></span>&#160;<span class="keywordtype">void</span> TrajectoryMCSFitter::breakTrajInSegments(<span class="keyword">const</span> <a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html">recob::TrackTrajectory</a>&amp; traj, vector&lt;size_t&gt;&amp; breakpoints, vector&lt;float&gt;&amp; segradlengths, vector&lt;float&gt;&amp; cumseglens)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  art::ServiceHandle&lt;geo::Geometry const&gt; geom;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keyword">auto</span> <span class="keyword">const</span>* _SCE = (applySCEcorr_ ? lar::providerFrom&lt;spacecharge::SpaceChargeService&gt;() : NULL);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> trajlen = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#a64e9b10abf9f0833b8908e7e5d24a7e1">Length</a>();</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> thisSegLen = (trajlen&gt;(segLen_*minNSegs_) ? segLen_ : trajlen/<span class="keywordtype">double</span>(minNSegs_) );</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="comment">// std::cout &lt;&lt; &quot;track with length=&quot; &lt;&lt; trajlen &lt;&lt; &quot; broken in nseg=&quot; &lt;&lt; std::max(minNSegs_,int(trajlen/segLen_)) &lt;&lt; &quot; of length=&quot; &lt;&lt; thisSegLen &lt;&lt; &quot; where segLen_=&quot; &lt;&lt; segLen_ &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  constexpr <span class="keywordtype">double</span> lar_radl_inv = 1./14.0;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  cumseglens.push_back(0.);<span class="comment">//first segment has zero cumulative length from previous segments</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordtype">double</span> thislen = 0.;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordtype">double</span> totlen = 0.;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keyword">auto</span> nextValid=traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#ad935eb6f307165c6c84b659c21ef0c3b">FirstValidPoint</a>();</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  breakpoints.push_back(nextValid);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="keyword">auto</span> pos0 = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#ac5b2211c3729d3b51481f0445df1718c">LocationAtPoint</a>(nextValid);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="keywordflow">if</span> (applySCEcorr_) {</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> Position[3] = {pos0.X(), pos0.Y(), pos0.Z()};</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a> tpcid = geom-&gt;FindTPCAtPosition(Position);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a> pos0_offset = <a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a>(0., 0., 0.);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordflow">if</span>(tpcid.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a9384db80f2ab08f013fc630316d7bd05">isValid</a>) {</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      <a class="code" href="../../d6/d23/namespacegeo.html#a5a6f22c2aa9d0ccf6ca08bf2773a0541">geo::Point_t</a> p0(pos0.X(), pos0.Y(), pos0.Z());</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      pos0_offset = _SCE-&gt;GetCalPosOffsets(p0, tpcid.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    }</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    pos0.SetX(pos0.X() - pos0_offset.X());</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    pos0.SetY(pos0.Y() + pos0_offset.Y());</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    pos0.SetZ(pos0.Z() + pos0_offset.Z());</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  }</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keyword">auto</span> dir0 = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#afb2d5aa9d104c3215733c28e7de4be99">DirectionAtPoint</a>(nextValid);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  nextValid = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#a63a68d3d4608ba73321df782a3e8b430">NextValidPoint</a>(nextValid+1);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keywordtype">int</span> npoints = 0;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keywordflow">while</span> (nextValid!=<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#a16ac7e8b7d7b38c1237c7df1b941dde8">recob::TrackTrajectory::InvalidIndex</a>) {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keywordflow">if</span> (npoints==0) dir0 = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#afb2d5aa9d104c3215733c28e7de4be99">DirectionAtPoint</a>(nextValid);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keyword">auto</span> pos1 = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#ac5b2211c3729d3b51481f0445df1718c">LocationAtPoint</a>(nextValid);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">if</span> (applySCEcorr_) {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> Position[3] = {pos1.X(), pos1.Y(), pos1.Z()};</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      <a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a> tpcid = geom-&gt;FindTPCAtPosition(Position);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      <a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a> pos1_offset = <a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a>(0., 0., 0.);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      <span class="keywordflow">if</span>(tpcid.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a9384db80f2ab08f013fc630316d7bd05">isValid</a>) {</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <a class="code" href="../../d6/d23/namespacegeo.html#a5a6f22c2aa9d0ccf6ca08bf2773a0541">geo::Point_t</a> <a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a>(pos1.X(), pos1.Y(), pos1.Z());</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        pos1_offset = _SCE-&gt;GetCalPosOffsets(<a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a>, tpcid.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      }</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      pos1.SetX(pos1.X() - pos1_offset.X());</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      pos1.SetY(pos1.Y() + pos1_offset.Y());</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      pos1.SetZ(pos1.Z() + pos1_offset.Z());</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    }</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="comment">//increments along the initial direction of the segment</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keyword">auto</span> step = (pos1-pos0).R();</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    thislen += dir0.Dot(pos1-pos0);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    totlen += step;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    pos0=pos1;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment">// //fixme: testing alternative approaches here</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="comment">// //test1: increments following scatters</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="comment">// auto step = (pos1-pos0).R();</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="comment">// thislen += step;</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">// totlen += step;</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">// pos0=pos1;</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment">// //test2: end-start distance along the initial direction of the segment</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">// thislen = dir0.Dot(pos1-pos0);</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">// totlen = (pos1-pos0).R();</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    npoints++;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordflow">if</span> (thislen&gt;=(thisSegLen-segLenTolerance_)) {</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      breakpoints.push_back(nextValid);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      <span class="keywordflow">if</span> (npoints&gt;=minHitsPerSegment_) segradlengths.push_back(thislen*lar_radl_inv);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      <span class="keywordflow">else</span> segradlengths.push_back(-999.);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      cumseglens.push_back(totlen);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      thislen = 0.;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      npoints = 0;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    }</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    nextValid = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#a63a68d3d4608ba73321df782a3e8b430">NextValidPoint</a>(nextValid+1);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  }</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="comment">//then add last segment</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keywordflow">if</span> (thislen&gt;0.) {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    breakpoints.push_back(traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#adbef272269b31b0a213a9b4de8504d07">LastValidPoint</a>()+1);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    segradlengths.push_back(thislen*lar_radl_inv);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    cumseglens.push_back(cumseglens.back()+thislen);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;}</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div>
<div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="../../df/d45/classtrkf_1_1TrajectoryMCSFitter.html#a955a217adde311b62eae84efa179e2b1">  142</a></span>&#160;<span class="keyword">const</span> <a class="code" href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html">TrajectoryMCSFitter::ScanResult</a> TrajectoryMCSFitter::doLikelihoodScan(std::vector&lt;float&gt;&amp; dtheta, std::vector&lt;float&gt;&amp; seg_nradlengths, std::vector&lt;float&gt;&amp; cumLen,</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                                                                            <span class="keywordtype">bool</span> fwdFit, <span class="keywordtype">int</span> pid, <span class="keywordtype">float</span> pmin, <span class="keywordtype">float</span> pmax, <span class="keywordtype">float</span> pstep, <span class="keywordtype">float</span> detAngResol)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keywordtype">int</span>    best_idx  = -1;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordtype">float</span> best_logL = <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::numeric_limits&lt;float&gt;::max</a>();</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="keywordtype">float</span> best_p    = -1.0;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  std::vector&lt;float&gt; vlogL;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">float</span> p_test = pmin; p_test &lt;= pmax; p_test+=pstep) {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordtype">float</span> logL = mcsLikelihood(p_test, detAngResol, dtheta, seg_nradlengths, cumLen, fwdFit, pid);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordflow">if</span> (logL &lt; best_logL) {</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      best_p    = p_test;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      best_logL = logL;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      best_idx  = vlogL.size();</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    }</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    vlogL.push_back(logL);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="comment">//uncertainty from left side scan</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="keywordtype">float</span> lunc = -1.;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="keywordflow">if</span> (best_idx&gt;0) {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=best_idx-1;j&gt;=0;j--) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <span class="keywordtype">float</span> dLL = vlogL[j]-vlogL[best_idx];</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      <span class="keywordflow">if</span> ( dLL&gt;=0.5 ) {</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        lunc = (best_idx-j)*pstep;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      }</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    }</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  }</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="comment">//uncertainty from right side scan</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keywordtype">float</span> runc = -1.;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keywordflow">if</span> (best_idx&lt;<span class="keywordtype">int</span>(vlogL.size()-1)) {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=best_idx+1;j&lt;vlogL.size();j++) {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <span class="keywordtype">float</span> dLL = vlogL[j]-vlogL[best_idx];</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <span class="keywordflow">if</span> ( dLL&gt;=0.5 ) {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        runc = (j-best_idx)*pstep;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  }</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html">ScanResult</a>(best_p, <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::max</a>(lunc,runc), best_logL);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;}</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div>
<div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="../../df/d45/classtrkf_1_1TrajectoryMCSFitter.html#a05ca3a21287e3178825b5e771c380c9e">  183</a></span>&#160;<span class="keyword">const</span> <a class="code" href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html">TrajectoryMCSFitter::ScanResult</a> TrajectoryMCSFitter::doLikelihoodScan(std::vector&lt;float&gt;&amp; dtheta, std::vector&lt;float&gt;&amp; seg_nradlengths, std::vector&lt;float&gt;&amp; cumLen,</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                                                                            <span class="keywordtype">bool</span> fwdFit, <span class="keywordtype">int</span> pid, <span class="keywordtype">float</span> detAngResol)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="comment">//do a first, coarse scan</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html">ScanResult</a>&amp; coarseRes = doLikelihoodScan(dtheta, seg_nradlengths, cumLen, fwdFit, pid, pMin_, pMax_, pStepCoarse_, detAngResol);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keywordtype">float</span> pmax = std::min(coarseRes.<a class="code" href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html#a664b011a923b7216b801f30dcea89bce">p</a>+fineScanWindow_,pMax_);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keywordtype">float</span> pmin = <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::max</a>(coarseRes.<a class="code" href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html#a664b011a923b7216b801f30dcea89bce">p</a>-fineScanWindow_,pMin_);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="keywordflow">if</span> (coarseRes.<a class="code" href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html#af86b03fd30254ff31962a17c2bc8fbb2">pUnc</a> &lt; (<a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::numeric_limits&lt;float&gt;::max</a>()-1.)) {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    pmax = std::min(coarseRes.<a class="code" href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html#a664b011a923b7216b801f30dcea89bce">p</a>+2*coarseRes.<a class="code" href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html#af86b03fd30254ff31962a17c2bc8fbb2">pUnc</a>,pMax_);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    pmin = <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::max</a>(coarseRes.<a class="code" href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html#a664b011a923b7216b801f30dcea89bce">p</a>-2*coarseRes.<a class="code" href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html#af86b03fd30254ff31962a17c2bc8fbb2">pUnc</a>,pMin_);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  }</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <span class="comment">//do the fine grained scan in a smaller region</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html">ScanResult</a>&amp; refineRes = doLikelihoodScan(dtheta, seg_nradlengths, cumLen, fwdFit, pid, pmin, pmax, pStep_, detAngResol);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="keywordflow">return</span> refineRes;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;}</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div>
<div class="line"><a name="l00202"></a><span class="lineno"><a class="line" href="../../df/d45/classtrkf_1_1TrajectoryMCSFitter.html#a0c43740d285dad839764b108d24c79f3">  202</a></span>&#160;<span class="keywordtype">void</span> TrajectoryMCSFitter::linearRegression(<span class="keyword">const</span> <a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html">recob::TrackTrajectory</a>&amp; traj, <span class="keyword">const</span> <span class="keywordtype">size_t</span> firstPoint, <span class="keyword">const</span> <span class="keywordtype">size_t</span> lastPoint, <a class="code" href="../../d0/da2/namespacetrkf.html#afce448b0c24542e8646ade72b3bd51b3">Vector_t</a>&amp; pcdir)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  art::ServiceHandle&lt;geo::Geometry const&gt; geom;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keyword">auto</span> <span class="keyword">const</span>* _SCE = (applySCEcorr_ ? lar::providerFrom&lt;spacecharge::SpaceChargeService&gt;() : NULL);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordtype">int</span> npoints = 0;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <a class="code" href="../../d3/dcb/classgeo_1_1vect_1_1MiddlePointAccumulatorDim.html">geo::vect::MiddlePointAccumulator</a> middlePointCalc;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordtype">size_t</span> nextValid = firstPoint;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="comment">//fixme explore a max number of points to use for linear regression</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="comment">//while (nextValid&lt;std::min(firstPoint+10,lastPoint)) {</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keywordflow">while</span> (nextValid&lt;lastPoint) {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keyword">auto</span> tempP = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#ac5b2211c3729d3b51481f0445df1718c">LocationAtPoint</a>(nextValid);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">if</span> (applySCEcorr_) {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> Position[3] = {tempP.X(), tempP.Y(), tempP.Z()};</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a> tpcid = geom-&gt;FindTPCAtPosition(Position);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a> tempP_offset = <a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a>(0., 0., 0.);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      <span class="keywordflow">if</span>(tpcid.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a9384db80f2ab08f013fc630316d7bd05">isValid</a>) {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <a class="code" href="../../d6/d23/namespacegeo.html#a5a6f22c2aa9d0ccf6ca08bf2773a0541">geo::Point_t</a> ptemp(tempP.X(), tempP.Y(), tempP.Z());</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        tempP_offset = _SCE-&gt;GetCalPosOffsets(ptemp, tpcid.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      }</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      tempP.SetX(tempP.X() - tempP_offset.X());</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      tempP.SetY(tempP.Y() + tempP_offset.Y());</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      tempP.SetZ(tempP.Z() + tempP_offset.Z());</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    }</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    middlePointCalc.<a class="code" href="../../d3/dcb/classgeo_1_1vect_1_1MiddlePointAccumulatorDim.html#a6c46bfab403c51fa43d4d7a7d4bf7069">add</a>(tempP);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">//middlePointCalc.add(traj.LocationAtPoint(nextValid));</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    nextValid = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#a63a68d3d4608ba73321df782a3e8b430">NextValidPoint</a>(nextValid+1);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    npoints++;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> avgpos = middlePointCalc.<a class="code" href="../../d3/dcb/classgeo_1_1vect_1_1MiddlePointAccumulatorDim.html#a6ff7d454670025ebad308ef91967545a">middlePoint</a>();</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a> = 1./double(npoints);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="comment">//assert(npoints&gt;0);</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  TMatrixDSym <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>(3);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  nextValid = firstPoint;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keywordflow">while</span> (nextValid&lt;lastPoint) {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keyword">auto</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#ac5b2211c3729d3b51481f0445df1718c">LocationAtPoint</a>(nextValid);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">if</span> (applySCEcorr_) {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> Position[3] = {<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.X(), <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.Y(), <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.Z()};</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      <a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a> tpcid = geom-&gt;FindTPCAtPosition(Position);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a> p_offset = <a class="code" href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a>(0., 0., 0.);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <span class="keywordflow">if</span>(tpcid.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a9384db80f2ab08f013fc630316d7bd05">isValid</a>) {</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <a class="code" href="../../d6/d23/namespacegeo.html#a5a6f22c2aa9d0ccf6ca08bf2773a0541">geo::Point_t</a> point(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.X(), <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.Y(), <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.Z());</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        p_offset = _SCE-&gt;GetCalPosOffsets(point, tpcid.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      }</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.SetX(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.X() - p_offset.X());</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.SetY(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.Y() + p_offset.Y());</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.SetZ(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.Z() + p_offset.Z());</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    }</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> xxw0 = <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.X()-avgpos.X();</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> yyw0 = <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.Y()-avgpos.Y();</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> zzw0 = <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>.Z()-avgpos.Z();</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>(0, 0) += xxw0*xxw0*<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>(0, 1) += xxw0*yyw0*<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>(0, 2) += xxw0*zzw0*<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>(1, 0) += yyw0*xxw0*<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>(1, 1) += yyw0*yyw0*<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>(1, 2) += yyw0*zzw0*<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>(2, 0) += zzw0*xxw0*<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>(2, 1) += zzw0*yyw0*<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>(2, 2) += zzw0*zzw0*<a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    nextValid = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#a63a68d3d4608ba73321df782a3e8b430">NextValidPoint</a>(nextValid+1);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keyword">const</span> TMatrixDSymEigen me(m);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; eigenval = me.GetEigenValues();</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; eigenvec = me.GetEigenVectors();</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="keywordtype">int</span> maxevalidx = 0;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordtype">double</span> maxeval = eigenval(0);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;3; ++i) {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">if</span> (eigenval(i)&gt;maxeval) {</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      maxevalidx = i;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      maxeval = eigenval(i);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  pcdir = <a class="code" href="../../db/dfa/PMAlgTracking_8cxx.html#aba288dcf8037152d32ec29330d952878">Vector_t</a>(eigenvec(0, maxevalidx),eigenvec(1, maxevalidx),eigenvec(2, maxevalidx));</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keywordflow">if</span> (traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#afb2d5aa9d104c3215733c28e7de4be99">DirectionAtPoint</a>(firstPoint).Dot(pcdir)&lt;0.) pcdir*=-1.;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;}</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno"><a class="line" href="../../df/d45/classtrkf_1_1TrajectoryMCSFitter.html#aa6191b0c2caa3b94aad355b680873e47">  285</a></span>&#160;<span class="keywordtype">double</span> TrajectoryMCSFitter::mcsLikelihood(<span class="keywordtype">double</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>, <span class="keywordtype">double</span> theta0x, std::vector&lt;float&gt;&amp; dthetaij, std::vector&lt;float&gt;&amp; seg_nradl, std::vector&lt;float&gt;&amp; cumLen, <span class="keywordtype">bool</span> fwd, <span class="keywordtype">int</span> pid)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> beg  = (fwd ? 0 : (dthetaij.size()-1));</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>  = (fwd ? dthetaij.size() : -1);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> incr = (fwd ? +1 : -1);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="comment">// bool print = false;</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a> = <a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">mass</a>(pid);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> m2 = m*<a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> Etot = sqrt(p*p + m2);<span class="comment">//Initial energy</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordtype">double</span> Eij2 = 0.;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="keywordtype">double</span> <span class="keyword">const</span> fixedterm = 0.5 * std::log( 2.0 * M_PI );</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="keywordtype">double</span> result = 0;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = beg; i != <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>; i+=incr ) {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordflow">if</span> (dthetaij[i]&lt;0) {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;skip segment with too few points&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    }</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> Eij = GetE(Etot,cumLen[i],m);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      Eij2 = Eij*Eij;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordflow">if</span> ( Eij2 &lt;= m2 ) {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      result = <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::numeric_limits&lt;double&gt;::max</a>();</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> pij = sqrt(Eij2 - m2);<span class="comment">//momentum at this segment</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> beta = sqrt( 1. - ((m2)/(pij*pij + m2)) );</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    constexpr <span class="keywordtype">double</span> HighlandSecondTerm = 0.038;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> tH0 = ( HighlandFirstTerm(pij) / (pij*beta) ) * ( 1.0 + HighlandSecondTerm * std::log( seg_nradl[i] ) ) * sqrt( seg_nradl[i] );</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> rms = sqrt( 2.0*( tH0 * tH0 + theta0x * theta0x ) );</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">if</span> (rms==0.0) {</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot; Error : RMS cannot be zero ! &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">std::numeric_limits&lt;double&gt;::max</a>();</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    }</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> arg = dthetaij[i]/rms;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    result += ( std::log( rms ) + 0.5 * arg * arg + fixedterm);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  }</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;}</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div>
<div class="line"><a name="l00328"></a><span class="lineno"><a class="line" href="../../df/d45/classtrkf_1_1TrajectoryMCSFitter.html#aa06e2f2fd67715657e9864eb9aaf6c38">  328</a></span>&#160;<span class="keywordtype">double</span> TrajectoryMCSFitter::energyLossLandau(<span class="keyword">const</span> <span class="keywordtype">double</span> mass2,<span class="keyword">const</span> <span class="keywordtype">double</span> e2, <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="comment">// eq. (33.11) in http://pdg.lbl.gov/2016/reviews/rpp2016-rev-passage-particles-matter.pdf (except density correction is ignored)</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="keywordflow">if</span> (x&lt;=0.) <span class="keywordflow">return</span> 0.;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  constexpr <span class="keywordtype">double</span> Iinv2 = 1./(188.E-6*188.E-6);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  constexpr <span class="keywordtype">double</span> matConst = 1.4*18./40.;<span class="comment">//density*Z/A</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  constexpr <span class="keywordtype">double</span> me = 0.511;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  constexpr <span class="keywordtype">double</span> kappa = 0.307075;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  constexpr <span class="keywordtype">double</span> j = 0.200;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> beta2 = (e2-mass2)/e2;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> gamma2 = 1./(1.0 - beta2);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> epsilon = 0.5*kappa*x*matConst/beta2;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="keywordflow">return</span> 0.001*epsilon*( log(2.*me*beta2*gamma2*epsilon*Iinv2) + j - beta2 );</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;}</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00346"></a><span class="lineno"><a class="line" href="../../df/d45/classtrkf_1_1TrajectoryMCSFitter.html#affcb5e300f0f9cc67cc46f928ed1282b">  346</a></span>&#160;<span class="keywordtype">double</span> TrajectoryMCSFitter::energyLossBetheBloch(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">mass</a>,<span class="keyword">const</span> <span class="keywordtype">double</span> e2)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="comment">// stolen, mostly, from GFMaterialEffects.</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  constexpr <span class="keywordtype">double</span> Iinv = 1./188.E-6;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  constexpr <span class="keywordtype">double</span> matConst = 1.4*18./40.;<span class="comment">//density*Z/A</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  constexpr <span class="keywordtype">double</span> me = 0.511;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  constexpr <span class="keywordtype">double</span> kappa = 0.307075;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> beta2 = (e2-mass*<a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">mass</a>)/e2;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> gamma2 = 1./(1.0 - beta2);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> massRatio = me/<a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">mass</a>;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> argument = (2.*me*gamma2*beta2*Iinv) * std::sqrt(1+2*std::sqrt(gamma2)*massRatio + massRatio*massRatio);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="keywordtype">double</span> dedx = kappa*matConst/beta2;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="keywordflow">if</span> (mass==0.0) <span class="keywordflow">return</span>(0.0);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="keywordflow">if</span> (argument &lt;= <a class="code" href="../../d6/d11/namespacemake__calib__df.html#ada2bd95dba6a990f1012b56dacc20b0e">exp</a>(beta2)) {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      dedx = 0.;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  } <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    dedx *= (log(argument)-beta2)*1.<a class="code" href="../../d4/d3a/rawtorootconvert_8fcl.html#a073d3febd81cab639f2a8aa357dc5ef1">E</a>-3; <span class="comment">// Bethe-Bloch, converted to GeV/cm</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">if</span> (dedx&lt;0.) dedx = 0.;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="keywordflow">return</span> dedx;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;}</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00370"></a><span class="lineno"><a class="line" href="../../df/d45/classtrkf_1_1TrajectoryMCSFitter.html#ad043d7e8e06578d274a33c92d1dae7bc">  370</a></span>&#160;<span class="keywordtype">double</span> TrajectoryMCSFitter::GetE(<span class="keyword">const</span> <span class="keywordtype">double</span> initial_E, <span class="keyword">const</span> <span class="keywordtype">double</span> length_travelled, <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="keywordflow">if</span> (eLossMode_==1) {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="comment">// ELoss mode: MIP (constant)</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    constexpr <span class="keywordtype">double</span> kcal = 0.002105;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordflow">return</span> (initial_E - kcal*length_travelled);<span class="comment">//energy at this segment</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  }</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <span class="comment">// Non constant energy loss distribution</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> step_size = length_travelled / nElossSteps_;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="keywordtype">double</span> current_E = initial_E;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> m2 = m*<a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">m</a>;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> i = 0; i &lt; nElossSteps_; ++i) {</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordflow">if</span> (eLossMode_==2) {</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="keywordtype">double</span> dedx = energyLossBetheBloch(m,current_E);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      current_E -= (dedx * step_size);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      <span class="comment">// MPV of Landau energy loss distribution</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      current_E -= energyLossLandau(m2,current_E*current_E,step_size);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    }</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">if</span> ( current_E &lt;= m ) {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      <span class="comment">// std::cout&lt;&lt;&quot;WARNING: current_E less than mu mass. it is &quot;&lt;&lt;current_E&lt;&lt;std::endl;</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      <span class="keywordflow">return</span> 0.;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    }</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  }</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="keywordflow">return</span> current_E;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;}</div>
<div class="ttc" id="namespacegeo_html_a22d2a7c73b2795146b92cd54ded9e817"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#a22d2a7c73b2795146b92cd54ded9e817">geo::Vector_t</a></div><div class="ttdeci">ROOT::Math::DisplacementVector3D&lt; ROOT::Math::Cartesian3D&lt; double &gt;, ROOT::Math::GlobalCoordinateSystemTag &gt; Vector_t</div><div class="ttdoc">Type for representation of momenta in 3D space. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7d/geo__vectors_8h_source.html#l00164">geo_vectors.h:164</a></div></div>
<div class="ttc" id="namespacepmtana_html_a9860e62c78db1dd9c7d635a2832b883a"><div class="ttname"><a href="../../da/dc9/namespacepmtana.html#a9860e62c78db1dd9c7d635a2832b883a">pmtana::std</a></div><div class="ttdeci">double std(const std::vector&lt; short &gt; &amp;wf, const double ped_mean, size_t start, size_t nsample)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/de4/UtilFunc_8cxx_source.html#l00042">UtilFunc.cxx:42</a></div></div>
<div class="ttc" id="run__opflash__electron_8fcl_html_a6673f03521899f7844189bcfd8ee5941"><div class="ttname"><a href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a></div><div class="ttdeci">process_name opflash particleana ie x</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d84/run__opflash__electron_8fcl_source.html#l00090">run_opflash_electron.fcl:90</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html_afb2d5aa9d104c3215733c28e7de4be99"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html#afb2d5aa9d104c3215733c28e7de4be99">recob::TrackTrajectory::DirectionAtPoint</a></div><div class="ttdeci">T DirectionAtPoint(unsigned int p) const </div><div class="ttdoc">Direction at point p. Use e.g. as: </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/TrackTrajectory_8h_source.html#l00559">TrackTrajectory.h:559</a></div></div>
<div class="ttc" id="namespacetrkf_html_afce448b0c24542e8646ade72b3bd51b3"><div class="ttname"><a href="../../d0/da2/namespacetrkf.html#afce448b0c24542e8646ade72b3bd51b3">trkf::Vector_t</a></div><div class="ttdeci">recob::tracking::Vector_t Vector_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d2f/TrackState_8h_source.html#l00019">TrackState.h:19</a></div></div>
<div class="ttc" id="classgeo_1_1vect_1_1MiddlePointAccumulatorDim_html"><div class="ttname"><a href="../../d3/dcb/classgeo_1_1vect_1_1MiddlePointAccumulatorDim.html">geo::vect::MiddlePointAccumulatorDim</a></div><div class="ttdoc">Helper class to compute the middle point in a point set. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d6c/geo__vectors__utils_8h_source.html#l01246">geo_vectors_utils.h:1246</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html_adbef272269b31b0a213a9b4de8504d07"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html#adbef272269b31b0a213a9b4de8504d07">recob::TrackTrajectory::LastValidPoint</a></div><div class="ttdeci">size_t LastValidPoint() const </div><div class="ttdoc">Returns the index of the last valid point in the trajectory. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/TrackTrajectory_8h_source.html#l00235">TrackTrajectory.h:235</a></div></div>
<div class="ttc" id="selectors_8fcl_html_a24c8335057af14a9b508d5ac18999ce5"><div class="ttname"><a href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a></div><div class="ttdeci">pdgs p</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd2/selectors_8fcl_source.html#l00022">selectors.fcl:22</a></div></div>
<div class="ttc" id="structgeo_1_1CryostatID_html_a9384db80f2ab08f013fc630316d7bd05"><div class="ttname"><a href="../../d9/d73/structgeo_1_1CryostatID.html#a9384db80f2ab08f013fc630316d7bd05">geo::CryostatID::isValid</a></div><div class="ttdeci">bool isValid</div><div class="ttdoc">Whether this ID points to a valid element. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00211">geo_types.h:211</a></div></div>
<div class="ttc" id="pmttriggerproducer_8fcl_html_a527d89be40c3c20ca8162df059180fd9"><div class="ttname"><a href="../../d7/d5a/pmttriggerproducer_8fcl.html#a527d89be40c3c20ca8162df059180fd9">max</a></div><div class="ttdeci">BEGIN_PROLOG pmt_uncoated ideal single PE test page of manual option are OR or AND window for pmt trigger time start window for pmt trigger time end etc then what events all hists are saved for max</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5a/pmttriggerproducer_8fcl_source.html#l00023">pmttriggerproducer.fcl:23</a></div></div>
<div class="ttc" id="rawtorootconvert_8fcl_html_a073d3febd81cab639f2a8aa357dc5ef1"><div class="ttname"><a href="../../d4/d3a/rawtorootconvert_8fcl.html#a073d3febd81cab639f2a8aa357dc5ef1">E</a></div><div class="ttdeci">process_name E</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d3a/rawtorootconvert_8fcl_source.html#l00026">rawtorootconvert.fcl:26</a></div></div>
<div class="ttc" id="structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult_html_adcd7fcad263fdc2699826ceba11e141d"><div class="ttname"><a href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html#adcd7fcad263fdc2699826ceba11e141d">trkf::TrajectoryMCSFitter::ScanResult::logL</a></div><div class="ttdeci">double logL</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/db3/larreco_2larreco_2RecoAlg_2TrajectoryMCSFitter_8h_source.html#l00160">larreco/larreco/RecoAlg/TrajectoryMCSFitter.h:160</a></div></div>
<div class="ttc" id="SpaceChargeService_8h_html"><div class="ttname"><a href="../../d1/dda/SpaceChargeService_8h.html">SpaceChargeService.h</a></div></div>
<div class="ttc" id="larreco_2larreco_2RecoAlg_2TrajectoryMCSFitter_8h_html"><div class="ttname"><a href="../../d1/db3/larreco_2larreco_2RecoAlg_2TrajectoryMCSFitter_8h.html">TrajectoryMCSFitter.h</a></div></div>
<div class="ttc" id="namespacegen__crt__frags_html_a55a56854d78e363691470c7297fde77c"><div class="ttname"><a href="../../d8/ddf/namespacegen__crt__frags.html#a55a56854d78e363691470c7297fde77c">gen_crt_frags.m</a></div><div class="ttdeci">tuple m</div><div class="ttdoc">now if test mode generate materials, CRT shell, world, gdml header else just generate CRT shell for u...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d8c/gen__crt__frags_8py_source.html#l01347">gen_crt_frags.py:1347</a></div></div>
<div class="ttc" id="classgeo_1_1vect_1_1MiddlePointAccumulatorDim_html_a6c46bfab403c51fa43d4d7a7d4bf7069"><div class="ttname"><a href="../../d3/dcb/classgeo_1_1vect_1_1MiddlePointAccumulatorDim.html#a6c46bfab403c51fa43d4d7a7d4bf7069">geo::vect::MiddlePointAccumulatorDim::add</a></div><div class="ttdeci">void add(Point const &amp;p)</div><div class="ttdoc">Accumulates a point. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d6c/geo__vectors__utils_8h_source.html#l01316">geo_vectors_utils.h:1316</a></div></div>
<div class="ttc" id="sparse__vector__test_8cc_html_a39f16bf854ba527dee7eba5bbbd93f3f"><div class="ttname"><a href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a></div><div class="ttdeci">T abs(T value)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d59/sparse__vector__test_8cc_source.html#l00030">sparse_vector_test.cc:30</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html_a64e9b10abf9f0833b8908e7e5d24a7e1"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html#a64e9b10abf9f0833b8908e7e5d24a7e1">recob::TrackTrajectory::Length</a></div><div class="ttdeci">double Length(size_t startAt=0) const </div><div class="ttdoc">Returns the approximate length of the trajectory. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d36/TrackTrajectory_8cxx_source.html#l00070">TrackTrajectory.cxx:70</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html">recob::TrackTrajectory</a></div><div class="ttdoc">A trajectory in space reconstructed from hits. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/TrackTrajectory_8h_source.html#l00062">TrackTrajectory.h:62</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html_ac5b2211c3729d3b51481f0445df1718c"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html#ac5b2211c3729d3b51481f0445df1718c">recob::TrackTrajectory::LocationAtPoint</a></div><div class="ttdeci">T LocationAtPoint(unsigned int p) const </div><div class="ttdoc">Position at point p. Use e.g. as: </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/TrackTrajectory_8h_source.html#l00547">TrackTrajectory.h:547</a></div></div>
<div class="ttc" id="namespaceicarus_1_1ns_1_1util_html_aac918da84f16d53ad17bab4f817da1c4"><div class="ttname"><a href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">icarus::ns::util::end</a></div><div class="ttdeci">auto end(FixedBins&lt; T, C &gt; const &amp;) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dbd/FixedBins_8h_source.html#l00585">FixedBins.h:585</a></div></div>
<div class="ttc" id="geo__vectors__utils_8h_html"><div class="ttname"><a href="../../d5/d6c/geo__vectors__utils_8h.html">geo_vectors_utils.h</a></div><div class="ttdoc">Utilities to extend the interface of geometry vectors. </div></div>
<div class="ttc" id="structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult_html_af86b03fd30254ff31962a17c2bc8fbb2"><div class="ttname"><a href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html#af86b03fd30254ff31962a17c2bc8fbb2">trkf::TrajectoryMCSFitter::ScanResult::pUnc</a></div><div class="ttdeci">double pUnc</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/db3/larreco_2larreco_2RecoAlg_2TrajectoryMCSFitter_8h_source.html#l00160">larreco/larreco/RecoAlg/TrajectoryMCSFitter.h:160</a></div></div>
<div class="ttc" id="structgeo_1_1TPCID_html"><div class="ttname"><a href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a></div><div class="ttdoc">The data type to uniquely identify a TPC. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00386">geo_types.h:386</a></div></div>
<div class="ttc" id="namespacegeo_1_1vect_html_a22bf6b956ca4ad2050a44810c80c805f"><div class="ttname"><a href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">geo::vect::norm</a></div><div class="ttdeci">auto norm(Vector const &amp;v)</div><div class="ttdoc">Return norm of the specified vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d6c/geo__vectors__utils_8h_source.html#l01202">geo_vectors_utils.h:1202</a></div></div>
<div class="ttc" id="namespacemake__calib__df_html_ada2bd95dba6a990f1012b56dacc20b0e"><div class="ttname"><a href="../../d6/d11/namespacemake__calib__df.html#ada2bd95dba6a990f1012b56dacc20b0e">make_calib_df.exp</a></div><div class="ttdeci">def exp</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d0e/make__calib__df_8py_source.html#l00043">make_calib_df.py:43</a></div></div>
<div class="ttc" id="classrecob_1_1MCSFitResult_html"><div class="ttname"><a href="../../dd/d39/classrecob_1_1MCSFitResult.html">recob::MCSFitResult</a></div><div class="ttdoc">Class storing the result of the Maximum Likelihood fit of Multiple Coulomb Scattering angles between ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df1/MCSFitResult_8h_source.html#l00019">MCSFitResult.h:19</a></div></div>
<div class="ttc" id="classgeo_1_1vect_1_1MiddlePointAccumulatorDim_html_a6ff7d454670025ebad308ef91967545a"><div class="ttname"><a href="../../d3/dcb/classgeo_1_1vect_1_1MiddlePointAccumulatorDim.html#a6ff7d454670025ebad308ef91967545a">geo::vect::MiddlePointAccumulatorDim::middlePoint</a></div><div class="ttdeci">geo::Point_t middlePoint() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d6c/geo__vectors__utils_8h_source.html#l01297">geo_vectors_utils.h:1297</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html_ad935eb6f307165c6c84b659c21ef0c3b"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html#ad935eb6f307165c6c84b659c21ef0c3b">recob::TrackTrajectory::FirstValidPoint</a></div><div class="ttdeci">size_t FirstValidPoint() const </div><div class="ttdoc">Returns the index of the first valid point in the trajectory. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/TrackTrajectory_8h_source.html#l00197">TrackTrajectory.h:197</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html_a16ac7e8b7d7b38c1237c7df1b941dde8"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html#a16ac7e8b7d7b38c1237c7df1b941dde8">recob::TrackTrajectory::InvalidIndex</a></div><div class="ttdeci">static constexpr size_t InvalidIndex</div><div class="ttdoc">Value returned on failed index queries. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/TrackTrajectory_8h_source.html#l00661">TrackTrajectory.h:661</a></div></div>
<div class="ttc" id="structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult_html"><div class="ttname"><a href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html">trkf::TrajectoryMCSFitter::ScanResult</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/db3/larreco_2larreco_2RecoAlg_2TrajectoryMCSFitter_8h_source.html#l00157">larreco/larreco/RecoAlg/TrajectoryMCSFitter.h:157</a></div></div>
<div class="ttc" id="namespacelib_1_1dedx_html_af9508f78ba8143119daa95dbd8220f91"><div class="ttname"><a href="../../d3/d5d/namespacelib_1_1dedx.html#af9508f78ba8143119daa95dbd8220f91">lib.dedx.mass</a></div><div class="ttdeci">float mass</div><div class="ttdef"><b>Definition:</b> <a href="../../df/df9/dedx_8py_source.html#l00047">dedx.py:47</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html_a63a68d3d4608ba73321df782a3e8b430"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html#a63a68d3d4608ba73321df782a3e8b430">recob::TrackTrajectory::NextValidPoint</a></div><div class="ttdeci">size_t NextValidPoint(size_t index) const </div><div class="ttdoc">Returns the index of the next valid point in the trajectory. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/TrackTrajectory_8h_source.html#l00211">TrackTrajectory.h:211</a></div></div>
<div class="ttc" id="structgeo_1_1TPCID_html_a4a7f86b46d9d48a040b7ef5d65973811"><div class="ttname"><a href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">geo::TPCID::TPC</a></div><div class="ttdeci">TPCID_t TPC</div><div class="ttdoc">Index of the TPC within its cryostat. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00406">geo_types.h:406</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html_ae6ee026328118d16658b6094746e7cde"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html#ae6ee026328118d16658b6094746e7cde">recob::TrackTrajectory::StartDirection</a></div><div class="ttdeci">Vector_t StartDirection() const </div><div class="ttdoc">Returns the direction of the trajectory at the first point. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/TrackTrajectory_8h_source.html#l00317">TrackTrajectory.h:317</a></div></div>
<div class="ttc" id="namespacegeo_html_a5a6f22c2aa9d0ccf6ca08bf2773a0541"><div class="ttname"><a href="../../d6/d23/namespacegeo.html#a5a6f22c2aa9d0ccf6ca08bf2773a0541">geo::Point_t</a></div><div class="ttdeci">ROOT::Math::PositionVector3D&lt; ROOT::Math::Cartesian3D&lt; double &gt;, ROOT::Math::GlobalCoordinateSystemTag &gt; Point_t</div><div class="ttdoc">Type for representation of position in physical 3D space. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7d/geo__vectors_8h_source.html#l00184">geo_vectors.h:184</a></div></div>
<div class="ttc" id="PMAlgTracking_8cxx_html_aba288dcf8037152d32ec29330d952878"><div class="ttname"><a href="../../db/dfa/PMAlgTracking_8cxx.html#aba288dcf8037152d32ec29330d952878">Vector_t</a></div><div class="ttdeci">recob::tracking::Vector_t Vector_t</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfa/PMAlgTracking_8cxx_source.html#l00021">PMAlgTracking.cxx:21</a></div></div>
<div class="ttc" id="test__associatedgroupswithleft__full_8fcl_html_a4814f2598ed6acdb806473d732f33889"><div class="ttname"><a href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a></div><div class="ttdeci">physics associatedGroupsWithLeft p1</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dab/test__associatedgroupswithleft__full_8fcl_source.html#l00024">test_associatedgroupswithleft_full.fcl:24</a></div></div>
<div class="ttc" id="Geometry_8h_html"><div class="ttname"><a href="../../d3/d8b/Geometry_8h.html">Geometry.h</a></div><div class="ttdoc">art framework interface to geometry description </div></div>
<div class="ttc" id="messageservice_8fcl_html_a6699b4dbd72f548e48d81c88697d35a6"><div class="ttname"><a href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">cout</a></div><div class="ttdeci">BEGIN_PROLOG could also be cout</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/df5/messageservice_8fcl_source.html#l00010">messageservice.fcl:10</a></div></div>
<div class="ttc" id="structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult_html_a664b011a923b7216b801f30dcea89bce"><div class="ttname"><a href="../../da/d03/structtrkf_1_1TrajectoryMCSFitter_1_1ScanResult.html#a664b011a923b7216b801f30dcea89bce">trkf::TrajectoryMCSFitter::ScanResult::p</a></div><div class="ttdeci">double p</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/db3/larreco_2larreco_2RecoAlg_2TrajectoryMCSFitter_8h_source.html#l00160">larreco/larreco/RecoAlg/TrajectoryMCSFitter.h:160</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
