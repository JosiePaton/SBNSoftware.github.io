<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>PFPUtils.cxx Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_b73b02d482d1c4a3db20c3d9ad52d395.html">srcs</a></li><li class="navelem"><a class="el" href="../../dir_f58b2474d7db671760af109c057c9f12.html">larreco</a></li><li class="navelem"><a class="el" href="../../dir_bfd42686fcf7bc0e8145fd17787a17cd.html">larreco</a></li><li class="navelem"><a class="el" href="../../dir_a92975983e87729a773cfa3b8109c8c3.html">RecoAlg</a></li><li class="navelem"><a class="el" href="../../dir_97d1557fbe068d828f11bc325c855899.html">TCAlg</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">PFPUtils.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d4/d86/PFPUtils_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d6a/PFPUtils_8h.html">larreco/RecoAlg/TCAlg/PFPUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &quot;messagefacility/MessageLogger/MessageLogger.h&quot;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &quot;TDecompSVD.h&quot;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;TMatrixD.h&quot;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;TVectorD.h&quot;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;array&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;bitset&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;limits.h&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;limits&gt;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/de7/GeometryCore_8h.html">larcorealg/Geometry/GeometryCore.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d80/PlaneGeo_8h.html">larcorealg/Geometry/PlaneGeo.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/de9/TPCGeo_8h.html">larcorealg/Geometry/TPCGeo.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d09/PhysicalConstants_8h.html">larcoreobj/SimpleTypesAndConstants/PhysicalConstants.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d48/geo__types_8h.html">larcoreobj/SimpleTypesAndConstants/geo_types.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d7a/DetectorPropertiesData_8h.html">lardataalg/DetectorInfo/DetectorPropertiesData.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/d26/Hit_8h.html">lardataobj/RecoBase/Hit.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/d12/SpacePoint_8h.html">lardataobj/RecoBase/SpacePoint.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/d4b/CalorimetryAlg_8h.html">larreco/Calorimetry/CalorimetryAlg.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/db2/DebugStruct_8h.html">larreco/RecoAlg/TCAlg/DebugStruct.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/df0/StepUtils_8h.html">larreco/RecoAlg/TCAlg/StepUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/d1b/TCShower_8h.html">larreco/RecoAlg/TCAlg/TCShower.h</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d65/TCVertex_8h.html">larreco/RecoAlg/TCAlg/TCVertex.h</a>&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d0a/larreco_2larreco_2RecoAlg_2TCAlg_2Utils_8h.html">larreco/RecoAlg/TCAlg/Utils.h</a>&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;nusimdata/SimulationBase/MCParticle.h&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keyword">namespace </span>tca {</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#ab1fa50d5a4a7a5a1bd31e2e737d2841d">   41</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#ab1fa50d5a4a7a5a1bd31e2e737d2841d">StitchPFPs</a>()</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="comment">// Stitch PFParticles in different TPCs. This does serious damage to PFPStruct and should</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="comment">// only be called from TrajCluster module just before making PFParticles to put in the event</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a0898183aa6813a6ab2cbaede7d31e4d1">slices</a>.size() &lt; 2) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#a8edd7b95c82390f84514f145c0980cc9">NTPC</a>() == 1) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aa629fcaa6260eeeef73145a24a080c72">pfpStitchCuts</a>.size() &lt; 2) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aa629fcaa6260eeeef73145a24a080c72">pfpStitchCuts</a>[0] &lt;= 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordtype">bool</span> prt = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a1bb1637ab9a45e1c90d10ec06a33c64f">dbgStitch</a>;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordflow">if</span> (prt) {</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      std::string fcnLabel = <span class="stringliteral">&quot;SP&quot;</span>;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      myprt &lt;&lt; fcnLabel &lt;&lt; <span class="stringliteral">&quot; cuts &quot;</span> &lt;&lt; sqrt(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aa629fcaa6260eeeef73145a24a080c72">pfpStitchCuts</a>[0]) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aa629fcaa6260eeeef73145a24a080c72">pfpStitchCuts</a>[1]</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      <span class="keywordtype">bool</span> printHeader = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> isl = 0; isl &lt; <a class="code" href="../../de/d0f/namespacetca.html#a0898183aa6813a6ab2cbaede7d31e4d1">slices</a>.size(); ++isl) {</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#ad232469b22f64d38891a7038f0e36ef3">debug</a>.<a class="code" href="../../d8/de4/structtca_1_1DebugStuff.html#ac901269c4139df49416940f02fe60410">Slice</a> &gt;= 0 &amp;&amp; <span class="keywordtype">int</span>(isl) != <a class="code" href="../../de/d0f/namespacetca.html#ad232469b22f64d38891a7038f0e36ef3">debug</a>.<a class="code" href="../../d8/de4/structtca_1_1DebugStuff.html#ac901269c4139df49416940f02fe60410">Slice</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="keyword">auto</span>&amp; slc = <a class="code" href="../../de/d0f/namespacetca.html#a0898183aa6813a6ab2cbaede7d31e4d1">slices</a>[isl];</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <span class="keywordflow">if</span> (slc.pfps.empty()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; pfp : slc.pfps)</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;          <a class="code" href="../../de/d0f/namespacetca.html#a3645ee44c37f63a286b5ad8b95ff786e">PrintP</a>(fcnLabel, myprt, pfp, printHeader);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      } <span class="comment">// slc</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    }   <span class="comment">// prt</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">// lists of pfp UIDs to stitch</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    std::vector&lt;std::vector&lt;int&gt;&gt; stLists;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">for</span> (std::size_t sl1 = 0; sl1 &lt; <a class="code" href="../../de/d0f/namespacetca.html#a0898183aa6813a6ab2cbaede7d31e4d1">slices</a>.size() - 1; ++sl1) {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      <span class="keyword">auto</span>&amp; slc1 = <a class="code" href="../../de/d0f/namespacetca.html#a0898183aa6813a6ab2cbaede7d31e4d1">slices</a>[sl1];</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      <span class="keywordflow">for</span> (std::size_t sl2 = sl1 + 1; sl2 &lt; <a class="code" href="../../de/d0f/namespacetca.html#a0898183aa6813a6ab2cbaede7d31e4d1">slices</a>.size(); ++sl2) {</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="keyword">auto</span>&amp; slc2 = <a class="code" href="../../de/d0f/namespacetca.html#a0898183aa6813a6ab2cbaede7d31e4d1">slices</a>[sl2];</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="comment">// look for PFParticles in the same recob::Slice</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="keywordflow">if</span> (slc1.ID != slc2.ID) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a> : slc1.pfps) {</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a>.ID &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;          <span class="comment">// Can&#39;t stitch shower PFPs</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a>.PDGCode == 1111) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;          <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; p2 : slc2.pfps) {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            <span class="keywordflow">if</span> (p2.ID &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            <span class="comment">// Can&#39;t stitch shower PFPs</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            <span class="keywordflow">if</span> (p2.PDGCode == 1111) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            <span class="keywordtype">float</span> maxSep2 = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aa629fcaa6260eeeef73145a24a080c72">pfpStitchCuts</a>[0];</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            <span class="keywordtype">float</span> maxCth = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aa629fcaa6260eeeef73145a24a080c72">pfpStitchCuts</a>[1];</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            <span class="keywordtype">bool</span> gotit = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../d1/dbb/test__associatedgroups__full_8fcl.html#a07fbfef6c53a7ed684db7d9f21876cb8">e1</a> = 0; <a class="code" href="../../d1/dbb/test__associatedgroups__full_8fcl.html#a07fbfef6c53a7ed684db7d9f21876cb8">e1</a> &lt; 2; ++<a class="code" href="../../d1/dbb/test__associatedgroups__full_8fcl.html#a07fbfef6c53a7ed684db7d9f21876cb8">e1</a>) {</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;              <span class="keyword">auto</span> pos1 = <a class="code" href="../../de/d0f/namespacetca.html#a42ad47f82498fce46d8feb62864d7d08">PosAtEnd</a>(<a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a>, <a class="code" href="../../d1/dbb/test__associatedgroups__full_8fcl.html#a07fbfef6c53a7ed684db7d9f21876cb8">e1</a>);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;              <span class="comment">// require the end to be close to a TPC boundary</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;              <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a58cf1f10cbe4f065ed07eaaef9d3bb2e">InsideFV</a>(slc1, <a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a>, <a class="code" href="../../d1/dbb/test__associatedgroups__full_8fcl.html#a07fbfef6c53a7ed684db7d9f21876cb8">e1</a>)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;              <span class="keyword">auto</span> dir1 = <a class="code" href="../../de/d0f/namespacetca.html#a66ba31f5d3047b3a68011a4e154891fc">DirAtEnd</a>(<a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a>, <a class="code" href="../../d1/dbb/test__associatedgroups__full_8fcl.html#a07fbfef6c53a7ed684db7d9f21876cb8">e1</a>);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;              <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> e2 = 0; e2 &lt; 2; ++e2) {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                <span class="keyword">auto</span> pos2 = <a class="code" href="../../de/d0f/namespacetca.html#a42ad47f82498fce46d8feb62864d7d08">PosAtEnd</a>(p2, e2);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                <span class="comment">// require the end to be close to a TPC boundary</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a58cf1f10cbe4f065ed07eaaef9d3bb2e">InsideFV</a>(slc2, p2, e2)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                <span class="keyword">auto</span> dir2 = <a class="code" href="../../de/d0f/namespacetca.html#a66ba31f5d3047b3a68011a4e154891fc">DirAtEnd</a>(p2, e2);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                <span class="keywordtype">float</span> sep = <a class="code" href="../../de/d0f/namespacetca.html#a1c2bea68a634d09340f7921072d5acda">PosSep2</a>(pos1, pos2);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                <span class="keywordflow">if</span> (sep &gt; maxSep2) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                <span class="keywordtype">float</span> cth = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(<a class="code" href="../../de/d0f/namespacetca.html#ac7453ffded371a6c148f116b8c0042c9">DotProd</a>(dir1, dir2));</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                <span class="keywordflow">if</span> (cth &lt; maxCth) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                maxSep2 = sep;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                maxCth = cth;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                gotit = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;              } <span class="comment">// e2</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            }   <span class="comment">// e1</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            <span class="keywordflow">if</span> (!gotit) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <span class="keywordflow">if</span> (prt) {</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;              mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;              myprt &lt;&lt; <span class="stringliteral">&quot;Stitch slice &quot;</span> &lt;&lt; slc1.ID &lt;&lt; <span class="stringliteral">&quot; P&quot;</span> &lt;&lt; <a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a>.UID &lt;&lt; <span class="stringliteral">&quot; TPC &quot;</span> &lt;&lt; <a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a>.TPCID.TPC;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;              myprt &lt;&lt; <span class="stringliteral">&quot; and P&quot;</span> &lt;&lt; p2.UID &lt;&lt; <span class="stringliteral">&quot; TPC &quot;</span> &lt;&lt; p2.TPCID.TPC;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;              myprt &lt;&lt; <span class="stringliteral">&quot; sep &quot;</span> &lt;&lt; sqrt(maxSep2) &lt;&lt; <span class="stringliteral">&quot; maxCth &quot;</span> &lt;&lt; maxCth;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            <span class="comment">// see if either of these are in a list</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            <span class="keywordtype">bool</span> added = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; pm : stLists) {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;              <span class="keywordtype">bool</span> p1InList = (std::find(pm.begin(), pm.end(), <a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a>.UID) != pm.end());</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;              <span class="keywordtype">bool</span> p2InList = (std::find(pm.begin(), pm.end(), p2.UID) != pm.end());</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;              <span class="keywordflow">if</span> (p1InList || p2InList) {</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                <span class="keywordflow">if</span> (p1InList) pm.push_back(p2.UID);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                <span class="keywordflow">if</span> (p2InList) pm.push_back(<a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a>.UID);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                added = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;              }</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            } <span class="comment">// pm</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            <span class="keywordflow">if</span> (added) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            <span class="comment">// start a new list</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            std::vector&lt;int&gt; tmp(2);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            tmp[0] = <a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a>.UID;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            tmp[1] = p2.UID;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            stLists.push_back(tmp);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;          } <span class="comment">// p2</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        }   <span class="comment">// p1</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      }     <span class="comment">// sl2</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    }       <span class="comment">// sl1</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordflow">if</span> (stLists.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; stl : stLists) {</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      <span class="comment">// Find the endpoints of the stitched pfp</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      <span class="keywordtype">float</span> minZ = 1E6;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      std::pair&lt;unsigned short, unsigned short&gt; minZIndx;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> minZEnd = 2;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> puid : stl) {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="keyword">auto</span> slcIndex = <a class="code" href="../../de/d0f/namespacetca.html#a7dbcd7ee5aae3d1625e91bd338f19cb9">GetSliceIndex</a>(<span class="stringliteral">&quot;P&quot;</span>, puid);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="keywordflow">if</span> (slcIndex.first == USHRT_MAX) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keyword">auto</span>&amp; pfp = <a class="code" href="../../de/d0f/namespacetca.html#a0898183aa6813a6ab2cbaede7d31e4d1">slices</a>[slcIndex.first].pfps[slcIndex.second];</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> = 0; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> &lt; 2; ++<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>) {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;          <span class="keyword">auto</span> pos = <a class="code" href="../../de/d0f/namespacetca.html#a42ad47f82498fce46d8feb62864d7d08">PosAtEnd</a>(pfp, <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;          <span class="keywordflow">if</span> (pos[2] &lt; minZ) {</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            minZ = pos[2];</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            minZIndx = slcIndex;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            minZEnd = <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;          }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        } <span class="comment">// end</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      }   <span class="comment">// puid</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <span class="keywordflow">if</span> (minZEnd &gt; 1) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      <span class="comment">// preserve the pfp with the min Z position</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <span class="keyword">auto</span>&amp; pfp = <a class="code" href="../../de/d0f/namespacetca.html#a0898183aa6813a6ab2cbaede7d31e4d1">slices</a>[minZIndx.first].pfps[minZIndx.second];</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      <span class="keywordflow">if</span> (prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;SP: P&quot;</span> &lt;&lt; pfp.UID;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <span class="comment">// add the Tjs in the other slices to it</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> puid : stl) {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="keywordflow">if</span> (puid == pfp.UID) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keyword">auto</span> sIndx = <a class="code" href="../../de/d0f/namespacetca.html#a7dbcd7ee5aae3d1625e91bd338f19cb9">GetSliceIndex</a>(<span class="stringliteral">&quot;P&quot;</span>, puid);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="keywordflow">if</span> (sIndx.first == USHRT_MAX) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keyword">auto</span>&amp; opfp = <a class="code" href="../../de/d0f/namespacetca.html#a0898183aa6813a6ab2cbaede7d31e4d1">slices</a>[sIndx.first].pfps[sIndx.second];</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="keywordflow">if</span> (prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; +P&quot;</span> &lt;&lt; opfp.UID;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        pfp.TjUIDs.insert(pfp.TjUIDs.end(), opfp.TjUIDs.begin(), opfp.TjUIDs.end());</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keywordflow">if</span> (prt) mf::LogVerbatim();</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="comment">// Check for parents and daughters</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="keywordflow">if</span> (opfp.ParentUID &gt; 0) {</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;          <span class="keyword">auto</span> pSlcIndx = <a class="code" href="../../de/d0f/namespacetca.html#a7dbcd7ee5aae3d1625e91bd338f19cb9">GetSliceIndex</a>(<span class="stringliteral">&quot;P&quot;</span>, opfp.ParentUID);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;          <span class="keywordflow">if</span> (pSlcIndx.first &lt; <a class="code" href="../../de/d0f/namespacetca.html#a0898183aa6813a6ab2cbaede7d31e4d1">slices</a>.size()) {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <span class="keyword">auto</span>&amp; parpfp = <a class="code" href="../../de/d0f/namespacetca.html#a0898183aa6813a6ab2cbaede7d31e4d1">slices</a>[pSlcIndx.first].pfps[pSlcIndx.second];</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            std::replace(parpfp.DtrUIDs.begin(), parpfp.DtrUIDs.begin(), opfp.UID, pfp.UID);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;          } <span class="comment">// valid pSlcIndx</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        }   <span class="comment">// has a parent</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> dtruid : opfp.DtrUIDs) {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;          <span class="keyword">auto</span> dSlcIndx = <a class="code" href="../../de/d0f/namespacetca.html#a7dbcd7ee5aae3d1625e91bd338f19cb9">GetSliceIndex</a>(<span class="stringliteral">&quot;P&quot;</span>, dtruid);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;          <span class="keywordflow">if</span> (dSlcIndx.first &lt; <a class="code" href="../../de/d0f/namespacetca.html#a0898183aa6813a6ab2cbaede7d31e4d1">slices</a>.size()) {</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            <span class="keyword">auto</span>&amp; dtrpfp = <a class="code" href="../../de/d0f/namespacetca.html#a0898183aa6813a6ab2cbaede7d31e4d1">slices</a>[dSlcIndx.first].pfps[dSlcIndx.second];</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            dtrpfp.ParentUID = pfp.UID;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;          } <span class="comment">// valid dSlcIndx</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        }   <span class="comment">// dtruid</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="comment">// declare it obsolete</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        opfp.ID = 0;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      } <span class="comment">// puid</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    }   <span class="comment">// stl</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  } <span class="comment">// StitchPFPs</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keywordtype">void</span></div>
<div class="line"><a name="l00190"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a4182bec4cfa5d8982e9403c61ce79c30">  190</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a4182bec4cfa5d8982e9403c61ce79c30">FindPFParticles</a>(<a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html">detinfo::DetectorClocksData</a> <span class="keyword">const</span>&amp; clockData,</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                  <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                  <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc)</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  {</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="comment">// Match Tjs in 3D and create PFParticles</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[0] &lt;= 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a6791841c97826647beefa30b998730e4">FillWireIntersections</a>(slc);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">// clear the TP -&gt; P assn Tjs so that all are considered</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; tj : slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>) {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; tp : tj.Pts)</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        tp.InPFP = 0;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    } <span class="comment">// tj</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordtype">bool</span> prt = (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aec895e58be3fe5a64a2a2418f0e473c7">dbgPFP</a> &amp;&amp; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a13a021fd1f351b551124f4b7f8cef937">dbgSlc</a>);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">// Match these points in 3D</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    std::vector&lt;MatchStruct&gt; matVec;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">// iterate twice (at most), looking for 3-plane matches in long tjs in 3-plane TPCs on the</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">// first iteration, 3-plane matches in short tjs on the second iteration.</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">// and 2-plane matches + dead regions in 3-plane TPCs on the last iteration</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>.clear();</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> maxNit = 2;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="keywordflow">if</span> (slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a> == 2) maxNit = 1;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">if</span> (std::nearbyint(<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[2]) == 0) maxNit = 1;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="comment">// fill the mAllTraj vector with TPs if we aren&#39;t using SpacePoints</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#a022c77c19ed66a47e54dd705a6fc840d">sptHits</a>.empty()) <a class="code" href="../../de/d0f/namespacetca.html#a7636b0975b99bd967cb1cf31cec2609d">FillmAllTraj</a>(detProp, slc);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nit = 0; nit &lt; maxNit; ++nit) {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      matVec.clear();</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <span class="keywordflow">if</span> (slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a> == 3 &amp;&amp; nit == 0) {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="comment">// look for match triplets</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#a59c21cff0144d7bc2dc395ae890bfe97">Match3Planes</a>(slc, matVec);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      }</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="comment">// look for match doublets requiring a dead region in the 3rd plane for 3-plane TPCs</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#a1faf6b0cb0d56d4a3658bb611b4774e8">Match2Planes</a>(slc, matVec);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      <span class="keywordflow">if</span> (matVec.empty()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <span class="keywordflow">if</span> (prt) {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        myprt &lt;&lt; <span class="stringliteral">&quot;nit &quot;</span> &lt;&lt; nit &lt;&lt; <span class="stringliteral">&quot; MVI  Count  Tjs\n&quot;</span>;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> indx = 0; indx &lt; matVec.size(); ++indx) {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;          <span class="keyword">auto</span>&amp; ms = matVec[indx];</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;          myprt &lt;&lt; std::setw(5) &lt;&lt; indx &lt;&lt; std::setw(6) &lt;&lt; (int)ms.Count;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;          <a class="code" href="../../de/ddc/generate__icarus__geometry__splitwire_8pl.html#a566ec0b645c019fdab1b56a230a4b24d">for</a> (<span class="keyword">auto</span> tid : ms.TjIDs)</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            myprt &lt;&lt; <span class="stringliteral">&quot; T&quot;</span> &lt;&lt; tid;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;          <span class="comment">// count the number of TPs in all Tjs</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;          <span class="keywordtype">float</span> tpCnt = 0;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;          <span class="keywordflow">for</span> (<span class="keyword">auto</span> tid : ms.TjIDs) {</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            <span class="keyword">auto</span>&amp; tj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tid - 1];</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            tpCnt += <a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;          } <span class="comment">// tid</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;          <span class="keywordtype">float</span> frac = ms.Count / tpCnt;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;          myprt &lt;&lt; <span class="stringliteral">&quot; matFrac &quot;</span> &lt;&lt; std::fixed &lt;&lt; std::setprecision(3) &lt;&lt; frac;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;          myprt &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        } <span class="comment">// indx</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      }   <span class="comment">// prt</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a3e6119785d4f3a3cf416b16089b50099">MakePFParticles</a>(clockData, detProp, slc, matVec, nit);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    } <span class="comment">// nit</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="comment">// a last debug print</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aec895e58be3fe5a64a2a2418f0e473c7">dbgPFP</a> &amp;&amp; <a class="code" href="../../de/d0f/namespacetca.html#ad232469b22f64d38891a7038f0e36ef3">debug</a>.<a class="code" href="../../d8/de4/structtca_1_1DebugStuff.html#a65233ccccd21a4284acdb6249369473c">MVI</a> != UINT_MAX) {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; pfp : slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">pfps</a>)</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aec895e58be3fe5a64a2a2418f0e473c7">dbgPFP</a> &amp;&amp; pfp.MVI == <a class="code" href="../../de/d0f/namespacetca.html#ad232469b22f64d38891a7038f0e36ef3">debug</a>.<a class="code" href="../../d8/de4/structtca_1_1DebugStuff.html#a65233ccccd21a4284acdb6249369473c">MVI</a>)</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;          <a class="code" href="../../de/d0f/namespacetca.html#a0e6c8605555a6b803b894383785a4cfa">PrintTP3Ds</a>(clockData, detProp, <span class="stringliteral">&quot;FPFP&quot;</span>, slc, pfp, -1);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    } <span class="comment">// last debug print</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>.resize(0);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  } <span class="comment">// FindPFParticles</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l00267"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a3e6119785d4f3a3cf416b16089b50099">  267</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a3e6119785d4f3a3cf416b16089b50099">MakePFParticles</a>(<a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html">detinfo::DetectorClocksData</a> <span class="keyword">const</span>&amp; clockData,</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                  <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                  <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc,</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                  std::vector&lt;MatchStruct&gt; matVec,</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> matVec_Iter)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="comment">// Makes PFParticles using Tjs listed in matVec</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">if</span> (matVec.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordtype">bool</span> prt = (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aec895e58be3fe5a64a2a2418f0e473c7">dbgPFP</a> &amp;&amp; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a13a021fd1f351b551124f4b7f8cef937">dbgSlc</a>);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="comment">// create a PFParticle for each valid match combination</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">for</span> (std::size_t indx = 0; indx &lt; matVec.size(); ++indx) {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="comment">// tone down the level of printing in ReSection</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keywordtype">bool</span> foundMVI = (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aec895e58be3fe5a64a2a2418f0e473c7">dbgPFP</a> &amp;&amp; indx == <a class="code" href="../../de/d0f/namespacetca.html#ad232469b22f64d38891a7038f0e36ef3">debug</a>.<a class="code" href="../../d8/de4/structtca_1_1DebugStuff.html#a65233ccccd21a4284acdb6249369473c">MVI</a> &amp;&amp; matVec_Iter == <a class="code" href="../../de/d0f/namespacetca.html#ad232469b22f64d38891a7038f0e36ef3">debug</a>.<a class="code" href="../../d8/de4/structtca_1_1DebugStuff.html#a7764fa1d95d392a6f3569bcc177e2d20">MVI_Iter</a>);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="keywordflow">if</span> (foundMVI) prt = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <span class="keyword">auto</span>&amp; ms = matVec[indx];</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      <span class="keywordflow">if</span> (foundMVI) {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;found MVI &quot;</span> &lt;&lt; indx &lt;&lt; <span class="stringliteral">&quot; in MakePFParticles ms.Count = &quot;</span> &lt;&lt; ms.Count &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      <span class="comment">// ignore dead matches</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <span class="keywordflow">if</span> (ms.Count == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="comment">// count the number of TPs that are available (not already 3D-matched) and used in a pfp</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      <span class="keywordtype">float</span> npts = 0;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="keywordflow">for</span> (std::size_t itj = 0; itj &lt; ms.TjIDs.size(); ++itj) {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="keyword">auto</span>&amp; tj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[ms.TjIDs[itj] - 1];</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = tj.EndPt[0]; ipt &lt;= tj.EndPt[1]; ++ipt)</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;          <span class="keywordflow">if</span> (tj.Pts[ipt].InPFP == 0) ++npts;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      } <span class="comment">// tjID</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <span class="comment">// Create a vector of PFPs for this match so that we can split it later on if a kink is found</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      std::vector&lt;PFPStruct&gt; pfpVec(1);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      pfpVec[0] = <a class="code" href="../../de/d0f/namespacetca.html#a3bdf0e86f5c07dbf127ee66d6fbbd2e4">CreatePFP</a>(slc);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <span class="comment">// Define the starting set of tjs that were matched. TPs from other tjs may be added later</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      pfpVec[0].TjIDs = ms.TjIDs;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      pfpVec[0].MVI = indx;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <span class="comment">// fill the TP3D points using the 2D trajectory points for Tjs in TjIDs. All</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="comment">// points are put in one section</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a41103f649664649d1a1287437f361bf3">MakeTP3Ds</a>(detProp, slc, pfpVec[0], foundMVI)) {</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="keywordflow">if</span> (foundMVI) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; MakeTP3Ds failed. Too many points already used &quot;</span>;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      }</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      <span class="comment">// fit all the points to get the general direction</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a7045ad35dda0875138741a27c2fa6885">FitSection</a>(clockData, detProp, slc, pfpVec[0], 0)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="keywordflow">if</span> (pfpVec[0].SectionFits[0].ChiDOF &gt; 500 &amp;&amp; !pfpVec[0].Flags[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1ae3c02e1143205b4d7a8e93437965aa47">kSmallAngle</a>]) {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <span class="keywordflow">if</span> (foundMVI)</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;          mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; crazy high ChiDOF P&quot;</span> &lt;&lt; pfpVec[0].ID &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                                &lt;&lt; pfpVec[0].SectionFits[0].ChiDOF &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#ae5fbafb8d23680635343a083b8fd7b11">Recover</a>(clockData, detProp, slc, pfpVec[0], foundMVI);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      }</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <span class="comment">// sort the points by the distance along the general direction vector</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a881a9f856411db2bb90b1964068712f5">SortSection</a>(pfpVec[0], 0)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <span class="comment">// define a junk pfp to be short with low MCSMom. These are likely to be shower-like</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="comment">// pfps. A simple 3D line fit will be done. No attempt will be made to reconstruct it</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      <span class="comment">// in sections or to look for kinks</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      npts = pfpVec[0].TP3Ds.size();</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      pfpVec[0].AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da2a2fbf12f53411c1338f1cf546b62cc3">kJunk3D</a>] = (npts &lt; 20 &amp;&amp; <a class="code" href="../../de/d0f/namespacetca.html#a712fa9841aa560d0298a3bd5fda51bb8">MCSMom</a>(slc, pfpVec[0].TjIDs) &lt; 50) || (npts &lt; 10);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="keywordflow">if</span> (prt) {</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keyword">auto</span>&amp; pfp = pfpVec[0];</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        myprt &lt;&lt; <span class="stringliteral">&quot; indx &quot;</span> &lt;&lt; matVec_Iter &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; indx &lt;&lt; <span class="stringliteral">&quot; Count &quot;</span> &lt;&lt; std::setw(5)</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;              &lt;&lt; (int)ms.Count;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        myprt &lt;&lt; <span class="stringliteral">&quot; P&quot;</span> &lt;&lt; pfpVec[0].ID;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        myprt &lt;&lt; <span class="stringliteral">&quot; -&gt;&quot;</span>;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <a class="code" href="../../de/ddc/generate__icarus__geometry__splitwire_8pl.html#a566ec0b645c019fdab1b56a230a4b24d">for</a> (<span class="keyword">auto</span>&amp; tjid : pfp.TjIDs)</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;          myprt &lt;&lt; <span class="stringliteral">&quot; T&quot;</span> &lt;&lt; tjid;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        myprt &lt;&lt; <span class="stringliteral">&quot; projInPlane&quot;</span>;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = 0; plane &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>; ++plane) {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;          <a class="code" href="../../de/d0f/namespacetca.html#a0c55ac735de824c3e089bcbea9addb71">CTP_t</a> inCTP = <a class="code" href="../../de/d0f/namespacetca.html#a8806e1c32119afbfe02dff4c21cf3e57">EncodeCTP</a>(pfp.TPCID.Cryostat, pfp.TPCID.TPC, plane);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;          <span class="keyword">auto</span> tp = <a class="code" href="../../de/d0f/namespacetca.html#abf31bab3395b5e2325f017d9b7db50db">MakeBareTP</a>(detProp, slc, pfp.SectionFits[0].Pos, pfp.SectionFits[0].Dir, inCTP);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;          myprt &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; std::setprecision(2) &lt;&lt; tp.Delta;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        } <span class="comment">// plane</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        myprt &lt;&lt; <span class="stringliteral">&quot; maxTjLen &quot;</span> &lt;&lt; (int)<a class="code" href="../../de/d0f/namespacetca.html#a2f935445887380c41861a5874f80ad84">MaxTjLen</a>(slc, pfp.TjIDs);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        myprt &lt;&lt; <span class="stringliteral">&quot; MCSMom &quot;</span> &lt;&lt; <a class="code" href="../../de/d0f/namespacetca.html#a712fa9841aa560d0298a3bd5fda51bb8">MCSMom</a>(slc, pfp.TjIDs);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        myprt &lt;&lt; <span class="stringliteral">&quot; PDGCodeVote &quot;</span> &lt;&lt; <a class="code" href="../../de/d0f/namespacetca.html#a3522a953c66af70a71df4f85857acae4">PDGCodeVote</a>(clockData, detProp, slc, pfp);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        myprt &lt;&lt; <span class="stringliteral">&quot; nTP3Ds &quot;</span> &lt;&lt; pfp.TP3Ds.size();</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        myprt &lt;&lt; <span class="stringliteral">&quot; Reco3DRange &quot;</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;              &lt;&lt; <a class="code" href="../../de/d0f/namespacetca.html#a4cef0a0d26986f9f4e9b724f7b9c1d38">Find3DRecoRange</a>(slc, pfp, 0, (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[3], 1);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      } <span class="comment">// prt</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <span class="keywordflow">if</span> (foundMVI) { <a class="code" href="../../de/d0f/namespacetca.html#a0e6c8605555a6b803b894383785a4cfa">PrintTP3Ds</a>(clockData, detProp, <span class="stringliteral">&quot;FF&quot;</span>, slc, pfpVec[0], -1); }</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ip = 0; ip &lt; pfpVec.size(); ++ip) {</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="keyword">auto</span>&amp; pfp = pfpVec[ip];</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="comment">// set the end flag bits</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a> tpcid;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> = 0; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> &lt; 2; ++<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>) {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;          <span class="comment">// first set them all to 0</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;          pfp.EndFlag[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>].reset();</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;          <span class="keyword">auto</span> pos = <a class="code" href="../../de/d0f/namespacetca.html#a42ad47f82498fce46d8feb62864d7d08">PosAtEnd</a>(pfp, <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;          <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a7f663b1f0cd693167cdf6aa76532b4d3">InsideTPC</a>(pos, tpcid)) pfp.EndFlag[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aaf48aae9eb0d23a230ca10aeceb9411f8">kOutFV</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        } <span class="comment">// end</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="comment">// Set kink flag and create a vertex between this pfp and the previous one that was stored</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <span class="keywordflow">if</span> (ip &gt; 0) {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;          pfp.EndFlag[0][<a class="code" href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa8a209073700148c7515fa38bae5e2873">kAtKink</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;          <a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html">Vtx3Store</a> vx3;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;          vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#ac14cedb2c2faa07bb9af1ea6296fcd00">TPCID</a> = pfp.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#ad779a535f3e0ba563bf8e30214a123f3">TPCID</a>;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;          vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#a640bed614f7afb427cb1ce319ca2ae6b">X</a> = pfp.TP3Ds[0].Pos[0];</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;          vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#ab0cbe58e29e2770cbd97c2ede779e9b9">Y</a> = pfp.TP3Ds[0].Pos[1];</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;          vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#a5019583e0e7c6cf6b01bbf7041b0b13b">Z</a> = pfp.TP3Ds[0].Pos[2];</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;          <span class="comment">// TODO: Errors, Score?</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;          vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#a731551f16bbbc1e75e48e55e6356014b">Score</a> = 100;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;          vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#a9471a42a7a11d12130d48cf2e2795966">Vx2ID</a>.resize(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;          vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#a96d7d39b4008750878ef4048f45ab937">Wire</a> = -2;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;          vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#aee823c71f832466c9ad5eb7934e375c7">ID</a> = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae45d2a3a7b612c6f11637ed8f09e5e83">vtx3s</a>.size() + 1;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;          vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#aa7c85bb03367fc57566553163a3492db">Primary</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;          ++<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#aafdfe819a43d7698d960971ca831306e">global3V_UID</a>;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;          vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#a73e9a57be9a4219c61af41014128d4be">UID</a> = <a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#aafdfe819a43d7698d960971ca831306e">global3V_UID</a>;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;          slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae45d2a3a7b612c6f11637ed8f09e5e83">vtx3s</a>.push_back(vx3);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;          pfp.Vx3ID[0] = vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#aee823c71f832466c9ad5eb7934e375c7">ID</a>;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;          <span class="keyword">auto</span>&amp; prevPFP = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">pfps</a>[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">pfps</a>.size() - 1];</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;          prevPFP.Vx3ID[1] = vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#aee823c71f832466c9ad5eb7934e375c7">ID</a>;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        } <span class="comment">// ip &gt; 0</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <span class="comment">// check for a valid two-plane match with a Tj in the third plane for long pfps.</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="comment">// For short pfps, it is possible that a Tj would be too short to be reconstructed</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="comment">// in the third plane.</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        <span class="keywordflow">if</span> (pfp.TjIDs.size() == 2 &amp;&amp; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a> == 3 &amp;&amp; pfp.TP3Ds.size() &gt; 20 &amp;&amp;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            !<a class="code" href="../../de/d0f/namespacetca.html#ac82285eff8fcdf6ba7a4b74ded6adcd8">ValidTwoPlaneMatch</a>(detProp, slc, pfp)) {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <span class="comment">// Skip this combination if it isn&#39;t reconstructable in 3D</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a4cef0a0d26986f9f4e9b724f7b9c1d38">Find3DRecoRange</a>(slc, pfp, 0, (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[3], 1) == USHRT_MAX)</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="comment">// See if it possible to reconstruct in more than one section</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        pfp.Flags[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1a10329bf0d918d9281fd2740f70db322b">kCanSection</a>] = <a class="code" href="../../de/d0f/namespacetca.html#a2132931ff530dd0e4eccfbe863c2f764">CanSection</a>(slc, pfp);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="comment">// Do a fit in multiple sections if the initial fit is poor</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        <span class="keywordflow">if</span> (pfp.SectionFits[0].ChiDOF &lt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[5]) {</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;          <span class="comment">// Good fit with one section</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;          pfp.Flags[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1a16c8b0d8524fc0914afc3dab9bf89950">kNeedsUpdate</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        }</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pfp.Flags[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1a10329bf0d918d9281fd2740f70db322b">kCanSection</a>]) {</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;          <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#ad00890e918d6615215d6b43dec3c0ada">ReSection</a>(clockData, detProp, slc, pfp, foundMVI)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        } <span class="comment">// CanSection</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="keywordflow">if</span> (foundMVI) { <a class="code" href="../../de/d0f/namespacetca.html#a0e6c8605555a6b803b894383785a4cfa">PrintTP3Ds</a>(clockData, detProp, <span class="stringliteral">&quot;RS&quot;</span>, slc, pfp, -1); }</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="comment">// FillGaps3D looks for gaps in the TP3Ds vector caused by broken trajectories and</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="comment">// inserts new TP3Ds if there are hits in the gaps. This search is only done in a</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <span class="comment">// plane if the projection of the pfp results in a large angle where 2D reconstruction</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        <span class="comment">// is likely to be poor - not true for TCWork2</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#ae9e0a86f0ca2a8797635a11ea700f74f">FillGaps3D</a>(clockData, detProp, slc, pfp, foundMVI);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <span class="comment">// Check the TP3D -&gt; TP assn, resolve conflicts and set TP -&gt; InPFP</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#aed0952f85d1f09fdc3802b2eb1cb8d07">ReconcileTPs</a>(slc, pfp, foundMVI)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="comment">// Look for mis-placed 2D and 3D vertices</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#ae8eec67647640ee5f3c0eaf79ebcc127">ReconcileVertices</a>(slc, pfp, foundMVI);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <span class="comment">// Set isGood</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; tp3d : pfp.TP3Ds) {</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;          <span class="keywordflow">if</span> (tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a088d286995bc5cfcaa1f8f26a78f0a67">kTP3DBad</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;          <span class="keyword">auto</span>&amp; tp = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tp3d.TjID - 1].Pts[tp3d.TPIndex];</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;          <span class="keywordflow">if</span> (tp.Environment[<a class="code" href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525ae8d79f565a18dd6877b890fa7cb6616b">kEnvOverlap</a>]) tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        } <span class="comment">// tp3d</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#a755bdf394aea4c92dcbf935a7d7b2c7a">FilldEdx</a>(clockData, detProp, slc, pfp);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        pfp.PDGCode = <a class="code" href="../../de/d0f/namespacetca.html#a3522a953c66af70a71df4f85857acae4">PDGCodeVote</a>(clockData, detProp, slc, pfp);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aec895e58be3fe5a64a2a2418f0e473c7">dbgPFP</a> &amp;&amp; pfp.MVI == <a class="code" href="../../de/d0f/namespacetca.html#ad232469b22f64d38891a7038f0e36ef3">debug</a>.<a class="code" href="../../d8/de4/structtca_1_1DebugStuff.html#a65233ccccd21a4284acdb6249369473c">MVI</a>)</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;          <a class="code" href="../../de/d0f/namespacetca.html#a0e6c8605555a6b803b894383785a4cfa">PrintTP3Ds</a>(clockData, detProp, <span class="stringliteral">&quot;STORE&quot;</span>, slc, pfp, -1);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a8046762858ae84edee746a126116196d">StorePFP</a>(slc, pfp)) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      } <span class="comment">// ip (iterate over split pfps)</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    }   <span class="comment">// indx (iterate over matchVec entries)</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>.resize(0);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  } <span class="comment">// MakePFParticles</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span></div>
<div class="line"><a name="l00426"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#aed0952f85d1f09fdc3802b2eb1cb8d07">  426</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#aed0952f85d1f09fdc3802b2eb1cb8d07">ReconcileTPs</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp, <span class="keywordtype">bool</span> prt)</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  {</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="comment">// Reconcile TP -&gt; P assns before the pfp is stored. The TP3D -&gt; TP is defined but</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="comment">// the TP -&gt; P assn may not have been done. This function overwrites the TjIDs</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="comment">// vector to be the list of Tjs that contribute &gt; 80% of their TPs to this pfp.</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="comment">// This function returns true if the assns are consistent.</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5dacae91fbe7d762fa4646bc9c47fd4ff41">kRTPs3D</a>]) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordflow">if</span>(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1ae3c02e1143205b4d7a8e93437965aa47">kSmallAngle</a>]) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">TjIDs</a>.empty()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.empty()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a51b8e48c9df5507929ae0b6429cc7494">ID</a> &lt;= 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="comment">//                  Tj ID, TP count</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    std::vector&lt;std::pair&lt;int, float&gt;&gt; tjTPCnt;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; tp3d : pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>) {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      <span class="keywordflow">if</span> (tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a088d286995bc5cfcaa1f8f26a78f0a67">kTP3DBad</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <span class="keywordflow">if</span> (tp3d.TjID &lt;= 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <span class="comment">// compare the TP3D -&gt; TP -&gt; P assn with the P -&gt; TP assn</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      <span class="keyword">auto</span>&amp; tp = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tp3d.TjID - 1].Pts[tp3d.TPIndex];</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      <span class="keywordflow">if</span> (tp.InPFP &gt; 0 &amp;&amp; tp.InPFP != pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a51b8e48c9df5507929ae0b6429cc7494">ID</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      <span class="comment">// find the (Tj ID, TP count) pair in the list</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> indx = 0;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      <span class="keywordflow">for</span> (indx = 0; indx &lt; tjTPCnt.size(); ++indx)</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        <span class="keywordflow">if</span> (tjTPCnt[indx].<a class="code" href="../../d4/d43/namespacechannelDBConverter.html#af481fa22253619167bce75a37e10ec34">first</a> == tp3d.TjID) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      <span class="keywordflow">if</span> (indx == tjTPCnt.size()) tjTPCnt.push_back(std::make_pair(tp3d.TjID, 0));</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      ++tjTPCnt[indx].second;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      <span class="comment">// make the TP -&gt; P assn</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      tp.InPFP = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a51b8e48c9df5507929ae0b6429cc7494">ID</a>;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    } <span class="comment">// tp3d</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    std::vector&lt;int&gt; nTjIDs;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; tjtpcnt : tjTPCnt) {</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      <span class="keyword">auto</span>&amp; tj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tjtpcnt.first - 1];</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      <span class="keywordtype">float</span> npwc = <a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <span class="keywordflow">if</span> (tjtpcnt.second &gt; 0.8 * npwc) nTjIDs.push_back(tjtpcnt.first);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    } <span class="comment">// tjtpcnt</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordflow">if</span> (prt) { mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;RTPs3D: P&quot;</span> &lt;&lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a51b8e48c9df5507929ae0b6429cc7494">ID</a> &lt;&lt; <span class="stringliteral">&quot; nTjIDs &quot;</span> &lt;&lt; nTjIDs.size(); }</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="comment">// TODO: is this really a failure?</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordflow">if</span> (nTjIDs.size() &lt; 2) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">TjIDs</a> = nTjIDs;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  } <span class="comment">// ReconcileTPs</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l00473"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a64e2d4be5cb33c9165b6a654a3ece4b0">  473</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#aed0952f85d1f09fdc3802b2eb1cb8d07">ReconcileTPs</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc)</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="comment">// Reconciles TP ownership conflicts between PFParticles</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="comment">// Make a one-to-one TP -&gt; P assn and look for one-to-many assns.</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="comment">// Note: Comparing the pulls for a TP to two different PFParticles generally results</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="comment">// in selecting the first PFParticle that was made which is not too surprising considering</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="comment">// the order in which they were created. This comparison has been commented out in favor</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="comment">// of simply keeping the old assn and removing the new one by setting IsBad true.</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5dacae91fbe7d762fa4646bc9c47fd4ff41">kRTPs3D</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="comment">// make a list of T -&gt; P assns</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    std::vector&lt;int&gt; TinP;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; pfp : slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">pfps</a>) {</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      <span class="keywordflow">if</span> (pfp.ID &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      <span class="keywordflow">if</span>(pfp.Flags[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1ae3c02e1143205b4d7a8e93437965aa47">kSmallAngle</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <span class="keywordflow">for</span> (std::size_t ipt = 0; ipt &lt; pfp.TP3Ds.size(); ++ipt) {</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="keyword">auto</span>&amp; tp3d = pfp.TP3Ds[ipt];</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <span class="keywordflow">if</span> (tp3d.TjID &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <span class="keywordflow">if</span> (std::find(TinP.begin(), TinP.end(), tp3d.TjID) == TinP.end()) TinP.push_back(tp3d.TjID);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="keyword">auto</span>&amp; tp = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tp3d.TjID - 1].Pts[tp3d.TPIndex];</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <span class="keywordflow">if</span> (tp.InPFP &gt; 0) {</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;          <span class="comment">// an assn exists. Set the overlap bit and check consistency</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;          tp.Environment[<a class="code" href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525ae8d79f565a18dd6877b890fa7cb6616b">kEnvOverlap</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;          <span class="comment">// keep the previous assn (since it was created earlier and is more credible) and remove the new one</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;          tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a088d286995bc5cfcaa1f8f26a78f0a67">kTP3DBad</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;          tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;          tp.InPFP = 0;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        }</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;          <span class="comment">// no assn exists</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;          tp.InPFP = pfp.ID;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        } <span class="comment">// tp.InPFP &gt; 0</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      }   <span class="comment">// ipt</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    }     <span class="comment">// pfp</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  }       <span class="comment">// ReconcileTPs</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l00512"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a42ce66d56be0b95199691ad351941268">  512</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a42ce66d56be0b95199691ad351941268">MakePFPTjs</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc)</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="comment">// This function clobbers all of the tjs that are used in TP3Ds in the pfp and replaces</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="comment">// them with new tjs that have a consistent set of TPs to prepare for putting them</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="comment">// into the event. Note that none of the Tjs are attached to 2D vertices.</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5dac2eaa8f8e5d6efa4f5b85b26f533ef38">kMakePFPTjs</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="comment">// kill trajectories</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    std::vector&lt;int&gt; killme;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; pfp : slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">pfps</a>) {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="keywordflow">if</span> (pfp.ID &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; tp3d : pfp.TP3Ds) {</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <span class="keywordflow">if</span> (tp3d.TjID &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <span class="keywordflow">if</span> (tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a088d286995bc5cfcaa1f8f26a78f0a67">kTP3DBad</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordflow">if</span> (std::find(killme.begin(), killme.end(), tp3d.TjID) == killme.end())</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;          killme.push_back(tp3d.TjID);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      } <span class="comment">// tp3d</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    }   <span class="comment">// pfp</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordtype">bool</span> prt = (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aec895e58be3fe5a64a2a2418f0e473c7">dbgPFP</a>);</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> tid : killme)</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#af4498155f5589b440a3c4c8fa56ebb5a">MakeTrajectoryObsolete</a>(slc, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(tid - 1));</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="comment">// Make template trajectories in each plane. These will be re-used by</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="comment">// each PFParticle</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    std::vector&lt;Trajectory&gt; ptjs(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="comment">// define the basic tj variables</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = 0; plane &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>; ++plane) {</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      ptjs[plane].Pass = 0;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      ptjs[plane].CTP = <a class="code" href="../../de/d0f/namespacetca.html#a8806e1c32119afbfe02dff4c21cf3e57">EncodeCTP</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>, slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>, plane);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="comment">// This Tj wasn&#39;t created by stepping</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      ptjs[plane].StepDir = 0;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      <span class="comment">// It was created by this function however</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      ptjs[plane].AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5dac2eaa8f8e5d6efa4f5b85b26f533ef38">kMakePFPTjs</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="comment">// and is 3D matched</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      ptjs[plane].AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da6ffcff8d6a31c1e1662e99d73d544e86">kMat3D</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    } <span class="comment">// plane</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="comment">// now make the new Tjs</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; pfp : slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">pfps</a>) {</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <span class="keywordflow">if</span> (pfp.ID &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <span class="comment">// initialize the tjs</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = 0; plane &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>; ++plane) {</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        ptjs[plane].Pts.clear();</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        --<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ae1a29531c613e9b8c7b5ada6e81e6eb4">WorkID</a>;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ae1a29531c613e9b8c7b5ada6e81e6eb4">WorkID</a> == INT_MIN) <a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ae1a29531c613e9b8c7b5ada6e81e6eb4">WorkID</a> = -1;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        ptjs[plane].ID = <a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ae1a29531c613e9b8c7b5ada6e81e6eb4">WorkID</a>;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      } <span class="comment">// plane</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      pfp.TjIDs.clear();</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      <span class="comment">// iterate through all of the TP3Ds, adding TPs to the TJ in the appropriate plane.</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      <span class="comment">// The assumption here is that TP order reflects the TP3D order</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; tp3d : pfp.TP3Ds) {</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <span class="keywordflow">if</span> (tp3d.TjID &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <span class="keywordflow">if</span> (tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a088d286995bc5cfcaa1f8f26a78f0a67">kTP3DBad</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <span class="comment">// make a copy of the 2D TP</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <span class="keyword">auto</span> tp = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tp3d.TjID - 1].Pts[tp3d.TPIndex];</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <span class="keywordflow">if</span> (tp.InPFP &gt; 0 &amp;&amp; tp.InPFP != pfp.ID) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        tp.InPFP = pfp.ID;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        <span class="comment">// the TP Step isn&#39;t useful anymore, so stash the original TJ ID into it</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        tp.Step = tp3d.TjID;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(tp.CTP).<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        <span class="comment">// append it to Pts</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        ptjs[plane].Pts.push_back(tp);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      } <span class="comment">// tp3d</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      <span class="comment">// finish defining each of the Tjs and store them</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      <span class="comment">// new tj ID indexed by plane</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      std::vector&lt;int&gt; tids(ptjs.size(), 0);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = 0; plane &lt; ptjs.size(); ++plane) {</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        <span class="keyword">auto</span>&amp; tj = ptjs[plane];</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="keywordflow">if</span> (tj.Pts.size() &lt; 2) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        tj.PDGCode = pfp.PDGCode;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        tj.MCSMom = <a class="code" href="../../de/d0f/namespacetca.html#a712fa9841aa560d0298a3bd5fda51bb8">MCSMom</a>(slc, tj);</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a600e672c966d327de25fc13318997550">StoreTraj</a>(slc, tj)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <span class="comment">// associate it with the pfp</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <span class="keyword">auto</span>&amp; newTj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>.back();</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        pfp.TjIDs.push_back(newTj.ID);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        tids[plane] = newTj.ID;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      } <span class="comment">// tj</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      <span class="comment">// preserve the PFP -&gt; 3V -&gt; 2V -&gt; T assns</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> = 0; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> &lt; 2; ++<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>) {</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        <span class="keywordflow">if</span>(pfp.Vx3ID[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>] &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="keyword">auto</span>&amp; vx3 = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae45d2a3a7b612c6f11637ed8f09e5e83">vtx3s</a>[pfp.Vx3ID[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>] - 1];</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = 0; plane &lt; ptjs.size(); ++plane) {</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;          <span class="keywordflow">if</span>(tids[plane] == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;          <span class="keywordflow">if</span>(vx3.Vx2ID[plane] &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;          <span class="keyword">auto</span>&amp; vx2 = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad94c65623983dd14ecee8a4166c6e582">vtxs</a>[vx3.Vx2ID[plane] - 1];</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;          <span class="keyword">auto</span>&amp; tj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tids[plane] - 1];</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;          <span class="keyword">auto</span> tend = <a class="code" href="../../de/d0f/namespacetca.html#afac6aad0fd573134e07bd1e783b8853f">CloseEnd</a>(slc, tj, vx2.Pos);</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;          tj.VtxID[tend] = vx2.ID;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;          <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;MPFPTjs: 3V&quot;</span> &lt;&lt; vx3.ID &lt;&lt; <span class="stringliteral">&quot; -&gt; 2V&quot;</span> &lt;&lt; vx2.ID</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot; -&gt; T&quot;</span> &lt;&lt; tj.ID &lt;&lt; <span class="stringliteral">&quot;_&quot;</span> &lt;&lt; tend &lt;&lt; <span class="stringliteral">&quot; in plane &quot;</span> &lt;&lt; plane;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        } <span class="comment">// plane</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      } <span class="comment">// end</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    }   <span class="comment">// pfp</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  }     <span class="comment">// MakePFPTjs</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l00611"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a6791841c97826647beefa30b998730e4">  611</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a6791841c97826647beefa30b998730e4">FillWireIntersections</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc)</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  {</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="comment">// Find wire intersections and put them in evt.wireIntersections</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="comment">// see if anything needs to be done</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#abd581d77b47c61e2dba9ffba63aa9f3c">wireIntersections</a>.empty() &amp;&amp; <a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#abd581d77b47c61e2dba9ffba63aa9f3c">wireIntersections</a>[0].tpc == slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#abd581d77b47c61e2dba9ffba63aa9f3c">wireIntersections</a>.clear();</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cstat = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tpc = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="comment">// find the minMax number of wires in each plane of the TPC</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxWire = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a2bfd4002c7f6fbe64e1fc1591682870b">nWires</a>[0];</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> nw : slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a2bfd4002c7f6fbe64e1fc1591682870b">nWires</a>)</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <span class="keywordflow">if</span> (nw &lt; maxWire) maxWire = nw;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="comment">// Start looking for intersections in the middle</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> firstWire = maxWire / 2;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="comment">// find a valid wire intersection in all plane combinations</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    std::vector&lt;std::pair&lt;unsigned short, unsigned short&gt;&gt; pln1pln2;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> pln1 = 0; pln1 &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a> - 1; ++pln1) {</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> pln2 = pln1 + 1; pln2 &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>; ++pln2) {</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <span class="keyword">auto</span> p1p2 = std::make_pair(pln1, pln2);</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="keywordflow">if</span> (std::find(pln1pln2.begin(), pln1pln2.end(), p1p2) != pln1pln2.end()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="comment">// find two wires that have a valid intersection</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wire = firstWire; wire &lt; maxWire; ++wire) {</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;          <span class="keywordtype">double</span> y00, z00;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;          <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#aed0d5fe55e605367888c245e1e94f42e">IntersectionPoint</a>(wire, wire, pln1, pln2, cstat, tpc, y00, z00)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;          <span class="comment">// increment by one wire in pln1 and find another valid intersection</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;          <span class="keywordtype">double</span> y10, z10;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;          <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#aed0d5fe55e605367888c245e1e94f42e">IntersectionPoint</a>(wire + 10, wire, pln1, pln2, cstat, tpc, y10, z10))</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;          <span class="comment">// increment by one wire in pln2 and find another valid intersection</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;          <span class="keywordtype">double</span> y01, z01;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;          <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#aed0d5fe55e605367888c245e1e94f42e">IntersectionPoint</a>(wire, wire + 10, pln1, pln2, cstat, tpc, y01, z01))</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;          <a class="code" href="../../d7/de3/structtca_1_1TCWireIntersection.html">TCWireIntersection</a> tcwi;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;          tcwi.<a class="code" href="../../d7/de3/structtca_1_1TCWireIntersection.html#a4ab555951795c51c8825278caedfb420">tpc</a> = tpc;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;          tcwi.<a class="code" href="../../d7/de3/structtca_1_1TCWireIntersection.html#a48ed0859edaca33b1f90fb20377fbb31">pln1</a> = pln1;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;          tcwi.<a class="code" href="../../d7/de3/structtca_1_1TCWireIntersection.html#ac9fb943694a1e6c5155a5b421605d269">pln2</a> = pln2;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;          tcwi.<a class="code" href="../../d7/de3/structtca_1_1TCWireIntersection.html#a0a1d170111e58df220326f2aad4c3d63">wir1</a> = wire;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;          tcwi.<a class="code" href="../../d7/de3/structtca_1_1TCWireIntersection.html#a005149ac7ffe574c4a218fc2f001ead7">wir2</a> = wire;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;          tcwi.<a class="code" href="../../d7/de3/structtca_1_1TCWireIntersection.html#a21d39ae74d46f36d481ad3514f1b3321">y</a> = y00;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;          tcwi.<a class="code" href="../../d7/de3/structtca_1_1TCWireIntersection.html#a4b50be049b11af6ceca1f935ec89ec85">z</a> = z00;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;          tcwi.<a class="code" href="../../d7/de3/structtca_1_1TCWireIntersection.html#a6923b0b98bcd40326a2958742af1d82d">dydw1</a> = (y10 - y00) / 10;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;          tcwi.<a class="code" href="../../d7/de3/structtca_1_1TCWireIntersection.html#a399e2b488d94288b6d839f6a6eeb2645">dzdw1</a> = (z10 - z00) / 10;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;          tcwi.<a class="code" href="../../d7/de3/structtca_1_1TCWireIntersection.html#a3aa866b92ff67887734e44d0ea2e1fce">dydw2</a> = (y01 - y00) / 10;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;          tcwi.<a class="code" href="../../d7/de3/structtca_1_1TCWireIntersection.html#a3c37363953d6a15317d52fb0c0dad675">dzdw2</a> = (z01 - z00) / 10;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;          <a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#abd581d77b47c61e2dba9ffba63aa9f3c">wireIntersections</a>.push_back(tcwi);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        } <span class="comment">// wire</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      }   <span class="comment">// pln2</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    }     <span class="comment">// pln1</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  }       <span class="comment">// FillWireIntersections</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span></div>
<div class="line"><a name="l00668"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a8201218ffaab739725ab241042e6a120">  668</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a8201218ffaab739725ab241042e6a120">TCIntersectionPoint</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wir1,</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wir2,</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pln1,</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pln2,</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                      <span class="keywordtype">float</span>&amp; <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a1e5aaaf25e8609a835e8c7c6fda71456">y</a>,</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                      <span class="keywordtype">float</span>&amp; <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#ae40184b0245025a43c56daa3261d5e3c">z</a>)</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  {</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="comment">// A TrajCluster analog of geometry IntersectionPoint that uses local wireIntersections with</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="comment">// float precision. The (y,z) position is only used to match TPs between planes - not for 3D fitting</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#abd581d77b47c61e2dba9ffba63aa9f3c">wireIntersections</a>.empty()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordflow">if</span> (pln1 == pln2) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordflow">if</span> (pln1 &gt; pln2) {</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      std::swap(pln1, pln2);</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      std::swap(wir1, wir2);</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    }</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; wi : <a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#abd581d77b47c61e2dba9ffba63aa9f3c">wireIntersections</a>) {</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <span class="keywordflow">if</span> (wi.pln1 != pln1) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <span class="keywordflow">if</span> (wi.pln2 != pln2) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      <span class="comment">// estimate the position using the wire differences</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      <span class="keywordtype">double</span> dw1 = wir1 - wi.wir1;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <span class="keywordtype">double</span> dw2 = wir2 - wi.wir2;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      y = (float)(wi.y + dw1 * wi.dydw1 + dw2 * wi.dydw2);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      z = (float)(wi.z + dw1 * wi.dzdw1 + dw2 * wi.dzdw2);</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    } <span class="comment">// wi</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  } <span class="comment">// TCIntersectionPoint</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l00700"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#ad56741a3d44d6766a6bca763539993fc">  700</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#ad56741a3d44d6766a6bca763539993fc">Match3PlanesSpt</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, std::vector&lt;MatchStruct&gt;&amp; matVec)</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  {</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="comment">// fill matVec using SpacePoint -&gt; Hit -&gt; TP -&gt; tj assns</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#a022c77c19ed66a47e54dd705a6fc840d">sptHits</a>.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="comment">// create a local vector of allHit -&gt; Tj assns and populate it</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    std::vector&lt;int&gt; inTraj((*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>).size(), 0);</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; tch : slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>)</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      inTraj[tch.allHitsIndex] = tch.InTraj;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="comment">// the TJ IDs for one match</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    std::array&lt;int, 3&gt; tIDs;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="comment">// vector for matched Tjs</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    std::vector&lt;std::array&lt;int, 3&gt;&gt; mtIDs;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="comment">// and a matching vector for the count</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    std::vector&lt;unsigned short&gt; mCnt;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="comment">// ignore Tj matches after hitting a user-defined limit</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> maxCnt = USHRT_MAX;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[1] &lt; (<span class="keywordtype">float</span>)USHRT_MAX) maxCnt = (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[1];</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="comment">// a list of those Tjs</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    std::vector&lt;unsigned short&gt; tMaxed;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tpc = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; sptHits : <a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#a022c77c19ed66a47e54dd705a6fc840d">sptHits</a>) {</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      <span class="keywordflow">if</span> (sptHits.size() != 3) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      <span class="comment">// ensure that the SpacePoint is in the requested TPC</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a9eff93d6b8e15a5bc946106bcd59e7cf">SptInTPC</a>(sptHits, tpc)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> cnt = 0;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = 0; plane &lt; 3; ++plane) {</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iht = sptHits[plane];</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        <span class="keywordflow">if</span> (iht == UINT_MAX) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="keywordflow">if</span> (inTraj[iht] &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        tIDs[plane] = inTraj[iht];</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        ++cnt;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      } <span class="comment">// iht</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <span class="keywordflow">if</span> (cnt != 3) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      <span class="comment">// look for it in the list of tj combinations</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> indx = 0;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      <span class="keywordflow">for</span> (indx = 0; indx &lt; mtIDs.size(); ++indx)</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <span class="keywordflow">if</span> (tIDs == mtIDs[indx]) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      <span class="keywordflow">if</span> (indx == mtIDs.size()) {</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <span class="comment">// not found so add it to mtIDs and add another element to mCnt</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        mtIDs.push_back(tIDs);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        mCnt.push_back(0);</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      }</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      ++mCnt[indx];</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      <span class="keywordflow">if</span> (mCnt[indx] == maxCnt) {</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <span class="comment">// add the Tjs to the list</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        tMaxed.insert(tMaxed.end(), tIDs[0]);</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        tMaxed.insert(tMaxed.end(), tIDs[1]);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        tMaxed.insert(tMaxed.end(), tIDs[2]);</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      } <span class="comment">// hit maxCnt</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      ++cnt;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    } <span class="comment">// sptHit</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    std::vector&lt;SortEntry&gt; sortVec;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> indx = 0; indx &lt; mCnt.size(); ++indx) {</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      <span class="keyword">auto</span>&amp; tIDs = mtIDs[indx];</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      <span class="comment">// find the fraction of TPs on the shortest tj that are matched</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;      <span class="keywordtype">float</span> minTPCnt = USHRT_MAX;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> tid : tIDs) {</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        <span class="keyword">auto</span>&amp; tj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tid - 1];</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <span class="keywordtype">float</span> tpcnt = <a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <span class="keywordflow">if</span> (tpcnt &lt; minTPCnt) minTPCnt = tpcnt;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      } <span class="comment">// tid</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;      <span class="keywordtype">float</span> frac = (float)mCnt[indx] / minTPCnt;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      <span class="comment">// ignore matches with a very low match fraction</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;      <span class="keywordflow">if</span> (frac &lt; 0.05) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;      <a class="code" href="../../db/d7d/structtca_1_1SortEntry.html">SortEntry</a> se;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;      se.<a class="code" href="../../db/d7d/structtca_1_1SortEntry.html#a69837f74a6dc268fde50066fd818b886">index</a> = indx;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;      se.<a class="code" href="../../db/d7d/structtca_1_1SortEntry.html#a3123e86741ba9a186788806f18c0dc1f">val</a> = mCnt[indx];</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      sortVec.push_back(se);</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    } <span class="comment">// ii</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="keywordflow">if</span> (sortVec.size() &gt; 1) std::sort(sortVec.begin(), sortVec.end(), <a class="code" href="../../de/d78/Utils_8cxx.html#a5d68a4eb0beaca553c63e29989a63464">valsDecreasing</a>);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    matVec.resize(sortVec.size());</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; sortVec.size(); ++ii) {</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> indx = sortVec[ii].index;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <span class="keyword">auto</span>&amp; ms = matVec[ii];</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      ms.Count = mCnt[indx];</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      ms.TjIDs.resize(3);</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = 0; plane &lt; 3; ++plane)</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        ms.TjIDs[plane] = mtIDs[indx][plane];</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    } <span class="comment">// indx</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  } <span class="comment">// Match3PlanesSpt</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span></div>
<div class="line"><a name="l00792"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a9eff93d6b8e15a5bc946106bcd59e7cf">  792</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a9eff93d6b8e15a5bc946106bcd59e7cf">SptInTPC</a>(<span class="keyword">const</span> std::array&lt;unsigned int, 3&gt;&amp; sptHits, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tpc)</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  {</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="comment">// returns true if a hit referenced in sptHits resides in the requested tpc. We assume</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="comment">// that if one does, then all of them do</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ahi = UINT_MAX;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> ii : sptHits)</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;      <span class="keywordflow">if</span> (ii != UINT_MAX) {</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        ahi = ii;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      }</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="keywordflow">if</span> (ahi &gt;= (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>).size()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <span class="comment">// get a reference to the hit and see if it is in the desired tpc</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>)[ahi];</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.WireID().TPC == tpc) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  } <span class="comment">// SptInTPC</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l00813"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a59c21cff0144d7bc2dc395ae890bfe97">  813</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a59c21cff0144d7bc2dc395ae890bfe97">Match3Planes</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, std::vector&lt;MatchStruct&gt;&amp; matVec)</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  {</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <span class="comment">// A simpler and faster version of MatchPlanes that only creates three plane matches</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <span class="keywordflow">if</span> (slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a> != 3) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="comment">// use SpacePoint -&gt; Hit -&gt; TP assns?</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#a022c77c19ed66a47e54dd705a6fc840d">sptHits</a>.empty()) {</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#ad56741a3d44d6766a6bca763539993fc">Match3PlanesSpt</a>(slc, matVec);</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    }</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="keywordflow">if</span> (slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="keywordtype">float</span> xcut = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[0];</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="keywordtype">double</span> yzcut = 1.5 * <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aee1cce9521d82837d6aeddfcd12a68ba">wirePitch</a>;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="comment">// the TJ IDs for one match</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    std::array&lt;unsigned short, 3&gt; tIDs;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="comment">// vector for matched Tjs</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    std::vector&lt;std::array&lt;unsigned short, 3&gt;&gt; mtIDs;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="comment">// and a matching vector for the count</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    std::vector&lt;unsigned short&gt; mCnt;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="comment">// ignore Tj matches after hitting a user-defined limit</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> maxCnt = USHRT_MAX;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[1] &lt; (<span class="keywordtype">float</span>)USHRT_MAX) maxCnt = (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[1];</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="comment">// a list of those Tjs</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    std::vector&lt;unsigned short&gt; tMaxed;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <span class="keywordflow">for</span> (std::size_t ipt = 0; ipt &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>.size() - 1; ++ipt) {</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      <span class="keyword">auto</span>&amp; iTjPt = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>[ipt];</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      <span class="comment">// see if we hit the maxCnt limit</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;      <span class="keywordflow">if</span> (std::find(tMaxed.begin(), tMaxed.end(), iTjPt.id) != tMaxed.end()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;      <span class="keyword">auto</span>&amp; itp = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[iTjPt.id - 1].Pts[iTjPt.ipt];</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iPlane = iTjPt.plane;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iWire = std::nearbyint(itp.Pos[0]);</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;      tIDs[iPlane] = iTjPt.id;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;      <span class="keywordtype">bool</span> hitMaxCnt = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;      <span class="keywordflow">for</span> (std::size_t jpt = ipt + 1; jpt &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>.size() - 1; ++jpt) {</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        <span class="keyword">auto</span>&amp; jTjPt = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>[jpt];</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        <span class="comment">// ensure that the planes are different</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        <span class="keywordflow">if</span> (jTjPt.plane == iTjPt.plane) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        <span class="comment">// check for x range overlap. We know that jTjPt.xlo is &gt;= iTjPt.xlo because of the sort</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <span class="keywordflow">if</span> (jTjPt.xlo &gt; iTjPt.xhi) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        <span class="comment">// break out if the x range difference becomes large</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        <span class="keywordflow">if</span> (jTjPt.xlo &gt; iTjPt.xhi + xcut) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        <span class="comment">// see if we hit the maxCnt limit</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        <span class="keywordflow">if</span> (std::find(tMaxed.begin(), tMaxed.end(), jTjPt.id) != tMaxed.end()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        <span class="keyword">auto</span>&amp; jtp = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[jTjPt.id - 1].Pts[jTjPt.ipt];</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> jPlane = jTjPt.plane;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> jWire = jtp.Pos[0];</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#acae6296d6fba718d82c34c88fefddf52">Point2_t</a> ijPos;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a8201218ffaab739725ab241042e6a120">TCIntersectionPoint</a>(iWire, jWire, iPlane, jPlane, ijPos[0], ijPos[1])) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        tIDs[jPlane] = jTjPt.id;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        <span class="keywordflow">for</span> (std::size_t kpt = jpt + 1; kpt &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>.size(); ++kpt) {</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;          <span class="keyword">auto</span>&amp; kTjPt = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>[kpt];</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;          <span class="comment">// ensure that the planes are different</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;          <span class="keywordflow">if</span> (kTjPt.plane == iTjPt.plane || kTjPt.plane == jTjPt.plane) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;          <span class="keywordflow">if</span> (kTjPt.xlo &gt; iTjPt.xhi) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;          <span class="comment">// break out if the x range difference becomes large</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;          <span class="keywordflow">if</span> (kTjPt.xlo &gt; iTjPt.xhi + xcut) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;          <span class="comment">// see if we hit the maxCnt limit</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;          <span class="keywordflow">if</span> (std::find(tMaxed.begin(), tMaxed.end(), kTjPt.id) != tMaxed.end()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;          <span class="keyword">auto</span>&amp; ktp = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[kTjPt.id - 1].Pts[kTjPt.ipt];</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../da/d2d/namespaceevd.html#a2f1ff861ce88c5c738b574adcf2afb3a">kPlane</a> = kTjPt.plane;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d2d/namespaceevd.html#ae132a6902afa384d1ed56b6e77b17e79">kWire</a> = ktp.Pos[0];</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;          <a class="code" href="../../de/d0f/namespacetca.html#acae6296d6fba718d82c34c88fefddf52">Point2_t</a> ikPos;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;          <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a8201218ffaab739725ab241042e6a120">TCIntersectionPoint</a>(iWire, kWire, iPlane, kPlane, ikPos[0], ikPos[1])) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(ijPos[0] - ikPos[0]) &gt; yzcut) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(ijPos[1] - ikPos[1]) &gt; yzcut) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;          <span class="comment">// we have a match</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;          tIDs[<a class="code" href="../../da/d2d/namespaceevd.html#a2f1ff861ce88c5c738b574adcf2afb3a">kPlane</a>] = kTjPt.id;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;          <span class="comment">// look for it in the list</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> indx = 0;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;          <span class="keywordflow">for</span> (indx = 0; indx &lt; mtIDs.size(); ++indx)</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;            <span class="keywordflow">if</span> (tIDs == mtIDs[indx]) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;          <span class="keywordflow">if</span> (indx == mtIDs.size()) {</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;            <span class="comment">// not found so add it to mtIDs and add another element to mCnt</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;            mtIDs.push_back(tIDs);</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;            mCnt.push_back(0);</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;          }</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;          ++mCnt[indx];</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;          <span class="keywordflow">if</span> (mCnt[indx] == maxCnt) {</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;            <span class="comment">// add the Tjs to the list</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;            tMaxed.insert(tMaxed.end(), tIDs[0]);</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;            tMaxed.insert(tMaxed.end(), tIDs[1]);</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            tMaxed.insert(tMaxed.end(), tIDs[2]);</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;            hitMaxCnt = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;          } <span class="comment">// hit maxCnt</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        }   <span class="comment">// kpt</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        <span class="keywordflow">if</span> (hitMaxCnt) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      } <span class="comment">// jpt</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    }   <span class="comment">// ipt</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <span class="keywordflow">if</span> (mCnt.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    std::vector&lt;SortEntry&gt; sortVec;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="keywordflow">for</span> (std::size_t indx = 0; indx &lt; mCnt.size(); ++indx) {</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      <span class="keyword">auto</span>&amp; tIDs = mtIDs[indx];</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      <span class="comment">// count the number of TPs in all Tjs</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;      <span class="keywordtype">float</span> tpCnt = 0;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> tid : tIDs) {</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        <span class="keyword">auto</span>&amp; tj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tid - 1];</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        tpCnt += <a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      } <span class="comment">// tid</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      <span class="keywordtype">float</span> frac = mCnt[indx] / tpCnt;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      frac /= 3;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      <span class="comment">// ignore matches with a very low match fraction</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      <span class="keywordflow">if</span> (frac &lt; 0.05) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      <a class="code" href="../../db/d7d/structtca_1_1SortEntry.html">SortEntry</a> se;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      se.<a class="code" href="../../db/d7d/structtca_1_1SortEntry.html#a69837f74a6dc268fde50066fd818b886">index</a> = indx;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      se.<a class="code" href="../../db/d7d/structtca_1_1SortEntry.html#a3123e86741ba9a186788806f18c0dc1f">val</a> = mCnt[indx];</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      sortVec.push_back(se);</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    } <span class="comment">// ii</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="keywordflow">if</span> (sortVec.size() &gt; 1) std::sort(sortVec.begin(), sortVec.end(), <a class="code" href="../../de/d78/Utils_8cxx.html#a5d68a4eb0beaca553c63e29989a63464">valsDecreasing</a>);</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    matVec.resize(sortVec.size());</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="keywordflow">for</span> (std::size_t ii = 0; ii &lt; sortVec.size(); ++ii) {</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> indx = sortVec[ii].index;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      <span class="keyword">auto</span>&amp; ms = matVec[ii];</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;      ms.Count = mCnt[indx];</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      ms.TjIDs.resize(3);</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = 0; plane &lt; 3; ++plane)</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        ms.TjIDs[plane] = (<span class="keywordtype">int</span>)mtIDs[indx][plane];</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    } <span class="comment">// indx</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  } <span class="comment">// Match3Planes</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l00944"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a1faf6b0cb0d56d4a3658bb611b4774e8">  944</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a1faf6b0cb0d56d4a3658bb611b4774e8">Match2Planes</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, std::vector&lt;MatchStruct&gt;&amp; matVec)</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  {</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="comment">// A simpler faster version of MatchPlanes that only creates two plane matches</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    matVec.clear();</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <span class="keywordflow">if</span> (slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    <span class="keywordtype">int</span> cstat = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="keywordtype">int</span> tpc = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="keywordtype">float</span> xcut = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[0];</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <span class="comment">// the TJ IDs for one match</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    std::array&lt;unsigned short, 2&gt; tIDs;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="comment">// vector for matched Tjs</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    std::vector&lt;std::array&lt;unsigned short, 2&gt;&gt; mtIDs;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <span class="comment">// and a matching vector for the count</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    std::vector&lt;unsigned short&gt; mCnt;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="comment">// ignore Tj matches after hitting a user-defined limit</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> maxCnt = USHRT_MAX;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[1] &lt; (<span class="keywordtype">float</span>)USHRT_MAX) maxCnt = (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[1];</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <span class="comment">// a list of those Tjs</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    std::vector&lt;unsigned short&gt; tMaxed;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="keywordflow">for</span> (std::size_t ipt = 0; ipt &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>.size() - 1; ++ipt) {</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;      <span class="keyword">auto</span>&amp; iTjPt = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>[ipt];</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      <span class="comment">// see if we hit the maxCnt limit</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;      <span class="keywordflow">if</span> (std::find(tMaxed.begin(), tMaxed.end(), iTjPt.id) != tMaxed.end()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;      <span class="keyword">auto</span>&amp; itp = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[iTjPt.id - 1].Pts[iTjPt.ipt];</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> iPlane = iTjPt.plane;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iWire = itp.Pos[0];</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      <span class="keywordtype">bool</span> hitMaxCnt = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      <span class="keywordflow">for</span> (std::size_t jpt = ipt + 1; jpt &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>.size() - 1; ++jpt) {</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        <span class="keyword">auto</span>&amp; jTjPt = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>[jpt];</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        <span class="comment">// ensure that the planes are different</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        <span class="keywordflow">if</span> (jTjPt.plane == iTjPt.plane) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        <span class="comment">// check for x range overlap. We know that jTjPt.xlo is &gt;= iTjPt.xlo because of the sort</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        <span class="keywordflow">if</span> (jTjPt.xlo &gt; iTjPt.xhi) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        <span class="comment">// break out if the x range difference becomes large</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        <span class="keywordflow">if</span> (jTjPt.xlo &gt; iTjPt.xhi + xcut) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        <span class="comment">// see if we hit the maxCnt limit</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        <span class="keywordflow">if</span> (std::find(tMaxed.begin(), tMaxed.end(), jTjPt.id) != tMaxed.end()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        <span class="keyword">auto</span>&amp; jtp = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[jTjPt.id - 1].Pts[jTjPt.ipt];</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> jPlane = jTjPt.plane;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> jWire = jtp.Pos[0];</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a> ijPos;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        ijPos[0] = itp.Pos[0];</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#aed0d5fe55e605367888c245e1e94f42e">IntersectionPoint</a>(</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;              iWire, jWire, iPlane, jPlane, cstat, tpc, ijPos[1], ijPos[2]))</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        tIDs[0] = iTjPt.id;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        tIDs[1] = jTjPt.id;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <span class="comment">// swap the order so that the == operator works correctly</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        <span class="keywordflow">if</span> (tIDs[0] &gt; tIDs[1]) std::swap(tIDs[0], tIDs[1]);</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        <span class="comment">// look for it in the list</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;        std::size_t indx = 0;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        <span class="keywordflow">for</span> (indx = 0; indx &lt; mtIDs.size(); ++indx)</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;          <span class="keywordflow">if</span> (tIDs == mtIDs[indx]) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        <span class="keywordflow">if</span> (indx == mtIDs.size()) {</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;          <span class="comment">// not found so add it to mtIDs and add another element to mCnt</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;          mtIDs.push_back(tIDs);</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;          mCnt.push_back(0);</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        }</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        ++mCnt[indx];</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        <span class="keywordflow">if</span> (mCnt[indx] == maxCnt) {</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;          <span class="comment">// add the Tjs to the list</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;          tMaxed.insert(tMaxed.end(), tIDs[0]);</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;          tMaxed.insert(tMaxed.end(), tIDs[1]);</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;          hitMaxCnt = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        } <span class="comment">// hit maxCnt</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        <span class="keywordflow">if</span> (hitMaxCnt) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      } <span class="comment">// jpt</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    }   <span class="comment">// ipt</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="keywordflow">if</span> (mCnt.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    std::vector&lt;SortEntry&gt; sortVec;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <span class="keywordflow">for</span> (std::size_t indx = 0; indx &lt; mCnt.size(); ++indx) {</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      <span class="keyword">auto</span>&amp; tIDs = mtIDs[indx];</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      <span class="comment">// count the number of TPs in all Tjs</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;      <span class="keywordtype">float</span> tpCnt = 0;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> tid : tIDs) {</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        <span class="keyword">auto</span>&amp; tj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tid - 1];</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        tpCnt += <a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      } <span class="comment">// tid</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      <span class="keywordtype">float</span> frac = mCnt[indx] / tpCnt;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      frac /= 2;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      <span class="comment">// ignore matches with a very low match fraction</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      <span class="keywordflow">if</span> (frac &lt; 0.05) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      <a class="code" href="../../db/d7d/structtca_1_1SortEntry.html">SortEntry</a> se;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      se.<a class="code" href="../../db/d7d/structtca_1_1SortEntry.html#a69837f74a6dc268fde50066fd818b886">index</a> = indx;</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      se.<a class="code" href="../../db/d7d/structtca_1_1SortEntry.html#a3123e86741ba9a186788806f18c0dc1f">val</a> = mCnt[indx];</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;      sortVec.push_back(se);</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    } <span class="comment">// ii</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    <span class="keywordflow">if</span> (sortVec.size() &gt; 1) std::sort(sortVec.begin(), sortVec.end(), <a class="code" href="../../de/d78/Utils_8cxx.html#a5d68a4eb0beaca553c63e29989a63464">valsDecreasing</a>);</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    matVec.resize(sortVec.size());</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="keywordflow">for</span> (std::size_t ii = 0; ii &lt; sortVec.size(); ++ii) {</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> indx = sortVec[ii].index;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;      <span class="keyword">auto</span>&amp; ms = matVec[ii];</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      ms.Count = mCnt[indx];</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      ms.TjIDs.resize(2);</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = 0; plane &lt; 2; ++plane)</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        ms.TjIDs[plane] = (<span class="keywordtype">int</span>)mtIDs[indx][plane];</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    } <span class="comment">// indx</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  } <span class="comment">// Match2Planes</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a26e3b3c5f6ab13bbdb0e91d6f4858e13"> 1056</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a26e3b3c5f6ab13bbdb0e91d6f4858e13">Update</a>(<a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html">detinfo::DetectorClocksData</a> <span class="keyword">const</span>&amp; clockData,</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;         <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;         <span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc,</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;         <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp,</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;         <span class="keywordtype">bool</span> prt)</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  {</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    <span class="comment">// This function only updates SectionFits that need to be re-sorted or re-fit. It returns</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    <span class="comment">// false if there was a serious error indicating that the pfp should be abandoned</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.empty() || pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.empty()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <span class="comment">// special handling for small angle tracks</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="keywordflow">if</span>(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a1c332ab959b350e9ca7b37f321fd0849">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1ae3c02e1143205b4d7a8e93437965aa47">kSmallAngle</a>]) {</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sfi = 0; sfi &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size(); ++sfi) {</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        <span class="keyword">auto</span>&amp; sf = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>[sfi];</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;        <span class="keywordflow">if</span> (!sf.NeedsUpdate) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a881a9f856411db2bb90b1964068712f5">SortSection</a>(pfp, sfi)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        sf.NPts = 0;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;        sf.ChiDOF = 0;</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = 0; ipt &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size(); ++ipt) {</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;          <span class="keyword">auto</span>&amp; tp3d = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[ipt];</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;          <span class="keywordflow">if</span>(tp3d.SFIndex &lt; sfi) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;          <span class="keywordflow">if</span>(tp3d.SFIndex &gt; sfi) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;          ++sf.NPts;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;          <span class="keywordtype">double</span> delta = tp3d.Pos[0] - tp3d.TPX;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;          sf.ChiDOF += delta * delta / tp3d.TPXErr2;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        } <span class="comment">// ipt</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;        <span class="keywordflow">if</span>(sf.NPts &lt; 5) {</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;          sf.ChiDOF = 0;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;          sf.ChiDOF /= (float)(sf.NPts - 4);</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;        }</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;        sf.NeedsUpdate = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;      } <span class="comment">// sfi</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;      pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1a16c8b0d8524fc0914afc3dab9bf89950">kNeedsUpdate</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    } <span class="comment">// kSmallAngle</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <span class="keywordflow">for</span> (std::size_t sfi = 0; sfi &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size(); ++sfi) {</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      <span class="keyword">auto</span>&amp; sf = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>[sfi];</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;      <span class="keywordflow">if</span> (!sf.NeedsUpdate) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a7045ad35dda0875138741a27c2fa6885">FitSection</a>(clockData, detProp, slc, pfp, sfi)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a881a9f856411db2bb90b1964068712f5">SortSection</a>(pfp, sfi)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;      sf.NeedsUpdate = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    } <span class="comment">// sfi</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    <span class="comment">// ensure that all points (good or not) have a valid SFIndex</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; tp3d : pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>) {</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      <span class="keywordflow">if</span> (tp3d.SFIndex &gt;= pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size()) <a class="code" href="../../de/d0f/namespacetca.html#a3075ef4d0b2a15d016f66c3fbf2a8aac">SetSection</a>(detProp, slc, pfp, tp3d);</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    } <span class="comment">// tp3d</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1a16c8b0d8524fc0914afc3dab9bf89950">kNeedsUpdate</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  } <span class="comment">// Update</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#ad00890e918d6615215d6b43dec3c0ada"> 1111</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#ad00890e918d6615215d6b43dec3c0ada">ReSection</a>(<a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html">detinfo::DetectorClocksData</a> <span class="keyword">const</span>&amp; clockData,</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;            <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc,</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;            <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp,</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;            <span class="keywordtype">bool</span> prt)</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  {</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <span class="comment">// Re-fit the TP3Ds in sections and add/remove sections to keep ChiDOF of each section close to 1.</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    <span class="comment">// This function only fails when there is a serious error, otherwise if reasonable fits cannot be</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <span class="comment">// achieved, the CanSection flag is set false.</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.empty()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="comment">// This function shouldn&#39;t be called if this is the case but it isn&#39;t a major failure if it is</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <span class="keywordflow">if</span> (!pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1a10329bf0d918d9281fd2740f70db322b">kCanSection</a>]) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <span class="keywordflow">if</span>(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1ae3c02e1143205b4d7a8e93437965aa47">kSmallAngle</a>]) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <span class="comment">// Likewise this shouldn&#39;t be attempted if there aren&#39;t at least 3 points in 2 planes in 2 sections</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <span class="comment">// but it isn&#39;t a failure</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() &lt; 12) {</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;      pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1a10329bf0d918d9281fd2740f70db322b">kCanSection</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    }</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    prt = (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a24c761b3091ff8a756eb3069232466f8">MVI</a> == <a class="code" href="../../de/d0f/namespacetca.html#ad232469b22f64d38891a7038f0e36ef3">debug</a>.<a class="code" href="../../d8/de4/structtca_1_1DebugStuff.html#a65233ccccd21a4284acdb6249369473c">MVI</a>);</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <span class="comment">// try to keep ChiDOF between chiLo and chiHi</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    <span class="keywordtype">float</span> chiLo = 0.5 * <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[5];</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="keywordtype">float</span> chiHi = 1.5 * <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[5];</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <span class="comment">// clobber the old sections if more than one exists</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size() &gt; 1) {</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      <span class="comment">// make one section</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;      pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.resize(1);</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;      <span class="comment">// put all of the points in it and fit</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; tp3d : pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>) {</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        tp3d.SFIndex = 0;</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      }</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      <span class="keyword">auto</span>&amp; sf = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>[0];</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a7045ad35dda0875138741a27c2fa6885">FitSection</a>(clockData, detProp, slc, pfp, 0)) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;      <span class="keywordflow">if</span> (sf.ChiDOF &lt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[5]) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    } <span class="comment">// &gt; 1 SectionFit</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="comment">// sort by distance from the start</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a881a9f856411db2bb90b1964068712f5">SortSection</a>(pfp, 0)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    <span class="comment">// require a minimum of 3 points in 2 planes</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> min2DPts = 3;</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> fromPt = 0;</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    <span class="comment">// set the section index to invalid for all points</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; tp3d : pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>)</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;      tp3d.SFIndex = USHRT_MAX;</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <span class="comment">// Guess how many points should be added in each iteration</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nPtsToAdd = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() / 4;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="comment">// the actual number of points that will be fit in the section</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nPts = nPtsToAdd;</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    <span class="comment">// the minimum number of points</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nPtsMin = <a class="code" href="../../de/d0f/namespacetca.html#a4cef0a0d26986f9f4e9b724f7b9c1d38">Find3DRecoRange</a>(slc, pfp, fromPt, min2DPts, 1) - fromPt + 1;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <span class="keywordflow">if</span> (nPtsMin &gt;= pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size()) {</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;      pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1a10329bf0d918d9281fd2740f70db322b">kCanSection</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    }</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <span class="keywordtype">float</span> chiDOF = 0;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="keywordflow">if</span> (nPts &lt; nPtsMin) nPts = nPtsMin;</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="comment">// Try to reduce the number of iterations for long pfps</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() &gt; 100) {</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nhalf = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() / 2;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a63003e064041f039c7fa885f842a594f">FitTP3Ds</a>(detProp, slc, pfp, fromPt, nhalf, USHRT_MAX, chiDOF);</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;      <span class="keywordflow">if</span> (chiDOF &lt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[5]) nPts = nhalf;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    }</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <span class="keywordtype">bool</span> lastSection = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sfIndex = 0; sfIndex &lt; 20; ++sfIndex) {</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;      <span class="comment">// Try to add/remove points in each section no more than 20 times</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;      <span class="keywordtype">float</span> chiDOFPrev = 0;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;      <span class="keywordtype">short</span> nHiChi = 0;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nit = 0; nit &lt; 10; ++nit) {</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;        <span class="comment">// Decide how many points to add or subtract after doing the fit</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nPtsNext = nPts;</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a63003e064041f039c7fa885f842a594f">FitTP3Ds</a>(detProp, slc, pfp, fromPt, nPts, USHRT_MAX, chiDOF)) {</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;          nPtsNext += 1.5 * nPtsToAdd;</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;        }</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (chiDOF &lt; chiLo) {</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;          <span class="comment">// low chiDOF</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;          <span class="keywordflow">if</span> (nHiChi &gt; 2) {</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;            <span class="comment">// declare it close enough if several attempts were made</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;            nPtsNext = 0;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;          }</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;          <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;            nPtsNext += nPtsToAdd;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;          } <span class="comment">// nHiChi &lt; 2</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;          nHiChi = 0;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        }</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (chiDOF &gt; chiHi) {</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;          <span class="comment">// high chiDOF</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;          ++nHiChi;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;          <span class="keywordflow">if</span> (nHiChi == 1 &amp;&amp; chiDOFPrev &gt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[5]) {</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;            <span class="comment">// reduce the number of points by 1/2 on the first attempt</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;            nPtsNext /= 2;</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;          }</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;          <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;            <span class="comment">// that didn&#39;t work so start subtracting groups of points</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;            <span class="keywordtype">short</span> npnext = (short)nPts - nHiChi * 5;</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;            <span class="comment">// assume this won&#39;t work</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;            nPtsNext = 0;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;            <span class="keywordflow">if</span> (npnext &gt; nPtsMin) nPtsNext = npnext;</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;          }</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        }</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;          <span class="comment">// just right</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;          nPtsNext = 0;</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;        }</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;        <span class="comment">// check for passing the end</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;        <span class="keywordflow">if</span> (fromPt + nPtsNext &gt;= pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size()) {</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;          nPtsNext = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() - fromPt;</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;          lastSection = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        }</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;        <span class="keywordflow">if</span> (prt) {</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;          mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;          myprt &lt;&lt; <span class="stringliteral">&quot; RS: P&quot;</span> &lt;&lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a51b8e48c9df5507929ae0b6429cc7494">ID</a> &lt;&lt; <span class="stringliteral">&quot; sfi/nit/npts &quot;</span> &lt;&lt; sfIndex &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; nit &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; nPts;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;          myprt &lt;&lt; std::fixed &lt;&lt; std::setprecision(1) &lt;&lt; <span class="stringliteral">&quot; chiDOF &quot;</span> &lt;&lt; chiDOF;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;          myprt &lt;&lt; <span class="stringliteral">&quot; fromPt &quot;</span> &lt;&lt; fromPt;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;          myprt &lt;&lt; <span class="stringliteral">&quot; nPtsNext &quot;</span> &lt;&lt; nPtsNext;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;          myprt &lt;&lt; <span class="stringliteral">&quot; nHiChi &quot;</span> &lt;&lt; nHiChi;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;          myprt &lt;&lt; <span class="stringliteral">&quot; lastSection? &quot;</span> &lt;&lt; lastSection;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        }</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        <span class="keywordflow">if</span> (nPtsNext == 0) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        <span class="comment">// see if this is the last section</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        <span class="keywordflow">if</span> (lastSection) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        <span class="keywordflow">if</span> (chiDOF == chiDOFPrev) {</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;          <span class="keywordflow">if</span> (prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; MVI &quot;</span> &lt;&lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a24c761b3091ff8a756eb3069232466f8">MVI</a> &lt;&lt; <span class="stringliteral">&quot; chiDOF not changing\n&quot;</span>;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;        }</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;        nPts = nPtsNext;</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;        chiDOFPrev = chiDOF;</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;      } <span class="comment">// nit</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;      <span class="comment">// finished this section. Assign the points to it</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> toPt = fromPt + nPts;</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;      <span class="keywordflow">if</span> (toPt &gt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size()) toPt = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size();</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = fromPt; ipt &lt; toPt; ++ipt)</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;        pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[ipt].SFIndex = sfIndex;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;      <span class="comment">// See if there are enough points remaining to reconstruct another section if this isn&#39;t known</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;      <span class="comment">// to be the last section</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;      <a class="code" href="../../de/d71/neoSmazza_8sh.html#ae55989c903f0c76190facfb5e5211732">if</a> (!lastSection) {</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;        <span class="comment">// this will be the first point in the next section</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nextFromPt = fromPt + nPts;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;        <span class="comment">// See if it will have enough points to be reconstructed</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nextToPtMin = <a class="code" href="../../de/d0f/namespacetca.html#a4cef0a0d26986f9f4e9b724f7b9c1d38">Find3DRecoRange</a>(slc, pfp, nextFromPt, min2DPts, 1);</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;        <span class="keywordflow">if</span> (nextToPtMin == USHRT_MAX) {</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;          <span class="comment">// not enough points so this is the last section</span></div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;          lastSection = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;          <span class="comment">// assign the remaining points to the last section</span></div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;          <span class="keywordflow">for</span> (std::size_t ipt = nextFromPt; ipt &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size(); ++ipt)</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;            pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[ipt].SFIndex = sfIndex;</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;        }</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;      } <span class="comment">// !lastSection</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;      <span class="comment">// Do a final fit and update the points. Don&#39;t worry about a poor ChiDOF</span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a7045ad35dda0875138741a27c2fa6885">FitSection</a>(clockData, detProp, slc, pfp, sfIndex);</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a881a9f856411db2bb90b1964068712f5">SortSection</a>(pfp, 0)) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;      <span class="keywordflow">if</span> (lastSection) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;      <span class="comment">// Prepare for the next section.</span></div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;      fromPt = fromPt + nPts;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;      nPts = nPtsToAdd;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;      nPtsMin = <a class="code" href="../../de/d0f/namespacetca.html#a4cef0a0d26986f9f4e9b724f7b9c1d38">Find3DRecoRange</a>(slc, pfp, fromPt, min2DPts, 1) - fromPt + 1;</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;      <span class="keywordflow">if</span> (nPtsMin &gt;= pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size()) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;      <span class="comment">// add a new section</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;      pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.resize(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size() + 1);</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    } <span class="comment">// snit</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <span class="comment">// see if the last sf is valid</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size() &gt; 1 &amp;&amp; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.back().ChiDOF &lt; 0) {</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> badSFI = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size() - 1;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;      <span class="comment">// remove it</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;      pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.pop_back();</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;      <span class="keywordflow">for</span> (std::size_t ipt = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() - 1; ipt &gt; 0; --ipt) {</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;        <span class="keyword">auto</span>&amp; tp3d = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[ipt];</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;        <span class="keywordflow">if</span> (tp3d.SFIndex &lt; badSFI) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        --tp3d.SFIndex;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;      }</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;      pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.back().NeedsUpdate = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    } <span class="comment">// bad last SF</span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    <span class="comment">// Ensure that the points at the end are in the last section</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    <span class="keywordflow">for</span> (std::size_t ipt = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() - 1; ipt &gt; 0; --ipt) {</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      <span class="keyword">auto</span>&amp; tp3d = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[ipt];</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;      <span class="keywordflow">if</span> (tp3d.SFIndex &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size()) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;      tp3d.SFIndex = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size() - 1;</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;      pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1a16c8b0d8524fc0914afc3dab9bf89950">kNeedsUpdate</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;      pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>[tp3d.SFIndex].NeedsUpdate = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    } <span class="comment">// tp3d</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a26e3b3c5f6ab13bbdb0e91d6f4858e13">Update</a>(clockData, detProp, slc, pfp, prt);</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    <span class="comment">// set CanSection false if the chisq is poor in any section</span></div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; sf : pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>) {</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;      <span class="keywordflow">if</span> (sf.ChiDOF &gt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[5]) pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1a10329bf0d918d9281fd2740f70db322b">kCanSection</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    }</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;  } <span class="comment">// resection</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#acbd522546d131bc7ab71657194d6db4c"> 1308</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#acbd522546d131bc7ab71657194d6db4c">CountBadPoints</a>(<span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc,</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;                 <span class="keyword">const</span> <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp,</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;                 <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> fromPt,</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;                 <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> toPt,</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;                 <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>&amp; nBadPts,</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;                 <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>&amp; firstBadPt)</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  {</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    <span class="comment">// Count the number of points whose pull exceeds tcc.match3DCuts[4]</span></div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    firstBadPt = USHRT_MAX;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    nBadPts = 0;</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    <span class="keywordflow">if</span> (fromPt &gt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() - 1) {</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;      nBadPts = USHRT_MAX;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    }</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <span class="keywordflow">if</span> (toPt &gt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size()) toPt = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size();</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#af481fa22253619167bce75a37e10ec34">first</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = fromPt; ipt &lt; toPt; ++ipt) {</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;      <span class="keyword">auto</span>&amp; tp3d = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[ipt];</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;      <span class="keywordflow">if</span> (!tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;      <span class="comment">// don&#39;t clobber a point if it is on a TP that is overlapping another Tj. This will</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;      <span class="comment">// happen for points close to a vertex and when trajectories cross</span></div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;      <span class="keyword">auto</span>&amp; tp = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tp3d.TjID - 1].Pts[tp3d.TPIndex];</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;      <span class="keywordflow">if</span> (tp.Environment[<a class="code" href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525ae8d79f565a18dd6877b890fa7cb6616b">kEnvOverlap</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a64a1d13b9dd367c5d94e5779daf22626">PointPull</a>(pfp, tp3d) &lt; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[4]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;      ++nBadPts;</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;      <span class="keywordflow">if</span> (first) {</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;        first = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;        firstBadPt = ipt;</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;      }</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  }   <span class="comment">// CountBadPoints</span></div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a2132931ff530dd0e4eccfbe863c2f764"> 1342</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a2132931ff530dd0e4eccfbe863c2f764">CanSection</a>(<span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <span class="keyword">const</span> <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp)</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;  {</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    <span class="comment">// analyze the TP3D vector to determine if it can be reconstructed in 3D in more than one section with</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <span class="comment">// the requirement that there are at least 3 points in two planes</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a1c332ab959b350e9ca7b37f321fd0849">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da2a2fbf12f53411c1338f1cf546b62cc3">kJunk3D</a>]) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a1c332ab959b350e9ca7b37f321fd0849">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1ae3c02e1143205b4d7a8e93437965aa47">kSmallAngle</a>]) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() &lt; 12) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> toPt = <a class="code" href="../../de/d0f/namespacetca.html#a4cef0a0d26986f9f4e9b724f7b9c1d38">Find3DRecoRange</a>(slc, pfp, 0, 3, 1);</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    <span class="keywordflow">if</span> (toPt &gt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nextToPt = <a class="code" href="../../de/d0f/namespacetca.html#a4cef0a0d26986f9f4e9b724f7b9c1d38">Find3DRecoRange</a>(slc, pfp, toPt, 3, 1);</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <span class="keywordflow">if</span> (nextToPt &gt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;  } <span class="comment">// CanSection</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="comment"></span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span></div>
<div class="line"><a name="l01358"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a4cef0a0d26986f9f4e9b724f7b9c1d38"> 1358</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a4cef0a0d26986f9f4e9b724f7b9c1d38">Find3DRecoRange</a>(<span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc,</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;                  <span class="keyword">const</span> <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp,</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;                  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> fromPt,</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> min2DPts,</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;                  <span class="keywordtype">short</span> <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>)</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  {</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <span class="comment">// Scans the TP3Ds vector starting at fromPt until it finds min2DPts in two planes. It returns</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    <span class="comment">// with the index of that point (+1) in the TP3Ds vector. The dir variable defines the scan direction in</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    <span class="comment">// the TP3Ds vector</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    <span class="keywordflow">if</span> (fromPt &gt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() - 1) <span class="keywordflow">return</span> USHRT_MAX;</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() &lt; 2 * min2DPts) <span class="keywordflow">return</span> USHRT_MAX;</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    <span class="keywordflow">if</span> (dir == 0) <span class="keywordflow">return</span> USHRT_MAX;</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    std::vector&lt;unsigned short&gt; cntInPln(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>);</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    <span class="keywordflow">for</span> (std::size_t ii = 0; ii &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size(); ++ii) {</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = fromPt + ii;</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;      <span class="keywordflow">if</span> (dir &lt; 0) ipt = fromPt - ii;</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;      <span class="keywordflow">if</span> (ipt &gt;= pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size()) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;      <span class="keyword">auto</span>&amp; tp3d = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[ipt];</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;      <span class="keywordflow">if</span> (!tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tp3d.TjID - 1].CTP).<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>;</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;      ++cntInPln[plane];</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> enufInPlane = 0;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = 0; plane &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>; ++plane)</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;        <span class="keywordflow">if</span> (cntInPln[plane] &gt;= min2DPts) ++enufInPlane;</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;      <span class="keywordflow">if</span> (enufInPlane &gt; 1) <span class="keywordflow">return</span> ipt + 1;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;      <span class="keywordflow">if</span> (dir &lt; 0 &amp;&amp; ipt == 0) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    <span class="keywordflow">return</span> USHRT_MAX;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;  } <span class="comment">// Find3DRecoRange</span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a0f4567ffd484515a083b3c673e307210"> 1391</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a0f4567ffd484515a083b3c673e307210">GetRange</a>(<span class="keyword">const</span> <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp,</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;           <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sfIndex,</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;           <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>&amp; fromPt,</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;           <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>&amp; npts)</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;  {</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    fromPt = USHRT_MAX;</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <span class="keywordflow">if</span> (sfIndex &gt;= pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    fromPt = USHRT_MAX;</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    npts = 0;</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    <span class="comment">// Note that no test is made for not-good TP3Ds here since that would give a wrong npts count</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <span class="keywordflow">for</span> (std::size_t ipt = 0; ipt &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size(); ++ipt) {</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;      <span class="keyword">auto</span>&amp; tp3d = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[ipt];</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;      <span class="keywordflow">if</span> (tp3d.SFIndex &lt; sfIndex) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;      <span class="keywordflow">if</span> (tp3d.SFIndex &gt; sfIndex) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;      <span class="keywordflow">if</span> (fromPt == USHRT_MAX) fromPt = ipt;</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;      ++npts;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;  }   <span class="comment">// GetRange</span></div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span></div>
<div class="line"><a name="l01413"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a7045ad35dda0875138741a27c2fa6885"> 1413</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a7045ad35dda0875138741a27c2fa6885">FitSection</a>(<a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html">detinfo::DetectorClocksData</a> <span class="keyword">const</span>&amp; clockData,</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;             <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;             <span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc,</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;             <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp,</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;             <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sfIndex)</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  {</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    <span class="comment">// Fits the TP3D points in the selected section to a 3D line with the origin at the center of</span></div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    <span class="comment">// the section</span></div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() &lt; 4) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <span class="keywordflow">if</span> (sfIndex &gt;= pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    <span class="comment">// don&#39;t fit a small angle PFP</span></div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <span class="keywordflow">if</span>(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1ae3c02e1143205b4d7a8e93437965aa47">kSmallAngle</a>]) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> fromPt = USHRT_MAX;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> npts = 0;</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a0f4567ffd484515a083b3c673e307210">GetRange</a>(pfp, sfIndex, fromPt, npts);</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    <span class="keywordflow">if</span> (fromPt == USHRT_MAX) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    <span class="keywordflow">if</span> (npts &lt; 4) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <span class="comment">// check for errors</span></div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = fromPt; ipt &lt; fromPt + npts; ++ipt) {</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;      <span class="keyword">auto</span>&amp; tp3d = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[ipt];</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;      <span class="keywordflow">if</span> (tp3d.SFIndex != sfIndex) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    <span class="comment">// fit these points and update</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    <span class="keywordtype">float</span> chiDOF = 999;</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d0f/namespacetca.html#a63003e064041f039c7fa885f842a594f">FitTP3Ds</a>(detProp, slc, pfp, fromPt, npts, sfIndex, chiDOF);</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  } <span class="comment">// FitSection</span></div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="comment"></span>  SectionFit</div>
<div class="line"><a name="l01446"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a63003e064041f039c7fa885f842a594f"> 1446</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a63003e064041f039c7fa885f842a594f">FitTP3Ds</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;           <span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc,</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;           <span class="keyword">const</span> std::vector&lt;TP3D&gt;&amp; tp3ds,</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;           <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> fromPt,</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;           <span class="keywordtype">short</span> fitDir,</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;           <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nPtsFit)</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;  {</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    <span class="comment">// fits the points and returns the fit results in a SectionFit struct. This function assumes that the</span></div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <span class="comment">// vector of TP3Ds exists in the slc.TPCID</span></div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    <a class="code" href="../../d3/d08/structtca_1_1SectionFit.html">SectionFit</a> sf;</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    sf.<a class="code" href="../../d3/d08/structtca_1_1SectionFit.html#ad078b391ff1c4c117fc7ba50c1f26d85">ChiDOF</a> = 999;</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <span class="keywordflow">if</span> (nPtsFit &lt; 5) <span class="keywordflow">return</span> sf;</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    <span class="keywordflow">if</span> (!(fitDir == -1 || fitDir == 1)) <span class="keywordflow">return</span> sf;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    <span class="keywordflow">if</span> (fitDir == 1 &amp;&amp; fromPt + nPtsFit &gt; tp3ds.size()) <span class="keywordflow">return</span> sf;</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    <span class="keywordflow">if</span> (fitDir == -1 &amp;&amp; fromPt &lt; 3) <span class="keywordflow">return</span> sf;</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    <span class="comment">// put the offset, cosine-like and sine-like components in a vector</span></div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    std::vector&lt;std::array&lt;double, 3&gt;&gt; ocs(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>);</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = 0; plane &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>; ++plane) {</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;      <span class="keyword">auto</span> planeID = <a class="code" href="../../d2/d66/namespacegeo_1_1fhicl.html#a05ff5cebd7313582756a33d8e8a5971a">geo::PlaneID</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>, slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>, plane);</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      <span class="comment">// plane offset</span></div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;      ocs[plane][0] = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#ae81e63f01473939eb6bc9c2cb5455906">WireCoordinate</a>(0, 0, planeID);</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;      <span class="comment">// get the &quot;cosine-like&quot; component</span></div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      ocs[plane][1] = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#ae81e63f01473939eb6bc9c2cb5455906">WireCoordinate</a>(1, 0, planeID) - ocs[plane][0];</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;      <span class="comment">// the &quot;sine-like&quot; component</span></div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;      ocs[plane][2] = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#ae81e63f01473939eb6bc9c2cb5455906">WireCoordinate</a>(0, 1, planeID) - ocs[plane][0];</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    } <span class="comment">// plane</span></div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nvars = 4;</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> npts = 0;</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;    <span class="comment">// count the number of TPs in each plane</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    std::vector&lt;unsigned short&gt; cntInPln(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>, 0);</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    <span class="comment">// and define the X position for the fit origin</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    <span class="keywordtype">double</span> x0 = 0.;</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">short</span> ii = 0; ii &lt; nPtsFit; ++ii) {</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;      <span class="keywordtype">short</span> ipt = fromPt + fitDir * ii;</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;      <span class="keywordflow">if</span> (ipt &lt; 0 || ipt &gt;= (<span class="keywordtype">short</span>)tp3ds.size()) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;      <span class="keyword">auto</span>&amp; tp3d = tp3ds[ipt];</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;      <span class="keywordflow">if</span> (!tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      <span class="keywordflow">if</span> (tp3d.TPXErr2 &lt; 0.0001) <span class="keywordflow">return</span> sf;</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;      x0 += tp3d.TPX;</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(tp3d.CTP).<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>;</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;      ++cntInPln[plane];</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;      ++npts;</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    <span class="keywordflow">if</span> (npts &lt; 6) <span class="keywordflow">return</span> sf;</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    <span class="comment">// ensure there are at least three points in at least two planes</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> enufInPlane = 0;</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = 0; plane &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>; ++plane)</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;      <span class="keywordflow">if</span> (cntInPln[plane] &gt; 2) ++enufInPlane;</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    <span class="keywordflow">if</span> (enufInPlane &lt; 2) <span class="keywordflow">return</span> sf;</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    x0 /= (double)npts;</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    TMatrixD <a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#a62b15446ae03a5857d5e03fa30b03fd4">A</a>(npts, nvars);</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    <span class="comment">// vector holding the Wire number</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    TVectorD <a class="code" href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">w</a>(npts);</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> cnt = 0;</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    <span class="keywordtype">double</span> weight = 1;</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">short</span> ii = 0; ii &lt; nPtsFit; ++ii) {</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;      <span class="keywordtype">short</span> ipt = fromPt + fitDir * ii;</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;      <span class="keyword">auto</span>&amp; tp3d = tp3ds[ipt];</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;      <span class="keywordflow">if</span> (!tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(tp3d.CTP).<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>;</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;      <span class="keywordtype">double</span> <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a> = tp3d.TPX - x0;</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;      A[cnt][0] = weight * ocs[plane][1];</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;      A[cnt][1] = weight * ocs[plane][2];</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;      A[cnt][2] = weight * ocs[plane][1] * <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a>;</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;      A[cnt][3] = weight * ocs[plane][2] * <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a>;</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;      w[cnt] = weight * (tp3d.Wire - ocs[plane][0]);</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;      ++cnt;</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    TDecompSVD svd(A);</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    <span class="keywordtype">bool</span> ok;</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    TVectorD tVec = svd.Solve(w, ok);</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    <span class="keywordflow">if</span> (!ok) <span class="keywordflow">return</span> sf;</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a> = sqrt(1 + tVec[2] * tVec[2] + tVec[3] * tVec[3]);</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    norm *= -1;</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    sf.<a class="code" href="../../d3/d08/structtca_1_1SectionFit.html#ae1f8bccac742a3abfc089a67ee2c3ab0">Dir</a>[0] = 1 / <a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    sf.<a class="code" href="../../d3/d08/structtca_1_1SectionFit.html#ae1f8bccac742a3abfc089a67ee2c3ab0">Dir</a>[1] = tVec[2] / <a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    sf.<a class="code" href="../../d3/d08/structtca_1_1SectionFit.html#ae1f8bccac742a3abfc089a67ee2c3ab0">Dir</a>[2] = tVec[3] / <a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    sf.<a class="code" href="../../d3/d08/structtca_1_1SectionFit.html#a05413670eb1df940120611f13a87f46e">Pos</a>[0] = x0;</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    sf.<a class="code" href="../../d3/d08/structtca_1_1SectionFit.html#a05413670eb1df940120611f13a87f46e">Pos</a>[1] = tVec[0];</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    sf.<a class="code" href="../../d3/d08/structtca_1_1SectionFit.html#a05413670eb1df940120611f13a87f46e">Pos</a>[2] = tVec[1];</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;    sf.<a class="code" href="../../d3/d08/structtca_1_1SectionFit.html#a94932439cfabd228569ca74229410f96">NPts</a> = npts;</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    <span class="comment">// Calculate errors from sigma * (A^T * A)^(-1) where sigma is the</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;    <span class="comment">// error on the wire number (= 1)</span></div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;    TMatrixD AT(nvars, npts);</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;    AT.Transpose(A);</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    TMatrixD ATA = AT * <a class="code" href="../../d3/d5d/namespacelib_1_1dedx.html#a62b15446ae03a5857d5e03fa30b03fd4">A</a>;</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    <span class="keywordtype">double</span>* det = 0;</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    <span class="keywordflow">try</span>{ ATA.Invert(det); }</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    <span class="keywordflow">catch</span>(...) { <span class="keywordflow">return</span> sf; }</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    sf.<a class="code" href="../../d3/d08/structtca_1_1SectionFit.html#a5a9e3a0ec74356ed4b9b463f599f4f6c">DirErr</a>[1] = -sqrt(ATA[2][2]) / <a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    sf.<a class="code" href="../../d3/d08/structtca_1_1SectionFit.html#a5a9e3a0ec74356ed4b9b463f599f4f6c">DirErr</a>[2] = -sqrt(ATA[3][3]) / <a class="code" href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">norm</a>;</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    <span class="comment">// calculate ChiDOF</span></div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    sf.<a class="code" href="../../d3/d08/structtca_1_1SectionFit.html#ad078b391ff1c4c117fc7ba50c1f26d85">ChiDOF</a> = 0;</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    <span class="comment">// project this 3D vector into a TP in every plane</span></div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    std::vector&lt;TrajPoint&gt; plnTP(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>);</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = 0; plane &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>; ++plane) {</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a0c55ac735de824c3e089bcbea9addb71">CTP_t</a> inCTP = <a class="code" href="../../de/d0f/namespacetca.html#a8806e1c32119afbfe02dff4c21cf3e57">EncodeCTP</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>, slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>, plane);</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;      plnTP[plane] = <a class="code" href="../../de/d0f/namespacetca.html#abf31bab3395b5e2325f017d9b7db50db">MakeBareTP</a>(detProp, slc, sf.<a class="code" href="../../d3/d08/structtca_1_1SectionFit.html#a05413670eb1df940120611f13a87f46e">Pos</a>, sf.<a class="code" href="../../d3/d08/structtca_1_1SectionFit.html#ae1f8bccac742a3abfc089a67ee2c3ab0">Dir</a>, inCTP);</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    } <span class="comment">// plane</span></div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    <span class="comment">// a local position</span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a> pos;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    sf.<a class="code" href="../../d3/d08/structtca_1_1SectionFit.html#a5a9e3a0ec74356ed4b9b463f599f4f6c">DirErr</a>[0] = 0.;</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">short</span> ii = 0; ii &lt; nPtsFit; ++ii) {</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;      <span class="keywordtype">short</span> ipt = fromPt + fitDir * ii;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;      <span class="keyword">auto</span>&amp; tp3d = tp3ds[ipt];</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;      <span class="keywordflow">if</span> (!tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(tp3d.CTP).<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>;</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;      <span class="keywordtype">double</span> dw = tp3d.Wire - plnTP[plane].Pos[0];</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;      <span class="comment">// dt/dW was stored in DeltaRMS by MakeBareTP</span></div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;      <span class="keywordtype">double</span> t = dw * plnTP[plane].DeltaRMS;</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> xyz = 0; xyz &lt; 3; ++xyz)</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;        pos[xyz] = sf.<a class="code" href="../../d3/d08/structtca_1_1SectionFit.html#a05413670eb1df940120611f13a87f46e">Pos</a>[xyz] + t * sf.<a class="code" href="../../d3/d08/structtca_1_1SectionFit.html#ae1f8bccac742a3abfc089a67ee2c3ab0">Dir</a>[xyz];</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;      <span class="comment">// Note that the tp3d position is directly above the wire position and not the</span></div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;      <span class="comment">// point at the distance of closest approach. Delta is the difference in the</span></div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;      <span class="comment">// drift direction in cm</span></div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;      <span class="keywordtype">double</span> delta = pos[0] - tp3d.TPX;</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;      sf.<a class="code" href="../../d3/d08/structtca_1_1SectionFit.html#ad078b391ff1c4c117fc7ba50c1f26d85">ChiDOF</a> += delta * delta / tp3d.TPXErr2;</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;      <span class="comment">// estimate the X slope error ~ X direction vector with an overly simple average</span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;      <span class="keywordtype">double</span> dangErr = delta / dw;</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;      sf.<a class="code" href="../../d3/d08/structtca_1_1SectionFit.html#a5a9e3a0ec74356ed4b9b463f599f4f6c">DirErr</a>[0] += dangErr * dangErr;</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    } <span class="comment">// indx</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    sf.<a class="code" href="../../d3/d08/structtca_1_1SectionFit.html#a5a9e3a0ec74356ed4b9b463f599f4f6c">DirErr</a>[0] = sqrt(sf.<a class="code" href="../../d3/d08/structtca_1_1SectionFit.html#a5a9e3a0ec74356ed4b9b463f599f4f6c">DirErr</a>[0]) / (double)nPtsFit;</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;    sf.<a class="code" href="../../d3/d08/structtca_1_1SectionFit.html#ad078b391ff1c4c117fc7ba50c1f26d85">ChiDOF</a> /= (float)(npts - 4);</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    <span class="keywordflow">return</span> sf;</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;  } <span class="comment">// FitTP3Ds</span></div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span></div>
<div class="line"><a name="l01586"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a4f52cee1904b889d6dee317e6da38dff"> 1586</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a63003e064041f039c7fa885f842a594f">FitTP3Ds</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;           <span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc,</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;           <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp,</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;           <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> fromPt,</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;           <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nPtsFit,</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;           <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sfIndex,</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;           <span class="keywordtype">float</span>&amp; chiDOF)</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;  {</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    <span class="comment">// Fit points in the pfp.TP3Ds vector fromPt. This function</span></div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    <span class="comment">// doesn&#39;t update the TP3Ds unless sfIndex refers to a valid SectionFit in the pfp.</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    <span class="comment">// No check is made to ensure that the TP3D SFIndex variable is compatible with sfIndex</span></div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    <span class="keywordflow">if</span> (nPtsFit &lt; 5) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;    <span class="keywordflow">if</span> (fromPt + nPtsFit &gt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    <span class="keyword">auto</span> sf = <a class="code" href="../../de/d0f/namespacetca.html#a63003e064041f039c7fa885f842a594f">FitTP3Ds</a>(detProp, slc, pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>, fromPt, 1, nPtsFit);</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;    <span class="keywordflow">if</span> (sf.ChiDOF &gt; 900) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    <span class="comment">// don&#39;t update the pfp?</span></div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    <span class="keywordflow">if</span> (sfIndex &gt;= pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size()) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    <span class="comment">// update the pfp Sectionfit</span></div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>[sfIndex] = sf;</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    <span class="comment">// update the TP3Ds</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    <span class="comment">// project this 3D vector into a TP in every plane</span></div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;    std::vector&lt;TrajPoint&gt; plnTP(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>);</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = 0; plane &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>; ++plane) {</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a0c55ac735de824c3e089bcbea9addb71">CTP_t</a> inCTP = <a class="code" href="../../de/d0f/namespacetca.html#a8806e1c32119afbfe02dff4c21cf3e57">EncodeCTP</a>(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a2aeca07e5620225d35f27cdff6cc9048">TPCID</a>.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>, pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a2aeca07e5620225d35f27cdff6cc9048">TPCID</a>.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>, plane);</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;      plnTP[plane] = <a class="code" href="../../de/d0f/namespacetca.html#abf31bab3395b5e2325f017d9b7db50db">MakeBareTP</a>(detProp, slc, sf.Pos, sf.Dir, inCTP);</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    } <span class="comment">// plane</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a> pos;</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;    <span class="keywordtype">bool</span> needsSort = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;    <span class="keywordtype">double</span> prevAlong = 0;</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = fromPt; ipt &lt; fromPt + nPtsFit; ++ipt) {</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;      <span class="keyword">auto</span>&amp; tp3d = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[ipt];</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(tp3d.CTP).<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>;</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;      <span class="keywordtype">double</span> dw = tp3d.Wire - plnTP[plane].Pos[0];</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;      <span class="comment">// dt/dW was stored in DeltaRMS by MakeBareTP</span></div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;      <span class="keywordtype">double</span> t = dw * plnTP[plane].DeltaRMS;</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;      <span class="keywordflow">if</span> (ipt == fromPt) { prevAlong = t; }</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;        <span class="keywordflow">if</span> (t &lt; prevAlong) needsSort = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;        prevAlong = t;</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;      }</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> xyz = 0; xyz &lt; 3; ++xyz)</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;        pos[xyz] = sf.Pos[xyz] + t * sf.Dir[xyz];</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;      <span class="comment">// Note that the tp3d position is directly above the wire position and not the</span></div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;      <span class="comment">// distance of closest approach. The Delta variable is the difference in the</span></div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;      <span class="comment">// drift direction in cm</span></div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;      <span class="keywordtype">double</span> delta = pos[0] - tp3d.TPX;</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;      tp3d.Pos = pos;</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;      tp3d.Dir = sf.Dir;</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;      tp3d.along = t;</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;      <a class="code" href="../../de/d71/neoSmazza_8sh.html#ae55989c903f0c76190facfb5e5211732">if</a> (tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>]) sf.ChiDOF += delta * delta / tp3d.TPXErr2;</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    <span class="keywordflow">if</span> (needsSort) <a class="code" href="../../de/d0f/namespacetca.html#a881a9f856411db2bb90b1964068712f5">SortSection</a>(pfp, sfIndex);</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>[sfIndex].NeedsUpdate = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;  } <span class="comment">// FitTP3Ds</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l01649"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#ae8eec67647640ee5f3c0eaf79ebcc127"> 1649</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#ae8eec67647640ee5f3c0eaf79ebcc127">ReconcileVertices</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp, <span class="keywordtype">bool</span> prt)</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;  {</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    <span class="comment">// Checks for mis-placed 2D and 3D vertices and either attaches them</span></div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    <span class="comment">// to a vertex or deletes(?) the vertex while attempting to preserve or</span></div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    <span class="comment">// correct the P -&gt; T -&gt; 2V -&gt; 3V assn. After this is done, the function</span></div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    <span class="comment">// TCVertex/AttachToAnyVertex is called.</span></div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    <span class="comment">// This function returns true if something was done to the pfp that requires</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    <span class="comment">// a re-definition of the pfp, e.g. adding or removing TP3Ds. Note that this</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    <span class="comment">// never occurs as the function is currently written</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a967d80bf479e4bbcc0c0d1ad76c707d5">vtx3DCuts</a>.size() &lt; 3) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da2a2fbf12f53411c1338f1cf546b62cc3">kJunk3D</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    <span class="keywordflow">if</span>(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1ae3c02e1143205b4d7a8e93437965aa47">kSmallAngle</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;    <span class="comment">// first make a list of all Tjs</span></div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;    std::vector&lt;int&gt; tjList;</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; tp3d : pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>) {</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;      <span class="keywordflow">if</span> (!tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;      <span class="comment">// ignore single hits</span></div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;      <span class="keywordflow">if</span> (tp3d.TjID &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;      <span class="keywordflow">if</span> (std::find(tjList.begin(), tjList.end(), tp3d.TjID) == tjList.end())</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;        tjList.push_back(tp3d.TjID);</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;    } <span class="comment">// tp3d</span></div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    <span class="comment">// look for 3D vertices associated with these Tjs and list of</span></div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;    <span class="comment">// orphan 2D vertices - those that are not matched to 3D vertices</span></div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    std::vector&lt;int&gt; vx2List, vx3List;</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> tid : tjList) {</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;      <span class="keyword">auto</span>&amp; tj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tid - 1];</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> = 0; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> &lt; 2; ++<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>) {</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;        <span class="keywordflow">if</span> (tj.VtxID[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>] &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;        <span class="keyword">auto</span>&amp; vx2 = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad94c65623983dd14ecee8a4166c6e582">vtxs</a>[tj.VtxID[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>] - 1];</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;        <span class="keywordflow">if</span> (vx2.Vx3ID &gt; 0) {</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;          <span class="keywordflow">if</span> (std::find(vx3List.begin(), vx3List.end(), vx2.Vx3ID) == vx3List.end())</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;            vx3List.push_back(vx2.Vx3ID);</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;          <span class="comment">// 3D vertex exists</span></div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;        }</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;          <span class="comment">// no 3D vertex</span></div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;          <span class="keywordflow">if</span> (std::find(vx2List.begin(), vx2List.end(), tj.VtxID[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>]) == vx2List.end())</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;            vx2List.push_back(tj.VtxID[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>]);</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;        } <span class="comment">// no 3D vertex</span></div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;      }   <span class="comment">// end</span></div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;    }     <span class="comment">// tid</span></div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;    <span class="comment">// no vertex reconciliation is necessary</span></div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    <span class="keywordflow">if</span> (vx2List.empty() &amp;&amp; vx3List.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    <span class="keywordflow">if</span> (prt) {</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;      mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;      myprt &lt;&lt; <span class="stringliteral">&quot;RV: P&quot;</span> &lt;&lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a51b8e48c9df5507929ae0b6429cc7494">ID</a> &lt;&lt; <span class="stringliteral">&quot; -&gt;&quot;</span>;</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> tid : tjList)</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;        myprt &lt;&lt; <span class="stringliteral">&quot; T&quot;</span> &lt;&lt; tid;</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;      myprt &lt;&lt; <span class="stringliteral">&quot; -&gt;&quot;</span>;</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> vid : vx3List)</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;        myprt &lt;&lt; <span class="stringliteral">&quot; 3V&quot;</span> &lt;&lt; vid;</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;      <span class="keywordflow">if</span> (!vx2List.empty()) {</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;        myprt &lt;&lt; <span class="stringliteral">&quot; orphan&quot;</span>;</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> vid : vx2List)</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;          myprt &lt;&lt; <span class="stringliteral">&quot; 2V&quot;</span> &lt;&lt; vid;</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;      }</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    } <span class="comment">// prt</span></div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    <span class="comment">// Just kill the orphan 2D vertices regardless of their score.</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    <span class="comment">// This is an indicator that the vertex was created between two tjs</span></div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    <span class="comment">// that maybe should have been reconstructed as one or alternatively</span></div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    <span class="comment">// as two Tjs. This decision presumes the existence of a 3D kink</span></div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    <span class="comment">// algorithm that doesn&#39;t yet exist...</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> vid : vx2List) {</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;      <span class="keyword">auto</span>&amp; vx2 = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad94c65623983dd14ecee8a4166c6e582">vtxs</a>[vid - 1];</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#aba6e9ff2e76ddbc58d971f61b9897ca8">MakeVertexObsolete</a>(<span class="stringliteral">&quot;RV&quot;</span>, slc, vx2, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    } <span class="comment">// vx2List</span></div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    <span class="comment">// ignore the T -&gt; 2V -&gt; 3V assns (if any exist) and try to directly</span></div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    <span class="comment">// attach to 3D vertices at both ends</span></div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a9fd1ad10d91864b22ca292c19769f31f">AttachToAnyVertex</a>(slc, pfp, <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a967d80bf479e4bbcc0c0d1ad76c707d5">vtx3DCuts</a>[2], prt);</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;    <span class="comment">// check for differences and while we are here, see if the pfp was attached</span></div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    <span class="comment">// to a neutrino vertex and the direction is wrong</span></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    <span class="keywordtype">int</span> neutrinoVx = 0;</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    <span class="keywordflow">if</span> (!slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">pfps</a>.empty()) {</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;      <span class="keyword">auto</span>&amp; npfp = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">pfps</a>[0];</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;      <span class="keywordtype">bool</span> neutrinoPFP = (npfp.PDGCode == 12 || npfp.PDGCode == 14);</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;      <span class="keywordflow">if</span> (neutrinoPFP) neutrinoVx = npfp.Vx3ID[0];</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;    } <span class="comment">// pfps exist</span></div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> neutrinoVxEnd = 2;</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> = 0; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> &lt; 2; ++<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>) {</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;      <span class="comment">// see if a vertex got attached</span></div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;      <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aabf1e43ae7c3343a2b49d36bd2fe63ba">Vx3ID</a>[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>] &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;      <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aabf1e43ae7c3343a2b49d36bd2fe63ba">Vx3ID</a>[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>] == neutrinoVx) neutrinoVxEnd = <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>;</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;      <span class="comment">// see if this is a vertex in the list using the T -&gt; 2V -&gt; 3V assns</span></div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;      <span class="keywordflow">if</span> (std::find(vx3List.begin(), vx3List.end(), pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aabf1e43ae7c3343a2b49d36bd2fe63ba">Vx3ID</a>[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>]) != vx3List.end()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;    } <span class="comment">// end</span></div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;    <span class="keywordflow">if</span> (neutrinoVxEnd &lt; 2 &amp;&amp; neutrinoVxEnd != 0) <a class="code" href="../../de/d0f/namespacetca.html#ac9a7192422bb8f4f56944923ff22b9f0">Reverse</a>(slc, pfp);</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;  } <span class="comment">// ReconcileVertices</span></div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#ae9e0a86f0ca2a8797635a11ea700f74f"> 1744</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#ae9e0a86f0ca2a8797635a11ea700f74f">FillGaps3D</a>(<a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html">detinfo::DetectorClocksData</a> <span class="keyword">const</span>&amp; clockData,</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;             <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;             <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc,</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;             <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp,</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;             <span class="keywordtype">bool</span> prt)</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;  {</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;    <span class="comment">// Look for gaps in each plane in the TP3Ds vector in planes in which</span></div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    <span class="comment">// the projection of the pfp angle is large (~&gt; 60 degrees). Hits</span></div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    <span class="comment">// reconstructed at large angles are poorly reconstructed which results</span></div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    <span class="comment">// in poorly reconstructed 2D trajectories</span></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a51b8e48c9df5507929ae0b6429cc7494">ID</a> &lt;= 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da71fb719dbe626b8badbe67cc4793228b">kFillGaps3D</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da2a2fbf12f53411c1338f1cf546b62cc3">kJunk3D</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1ae3c02e1143205b4d7a8e93437965aa47">kSmallAngle</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    <span class="comment">// Only print APIR details if MVI is set</span></div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    <span class="keywordtype">bool</span> foundMVI = (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aec895e58be3fe5a64a2a2418f0e473c7">dbgPFP</a> &amp;&amp; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a24c761b3091ff8a756eb3069232466f8">MVI</a> == <a class="code" href="../../de/d0f/namespacetca.html#ad232469b22f64d38891a7038f0e36ef3">debug</a>.<a class="code" href="../../d8/de4/structtca_1_1DebugStuff.html#a65233ccccd21a4284acdb6249369473c">MVI</a>);</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    <span class="comment">// make a copy in case something goes wrong</span></div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    <span class="keyword">auto</span> pWork = pfp;</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nPtsAdded = 0;</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> fromPt = 0;</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> toPt = pWork.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size();</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = 0; plane &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>; ++plane) {</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a0c55ac735de824c3e089bcbea9addb71">CTP_t</a> inCTP = <a class="code" href="../../de/d0f/namespacetca.html#a8806e1c32119afbfe02dff4c21cf3e57">EncodeCTP</a>(pWork.TPCID.Cryostat, pWork.TPCID.TPC, plane);</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nWires, nAdd;</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a22c4b4eb27d598f7003739f6752125de">AddPointsInRange</a>(clockData,</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;                       detProp,</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;                       slc,</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;                       pWork,</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;                       fromPt,</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;                       toPt,</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;                       inCTP,</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;                       <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[4],</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;                       nWires,</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;                       nAdd,</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;                       foundMVI);</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;      <span class="keywordflow">if</span> (pWork.Flags[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1a16c8b0d8524fc0914afc3dab9bf89950">kNeedsUpdate</a>]) <a class="code" href="../../de/d0f/namespacetca.html#a26e3b3c5f6ab13bbdb0e91d6f4858e13">Update</a>(clockData, detProp, slc, pWork, prt);</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;      nPtsAdded += nAdd;</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;    } <span class="comment">// plane</span></div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;    <span class="keywordflow">if</span> (prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;FG3D P&quot;</span> &lt;&lt; pWork.ID &lt;&lt; <span class="stringliteral">&quot; added &quot;</span> &lt;&lt; nPtsAdded &lt;&lt; <span class="stringliteral">&quot; points&quot;</span>;</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;    <span class="keywordflow">if</span> (pWork.Flags[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1a16c8b0d8524fc0914afc3dab9bf89950">kNeedsUpdate</a>] &amp;&amp; !<a class="code" href="../../de/d0f/namespacetca.html#a26e3b3c5f6ab13bbdb0e91d6f4858e13">Update</a>(clockData, detProp, slc, pWork, prt)) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    pfp = pWork;</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;  } <span class="comment">// FillGaps3D</span></div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span></div>
<div class="line"><a name="l01796"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#ac82285eff8fcdf6ba7a4b74ded6adcd8"> 1796</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#ac82285eff8fcdf6ba7a4b74ded6adcd8">ValidTwoPlaneMatch</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;                     <span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc,</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;                     <span class="keyword">const</span> <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp)</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;  {</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;    <span class="comment">// This function checks the third plane in the PFP when only two Tjs are 3D-matched to</span></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    <span class="comment">// ensure that the reason for the lack of a 3rd plane match is that it is in a dead region.</span></div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    <span class="comment">// This function should be used after an initial fit is done and the TP3Ds are sorted</span></div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">TjIDs</a>.size() != 2) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    <span class="keywordflow">if</span> (slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a> != 3) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.empty()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;    <span class="comment">// find the third plane</span></div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    std::vector&lt;unsigned short&gt; <a class="code" href="../../d2/dbd/trackfinderalgorithms_8fcl.html#ac996980052e16111a1efc913778a5f5f">planes</a>;</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> tid : pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">TjIDs</a>)</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;      planes.push_back(<a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tid - 1].CTP).<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>);</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> thirdPlane = 3 - planes[0] - planes[1];</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a0c55ac735de824c3e089bcbea9addb71">CTP_t</a> inCTP = <a class="code" href="../../de/d0f/namespacetca.html#a8806e1c32119afbfe02dff4c21cf3e57">EncodeCTP</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>, slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>, thirdPlane);</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    <span class="comment">// Project the 3D position at the start into the third plane</span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    <span class="keyword">auto</span> tp = <a class="code" href="../../de/d0f/namespacetca.html#abf31bab3395b5e2325f017d9b7db50db">MakeBareTP</a>(detProp, slc, pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[0].Pos, inCTP);</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wire0 = 0;</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    <span class="keywordflow">if</span> (tp.Pos[0] &gt; 0) wire0 = std::nearbyint(tp.Pos[0]);</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    <span class="keywordflow">if</span> (wire0 &gt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a2bfd4002c7f6fbe64e1fc1591682870b">nWires</a>[thirdPlane]) wire0 = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a2bfd4002c7f6fbe64e1fc1591682870b">nWires</a>[thirdPlane];</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;    <span class="comment">// Do the same for the end</span></div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> lastPt = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() - 1;</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;    tp = <a class="code" href="../../de/d0f/namespacetca.html#abf31bab3395b5e2325f017d9b7db50db">MakeBareTP</a>(detProp, slc, pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[lastPt].Pos, inCTP);</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wire1 = 0;</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    <span class="keywordflow">if</span> (tp.Pos[0] &gt; 0) wire1 = std::nearbyint(tp.Pos[0]);</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    <span class="keywordflow">if</span> (wire1 &gt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a2bfd4002c7f6fbe64e1fc1591682870b">nWires</a>[thirdPlane]) wire1 = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a2bfd4002c7f6fbe64e1fc1591682870b">nWires</a>[thirdPlane];</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;    <span class="keywordflow">if</span> (wire0 == wire1) <span class="keywordflow">return</span> !<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#a08d6f9aad54acbd12cfcc44e77e6e29d">goodWire</a>[thirdPlane][wire0];</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;    <span class="keywordflow">if</span> (wire1 &lt; wire0) std::swap(wire0, wire1);</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    <span class="comment">// count the number of good wires</span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    <span class="keywordtype">int</span> dead = 0;</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    <span class="keywordtype">int</span> wires = wire1 - wire0;</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wire = wire0; wire &lt; wire1; ++wire)</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#a08d6f9aad54acbd12cfcc44e77e6e29d">goodWire</a>[thirdPlane][wire]) ++dead;</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    <span class="comment">// require that most of the wires are dead</span></div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    <span class="keywordflow">return</span> (dead &gt; 0.8 * wires);</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;  } <span class="comment">// ValidTwoPlaneMatch</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l01837"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a22c4b4eb27d598f7003739f6752125de"> 1837</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a22c4b4eb27d598f7003739f6752125de">AddPointsInRange</a>(<a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html">detinfo::DetectorClocksData</a> <span class="keyword">const</span>&amp; clockData,</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;                   <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;                   <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc,</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;                   <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp,</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;                   <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> fromPt,</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;                   <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> toPt,</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;                   <a class="code" href="../../de/d0f/namespacetca.html#a0c55ac735de824c3e089bcbea9addb71">CTP_t</a> inCTP,</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;                   <span class="keywordtype">float</span> maxPull,</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;                   <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>&amp; nWires,</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;                   <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>&amp; nAdd,</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;                   <span class="keywordtype">bool</span> prt)</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;  {</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;    <span class="comment">// Try to insert 2D trajectory points into the 3D trajectory point vector pfp.TP3Ds.</span></div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;    <span class="comment">// This function inserts new TP3Ds and sets the NeedsUpdate flags true.</span></div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;    <span class="comment">// The calling function should call Update</span></div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;    <span class="comment">// Note that maxPull is used for the charge pull as well as the position pull</span></div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;    nWires = 0;</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;    nAdd = 0;</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    <span class="keywordflow">if</span> (fromPt &gt; toPt) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;    <span class="keywordflow">if</span> (toPt &gt;= pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size()) toPt = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() - 1;</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;    <span class="comment">// Find the average dE/dx so we can apply a generous min/max dE/dx cut</span></div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;    <span class="keywordtype">float</span> dEdXAve = 0;</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;    <span class="keywordtype">float</span> dEdXRms = 0;</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#acc69bee8429400e1b6a273648829ea88">Average_dEdX</a>(clockData, detProp, slc, pfp, dEdXAve, dEdXRms);</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    <span class="keywordtype">float</span> dEdxMin = 0.5, dEdxMax = 50.;</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;    <span class="keywordflow">if</span> (dEdXAve &gt; 0.5) {</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;      dEdxMin = dEdXAve - maxPull * dEdXRms;</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;      <span class="keywordflow">if</span> (dEdxMin &lt; 0.5) dEdxMin = 0.5;</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;      dEdxMax = dEdXAve + maxPull * dEdXRms;</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;      <span class="keywordflow">if</span> (dEdxMax &gt; 50.) dEdxMax = 50.;</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;    } <span class="comment">// dEdXAve &gt; 0.5</span></div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;    <span class="comment">// Split the range into sub-ranges; one for each SectionFit and make 2D TPs at the</span></div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;    <span class="comment">// start of each sub-range.</span></div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    std::vector&lt;TrajPoint&gt; sfTPs;</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    <span class="comment">// form a list of TPs that are used in this CTP</span></div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    std::vector&lt;std::pair&lt;int, unsigned short&gt;&gt; tpUsed;</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; tp3d : pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>) {</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;      <span class="keywordflow">if</span> (tp3d.CTP != inCTP) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;      tpUsed.push_back(std::make_pair(tp3d.TjID, tp3d.TPIndex));</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    } <span class="comment">// tp3d</span></div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> toWire = 0;</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fromWire = UINT_MAX;</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> inSF = USHRT_MAX;</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> pln = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(inCTP).<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>;</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = 0; ipt &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size(); ++ipt) {</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;      <span class="keyword">auto</span>&amp; tp3d = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[ipt];</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;      <span class="comment">// Skip if not the last point and we already found a point in this SectionFit</span></div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;      <span class="keywordflow">if</span> (ipt &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() - 1 &amp;&amp; tp3d.SFIndex == inSF) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wire;</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;      <span class="keywordflow">if</span> (tp3d.CTP == inCTP) {</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;        <span class="comment">// Found the first tp3d in a new SectionFit and it is in the right CTP</span></div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;        <span class="keyword">auto</span>&amp; tp = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tp3d.TjID - 1].Pts[tp3d.TPIndex];</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;        sfTPs.push_back(tp);</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;        wire = std::nearbyint(tp.Pos[0]);</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;        <span class="keywordflow">if</span> (wire &gt;= slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a2bfd4002c7f6fbe64e1fc1591682870b">nWires</a>[pln]) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;      }</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;        <span class="comment">// Found the first tp3d in a new SectionFit and it is in a different CTP.</span></div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;        <span class="comment">// Make a TP in the right CTP</span></div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;        <span class="keyword">auto</span> tp = <a class="code" href="../../de/d0f/namespacetca.html#abf31bab3395b5e2325f017d9b7db50db">MakeBareTP</a>(detProp, slc, tp3d.Pos, tp3d.Dir, inCTP);</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;        wire = std::nearbyint(tp.Pos[0]);</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;        <span class="keywordflow">if</span> (wire &gt;= slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a2bfd4002c7f6fbe64e1fc1591682870b">nWires</a>[pln]) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;        sfTPs.push_back(tp);</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;      }</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;      <span class="keywordflow">if</span> (wire &lt; fromWire) fromWire = wire;</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;      <span class="keywordflow">if</span> (wire &gt; toWire) toWire = wire;</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;      inSF = tp3d.SFIndex;</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;    } <span class="comment">// tp3d</span></div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;    <span class="keywordflow">if</span> (sfTPs.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;    <span class="comment">// reverse the vector if necessary so the wires will be in increasing order</span></div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;    <span class="keywordflow">if</span> (sfTPs.size() &gt; 1 &amp;&amp; sfTPs[0].Pos[0] &gt; sfTPs.back().Pos[0]) {</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;      std::reverse(sfTPs.begin(), sfTPs.end());</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;    }</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;    <span class="comment">// set a generous search window in WSE units</span></div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;    <span class="keywordtype">float</span> window = 50;</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;    <span class="keywordflow">if</span> (prt)</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;APIR: inCTP &quot;</span> &lt;&lt; inCTP &lt;&lt; <span class="stringliteral">&quot; fromWire &quot;</span> &lt;&lt; fromWire &lt;&lt; <span class="stringliteral">&quot; toWire &quot;</span></div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;                            &lt;&lt; toWire;</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;    <span class="comment">// iterate over the sub-ranges</span></div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> subr = 0; subr &lt; sfTPs.size(); ++subr) {</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;      <span class="keyword">auto</span>&amp; fromTP = sfTPs[subr];</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> toWireInSF = toWire;</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;      <span class="keywordflow">if</span> (subr &lt; sfTPs.size() - 1) toWireInSF = std::nearbyint(sfTPs[subr + 1].Pos[0]);</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#adfeb5a1922b44080a785a41b47ef1fc7">SetAngleCode</a>(fromTP);</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fromWire = std::nearbyint(fromTP.Pos[0]);</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;      <span class="keywordflow">if</span> (fromWire &gt; toWire) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;      <span class="keywordflow">if</span> (prt)</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;        mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; inCTP &quot;</span> &lt;&lt; inCTP &lt;&lt; <span class="stringliteral">&quot; subr &quot;</span> &lt;&lt; subr &lt;&lt; <span class="stringliteral">&quot; fromWire &quot;</span> &lt;&lt; fromWire</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;                              &lt;&lt; <span class="stringliteral">&quot; toWireInSF &quot;</span> &lt;&lt; toWireInSF;</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wire = fromWire; wire &lt;= toWireInSF; ++wire) {</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#a9a2cd91c50f24261f799582dc9f0a76f">MoveTPToWire</a>(fromTP, (<span class="keywordtype">float</span>)wire);</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a519cf8a3170ec63e0b4d457f1d236109">FindCloseHits</a>(slc, fromTP, window, <a class="code" href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3a592a31ca0b683aeb15197694a71bd108">kUsedHits</a>)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;        <span class="keywordflow">if</span> (fromTP.Environment[<a class="code" href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525a6ed9c1ffc232022aa71db806f25ab10d">kEnvNotGoodWire</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;        <span class="keywordtype">float</span> bestPull = maxPull;</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;        <a class="code" href="../../d5/db8/structtca_1_1TP3D.html">TP3D</a> bestTP3D;</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> iht : fromTP.Hits) {</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;          <span class="keywordflow">if</span> (slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;          <span class="comment">// this hit is used in a TP so find the tpIndex</span></div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;          <span class="keyword">auto</span>&amp; utj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[iht].InTraj - 1];</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> tpIndex = 0;</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;          <span class="keywordflow">for</span> (tpIndex = utj.EndPt[0]; tpIndex &lt;= utj.EndPt[1]; ++tpIndex) {</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;            <span class="keyword">auto</span>&amp; utp = utj.Pts[tpIndex];</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;            <span class="keywordflow">if</span> (utp.Chg &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;            <span class="comment">// This doesn&#39;t check for UseHit true but that is probably ok here</span></div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;            <span class="keywordflow">if</span> (std::find(utp.Hits.begin(), utp.Hits.end(), iht) != utp.Hits.end()) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;          } <span class="comment">// ipt</span></div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;          <span class="keywordflow">if</span> (tpIndex &gt; utj.EndPt[1]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;          <span class="comment">// see if it is already used in this pfp</span></div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;          std::pair&lt;int, unsigned short&gt; tppr = std::make_pair(utj.ID, tpIndex);</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;          <span class="keywordflow">if</span> (std::find(tpUsed.begin(), tpUsed.end(), tppr) != tpUsed.end()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;          tpUsed.push_back(tppr);</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;          <span class="keyword">auto</span>&amp; utp = utj.Pts[tpIndex];</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;          <span class="comment">// see if it is used in a different PFP</span></div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;          <span class="keywordflow">if</span> (utp.InPFP &gt; 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;          <span class="comment">// or if it overlaps another trajectory near a 2D vertex</span></div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;          <span class="keywordflow">if</span> (utp.Environment[<a class="code" href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525ae8d79f565a18dd6877b890fa7cb6616b">kEnvOverlap</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;          <span class="keyword">auto</span> newTP3D = <a class="code" href="../../de/d0f/namespacetca.html#a1f3a9c0638f68964f62d19cbb80731da">CreateTP3D</a>(detProp, slc, utj.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a1ffe21c3ecd60e4fb956a776cdff9e5a">ID</a>, tpIndex);</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;          <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a3075ef4d0b2a15d016f66c3fbf2a8aac">SetSection</a>(detProp, slc, pfp, newTP3D)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;          <span class="comment">// set the direction to the direction of the SectionFit it is in so we can calculate dE/dx</span></div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;          newTP3D.Dir = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>[newTP3D.SFIndex].Dir;</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;          <span class="keywordtype">float</span> pull = <a class="code" href="../../de/d0f/namespacetca.html#a64a1d13b9dd367c5d94e5779daf22626">PointPull</a>(pfp, newTP3D);</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;          <span class="keywordtype">float</span> dedx = <a class="code" href="../../de/d0f/namespacetca.html#a03d7925cba1cd1c5952d280736887b6b">dEdx</a>(clockData, detProp, slc, newTP3D);</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;          <span class="comment">// Require a good pull and a consistent dE/dx (MeV/cm)</span></div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;          <span class="keywordtype">bool</span> useIt = (pull &lt; bestPull &amp;&amp; dedx &gt; dEdxMin &amp;&amp; dedx &lt; dEdxMax);</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;          <span class="keywordflow">if</span> (!useIt) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;          bestTP3D = newTP3D;</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;          bestPull = pull;</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;        } <span class="comment">// iht</span></div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;        <span class="keywordflow">if</span> (bestPull &lt; maxPull) {</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;          <span class="keywordflow">if</span> (prt &amp;&amp; bestPull &lt; 10) {</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;            mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;            <span class="keyword">auto</span>&amp; tp = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[bestTP3D.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#ab6cea7b9a15237b36cd057f43aab4d89">TjID</a> - 1].Pts[bestTP3D.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a0cf7385a035afbd0420ffde77a0f4e8b">TPIndex</a>];</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;            myprt &lt;&lt; <span class="stringliteral">&quot;APIR: P&quot;</span> &lt;&lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a51b8e48c9df5507929ae0b6429cc7494">ID</a> &lt;&lt; <span class="stringliteral">&quot; added TP &quot;</span> &lt;&lt; <a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tp);</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;            myprt &lt;&lt; <span class="stringliteral">&quot; pull &quot;</span> &lt;&lt; std::fixed &lt;&lt; std::setprecision(2) &lt;&lt; bestPull;</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;            myprt &lt;&lt; <span class="stringliteral">&quot; dx &quot;</span> &lt;&lt; bestTP3D.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a36c98f652f537113040d880f5898afaa">TPX</a> - bestTP3D.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a937c64030bd53c835902da63475db5f5">Pos</a>[0] &lt;&lt; <span class="stringliteral">&quot; in section &quot;</span> &lt;&lt; bestTP3D.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a9ec485b3235b668007802b7b717b3e40">SFIndex</a>;</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;          }</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a690a54ebd4990c8b9da44eb08fcf2a46">InsertTP3D</a>(pfp, bestTP3D) == USHRT_MAX) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;          ++nAdd;</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;        } <span class="comment">// bestPull &lt; maxPull</span></div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;      }   <span class="comment">// wire</span></div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;    }     <span class="comment">// subr</span></div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;  }       <span class="comment">// AddPointsInRange</span></div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;<span class="comment"></span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span></div>
<div class="line"><a name="l01988"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a690a54ebd4990c8b9da44eb08fcf2a46"> 1988</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a690a54ebd4990c8b9da44eb08fcf2a46">InsertTP3D</a>(<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp, <a class="code" href="../../d5/db8/structtca_1_1TP3D.html">TP3D</a>&amp; tp3d)</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;  {</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    <span class="comment">// inserts the tp3d into the section defined by tp3d.SFIndex</span></div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;    <span class="keywordflow">if</span> (tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a9ec485b3235b668007802b7b717b3e40">SFIndex</a> &gt;= pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size()) <span class="keywordflow">return</span> USHRT_MAX;</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;    <span class="comment">// Find the first occurrence of this SFIndex</span></div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;    std::size_t ipt = 0;</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    <span class="keywordflow">for</span> (ipt = 0; ipt &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size(); ++ipt)</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;      <span class="keywordflow">if</span> (tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a9ec485b3235b668007802b7b717b3e40">SFIndex</a> == pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[ipt].SFIndex) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    <span class="keywordflow">if</span> (ipt == pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size()) <span class="keywordflow">return</span> USHRT_MAX;</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;    <span class="comment">// next see if we can insert it so that re-sorting of this section isn&#39;t required</span></div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;    <span class="keyword">auto</span> lastTP3D = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.back();</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;    <span class="keywordflow">if</span> (ipt == 0 &amp;&amp; tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a15f15433176335aab1f8ea3c36485119">along</a> &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[0].along) {</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;      <span class="comment">// insert at the beginning. No search needs to be done</span></div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;    }</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a9ec485b3235b668007802b7b717b3e40">SFIndex</a> == lastTP3D.SFIndex &amp;&amp; tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a15f15433176335aab1f8ea3c36485119">along</a> &gt; lastTP3D.along) {</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;      <span class="comment">// insert at the end. Use push_back and return</span></div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;      pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.push_back(tp3d);</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;      pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>[tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a9ec485b3235b668007802b7b717b3e40">SFIndex</a>].NeedsUpdate = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;      pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1a16c8b0d8524fc0914afc3dab9bf89950">kNeedsUpdate</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;      <span class="keywordflow">return</span> pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() - 1;</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;    }</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;      <span class="keywordflow">for</span> (std::size_t iipt = ipt; iipt &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() - 1; ++iipt) {</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;        <span class="comment">// break out if the next point is in a different section</span></div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;        <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[iipt + 1].SFIndex != tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a9ec485b3235b668007802b7b717b3e40">SFIndex</a>) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;        <span class="keywordflow">if</span> (tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a15f15433176335aab1f8ea3c36485119">along</a> &gt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[iipt].along &amp;&amp; tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a15f15433176335aab1f8ea3c36485119">along</a> &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[iipt + 1].along) {</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;          ipt = iipt + 1;</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;        }</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;      } <span class="comment">// iipt</span></div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;    }   <span class="comment">// insert in the middle</span></div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;    pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.insert(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.begin() + ipt, tp3d);</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;    pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>[tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a9ec485b3235b668007802b7b717b3e40">SFIndex</a>].NeedsUpdate = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;    pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1a16c8b0d8524fc0914afc3dab9bf89950">kNeedsUpdate</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;    <span class="keywordflow">return</span> ipt;</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;  } <span class="comment">// InsertTP3D</span></div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span></div>
<div class="line"><a name="l02027"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a881a9f856411db2bb90b1964068712f5"> 2027</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a881a9f856411db2bb90b1964068712f5">SortSection</a>(<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sfIndex)</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;  {</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;    <span class="comment">// sorts the TP3Ds by the distance from the start of a fit section</span></div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;    <span class="keywordflow">if</span> (sfIndex &gt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size() - 1) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;    <span class="keyword">auto</span>&amp; sf = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>[sfIndex];</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;    <span class="keywordflow">if</span> (sf.Pos[0] == 0.0 &amp;&amp; sf.Pos[1] == 0.0 &amp;&amp; sf.Pos[2] == 0.0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;    <span class="comment">// a temp vector of points in this section</span></div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;    std::vector&lt;TP3D&gt; temp;</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;    <span class="comment">// and the index into TP3Ds</span></div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;    std::vector&lt;unsigned short&gt; indx;</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;    <span class="comment">// See if the along variable is monotonically increasing</span></div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    <span class="keywordtype">float</span> prevAlong = 0;</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#af481fa22253619167bce75a37e10ec34">first</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;    <span class="keywordtype">bool</span> needsSort = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;    <span class="keywordflow">for</span> (std::size_t ii = 0; ii &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size(); ++ii) {</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;      <span class="keyword">auto</span>&amp; tp3d = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[ii];</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;      <span class="keywordflow">if</span> (tp3d.SFIndex != sfIndex) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;      <span class="keywordflow">if</span> (first) {</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;        first = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;        prevAlong = tp3d.along;</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;      }</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;        <span class="keywordflow">if</span> (tp3d.along &lt; prevAlong) needsSort = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;        prevAlong = tp3d.along;</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;      }</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;      temp.push_back(tp3d);</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;      indx.push_back(ii);</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;    } <span class="comment">// tp3d</span></div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;    <span class="keywordflow">if</span> (temp.empty()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;    <span class="comment">// no sort needed?</span></div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;    <span class="keywordflow">if</span> (temp.size() == 1) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;    <span class="keywordflow">if</span> (!needsSort) {</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;      sf.NeedsUpdate = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;    }</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;    <span class="comment">// see if the points are not-contiguous</span></div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;    <span class="keywordtype">bool</span> contiguous = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;    <span class="keywordflow">for</span> (std::size_t ipt = 1; ipt &lt; indx.size(); ++ipt) {</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;      <span class="keywordflow">if</span> (indx[ipt] != indx[ipt - 1] + 1) contiguous = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;    <span class="keywordflow">if</span> (!contiguous) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;    std::vector&lt;SortEntry&gt; sortVec(temp.size());</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;    <span class="keywordflow">for</span> (std::size_t ii = 0; ii &lt; temp.size(); ++ii) {</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;      sortVec[ii].index = ii;</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;      sortVec[ii].val = temp[ii].along;</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;    std::sort(sortVec.begin(), sortVec.end(), <a class="code" href="../../de/d78/Utils_8cxx.html#afccaa2d84568990e3eee99667f6896f4">valsIncreasing</a>);</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;    <span class="keywordflow">for</span> (std::size_t ii = 0; ii &lt; temp.size(); ++ii) {</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;      <span class="comment">// overwrite the tp3d</span></div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;      <span class="keyword">auto</span>&amp; tp3d = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[indx[ii]];</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;      tp3d = temp[sortVec[ii].index];</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;    } <span class="comment">// ii</span></div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;    sf.NeedsUpdate = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;  } <span class="comment">// SortSection</span></div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l02088"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#ae5fbafb8d23680635343a083b8fd7b11"> 2088</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#ae5fbafb8d23680635343a083b8fd7b11">Recover</a>(<a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html">detinfo::DetectorClocksData</a> <span class="keyword">const</span>&amp; clockData,</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;          <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;          <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp, <span class="keywordtype">bool</span> prt)</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;  {</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;    <span class="comment">// try to recover from a poor initial fit</span></div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;    <span class="keywordflow">if</span>(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a1c332ab959b350e9ca7b37f321fd0849">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1ae3c02e1143205b4d7a8e93437965aa47">kSmallAngle</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;    <span class="keywordflow">if</span>(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size() != 1) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;    <span class="keywordflow">if</span>(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() &lt; 20) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a2132931ff530dd0e4eccfbe863c2f764">CanSection</a>(slc, pfp)) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;    <span class="comment">// make a copy</span></div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;    <span class="keyword">auto</span> p2 = pfp;</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;    <span class="comment">// try two sections</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;    p2.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.resize(2);</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> halfPt = p2.TP3Ds.size() / 2;</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = halfPt; ipt &lt; p2.TP3Ds.size(); ++ipt) p2.TP3Ds[ipt].SFIndex = 1;</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;    <span class="comment">// Confirm that both sections can be reconstructed</span></div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> toPt = <a class="code" href="../../de/d0f/namespacetca.html#a4cef0a0d26986f9f4e9b724f7b9c1d38">Find3DRecoRange</a>(slc, p2, 0, 3, 1);</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;    <span class="keywordflow">if</span>(toPt &gt; p2.TP3Ds.size()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;    toPt = <a class="code" href="../../de/d0f/namespacetca.html#a4cef0a0d26986f9f4e9b724f7b9c1d38">Find3DRecoRange</a>(slc, p2, halfPt, 3, 1);</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;    <span class="keywordflow">if</span>(toPt &gt; p2.TP3Ds.size()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a7045ad35dda0875138741a27c2fa6885">FitSection</a>(clockData, detProp, slc, p2, 0) || !<a class="code" href="../../de/d0f/namespacetca.html#a7045ad35dda0875138741a27c2fa6885">FitSection</a>(clockData, detProp, slc, p2, 1)) {</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;      <span class="keywordflow">if</span>(prt) {</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;        mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;        myprt &lt;&lt; <span class="stringliteral">&quot;Recover failed MVI &quot;</span> &lt;&lt; p2.MVI &lt;&lt; <span class="stringliteral">&quot; in TPC &quot;</span> &lt;&lt; p2.TPCID.TPC;</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;        <span class="keywordflow">for</span>(<span class="keyword">auto</span> tid : p2.TjIDs) myprt &lt;&lt; <span class="stringliteral">&quot; T&quot;</span> &lt;&lt; tid; </div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;      } <span class="comment">// prt</span></div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;    }</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;    <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;Recover: P&quot;</span> &lt;&lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a51b8e48c9df5507929ae0b6429cc7494">ID</a> &lt;&lt; <span class="stringliteral">&quot; success&quot;</span>;</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;    pfp = p2;</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;  } <span class="comment">// Recover</span></div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span></div>
<div class="line"><a name="l02124"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a41103f649664649d1a1287437f361bf3"> 2124</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a41103f649664649d1a1287437f361bf3">MakeTP3Ds</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>, <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp, <span class="keywordtype">bool</span> prt)</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;  {</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;    <span class="comment">// Create and populate the TP3Ds vector. This function is called before the first</span></div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;    <span class="comment">// fit is done so the TP3D along variable can&#39;t be determined. It returns false</span></div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;    <span class="comment">// if a majority of the tj points in TjIDs are already assigned to a different pfp</span></div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;    pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.clear();</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;    <span class="keywordflow">if</span> (!pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.empty() || pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size() != 1) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;    <span class="comment">// Look for TPs that are ~parallel to the wire plane and trajectory points</span></div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;    <span class="comment">// where the min/max Pos[1] value is not near an end.</span></div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;    <span class="comment">// number of Small Angle Tjs</span></div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;    <span class="comment">// stash the inflection point index in the TjUIDs vector</span></div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;    pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#acba092765aa9a24b59ca5d4c66bed832">TjUIDs</a>.resize(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">TjIDs</a>.size(), -1);</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;    <span class="comment">// count TPs with charge in all of the Tjs</span></div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;    <span class="keywordtype">float</span> cnt = 0;</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;    <span class="comment">// and the number of TPs available for use</span></div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    <span class="keywordtype">float</span> avail = 0;</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;    <span class="comment">// and the number of junk Tjs</span></div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nJunk = 0;</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nSA = 0;</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> itj = 0; itj &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">TjIDs</a>.size(); ++itj) {</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;      <span class="keyword">auto</span>&amp; tj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">TjIDs</a>[itj] - 1];</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;      <span class="keywordflow">if</span>(tj.AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da9b5200eaaed0e097cac019d6643e537e">kJunkTj</a>]) ++nJunk;</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;      <span class="keywordtype">float</span> posMin = 1E6;</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> iptMin = USHRT_MAX;</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;      <span class="keywordtype">float</span> posMax = -1E6;</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> iptMax = USHRT_MAX;</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;      <span class="keywordtype">float</span> aveAng = 0;</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;      <span class="keywordtype">float</span> npwc = 0;</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = tj.EndPt[0]; ipt &lt; tj.EndPt[1]; ++ipt) {</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;        <span class="keyword">auto</span>&amp; tp = tj.Pts[ipt];</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;        <span class="keywordflow">if</span>(tp.Chg &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;        ++cnt;</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;        <span class="keywordflow">if</span> (tp.InPFP &gt; 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;        ++avail;</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;        <span class="keywordflow">if</span>(tp.Pos[1] &gt; posMax) { posMax = tp.Pos[1]; iptMax = ipt; }</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;        <span class="keywordflow">if</span>(tp.Pos[1] &lt; posMin) { posMin = tp.Pos[1]; iptMin = ipt; }</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;        aveAng += tp.Ang;</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;        ++npwc;</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;      } <span class="comment">// ipt</span></div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;      <span class="keywordflow">if</span>(npwc == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;      aveAng /= npwc;</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(aveAng) &lt; 0.05) ++nSA;</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;      <span class="comment">// No problem if the min/max points are near the ends</span></div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;      <span class="keywordflow">if</span>(iptMin &gt; tj.EndPt[0] + 4 &amp;&amp; iptMin &lt; tj.EndPt[1] - 4) pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#acba092765aa9a24b59ca5d4c66bed832">TjUIDs</a>[itj] = iptMin;</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;      <span class="keywordflow">if</span>(iptMax &gt; tj.EndPt[0] + 4 &amp;&amp; iptMax &lt; tj.EndPt[1] - 4) pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#acba092765aa9a24b59ca5d4c66bed832">TjUIDs</a>[itj] = iptMax;</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;    } <span class="comment">// tid</span></div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;    <span class="keywordflow">if</span>(avail &lt; 0.8 * cnt) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;    <span class="comment">// small angle trajectory?</span></div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;    <span class="keywordflow">if</span>(nSA &gt; 1) pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a1c332ab959b350e9ca7b37f321fd0849">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1ae3c02e1143205b4d7a8e93437965aa47">kSmallAngle</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;    <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; P&quot;</span>&lt;&lt;pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a51b8e48c9df5507929ae0b6429cc7494">ID</a>&lt;&lt;<span class="stringliteral">&quot; MVI &quot;</span>&lt;&lt;pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a24c761b3091ff8a756eb3069232466f8">MVI</a>&lt;&lt;<span class="stringliteral">&quot; nJunkTj &quot;</span>&lt;&lt;nJunk&lt;&lt;<span class="stringliteral">&quot; SmallAngle? &quot;</span>&lt;&lt;pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a1c332ab959b350e9ca7b37f321fd0849">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1ae3c02e1143205b4d7a8e93437965aa47">kSmallAngle</a>];</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;    <span class="keywordflow">if</span>(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a1c332ab959b350e9ca7b37f321fd0849">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1ae3c02e1143205b4d7a8e93437965aa47">kSmallAngle</a>]) <span class="keywordflow">return</span> <a class="code" href="../../de/d0f/namespacetca.html#aa2db05fe1cf9e199e7d150b1aea47bd0">MakeSmallAnglePFP</a>(detProp, slc, pfp, prt);</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;    <span class="comment">// Add the points associated with the Tjs that were used to create the PFP</span></div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> tid : pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">TjIDs</a>) {</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;      <span class="keyword">auto</span>&amp; tj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tid - 1];</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;      <span class="comment">// There is one TP for every hit in a junk Tj so we can skip one, if there is only one</span></div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;      <span class="keywordflow">if</span>(nJunk == 1 &amp;&amp; tj.AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da9b5200eaaed0e097cac019d6643e537e">kJunkTj</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;      <span class="comment">// All of the Tj&#39;s may be junk, especially for those at very high angle, so the</span></div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;      <span class="comment">// X position of the TP&#39;s isn&#39;t high quality. Inflate the errors below.</span></div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;      <span class="keywordtype">bool</span> isJunk = tj.AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da9b5200eaaed0e097cac019d6643e537e">kJunkTj</a>];</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = tj.EndPt[0]; ipt &lt;= tj.EndPt[1]; ++ipt) {</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;        <span class="keyword">auto</span>&amp; tp = tj.Pts[ipt];</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;        <span class="keywordflow">if</span> (tp.Chg &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;        <span class="keywordflow">if</span> (tp.InPFP &gt; 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;        ++avail;</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;        <span class="keyword">auto</span> tp3d = <a class="code" href="../../de/d0f/namespacetca.html#a1f3a9c0638f68964f62d19cbb80731da">CreateTP3D</a>(detProp, slc, tid, ipt);</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;        <span class="keywordflow">if</span>(tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a088d286995bc5cfcaa1f8f26a78f0a67">kTP3DBad</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;        tp3d.SFIndex = 0;</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;        <span class="keywordflow">if</span>(isJunk) tp3d.TPXErr2 *= 4;</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;        <span class="comment">// We need to assume that all points are good or the first fit will fail</span></div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;        tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;        pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.push_back(tp3d);</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;      } <span class="comment">// ipt</span></div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;    } <span class="comment">// tid</span></div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;    <span class="keywordflow">if</span>(prt) mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; has &quot;</span>&lt;&lt;pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size()&lt;&lt;<span class="stringliteral">&quot; TP3Ds&quot;</span>;</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;  } <span class="comment">// MakeTP3Ds</span></div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l02205"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#aa2db05fe1cf9e199e7d150b1aea47bd0"> 2205</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="../../de/d0f/namespacetca.html#aa2db05fe1cf9e199e7d150b1aea47bd0">MakeSmallAnglePFP</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;                         <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp,</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;                         <span class="keywordtype">bool</span> prt)</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;  {</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;    <span class="comment">// Create and populate the TP3Ds vector for a small-angle track. The standard track fit</span></div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;    <span class="comment">// will fail for these tracks. The kSmallAngle AlgMod bit</span></div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;    <span class="comment">// is set true. Assume that the calling function, MakeTP3Ds, has decided that this is a</span></div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;    <span class="comment">// small-angle track. </span></div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">useAlg</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1ae3c02e1143205b4d7a8e93437965aa47">kSmallAngle</a>]) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;    <span class="keywordflow">if</span>(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">TjIDs</a>.size() &lt; 2) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;    std::vector&lt;SortEntry&gt; sortVec(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">TjIDs</a>.size());</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sbCnt = 0;</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> itj = 0; itj &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">TjIDs</a>.size(); ++itj) {</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;      sortVec[itj].index = itj;</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;      <span class="keyword">auto</span>&amp; tj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">TjIDs</a>[itj] - 1];</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;      sortVec[itj].val = <a class="code" href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">NumPtsWithCharge</a>(slc, tj, <span class="keyword">false</span>);</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;      <span class="keywordflow">if</span>(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#acba092765aa9a24b59ca5d4c66bed832">TjUIDs</a>[itj] &gt; 0) ++sbCnt;</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;    std::sort(sortVec.begin(), sortVec.end(), <a class="code" href="../../de/d78/Utils_8cxx.html#a5d68a4eb0beaca553c63e29989a63464">valsDecreasing</a>);</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;    <span class="comment">// Decide whether to use the inflection points to add another section. Inflection</span></div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;    <span class="comment">// points must exist in the two longest Tjs</span></div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> tlIndex = sortVec[0].index;</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nlIndex = sortVec[1].index;</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;    <span class="keyword">auto</span>&amp; tlong = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">TjIDs</a>[tlIndex] - 1];</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;    <span class="keyword">auto</span>&amp; nlong = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">TjIDs</a>[nlIndex] - 1];</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;    <span class="keywordtype">bool</span> twoSections = (sbCnt &gt; 1 &amp;&amp; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#acba092765aa9a24b59ca5d4c66bed832">TjUIDs</a>[tlIndex] &gt; 0 &amp;&amp; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#acba092765aa9a24b59ca5d4c66bed832">TjUIDs</a>[nlIndex] &gt; 0);</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> tStartPt = tlong.EndPt[0];</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> tEndPt = tlong.EndPt[1];</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nStartPt = nlong.EndPt[0];</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nEndPt = nlong.EndPt[1];</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;    <span class="keywordflow">if</span>(twoSections) {</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;      pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.resize(2);</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;      tEndPt = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#acba092765aa9a24b59ca5d4c66bed832">TjUIDs</a>[tlIndex];</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;      nEndPt = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#acba092765aa9a24b59ca5d4c66bed832">TjUIDs</a>[nlIndex];</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;      <span class="keywordflow">if</span>(prt) {</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;        mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;        myprt&lt;&lt;<span class="stringliteral">&quot;MakeSmallAnglePFP: creating two sections using points&quot;</span>;</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;        myprt&lt;&lt;<span class="stringliteral">&quot; T&quot;</span>&lt;&lt;tlong.ID&lt;&lt;<span class="stringliteral">&quot;_&quot;</span>&lt;&lt;tEndPt;</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;        myprt&lt;&lt;<span class="stringliteral">&quot; T&quot;</span>&lt;&lt;nlong.ID&lt;&lt;<span class="stringliteral">&quot;_&quot;</span>&lt;&lt;nEndPt;</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;      } <span class="comment">// prt</span></div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;    } <span class="comment">// two Sections</span></div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;    std::vector&lt;Point3_t&gt; sfEndPos;</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> isf = 0; isf &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size(); ++isf) {</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;      <span class="comment">// get the start and end TPs in this section</span></div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;      <span class="keyword">auto</span>&amp; ltp0 = tlong.Pts[tStartPt];</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;      <span class="keyword">auto</span>&amp; ltp1 = tlong.Pts[tEndPt];</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;      <span class="keyword">auto</span>&amp; ntp0 = nlong.Pts[nStartPt];</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;      <span class="keyword">auto</span>&amp; ntp1 = nlong.Pts[nEndPt];</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;      <span class="comment">// Get the 3D end points</span></div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;      <span class="keyword">auto</span> start = <a class="code" href="../../de/d0f/namespacetca.html#a948420c5e901739e6c8b846dd53faf67">MakeTP3D</a>(detProp, slc, ltp0, ntp0);</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;      <span class="keyword">auto</span> <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> = <a class="code" href="../../de/d0f/namespacetca.html#a948420c5e901739e6c8b846dd53faf67">MakeTP3D</a>(detProp, slc, ltp1, ntp1);</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;      <span class="keywordflow">if</span>(!start.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>] || !<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>]) {</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a>&lt;&lt;<span class="stringliteral">&quot; Start/end fail in section &quot;</span>&lt;&lt;isf&lt;&lt;<span class="stringliteral">&quot;. Add recovery code\n&quot;</span>;</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;      } <span class="comment">// failure</span></div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a7f663b1f0cd693167cdf6aa76532b4d3">InsideTPC</a>(start.Pos, pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a2aeca07e5620225d35f27cdff6cc9048">TPCID</a>)) {</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;        mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; Start is outside the TPC &quot;</span>&lt;&lt;start.Pos[0]&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;start.Pos[1]&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;start.Pos[2];</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;      }</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a7f663b1f0cd693167cdf6aa76532b4d3">InsideTPC</a>(<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>.Pos, pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a2aeca07e5620225d35f27cdff6cc9048">TPCID</a>)) {</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;        mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; End is outside the TPC &quot;</span>&lt;&lt;<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>.Pos[0]&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>.Pos[1]&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>.Pos[2];</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;      }</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;      <span class="keywordflow">if</span>(isf == 0) sfEndPos.push_back(start.Pos);</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;      sfEndPos.push_back(<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>.Pos);</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;      <span class="keyword">auto</span>&amp; sf = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>[isf];</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;      <span class="comment">// Find the start and end positions</span></div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> xyz = 0; xyz &lt; 3; ++xyz) {</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;        sf.Dir[xyz] = <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>.Pos[xyz] - start.Pos[xyz];</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;        sf.Pos[xyz] = (<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>.Pos[xyz] + start.Pos[xyz]) / 2.;</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;      }</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a28c1a6c238b36f5b2ccef44d9d02d120">SetMag</a>(sf.Dir, 1.);</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;      sf.ChiDOF = 0.;</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;      sf.NPts = 0;</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;      <span class="comment">// move the start/end point indices</span></div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;      tStartPt = tEndPt + 1; tEndPt = tlong.EndPt[1];</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;      nStartPt = nEndPt + 1; nEndPt = nlong.EndPt[1];</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;    } <span class="comment">// isf</span></div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;    <span class="comment">// Create TP3Ds</span></div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;    <span class="comment">// a temporary vector to hold TP3Ds for the second SectionFit</span></div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;    std::vector&lt;TP3D&gt; sf2pts;</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> itj = 0; itj &lt; sortVec.size(); ++itj) {</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;      <span class="keywordtype">int</span> tid = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">TjIDs</a>[sortVec[itj].index];</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;      <span class="comment">// don&#39;t add points for the Tj that doesn&#39;t have an inflection point. It is</span></div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;      <span class="comment">// probably broken and would probably be put in the wrong section</span></div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;      <span class="keywordflow">if</span>(twoSections &amp;&amp; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#acba092765aa9a24b59ca5d4c66bed832">TjUIDs</a>[sortVec[itj].index] &lt; 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;      <span class="keyword">auto</span>&amp; tj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tid - 1];</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sb = tj.EndPt[1];</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;      <span class="keywordflow">if</span>(twoSections &amp;&amp; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#acba092765aa9a24b59ca5d4c66bed832">TjUIDs</a>[sortVec[itj].index] &gt; 0) sb = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#acba092765aa9a24b59ca5d4c66bed832">TjUIDs</a>[sortVec[itj].index];</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;      <span class="comment">// count the number of good TPs in each section</span></div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;      std::vector&lt;double&gt; npwc(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size(), 0);</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = tj.EndPt[0]; ipt &lt;= tj.EndPt[1]; ++ipt) {</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;        <span class="keyword">auto</span>&amp; tp = tj.Pts[ipt];</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;        <span class="keywordflow">if</span>(tp.Chg &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;        <span class="keywordflow">if</span>(ipt &gt; sb) { ++npwc[1]; } <span class="keywordflow">else</span> { ++npwc[0]; }</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;      } <span class="comment">// ipt</span></div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;      <span class="keywordtype">double</span> length = <a class="code" href="../../de/d0f/namespacetca.html#a2a4c4a32e939554d609ba778be021c6d">PosSep</a>(sfEndPos[0], sfEndPos[1]);</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;      <span class="keywordtype">double</span> step = length / npwc[0];</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;      <span class="keywordtype">double</span> along = -length / 2;</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sfi = 0;</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = tj.EndPt[0]; ipt &lt;= tj.EndPt[1]; ++ipt) {</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;        <span class="keyword">auto</span>&amp; tp = tj.Pts[ipt];</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;        <span class="keywordflow">if</span>(tp.Chg &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;        <span class="keyword">auto</span> tp3d = <a class="code" href="../../de/d0f/namespacetca.html#a1f3a9c0638f68964f62d19cbb80731da">CreateTP3D</a>(detProp, slc, tid, ipt);</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;        <span class="keywordflow">if</span>(tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a088d286995bc5cfcaa1f8f26a78f0a67">kTP3DBad</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;        <span class="keywordflow">if</span>(ipt == sb + 1) {</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;          sfi = 1;</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;          length = <a class="code" href="../../de/d0f/namespacetca.html#a2a4c4a32e939554d609ba778be021c6d">PosSep</a>(sfEndPos[1], sfEndPos[2]);</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;          step = length / npwc[1];</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;          along = -length / 2;</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;        }</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;        tp3d.SFIndex = sfi;</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;        <span class="keyword">auto</span>&amp; sf = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>[sfi];</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;        ++sf.NPts;</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;        tp3d.along = along;</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> xyz = 0; xyz &lt; 3; ++xyz) tp3d.Pos[xyz] = sf.Pos[xyz] + along * sf.Dir[xyz];</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;        tp3d.Dir = sf.Dir;</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;        along += step;</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;        <span class="keywordtype">double</span> delta = tp3d.Pos[0] - tp3d.TPX;</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;        sf.ChiDOF += delta * delta / tp3d.TPXErr2;</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;        <span class="comment">// Assume that all points are good</span></div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;        tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;        <span class="keywordflow">if</span>(sfi == 0) {</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;          pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.push_back(tp3d);</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;          sf2pts.push_back(tp3d);</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;        }</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;      } <span class="comment">// ipt</span></div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;    } <span class="comment">// tid</span></div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;    <span class="keywordflow">if</span>(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() &lt; 4) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; sf : pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>) {</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;      <span class="keywordflow">if</span>(sf.NPts &lt; 5) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;      sf.ChiDOF /= (float)(sf.NPts - 4);</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;    } <span class="comment">// sf</span></div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a881a9f856411db2bb90b1964068712f5">SortSection</a>(pfp, 0)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;    <span class="keywordflow">if</span>(!sf2pts.empty()) {</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;      <span class="comment">// append the points and sort</span></div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;      pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.insert(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.end(), sf2pts.begin(), sf2pts.end());</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="../../de/d0f/namespacetca.html#a881a9f856411db2bb90b1964068712f5">SortSection</a>(pfp, 1)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;    } <span class="comment">// two sections</span></div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;    pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1a10329bf0d918d9281fd2740f70db322b">kCanSection</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;    pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a1c332ab959b350e9ca7b37f321fd0849">AlgMod</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1ae3c02e1143205b4d7a8e93437965aa47">kSmallAngle</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;    <span class="keywordflow">if</span>(prt) {</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;      mf::LogVerbatim(<span class="stringliteral">&quot;TC&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;Created SmallAngle P&quot;</span>&lt;&lt;pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a51b8e48c9df5507929ae0b6429cc7494">ID</a></div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;          &lt;&lt;<span class="stringliteral">&quot; with &quot;</span>&lt;&lt;pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size()</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;          &lt;&lt;<span class="stringliteral">&quot; points in &quot;</span>&lt;&lt;pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size()&lt;&lt;<span class="stringliteral">&quot; sections\n&quot;</span>;</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;    }</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;  } <span class="comment">// MakeSmallAnglePFP</span></div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l02359"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#ac9a7192422bb8f4f56944923ff22b9f0"> 2359</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#ac9a7192422bb8f4f56944923ff22b9f0">Reverse</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp)</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;  {</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;    <span class="comment">// reverse the PFParticle</span></div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;    std::reverse(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.begin(), pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.end());</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;    std::reverse(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.begin(), pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.end());</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;    <span class="keywordflow">for</span> (std::size_t sfi = 0; sfi &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size(); ++sfi) {</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;      <span class="keyword">auto</span>&amp; sf = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>[sfi];</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;      <span class="comment">// flip the direction vector</span></div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> xyz = 0; xyz &lt; 3; ++xyz)</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;        sf.Dir[xyz] *= -1;</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;    } <span class="comment">// sf</span></div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;    <span class="comment">// correct the along variable</span></div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; tp3d : pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>)</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;      tp3d.along *= -1;</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;    std::swap(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a4e8cbcf84cf897b360ab2c68009c8418">dEdx</a>[0], pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a4e8cbcf84cf897b360ab2c68009c8418">dEdx</a>[1]);</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;    std::swap(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a8a39d1be09f8e3dd6f5b7a2cd8c933be">dEdxErr</a>[0], pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a8a39d1be09f8e3dd6f5b7a2cd8c933be">dEdxErr</a>[1]);</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;    std::swap(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aabf1e43ae7c3343a2b49d36bd2fe63ba">Vx3ID</a>[0], pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aabf1e43ae7c3343a2b49d36bd2fe63ba">Vx3ID</a>[1]);</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;    std::swap(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa381ee94d1b9593dd5886b3dbce68e52">EndFlag</a>[0], pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa381ee94d1b9593dd5886b3dbce68e52">EndFlag</a>[1]);</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;  } <span class="comment">// Reverse</span></div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l02381"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a7636b0975b99bd967cb1cf31cec2609d"> 2381</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a7636b0975b99bd967cb1cf31cec2609d">FillmAllTraj</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>, <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc)</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;  {</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;    <span class="comment">// Fills the mallTraj vector with trajectory points in the tpc and sorts</span></div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;    <span class="comment">// them by increasing X</span></div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;    <span class="keywordtype">int</span> cstat = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>;</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;    <span class="keywordtype">int</span> tpc = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>;</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;    <span class="comment">// define mallTraj</span></div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;    slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>.clear();</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;    <a class="code" href="../../dc/d80/structtca_1_1Tj2Pt.html">Tj2Pt</a> tj2pt;</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> cnt = 0;</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;    <span class="comment">// try to reduce CPU time by not attempting to match tjs that are near muons</span></div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;    <span class="keywordtype">bool</span> muFuzzCut = (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>.size() &gt; 6 &amp;&amp; <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[6] &gt; 0);</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;    <span class="keywordtype">float</span> rms = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">match3DCuts</a>[0];</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; tj : slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>) {</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;      <span class="keywordflow">if</span> (tj.AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da28fa0bb663ed246b2fcf12591258c5ac">kKilled</a>] || tj.AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da1e4c8050e6f935aba51dcbe709012358">kHaloTj</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;      <span class="comment">// ignore already matched</span></div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;      <span class="keywordflow">if</span> (tj.AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da6ffcff8d6a31c1e1662e99d73d544e86">kMat3D</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;      <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> planeID = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(tj.CTP);</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;      <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)planeID.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a> != cstat) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;      <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)planeID.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a> != tpc) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;      <span class="keywordtype">int</span> plane = planeID.<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>;</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;      <span class="keywordflow">if</span> (tj.ID &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> tjID = tj.ID;</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = tj.EndPt[0]; ipt &lt;= tj.EndPt[1]; ++ipt) {</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;        <span class="keyword">auto</span>&amp; tp = tj.Pts[ipt];</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;        <span class="keywordflow">if</span> (tp.Chg &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;        <span class="keywordflow">if</span> (tp.Pos[0] &lt; -0.4) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;        <span class="comment">// ignore already matched</span></div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;        <span class="keywordflow">if</span> (tp.InPFP &gt; 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;        <span class="keywordflow">if</span> (muFuzzCut &amp;&amp; tp.Environment[<a class="code" href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525abd1a7e54d914adb492248139662c2729">kEnvNearMuon</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;        tj2pt.<a class="code" href="../../dc/d80/structtca_1_1Tj2Pt.html#afad1878c095c08824c86673c5dba42cd">wire</a> = std::nearbyint(tp.Pos[0]);</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;        ++cnt;</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;        <span class="comment">// don&#39;t try matching if the wire doesn&#39;t exist</span></div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#a45df0d5e161fa45e89854381f55aceb0">HasWire</a>(<a class="code" href="../../de/db1/structgeo_1_1WireID.html">geo::WireID</a>(cstat, tpc, plane, tj2pt.<a class="code" href="../../dc/d80/structtca_1_1Tj2Pt.html#afad1878c095c08824c86673c5dba42cd">wire</a>))) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;        <span class="keywordtype">float</span> xpos = detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a8e4b4b8d755ffded5a9f956ae7c9c1ec">ConvertTicksToX</a>(tp.Pos[1] / <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a>, plane, tpc, cstat);</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;        tj2pt.<a class="code" href="../../dc/d80/structtca_1_1Tj2Pt.html#adeb985d7df975cd5543a25ec18740a80">xlo</a> = xpos - rms;</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;        tj2pt.<a class="code" href="../../dc/d80/structtca_1_1Tj2Pt.html#a6091b11301eec4f269f87588b82f5754">xhi</a> = xpos + rms;</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;        tj2pt.<a class="code" href="../../dc/d80/structtca_1_1Tj2Pt.html#ae7ad693e832772f8f64362fc6180eb1f">plane</a> = plane;</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;        tj2pt.<a class="code" href="../../dc/d80/structtca_1_1Tj2Pt.html#a76bc10ca4c618ded5195f4b2f5d118ce">id</a> = tjID;</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;        tj2pt.<a class="code" href="../../dc/d80/structtca_1_1Tj2Pt.html#af4753d4e6ae0a10cd051f08f0bf22250">ipt</a> = ipt;</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;        tj2pt.<a class="code" href="../../dc/d80/structtca_1_1Tj2Pt.html#a43cb371612e5844815bf0ebea5a4cd5b">npts</a> = tj.EndPt[1] - tj.EndPt[0] + 1;</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;        slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>.push_back(tj2pt);</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;      } <span class="comment">// tp</span></div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;    }   <span class="comment">// tj</span></div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;    <span class="comment">// sort by increasing x</span></div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;    std::vector&lt;SortEntry&gt; sortVec(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>.size());</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;    <span class="keywordflow">for</span> (std::size_t ipt = 0; ipt &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>.size(); ++ipt) {</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;      <span class="comment">// populate the sort vector</span></div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;      sortVec[ipt].index = ipt;</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;      sortVec[ipt].val = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>[ipt].xlo;</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;    <span class="comment">// sort by increasing xlo</span></div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;    std::sort(sortVec.begin(), sortVec.end(), <a class="code" href="../../de/d78/Utils_8cxx.html#afccaa2d84568990e3eee99667f6896f4">valsIncreasing</a>);</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;    <span class="comment">// put slc.mallTraj into sorted order</span></div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;    <span class="keyword">auto</span> tallTraj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>;</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;    <span class="keywordflow">for</span> (std::size_t ii = 0; ii &lt; sortVec.size(); ++ii)</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;      slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">mallTraj</a>[ii] = tallTraj[sortVec[ii].index];</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;  } <span class="comment">// FillmAllTraj</span></div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l02447"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a948420c5e901739e6c8b846dd53faf67"> 2447</a></span>&#160;<span class="comment"></span>  <a class="code" href="../../d5/db8/structtca_1_1TP3D.html">TP3D</a> <a class="code" href="../../de/d0f/namespacetca.html#a948420c5e901739e6c8b846dd53faf67">MakeTP3D</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>, </div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;                <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <span class="keyword">const</span> <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a>&amp; itp, <span class="keyword">const</span> <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a>&amp; jtp)</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;  {</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;    <span class="comment">// Make a 3D trajectory point using two 2D trajectory points. The TP3D Pos and Wire</span></div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;    <span class="comment">// variables are defined using itp. The SectionFit variables are un-defined</span></div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;    <a class="code" href="../../d5/db8/structtca_1_1TP3D.html">TP3D</a> tp3d;</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a0cf7385a035afbd0420ffde77a0f4e8b">TPIndex</a> = 0;</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#ab6cea7b9a15237b36cd057f43aab4d89">TjID</a> = 0;</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#ac9763a62e8a5a7def22b002b728bb09f">CTP</a> = itp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a00fdf2d73e4a03e5a7f32411e460ba2e">CTP</a>;</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;    <span class="comment">// assume failure</span></div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a6253f3df3ce18548226edb7ef959b411">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a9866502e46d57d11397eb8fee6485718">Dir</a> = {{0.0, 0.0, 1.0}};</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a937c64030bd53c835902da63475db5f5">Pos</a> = {{999.0, 999.0, 999.0}};</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;    <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> iPlnID = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(itp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a00fdf2d73e4a03e5a7f32411e460ba2e">CTP</a>);</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;    <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> jPlnID = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(jtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a00fdf2d73e4a03e5a7f32411e460ba2e">CTP</a>);</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;    <span class="keywordflow">if</span>(iPlnID == jPlnID) <span class="keywordflow">return</span> tp3d;</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;    <span class="keywordtype">double</span> upt = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a>;</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;    <span class="keywordtype">double</span> ix = detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a8e4b4b8d755ffded5a9f956ae7c9c1ec">ConvertTicksToX</a>(itp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1] / upt, iPlnID);</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;    <span class="keywordtype">double</span> jx = detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a8e4b4b8d755ffded5a9f956ae7c9c1ec">ConvertTicksToX</a>(jtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1] / upt, jPlnID);</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;    </div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;    <span class="comment">// don&#39;t continue if the points are wildly far apart in X</span></div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;    <span class="keywordtype">double</span> dx = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(ix - jx);</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;    <span class="keywordflow">if</span>(dx &gt; 20) <span class="keywordflow">return</span> tp3d;</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a937c64030bd53c835902da63475db5f5">Pos</a>[0] = (ix + jx) / 2;</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a36c98f652f537113040d880f5898afaa">TPX</a> = ix;</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;    <span class="comment">// Fake the error</span></div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a8ba13376fc25aa4e15d72ded58c512ea">TPXErr2</a> = dx;</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;    <span class="comment">// determine the wire orientation and offsets using WireCoordinate</span></div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;    <span class="comment">// wire = yp * OrthY + zp * OrthZ - Wire0 = cs * yp + sn * zp - wire0</span></div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;    <span class="comment">// wire offset</span></div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;    <span class="keywordtype">double</span> iw0 = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#ae81e63f01473939eb6bc9c2cb5455906">WireCoordinate</a>(0, 0, iPlnID);</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;    <span class="comment">// cosine-like component</span></div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;    <span class="keywordtype">double</span> ics = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#ae81e63f01473939eb6bc9c2cb5455906">WireCoordinate</a>(1, 0, iPlnID) - iw0;</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;    <span class="comment">// sine-like component</span></div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;    <span class="keywordtype">double</span> isn = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#ae81e63f01473939eb6bc9c2cb5455906">WireCoordinate</a>(0, 1, iPlnID) - iw0;</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;    <span class="keywordtype">double</span> jw0 = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#ae81e63f01473939eb6bc9c2cb5455906">WireCoordinate</a>(0, 0, jPlnID);</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;    <span class="keywordtype">double</span> jcs = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#ae81e63f01473939eb6bc9c2cb5455906">WireCoordinate</a>(1, 0, jPlnID) - jw0;</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;    <span class="keywordtype">double</span> jsn = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#ae81e63f01473939eb6bc9c2cb5455906">WireCoordinate</a>(0, 1, jPlnID) - jw0;</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;    <span class="keywordtype">double</span> den = isn * jcs - ics * jsn;</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;    <span class="keywordflow">if</span>(den == 0) <span class="keywordflow">return</span> tp3d;</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;    <span class="keywordtype">double</span> iPos0 = itp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0];</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;    <span class="keywordtype">double</span> jPos0 = jtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0];</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;    <span class="comment">// Find the Z position of the intersection</span></div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a937c64030bd53c835902da63475db5f5">Pos</a>[2] = (jcs * (iPos0 - iw0) - ics * (jPos0 - jw0)) / den;</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;    <span class="comment">// and the Y position</span></div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;    <span class="keywordtype">bool</span> useI = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(ics) &gt; <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(jcs);</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;    <span class="keywordflow">if</span>(useI) {</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;      tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a937c64030bd53c835902da63475db5f5">Pos</a>[1] = (iPos0 - iw0 - isn * tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a937c64030bd53c835902da63475db5f5">Pos</a>[2]) / ics;</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;      tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a937c64030bd53c835902da63475db5f5">Pos</a>[1] = (jPos0 - jw0 - jsn * tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a937c64030bd53c835902da63475db5f5">Pos</a>[2]) / jcs;</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;    }</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;    </div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;    <span class="comment">// Now find the direction. Protect against large angles first</span></div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;    <span class="keywordflow">if</span>(jtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[1] == 0) {</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;      <span class="comment">// Going either in the +X direction or -X direction</span></div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;      <span class="keywordflow">if</span>(jtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0] &gt; 0) { tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a9866502e46d57d11397eb8fee6485718">Dir</a>[0] = 1; } <span class="keywordflow">else</span> { tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a9866502e46d57d11397eb8fee6485718">Dir</a>[0] = -1; }</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;      tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a9866502e46d57d11397eb8fee6485718">Dir</a>[1] = 0;</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;      tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a9866502e46d57d11397eb8fee6485718">Dir</a>[2] = 0;</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;      <span class="keywordflow">return</span> tp3d;</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;    } <span class="comment">// jtp.Dir[1] == 0</span></div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;    </div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a0598b7e6a7bf0fbf9bbd2d7d2173dbfb">Wire</a> = iPos0;</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;    </div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;    <span class="comment">// make a copy of itp and shift it by many wires to avoid precision problems</span></div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;    <span class="keywordtype">double</span> itp2_0 = itp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] + 100;</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;    <span class="keywordtype">double</span> itp2_1 = itp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1];</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(itp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0]) &gt; 0.01) itp2_1 += 100 * itp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[1] / itp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0];</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;    <span class="comment">// Create a second Point3 for the shifted point</span></div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a> pos2;</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;    <span class="comment">// Find the X position corresponding to the shifted point </span></div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;    pos2[0] = detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a8e4b4b8d755ffded5a9f956ae7c9c1ec">ConvertTicksToX</a>(itp2_1 / upt, iPlnID);</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;    <span class="comment">// Convert X to Ticks in the j plane and then to WSE units</span></div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;    <span class="keywordtype">double</span> jtp2Pos1 = detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a359d6255bb14f321d76e6085204ea52a">ConvertXToTicks</a>(pos2[0], jPlnID) * upt;</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;    <span class="comment">// Find the wire position (Pos0) in the j plane that this corresponds to</span></div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;    <span class="keywordtype">double</span> jtp2Pos0 = (jtp2Pos1 - jtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1]) * (jtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[0] / jtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">Dir</a>[1]) + jtp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0];</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;    <span class="comment">// Find the Y,Z position using itp2 and jtp2Pos0</span></div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;    pos2[2] = (jcs * (itp2_0 - iw0) - ics * (jtp2Pos0 - jw0)) / den;</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;    <span class="keywordflow">if</span>(useI) {</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;      pos2[1] = (itp2_0 - iw0 - isn * pos2[2]) / ics;</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;      pos2[1] = (jtp2Pos0 - jw0 - jsn * pos2[2]) / jcs;</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;    }</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;    <span class="keywordtype">double</span> sep = <a class="code" href="../../de/d0f/namespacetca.html#a2a4c4a32e939554d609ba778be021c6d">PosSep</a>(tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a937c64030bd53c835902da63475db5f5">Pos</a>, pos2);</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;    <span class="keywordflow">if</span>(sep == 0) <span class="keywordflow">return</span> tp3d;</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ixyz = 0; ixyz &lt; 3; ++ixyz) tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a9866502e46d57d11397eb8fee6485718">Dir</a>[ixyz] = (pos2[ixyz] - tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a937c64030bd53c835902da63475db5f5">Pos</a>[ixyz]) /sep;</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a6253f3df3ce18548226edb7ef959b411">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;    <span class="keywordflow">return</span> tp3d;</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;    </div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;  } <span class="comment">// MakeTP3D</span></div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;<span class="comment"></span>  <span class="keywordtype">double</span></div>
<div class="line"><a name="l02539"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a3817156934849ad2042f29fcd347c466"> 2539</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a3817156934849ad2042f29fcd347c466">DeltaAngle</a>(<span class="keyword">const</span> <a class="code" href="../../de/d0f/namespacetca.html#a72c1c3d7710660bf62af0539e345c329">Vector3_t</a> v1, <span class="keyword">const</span> <a class="code" href="../../de/d0f/namespacetca.html#a72c1c3d7710660bf62af0539e345c329">Vector3_t</a> v2)</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;  {</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;    <span class="keywordflow">if</span> (v1[0] == v2[0] &amp;&amp; v1[1] == v2[1] &amp;&amp; v1[2] == v2[2]) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;    <span class="keywordflow">return</span> acos(<a class="code" href="../../de/d0f/namespacetca.html#ac7453ffded371a6c148f116b8c0042c9">DotProd</a>(v1, v2));</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;  }</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;<span class="comment"></span>  <a class="code" href="../../de/d0f/namespacetca.html#a72c1c3d7710660bf62af0539e345c329">Vector3_t</a></div>
<div class="line"><a name="l02547"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a6200f7dc3ac9831695e882e7ca391cdc"> 2547</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a6200f7dc3ac9831695e882e7ca391cdc">PointDirection</a>(<span class="keyword">const</span> <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a> <a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a>, <span class="keyword">const</span> <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a> p2)</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;  {</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;    <span class="comment">// Finds the direction vector between the two points from p1 to p2</span></div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a72c1c3d7710660bf62af0539e345c329">Vector3_t</a> <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>;</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> xyz = 0; xyz &lt; 3; ++xyz)</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;      dir[xyz] = p2[xyz] - p1[xyz];</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;    <span class="keywordflow">if</span> (dir[0] == 0 &amp;&amp; dir[1] == 0 &amp;&amp; dir[2] == 0) <span class="keywordflow">return</span> <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>;</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a28c1a6c238b36f5b2ccef44d9d02d120">SetMag</a>(dir, 1)) {</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;      dir[0] = 0;</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;      dir[1] = 0;</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;      dir[3] = 0;</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;    }</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>;</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;  } <span class="comment">// PointDirection</span></div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;<span class="comment">  //////////////////////////////////////////</span></div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;<span class="comment"></span>  <span class="keywordtype">double</span></div>
<div class="line"><a name="l02564"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a2a4c4a32e939554d609ba778be021c6d"> 2564</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a2a4c4a32e939554d609ba778be021c6d">PosSep</a>(<span class="keyword">const</span> <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a>&amp; pos1, <span class="keyword">const</span> <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a>&amp; pos2)</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;  {</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;    <span class="keywordflow">return</span> sqrt(<a class="code" href="../../de/d0f/namespacetca.html#a1c2bea68a634d09340f7921072d5acda">PosSep2</a>(pos1, pos2));</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;  } <span class="comment">// PosSep</span></div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;<span class="comment">  //////////////////////////////////////////</span></div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;<span class="comment"></span>  <span class="keywordtype">double</span></div>
<div class="line"><a name="l02571"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a1c2bea68a634d09340f7921072d5acda"> 2571</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a1c2bea68a634d09340f7921072d5acda">PosSep2</a>(<span class="keyword">const</span> <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a>&amp; pos1, <span class="keyword">const</span> <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a>&amp; pos2)</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;  {</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;    <span class="comment">// returns the separation distance^2 between two positions in 3D</span></div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;    <span class="keywordtype">double</span> d0 = pos1[0] - pos2[0];</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;    <span class="keywordtype">double</span> d1 = pos1[1] - pos2[1];</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;    <span class="keywordtype">double</span> d2 = pos1[2] - pos2[2];</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;    <span class="keywordflow">return</span> d0 * d0 + d1 * d1 + d2 * d2;</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;  } <span class="comment">// PosSep2</span></div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;<span class="comment">  //////////////////////////////////////////</span></div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span></div>
<div class="line"><a name="l02582"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a28c1a6c238b36f5b2ccef44d9d02d120"> 2582</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a28c1a6c238b36f5b2ccef44d9d02d120">SetMag</a>(<a class="code" href="../../de/d0f/namespacetca.html#a72c1c3d7710660bf62af0539e345c329">Vector3_t</a>&amp; v1, <span class="keywordtype">double</span> mag)</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;  {</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;    <span class="keywordtype">double</span> den = v1[0] * v1[0] + v1[1] * v1[1] + v1[2] * v1[2];</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;    <span class="keywordflow">if</span> (den == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;    den = sqrt(den);</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;    v1[0] *= mag / den;</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;    v1[1] *= mag / den;</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;    v1[2] *= mag / den;</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;  } <span class="comment">// SetMag</span></div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l02596"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a755bdf394aea4c92dcbf935a7d7b2c7a"> 2596</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a755bdf394aea4c92dcbf935a7d7b2c7a">FilldEdx</a>(<a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html">detinfo::DetectorClocksData</a> <span class="keyword">const</span>&amp; clockData,</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;           <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;           <span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc,</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;           <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp)</div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;  {</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;    <span class="comment">// Fills dE/dx variables in the pfp struct</span></div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;    <span class="comment">// don&#39;t attempt to find dE/dx at the end of a shower</span></div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> numEnds = 2;</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa91baa15ce1608cf939fdcba32bf970b">PDGCode</a> == 1111) numEnds = 1;</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;    <span class="comment">// set dE/dx to 0 to indicate that a valid dE/dx is expected</span></div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> = 0; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> &lt; numEnds; ++<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>) {</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = 0; plane &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>; ++plane)</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;        pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a4e8cbcf84cf897b360ab2c68009c8418">dEdx</a>[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>][plane] = 0;</div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;    } <span class="comment">// end</span></div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;    <span class="comment">// square of the maximum length that is used for finding the average dE/dx</span></div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;    <span class="keywordtype">float</span> maxSep2 = 5 * <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aee1cce9521d82837d6aeddfcd12a68ba">wirePitch</a>;</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;    maxSep2 *= maxSep2;</div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> = 0; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> &lt; numEnds; ++<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>) {</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;      std::vector&lt;float&gt; cnt(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>);</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;      <span class="keywordtype">short</span> <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> = 1 - 2 * <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>;</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;      <span class="keyword">auto</span> endPos = <a class="code" href="../../de/d0f/namespacetca.html#a42ad47f82498fce46d8feb62864d7d08">PosAtEnd</a>(pfp, <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>);</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;      <span class="keywordflow">for</span> (std::size_t ii = 0; ii &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size(); ++ii) {</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt;</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;        <span class="keywordflow">if</span> (dir &gt; 0) { ipt = ii; }</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;          ipt = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() - ii - 1;</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;        }</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;        <span class="keywordflow">if</span> (ipt &gt;= pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size()) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;        <span class="keyword">auto</span>&amp; tp3d = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[ipt];</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;        <span class="keywordflow">if</span> (tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a088d286995bc5cfcaa1f8f26a78f0a67">kTP3DBad</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a1c2bea68a634d09340f7921072d5acda">PosSep2</a>(tp3d.Pos, endPos) &gt; maxSep2) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;        <span class="comment">// require good points</span></div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;        <span class="keywordflow">if</span> (!tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;        <span class="keywordtype">float</span> dedx = <a class="code" href="../../de/d0f/namespacetca.html#a03d7925cba1cd1c5952d280736887b6b">dEdx</a>(clockData, detProp, slc, tp3d);</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;        <span class="keywordflow">if</span> (dedx &lt; 0.5) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(tp3d.CTP).<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>;</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;        pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a4e8cbcf84cf897b360ab2c68009c8418">dEdx</a>[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>][plane] += dedx;</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;        ++cnt[plane];</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;      } <span class="comment">// ii</span></div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = 0; plane &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>; ++plane) {</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;        <span class="keywordflow">if</span> (cnt[plane] == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;        pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a4e8cbcf84cf897b360ab2c68009c8418">dEdx</a>[<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>][plane] /= cnt[plane];</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;      } <span class="comment">// plane</span></div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;    }   <span class="comment">// end</span></div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;  } <span class="comment">// FilldEdx</span></div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l02649"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#acc69bee8429400e1b6a273648829ea88"> 2649</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#acc69bee8429400e1b6a273648829ea88">Average_dEdX</a>(<a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html">detinfo::DetectorClocksData</a> <span class="keyword">const</span>&amp; clockData,</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;               <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;               <span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc,</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;               <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp,</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;               <span class="keywordtype">float</span>&amp; dEdXAve,</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;               <span class="keywordtype">float</span>&amp; dEdXRms)</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;  {</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;    <span class="comment">// Return a simple average of dE/dx and rms using ALL points in all planes, not</span></div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;    <span class="comment">// just those at the ends ala FilldEdx</span></div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;    dEdXAve = -1.;</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;    dEdXRms = -1.;</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;    <span class="keywordtype">double</span> sum = 0;</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;    <span class="keywordtype">double</span> sum2 = 0;</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;    <span class="keywordtype">double</span> cnt = 0;</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; tp3d : pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>) {</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;      <span class="keywordflow">if</span> (!tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>] || tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a088d286995bc5cfcaa1f8f26a78f0a67">kTP3DBad</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;      <span class="keywordtype">double</span> dedx = <a class="code" href="../../de/d0f/namespacetca.html#a03d7925cba1cd1c5952d280736887b6b">dEdx</a>(clockData, detProp, slc, tp3d);</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;      <span class="keywordflow">if</span> (dedx &lt; 0.5 || dedx &gt; 80.) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;      sum += dedx;</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;      sum2 += dedx * dedx;</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;      ++cnt;</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;    } <span class="comment">// tp3d</span></div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;    <span class="keywordflow">if</span> (cnt &lt; 3) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;    dEdXAve = sum / cnt;</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;    <span class="comment">// Use a default rms of 30% of the average</span></div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;    dEdXRms = 0.3 * dEdXAve;</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;    <span class="keywordtype">double</span> arg = sum2 - cnt * dEdXAve * dEdXAve;</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;    <span class="keywordflow">if</span> (arg &lt; 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;    dEdXRms = sqrt(arg) / (cnt - 1);</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;    <span class="comment">// don&#39;t return a too-small rms</span></div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;    <span class="keywordtype">double</span> minRms = 0.05 * dEdXAve;</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;    <span class="keywordflow">if</span> (dEdXRms &lt; minRms) dEdXRms = minRms;</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;  } <span class="comment">// Average_dEdX</span></div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;<span class="comment"></span>  <span class="keywordtype">float</span></div>
<div class="line"><a name="l02686"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a03d7925cba1cd1c5952d280736887b6b"> 2686</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a03d7925cba1cd1c5952d280736887b6b">dEdx</a>(<a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html">detinfo::DetectorClocksData</a> <span class="keyword">const</span>&amp; clockData,</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;       <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;       <span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc,</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;       <a class="code" href="../../d5/db8/structtca_1_1TP3D.html">TP3D</a>&amp; tp3d)</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;  {</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;    <span class="keywordflow">if</span> (!tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a6253f3df3ce18548226edb7ef959b411">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>]) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;    <span class="keywordflow">if</span> (tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#ab6cea7b9a15237b36cd057f43aab4d89">TjID</a> &gt; (<span class="keywordtype">int</span>)slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>.size()) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;    <span class="keywordflow">if</span> (tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#ab6cea7b9a15237b36cd057f43aab4d89">TjID</a> &lt;= 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;</div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;    <span class="keyword">auto</span>&amp; tp = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#ab6cea7b9a15237b36cd057f43aab4d89">TjID</a> - 1].Pts[tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a0cf7385a035afbd0420ffde77a0f4e8b">TPIndex</a>];</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;    <span class="keywordflow">if</span> (tp.Environment[<a class="code" href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525ae8d79f565a18dd6877b890fa7cb6616b">kEnvOverlap</a>]) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;    <span class="keywordtype">double</span> dQ = 0.;</div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;    <span class="keywordtype">double</span> time = 0;</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ii = 0; ii &lt; tp.Hits.size(); ++ii) {</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;      <span class="keywordflow">if</span> (!tp.UseHit[ii]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;      <span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = (*<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">allHits</a>)[slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">slHits</a>[tp.Hits[ii]].allHitsIndex];</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;      dQ += <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>.Integral();</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;    } <span class="comment">// ii</span></div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;    time = tp.Pos[1] / <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a>;</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;    <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> plnID = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(tp.CTP);</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;    <span class="keywordflow">if</span> (dQ == 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;    <span class="keywordtype">double</span> angleToVert = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#a93b943c9a953f5b98e166cd21865ad4d">Plane</a>(plnID).<a class="code" href="../../d4/d67/classgeo_1_1PlaneGeo.html#a4aee7822c8ac09d443815098f48fe285">ThetaZ</a>() - 0.5 * ::util::pi&lt;&gt;();</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;    <span class="keywordtype">double</span> cosgamma =</div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;      <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(std::sin(angleToVert) * tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a9866502e46d57d11397eb8fee6485718">Dir</a>[1] + std::cos(angleToVert) * tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a9866502e46d57d11397eb8fee6485718">Dir</a>[2]);</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;    <span class="keywordflow">if</span> (cosgamma &lt; 1.<a class="code" href="../../d4/d3a/rawtorootconvert_8fcl.html#a073d3febd81cab639f2a8aa357dc5ef1">E</a>-5) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;    <span class="keywordtype">double</span> dx = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#a608b6838f7d8b7be32ea8fca24a7ff32">WirePitch</a>(plnID) / cosgamma;</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;    <span class="keywordtype">double</span> dQdx = dQ / dx;</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../d6/d11/namespacemake__calib__df.html#a2b8237bac57d5c373c623869ad4513c8">t0</a> = 0;</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;    <span class="keywordtype">float</span> dedx = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a7266fce5bdeb93f175687a0e8b0a50c6">caloAlg</a>-&gt;<a class="code" href="../../d1/de6/classcalo_1_1CalorimetryAlg.html#ae390af3771f9aba05f14a3d6d4c86e96">dEdx_AREA</a>(clockData, detProp, dQdx, time, plnID.<a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">Plane</a>, t0);</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;    <span class="keywordflow">if</span> (std::isinf(dedx)) dedx = 0;</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;    <span class="keywordflow">return</span> dedx;</div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;  } <span class="comment">// dEdx</span></div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;<span class="comment"></span>  TP3D</div>
<div class="line"><a name="l02722"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a1f3a9c0638f68964f62d19cbb80731da"> 2722</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a1f3a9c0638f68964f62d19cbb80731da">CreateTP3D</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;             <span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc,</div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;             <span class="keywordtype">int</span> tjID,</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;             <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> tpIndex)</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;  {</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;    <span class="comment">// create a TP3D with a single TP. Note that the SectionFit in which it</span></div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;    <span class="comment">// should be placed and the 3D position can&#39;t be determined until the the TP3D is</span></div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;    <span class="comment">// associated with a pfp. See SetSection()</span></div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;    <a class="code" href="../../d5/db8/structtca_1_1TP3D.html">TP3D</a> tp3d;</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a6253f3df3ce18548226edb7ef959b411">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a088d286995bc5cfcaa1f8f26a78f0a67">kTP3DBad</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;    <span class="keywordflow">if</span> (tjID &lt;= 0 || tjID &gt; (<span class="keywordtype">int</span>)slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>.size()) <span class="keywordflow">return</span> tp3d;</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;    <span class="keyword">auto</span>&amp; tj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tjID - 1];</div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;    <span class="keywordflow">if</span> (tpIndex &lt; tj.EndPt[0] || tpIndex &gt; tj.EndPt[1]) <span class="keywordflow">return</span> tp3d;</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#ab6cea7b9a15237b36cd057f43aab4d89">TjID</a> = tjID;</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a0cf7385a035afbd0420ffde77a0f4e8b">TPIndex</a> = tpIndex;</div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;    <span class="keyword">auto</span>&amp; tp2 = tj.Pts[tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a0cf7385a035afbd0420ffde77a0f4e8b">TPIndex</a>];</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;    <span class="keyword">auto</span> plnID = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(tp2.CTP);</div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#ac9763a62e8a5a7def22b002b728bb09f">CTP</a> = tp2.CTP;</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../d3/d63/namespaceutil_1_1quantities.html#a1a08bc762b79d6e1d7816c34d3e36f78">tick</a> = tp2.HitPos[1] / <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a>;</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a36c98f652f537113040d880f5898afaa">TPX</a> = detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a8e4b4b8d755ffded5a9f956ae7c9c1ec">ConvertTicksToX</a>(tick, plnID);</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;    <span class="comment">// Get the RMS of the TP in WSE units and convert to cm</span></div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;    <span class="keywordtype">float</span> rms = <a class="code" href="../../de/d0f/namespacetca.html#a77d8f2935484535790a3f875c3fe58a3">TPHitsRMSTime</a>(slc, tp2, <a class="code" href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3af8476e403cd021d9242196cdcfb127a9">kAllHits</a>) * <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aee1cce9521d82837d6aeddfcd12a68ba">wirePitch</a>;</div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;    <span class="comment">// inflate the error for large angle TPs</span></div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;    <span class="keywordflow">if</span> (tp2.AngleCode == 1) rms *= 2;</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;    <span class="comment">// a more careful treatment for long-pulse hits</span></div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;    <span class="keywordflow">if</span> (tp2.AngleCode &gt; 1) {</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;      std::vector&lt;unsigned int&gt; hitMultiplet;</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;      <span class="keywordflow">for</span> (std::size_t ii = 0; ii &lt; tp2.Hits.size(); ++ii) {</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;        <span class="keywordflow">if</span> (!tp2.UseHit[ii]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#a956ff1118d924911210bace923717e57">GetHitMultiplet</a>(slc, tp2.Hits[ii], hitMultiplet, <span class="keyword">true</span>);</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;        <span class="keywordflow">if</span> (hitMultiplet.size() &gt; 1) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;      } <span class="comment">// ii</span></div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;      rms = <a class="code" href="../../de/d0f/namespacetca.html#a9f64129d7d33c42c405c8b33d07262de">HitsRMSTime</a>(slc, hitMultiplet, <a class="code" href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3af8476e403cd021d9242196cdcfb127a9">kAllHits</a>) * <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aee1cce9521d82837d6aeddfcd12a68ba">wirePitch</a>;</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;      <span class="comment">// the returned RMS is closer to the FWHM, so divide by 2</span></div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;      rms /= 2;</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;    } <span class="comment">// tp2.AngleCode &gt; 1</span></div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a8ba13376fc25aa4e15d72ded58c512ea">TPXErr2</a> = rms * rms;</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a0598b7e6a7bf0fbf9bbd2d7d2173dbfb">Wire</a> = tp2.Pos[0];</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;    <span class="comment">// Can&#39;t declare it good since Pos and SFIndex aren&#39;t defined</span></div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a6253f3df3ce18548226edb7ef959b411">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a6253f3df3ce18548226edb7ef959b411">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a088d286995bc5cfcaa1f8f26a78f0a67">kTP3DBad</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;    <span class="keywordflow">return</span> tp3d;</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;  } <span class="comment">// CreateTP3D</span></div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span></div>
<div class="line"><a name="l02769"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a3075ef4d0b2a15d016f66c3fbf2a8aac"> 2769</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a3075ef4d0b2a15d016f66c3fbf2a8aac">SetSection</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;             <span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc,</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;             <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp,</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;             <a class="code" href="../../d5/db8/structtca_1_1TP3D.html">TP3D</a>&amp; tp3d)</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;  {</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;    <span class="comment">// Determine which SectionFit this tp3d should reside in, then calculate</span></div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;    <span class="comment">// the 3D position and the distance from the center of the SectionFit</span></div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;    <span class="keywordflow">if</span> (tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a0598b7e6a7bf0fbf9bbd2d7d2173dbfb">Wire</a> &lt; 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.empty()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>[0].Pos[0] == -10.0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;    <span class="keywordflow">if</span>(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1ae3c02e1143205b4d7a8e93437965aa47">kSmallAngle</a>]) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;    <span class="keyword">auto</span> plnID = <a class="code" href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">DecodeCTP</a>(tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#ac9763a62e8a5a7def22b002b728bb09f">CTP</a>);</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size() == 1) { tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a9ec485b3235b668007802b7b717b3e40">SFIndex</a> = 0; }</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;      <span class="comment">// Find the section center that is closest to this point in the wire coordinate</span></div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;      <span class="keywordtype">float</span> best = 1E6;</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;      <span class="keywordflow">for</span> (std::size_t sfi = 0; sfi &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size(); ++sfi) {</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;        <span class="keyword">auto</span>&amp; sf = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>[sfi];</div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;        <span class="keywordtype">float</span> sfWire = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#ae81e63f01473939eb6bc9c2cb5455906">WireCoordinate</a>(sf.Pos[1], sf.Pos[2], plnID);</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;        <span class="keywordtype">float</span> sep = <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(sfWire - tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a0598b7e6a7bf0fbf9bbd2d7d2173dbfb">Wire</a>);</div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;        <span class="keywordflow">if</span> (sep &lt; best) {</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;          best = sep;</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;          tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a9ec485b3235b668007802b7b717b3e40">SFIndex</a> = sfi;</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;        }</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;      } <span class="comment">// sfi</span></div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;    }   <span class="comment">// pfp.SectionFits.size() &gt; 1</span></div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;    <span class="keyword">auto</span>&amp; sf = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>[tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a9ec485b3235b668007802b7b717b3e40">SFIndex</a>];</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;    <span class="keyword">auto</span> plnTP = <a class="code" href="../../de/d0f/namespacetca.html#abf31bab3395b5e2325f017d9b7db50db">MakeBareTP</a>(detProp, slc, sf.Pos, sf.Dir, tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#ac9763a62e8a5a7def22b002b728bb09f">CTP</a>);</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;    <span class="comment">// the number of wires relative to the SectionFit center</span></div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;    <span class="keywordtype">double</span> dw = tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a0598b7e6a7bf0fbf9bbd2d7d2173dbfb">Wire</a> - plnTP.Pos[0];</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;    <span class="comment">// dt/dW was stored in DeltaRMS</span></div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;    <span class="keywordtype">double</span> t = dw * plnTP.DeltaRMS;</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;    <span class="comment">// define the 3D position</span></div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> xyz = 0; xyz &lt; 3; ++xyz)</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;      tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a937c64030bd53c835902da63475db5f5">Pos</a>[xyz] = sf.Pos[xyz] + t * sf.Dir[xyz];</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a15f15433176335aab1f8ea3c36485119">along</a> = t;</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;    tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a6253f3df3ce18548226edb7ef959b411">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;  } <span class="comment">// SetSection</span></div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;<span class="comment"></span>  <span class="keywordtype">float</span></div>
<div class="line"><a name="l02814"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a64a1d13b9dd367c5d94e5779daf22626"> 2814</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a64a1d13b9dd367c5d94e5779daf22626">PointPull</a>(<span class="keyword">const</span> <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp, <span class="keyword">const</span> <a class="code" href="../../d5/db8/structtca_1_1TP3D.html">TP3D</a>&amp; tp3d)</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;  {</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;    <span class="comment">// returns the pull that the tp3d will cause in the pfp section fit. This</span></div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;    <span class="comment">// currently only uses position but eventually will include charge</span></div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a937c64030bd53c835902da63475db5f5">Pos</a>[0] - tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a36c98f652f537113040d880f5898afaa">TPX</a>) / sqrt(tp3d.<a class="code" href="../../d5/db8/structtca_1_1TP3D.html#a8ba13376fc25aa4e15d72ded58c512ea">TPXErr2</a>);</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;  } <span class="comment">// PointPull</span></div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;<span class="comment"></span>  PFPStruct</div>
<div class="line"><a name="l02823"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a3bdf0e86f5c07dbf127ee66d6fbbd2e4"> 2823</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a3bdf0e86f5c07dbf127ee66d6fbbd2e4">CreatePFP</a>(<span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc)</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;  {</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;    <span class="comment">// The calling function should define the size of pfp.TjIDs</span></div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;    <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a> pfp;</div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;    pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a51b8e48c9df5507929ae0b6429cc7494">ID</a> = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">pfps</a>.size() + 1;</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;    pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a95513011426d3fcb8124798a85ff2ed6">ParentUID</a> = 0;</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;    pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a2aeca07e5620225d35f27cdff6cc9048">TPCID</a> = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>;</div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;    <span class="comment">// initialize arrays for both ends</span></div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;    <span class="keywordflow">if</span> (slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a> &lt; 4) {</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;      pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a4e8cbcf84cf897b360ab2c68009c8418">dEdx</a>[0].resize(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>, -1);</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;      pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a4e8cbcf84cf897b360ab2c68009c8418">dEdx</a>[1].resize(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>, -1);</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;      pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a8a39d1be09f8e3dd6f5b7a2cd8c933be">dEdxErr</a>[0].resize(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>, -1);</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;      pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a8a39d1be09f8e3dd6f5b7a2cd8c933be">dEdxErr</a>[1].resize(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>, -1);</div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;    }</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;    <span class="comment">// create a single section fit to hold the start/end positions and direction</span></div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;    pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.resize(1);</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;    <span class="keywordflow">return</span> pfp;</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;  } <span class="comment">// CreatePFP</span></div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l02844"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a7db96d3803dbd5bb37281d5aef67dbbf"> 2844</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a7db96d3803dbd5bb37281d5aef67dbbf">PFPVertexCheck</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc)</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;  {</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;    <span class="comment">// Ensure that all PFParticles have a start vertex. It is possible for</span></div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;    <span class="comment">// PFParticles to be attached to a 3D vertex that is later killed.</span></div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;    <span class="keywordflow">if</span> (!slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a2aab614bb8eea5ec2b9a98b0202683dd">isValid</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;    <span class="keywordflow">if</span> (slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">pfps</a>.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; pfp : slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">pfps</a>) {</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;      <span class="keywordflow">if</span> (pfp.ID == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;      <span class="keywordflow">if</span> (pfp.Vx3ID[0] &gt; 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;      <span class="keywordflow">if</span> (pfp.SectionFits.empty()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;      <a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html">Vtx3Store</a> vx3;</div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;      vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#ac14cedb2c2faa07bb9af1ea6296fcd00">TPCID</a> = pfp.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#ad779a535f3e0ba563bf8e30214a123f3">TPCID</a>;</div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;      vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#a9471a42a7a11d12130d48cf2e2795966">Vx2ID</a>.resize(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>);</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;      <span class="comment">// Flag it as a PFP vertex that isn&#39;t required to have matched 2D vertices</span></div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;      vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#a96d7d39b4008750878ef4048f45ab937">Wire</a> = -2;</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a> startPos;</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;      <span class="keywordflow">if</span> (pfp.TP3Ds.empty()) {</div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;        <span class="comment">// must be a neutrino pfp</span></div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;        startPos = pfp.SectionFits[0].Pos;</div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;      }</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!pfp.TP3Ds.empty()) {</div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;        <span class="comment">// normal pfp</span></div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;        startPos = pfp.TP3Ds[0].Pos;</div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;      }</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;      vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#a640bed614f7afb427cb1ce319ca2ae6b">X</a> = startPos[0];</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;      vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#ab0cbe58e29e2770cbd97c2ede779e9b9">Y</a> = startPos[1];</div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;      vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#a5019583e0e7c6cf6b01bbf7041b0b13b">Z</a> = startPos[2];</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;      vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#aee823c71f832466c9ad5eb7934e375c7">ID</a> = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae45d2a3a7b612c6f11637ed8f09e5e83">vtx3s</a>.size() + 1;</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;      vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#aa7c85bb03367fc57566553163a3492db">Primary</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;      ++<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#aafdfe819a43d7698d960971ca831306e">global3V_UID</a>;</div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;      vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#a73e9a57be9a4219c61af41014128d4be">UID</a> = <a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#aafdfe819a43d7698d960971ca831306e">global3V_UID</a>;</div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;      slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae45d2a3a7b612c6f11637ed8f09e5e83">vtx3s</a>.push_back(vx3);</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;      pfp.Vx3ID[0] = vx3.<a class="code" href="../../d2/d05/structtca_1_1Vtx3Store.html#aee823c71f832466c9ad5eb7934e375c7">ID</a>;</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;    } <span class="comment">// pfp</span></div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;  }   <span class="comment">// PFPVertexCheck</span></div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l02883"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#ad8fd522db1f6ab62d72bb413f8071f75"> 2883</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#ad8fd522db1f6ab62d72bb413f8071f75">DefinePFPParents</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <span class="keywordtype">bool</span> prt)</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;  {</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;<span class="comment">     This function reconciles vertices, PFParticles and slc, then</span></div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;<span class="comment">     defines the parent (j) - daughter (i) relationship and PDGCode. Here is a</span></div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;<span class="comment">     description of the conventions:</span></div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;<span class="comment">     V1 is the highest score 3D vertex in this tpcid so a neutrino PFParticle P1 is defined.</span></div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;<span class="comment">     V4 is a high-score vertex that has lower score than V1. It is declared to be a</span></div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;<span class="comment">     primary vertex because its score is higher than V5 and it is not associated with the</span></div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;<span class="comment">     neutrino interaction</span></div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;<span class="comment">     V6 was created to adhere to the convention that all PFParticles, in this case P9,</span></div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;<span class="comment">     be associated with a start vertex. There is no score for V6. P9 is it&#39;s own parent</span></div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;<span class="comment">     but is not a primary PFParticle.</span></div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;<span class="comment">     P1 - V1 - P2 - V2 - P4 - V3 - P5        V4 - P6                  V6 - P9</span></div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;<span class="comment">     \                                  \</span></div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;<span class="comment">     P3                                 P7 - V5 - P8</span></div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;<span class="comment">     The PrimaryID in this table is the ID of the PFParticle that is attached to the</span></div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;<span class="comment">     primary vertex, which may or may not be a neutrino interaction vertex.</span></div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;<span class="comment">     The PrimaryID is returned by the PrimaryID function</span></div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;<span class="comment">     PFP  parentID  DtrIDs     PrimaryID</span></div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;<span class="comment">     -----------------------------------</span></div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;<span class="comment">     P1     P1     P2, P3        P1</span></div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;<span class="comment">     P2     P1     P4            P2</span></div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;<span class="comment">     P3     P1     none          P3</span></div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;<span class="comment">     P4     P2     P5            P2</span></div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;<span class="comment">     P5     P4     none          P2</span></div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;<span class="comment">     P6     P6     none          P6</span></div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;<span class="comment">     P7     P7     P8            P7</span></div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;<span class="comment">     P9     P9     none          0</span></div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;    <span class="keywordflow">if</span> (slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">pfps</a>.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a2a72c7c94d8a7b0114b5183a4041ce1f">modes</a>[<a class="code" href="../../de/d0f/namespacetca.html#a70c266df69c86d3389a40a300c75903aaac214e93104d205b2c02e38d0c318b42">kTestBeam</a>]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;</div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;    <span class="keywordtype">int</span> neutrinoPFPID = 0;</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; pfp : slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">pfps</a>) {</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;      <span class="keywordflow">if</span> (pfp.ID == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#a2a72c7c94d8a7b0114b5183a4041ce1f">modes</a>[<a class="code" href="../../de/d0f/namespacetca.html#a70c266df69c86d3389a40a300c75903aaac214e93104d205b2c02e38d0c318b42">kTestBeam</a>] &amp;&amp; neutrinoPFPID == 0 &amp;&amp; (pfp.PDGCode == 12 || pfp.PDGCode == 14)) {</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;        neutrinoPFPID = pfp.ID;</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;      }</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;    } <span class="comment">// pfp</span></div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;    <span class="comment">// define the end vertex if the Tjs have end vertices</span></div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;    constexpr <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> end1 = 1;</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; pfp : slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">pfps</a>) {</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;      <span class="keywordflow">if</span> (pfp.ID == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;      <span class="comment">// already done?</span></div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;      <span class="keywordflow">if</span> (pfp.Vx3ID[end1] &gt; 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;      <span class="comment">// ignore shower-like pfps</span></div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a773c4a508e9fb45850f211b5a9743b7f">IsShowerLike</a>(slc, pfp.TjIDs)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;      <span class="comment">// count 2D -&gt; 3D matched vertices</span></div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> cnt3 = 0;</div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> vx3id = 0;</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;      <span class="comment">// list of unmatched 2D vertices that should be merged</span></div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;      std::vector&lt;int&gt; vx2ids;</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> tjid : pfp.TjIDs) {</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;        <span class="keyword">auto</span>&amp; tj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tjid - 1];</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;        <span class="keywordflow">if</span> (tj.VtxID[end1] == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;        <span class="keyword">auto</span>&amp; vx2 = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ad94c65623983dd14ecee8a4166c6e582">vtxs</a>[tj.VtxID[end1] - 1];</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;        <span class="keywordflow">if</span> (vx2.Vx3ID == 0) {</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;          <span class="keywordflow">if</span> (vx2.Topo == 1 &amp;&amp; vx2.NTraj == 2) vx2ids.push_back(vx2.ID);</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;        }</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;        <span class="keywordflow">if</span> (vx3id == 0) vx3id = vx2.Vx3ID;</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;        <span class="keywordflow">if</span> (vx2.Vx3ID == vx3id) ++cnt3;</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;      } <span class="comment">// tjid</span></div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;      <span class="keywordflow">if</span> (cnt3 &gt; 1) {</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;        <span class="comment">// ensure it isn&#39;t attached at the other end</span></div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;        <span class="keywordflow">if</span> (pfp.Vx3ID[1 - end1] == vx3id) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;        pfp.Vx3ID[end1] = vx3id;</div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;      } <span class="comment">// cnt3 &gt; 1</span></div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;    }   <span class="comment">// pfp</span></div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;    <span class="comment">// Assign a PDGCode to each PFParticle and look for a parent</span></div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; pfp : slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">pfps</a>) {</div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;      <span class="keywordflow">if</span> (pfp.ID == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;      <span class="comment">// skip a neutrino PFParticle</span></div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;      <span class="keywordflow">if</span> (pfp.PDGCode == 12 || pfp.PDGCode == 14 || pfp.PDGCode == 22) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;      <span class="comment">// Define a PFP parent if there are two or more Tjs that are daughters of</span></div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;      <span class="comment">// Tjs that are used by the same PFParticle</span></div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;      <span class="keywordtype">int</span> pfpParentID = INT_MAX;</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nParent = 0;</div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> tjid : pfp.TjIDs) {</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;        <span class="keyword">auto</span>&amp; tj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tjid - 1];</div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;        <span class="keywordflow">if</span> (tj.ParentID &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;        <span class="keyword">auto</span> parPFP = <a class="code" href="../../de/d0f/namespacetca.html#a6c5dfbe1dbd5f82afa300019bfdf6d3d">GetAssns</a>(slc, <span class="stringliteral">&quot;T&quot;</span>, tj.ParentID, <span class="stringliteral">&quot;P&quot;</span>);</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;        <span class="keywordflow">if</span> (parPFP.empty()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;        <span class="keywordflow">if</span> (pfpParentID == INT_MAX) pfpParentID = parPFP[0];</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;        <span class="keywordflow">if</span> (parPFP[0] == pfpParentID) ++nParent;</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;      } <span class="comment">// ii</span></div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;      <span class="keywordflow">if</span> (nParent &gt; 1) {</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;        <span class="keyword">auto</span>&amp; ppfp = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">pfps</a>[pfpParentID - 1];</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;        <span class="comment">// set the parent UID</span></div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;        pfp.ParentUID = ppfp.UID;</div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;        <span class="comment">// add to the parent daughters list</span></div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;        ppfp.DtrUIDs.push_back(pfp.UID);</div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;      } <span class="comment">// nParent &gt; 1</span></div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;    }   <span class="comment">// ipfp</span></div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;    <span class="comment">// associate primary PFParticles with a neutrino PFParticle</span></div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;    <span class="keywordflow">if</span> (neutrinoPFPID &gt; 0) {</div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;      <span class="keyword">auto</span>&amp; neutrinoPFP = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">pfps</a>[neutrinoPFPID - 1];</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;      <span class="keywordtype">int</span> vx3id = neutrinoPFP.Vx3ID[1];</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; pfp : slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">pfps</a>) {</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;        <span class="keywordflow">if</span> (pfp.ID == 0 || pfp.ID == neutrinoPFPID) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;        <span class="keywordflow">if</span> (pfp.Vx3ID[0] != vx3id) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;        pfp.ParentUID = (size_t)neutrinoPFPID;</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;        neutrinoPFP.DtrUIDs.push_back(pfp.ID);</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;        <span class="keywordflow">if</span> (pfp.PDGCode == 111) neutrinoPFP.PDGCode = 12;</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;      } <span class="comment">// pfp</span></div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;    }   <span class="comment">// neutrino PFP exists</span></div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;  }     <span class="comment">// DefinePFPParents</span></div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span></div>
<div class="line"><a name="l03003"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a8046762858ae84edee746a126116196d"> 3003</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a8046762858ae84edee746a126116196d">StorePFP</a>(<a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp)</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;  {</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;    <span class="comment">// stores the PFParticle in the slice</span></div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;    <span class="keywordtype">bool</span> neutrinoPFP = (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa91baa15ce1608cf939fdcba32bf970b">PDGCode</a> == 12 || pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa91baa15ce1608cf939fdcba32bf970b">PDGCode</a> == 14);</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;    <span class="keywordflow">if</span> (!neutrinoPFP) {</div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;      <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">TjIDs</a>.empty()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;      <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa91baa15ce1608cf939fdcba32bf970b">PDGCode</a> != 1111 &amp;&amp; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() &lt; 2) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;    }</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;    <span class="keywordflow">if</span>(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1ae3c02e1143205b4d7a8e93437965aa47">kSmallAngle</a>]) {</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;      <span class="comment">// Make the PFP -&gt; TP assn</span></div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;      <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; tp3d : pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>) {</div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;        <span class="keywordflow">if</span>(tp3d.TPIndex != USHRT_MAX) slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tp3d.TjID - 1].Pts[tp3d.TPIndex].InPFP = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a51b8e48c9df5507929ae0b6429cc7494">ID</a>;</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;      }</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;    }</div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;</div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;    <span class="comment">// ensure that the InPFP flag is set</span></div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nNotSet = 0;</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; tp3d : pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>) {</div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;      <span class="keywordflow">if</span> (tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a088d286995bc5cfcaa1f8f26a78f0a67">kTP3DBad</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;      <span class="keyword">auto</span>&amp; tp = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tp3d.TjID - 1].Pts[tp3d.TPIndex];</div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;      <span class="keywordflow">if</span> (tp.InPFP != pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a51b8e48c9df5507929ae0b6429cc7494">ID</a>) ++nNotSet;</div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;    } <span class="comment">// tp3d</span></div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;    <span class="keywordflow">if</span> (nNotSet &gt; 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;    <span class="comment">// check the ID and correct it if it is wrong</span></div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a51b8e48c9df5507929ae0b6429cc7494">ID</a> != (<span class="keywordtype">int</span>)slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">pfps</a>.size() + 1) pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a51b8e48c9df5507929ae0b6429cc7494">ID</a> = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">pfps</a>.size() + 1;</div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;    ++<a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#a6cd848fd4c9dd92fd6b7ec1ce0356ad6">globalP_UID</a>;</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;    pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a3c46c186d7c6861d3f9f03eceea661de">UID</a> = <a class="code" href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">evt</a>.<a class="code" href="../../d0/d2f/structtca_1_1TCEvent.html#a6cd848fd4c9dd92fd6b7ec1ce0356ad6">globalP_UID</a>;</div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;    <span class="comment">// set the 3D match flag</span></div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> tjid : pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">TjIDs</a>) {</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;      <span class="keyword">auto</span>&amp; tj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tjid - 1];</div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;      tj.AlgMod[<a class="code" href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da6ffcff8d6a31c1e1662e99d73d544e86">kMat3D</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;    } <span class="comment">// tjid</span></div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;</div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;    slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">pfps</a>.push_back(pfp);</div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;  } <span class="comment">// StorePFP</span></div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span></div>
<div class="line"><a name="l03044"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a58cf1f10cbe4f065ed07eaaef9d3bb2e"> 3044</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a58cf1f10cbe4f065ed07eaaef9d3bb2e">InsideFV</a>(<span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <span class="keyword">const</span> <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>)</div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;  {</div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;    <span class="comment">// returns true if the end of the pfp is inside the fiducial volume of the TPC</span></div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a51b8e48c9df5507929ae0b6429cc7494">ID</a> &lt;= 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;    <span class="keywordflow">if</span> (end &gt; 1) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.empty()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;    <span class="comment">// require that the points are sorted which ensures that the start and end points</span></div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;    <span class="comment">// are the first and last points in the TP3Ds vector</span></div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1a16c8b0d8524fc0914afc3dab9bf89950">kNeedsUpdate</a>]) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;    <span class="keywordtype">bool</span> neutrinoPFP = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa91baa15ce1608cf939fdcba32bf970b">PDGCode</a> == 12 || pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa91baa15ce1608cf939fdcba32bf970b">PDGCode</a> == 14;</div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;    <span class="keywordtype">float</span> abit = 5;</div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a> pos;</div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;    <span class="keywordflow">if</span> (neutrinoPFP) { pos = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>[0].Pos; }</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (end == 0) {</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;      pos = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[0].Pos;</div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;    }</div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;      pos = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() - 1].Pos;</div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;    }</div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;    <span class="keywordflow">return</span> (pos[0] &gt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a715dd4b152144579ecdd77dea07d0735">xLo</a> + abit &amp;&amp; pos[0] &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a549de1ce766114d70f6c8c9086be31a2">xHi</a> - abit &amp;&amp; pos[1] &gt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a33a2deade219f3af4666c23d0979532f">yLo</a> + abit &amp;&amp;</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;            pos[1] &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a038a7aedcbc4fbac7ed8f29f37fec545">yHi</a> - abit &amp;&amp; pos[2] &gt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#ac8434b42a2a3f07a64a5f49146dfea3b">zLo</a> + abit &amp;&amp; pos[2] &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a00ae051924d45128505ddc9e15f69c8d">zHi</a> - abit);</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;  } <span class="comment">// InsideFV</span></div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span></div>
<div class="line"><a name="l03071"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a7f663b1f0cd693167cdf6aa76532b4d3"> 3071</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a7f663b1f0cd693167cdf6aa76532b4d3">InsideTPC</a>(<span class="keyword">const</span> <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a>&amp; pos, <a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a>&amp; inTPCID)</div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;  {</div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;    <span class="comment">// determine which TPC this point is in. This function returns false</span></div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;    <span class="comment">// if the point is not inside any TPC</span></div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;    <span class="keywordtype">float</span> abit = 5;</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a>&amp; tpcid : <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#a4dbfc785eaf3524798bb01407edc52b5">IterateTPCIDs</a>()) {</div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html">geo::TPCGeo</a>&amp; <a class="code" href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a> = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#a84aba48f49cf9add6cf0641a4527e45b">TPC</a>(tpcid);</div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;      <span class="keywordtype">double</span> <a class="code" href="../../d5/d61/make__xml__premcc1_80_8sh.html#a6a381711e6b60dd64d5ecdb1d135c1b8">local</a>[3] = {0., 0., 0.};</div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;      <span class="keywordtype">double</span> world[3] = {0., 0., 0.};</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;      TPC.<a class="code" href="../../d9/dff/classgeo_1_1TPCGeo.html#a3f663d96f6fe0ad88a84fa7dd0c9fc77">LocalToWorld</a>(local, world);</div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;      <span class="comment">// reduce the active area of the TPC by a bit to be consistent with FillWireHitRange</span></div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;      <span class="keywordflow">if</span> (pos[0] &lt; world[0] - <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#a93c0f3e32739f934854e649c1ab980c1">DetHalfWidth</a>(tpcid) + abit) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;      <span class="keywordflow">if</span> (pos[0] &gt; world[0] + <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#a93c0f3e32739f934854e649c1ab980c1">DetHalfWidth</a>(tpcid) - abit) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;      <span class="keywordflow">if</span> (pos[1] &lt; world[1] - <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#adb675e4a8b4234008e4e738c4dd090a5">DetHalfHeight</a>(tpcid) + abit) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;      <span class="keywordflow">if</span> (pos[1] &gt; world[1] + <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#adb675e4a8b4234008e4e738c4dd090a5">DetHalfHeight</a>(tpcid) - abit) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;      <span class="keywordflow">if</span> (pos[2] &lt; world[2] - <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#a3ad8501224048854f35e6b29d9ac4a72">DetLength</a>(tpcid) / 2 + abit) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;      <span class="keywordflow">if</span> (pos[2] &gt; world[2] + <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#a3ad8501224048854f35e6b29d9ac4a72">DetLength</a>(tpcid) / 2 - abit) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;      inTPCID = tpcid;</div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;    } <span class="comment">// tpcid</span></div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;  } <span class="comment">// InsideTPC</span></div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l03096"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a55899e64c6307177d1599f26a0a255a6"> 3096</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a55899e64c6307177d1599f26a0a255a6">FindAlongTrans</a>(<a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a> pos1, <a class="code" href="../../de/d0f/namespacetca.html#a72c1c3d7710660bf62af0539e345c329">Vector3_t</a> dir1, <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a> pos2, <a class="code" href="../../de/d0f/namespacetca.html#acae6296d6fba718d82c34c88fefddf52">Point2_t</a>&amp; alongTrans)</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;  {</div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;    <span class="comment">// Calculate the distance along and transvers to the direction vector from pos1 to pos2</span></div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;    alongTrans[0] = 0;</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;    alongTrans[1] = 0;</div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;    <span class="keywordflow">if</span> (pos1[0] == pos2[0] &amp;&amp; pos1[1] == pos2[1] &amp;&amp; pos1[2] == pos2[2]) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;    <span class="keyword">auto</span> ptDir = <a class="code" href="../../de/d0f/namespacetca.html#a6200f7dc3ac9831695e882e7ca391cdc">PointDirection</a>(pos1, pos2);</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a28c1a6c238b36f5b2ccef44d9d02d120">SetMag</a>(dir1, 1.0);</div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;    <span class="keywordtype">double</span> costh = <a class="code" href="../../de/d0f/namespacetca.html#ac7453ffded371a6c148f116b8c0042c9">DotProd</a>(dir1, ptDir);</div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;    <span class="keywordflow">if</span> (costh &gt; 1) costh = 1;</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;    <span class="keywordtype">double</span> sep = <a class="code" href="../../de/d0f/namespacetca.html#a2a4c4a32e939554d609ba778be021c6d">PosSep</a>(pos1, pos2);</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;    alongTrans[0] = costh * sep;</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;    <span class="keywordtype">double</span> sinth = sqrt(1 - costh * costh);</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;    alongTrans[1] = sinth * sep;</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;  } <span class="comment">// FindAlongTrans</span></div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span></div>
<div class="line"><a name="l03114"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#ab0da6302706a58448c4ee031a85d0695"> 3114</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#ab0da6302706a58448c4ee031a85d0695">PointDirIntersect</a>(<a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a> <a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a>,</div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;                    <a class="code" href="../../de/d0f/namespacetca.html#a72c1c3d7710660bf62af0539e345c329">Vector3_t</a> p1Dir,</div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;                    <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a> p2,</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;                    <a class="code" href="../../de/d0f/namespacetca.html#a72c1c3d7710660bf62af0539e345c329">Vector3_t</a> p2Dir,</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;                    <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a>&amp; intersect,</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;                    <span class="keywordtype">float</span>&amp; doca)</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;  {</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;    <span class="comment">// Point - vector version</span></div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a> p1End, p2End;</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> xyz = 0; xyz &lt; 3; ++xyz) {</div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;      p1End[xyz] = p1[xyz] + 10 * p1Dir[xyz];</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;      p2End[xyz] = p2[xyz] + 10 * p2Dir[xyz];</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;    }</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d0f/namespacetca.html#a17cc6e2a5aac0f63dfa941aced04b68a">LineLineIntersect</a>(p1, p1End, p2, p2End, intersect, doca);</div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;  } <span class="comment">// PointDirIntersect</span></div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span></div>
<div class="line"><a name="l03132"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a17cc6e2a5aac0f63dfa941aced04b68a"> 3132</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a17cc6e2a5aac0f63dfa941aced04b68a">LineLineIntersect</a>(<a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a> <a class="code" href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a>,</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;                    <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a> p2,</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;                    <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a> p3,</div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;                    <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a> p4,</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;                    <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a>&amp; intersect,</div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;                    <span class="keywordtype">float</span>&amp; doca)</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;  {</div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;<span class="comment">     Calculate the line segment PaPb that is the shortest route between</span></div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;<span class="comment">     two lines P1P2 and P3P4. Calculate also the values of mua and mub where</span></div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;<span class="comment">     Pa = P1 + mua (P2 - P1)</span></div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;<span class="comment">     Pb = P3 + mub (P4 - P3)</span></div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;<span class="comment">     Return FALSE if no solution exists.</span></div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;<span class="comment">     http://paulbourke.net/geometry/pointlineplane/</span></div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;</div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a> p13, p43, p21;</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;    <span class="keywordtype">double</span> d1343, d4321, d1321, d4343, d2121;</div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;    <span class="keywordtype">double</span> numer, denom;</div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;    constexpr <span class="keywordtype">double</span> EPS = std::numeric_limits&lt;double&gt;::min();</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;</div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;    p13[0] = p1[0] - p3[0];</div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;    p13[1] = p1[1] - p3[1];</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;    p13[2] = p1[2] - p3[2];</div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;    p43[0] = p4[0] - p3[0];</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;    p43[1] = p4[1] - p3[1];</div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;    p43[2] = p4[2] - p3[2];</div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(p43[0]) &lt; EPS &amp;&amp; <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(p43[1]) &lt; EPS &amp;&amp; <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(p43[2]) &lt; EPS) <span class="keywordflow">return</span> (<span class="keyword">false</span>);</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;    p21[0] = p2[0] - p1[0];</div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;    p21[1] = p2[1] - p1[1];</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;    p21[2] = p2[2] - p1[2];</div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(p21[0]) &lt; EPS &amp;&amp; <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(p21[1]) &lt; EPS &amp;&amp; <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(p21[2]) &lt; EPS) <span class="keywordflow">return</span> (<span class="keyword">false</span>);</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;</div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;    d1343 = p13[0] * p43[0] + p13[1] * p43[1] + p13[2] * p43[2];</div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;    d4321 = p43[0] * p21[0] + p43[1] * p21[1] + p43[2] * p21[2];</div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;    d1321 = p13[0] * p21[0] + p13[1] * p21[1] + p13[2] * p21[2];</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;    d4343 = p43[0] * p43[0] + p43[1] * p43[1] + p43[2] * p43[2];</div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;    d2121 = p21[0] * p21[0] + p21[1] * p21[1] + p21[2] * p21[2];</div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;</div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;    denom = d2121 * d4343 - d4321 * d4321;</div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(denom) &lt; EPS) <span class="keywordflow">return</span> (<span class="keyword">false</span>);</div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;    numer = d1343 * d4321 - d1321 * d4343;</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;    <span class="keywordtype">double</span> mua = numer / denom;</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;    <span class="keywordtype">double</span> mub = (d1343 + d4321 * mua) / d4343;</div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;</div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;    intersect[0] = p1[0] + mua * p21[0];</div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;    intersect[1] = p1[1] + mua * p21[1];</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;    intersect[2] = p1[2] + mua * p21[2];</div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a> pb;</div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;    pb[0] = p3[0] + mub * p43[0];</div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;    pb[1] = p3[1] + mub * p43[1];</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;    pb[2] = p3[2] + mub * p43[2];</div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;    doca = <a class="code" href="../../de/d0f/namespacetca.html#a2a4c4a32e939554d609ba778be021c6d">PosSep</a>(intersect, pb);</div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;    <span class="comment">// average the closest points</span></div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> xyz = 0; xyz &lt; 3; ++xyz)</div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;      intersect[xyz] += pb[xyz];</div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> xyz = 0; xyz &lt; 3; ++xyz)</div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;      intersect[xyz] /= 2;</div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;  } <span class="comment">// LineLineIntersect</span></div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;<span class="comment"></span>  <span class="keywordtype">float</span></div>
<div class="line"><a name="l03196"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a659967724e0444ef70a496870d2d9418"> 3196</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a659967724e0444ef70a496870d2d9418">ChgFracBetween</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;                 <span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc,</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;                 <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a> pos1,</div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;                 <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a> pos2)</div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;  {</div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;    <span class="comment">// Step between pos1 and pos2 and find the fraction of the points that have nearby hits</span></div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;    <span class="comment">// in each plane. This function returns -1 if something is fishy, but this doesn&#39;t mean</span></div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;    <span class="comment">// that there is no charge. Note that there is no check for charge precisely at the pos1 and pos2</span></div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;    <span class="comment">// positions</span></div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;    <span class="keywordtype">float</span> sep = <a class="code" href="../../de/d0f/namespacetca.html#a2a4c4a32e939554d609ba778be021c6d">PosSep</a>(pos1, pos2);</div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;    <span class="keywordflow">if</span> (sep == 0) <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nstep = sep / <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aee1cce9521d82837d6aeddfcd12a68ba">wirePitch</a>;</div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;    <span class="keyword">auto</span> <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> = <a class="code" href="../../de/d0f/namespacetca.html#a6200f7dc3ac9831695e882e7ca391cdc">PointDirection</a>(pos1, pos2);</div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;    <span class="keywordtype">float</span> sum = 0;</div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;    <span class="keywordtype">float</span> cnt = 0;</div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;    <a class="code" href="../../da/d22/structtca_1_1TrajPoint.html">TrajPoint</a> tp;</div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> step = 0; step &lt; nstep; ++step) {</div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> xyz = 0; xyz &lt; 3; ++xyz)</div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;        pos1[xyz] += <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#aee1cce9521d82837d6aeddfcd12a68ba">wirePitch</a> * <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>[xyz];</div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;      <a class="code" href="../../de/ddc/generate__icarus__geometry__splitwire_8pl.html#a566ec0b645c019fdab1b56a230a4b24d">for</a> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = 0; plane &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>; ++plane) {</div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;        tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#a00fdf2d73e4a03e5a7f32411e460ba2e">CTP</a> = <a class="code" href="../../de/d0f/namespacetca.html#a8806e1c32119afbfe02dff4c21cf3e57">EncodeCTP</a>(slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>, slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>, plane);</div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;        tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[0] =</div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;          <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#ae81e63f01473939eb6bc9c2cb5455906">WireCoordinate</a>(pos1[1], pos1[2], plane, slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>, slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>);</div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;        tp.<a class="code" href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">Pos</a>[1] = detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a359d6255bb14f321d76e6085204ea52a">ConvertXToTicks</a>(pos1[0], plane, slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>, slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>) *</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;                    <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a>;</div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;        ++cnt;</div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#af522808f94ccf75807e228fad5f2b5dd">SignalAtTp</a>(tp)) ++sum;</div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;      } <span class="comment">// plane</span></div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;    }   <span class="comment">// step</span></div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;    <span class="keywordflow">if</span> (cnt == 0) <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;    <span class="keywordflow">return</span> sum / cnt;</div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;  } <span class="comment">// ChgFracBetween</span></div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;<span class="comment"></span>  <span class="keywordtype">float</span></div>
<div class="line"><a name="l03231"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#afd50fd87ab14988a84db0675b36812f3"> 3231</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#afd50fd87ab14988a84db0675b36812f3">ChgFracNearEnd</a>(<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;                 <span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc,</div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;                 <span class="keyword">const</span> <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp,</div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;                 <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>)</div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;  {</div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;    <span class="comment">// returns the charge fraction near the end of the pfp. Note that this function</span></div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;    <span class="comment">// assumes that there is only one Tj in a plane.</span></div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a51b8e48c9df5507929ae0b6429cc7494">ID</a> == 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">TjIDs</a>.empty()) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;    <span class="keywordflow">if</span> (end &lt; 0 || end &gt; 1) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a2aeca07e5620225d35f27cdff6cc9048">TPCID</a> != slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">TPCID</a>) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.empty()) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;</div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;    <span class="keywordtype">float</span> sum = 0;</div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;    <span class="keywordtype">float</span> cnt = 0;</div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;    <span class="comment">// keep track of the lowest value and maybe reject it</span></div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;    <span class="keywordtype">float</span> lo = 1;</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;    <span class="keywordtype">float</span> hi = 0;</div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;    <span class="keyword">auto</span> pos3 = <a class="code" href="../../de/d0f/namespacetca.html#a42ad47f82498fce46d8feb62864d7d08">PosAtEnd</a>(pfp, end);</div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = 0; plane &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>; ++plane) {</div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;      <a class="code" href="../../de/d0f/namespacetca.html#a0c55ac735de824c3e089bcbea9addb71">CTP_t</a> inCTP = <a class="code" href="../../de/d0f/namespacetca.html#a8806e1c32119afbfe02dff4c21cf3e57">EncodeCTP</a>(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a2aeca07e5620225d35f27cdff6cc9048">TPCID</a>.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>, pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a2aeca07e5620225d35f27cdff6cc9048">TPCID</a>.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>, plane);</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;      std::vector&lt;int&gt; tjids(1);</div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> tjid : pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">TjIDs</a>) {</div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;        <span class="keyword">auto</span>&amp; tj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tjid - 1];</div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;        <span class="keywordflow">if</span> (tj.CTP != inCTP) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;        tjids[0] = tjid;</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#acae6296d6fba718d82c34c88fefddf52">Point2_t</a> pos2;</div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;        <a class="code" href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a> planeID = <a class="code" href="../../d2/d66/namespacegeo_1_1fhicl.html#a05ff5cebd7313582756a33d8e8a5971a">geo::PlaneID</a>(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a2aeca07e5620225d35f27cdff6cc9048">TPCID</a>.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>, pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a2aeca07e5620225d35f27cdff6cc9048">TPCID</a>.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>, plane);</div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;        pos2[0] = <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">geom</a>-&gt;<a class="code" href="../../d7/d63/classgeo_1_1GeometryCore.html#ae81e63f01473939eb6bc9c2cb5455906">WireCoordinate</a>(pos3[1], pos3[2], planeID);</div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;        <span class="keywordflow">if</span> (pos2[0] &lt; -0.4) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;        <span class="comment">// check for dead wires</span></div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wire = std::nearbyint(pos2[0]);</div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;        <span class="keywordflow">if</span> (wire &gt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a2bfd4002c7f6fbe64e1fc1591682870b">nWires</a>[plane]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;        <span class="keywordflow">if</span> (slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a95f7fcb13cb06c827c69fc2fd301f1c0">wireHitRange</a>[plane][wire].first == UINT_MAX) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;        pos2[1] = detProp.<a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a359d6255bb14f321d76e6085204ea52a">ConvertXToTicks</a>(pos3[0], planeID) * <a class="code" href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tcc</a>.<a class="code" href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">unitsPerTick</a>;</div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;        <span class="keywordtype">float</span> cf = <a class="code" href="../../de/d0f/namespacetca.html#a91b05db73ba97c302cb3368ec72b1dc8">ChgFracNearPos</a>(slc, pos2, tjids);</div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;        <span class="keywordflow">if</span> (cf &lt; lo) lo = cf;</div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;        <span class="keywordflow">if</span> (cf &gt; hi) hi = cf;</div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;        sum += cf;</div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;        ++cnt;</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;      } <span class="comment">// tjid</span></div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;    }   <span class="comment">// plane</span></div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;    <span class="keywordflow">if</span> (cnt == 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;    <span class="keywordflow">if</span> (cnt &gt; 1 &amp;&amp; lo &lt; 0.3 &amp;&amp; hi &gt; 0.8) {</div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;      sum -= lo;</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;      --cnt;</div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;    }</div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;    <span class="keywordflow">return</span> sum / cnt;</div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;  } <span class="comment">// ChgFracNearEnd</span></div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;<span class="comment"></span>  <a class="code" href="../../de/d0f/namespacetca.html#a72c1c3d7710660bf62af0539e345c329">Vector3_t</a></div>
<div class="line"><a name="l03283"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a66ba31f5d3047b3a68011a4e154891fc"> 3283</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a66ba31f5d3047b3a68011a4e154891fc">DirAtEnd</a>(<span class="keyword">const</span> <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>)</div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;  {</div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;    <span class="keywordflow">if</span> (end &gt; 1 || pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.empty()) <span class="keywordflow">return</span> {{0., 0., 0.}};</div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;    <span class="keywordflow">if</span> (end == 0) <span class="keywordflow">return</span> pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>[0].Dir;</div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;    <span class="keywordflow">return</span> pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>[pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size() - 1].Dir;</div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;  } <span class="comment">// PosAtEnd</span></div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;<span class="comment"></span>  <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a></div>
<div class="line"><a name="l03292"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a42ad47f82498fce46d8feb62864d7d08"> 3292</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a42ad47f82498fce46d8feb62864d7d08">PosAtEnd</a>(<span class="keyword">const</span> <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>)</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;  {</div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;    <span class="keywordflow">if</span> (end &gt; 1 || pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.empty()) <span class="keywordflow">return</span> {{0., 0., 0.}};</div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;    <span class="comment">// handle a neutrino pfp that doesn&#39;t have any TP3Ds</span></div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.empty()) <span class="keywordflow">return</span> pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>[0].Pos;</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;    <a class="code" href="../../de/d71/neoSmazza_8sh.html#ae55989c903f0c76190facfb5e5211732">if</a> (end == 0) <span class="keywordflow">return</span> pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[0].Pos;</div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;    <span class="keywordflow">return</span> pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() - 1].Pos;</div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;  } <span class="comment">// PosAtEnd</span></div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;<span class="comment"></span>  <span class="keywordtype">float</span></div>
<div class="line"><a name="l03303"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a4f3087743ae6823cd5b6e9ff1a344843"> 3303</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a4f3087743ae6823cd5b6e9ff1a344843">Length</a>(<span class="keyword">const</span> <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp)</div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;  {</div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.empty()) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d0f/namespacetca.html#a2a4c4a32e939554d609ba778be021c6d">PosSep</a>(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[0].Pos, pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() - 1].Pos);</div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;  } <span class="comment">// Length</span></div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span></div>
<div class="line"><a name="l03311"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#af76f13054935a6da9473200ddcecdd74"> 3311</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#af76f13054935a6da9473200ddcecdd74">SectionStartEnd</a>(<span class="keyword">const</span> <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp,</div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;                  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sfIndex,</div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;                  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>&amp; startPt,</div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;                  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>&amp; endPt)</div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;  {</div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;    <span class="comment">// this assumes that the TP3Ds vector is sorted</span></div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;    startPt = USHRT_MAX;</div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;    endPt = USHRT_MAX;</div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;    <span class="keywordflow">if</span> (sfIndex &gt;= pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;</div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="../../d4/d43/namespacechannelDBConverter.html#af481fa22253619167bce75a37e10ec34">first</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;    <span class="keywordflow">for</span> (std::size_t ipt = 0; ipt &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size(); ++ipt) {</div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;      <span class="keyword">auto</span>&amp; tp3d = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[ipt];</div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;      <span class="keywordflow">if</span> (tp3d.SFIndex &lt; sfIndex) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;      <span class="keywordflow">if</span> (first) {</div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;        first = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;        startPt = ipt;</div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;      } <span class="comment">// first</span></div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;      <span class="keywordflow">if</span> (tp3d.SFIndex &gt; sfIndex) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;      endPt = ipt;</div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;</div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;  } <span class="comment">// SectionStartEnd</span></div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;<span class="comment"></span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span></div>
<div class="line"><a name="l03338"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a56bf7b0d45925f907c89dfdab97f2ed5"> 3338</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a56bf7b0d45925f907c89dfdab97f2ed5">FarEnd</a>(<span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc, <span class="keyword">const</span> <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp, <span class="keyword">const</span> <a class="code" href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">Point3_t</a>&amp; pos)</div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;  {</div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;    <span class="comment">// Returns the end (0 or 1) of the pfp that is furthest away from the position pos</span></div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a51b8e48c9df5507929ae0b6429cc7494">ID</a> == 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.empty()) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;    <span class="keyword">auto</span>&amp; pos0 = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[0].Pos;</div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;    <span class="keyword">auto</span>&amp; pos1 = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() - 1].Pos;</div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#a1c2bea68a634d09340f7921072d5acda">PosSep2</a>(pos1, pos) &gt; <a class="code" href="../../de/d0f/namespacetca.html#a1c2bea68a634d09340f7921072d5acda">PosSep2</a>(pos0, pos)) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;  } <span class="comment">// FarEnd</span></div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;<span class="comment">  /////////////////////////////////////////</span></div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;<span class="comment"></span>  <span class="keywordtype">int</span></div>
<div class="line"><a name="l03351"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a3522a953c66af70a71df4f85857acae4"> 3351</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a3522a953c66af70a71df4f85857acae4">PDGCodeVote</a>(<a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html">detinfo::DetectorClocksData</a> <span class="keyword">const</span>&amp; clockData,</div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;              <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;              <span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc,</div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;              <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp)</div>
<div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;  {</div>
<div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;    <span class="comment">// returns a vote using PDG code assignments from dE/dx. A PDGCode of -1 is</span></div>
<div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;    <span class="comment">// returned if there was a failure and returns 0 if no decision can be made</span></div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.empty()) <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;</div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;    <span class="comment">// try to do better using dE/dx</span></div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;    <span class="keywordtype">float</span> dEdXAve = 0;</div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;    <span class="keywordtype">float</span> dEdXRms = 0;</div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;    <a class="code" href="../../de/d0f/namespacetca.html#acc69bee8429400e1b6a273648829ea88">Average_dEdX</a>(clockData, detProp, slc, pfp, dEdXAve, dEdXRms);</div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;    <span class="keywordflow">if</span> (dEdXAve &lt; 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;    <span class="comment">// looks like a proton if dE/dx is high and the rms is low</span></div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;    dEdXRms /= dEdXAve;</div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;    <span class="keywordtype">float</span> length = <a class="code" href="../../de/d0f/namespacetca.html#a4f3087743ae6823cd5b6e9ff1a344843">Length</a>(pfp);</div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;    <span class="keywordtype">float</span> mcsmom = 0;</div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;    <span class="keywordtype">float</span> chgrms = 0;</div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;    <span class="keywordtype">float</span> cnt = 0;</div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> tjid : pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">TjIDs</a>) {</div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;      <span class="keyword">auto</span>&amp; tj = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tjid - 1];</div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;      <span class="keywordtype">float</span> el = <a class="code" href="../../de/d0f/namespacetca.html#a905bc8b815c3290a4a79e3c091707736">ElectronLikelihood</a>(slc, tj);</div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;      <span class="keywordflow">if</span> (el &lt;= 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;      mcsmom += <a class="code" href="../../de/d0f/namespacetca.html#a712fa9841aa560d0298a3bd5fda51bb8">MCSMom</a>(slc, tj);</div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;      chgrms += tj.ChgRMS;</div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;      ++cnt;</div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;    } <span class="comment">// tjid</span></div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;    <span class="keywordflow">if</span> (cnt &lt; 2) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;    mcsmom /= cnt;</div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;    chgrms /= cnt;</div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;    <span class="keywordtype">int</span> vote = 0;</div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;    <span class="comment">// call anything longer than 150 cm a muon</span></div>
<div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;    <span class="keywordflow">if</span> (length &gt; 150) vote = 13;</div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;    <span class="comment">// or shorter with low dE/dx and really straight</span></div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;    <span class="keywordflow">if</span> (vote == 0 &amp;&amp; length &gt; 50 &amp;&amp; dEdXAve &lt; 2.5 &amp;&amp; mcsmom &gt; 500) vote = 13;</div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;    <span class="comment">// protons have high dE/dx, high MCSMom and low charge rms</span></div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;    <span class="keywordflow">if</span> (vote == 0 &amp;&amp; dEdXAve &gt; 3.0 &amp;&amp; mcsmom &gt; 200 &amp;&amp; chgrms &lt; 0.4) vote = 2212;</div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;    <span class="comment">// electrons have low MCSMom and large charge RMS</span></div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;    <span class="keywordflow">if</span> (vote == 0 &amp;&amp; mcsmom &lt; 50 &amp;&amp; chgrms &gt; 0.4) vote = 11;</div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;    <span class="keywordflow">return</span> vote;</div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;  } <span class="comment">// PDGCodeVote</span></div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;<span class="comment">  ////////////////////////////////////////////////</span></div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l03396"></a><span class="lineno"><a class="line" href="../../de/d0f/namespacetca.html#a0e6c8605555a6b803b894383785a4cfa"> 3396</a></span>&#160;  <a class="code" href="../../de/d0f/namespacetca.html#a0e6c8605555a6b803b894383785a4cfa">PrintTP3Ds</a>(<a class="code" href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html">detinfo::DetectorClocksData</a> <span class="keyword">const</span>&amp; clockData,</div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;             <a class="code" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> <span class="keyword">const</span>&amp; <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;             std::string someText,</div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;             <span class="keyword">const</span> <a class="code" href="../../db/d39/structtca_1_1TCSlice.html">TCSlice</a>&amp; slc,</div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;             <span class="keyword">const</span> <a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html">PFPStruct</a>&amp; pfp,</div>
<div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;             <span class="keywordtype">short</span> printPts)</div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;  {</div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;    <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;    mf::LogVerbatim myprt(<span class="stringliteral">&quot;TC&quot;</span>);</div>
<div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;    myprt &lt;&lt; someText &lt;&lt; <span class="stringliteral">&quot; pfp P&quot;</span> &lt;&lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a51b8e48c9df5507929ae0b6429cc7494">ID</a> &lt;&lt; <span class="stringliteral">&quot; MVI &quot;</span> &lt;&lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a24c761b3091ff8a756eb3069232466f8">MVI</a>;</div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> tid : pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">TjIDs</a>)</div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;      myprt &lt;&lt; <span class="stringliteral">&quot; T&quot;</span> &lt;&lt; tid;</div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;    myprt &lt;&lt; <span class="stringliteral">&quot; Flags: CanSection? &quot;</span> &lt;&lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1a10329bf0d918d9281fd2740f70db322b">kCanSection</a>];</div>
<div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;    myprt &lt;&lt; <span class="stringliteral">&quot; NeedsUpdate? &quot;</span> &lt;&lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">Flags</a>[<a class="code" href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1a16c8b0d8524fc0914afc3dab9bf89950">kNeedsUpdate</a>];</div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;    myprt &lt;&lt; <span class="stringliteral">&quot; Algs:&quot;</span>;</div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ib = 0; ib &lt; <a class="code" href="../../de/d0f/namespacetca.html#ad0b3c949f5b890ab3eed3f3bd44db51a">pAlgModSize</a>; ++ib) {</div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;      <span class="keywordflow">if</span> (pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a1c332ab959b350e9ca7b37f321fd0849">AlgMod</a>[ib]) myprt &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../de/d0f/namespacetca.html#ab512bf516ece3b4deb7ffded286bf459">AlgBitNames</a>[ib];</div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;    } <span class="comment">// ib</span></div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;    myprt &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;    <span class="keywordflow">if</span> (!pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.empty()) {</div>
<div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;      myprt &lt;&lt; someText</div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;  SFI ________Pos________   ________Dir_______ _____EndPos________ ChiDOF  NPts &quot;</span></div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;               <span class="stringliteral">&quot;NeedsUpdate?\n&quot;</span>;</div>
<div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;      <span class="keywordflow">for</span> (std::size_t sfi = 0; sfi &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>.size(); ++sfi) {</div>
<div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;        myprt &lt;&lt; someText &lt;&lt; std::setw(4) &lt;&lt; sfi;</div>
<div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;        <span class="keyword">auto</span>&amp; sf = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">SectionFits</a>[sfi];</div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;        myprt &lt;&lt; std::fixed &lt;&lt; std::setprecision(1);</div>
<div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> startPt = 0, endPt = 0;</div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../de/d0f/namespacetca.html#af76f13054935a6da9473200ddcecdd74">SectionStartEnd</a>(pfp, sfi, startPt, endPt)) {</div>
<div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;          <span class="keyword">auto</span>&amp; start = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[startPt].Pos;</div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;          myprt &lt;&lt; std::setw(7) &lt;&lt; start[0] &lt;&lt; std::setw(7) &lt;&lt; start[1] &lt;&lt; std::setw(7) &lt;&lt; start[2];</div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;        }</div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;          myprt &lt;&lt; <span class="stringliteral">&quot; Invalid&quot;</span>;</div>
<div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;        }</div>
<div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;        myprt &lt;&lt; std::fixed &lt;&lt; std::setprecision(2);</div>
<div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;        myprt &lt;&lt; std::setw(7) &lt;&lt; sf.Dir[0] &lt;&lt; std::setw(7) &lt;&lt; sf.Dir[1] &lt;&lt; std::setw(7)</div>
<div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;              &lt;&lt; sf.Dir[2];</div>
<div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;        myprt &lt;&lt; std::fixed &lt;&lt; std::setprecision(1);</div>
<div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;        <span class="keywordflow">if</span> (endPt &lt; pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size()) {</div>
<div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;          <span class="keyword">auto</span>&amp; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[endPt].Pos;</div>
<div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;          myprt &lt;&lt; std::setw(7) &lt;&lt; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>[0] &lt;&lt; std::setw(7) &lt;&lt; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>[1] &lt;&lt; std::setw(7) &lt;&lt; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>[2];</div>
<div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;        }</div>
<div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;          myprt &lt;&lt; <span class="stringliteral">&quot; Invalid&quot;</span>;</div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;        }</div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;        myprt &lt;&lt; std::setprecision(1) &lt;&lt; std::setw(6) &lt;&lt; sf.ChiDOF;</div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;        myprt &lt;&lt; std::setw(6) &lt;&lt; sf.NPts;</div>
<div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;        myprt &lt;&lt; std::setw(6) &lt;&lt; sf.NeedsUpdate;</div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;        myprt &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;      } <span class="comment">// sec</span></div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;    }   <span class="comment">// SectionFits</span></div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;    <span class="keywordflow">if</span> (printPts &lt; 0) {</div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;      <span class="comment">// print the head if we print all points</span></div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;      myprt&lt;&lt;someText&lt;&lt;<span class="stringliteral">&quot; Note: GBH = TP3D Flags. G = Good, B = Bad, H = High dE/dx \n&quot;</span>;</div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;      myprt&lt;&lt;someText&lt;&lt;<span class="stringliteral">&quot;  ipt SFI ________Pos________  Delta Pull  GBH   Path  along dE/dx S?    T_ipt_P:W:T\n&quot;</span>;</div>
<div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;    }</div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> fromPt = 0;</div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> toPt = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size() - 1;</div>
<div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;    <span class="keywordflow">if</span> (printPts &gt;= 0) fromPt = toPt;</div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;    <span class="comment">// temp kink angle for each point</span></div>
<div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;    std::vector&lt;float&gt; dang(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>.size(), -1);</div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipt = fromPt; ipt &lt;= toPt; ++ipt) {</div>
<div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;      <span class="keyword">auto</span> tp3d = pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[ipt];</div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;      myprt &lt;&lt; someText &lt;&lt; std::setw(4) &lt;&lt; ipt;</div>
<div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;      myprt &lt;&lt; std::setw(4) &lt;&lt; tp3d.SFIndex;</div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;      myprt &lt;&lt; std::fixed &lt;&lt; std::setprecision(1);</div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;      myprt &lt;&lt; std::setw(7) &lt;&lt; tp3d.Pos[0] &lt;&lt; std::setw(7) &lt;&lt; tp3d.Pos[1] &lt;&lt; std::setw(7)</div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;            &lt;&lt; tp3d.Pos[2];</div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;      myprt &lt;&lt; std::setprecision(1) &lt;&lt; std::setw(6) &lt;&lt; (tp3d.Pos[0] - tp3d.TPX);</div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;      <span class="keywordtype">float</span> pull = <a class="code" href="../../de/d0f/namespacetca.html#a64a1d13b9dd367c5d94e5779daf22626">PointPull</a>(pfp, tp3d);</div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;      myprt &lt;&lt; std::setprecision(1) &lt;&lt; std::setw(6) &lt;&lt; pull;</div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;      myprt &lt;&lt; std::setw(3) &lt;&lt; tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">kTP3DGood</a>] &lt;&lt; tp3d.Flags[<a class="code" href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a088d286995bc5cfcaa1f8f26a78f0a67">kTP3DBad</a>];</div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;      myprt &lt;&lt; std::setw(7) &lt;&lt; std::setprecision(1) &lt;&lt; <a class="code" href="../../de/d0f/namespacetca.html#a2a4c4a32e939554d609ba778be021c6d">PosSep</a>(tp3d.Pos, pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">TP3Ds</a>[0].Pos);</div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;      myprt &lt;&lt; std::setw(7) &lt;&lt; std::setprecision(1) &lt;&lt; tp3d.along;</div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;      myprt &lt;&lt; std::setw(6) &lt;&lt; std::setprecision(2) &lt;&lt; <a class="code" href="../../de/d0f/namespacetca.html#a03d7925cba1cd1c5952d280736887b6b">dEdx</a>(clockData, detProp, slc, tp3d);</div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;      <span class="comment">// print SignalAtTP in each plane</span></div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;      myprt &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> plane = 0; plane &lt; slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">nPlanes</a>; ++plane) {</div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;        <a class="code" href="../../de/d0f/namespacetca.html#a0c55ac735de824c3e089bcbea9addb71">CTP_t</a> inCTP = <a class="code" href="../../de/d0f/namespacetca.html#a8806e1c32119afbfe02dff4c21cf3e57">EncodeCTP</a>(pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a2aeca07e5620225d35f27cdff6cc9048">TPCID</a>.<a class="code" href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">Cryostat</a>, pfp.<a class="code" href="../../dc/d18/structtca_1_1PFPStruct.html#a2aeca07e5620225d35f27cdff6cc9048">TPCID</a>.<a class="code" href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">TPC</a>, plane);</div>
<div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;        <span class="keyword">auto</span> tp = <a class="code" href="../../de/d0f/namespacetca.html#abf31bab3395b5e2325f017d9b7db50db">MakeBareTP</a>(detProp, slc, tp3d.Pos, inCTP);</div>
<div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;        myprt &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../de/d0f/namespacetca.html#af522808f94ccf75807e228fad5f2b5dd">SignalAtTp</a>(tp);</div>
<div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;      } <span class="comment">// plane</span></div>
<div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;      <span class="keywordflow">if</span> (tp3d.TjID &gt; 0) {</div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;        <span class="keyword">auto</span>&amp; tp = slc.<a class="code" href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tjs</a>[tp3d.TjID - 1].Pts[tp3d.TPIndex];</div>
<div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;        myprt &lt;&lt; <span class="stringliteral">&quot; T&quot;</span> &lt;&lt; tp3d.TjID &lt;&lt; <span class="stringliteral">&quot;_&quot;</span> &lt;&lt; tp3d.TPIndex &lt;&lt; <span class="stringliteral">&quot;_&quot;</span> &lt;&lt; <a class="code" href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">PrintPos</a>(slc, tp) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;              &lt;&lt; <a class="code" href="../../de/d0f/namespacetca.html#a27358ac0e27cf12c304dbcc40a851b6d">TPEnvString</a>(tp);</div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;      }</div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;        myprt &lt;&lt; <span class="stringliteral">&quot; UNDEFINED&quot;</span>;</div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;      }</div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;      myprt &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;    } <span class="comment">// ipt</span></div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;  }   <span class="comment">// PrintTP3Ds</span></div>
<div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;} <span class="comment">// namespace</span></div>
<div class="ttc" id="namespacetca_html_a70c266df69c86d3389a40a300c75903aaac214e93104d205b2c02e38d0c318b42"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a70c266df69c86d3389a40a300c75903aaac214e93104d205b2c02e38d0c318b42">tca::kTestBeam</a></div><div class="ttdoc">Expect tracks entering from the front face. Don&amp;#39;t create neutrino PFParticles. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00534">DataStructs.h:534</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a7266fce5bdeb93f175687a0e8b0a50c6"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a7266fce5bdeb93f175687a0e8b0a50c6">tca::TCConfig::caloAlg</a></div><div class="ttdeci">calo::CalorimetryAlg * caloAlg</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00579">DataStructs.h:579</a></div></div>
<div class="ttc" id="classgeo_1_1GeometryCore_html_ae81e63f01473939eb6bc9c2cb5455906"><div class="ttname"><a href="../../d7/d63/classgeo_1_1GeometryCore.html#ae81e63f01473939eb6bc9c2cb5455906">geo::GeometryCore::WireCoordinate</a></div><div class="ttdeci">geo::Length_t WireCoordinate(double YPos, double ZPos, geo::PlaneID const &amp;planeid) const </div><div class="ttdoc">Returns the index of the nearest wire to the specified position. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d6a/GeometryCore_8cxx_source.html#l01128">GeometryCore.cxx:1128</a></div></div>
<div class="ttc" id="namespacetca_html_a4675b8edb6a3ac56f993afda9ccac525ae8d79f565a18dd6877b890fa7cb6616b"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525ae8d79f565a18dd6877b890fa7cb6616b">tca::kEnvOverlap</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00525">DataStructs.h:525</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html_ac1da6ca699e616d576e3bf10c8752b3a"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html#ac1da6ca699e616d576e3bf10c8752b3a">tca::TrajPoint::Dir</a></div><div class="ttdeci">Vector2_t Dir</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00158">DataStructs.h:158</a></div></div>
<div class="ttc" id="namespacetca_html_a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a96110b513466844d3b1ba86339279e9b">tca::kTP3DGood</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00269">DataStructs.h:269</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html_afde15bdbaf154402df2a0572aa425e72"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html#afde15bdbaf154402df2a0572aa425e72">tca::TrajPoint::Pos</a></div><div class="ttdeci">Point2_t Pos</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00157">DataStructs.h:157</a></div></div>
<div class="ttc" id="structtca_1_1SectionFit_html_a94932439cfabd228569ca74229410f96"><div class="ttname"><a href="../../d3/d08/structtca_1_1SectionFit.html#a94932439cfabd228569ca74229410f96">tca::SectionFit::NPts</a></div><div class="ttdeci">unsigned short NPts</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00249">DataStructs.h:249</a></div></div>
<div class="ttc" id="Utils_8cxx_html_a5d68a4eb0beaca553c63e29989a63464"><div class="ttname"><a href="../../de/d78/Utils_8cxx.html#a5d68a4eb0beaca553c63e29989a63464">valsDecreasing</a></div><div class="ttdeci">bool valsDecreasing(const SortEntry &amp;c1, const SortEntry &amp;c2)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l00038">Utils.cxx:38</a></div></div>
<div class="ttc" id="namespacetca_html_a4675b8edb6a3ac56f993afda9ccac525abd1a7e54d914adb492248139662c2729"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525abd1a7e54d914adb492248139662c2729">tca::kEnvNearMuon</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00523">DataStructs.h:523</a></div></div>
<div class="ttc" id="namespacetca_html_aab0c16d5fc835279921b218daaef98e1ae3c02e1143205b4d7a8e93437965aa47"><div class="ttname"><a href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1ae3c02e1143205b4d7a8e93437965aa47">tca::kSmallAngle</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00310">DataStructs.h:310</a></div></div>
<div class="ttc" id="namespacetca_html_a712fa9841aa560d0298a3bd5fda51bb8"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a712fa9841aa560d0298a3bd5fda51bb8">tca::MCSMom</a></div><div class="ttdeci">short MCSMom(const TCSlice &amp;slc, const std::vector&lt; int &gt; &amp;tjIDs)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l03466">Utils.cxx:3466</a></div></div>
<div class="ttc" id="run__opflash__electron_8fcl_html_ae40184b0245025a43c56daa3261d5e3c"><div class="ttname"><a href="../../d0/d84/run__opflash__electron_8fcl.html#ae40184b0245025a43c56daa3261d5e3c">z</a></div><div class="ttdeci">process_name opflash particleana ie ie ie z</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d84/run__opflash__electron_8fcl_source.html#l00092">run_opflash_electron.fcl:92</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5da71fb719dbe626b8badbe67cc4793228b"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da71fb719dbe626b8badbe67cc4793228b">tca::kFillGaps3D</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00429">DataStructs.h:429</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_a60e2156629808a2e1178bd6cc1234c59"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#a60e2156629808a2e1178bd6cc1234c59">tca::TCSlice::tjs</a></div><div class="ttdeci">std::vector&lt; Trajectory &gt; tjs</div><div class="ttdoc">vector of all trajectories in each plane </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00672">DataStructs.h:672</a></div></div>
<div class="ttc" id="namespacetca_html_ae5fbafb8d23680635343a083b8fd7b11"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ae5fbafb8d23680635343a083b8fd7b11">tca::Recover</a></div><div class="ttdeci">void Recover(detinfo::DetectorClocksData const &amp;clockData, detinfo::DetectorPropertiesData const &amp;detProp, TCSlice &amp;slc, PFPStruct &amp;pfp, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02088">PFPUtils.cxx:2088</a></div></div>
<div class="ttc" id="namespacetca_html_a56bf7b0d45925f907c89dfdab97f2ed5"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a56bf7b0d45925f907c89dfdab97f2ed5">tca::FarEnd</a></div><div class="ttdeci">unsigned short FarEnd(const TCSlice &amp;slc, const PFPStruct &amp;pfp, const Point3_t &amp;pos)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l03338">PFPUtils.cxx:3338</a></div></div>
<div class="ttc" id="namespacetca_html_a4f3087743ae6823cd5b6e9ff1a344843"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a4f3087743ae6823cd5b6e9ff1a344843">tca::Length</a></div><div class="ttdeci">float Length(const PFPStruct &amp;pfp)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l03303">PFPUtils.cxx:3303</a></div></div>
<div class="ttc" id="structtca_1_1TP3D_html_a0598b7e6a7bf0fbf9bbd2d7d2173dbfb"><div class="ttname"><a href="../../d5/db8/structtca_1_1TP3D.html#a0598b7e6a7bf0fbf9bbd2d7d2173dbfb">tca::TP3D::Wire</a></div><div class="ttdeci">float Wire</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00259">DataStructs.h:259</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a1bb1637ab9a45e1c90d10ec06a33c64f"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a1bb1637ab9a45e1c90d10ec06a33c64f">tca::TCConfig::dbgStitch</a></div><div class="ttdeci">bool dbgStitch</div><div class="ttdoc">debug PFParticle stitching </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00605">DataStructs.h:605</a></div></div>
<div class="ttc" id="namespacetca_html_acc69bee8429400e1b6a273648829ea88"><div class="ttname"><a href="../../de/d0f/namespacetca.html#acc69bee8429400e1b6a273648829ea88">tca::Average_dEdX</a></div><div class="ttdeci">void Average_dEdX(detinfo::DetectorClocksData const &amp;clockData, detinfo::DetectorPropertiesData const &amp;detProp, const TCSlice &amp;slc, PFPStruct &amp;pfp, float &amp;dEdXAve, float &amp;dEdXRms)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02649">PFPUtils.cxx:2649</a></div></div>
<div class="ttc" id="namespacetca_html_a3e6119785d4f3a3cf416b16089b50099"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a3e6119785d4f3a3cf416b16089b50099">tca::MakePFParticles</a></div><div class="ttdeci">void MakePFParticles(detinfo::DetectorClocksData const &amp;clockData, detinfo::DetectorPropertiesData const &amp;detProp, TCSlice &amp;slc, std::vector&lt; MatchStruct &gt; matVec, unsigned short matVec_Iter)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l00267">PFPUtils.cxx:267</a></div></div>
<div class="ttc" id="structtca_1_1PFPStruct_html_a8a39d1be09f8e3dd6f5b7a2cd8c933be"><div class="ttname"><a href="../../dc/d18/structtca_1_1PFPStruct.html#a8a39d1be09f8e3dd6f5b7a2cd8c933be">tca::PFPStruct::dEdxErr</a></div><div class="ttdeci">std::array&lt; std::vector&lt; float &gt;, 2 &gt; dEdxErr</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00291">DataStructs.h:291</a></div></div>
<div class="ttc" id="neoSmazza_8sh_html_ae55989c903f0c76190facfb5e5211732"><div class="ttname"><a href="../../de/d71/neoSmazza_8sh.html#ae55989c903f0c76190facfb5e5211732">if</a></div><div class="ttdeci">then if[[&quot;$THISISATEST&quot;==1]]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d71/neoSmazza_8sh_source.html#l00095">neoSmazza.sh:95</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5da2a2fbf12f53411c1338f1cf546b62cc3"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da2a2fbf12f53411c1338f1cf546b62cc3">tca::kJunk3D</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00432">DataStructs.h:432</a></div></div>
<div class="ttc" id="namespacetca_html_a8c30c9aeaab0a0b4f0f9d1f08fad6c6aaf48aae9eb0d23a230ca10aeceb9411f8"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aaf48aae9eb0d23a230ca10aeceb9411f8">tca::kOutFV</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00515">DataStructs.h:515</a></div></div>
<div class="ttc" id="namespacetca_html_aba6e9ff2e76ddbc58d971f61b9897ca8"><div class="ttname"><a href="../../de/d0f/namespacetca.html#aba6e9ff2e76ddbc58d971f61b9897ca8">tca::MakeVertexObsolete</a></div><div class="ttdeci">bool MakeVertexObsolete(std::string fcnLabel, TCSlice &amp;slc, VtxStore &amp;vx2, bool forceKill)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dfc/TCVertex_8cxx_source.html#l02740">TCVertex.cxx:2740</a></div></div>
<div class="ttc" id="structtca_1_1TCWireIntersection_html_a005149ac7ffe574c4a218fc2f001ead7"><div class="ttname"><a href="../../d7/de3/structtca_1_1TCWireIntersection.html#a005149ac7ffe574c4a218fc2f001ead7">tca::TCWireIntersection::wir2</a></div><div class="ttdeci">float wir2</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00129">DataStructs.h:129</a></div></div>
<div class="ttc" id="structtca_1_1TP3D_html_ab6cea7b9a15237b36cd057f43aab4d89"><div class="ttname"><a href="../../d5/db8/structtca_1_1TP3D.html#ab6cea7b9a15237b36cd057f43aab4d89">tca::TP3D::TjID</a></div><div class="ttdeci">int TjID</div><div class="ttdoc">ID of the trajectory -&amp;gt; TP3D assn. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00261">DataStructs.h:261</a></div></div>
<div class="ttc" id="namespacetca_html_aed0952f85d1f09fdc3802b2eb1cb8d07"><div class="ttname"><a href="../../de/d0f/namespacetca.html#aed0952f85d1f09fdc3802b2eb1cb8d07">tca::ReconcileTPs</a></div><div class="ttdeci">bool ReconcileTPs(TCSlice &amp;slc, PFPStruct &amp;pfp, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l00426">PFPUtils.cxx:426</a></div></div>
<div class="ttc" id="structtca_1_1PFPStruct_html_aa91baa15ce1608cf939fdcba32bf970b"><div class="ttname"><a href="../../dc/d18/structtca_1_1PFPStruct.html#aa91baa15ce1608cf939fdcba32bf970b">tca::PFPStruct::PDGCode</a></div><div class="ttdeci">int PDGCode</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00294">DataStructs.h:294</a></div></div>
<div class="ttc" id="classgeo_1_1GeometryCore_html_a93b943c9a953f5b98e166cd21865ad4d"><div class="ttname"><a href="../../d7/d63/classgeo_1_1GeometryCore.html#a93b943c9a953f5b98e166cd21865ad4d">geo::GeometryCore::Plane</a></div><div class="ttdeci">PlaneGeo const &amp; Plane(unsigned int const p, unsigned int const tpc=0, unsigned int const cstat=0) const </div><div class="ttdoc">Returns the specified wire. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de7/GeometryCore_8h_source.html#l02994">GeometryCore.h:2994</a></div></div>
<div class="ttc" id="structtca_1_1Vtx3Store_html_a731551f16bbbc1e75e48e55e6356014b"><div class="ttname"><a href="../../d2/d05/structtca_1_1Vtx3Store.html#a731551f16bbbc1e75e48e55e6356014b">tca::Vtx3Store::Score</a></div><div class="ttdeci">float Score</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00113">DataStructs.h:113</a></div></div>
<div class="ttc" id="classgeo_1_1GeometryCore_html_a93c0f3e32739f934854e649c1ab980c1"><div class="ttname"><a href="../../d7/d63/classgeo_1_1GeometryCore.html#a93c0f3e32739f934854e649c1ab980c1">geo::GeometryCore::DetHalfWidth</a></div><div class="ttdeci">geo::Length_t DetHalfWidth(geo::TPCID const &amp;tpcid) const </div><div class="ttdoc">Returns the half width of the active volume of the specified TPC. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d6a/GeometryCore_8cxx_source.html#l00752">GeometryCore.cxx:752</a></div></div>
<div class="ttc" id="structtca_1_1Tj2Pt_html"><div class="ttname"><a href="../../dc/d80/structtca_1_1Tj2Pt.html">tca::Tj2Pt</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00141">DataStructs.h:141</a></div></div>
<div class="ttc" id="structtca_1_1SectionFit_html_ad078b391ff1c4c117fc7ba50c1f26d85"><div class="ttname"><a href="../../d3/d08/structtca_1_1SectionFit.html#ad078b391ff1c4c117fc7ba50c1f26d85">tca::SectionFit::ChiDOF</a></div><div class="ttdeci">float ChiDOF</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00248">DataStructs.h:248</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_a33a2deade219f3af4666c23d0979532f"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#a33a2deade219f3af4666c23d0979532f">tca::TCSlice::yLo</a></div><div class="ttdeci">float yLo</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00660">DataStructs.h:660</a></div></div>
<div class="ttc" id="namespacetca_html_a58cf1f10cbe4f065ed07eaaef9d3bb2e"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a58cf1f10cbe4f065ed07eaaef9d3bb2e">tca::InsideFV</a></div><div class="ttdeci">bool InsideFV(const TCSlice &amp;slc, const PFPStruct &amp;pfp, unsigned short end)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l03044">PFPUtils.cxx:3044</a></div></div>
<div class="ttc" id="namespacetca_html_afac6aad0fd573134e07bd1e783b8853f"><div class="ttname"><a href="../../de/d0f/namespacetca.html#afac6aad0fd573134e07bd1e783b8853f">tca::CloseEnd</a></div><div class="ttdeci">unsigned short CloseEnd(const TCSlice &amp;slc, const Trajectory &amp;tj, const Point2_t &amp;pos)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l02549">Utils.cxx:2549</a></div></div>
<div class="ttc" id="namespacetca_html_a6c5dfbe1dbd5f82afa300019bfdf6d3d"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a6c5dfbe1dbd5f82afa300019bfdf6d3d">tca::GetAssns</a></div><div class="ttdeci">std::vector&lt; int &gt; GetAssns(TCSlice &amp;slc, std::string type1Name, int id, std::string type2Name)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l04847">Utils.cxx:4847</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_a549de1ce766114d70f6c8c9086be31a2"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#a549de1ce766114d70f6c8c9086be31a2">tca::TCSlice::xHi</a></div><div class="ttdeci">float xHi</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00659">DataStructs.h:659</a></div></div>
<div class="ttc" id="structtca_1_1DebugStuff_html_ac901269c4139df49416940f02fe60410"><div class="ttname"><a href="../../d8/de4/structtca_1_1DebugStuff.html#ac901269c4139df49416940f02fe60410">tca::DebugStuff::Slice</a></div><div class="ttdeci">int Slice</div><div class="ttdef"><b>Definition:</b> <a href="../../da/db2/DebugStruct_8h_source.html#l00030">DebugStruct.h:30</a></div></div>
<div class="ttc" id="namespaceevd_html_ae132a6902afa384d1ed56b6e77b17e79"><div class="ttname"><a href="../../da/d2d/namespaceevd.html#ae132a6902afa384d1ed56b6e77b17e79">evd::kWire</a></div><div class="ttdeci">static unsigned int kWire</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d9c/TWQMultiTPCProjection_8cxx_source.html#l00045">TWQMultiTPCProjection.cxx:45</a></div></div>
<div class="ttc" id="namespacetca_html_ab512bf516ece3b4deb7ffded286bf459"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ab512bf516ece3b4deb7ffded286bf459">tca::AlgBitNames</a></div><div class="ttdeci">const std::vector&lt; std::string &gt; AlgBitNames</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/DataStructs_8cxx_source.html#l00015">DataStructs.cxx:15</a></div></div>
<div class="ttc" id="namespacetca_html_a3075ef4d0b2a15d016f66c3fbf2a8aac"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a3075ef4d0b2a15d016f66c3fbf2a8aac">tca::SetSection</a></div><div class="ttdeci">bool SetSection(detinfo::DetectorPropertiesData const &amp;detProp, const TCSlice &amp;slc, PFPStruct &amp;pfp, TP3D &amp;tp3d)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02769">PFPUtils.cxx:2769</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html_a00fdf2d73e4a03e5a7f32411e460ba2e"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html#a00fdf2d73e4a03e5a7f32411e460ba2e">tca::TrajPoint::CTP</a></div><div class="ttdeci">CTP_t CTP</div><div class="ttdoc">Cryostat, TPC, Plane code. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00155">DataStructs.h:155</a></div></div>
<div class="ttc" id="run__opflash__electron_8fcl_html_a6673f03521899f7844189bcfd8ee5941"><div class="ttname"><a href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a></div><div class="ttdeci">process_name opflash particleana ie x</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d84/run__opflash__electron_8fcl_source.html#l00090">run_opflash_electron.fcl:90</a></div></div>
<div class="ttc" id="namespacetca_html_a7f663b1f0cd693167cdf6aa76532b4d3"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a7f663b1f0cd693167cdf6aa76532b4d3">tca::InsideTPC</a></div><div class="ttdeci">bool InsideTPC(const Point3_t &amp;pos, geo::TPCID &amp;inTPCID)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l03071">PFPUtils.cxx:3071</a></div></div>
<div class="ttc" id="namespacetca_html_a1cdc8b856f66405da72b57312a048162"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a1cdc8b856f66405da72b57312a048162">tca::Point3_t</a></div><div class="ttdeci">std::array&lt; double, 3 &gt; Point3_t</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00043">DataStructs.h:43</a></div></div>
<div class="ttc" id="namespacetca_html_af522808f94ccf75807e228fad5f2b5dd"><div class="ttname"><a href="../../de/d0f/namespacetca.html#af522808f94ccf75807e228fad5f2b5dd">tca::SignalAtTp</a></div><div class="ttdeci">bool SignalAtTp(TrajPoint &amp;tp)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l02002">Utils.cxx:2002</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a967d80bf479e4bbcc0c0d1ad76c707d5"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a967d80bf479e4bbcc0c0d1ad76c707d5">tca::TCConfig::vtx3DCuts</a></div><div class="ttdeci">std::vector&lt; float &gt; vtx3DCuts</div><div class="ttdoc">2D vtx -&amp;gt; 3D vtx matching cuts </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00553">DataStructs.h:553</a></div></div>
<div class="ttc" id="structtca_1_1SortEntry_html_a3123e86741ba9a186788806f18c0dc1f"><div class="ttname"><a href="../../db/d7d/structtca_1_1SortEntry.html#a3123e86741ba9a186788806f18c0dc1f">tca::SortEntry::val</a></div><div class="ttdeci">float val</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dfc/TCVertex_8cxx_source.html#l00029">TCVertex.cxx:29</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_a00ae051924d45128505ddc9e15f69c8d"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#a00ae051924d45128505ddc9e15f69c8d">tca::TCSlice::zHi</a></div><div class="ttdeci">float zHi</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00663">DataStructs.h:663</a></div></div>
<div class="ttc" id="namespacechannelDBConverter_html_af481fa22253619167bce75a37e10ec34"><div class="ttname"><a href="../../d4/d43/namespacechannelDBConverter.html#af481fa22253619167bce75a37e10ec34">channelDBConverter.first</a></div><div class="ttdeci">first</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d11/channelDBConverter_8py_source.html#l00146">channelDBConverter.py:146</a></div></div>
<div class="ttc" id="namespacetca_html_a881a9f856411db2bb90b1964068712f5"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a881a9f856411db2bb90b1964068712f5">tca::SortSection</a></div><div class="ttdeci">bool SortSection(PFPStruct &amp;pfp, unsigned short sfIndex)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02027">PFPUtils.cxx:2027</a></div></div>
<div class="ttc" id="namespacetca_html_a77e8e06b3f8b7cc168c473ad6c7de70a"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a77e8e06b3f8b7cc168c473ad6c7de70a">tca::tcc</a></div><div class="ttdeci">TCConfig tcc</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/DataStructs_8cxx_source.html#l00008">DataStructs.cxx:8</a></div></div>
<div class="ttc" id="structtca_1_1PFPStruct_html_a51b8e48c9df5507929ae0b6429cc7494"><div class="ttname"><a href="../../dc/d18/structtca_1_1PFPStruct.html#a51b8e48c9df5507929ae0b6429cc7494">tca::PFPStruct::ID</a></div><div class="ttdeci">int ID</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00299">DataStructs.h:299</a></div></div>
<div class="ttc" id="structtca_1_1Tj2Pt_html_a76bc10ca4c618ded5195f4b2f5d118ce"><div class="ttname"><a href="../../dc/d80/structtca_1_1Tj2Pt.html#a76bc10ca4c618ded5195f4b2f5d118ce">tca::Tj2Pt::id</a></div><div class="ttdeci">unsigned short id</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00148">DataStructs.h:148</a></div></div>
<div class="ttc" id="Utils_8cxx_html_afccaa2d84568990e3eee99667f6896f4"><div class="ttname"><a href="../../de/d78/Utils_8cxx.html#afccaa2d84568990e3eee99667f6896f4">valsIncreasing</a></div><div class="ttdeci">bool valsIncreasing(const SortEntry &amp;c1, const SortEntry &amp;c2)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l00039">Utils.cxx:39</a></div></div>
<div class="ttc" id="larreco_2larreco_2RecoAlg_2TCAlg_2Utils_8h_html"><div class="ttname"><a href="../../db/d0a/larreco_2larreco_2RecoAlg_2TCAlg_2Utils_8h.html">Utils.h</a></div></div>
<div class="ttc" id="namespacetca_html_ac9a7192422bb8f4f56944923ff22b9f0"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ac9a7192422bb8f4f56944923ff22b9f0">tca::Reverse</a></div><div class="ttdeci">void Reverse(TCSlice &amp;slc, PFPStruct &amp;pfp)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02359">PFPUtils.cxx:2359</a></div></div>
<div class="ttc" id="structtca_1_1Vtx3Store_html_a640bed614f7afb427cb1ce319ca2ae6b"><div class="ttname"><a href="../../d2/d05/structtca_1_1Vtx3Store.html#a640bed614f7afb427cb1ce319ca2ae6b">tca::Vtx3Store::X</a></div><div class="ttdeci">float X</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00107">DataStructs.h:107</a></div></div>
<div class="ttc" id="structtca_1_1Vtx3Store_html_aa7c85bb03367fc57566553163a3492db"><div class="ttname"><a href="../../d2/d05/structtca_1_1Vtx3Store.html#aa7c85bb03367fc57566553163a3492db">tca::Vtx3Store::Primary</a></div><div class="ttdeci">bool Primary</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00119">DataStructs.h:119</a></div></div>
<div class="ttc" id="Hit_8h_html"><div class="ttname"><a href="../../de/d26/Hit_8h.html">Hit.h</a></div><div class="ttdoc">Declaration of signal hit object. </div></div>
<div class="ttc" id="namespacetca_html_a55899e64c6307177d1599f26a0a255a6"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a55899e64c6307177d1599f26a0a255a6">tca::FindAlongTrans</a></div><div class="ttdeci">void FindAlongTrans(Point3_t pos1, Vector3_t dir1, Point3_t pos2, Point2_t &amp;alongTrans)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l03096">PFPUtils.cxx:3096</a></div></div>
<div class="ttc" id="classdetinfo_1_1DetectorPropertiesData_html"><div class="ttname"><a href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7a/DetectorPropertiesData_8h_source.html#l00011">DetectorPropertiesData.h:11</a></div></div>
<div class="ttc" id="structtca_1_1PFPStruct_html_a1c332ab959b350e9ca7b37f321fd0849"><div class="ttname"><a href="../../dc/d18/structtca_1_1PFPStruct.html#a1c332ab959b350e9ca7b37f321fd0849">tca::PFPStruct::AlgMod</a></div><div class="ttdeci">std::bitset&lt; pAlgModSize &gt; AlgMod</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00304">DataStructs.h:304</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_a95f7fcb13cb06c827c69fc2fd301f1c0"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#a95f7fcb13cb06c827c69fc2fd301f1c0">tca::TCSlice::wireHitRange</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; std::pair&lt; unsigned int, unsigned int &gt; &gt; &gt; wireHitRange</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00677">DataStructs.h:677</a></div></div>
<div class="ttc" id="structtca_1_1Vtx3Store_html_a9471a42a7a11d12130d48cf2e2795966"><div class="ttname"><a href="../../d2/d05/structtca_1_1Vtx3Store.html#a9471a42a7a11d12130d48cf2e2795966">tca::Vtx3Store::Vx2ID</a></div><div class="ttdeci">std::vector&lt; int &gt; Vx2ID</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00116">DataStructs.h:116</a></div></div>
<div class="ttc" id="structgeo_1_1PlaneID_html"><div class="ttname"><a href="../../d4/d41/structgeo_1_1PlaneID.html">geo::PlaneID</a></div><div class="ttdoc">The data type to uniquely identify a Plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00472">geo_types.h:472</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html">geo::TPCGeo</a></div><div class="ttdoc">Geometry information for a single TPC. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00038">TPCGeo.h:38</a></div></div>
<div class="ttc" id="structtca_1_1SectionFit_html_a05413670eb1df940120611f13a87f46e"><div class="ttname"><a href="../../d3/d08/structtca_1_1SectionFit.html#a05413670eb1df940120611f13a87f46e">tca::SectionFit::Pos</a></div><div class="ttdeci">Point3_t Pos</div><div class="ttdoc">center position of this section </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00245">DataStructs.h:245</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_a715dd4b152144579ecdd77dea07d0735"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#a715dd4b152144579ecdd77dea07d0735">tca::TCSlice::xLo</a></div><div class="ttdeci">float xLo</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00658">DataStructs.h:658</a></div></div>
<div class="ttc" id="namespacetca_html_a600e672c966d327de25fc13318997550"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a600e672c966d327de25fc13318997550">tca::StoreTraj</a></div><div class="ttdeci">bool StoreTraj(TCSlice &amp;slc, Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l01087">Utils.cxx:1087</a></div></div>
<div class="ttc" id="namespacetca_html_a17cc6e2a5aac0f63dfa941aced04b68a"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a17cc6e2a5aac0f63dfa941aced04b68a">tca::LineLineIntersect</a></div><div class="ttdeci">bool LineLineIntersect(Point3_t p1, Point3_t p2, Point3_t p3, Point3_t p4, Point3_t &amp;intersect, float &amp;doca)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l03132">PFPUtils.cxx:3132</a></div></div>
<div class="ttc" id="structtca_1_1SortEntry_html_a69837f74a6dc268fde50066fd818b886"><div class="ttname"><a href="../../db/d7d/structtca_1_1SortEntry.html#a69837f74a6dc268fde50066fd818b886">tca::SortEntry::index</a></div><div class="ttdeci">unsigned int index</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dfc/TCVertex_8cxx_source.html#l00028">TCVertex.cxx:28</a></div></div>
<div class="ttc" id="namespacetca_html_ad2846a0d8353a032d65f633f7c2e0267"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ad2846a0d8353a032d65f633f7c2e0267">tca::PrintPos</a></div><div class="ttdeci">std::string PrintPos(const TCSlice &amp;slc, const TrajPoint &amp;tp)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l06524">Utils.cxx:6524</a></div></div>
<div class="ttc" id="structgeo_1_1CryostatID_html_a2bfb744818e075d94be15dd18c950441"><div class="ttname"><a href="../../d9/d73/structgeo_1_1CryostatID.html#a2bfb744818e075d94be15dd18c950441">geo::CryostatID::Cryostat</a></div><div class="ttdeci">CryostatID_t Cryostat</div><div class="ttdoc">Index of cryostat. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00212">geo_types.h:212</a></div></div>
<div class="ttc" id="namespacetca_html_aab0c16d5fc835279921b218daaef98e1a16c8b0d8524fc0914afc3dab9bf89950"><div class="ttname"><a href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1a16c8b0d8524fc0914afc3dab9bf89950">tca::kNeedsUpdate</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00309">DataStructs.h:309</a></div></div>
<div class="ttc" id="namespacetca_html_a4675b8edb6a3ac56f993afda9ccac525a6ed9c1ffc232022aa71db806f25ab10d"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a4675b8edb6a3ac56f993afda9ccac525a6ed9c1ffc232022aa71db806f25ab10d">tca::kEnvNotGoodWire</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00522">DataStructs.h:522</a></div></div>
<div class="ttc" id="namespaceevd_html_a2f1ff861ce88c5c738b574adcf2afb3a"><div class="ttname"><a href="../../da/d2d/namespaceevd.html#a2f1ff861ce88c5c738b574adcf2afb3a">evd::kPlane</a></div><div class="ttdeci">static unsigned int kPlane</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d9c/TWQMultiTPCProjection_8cxx_source.html#l00044">TWQMultiTPCProjection.cxx:44</a></div></div>
<div class="ttc" id="namespacetca_html_adfeb5a1922b44080a785a41b47ef1fc7"><div class="ttname"><a href="../../de/d0f/namespacetca.html#adfeb5a1922b44080a785a41b47ef1fc7">tca::SetAngleCode</a></div><div class="ttdeci">void SetAngleCode(TrajPoint &amp;tp)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l00771">Utils.cxx:771</a></div></div>
<div class="ttc" id="namespacetca_html_a3645ee44c37f63a286b5ad8b95ff786e"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a3645ee44c37f63a286b5ad8b95ff786e">tca::PrintP</a></div><div class="ttdeci">void PrintP(std::string someText, mf::LogVerbatim &amp;myprt, PFPStruct &amp;pfp, bool &amp;printHeader)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l05603">Utils.cxx:5603</a></div></div>
<div class="ttc" id="namespacetca_html_a3bdf0e86f5c07dbf127ee66d6fbbd2e4"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a3bdf0e86f5c07dbf127ee66d6fbbd2e4">tca::CreatePFP</a></div><div class="ttdeci">PFPStruct CreatePFP(const TCSlice &amp;slc)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02823">PFPUtils.cxx:2823</a></div></div>
<div class="ttc" id="rawtorootconvert_8fcl_html_a073d3febd81cab639f2a8aa357dc5ef1"><div class="ttname"><a href="../../d4/d3a/rawtorootconvert_8fcl.html#a073d3febd81cab639f2a8aa357dc5ef1">E</a></div><div class="ttdeci">process_name E</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d3a/rawtorootconvert_8fcl_source.html#l00026">rawtorootconvert.fcl:26</a></div></div>
<div class="ttc" id="namespacetca_html_a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa8a209073700148c7515fa38bae5e2873"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a8c30c9aeaab0a0b4f0f9d1f08fad6c6aa8a209073700148c7515fa38bae5e2873">tca::kAtKink</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00511">DataStructs.h:511</a></div></div>
<div class="ttc" id="namespacetca_html_a42ad47f82498fce46d8feb62864d7d08"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a42ad47f82498fce46d8feb62864d7d08">tca::PosAtEnd</a></div><div class="ttdeci">Point3_t PosAtEnd(const PFPStruct &amp;pfp, unsigned short end)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l03292">PFPUtils.cxx:3292</a></div></div>
<div class="ttc" id="structgeo_1_1WireID_html"><div class="ttname"><a href="../../de/db1/structgeo_1_1WireID.html">geo::WireID</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00560">geo_types.h:560</a></div></div>
<div class="ttc" id="namespacetca_html_a3817156934849ad2042f29fcd347c466"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a3817156934849ad2042f29fcd347c466">tca::DeltaAngle</a></div><div class="ttdeci">double DeltaAngle(const Vector3_t v1, const Vector3_t v2)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02539">PFPUtils.cxx:2539</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a13a021fd1f351b551124f4b7f8cef937"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a13a021fd1f351b551124f4b7f8cef937">tca::TCConfig::dbgSlc</a></div><div class="ttdeci">bool dbgSlc</div><div class="ttdoc">debug only in the user-defined slice? default is all slices </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00592">DataStructs.h:592</a></div></div>
<div class="ttc" id="cheaterreco_8fcl_html_abf2e819dbf4c327e098bebd4b2dc0597"><div class="ttname"><a href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a></div><div class="ttdeci">process_name hit</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d36/cheaterreco_8fcl_source.html#l00051">cheaterreco.fcl:51</a></div></div>
<div class="ttc" id="namespacetca_html_a1faf6b0cb0d56d4a3658bb611b4774e8"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a1faf6b0cb0d56d4a3658bb611b4774e8">tca::Match2Planes</a></div><div class="ttdeci">void Match2Planes(TCSlice &amp;slc, std::vector&lt; MatchStruct &gt; &amp;matVec)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l00944">PFPUtils.cxx:944</a></div></div>
<div class="ttc" id="namespacetca_html_a2132931ff530dd0e4eccfbe863c2f764"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a2132931ff530dd0e4eccfbe863c2f764">tca::CanSection</a></div><div class="ttdeci">bool CanSection(const TCSlice &amp;slc, const PFPStruct &amp;pfp)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l01342">PFPUtils.cxx:1342</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_aec895e58be3fe5a64a2a2418f0e473c7"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#aec895e58be3fe5a64a2a2418f0e473c7">tca::TCConfig::dbgPFP</a></div><div class="ttdeci">bool dbgPFP</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00600">DataStructs.h:600</a></div></div>
<div class="ttc" id="structtca_1_1PFPStruct_html_aabf1e43ae7c3343a2b49d36bd2fe63ba"><div class="ttname"><a href="../../dc/d18/structtca_1_1PFPStruct.html#aabf1e43ae7c3343a2b49d36bd2fe63ba">tca::PFPStruct::Vx3ID</a></div><div class="ttdeci">std::array&lt; int, 2 &gt; Vx3ID</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00292">DataStructs.h:292</a></div></div>
<div class="ttc" id="namespacetca_html_a77d8f2935484535790a3f875c3fe58a3"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a77d8f2935484535790a3f875c3fe58a3">tca::TPHitsRMSTime</a></div><div class="ttdeci">float TPHitsRMSTime(const TCSlice &amp;slc, const TrajPoint &amp;tp, HitStatus_t hitRequest)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l04200">Utils.cxx:4200</a></div></div>
<div class="ttc" id="structtca_1_1DebugStuff_html_a65233ccccd21a4284acdb6249369473c"><div class="ttname"><a href="../../d8/de4/structtca_1_1DebugStuff.html#a65233ccccd21a4284acdb6249369473c">tca::DebugStuff::MVI</a></div><div class="ttdeci">unsigned int MVI</div><div class="ttdoc">MatchVec Index for detailed 3D matching. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/db2/DebugStruct_8h_source.html#l00028">DebugStruct.h:28</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_a2aab614bb8eea5ec2b9a98b0202683dd"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#a2aab614bb8eea5ec2b9a98b0202683dd">tca::TCSlice::isValid</a></div><div class="ttdeci">bool isValid</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00685">DataStructs.h:685</a></div></div>
<div class="ttc" id="namespacetca_html_a773c4a508e9fb45850f211b5a9743b7f"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a773c4a508e9fb45850f211b5a9743b7f">tca::IsShowerLike</a></div><div class="ttdeci">bool IsShowerLike(TCSlice &amp;slc, const std::vector&lt; int &gt; TjIDs)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da1/TCShower_8cxx_source.html#l01907">TCShower.cxx:1907</a></div></div>
<div class="ttc" id="namespacetca_html_a755bdf394aea4c92dcbf935a7d7b2c7a"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a755bdf394aea4c92dcbf935a7d7b2c7a">tca::FilldEdx</a></div><div class="ttdeci">void FilldEdx(detinfo::DetectorClocksData const &amp;clockData, detinfo::DetectorPropertiesData const &amp;detProp, const TCSlice &amp;slc, PFPStruct &amp;pfp)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02596">PFPUtils.cxx:2596</a></div></div>
<div class="ttc" id="namespacetca_html_ae8eec67647640ee5f3c0eaf79ebcc127"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ae8eec67647640ee5f3c0eaf79ebcc127">tca::ReconcileVertices</a></div><div class="ttdeci">void ReconcileVertices(TCSlice &amp;slc, PFPStruct &amp;pfp, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l01649">PFPUtils.cxx:1649</a></div></div>
<div class="ttc" id="namespacetca_html_a27358ac0e27cf12c304dbcc40a851b6d"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a27358ac0e27cf12c304dbcc40a851b6d">tca::TPEnvString</a></div><div class="ttdeci">std::string TPEnvString(const TrajPoint &amp;tp)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l06351">Utils.cxx:6351</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5da1e4c8050e6f935aba51dcbe709012358"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da1e4c8050e6f935aba51dcbe709012358">tca::kHaloTj</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00471">DataStructs.h:471</a></div></div>
<div class="ttc" id="classgeo_1_1GeometryCore_html_a608b6838f7d8b7be32ea8fca24a7ff32"><div class="ttname"><a href="../../d7/d63/classgeo_1_1GeometryCore.html#a608b6838f7d8b7be32ea8fca24a7ff32">geo::GeometryCore::WirePitch</a></div><div class="ttdeci">geo::Length_t WirePitch(geo::PlaneID const &amp;planeid) const </div><div class="ttdoc">Returns the distance between two consecutive wires. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d6a/GeometryCore_8cxx_source.html#l00824">GeometryCore.cxx:824</a></div></div>
<div class="ttc" id="structtca_1_1TCEvent_html_a022c77c19ed66a47e54dd705a6fc840d"><div class="ttname"><a href="../../d0/d2f/structtca_1_1TCEvent.html#a022c77c19ed66a47e54dd705a6fc840d">tca::TCEvent::sptHits</a></div><div class="ttdeci">std::vector&lt; std::array&lt; unsigned int, 3 &gt; &gt; sptHits</div><div class="ttdoc">SpacePoint -&amp;gt; Hits assns by plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00635">DataStructs.h:635</a></div></div>
<div class="ttc" id="sbnd__flashalgo_8fcl_html_a648c7afac4085c93cd1ba4a75dfe8818"><div class="ttname"><a href="../../d4/d22/sbnd__flashalgo_8fcl.html#a648c7afac4085c93cd1ba4a75dfe8818">TPC</a></div><div class="ttdeci">BEGIN_PROLOG TPC</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d22/sbnd__flashalgo_8fcl_source.html#l00014">sbnd_flashalgo.fcl:14</a></div></div>
<div class="ttc" id="classgeo_1_1GeometryCore_html_a4dbfc785eaf3524798bb01407edc52b5"><div class="ttname"><a href="../../d7/d63/classgeo_1_1GeometryCore.html#a4dbfc785eaf3524798bb01407edc52b5">geo::GeometryCore::IterateTPCIDs</a></div><div class="ttdeci">IteratorBox&lt; TPC_id_iterator,&amp;GeometryCore::begin_TPC_id,&amp;GeometryCore::end_TPC_id &gt; IterateTPCIDs() const </div><div class="ttdoc">Enables ranged-for loops on all TPC IDs of the detector. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de7/GeometryCore_8h_source.html#l02597">GeometryCore.h:2597</a></div></div>
<div class="ttc" id="namespacetca_html_a2f935445887380c41861a5874f80ad84"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a2f935445887380c41861a5874f80ad84">tca::MaxTjLen</a></div><div class="ttdeci">float MaxTjLen(const TCSlice &amp;slc, std::vector&lt; int &gt; &amp;tjIDs)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l02628">Utils.cxx:2628</a></div></div>
<div class="ttc" id="structtca_1_1TP3D_html"><div class="ttname"><a href="../../d5/db8/structtca_1_1TP3D.html">tca::TP3D</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00254">DataStructs.h:254</a></div></div>
<div class="ttc" id="namespacetca_html_a42ce66d56be0b95199691ad351941268"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a42ce66d56be0b95199691ad351941268">tca::MakePFPTjs</a></div><div class="ttdeci">void MakePFPTjs(TCSlice &amp;slc)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l00512">PFPUtils.cxx:512</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5dacae91fbe7d762fa4646bc9c47fd4ff41"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5dacae91fbe7d762fa4646bc9c47fd4ff41">tca::kRTPs3D</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00433">DataStructs.h:433</a></div></div>
<div class="ttc" id="namespacetca_html_a4cef0a0d26986f9f4e9b724f7b9c1d38"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a4cef0a0d26986f9f4e9b724f7b9c1d38">tca::Find3DRecoRange</a></div><div class="ttdeci">unsigned short Find3DRecoRange(const TCSlice &amp;slc, const PFPStruct &amp;pfp, unsigned short fromPt, unsigned short min2DPts, short dir)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l01358">PFPUtils.cxx:1358</a></div></div>
<div class="ttc" id="namespacetca_html_aa2db05fe1cf9e199e7d150b1aea47bd0"><div class="ttname"><a href="../../de/d0f/namespacetca.html#aa2db05fe1cf9e199e7d150b1aea47bd0">tca::MakeSmallAnglePFP</a></div><div class="ttdeci">bool MakeSmallAnglePFP(detinfo::DetectorPropertiesData const &amp;detProp, TCSlice &amp;slc, PFPStruct &amp;pfp, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02205">PFPUtils.cxx:2205</a></div></div>
<div class="ttc" id="structtca_1_1Vtx3Store_html_a5019583e0e7c6cf6b01bbf7041b0b13b"><div class="ttname"><a href="../../d2/d05/structtca_1_1Vtx3Store.html#a5019583e0e7c6cf6b01bbf7041b0b13b">tca::Vtx3Store::Z</a></div><div class="ttdeci">float Z</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00111">DataStructs.h:111</a></div></div>
<div class="ttc" id="structtca_1_1SectionFit_html_a5a9e3a0ec74356ed4b9b463f599f4f6c"><div class="ttname"><a href="../../d3/d08/structtca_1_1SectionFit.html#a5a9e3a0ec74356ed4b9b463f599f4f6c">tca::SectionFit::DirErr</a></div><div class="ttdeci">Vector3_t DirErr</div><div class="ttdoc">and direction error </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00247">DataStructs.h:247</a></div></div>
<div class="ttc" id="TCVertex_8h_html"><div class="ttname"><a href="../../d3/d65/TCVertex_8h.html">TCVertex.h</a></div></div>
<div class="ttc" id="namespacegeo_1_1fhicl_html_a05ff5cebd7313582756a33d8e8a5971a"><div class="ttname"><a href="../../d2/d66/namespacegeo_1_1fhicl.html#a05ff5cebd7313582756a33d8e8a5971a">geo::fhicl::PlaneID</a></div><div class="ttdeci">IDparameter&lt; geo::PlaneID &gt; PlaneID</div><div class="ttdoc">Member type of validated geo::PlaneID parameter. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/ddc/geo__types__fhicl_8h_source.html#l00375">geo_types_fhicl.h:375</a></div></div>
<div class="ttc" id="classgeo_1_1PlaneGeo_html_a4aee7822c8ac09d443815098f48fe285"><div class="ttname"><a href="../../d4/d67/classgeo_1_1PlaneGeo.html#a4aee7822c8ac09d443815098f48fe285">geo::PlaneGeo::ThetaZ</a></div><div class="ttdeci">double ThetaZ() const </div><div class="ttdoc">Angle of the wires from positive z axis; . </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd0/PlaneGeo_8cxx_source.html#l00726">PlaneGeo.cxx:726</a></div></div>
<div class="ttc" id="structtca_1_1Tj2Pt_html_ae7ad693e832772f8f64362fc6180eb1f"><div class="ttname"><a href="../../dc/d80/structtca_1_1Tj2Pt.html#ae7ad693e832772f8f64362fc6180eb1f">tca::Tj2Pt::plane</a></div><div class="ttdeci">unsigned short plane</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00146">DataStructs.h:146</a></div></div>
<div class="ttc" id="namespacetca_html_a22c4b4eb27d598f7003739f6752125de"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a22c4b4eb27d598f7003739f6752125de">tca::AddPointsInRange</a></div><div class="ttdeci">void AddPointsInRange(detinfo::DetectorClocksData const &amp;clockData, detinfo::DetectorPropertiesData const &amp;detProp, TCSlice &amp;slc, PFPStruct &amp;pfp, unsigned short fromPt, unsigned short toPt, CTP_t inCTP, float maxPull, unsigned short &amp;nWires, unsigned short &amp;nAdd, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l01837">PFPUtils.cxx:1837</a></div></div>
<div class="ttc" id="structtca_1_1TCWireIntersection_html_a4ab555951795c51c8825278caedfb420"><div class="ttname"><a href="../../d7/de3/structtca_1_1TCWireIntersection.html#a4ab555951795c51c8825278caedfb420">tca::TCWireIntersection::tpc</a></div><div class="ttdeci">unsigned int tpc</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00136">DataStructs.h:136</a></div></div>
<div class="ttc" id="make__xml__premcc1_80_8sh_html_a6a381711e6b60dd64d5ecdb1d135c1b8"><div class="ttname"><a href="../../d5/d61/make__xml__premcc1_80_8sh.html#a6a381711e6b60dd64d5ecdb1d135c1b8">local</a></div><div class="ttdeci">then local</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d61/make__xml__premcc1_80_8sh_source.html#l00085">make_xml_premcc1.0.sh:85</a></div></div>
<div class="ttc" id="namespacetca_html_a785100ea9d154d7afa06c7092aaf1cd3af8476e403cd021d9242196cdcfb127a9"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3af8476e403cd021d9242196cdcfb127a9">tca::kAllHits</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d0a/larreco_2larreco_2RecoAlg_2TCAlg_2Utils_8h_source.html#l00041">larreco/larreco/RecoAlg/TCAlg/Utils.h:41</a></div></div>
<div class="ttc" id="structtca_1_1Tj2Pt_html_a43cb371612e5844815bf0ebea5a4cd5b"><div class="ttname"><a href="../../dc/d80/structtca_1_1Tj2Pt.html#a43cb371612e5844815bf0ebea5a4cd5b">tca::Tj2Pt::npts</a></div><div class="ttdeci">unsigned short npts</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00151">DataStructs.h:151</a></div></div>
<div class="ttc" id="namespacetca_html_abf31bab3395b5e2325f017d9b7db50db"><div class="ttname"><a href="../../de/d0f/namespacetca.html#abf31bab3395b5e2325f017d9b7db50db">tca::MakeBareTP</a></div><div class="ttdeci">TrajPoint MakeBareTP(detinfo::DetectorPropertiesData const &amp;detProp, const TCSlice &amp;slc, const Point3_t &amp;pos, CTP_t inCTP)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l04025">Utils.cxx:4025</a></div></div>
<div class="ttc" id="structtca_1_1TCEvent_html_a6cd848fd4c9dd92fd6b7ec1ce0356ad6"><div class="ttname"><a href="../../d0/d2f/structtca_1_1TCEvent.html#a6cd848fd4c9dd92fd6b7ec1ce0356ad6">tca::TCEvent::globalP_UID</a></div><div class="ttdeci">int globalP_UID</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00644">DataStructs.h:644</a></div></div>
<div class="ttc" id="namespacemake__calib__df_html_a2b8237bac57d5c373c623869ad4513c8"><div class="ttname"><a href="../../d6/d11/namespacemake__calib__df.html#a2b8237bac57d5c373c623869ad4513c8">make_calib_df.t0</a></div><div class="ttdeci">int t0</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d0e/make__calib__df_8py_source.html#l00042">make_calib_df.py:42</a></div></div>
<div class="ttc" id="structtca_1_1PFPStruct_html_a97109c039924a290c47812092832c36a"><div class="ttname"><a href="../../dc/d18/structtca_1_1PFPStruct.html#a97109c039924a290c47812092832c36a">tca::PFPStruct::Flags</a></div><div class="ttdeci">std::bitset&lt; 8 &gt; Flags</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00302">DataStructs.h:302</a></div></div>
<div class="ttc" id="namespacetca_html_a9f64129d7d33c42c405c8b33d07262de"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a9f64129d7d33c42c405c8b33d07262de">tca::HitsRMSTime</a></div><div class="ttdeci">float HitsRMSTime(const TCSlice &amp;slc, const std::vector&lt; unsigned int &gt; &amp;hitsInMultiplet, HitStatus_t hitRequest)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l04235">Utils.cxx:4235</a></div></div>
<div class="ttc" id="GeometryCore_8h_html"><div class="ttname"><a href="../../db/de7/GeometryCore_8h.html">GeometryCore.h</a></div><div class="ttdoc">Access the description of detector geometry. </div></div>
<div class="ttc" id="structtca_1_1PFPStruct_html_acba092765aa9a24b59ca5d4c66bed832"><div class="ttname"><a href="../../dc/d18/structtca_1_1PFPStruct.html#acba092765aa9a24b59ca5d4c66bed832">tca::PFPStruct::TjUIDs</a></div><div class="ttdeci">std::vector&lt; int &gt; TjUIDs</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00286">DataStructs.h:286</a></div></div>
<div class="ttc" id="namespacetca_html_ad00890e918d6615215d6b43dec3c0ada"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ad00890e918d6615215d6b43dec3c0ada">tca::ReSection</a></div><div class="ttdeci">bool ReSection(detinfo::DetectorClocksData const &amp;clockData, detinfo::DetectorPropertiesData const &amp;detProp, const TCSlice &amp;slc, PFPStruct &amp;pfp, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l01111">PFPUtils.cxx:1111</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_ac8434b42a2a3f07a64a5f49146dfea3b"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#ac8434b42a2a3f07a64a5f49146dfea3b">tca::TCSlice::zLo</a></div><div class="ttdeci">float zLo</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00662">DataStructs.h:662</a></div></div>
<div class="ttc" id="structtca_1_1TCWireIntersection_html_a399e2b488d94288b6d839f6a6eeb2645"><div class="ttname"><a href="../../d7/de3/structtca_1_1TCWireIntersection.html#a399e2b488d94288b6d839f6a6eeb2645">tca::TCWireIntersection::dzdw1</a></div><div class="ttdeci">double dzdw1</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00133">DataStructs.h:133</a></div></div>
<div class="ttc" id="structtca_1_1Tj2Pt_html_af4753d4e6ae0a10cd051f08f0bf22250"><div class="ttname"><a href="../../dc/d80/structtca_1_1Tj2Pt.html#af4753d4e6ae0a10cd051f08f0bf22250">tca::Tj2Pt::ipt</a></div><div class="ttdeci">unsigned short ipt</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00149">DataStructs.h:149</a></div></div>
<div class="ttc" id="sparse__vector__test_8cc_html_a39f16bf854ba527dee7eba5bbbd93f3f"><div class="ttname"><a href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a></div><div class="ttdeci">T abs(T value)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d59/sparse__vector__test_8cc_source.html#l00030">sparse_vector_test.cc:30</a></div></div>
<div class="ttc" id="structtca_1_1Vtx3Store_html_a96d7d39b4008750878ef4048f45ab937"><div class="ttname"><a href="../../d2/d05/structtca_1_1Vtx3Store.html#a96d7d39b4008750878ef4048f45ab937">tca::Vtx3Store::Wire</a></div><div class="ttdeci">int Wire</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00114">DataStructs.h:114</a></div></div>
<div class="ttc" id="structtca_1_1TP3D_html_ac9763a62e8a5a7def22b002b728bb09f"><div class="ttname"><a href="../../d5/db8/structtca_1_1TP3D.html#ac9763a62e8a5a7def22b002b728bb09f">tca::TP3D::CTP</a></div><div class="ttdeci">CTP_t CTP</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00262">DataStructs.h:262</a></div></div>
<div class="ttc" id="structtca_1_1Vtx3Store_html_aee823c71f832466c9ad5eb7934e375c7"><div class="ttname"><a href="../../d2/d05/structtca_1_1Vtx3Store.html#aee823c71f832466c9ad5eb7934e375c7">tca::Vtx3Store::ID</a></div><div class="ttdeci">int ID</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00117">DataStructs.h:117</a></div></div>
<div class="ttc" id="structtca_1_1Vtx3Store_html"><div class="ttname"><a href="../../d2/d05/structtca_1_1Vtx3Store.html">tca::Vtx3Store</a></div><div class="ttdoc">struct of temporary 3D vertices </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00106">DataStructs.h:106</a></div></div>
<div class="ttc" id="structtca_1_1TP3D_html_a9866502e46d57d11397eb8fee6485718"><div class="ttname"><a href="../../d5/db8/structtca_1_1TP3D.html#a9866502e46d57d11397eb8fee6485718">tca::TP3D::Dir</a></div><div class="ttdeci">Vector3_t Dir</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00256">DataStructs.h:256</a></div></div>
<div class="ttc" id="structtca_1_1PFPStruct_html_a2aeca07e5620225d35f27cdff6cc9048"><div class="ttname"><a href="../../dc/d18/structtca_1_1PFPStruct.html#a2aeca07e5620225d35f27cdff6cc9048">tca::PFPStruct::TPCID</a></div><div class="ttdeci">geo::TPCID TPCID</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00297">DataStructs.h:297</a></div></div>
<div class="ttc" id="structtca_1_1TCEvent_html_ae1a29531c613e9b8c7b5ada6e81e6eb4"><div class="ttname"><a href="../../d0/d2f/structtca_1_1TCEvent.html#ae1a29531c613e9b8c7b5ada6e81e6eb4">tca::TCEvent::WorkID</a></div><div class="ttdeci">int WorkID</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00642">DataStructs.h:642</a></div></div>
<div class="ttc" id="namespacetca_html_a7db96d3803dbd5bb37281d5aef67dbbf"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a7db96d3803dbd5bb37281d5aef67dbbf">tca::PFPVertexCheck</a></div><div class="ttdeci">void PFPVertexCheck(TCSlice &amp;slc)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02844">PFPUtils.cxx:2844</a></div></div>
<div class="ttc" id="classgeo_1_1GeometryCore_html_adb675e4a8b4234008e4e738c4dd090a5"><div class="ttname"><a href="../../d7/d63/classgeo_1_1GeometryCore.html#adb675e4a8b4234008e4e738c4dd090a5">geo::GeometryCore::DetHalfHeight</a></div><div class="ttdeci">geo::Length_t DetHalfHeight(geo::TPCID const &amp;tpcid) const </div><div class="ttdoc">Returns the half height of the active volume of the specified TPC. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d6a/GeometryCore_8cxx_source.html#l00758">GeometryCore.cxx:758</a></div></div>
<div class="ttc" id="structtca_1_1SectionFit_html_ae1f8bccac742a3abfc089a67ee2c3ab0"><div class="ttname"><a href="../../d3/d08/structtca_1_1SectionFit.html#ae1f8bccac742a3abfc089a67ee2c3ab0">tca::SectionFit::Dir</a></div><div class="ttdeci">Vector3_t Dir</div><div class="ttdoc">and direction </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00246">DataStructs.h:246</a></div></div>
<div class="ttc" id="run__opflash__electron_8fcl_html_a1e5aaaf25e8609a835e8c7c6fda71456"><div class="ttname"><a href="../../d0/d84/run__opflash__electron_8fcl.html#a1e5aaaf25e8609a835e8c7c6fda71456">y</a></div><div class="ttdeci">process_name opflash particleana ie ie y</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d84/run__opflash__electron_8fcl_source.html#l00091">run_opflash_electron.fcl:91</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_a8bc6bb8a3c59dd9c73bc5bbf2500d808"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#a8bc6bb8a3c59dd9c73bc5bbf2500d808">tca::TCSlice::mallTraj</a></div><div class="ttdeci">std::vector&lt; Tj2Pt &gt; mallTraj</div><div class="ttdoc">vector of trajectory points ordered by increasing X </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00673">DataStructs.h:673</a></div></div>
<div class="ttc" id="structtca_1_1Vtx3Store_html_ab0cbe58e29e2770cbd97c2ede779e9b9"><div class="ttname"><a href="../../d2/d05/structtca_1_1Vtx3Store.html#ab0cbe58e29e2770cbd97c2ede779e9b9">tca::Vtx3Store::Y</a></div><div class="ttdeci">float Y</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00109">DataStructs.h:109</a></div></div>
<div class="ttc" id="namespacetca_html_ae9e0a86f0ca2a8797635a11ea700f74f"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ae9e0a86f0ca2a8797635a11ea700f74f">tca::FillGaps3D</a></div><div class="ttdeci">void FillGaps3D(detinfo::DetectorClocksData const &amp;clockData, detinfo::DetectorPropertiesData const &amp;detProp, TCSlice &amp;slc, PFPStruct &amp;pfp, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l01744">PFPUtils.cxx:1744</a></div></div>
<div class="ttc" id="namespacetca_html_acae6296d6fba718d82c34c88fefddf52"><div class="ttname"><a href="../../de/d0f/namespacetca.html#acae6296d6fba718d82c34c88fefddf52">tca::Point2_t</a></div><div class="ttdeci">std::array&lt; float, 2 &gt; Point2_t</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00045">DataStructs.h:45</a></div></div>
<div class="ttc" id="namespacetca_html_a3522a953c66af70a71df4f85857acae4"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a3522a953c66af70a71df4f85857acae4">tca::PDGCodeVote</a></div><div class="ttdeci">int PDGCodeVote(detinfo::DetectorClocksData const &amp;clockData, detinfo::DetectorPropertiesData const &amp;detProp, const TCSlice &amp;slc, PFPStruct &amp;pfp)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l03351">PFPUtils.cxx:3351</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_abcf147480fa8a9733489751d15046d72"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#abcf147480fa8a9733489751d15046d72">tca::TCConfig::unitsPerTick</a></div><div class="ttdeci">float unitsPerTick</div><div class="ttdoc">scale factor from Tick to WSE equivalent units </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00573">DataStructs.h:573</a></div></div>
<div class="ttc" id="DetectorPropertiesData_8h_html"><div class="ttname"><a href="../../d5/d7a/DetectorPropertiesData_8h.html">DetectorPropertiesData.h</a></div></div>
<div class="ttc" id="structtca_1_1Vtx3Store_html_ac14cedb2c2faa07bb9af1ea6296fcd00"><div class="ttname"><a href="../../d2/d05/structtca_1_1Vtx3Store.html#ac14cedb2c2faa07bb9af1ea6296fcd00">tca::Vtx3Store::TPCID</a></div><div class="ttdeci">geo::TPCID TPCID</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00115">DataStructs.h:115</a></div></div>
<div class="ttc" id="namespacetca_html_ad232469b22f64d38891a7038f0e36ef3"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ad232469b22f64d38891a7038f0e36ef3">tca::debug</a></div><div class="ttdeci">DebugStuff debug</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/da6/DebugStruct_8cxx_source.html#l00004">DebugStruct.cxx:4</a></div></div>
<div class="ttc" id="namespacetca_html_a6200f7dc3ac9831695e882e7ca391cdc"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a6200f7dc3ac9831695e882e7ca391cdc">tca::PointDirection</a></div><div class="ttdeci">Vector3_t PointDirection(const Point3_t p1, const Point3_t p2)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02547">PFPUtils.cxx:2547</a></div></div>
<div class="ttc" id="namespacetca_html_a6791841c97826647beefa30b998730e4"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a6791841c97826647beefa30b998730e4">tca::FillWireIntersections</a></div><div class="ttdeci">void FillWireIntersections(TCSlice &amp;slc)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l00611">PFPUtils.cxx:611</a></div></div>
<div class="ttc" id="structtca_1_1TCWireIntersection_html"><div class="ttname"><a href="../../d7/de3/structtca_1_1TCWireIntersection.html">tca::TCWireIntersection</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00125">DataStructs.h:125</a></div></div>
<div class="ttc" id="namespacetca_html_a41103f649664649d1a1287437f361bf3"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a41103f649664649d1a1287437f361bf3">tca::MakeTP3Ds</a></div><div class="ttdeci">bool MakeTP3Ds(detinfo::DetectorPropertiesData const &amp;detProp, TCSlice &amp;slc, PFPStruct &amp;pfp, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02124">PFPUtils.cxx:2124</a></div></div>
<div class="ttc" id="structtca_1_1Vtx3Store_html_a73e9a57be9a4219c61af41014128d4be"><div class="ttname"><a href="../../d2/d05/structtca_1_1Vtx3Store.html#a73e9a57be9a4219c61af41014128d4be">tca::Vtx3Store::UID</a></div><div class="ttdeci">int UID</div><div class="ttdoc">unique global ID </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00118">DataStructs.h:118</a></div></div>
<div class="ttc" id="structtca_1_1TP3D_html_a0cf7385a035afbd0420ffde77a0f4e8b"><div class="ttname"><a href="../../d5/db8/structtca_1_1TP3D.html#a0cf7385a035afbd0420ffde77a0f4e8b">tca::TP3D::TPIndex</a></div><div class="ttdeci">unsigned short TPIndex</div><div class="ttdoc">and the TP index </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00263">DataStructs.h:263</a></div></div>
<div class="ttc" id="TCShower_8h_html"><div class="ttname"><a href="../../dc/d1b/TCShower_8h.html">TCShower.h</a></div></div>
<div class="ttc" id="structtca_1_1Tj2Pt_html_afad1878c095c08824c86673c5dba42cd"><div class="ttname"><a href="../../dc/d80/structtca_1_1Tj2Pt.html#afad1878c095c08824c86673c5dba42cd">tca::Tj2Pt::wire</a></div><div class="ttdeci">unsigned int wire</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00142">DataStructs.h:142</a></div></div>
<div class="ttc" id="namespacetca_html_a59c21cff0144d7bc2dc395ae890bfe97"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a59c21cff0144d7bc2dc395ae890bfe97">tca::Match3Planes</a></div><div class="ttdeci">void Match3Planes(TCSlice &amp;slc, std::vector&lt; MatchStruct &gt; &amp;matVec)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l00813">PFPUtils.cxx:813</a></div></div>
<div class="ttc" id="namespacetca_html_a956ff1118d924911210bace923717e57"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a956ff1118d924911210bace923717e57">tca::GetHitMultiplet</a></div><div class="ttdeci">void GetHitMultiplet(const TCSlice &amp;slc, unsigned int theHit, std::vector&lt; unsigned int &gt; &amp;hitsInMultiplet, bool useLongPulseHits)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/StepUtils_8cxx_source.html#l01413">StepUtils.cxx:1413</a></div></div>
<div class="ttc" id="namespacetca_html_a8201218ffaab739725ab241042e6a120"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a8201218ffaab739725ab241042e6a120">tca::TCIntersectionPoint</a></div><div class="ttdeci">bool TCIntersectionPoint(unsigned int wir1, unsigned int wir2, unsigned int pln1, unsigned int pln2, float &amp;y, float &amp;z)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l00668">PFPUtils.cxx:668</a></div></div>
<div class="ttc" id="namespacetca_html_a905bc8b815c3290a4a79e3c091707736"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a905bc8b815c3290a4a79e3c091707736">tca::ElectronLikelihood</a></div><div class="ttdeci">float ElectronLikelihood(const TCSlice &amp;slc, const Trajectory &amp;tj)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l03214">Utils.cxx:3214</a></div></div>
<div class="ttc" id="structtca_1_1TCEvent_html_a08d6f9aad54acbd12cfcc44e77e6e29d"><div class="ttname"><a href="../../d0/d2f/structtca_1_1TCEvent.html#a08d6f9aad54acbd12cfcc44e77e6e29d">tca::TCEvent::goodWire</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; bool &gt; &gt; goodWire</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00632">DataStructs.h:632</a></div></div>
<div class="ttc" id="structtca_1_1TCWireIntersection_html_a4b50be049b11af6ceca1f935ec89ec85"><div class="ttname"><a href="../../d7/de3/structtca_1_1TCWireIntersection.html#a4b50be049b11af6ceca1f935ec89ec85">tca::TCWireIntersection::z</a></div><div class="ttdeci">double z</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00131">DataStructs.h:131</a></div></div>
<div class="ttc" id="structtca_1_1TP3D_html_a937c64030bd53c835902da63475db5f5"><div class="ttname"><a href="../../d5/db8/structtca_1_1TP3D.html#a937c64030bd53c835902da63475db5f5">tca::TP3D::Pos</a></div><div class="ttdeci">Point3_t Pos</div><div class="ttdoc">position of the trajectory </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00255">DataStructs.h:255</a></div></div>
<div class="ttc" id="generate__icarus__geometry__splitwire_8pl_html_a566ec0b645c019fdab1b56a230a4b24d"><div class="ttname"><a href="../../de/ddc/generate__icarus__geometry__splitwire_8pl.html#a566ec0b645c019fdab1b56a230a4b24d">for</a></div><div class="ttdeci">for($it=0;$it&lt; $RaceTrack_number;$it++)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/ddc/generate__icarus__geometry__splitwire_8pl_source.html#l01671">generate_icarus_geometry_splitwire.pl:1671</a></div></div>
<div class="ttc" id="namespacetca_html_a91b05db73ba97c302cb3368ec72b1dc8"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a91b05db73ba97c302cb3368ec72b1dc8">tca::ChgFracNearPos</a></div><div class="ttdeci">float ChgFracNearPos(const TCSlice &amp;slc, const Point2_t &amp;pos, const std::vector&lt; int &gt; &amp;tjIDs)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l03234">Utils.cxx:3234</a></div></div>
<div class="ttc" id="namespacetca_html_a519cf8a3170ec63e0b4d457f1d236109"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a519cf8a3170ec63e0b4d457f1d236109">tca::FindCloseHits</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; FindCloseHits(const TCSlice &amp;slc, std::array&lt; int, 2 &gt; const &amp;wireWindow, Point2_t const &amp;timeWindow, const unsigned short plane, HitStatus_t hitRequest, bool usePeakTime, bool &amp;hitsNear)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l02841">Utils.cxx:2841</a></div></div>
<div class="ttc" id="namespacetca_html_a659967724e0444ef70a496870d2d9418"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a659967724e0444ef70a496870d2d9418">tca::ChgFracBetween</a></div><div class="ttdeci">float ChgFracBetween(detinfo::DetectorPropertiesData const &amp;detProp, const TCSlice &amp;slc, Point3_t pos1, Point3_t pos2)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l03196">PFPUtils.cxx:3196</a></div></div>
<div class="ttc" id="namespaceicarus_1_1ns_1_1util_html_aac918da84f16d53ad17bab4f817da1c4"><div class="ttname"><a href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">icarus::ns::util::end</a></div><div class="ttdeci">auto end(FixedBins&lt; T, C &gt; const &amp;) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dbd/FixedBins_8h_source.html#l00585">FixedBins.h:585</a></div></div>
<div class="ttc" id="CalorimetryAlg_8h_html"><div class="ttname"><a href="../../d4/d4b/CalorimetryAlg_8h.html">CalorimetryAlg.h</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_aee1cce9521d82837d6aeddfcd12a68ba"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#aee1cce9521d82837d6aeddfcd12a68ba">tca::TCConfig::wirePitch</a></div><div class="ttdeci">float wirePitch</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00572">DataStructs.h:572</a></div></div>
<div class="ttc" id="namespacetca_html_a7045ad35dda0875138741a27c2fa6885"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a7045ad35dda0875138741a27c2fa6885">tca::FitSection</a></div><div class="ttdeci">bool FitSection(detinfo::DetectorClocksData const &amp;clockData, detinfo::DetectorPropertiesData const &amp;detProp, const TCSlice &amp;slc, PFPStruct &amp;pfp, unsigned short sfIndex)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l01413">PFPUtils.cxx:1413</a></div></div>
<div class="ttc" id="structtca_1_1TCWireIntersection_html_ac9fb943694a1e6c5155a5b421605d269"><div class="ttname"><a href="../../d7/de3/structtca_1_1TCWireIntersection.html#ac9fb943694a1e6c5155a5b421605d269">tca::TCWireIntersection::pln2</a></div><div class="ttdeci">unsigned short pln2</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00127">DataStructs.h:127</a></div></div>
<div class="ttc" id="structtca_1_1TCWireIntersection_html_a3aa866b92ff67887734e44d0ea2e1fce"><div class="ttname"><a href="../../d7/de3/structtca_1_1TCWireIntersection.html#a3aa866b92ff67887734e44d0ea2e1fce">tca::TCWireIntersection::dydw2</a></div><div class="ttdeci">double dydw2</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00134">DataStructs.h:134</a></div></div>
<div class="ttc" id="structtca_1_1TP3D_html_a6253f3df3ce18548226edb7ef959b411"><div class="ttname"><a href="../../d5/db8/structtca_1_1TP3D.html#a6253f3df3ce18548226edb7ef959b411">tca::TP3D::Flags</a></div><div class="ttdeci">std::bitset&lt; 8 &gt; Flags</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00265">DataStructs.h:265</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_ad94c65623983dd14ecee8a4166c6e582"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#ad94c65623983dd14ecee8a4166c6e582">tca::TCSlice::vtxs</a></div><div class="ttdeci">std::vector&lt; VtxStore &gt; vtxs</div><div class="ttdoc">2D vertices </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00678">DataStructs.h:678</a></div></div>
<div class="ttc" id="namespaceutil_1_1quantities_html_a1a08bc762b79d6e1d7816c34d3e36f78"><div class="ttname"><a href="../../d3/d63/namespaceutil_1_1quantities.html#a1a08bc762b79d6e1d7816c34d3e36f78">util::quantities::tick</a></div><div class="ttdeci">tick_as&lt;&gt; tick</div><div class="ttdoc">Tick number, represented by std::ptrdiff_t. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d57/electronics_8h_source.html#l00075">electronics.h:75</a></div></div>
<div class="ttc" id="classdetinfo_1_1DetectorPropertiesData_html_a359d6255bb14f321d76e6085204ea52a"><div class="ttname"><a href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a359d6255bb14f321d76e6085204ea52a">detinfo::DetectorPropertiesData::ConvertXToTicks</a></div><div class="ttdeci">double ConvertXToTicks(double X, int p, int t, int c) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d64/DetectorPropertiesData_8cc_source.html#l00099">DetectorPropertiesData.cc:99</a></div></div>
<div class="ttc" id="namespacetca_html_acbd522546d131bc7ab71657194d6db4c"><div class="ttname"><a href="../../de/d0f/namespacetca.html#acbd522546d131bc7ab71657194d6db4c">tca::CountBadPoints</a></div><div class="ttdeci">void CountBadPoints(const TCSlice &amp;slc, const PFPStruct &amp;pfp, unsigned short fromPt, unsigned short toPt, unsigned short &amp;nBadPts, unsigned short &amp;firstBadPt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l01308">PFPUtils.cxx:1308</a></div></div>
<div class="ttc" id="namespacetca_html_a785100ea9d154d7afa06c7092aaf1cd3a592a31ca0b683aeb15197694a71bd108"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a785100ea9d154d7afa06c7092aaf1cd3a592a31ca0b683aeb15197694a71bd108">tca::kUsedHits</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d0a/larreco_2larreco_2RecoAlg_2TCAlg_2Utils_8h_source.html#l00042">larreco/larreco/RecoAlg/TCAlg/Utils.h:42</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a9a8003235ed43822514a5c98b2a79f09"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a9a8003235ed43822514a5c98b2a79f09">tca::TCConfig::match3DCuts</a></div><div class="ttdeci">std::vector&lt; float &gt; match3DCuts</div><div class="ttdoc">3D matching cuts </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00562">DataStructs.h:562</a></div></div>
<div class="ttc" id="structtca_1_1PFPStruct_html_a38a39b071f5cdf0c3eb9f71f04c3e63b"><div class="ttname"><a href="../../dc/d18/structtca_1_1PFPStruct.html#a38a39b071f5cdf0c3eb9f71f04c3e63b">tca::PFPStruct::SectionFits</a></div><div class="ttdeci">std::vector&lt; SectionFit &gt; SectionFits</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00288">DataStructs.h:288</a></div></div>
<div class="ttc" id="classgeo_1_1GeometryCore_html_a3ad8501224048854f35e6b29d9ac4a72"><div class="ttname"><a href="../../d7/d63/classgeo_1_1GeometryCore.html#a3ad8501224048854f35e6b29d9ac4a72">geo::GeometryCore::DetLength</a></div><div class="ttdeci">geo::Length_t DetLength(geo::TPCID const &amp;tpcid) const </div><div class="ttdoc">Returns the length of the active volume of the specified TPC. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d6a/GeometryCore_8cxx_source.html#l00764">GeometryCore.cxx:764</a></div></div>
<div class="ttc" id="namespacetca_html_af4498155f5589b440a3c4c8fa56ebb5a"><div class="ttname"><a href="../../de/d0f/namespacetca.html#af4498155f5589b440a3c4c8fa56ebb5a">tca::MakeTrajectoryObsolete</a></div><div class="ttdeci">void MakeTrajectoryObsolete(TCSlice &amp;slc, unsigned int itj)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l02182">Utils.cxx:2182</a></div></div>
<div class="ttc" id="structtca_1_1TP3D_html_a8ba13376fc25aa4e15d72ded58c512ea"><div class="ttname"><a href="../../d5/db8/structtca_1_1TP3D.html#a8ba13376fc25aa4e15d72ded58c512ea">tca::TP3D::TPXErr2</a></div><div class="ttdeci">double TPXErr2</div><div class="ttdoc">(X position error)^2 </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00258">DataStructs.h:258</a></div></div>
<div class="ttc" id="namespacetca_html_a1c2bea68a634d09340f7921072d5acda"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a1c2bea68a634d09340f7921072d5acda">tca::PosSep2</a></div><div class="ttdeci">double PosSep2(const Point3_t &amp;pos1, const Point3_t &amp;pos2)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02571">PFPUtils.cxx:2571</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_ace76ed4c4914e7d17386ff1e1ba4e657"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#ace76ed4c4914e7d17386ff1e1ba4e657">tca::TCConfig::geom</a></div><div class="ttdeci">const geo::GeometryCore * geom</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00578">DataStructs.h:578</a></div></div>
<div class="ttc" id="structtca_1_1TCWireIntersection_html_a0a1d170111e58df220326f2aad4c3d63"><div class="ttname"><a href="../../d7/de3/structtca_1_1TCWireIntersection.html#a0a1d170111e58df220326f2aad4c3d63">tca::TCWireIntersection::wir1</a></div><div class="ttdeci">float wir1</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00128">DataStructs.h:128</a></div></div>
<div class="ttc" id="namespacetca_html_af76f13054935a6da9473200ddcecdd74"><div class="ttname"><a href="../../de/d0f/namespacetca.html#af76f13054935a6da9473200ddcecdd74">tca::SectionStartEnd</a></div><div class="ttdeci">bool SectionStartEnd(const PFPStruct &amp;pfp, unsigned short sfIndex, unsigned short &amp;startPt, unsigned short &amp;endPt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l03311">PFPUtils.cxx:3311</a></div></div>
<div class="ttc" id="namespacetca_html_ab0da6302706a58448c4ee031a85d0695"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ab0da6302706a58448c4ee031a85d0695">tca::PointDirIntersect</a></div><div class="ttdeci">bool PointDirIntersect(Point3_t p1, Vector3_t p1Dir, Point3_t p2, Vector3_t p2Dir, Point3_t &amp;intersect, float &amp;doca)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l03114">PFPUtils.cxx:3114</a></div></div>
<div class="ttc" id="structgeo_1_1TPCID_html"><div class="ttname"><a href="../../d2/d4d/structgeo_1_1TPCID.html">geo::TPCID</a></div><div class="ttdoc">The data type to uniquely identify a TPC. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00386">geo_types.h:386</a></div></div>
<div class="ttc" id="structgeo_1_1PlaneID_html_a02c2afa6841ef86ea8ab49478cdf5b29"><div class="ttname"><a href="../../d4/d41/structgeo_1_1PlaneID.html#a02c2afa6841ef86ea8ab49478cdf5b29">geo::PlaneID::Plane</a></div><div class="ttdeci">PlaneID_t Plane</div><div class="ttdoc">Index of the plane within its TPC. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00493">geo_types.h:493</a></div></div>
<div class="ttc" id="namespacetca_html_ad0b3c949f5b890ab3eed3f3bd44db51a"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ad0b3c949f5b890ab3eed3f3bd44db51a">tca::pAlgModSize</a></div><div class="ttdeci">constexpr unsigned int pAlgModSize</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00282">DataStructs.h:282</a></div></div>
<div class="ttc" id="namespacetca_html_a2990310f09f389eb875f3273d58393f0a088d286995bc5cfcaa1f8f26a78f0a67"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a2990310f09f389eb875f3273d58393f0a088d286995bc5cfcaa1f8f26a78f0a67">tca::kTP3DBad</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00270">DataStructs.h:270</a></div></div>
<div class="ttc" id="classgeo_1_1GeometryCore_html_aed0d5fe55e605367888c245e1e94f42e"><div class="ttname"><a href="../../d7/d63/classgeo_1_1GeometryCore.html#aed0d5fe55e605367888c245e1e94f42e">geo::GeometryCore::IntersectionPoint</a></div><div class="ttdeci">bool IntersectionPoint(geo::WireID const &amp;wid1, geo::WireID const &amp;wid2, double &amp;y, double &amp;z) const </div><div class="ttdoc">Returns the intersection point of two wires. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d6a/GeometryCore_8cxx_source.html#l01657">GeometryCore.cxx:1657</a></div></div>
<div class="ttc" id="namespacetca_html_a28c1a6c238b36f5b2ccef44d9d02d120"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a28c1a6c238b36f5b2ccef44d9d02d120">tca::SetMag</a></div><div class="ttdeci">bool SetMag(Vector3_t &amp;v1, double mag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02582">PFPUtils.cxx:2582</a></div></div>
<div class="ttc" id="geo__types_8h_html"><div class="ttname"><a href="../../d8/d48/geo__types_8h.html">geo_types.h</a></div><div class="ttdoc">Definition of data types for geometry description. </div></div>
<div class="ttc" id="namespacetca_html_a03d7925cba1cd1c5952d280736887b6b"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a03d7925cba1cd1c5952d280736887b6b">tca::dEdx</a></div><div class="ttdeci">float dEdx(detinfo::DetectorClocksData const &amp;clockData, detinfo::DetectorPropertiesData const &amp;detProp, const TCSlice &amp;slc, TP3D &amp;tp3d)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02686">PFPUtils.cxx:2686</a></div></div>
<div class="ttc" id="structtca_1_1PFPStruct_html"><div class="ttname"><a href="../../dc/d18/structtca_1_1PFPStruct.html">tca::PFPStruct</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00284">DataStructs.h:284</a></div></div>
<div class="ttc" id="namespacegen__crt__frags_html_a8cdc67339147aad209b4122a38d7e246"><div class="ttname"><a href="../../d8/ddf/namespacegen__crt__frags.html#a8cdc67339147aad209b4122a38d7e246">gen_crt_frags.w</a></div><div class="ttdeci">tuple w</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d8c/gen__crt__frags_8py_source.html#l01416">gen_crt_frags.py:1416</a></div></div>
<div class="ttc" id="namespacegeo_1_1vect_html_a22bf6b956ca4ad2050a44810c80c805f"><div class="ttname"><a href="../../d0/d8e/namespacegeo_1_1vect.html#a22bf6b956ca4ad2050a44810c80c805f">geo::vect::norm</a></div><div class="ttdeci">auto norm(Vector const &amp;v)</div><div class="ttdoc">Return norm of the specified vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d6c/geo__vectors__utils_8h_source.html#l01202">geo_vectors_utils.h:1202</a></div></div>
<div class="ttc" id="namespacetca_html_a0898183aa6813a6ab2cbaede7d31e4d1"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a0898183aa6813a6ab2cbaede7d31e4d1">tca::slices</a></div><div class="ttdeci">std::vector&lt; TCSlice &gt; slices</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/DataStructs_8cxx_source.html#l00012">DataStructs.cxx:12</a></div></div>
<div class="ttc" id="namespacetca_html_a0f4567ffd484515a083b3c673e307210"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a0f4567ffd484515a083b3c673e307210">tca::GetRange</a></div><div class="ttdeci">void GetRange(const PFPStruct &amp;pfp, unsigned short sfIndex, unsigned short &amp;fromPt, unsigned short &amp;npts)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l01391">PFPUtils.cxx:1391</a></div></div>
<div class="ttc" id="namespacetca_html_a690a54ebd4990c8b9da44eb08fcf2a46"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a690a54ebd4990c8b9da44eb08fcf2a46">tca::InsertTP3D</a></div><div class="ttdeci">unsigned short InsertTP3D(PFPStruct &amp;pfp, TP3D &amp;tp3d)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l01988">PFPUtils.cxx:1988</a></div></div>
<div class="ttc" id="namespacedropbox_html_a407b5b895ba9265893768748aaa73825"><div class="ttname"><a href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dropbox.dir</a></div><div class="ttdeci">tuple dir</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d81/dropbox_8py_source.html#l00028">dropbox.py:28</a></div></div>
<div class="ttc" id="namespacetca_html_a63003e064041f039c7fa885f842a594f"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a63003e064041f039c7fa885f842a594f">tca::FitTP3Ds</a></div><div class="ttdeci">SectionFit FitTP3Ds(detinfo::DetectorPropertiesData const &amp;detProp, const TCSlice &amp;slc, const std::vector&lt; TP3D &gt; &amp;tp3ds, unsigned short fromPt, short fitDir, unsigned short nPtsFit)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l01446">PFPUtils.cxx:1446</a></div></div>
<div class="ttc" id="classdetinfo_1_1DetectorPropertiesData_html_a8e4b4b8d755ffded5a9f956ae7c9c1ec"><div class="ttname"><a href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html#a8e4b4b8d755ffded5a9f956ae7c9c1ec">detinfo::DetectorPropertiesData::ConvertTicksToX</a></div><div class="ttdeci">double ConvertTicksToX(double ticks, int p, int t, int c) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d64/DetectorPropertiesData_8cc_source.html#l00115">DetectorPropertiesData.cc:115</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_a2a72c7c94d8a7b0114b5183a4041ce1f"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#a2a72c7c94d8a7b0114b5183a4041ce1f">tca::TCConfig::modes</a></div><div class="ttdeci">std::bitset&lt; 16 &gt; modes</div><div class="ttdoc">number of points to find AveChg </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00609">DataStructs.h:609</a></div></div>
<div class="ttc" id="structtca_1_1TCWireIntersection_html_a3c37363953d6a15317d52fb0c0dad675"><div class="ttname"><a href="../../d7/de3/structtca_1_1TCWireIntersection.html#a3c37363953d6a15317d52fb0c0dad675">tca::TCWireIntersection::dzdw2</a></div><div class="ttdeci">double dzdw2</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00135">DataStructs.h:135</a></div></div>
<div class="ttc" id="classgeo_1_1GeometryCore_html_a8edd7b95c82390f84514f145c0980cc9"><div class="ttname"><a href="../../d7/d63/classgeo_1_1GeometryCore.html#a8edd7b95c82390f84514f145c0980cc9">geo::GeometryCore::NTPC</a></div><div class="ttdeci">unsigned int NTPC(unsigned int cstat=0) const </div><div class="ttdoc">Returns the total number of TPCs in the specified cryostat. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de7/GeometryCore_8h_source.html#l02303">GeometryCore.h:2303</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_ad3fb3131fc35af76d6086bc9eca8428c"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#ad3fb3131fc35af76d6086bc9eca8428c">tca::TCSlice::slHits</a></div><div class="ttdeci">std::vector&lt; TCHit &gt; slHits</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00671">DataStructs.h:671</a></div></div>
<div class="ttc" id="namespacetca_html_a64a1d13b9dd367c5d94e5779daf22626"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a64a1d13b9dd367c5d94e5779daf22626">tca::PointPull</a></div><div class="ttdeci">float PointPull(const PFPStruct &amp;pfp, const TP3D &amp;tp3d)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02814">PFPUtils.cxx:2814</a></div></div>
<div class="ttc" id="trackfinderalgorithms_8fcl_html_ac996980052e16111a1efc913778a5f5f"><div class="ttname"><a href="../../d2/dbd/trackfinderalgorithms_8fcl.html#ac996980052e16111a1efc913778a5f5f">planes</a></div><div class="ttdeci">BEGIN_PROLOG Z planes</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dbd/trackfinderalgorithms_8fcl_source.html#l00026">trackfinderalgorithms.fcl:26</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5dac2eaa8f8e5d6efa4f5b85b26f533ef38"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5dac2eaa8f8e5d6efa4f5b85b26f533ef38">tca::kMakePFPTjs</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00494">DataStructs.h:494</a></div></div>
<div class="ttc" id="namespacetca_html_a1f3a9c0638f68964f62d19cbb80731da"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a1f3a9c0638f68964f62d19cbb80731da">tca::CreateTP3D</a></div><div class="ttdeci">TP3D CreateTP3D(detinfo::DetectorPropertiesData const &amp;detProp, const TCSlice &amp;slc, int tjID, unsigned short tpIndex)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02722">PFPUtils.cxx:2722</a></div></div>
<div class="ttc" id="namespacetca_html_ac82285eff8fcdf6ba7a4b74ded6adcd8"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ac82285eff8fcdf6ba7a4b74ded6adcd8">tca::ValidTwoPlaneMatch</a></div><div class="ttdeci">bool ValidTwoPlaneMatch(detinfo::DetectorPropertiesData const &amp;detProp, const TCSlice &amp;slc, const PFPStruct &amp;pfp)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l01796">PFPUtils.cxx:1796</a></div></div>
<div class="ttc" id="namespacetca_html_ac7453ffded371a6c148f116b8c0042c9"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ac7453ffded371a6c148f116b8c0042c9">tca::DotProd</a></div><div class="ttdeci">double DotProd(const Vector3_t &amp;v1, const Vector3_t &amp;v2)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d6a/PFPUtils_8h_source.html#l00128">PFPUtils.h:128</a></div></div>
<div class="ttc" id="namespacetca_html_a0c55ac735de824c3e089bcbea9addb71"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a0c55ac735de824c3e089bcbea9addb71">tca::CTP_t</a></div><div class="ttdeci">unsigned int CTP_t</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00049">DataStructs.h:49</a></div></div>
<div class="ttc" id="structtca_1_1TCWireIntersection_html_a6923b0b98bcd40326a2958742af1d82d"><div class="ttname"><a href="../../d7/de3/structtca_1_1TCWireIntersection.html#a6923b0b98bcd40326a2958742af1d82d">tca::TCWireIntersection::dydw1</a></div><div class="ttdeci">double dydw1</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00132">DataStructs.h:132</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5da9b5200eaaed0e097cac019d6643e537e"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da9b5200eaaed0e097cac019d6643e537e">tca::kJunkTj</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00449">DataStructs.h:449</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_ae45d2a3a7b612c6f11637ed8f09e5e83"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#ae45d2a3a7b612c6f11637ed8f09e5e83">tca::TCSlice::vtx3s</a></div><div class="ttdeci">std::vector&lt; Vtx3Store &gt; vtx3s</div><div class="ttdoc">3D vertices </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00679">DataStructs.h:679</a></div></div>
<div class="ttc" id="SpacePoint_8h_html"><div class="ttname"><a href="../../d9/d12/SpacePoint_8h.html">SpacePoint.h</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_a11f8bb26db704e37774080dec5b8d321"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#a11f8bb26db704e37774080dec5b8d321">tca::TCSlice::TPCID</a></div><div class="ttdeci">geo::TPCID TPCID</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00664">DataStructs.h:664</a></div></div>
<div class="ttc" id="namespacetca_html_a7636b0975b99bd967cb1cf31cec2609d"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a7636b0975b99bd967cb1cf31cec2609d">tca::FillmAllTraj</a></div><div class="ttdeci">void FillmAllTraj(detinfo::DetectorPropertiesData const &amp;detProp, TCSlice &amp;slc)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02381">PFPUtils.cxx:2381</a></div></div>
<div class="ttc" id="PFPUtils_8h_html"><div class="ttname"><a href="../../d8/d6a/PFPUtils_8h.html">PFPUtils.h</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_af5730f08df12863fd92ee1573843d61d"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#af5730f08df12863fd92ee1573843d61d">tca::TCConfig::useAlg</a></div><div class="ttdeci">std::bitset&lt; 128 &gt; useAlg</div><div class="ttdoc">Max hit separation for making junk trajectories. &amp;lt; 0 to turn off. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00588">DataStructs.h:588</a></div></div>
<div class="ttc" id="structtca_1_1Tj2Pt_html_adeb985d7df975cd5543a25ec18740a80"><div class="ttname"><a href="../../dc/d80/structtca_1_1Tj2Pt.html#adeb985d7df975cd5543a25ec18740a80">tca::Tj2Pt::xlo</a></div><div class="ttdeci">float xlo</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00144">DataStructs.h:144</a></div></div>
<div class="ttc" id="PlaneGeo_8h_html"><div class="ttname"><a href="../../d8/d80/PlaneGeo_8h.html">PlaneGeo.h</a></div><div class="ttdoc">Encapsulate the construction of a single detector plane. </div></div>
<div class="ttc" id="structtca_1_1PFPStruct_html_a3c46c186d7c6861d3f9f03eceea661de"><div class="ttname"><a href="../../dc/d18/structtca_1_1PFPStruct.html#a3c46c186d7c6861d3f9f03eceea661de">tca::PFPStruct::UID</a></div><div class="ttdeci">int UID</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00300">DataStructs.h:300</a></div></div>
<div class="ttc" id="classdetinfo_1_1DetectorClocksData_html"><div class="ttname"><a href="../../d0/dc3/classdetinfo_1_1DetectorClocksData.html">detinfo::DetectorClocksData</a></div><div class="ttdoc">Contains all timing reference information for the detector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d5b/DetectorClocksData_8h_source.html#l00283">DetectorClocksData.h:283</a></div></div>
<div class="ttc" id="structtca_1_1TCConfig_html_aa629fcaa6260eeeef73145a24a080c72"><div class="ttname"><a href="../../d2/d8d/structtca_1_1TCConfig.html#aa629fcaa6260eeeef73145a24a080c72">tca::TCConfig::pfpStitchCuts</a></div><div class="ttdeci">std::vector&lt; float &gt; pfpStitchCuts</div><div class="ttdoc">cuts for stitching between TPCs </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00566">DataStructs.h:566</a></div></div>
<div class="ttc" id="namespacetca_html_adf5449019c33e3acf95de4788f15acec"><div class="ttname"><a href="../../de/d0f/namespacetca.html#adf5449019c33e3acf95de4788f15acec">tca::DecodeCTP</a></div><div class="ttdeci">geo::PlaneID DecodeCTP(CTP_t CTP)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/DataStructs_8cxx_source.html#l00115">DataStructs.cxx:115</a></div></div>
<div class="ttc" id="structtca_1_1TP3D_html_a15f15433176335aab1f8ea3c36485119"><div class="ttname"><a href="../../d5/db8/structtca_1_1TP3D.html#a15f15433176335aab1f8ea3c36485119">tca::TP3D::along</a></div><div class="ttdeci">float along</div><div class="ttdoc">distance from the start Pos of the section </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00260">DataStructs.h:260</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5da28fa0bb663ed246b2fcf12591258c5ac"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da28fa0bb663ed246b2fcf12591258c5ac">tca::kKilled</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00450">DataStructs.h:450</a></div></div>
<div class="ttc" id="namespacetca_html_a2a4c4a32e939554d609ba778be021c6d"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a2a4c4a32e939554d609ba778be021c6d">tca::PosSep</a></div><div class="ttdeci">double PosSep(const Point3_t &amp;pos1, const Point3_t &amp;pos2)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02564">PFPUtils.cxx:2564</a></div></div>
<div class="ttc" id="structtca_1_1PFPStruct_html_a68b7261ec418900932d12596bd374090"><div class="ttname"><a href="../../dc/d18/structtca_1_1PFPStruct.html#a68b7261ec418900932d12596bd374090">tca::PFPStruct::TjIDs</a></div><div class="ttdeci">std::vector&lt; int &gt; TjIDs</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00285">DataStructs.h:285</a></div></div>
<div class="ttc" id="structtca_1_1TCEvent_html_abd581d77b47c61e2dba9ffba63aa9f3c"><div class="ttname"><a href="../../d0/d2f/structtca_1_1TCEvent.html#abd581d77b47c61e2dba9ffba63aa9f3c">tca::TCEvent::wireIntersections</a></div><div class="ttdeci">std::vector&lt; TCWireIntersection &gt; wireIntersections</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00641">DataStructs.h:641</a></div></div>
<div class="ttc" id="structtca_1_1TCEvent_html_ab9f91958d4d40ec9c3733d422736c87e"><div class="ttname"><a href="../../d0/d2f/structtca_1_1TCEvent.html#ab9f91958d4d40ec9c3733d422736c87e">tca::TCEvent::allHits</a></div><div class="ttdeci">std::vector&lt; recob::Hit &gt; const * allHits</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00624">DataStructs.h:624</a></div></div>
<div class="ttc" id="namespacetca_html_a8806e1c32119afbfe02dff4c21cf3e57"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a8806e1c32119afbfe02dff4c21cf3e57">tca::EncodeCTP</a></div><div class="ttdeci">CTP_t EncodeCTP(unsigned int cryo, unsigned int tpc, unsigned int plane)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00054">DataStructs.h:54</a></div></div>
<div class="ttc" id="classcalo_1_1CalorimetryAlg_html_ae390af3771f9aba05f14a3d6d4c86e96"><div class="ttname"><a href="../../d1/de6/classcalo_1_1CalorimetryAlg.html#ae390af3771f9aba05f14a3d6d4c86e96">calo::CalorimetryAlg::dEdx_AREA</a></div><div class="ttdeci">double dEdx_AREA(detinfo::DetectorClocksData const &amp;clock_data, detinfo::DetectorPropertiesData const &amp;det_prop, recob::Hit const &amp;hit, double pitch, double T0=0) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d75/CalorimetryAlg_8cxx_source.html#l00131">CalorimetryAlg.cxx:131</a></div></div>
<div class="ttc" id="namespacetca_html_a7dbcd7ee5aae3d1625e91bd338f19cb9"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a7dbcd7ee5aae3d1625e91bd338f19cb9">tca::GetSliceIndex</a></div><div class="ttdeci">std::pair&lt; unsigned short, unsigned short &gt; GetSliceIndex(std::string typeName, int uID)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l05086">Utils.cxx:5086</a></div></div>
<div class="ttc" id="structtca_1_1DebugStuff_html_a7764fa1d95d392a6f3569bcc177e2d20"><div class="ttname"><a href="../../d8/de4/structtca_1_1DebugStuff.html#a7764fa1d95d392a6f3569bcc177e2d20">tca::DebugStuff::MVI_Iter</a></div><div class="ttdeci">unsigned short MVI_Iter</div><div class="ttdoc">MVI iteration - see FindPFParticles. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/db2/DebugStruct_8h_source.html#l00029">DebugStruct.h:29</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_a2bfd4002c7f6fbe64e1fc1591682870b"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#a2bfd4002c7f6fbe64e1fc1591682870b">tca::TCSlice::nWires</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; nWires</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00655">DataStructs.h:655</a></div></div>
<div class="ttc" id="namespacetca_html_a72c1c3d7710660bf62af0539e345c329"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a72c1c3d7710660bf62af0539e345c329">tca::Vector3_t</a></div><div class="ttdeci">std::array&lt; double, 3 &gt; Vector3_t</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00044">DataStructs.h:44</a></div></div>
<div class="ttc" id="structtca_1_1PFPStruct_html_aa22ea53154f0d5a6bc29261c31f2a3a1"><div class="ttname"><a href="../../dc/d18/structtca_1_1PFPStruct.html#aa22ea53154f0d5a6bc29261c31f2a3a1">tca::PFPStruct::TP3Ds</a></div><div class="ttdeci">std::vector&lt; TP3D &gt; TP3Ds</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00287">DataStructs.h:287</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_a1ffe21c3ecd60e4fb956a776cdff9e5a"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#a1ffe21c3ecd60e4fb956a776cdff9e5a">tca::TCSlice::ID</a></div><div class="ttdeci">int ID</div><div class="ttdoc">ID of the recob::Slice (not the sub-slice) </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00666">DataStructs.h:666</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html">tca::TCSlice</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00654">DataStructs.h:654</a></div></div>
<div class="ttc" id="structtca_1_1PFPStruct_html_a4e8cbcf84cf897b360ab2c68009c8418"><div class="ttname"><a href="../../dc/d18/structtca_1_1PFPStruct.html#a4e8cbcf84cf897b360ab2c68009c8418">tca::PFPStruct::dEdx</a></div><div class="ttdeci">std::array&lt; std::vector&lt; float &gt;, 2 &gt; dEdx</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00290">DataStructs.h:290</a></div></div>
<div class="ttc" id="namespacetca_html_a32d11bb3bf691e677294028864fc0e5da6ffcff8d6a31c1e1662e99d73d544e86"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a32d11bb3bf691e677294028864fc0e5da6ffcff8d6a31c1e1662e99d73d544e86">tca::kMat3D</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00434">DataStructs.h:434</a></div></div>
<div class="ttc" id="namespacetca_html_ad56741a3d44d6766a6bca763539993fc"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ad56741a3d44d6766a6bca763539993fc">tca::Match3PlanesSpt</a></div><div class="ttdeci">void Match3PlanesSpt(TCSlice &amp;slc, std::vector&lt; MatchStruct &gt; &amp;matVec)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l00700">PFPUtils.cxx:700</a></div></div>
<div class="ttc" id="namespacetca_html_ad8fd522db1f6ab62d72bb413f8071f75"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ad8fd522db1f6ab62d72bb413f8071f75">tca::DefinePFPParents</a></div><div class="ttdeci">void DefinePFPParents(TCSlice &amp;slc, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02883">PFPUtils.cxx:2883</a></div></div>
<div class="ttc" id="structtca_1_1TCWireIntersection_html_a48ed0859edaca33b1f90fb20377fbb31"><div class="ttname"><a href="../../d7/de3/structtca_1_1TCWireIntersection.html#a48ed0859edaca33b1f90fb20377fbb31">tca::TCWireIntersection::pln1</a></div><div class="ttdeci">unsigned short pln1</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00126">DataStructs.h:126</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_a71008f03c27ab5d6f32ffebb1874c1cd"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#a71008f03c27ab5d6f32ffebb1874c1cd">tca::TCSlice::nPlanes</a></div><div class="ttdeci">unsigned short nPlanes</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00665">DataStructs.h:665</a></div></div>
<div class="ttc" id="structtca_1_1TCEvent_html_aafdfe819a43d7698d960971ca831306e"><div class="ttname"><a href="../../d0/d2f/structtca_1_1TCEvent.html#aafdfe819a43d7698d960971ca831306e">tca::TCEvent::global3V_UID</a></div><div class="ttdeci">int global3V_UID</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00646">DataStructs.h:646</a></div></div>
<div class="ttc" id="classgeo_1_1GeometryCore_html_a84aba48f49cf9add6cf0641a4527e45b"><div class="ttname"><a href="../../d7/d63/classgeo_1_1GeometryCore.html#a84aba48f49cf9add6cf0641a4527e45b">geo::GeometryCore::TPC</a></div><div class="ttdeci">TPCGeo const &amp; TPC(unsigned int const tpc=0, unsigned int const cstat=0) const </div><div class="ttdoc">Returns the specified TPC. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de7/GeometryCore_8h_source.html#l02423">GeometryCore.h:2423</a></div></div>
<div class="ttc" id="structtca_1_1Tj2Pt_html_a6091b11301eec4f269f87588b82f5754"><div class="ttname"><a href="../../dc/d80/structtca_1_1Tj2Pt.html#a6091b11301eec4f269f87588b82f5754">tca::Tj2Pt::xhi</a></div><div class="ttdeci">float xhi</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00145">DataStructs.h:145</a></div></div>
<div class="ttc" id="namespacetca_html_a4182bec4cfa5d8982e9403c61ce79c30"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a4182bec4cfa5d8982e9403c61ce79c30">tca::FindPFParticles</a></div><div class="ttdeci">void FindPFParticles(detinfo::DetectorClocksData const &amp;clockData, detinfo::DetectorPropertiesData const &amp;detProp, TCSlice &amp;slc)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l00190">PFPUtils.cxx:190</a></div></div>
<div class="ttc" id="structtca_1_1SectionFit_html"><div class="ttname"><a href="../../d3/d08/structtca_1_1SectionFit.html">tca::SectionFit</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00244">DataStructs.h:244</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_ae49c7761b7c26726e11a32cd6a1a5119"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#ae49c7761b7c26726e11a32cd6a1a5119">tca::TCSlice::pfps</a></div><div class="ttdeci">std::vector&lt; PFPStruct &gt; pfps</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00680">DataStructs.h:680</a></div></div>
<div class="ttc" id="namespacetca_html_a9a2cd91c50f24261f799582dc9f0a76f"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a9a2cd91c50f24261f799582dc9f0a76f">tca::MoveTPToWire</a></div><div class="ttdeci">void MoveTPToWire(TrajPoint &amp;tp, float wire)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l02829">Utils.cxx:2829</a></div></div>
<div class="ttc" id="namespacetca_html_a11f336296780a3459f3b946303a17e2b"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a11f336296780a3459f3b946303a17e2b">tca::NumPtsWithCharge</a></div><div class="ttdeci">unsigned short NumPtsWithCharge(const TCSlice &amp;slc, const Trajectory &amp;tj, bool includeDeadWires)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d78/Utils_8cxx_source.html#l02114">Utils.cxx:2114</a></div></div>
<div class="ttc" id="namespacetca_html_aab0c16d5fc835279921b218daaef98e1a10329bf0d918d9281fd2740f70db322b"><div class="ttname"><a href="../../de/d0f/namespacetca.html#aab0c16d5fc835279921b218daaef98e1a10329bf0d918d9281fd2740f70db322b">tca::kCanSection</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00308">DataStructs.h:308</a></div></div>
<div class="ttc" id="namespacetca_html_a3bc30aeace71ea50324b602afa2155f2"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a3bc30aeace71ea50324b602afa2155f2">tca::evt</a></div><div class="ttdeci">TCEvent evt</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/DataStructs_8cxx_source.html#l00007">DataStructs.cxx:7</a></div></div>
<div class="ttc" id="structtca_1_1PFPStruct_html_a24c761b3091ff8a756eb3069232466f8"><div class="ttname"><a href="../../dc/d18/structtca_1_1PFPStruct.html#a24c761b3091ff8a756eb3069232466f8">tca::PFPStruct::MVI</a></div><div class="ttdeci">unsigned short MVI</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00301">DataStructs.h:301</a></div></div>
<div class="ttc" id="structtca_1_1TP3D_html_a36c98f652f537113040d880f5898afaa"><div class="ttname"><a href="../../d5/db8/structtca_1_1TP3D.html#a36c98f652f537113040d880f5898afaa">tca::TP3D::TPX</a></div><div class="ttdeci">double TPX</div><div class="ttdoc">X position of the TP or the single hit. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00257">DataStructs.h:257</a></div></div>
<div class="ttc" id="structgeo_1_1TPCID_html_a4a7f86b46d9d48a040b7ef5d65973811"><div class="ttname"><a href="../../d2/d4d/structgeo_1_1TPCID.html#a4a7f86b46d9d48a040b7ef5d65973811">geo::TPCID::TPC</a></div><div class="ttdeci">TPCID_t TPC</div><div class="ttdoc">Index of the TPC within its cryostat. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d48/geo__types_8h_source.html#l00406">geo_types.h:406</a></div></div>
<div class="ttc" id="namespacetca_html_a8046762858ae84edee746a126116196d"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a8046762858ae84edee746a126116196d">tca::StorePFP</a></div><div class="ttdeci">bool StorePFP(TCSlice &amp;slc, PFPStruct &amp;pfp)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l03003">PFPUtils.cxx:3003</a></div></div>
<div class="ttc" id="PhysicalConstants_8h_html"><div class="ttname"><a href="../../dd/d09/PhysicalConstants_8h.html">PhysicalConstants.h</a></div><div class="ttdoc">Collection of Physical constants used in LArSoft. </div></div>
<div class="ttc" id="namespacetca_html_afd50fd87ab14988a84db0675b36812f3"><div class="ttname"><a href="../../de/d0f/namespacetca.html#afd50fd87ab14988a84db0675b36812f3">tca::ChgFracNearEnd</a></div><div class="ttdeci">float ChgFracNearEnd(detinfo::DetectorPropertiesData const &amp;detProp, const TCSlice &amp;slc, const PFPStruct &amp;pfp, unsigned short end)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l03231">PFPUtils.cxx:3231</a></div></div>
<div class="ttc" id="namespacetca_html_a0e6c8605555a6b803b894383785a4cfa"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a0e6c8605555a6b803b894383785a4cfa">tca::PrintTP3Ds</a></div><div class="ttdeci">void PrintTP3Ds(detinfo::DetectorClocksData const &amp;clockData, detinfo::DetectorPropertiesData const &amp;detProp, std::string someText, const TCSlice &amp;slc, const PFPStruct &amp;pfp, short printPts)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l03396">PFPUtils.cxx:3396</a></div></div>
<div class="ttc" id="namespacelib_1_1dedx_html_a62b15446ae03a5857d5e03fa30b03fd4"><div class="ttname"><a href="../../d3/d5d/namespacelib_1_1dedx.html#a62b15446ae03a5857d5e03fa30b03fd4">lib.dedx.A</a></div><div class="ttdeci">float A</div><div class="ttdef"><b>Definition:</b> <a href="../../df/df9/dedx_8py_source.html#l00137">dedx.py:137</a></div></div>
<div class="ttc" id="structtca_1_1PFPStruct_html_a95513011426d3fcb8124798a85ff2ed6"><div class="ttname"><a href="../../dc/d18/structtca_1_1PFPStruct.html#a95513011426d3fcb8124798a85ff2ed6">tca::PFPStruct::ParentUID</a></div><div class="ttdeci">size_t ParentUID</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00296">DataStructs.h:296</a></div></div>
<div class="ttc" id="namespacetca_html_a66ba31f5d3047b3a68011a4e154891fc"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a66ba31f5d3047b3a68011a4e154891fc">tca::DirAtEnd</a></div><div class="ttdeci">Vector3_t DirAtEnd(const PFPStruct &amp;pfp, unsigned short end)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l03283">PFPUtils.cxx:3283</a></div></div>
<div class="ttc" id="namespacetca_html_ab1fa50d5a4a7a5a1bd31e2e737d2841d"><div class="ttname"><a href="../../de/d0f/namespacetca.html#ab1fa50d5a4a7a5a1bd31e2e737d2841d">tca::StitchPFPs</a></div><div class="ttdeci">void StitchPFPs()</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l00041">PFPUtils.cxx:41</a></div></div>
<div class="ttc" id="namespacetca_html_a948420c5e901739e6c8b846dd53faf67"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a948420c5e901739e6c8b846dd53faf67">tca::MakeTP3D</a></div><div class="ttdeci">TP3D MakeTP3D(detinfo::DetectorPropertiesData const &amp;detProp, TCSlice &amp;slc, const TrajPoint &amp;itp, const TrajPoint &amp;jtp)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l02447">PFPUtils.cxx:2447</a></div></div>
<div class="ttc" id="structtca_1_1SortEntry_html"><div class="ttname"><a href="../../db/d7d/structtca_1_1SortEntry.html">tca::SortEntry</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dfc/TCVertex_8cxx_source.html#l00027">TCVertex.cxx:27</a></div></div>
<div class="ttc" id="DebugStruct_8h_html"><div class="ttname"><a href="../../da/db2/DebugStruct_8h.html">DebugStruct.h</a></div></div>
<div class="ttc" id="classgeo_1_1TPCGeo_html_a3f663d96f6fe0ad88a84fa7dd0c9fc77"><div class="ttname"><a href="../../d9/dff/classgeo_1_1TPCGeo.html#a3f663d96f6fe0ad88a84fa7dd0c9fc77">geo::TPCGeo::LocalToWorld</a></div><div class="ttdeci">void LocalToWorld(const double *tpc, double *world) const </div><div class="ttdoc">Transform point from local TPC frame to world frame. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/de9/TPCGeo_8h_source.html#l00563">TPCGeo.h:563</a></div></div>
<div class="ttc" id="test__associatedgroups__full_8fcl_html_a07fbfef6c53a7ed684db7d9f21876cb8"><div class="ttname"><a href="../../d1/dbb/test__associatedgroups__full_8fcl.html#a07fbfef6c53a7ed684db7d9f21876cb8">e1</a></div><div class="ttdeci">physics pm2 e1</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dbb/test__associatedgroups__full_8fcl_source.html#l00028">test_associatedgroups_full.fcl:28</a></div></div>
<div class="ttc" id="namespacetca_html_a9fd1ad10d91864b22ca292c19769f31f"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a9fd1ad10d91864b22ca292c19769f31f">tca::AttachToAnyVertex</a></div><div class="ttdeci">bool AttachToAnyVertex(TCSlice &amp;slc, PFPStruct &amp;pfp, float maxSep, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dfc/TCVertex_8cxx_source.html#l01597">TCVertex.cxx:1597</a></div></div>
<div class="ttc" id="structtca_1_1TCSlice_html_a038a7aedcbc4fbac7ed8f29f37fec545"><div class="ttname"><a href="../../db/d39/structtca_1_1TCSlice.html#a038a7aedcbc4fbac7ed8f29f37fec545">tca::TCSlice::yHi</a></div><div class="ttdeci">float yHi</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00661">DataStructs.h:661</a></div></div>
<div class="ttc" id="test__associatedgroupswithleft__full_8fcl_html_a4814f2598ed6acdb806473d732f33889"><div class="ttname"><a href="../../d9/dab/test__associatedgroupswithleft__full_8fcl.html#a4814f2598ed6acdb806473d732f33889">p1</a></div><div class="ttdeci">physics associatedGroupsWithLeft p1</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dab/test__associatedgroupswithleft__full_8fcl_source.html#l00024">test_associatedgroupswithleft_full.fcl:24</a></div></div>
<div class="ttc" id="structgeo_1_1TPCID_html_ad779a535f3e0ba563bf8e30214a123f3"><div class="ttname"><a href="../../d2/d4d/structgeo_1_1TPCID.html#ad779a535f3e0ba563bf8e30214a123f3">geo::TPCID::TPCID</a></div><div class="ttdeci">constexpr TPCID()=default</div><div class="ttdoc">Default constructor: an invalid TPC ID. </div></div>
<div class="ttc" id="messageservice_8fcl_html_a6699b4dbd72f548e48d81c88697d35a6"><div class="ttname"><a href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">cout</a></div><div class="ttdeci">BEGIN_PROLOG could also be cout</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/df5/messageservice_8fcl_source.html#l00010">messageservice.fcl:10</a></div></div>
<div class="ttc" id="namespacedetsim_html_a560adbb3abf95a23d45a53ed25d8c0c7"><div class="ttname"><a href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detsim::detProp</a></div><div class="ttdeci">auto const detProp</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/SimWire__module_8cc_source.html#l00154">SimWire_module.cc:154</a></div></div>
<div class="ttc" id="namespacetca_html_a26e3b3c5f6ab13bbdb0e91d6f4858e13"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a26e3b3c5f6ab13bbdb0e91d6f4858e13">tca::Update</a></div><div class="ttdeci">bool Update(detinfo::DetectorClocksData const &amp;clockData, detinfo::DetectorPropertiesData const &amp;detProp, const TCSlice &amp;slc, PFPStruct &amp;pfp, bool prt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l01056">PFPUtils.cxx:1056</a></div></div>
<div class="ttc" id="StepUtils_8h_html"><div class="ttname"><a href="../../df/df0/StepUtils_8h.html">StepUtils.h</a></div></div>
<div class="ttc" id="TPCGeo_8h_html"><div class="ttname"><a href="../../df/de9/TPCGeo_8h.html">TPCGeo.h</a></div><div class="ttdoc">Encapsulate the construction of a single detector plane. </div></div>
<div class="ttc" id="structtca_1_1PFPStruct_html_aa381ee94d1b9593dd5886b3dbce68e52"><div class="ttname"><a href="../../dc/d18/structtca_1_1PFPStruct.html#aa381ee94d1b9593dd5886b3dbce68e52">tca::PFPStruct::EndFlag</a></div><div class="ttdeci">std::array&lt; std::bitset&lt; 8 &gt;, 2 &gt; EndFlag</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00303">DataStructs.h:303</a></div></div>
<div class="ttc" id="structtca_1_1TrajPoint_html"><div class="ttname"><a href="../../da/d22/structtca_1_1TrajPoint.html">tca::TrajPoint</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00154">DataStructs.h:154</a></div></div>
<div class="ttc" id="namespacetca_html_a9eff93d6b8e15a5bc946106bcd59e7cf"><div class="ttname"><a href="../../de/d0f/namespacetca.html#a9eff93d6b8e15a5bc946106bcd59e7cf">tca::SptInTPC</a></div><div class="ttdeci">bool SptInTPC(const std::array&lt; unsigned int, 3 &gt; &amp;sptHits, unsigned int tpc)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d86/PFPUtils_8cxx_source.html#l00792">PFPUtils.cxx:792</a></div></div>
<div class="ttc" id="classgeo_1_1GeometryCore_html_a45df0d5e161fa45e89854381f55aceb0"><div class="ttname"><a href="../../d7/d63/classgeo_1_1GeometryCore.html#a45df0d5e161fa45e89854381f55aceb0">geo::GeometryCore::HasWire</a></div><div class="ttdeci">bool HasWire(geo::WireID const &amp;wireid) const </div><div class="ttdoc">Returns whether we have the specified wire. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de7/GeometryCore_8h_source.html#l03383">GeometryCore.h:3383</a></div></div>
<div class="ttc" id="structtca_1_1TP3D_html_a9ec485b3235b668007802b7b717b3e40"><div class="ttname"><a href="../../d5/db8/structtca_1_1TP3D.html#a9ec485b3235b668007802b7b717b3e40">tca::TP3D::SFIndex</a></div><div class="ttdeci">unsigned short SFIndex</div><div class="ttdoc">and the section fit index </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00264">DataStructs.h:264</a></div></div>
<div class="ttc" id="structtca_1_1TCWireIntersection_html_a21d39ae74d46f36d481ad3514f1b3321"><div class="ttname"><a href="../../d7/de3/structtca_1_1TCWireIntersection.html#a21d39ae74d46f36d481ad3514f1b3321">tca::TCWireIntersection::y</a></div><div class="ttdeci">double y</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da4/DataStructs_8h_source.html#l00130">DataStructs.h:130</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
